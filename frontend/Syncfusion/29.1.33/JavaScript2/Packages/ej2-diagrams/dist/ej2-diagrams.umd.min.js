!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@syncfusion/ej2-base"),require("@syncfusion/ej2-popups"),require("@syncfusion/ej2-data"),require("@syncfusion/ej2-navigations")):"function"==typeof define&&define.amd?define(["exports","@syncfusion/ej2-base","@syncfusion/ej2-popups","@syncfusion/ej2-data","@syncfusion/ej2-navigations"],e):e((t=t||self).ej={},t.ej2Base,t.ej2Popups,t.ej2Data,t.ej2Navigations)}(this,function(Z,N,v,b,S){"use strict";w.prototype.isEmpty=function(){return 0===this.height&&0===this.width},w.prototype.clone=function(){return new w(this.width,this.height)};var j=w;function w(t,e){this.width=t,this.height=e}x=function(t,e){return(x=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)};var x,I,t=function(t,e){function i(){this.constructor=t}x(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},C=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;0<=s;s--)(r=t[s])&&(a=(o<3?r(a):3<o?r(e,i,a):r(e,i))||a);return 3<o&&a&&Object.defineProperty(e,i,a),a},K=(I=N.ChildProperty,t(T,I),T.equals=function(t,e){return t===e||!(!t||!e||t&&e&&(t.x!==e.x||t.y!==e.y))},T.isEmptyPoint=function(t){return!t.x||!t.y},T.transform=function(t,e,i){var n={x:0,y:0};return n.x=Math.round(100*(t.x+i*Math.cos(e*Math.PI/180)))/100,n.y=Math.round(100*(t.y+i*Math.sin(e*Math.PI/180)))/100,n},T.findLength=function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},T.findAngle=function(t,e){e=180*(e=Math.atan2(e.y-t.y,e.x-t.x))/Math.PI;return(e%=360)<0&&(e+=360),e},T.distancePoints=function(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},T.getLengthFromListOfPoints=function(t){for(var e=0,i=0;i<t.length-1;i++)e+=this.distancePoints(t[parseInt(i.toString(),10)],t[i+1]);return e},T.adjustPoint=function(t,e,i,n){var r,o=i?{x:t.x,y:t.y}:{x:e.x,y:e.y};return t.x===e.x?t.y<e.y&&i||t.y>e.y&&!i?o.y+=n:o.y-=n:t.y===e.y?t.x<e.x&&i||t.x>e.x&&!i?o.x+=n:o.x-=n:o=i?(r=this.findAngle(t,e),this.transform(t,r,n)):(r=this.findAngle(e,t),this.transform(e,r,n)),o},T.direction=function(t,e){return Math.abs(e.x-t.x)>Math.abs(e.y-t.y)?t.x<e.x?"Right":"Left":t.y<e.y?"Bottom":"Top"},T.prototype.getClassName=function(){return"Point"},C([N.Property(0)],T.prototype,"x",void 0),C([N.Property(0)],T.prototype,"y",void 0),T);function T(){return null!==I&&I.apply(this,arguments)||this}function D(t){var e,i=[],n=O(t);if(0<n.length)for(var r=0;r<n.length;r++){var o=n[parseInt(r.toString(),10)],a="";switch((a=o[0]).toLowerCase()){case"m":for(e=1;e<o.length;e++)i.push({command:a,x:o[parseInt(e.toString(),10)],y:o[e+1]}),e+=1,"m"===a?a="l":"M"===a&&(a="L");break;case"l":case"t":for(e=1;e<o.length;e++)i.push({command:a,x:o[parseInt(e.toString(),10)],y:o[e+1]}),e+=1;break;case"h":for(e=1;e<o.length;e++)i.push({command:a,x:o[parseInt(e.toString(),10)]});break;case"v":for(e=1;e<o.length;e++)i.push({command:a,y:o[parseInt(e.toString(),10)]});break;case"z":i.push({command:a});break;case"c":for(e=1;e<o.length;e++)i.push({command:a,x1:o[parseInt(e.toString(),10)],y1:o[e+1],x2:o[e+2],y2:o[e+3],x:o[e+4],y:o[e+5]}),e+=5;break;case"s":for(e=1;e<o.length;e++)i.push({command:a,x2:o[parseInt(e.toString(),10)],y2:o[e+1],x:o[e+2],y:o[e+3]}),e+=3;break;case"q":for(e=1;e<o.length;e++)i.push({command:a,x1:o[parseInt(e.toString(),10)],y1:o[e+1],x:o[e+2],y:o[e+3]}),e+=3;break;case"a":for(e=1;e<o.length;e++)i.push({command:a,r1:o[parseInt(e.toString(),10)],r2:o[e+1],angle:o[e+2],largeArc:o[e+3],sweep:o[e+4],x:o[e+5],y:o[e+6]}),e+=6}}return i}function O(t){for(var e=/([a-z]+)|([+-]?(?:\d+\.?\d*|\.\d+))/gi,i=[],n=[],r={},o=(e.lastIndex=0,!1),r=e.exec(t);r;)o="e"===r[1]||(r[1]?i="zm"===r[1].toLowerCase()?(i.length&&n.push(i),n.push(["Z"]),[r[1].substring(1,2)]):(i.length&&n.push(i),[r[1]]):(i.length||(i=[]),o||i.push(Number(r[2]))),!1),r=e.exec(t);return i.length&&n.push(i),n}function E(t,e,i){for(var n,r="",o=[{x:0+t,y:0},{x:0+i-t,y:0},{x:0+i,y:0+t},{x:0+i,y:0+e-t},{x:0+i-t,y:0+e},{x:0+t,y:0+e},{x:0,y:0+e-t},{x:0,y:0+t}],a=[{x:0+i,y:0},{x:0+i,y:0+e},{x:0,y:0+e},{x:0,y:0}],s=0,r="M"+o[0].x+" "+o[0].y,h=0;h<o.length;h+=2)r+="L"+(n=o[h+1]).x+" "+n.y,n=o[h+2]||o[0],r+="Q"+a[parseInt(s.toString(),10)].x+" "+a[parseInt(s.toString(),10)].y+" "+n.x+" "+n.y,s++;return r}function L(t){for(var e,i="",i="M"+t[0].x+" "+t[0].y,n=1;n<t.length;n++)i+="L"+(e=t[parseInt(n.toString(),10)]).x+" "+e.y;return i+="Z"}function R(t){for(var e=0;e<t.length;e++)t[parseInt(e.toString(),10)].x=Math.round(t[parseInt(e.toString(),10)].x),t[parseInt(e.toString(),10)].y=Math.round(t[parseInt(e.toString(),10)].y);for(var i,n="",n="M"+t[0].x+" "+t[0].y,r=1;r<t.length;r++)n+="L"+(i=t[parseInt(r.toString(),10)]).x+" "+i.y;return n}function X(t){for(var e,i,n,r,o,a,s=[],h=0,d=0,l=0,c=t.length;l<c;++l){var p,g,u=t[l],m=u.command,f=("y1"in u&&(r=u.y1),"y2"in u&&(a=u.y2),"x1"in u&&(n=u.x1),"x2"in u&&(o=u.x2),"x"in u&&(h=u.x),"y"in u&&(d=u.y),s[s.length-1]);switch(m){case"M":s.push({command:"M",x:h,y:d});break;case"L":s.push({command:"L",x0:e,y0:i,x:h,y:d});break;case"H":s.push({command:"L",x0:e,y0:i,x:h,y:i});break;case"V":s.push({command:"L",x0:e,y0:i,x:e,y:d});break;case"C":s.push({command:"C",x0:e,y0:i,x1:n,y1:r,x2:o,y2:a,x:h,y:d});break;case"S":f&&(p=void 0,g={x:2*e-(p="C"===f.command||"S"===f.command?{x:f.x2,y:f.y2}:{x:e,y:i}).x,y:2*i-p.y},s.push({command:"C",x0:e,y0:i,x1:g.x,y1:g.y,x2:o,y2:a,x:h,y:d}));break;case"Q":s.push({command:"Q",x0:e,y0:i,x1:n,y1:r,x:h,y:d});break;case"T":f&&(p=void 0,g={x:2*e-(p="Q"===f.command?{x:f.x1,y:f.y1}:{x:e,y:i}).x,y:2*i-p.y},s.push({command:"Q",x0:e,y0:i,x1:g.x,y1:g.y,x:h,y:d}));break;case"A":var y=u;y.command="A",s.push(y);break;case"Z":case"z":s.push({command:"Z"}),h=e,d=i}e=h,i=d}return s}function V(t,e,i,n,r,o,a,s){for(var h,d,l,c,p=0,g=0,u=0,m=t.length;u<m;++u){var f=t[u],y=f.command;"x"in f&&(p=f.x),"y"in f&&(g=f.y),"y1"in f&&(d=f.y1),"y2"in f&&(c=f.y2),"x1"in f&&(h=f.x1),"x2"in f&&(l=f.x2),n?(void 0!==p&&(p=J(p,e,r,a)),void 0!==g&&(g=J(g,i,o,s)),void 0!==h&&(h=J(h,e,r,a)),void 0!==d&&(d=J(d,i,o,s)),void 0!==l&&(l=J(l,e,r,a)),void 0!==c&&(c=J(c,i,o,s))):(void 0!==p&&(p=Number((p+e).toFixed(2))),void 0!==g&&(g=Number((g+i).toFixed(2))),void 0!==h&&(h=Number((h+e).toFixed(2))),void 0!==d&&(d=Number((d+i).toFixed(2))),void 0!==l&&(l=Number((l+e).toFixed(2))),void 0!==c&&(c=Number((c+i).toFixed(2)))),(y=U(f,y,{x:p,y:g,x1:h,y1:d,x2:l,y2:c,r1:f.r1,r2:f.r2},n,e,i))&&(t[u]=y)}return tt(t)}function U(t,e,i,n,r,o){switch(e){case"M":case"L":t.x=i.x,t.y=i.y;break;case"H":t.x=i.x;break;case"V":t.y=i.y;break;case"C":t.x=i.x,t.y=i.y,t.x1=i.x1,t.y1=i.y1,t.x2=i.x2,t.y2=i.y2;break;case"S":t.x=i.x,t.y=i.y,t.x2=i.x2,t.y2=i.y2;break;case"Q":t.x=i.x,t.y=i.y,t.x1=i.x1,t.y1=i.y1;break;case"T":t.x=i.x,t.y=i.y;break;case"A":var a=i.r1,s=i.r2;n&&(i.r1=a*=r,i.r2=s*=o),t.x=i.x,t.y=i.y,t.r1=i.r1,t.r2=i.r2;break;case"z":case"Z":t={command:"Z"}}return t}function J(t,e,i,n){return t!==i?t=n!==i?t*e-(Number(i)*e-Number(i))+(n-Number(i)):Number(t)*e-(Number(i)*e-Number(i)):n!==i&&(t=n),Number(t.toFixed(2))}function $(t){for(var e,i,n,r,o,a,s=0,h=0,d=0,l=t.length;d<l;++d){var c=t[parseInt(d.toString(),10)],p=c.command;if(/[MLHVCSQTA]/.test(p))"x"in c&&(c.x=s=c.x),"y"in c&&(c.y=h=c.y);else{"x1"in c&&(c.x1=n=s+c.x1),"x2"in c&&(c.x2=o=s+c.x2),"y1"in c&&(c.y1=r=h+c.y1),"y2"in c&&(c.y2=a=h+c.y2),"x"in c&&(c.x=s+=c.x),"y"in c&&(c.y=h+=c.y);var g=void 0;switch(p){case"m":case"M":g={command:"M",x:s,y:h};break;case"l":case"L":g={command:"L",x:s,y:h};break;case"h":case"H":g={command:"H",x:s};break;case"v":case"V":g={command:"V",y:h};break;case"c":case"C":g={command:"C",x:s,y:h,x1:n,y1:r,x2:o,y2:a};break;case"s":case"S":g={command:"S",x:s,y:h,x2:o,y2:a};break;case"q":case"Q":g={command:"Q",x:s,y:h,x1:n,y1:r};break;case"t":case"T":g={command:"T",x:s,y:h};break;case"a":case"A":(g={command:"A",x:s,y:h}).r1=c.r1,g.r2=c.r2,g.angle=c.angle,g.largeArc=c.largeArc,g.sweep=c.sweep;break;case"z":case"Z":g={command:"Z"},s=e,h=i,g=t[parseInt(d.toString(),10)]}g&&(t[parseInt(d.toString(),10)]=g)}"M"!==p&&"m"!==p||(e=s,i=h)}return t}function tt(t){for(var e="",i=0;i<t.length;i++)e+=0===i?et(t[parseInt(i.toString(),10)]):" "+et(t[parseInt(i.toString(),10)]);return e}function et(t){var e="";switch(t.command){case"Z":case"z":e=t.command;break;case"M":case"m":case"L":case"l":e=t.command+" "+t.x+" "+t.y;break;case"C":case"c":e=t.command+" "+t.x1+" "+t.y1+" "+t.x2+" "+t.y2+" "+t.x+" "+t.y;break;case"Q":case"q":e=t.command+" "+t.x1+" "+t.y1+" "+t.x+" "+t.y;break;case"A":case"a":var i=t.command,n=t.angle,r=t.largeArc?"1":"0",o=t.sweep?"1":"0",e=i+" "+t.r1+" "+t.r2+" "+n+" "+r+" "+o+" "+t.x+" "+t.y;break;case"H":case"h":e=t.command+" "+t.x;break;case"V":case"v":e=t.command+" "+t.y;break;case"S":case"s":e=t.command+" "+t.x2+" "+t.y2+" "+t.x+" "+t.y;break;case"T":case"t":e=t.command+" "+t.x+" "+t.y}return e}Object.defineProperty(it.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(it.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(it.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(it.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(it.prototype,"topLeft",{get:function(){return{x:this.left,y:this.top}},enumerable:!0,configurable:!0}),Object.defineProperty(it.prototype,"topRight",{get:function(){return{x:this.right,y:this.top}},enumerable:!0,configurable:!0}),Object.defineProperty(it.prototype,"bottomLeft",{get:function(){return{x:this.left,y:this.bottom}},enumerable:!0,configurable:!0}),Object.defineProperty(it.prototype,"bottomRight",{get:function(){return{x:this.right,y:this.bottom}},enumerable:!0,configurable:!0}),Object.defineProperty(it.prototype,"middleLeft",{get:function(){return{x:this.left,y:this.y+this.height/2}},enumerable:!0,configurable:!0}),Object.defineProperty(it.prototype,"middleRight",{get:function(){return{x:this.right,y:this.y+this.height/2}},enumerable:!0,configurable:!0}),Object.defineProperty(it.prototype,"topCenter",{get:function(){return{x:this.x+this.width/2,y:this.top}},enumerable:!0,configurable:!0}),Object.defineProperty(it.prototype,"bottomCenter",{get:function(){return{x:this.x+this.width/2,y:this.bottom}},enumerable:!0,configurable:!0}),Object.defineProperty(it.prototype,"center",{get:function(){return{x:this.x+this.width/2,y:this.y+this.height/2}},enumerable:!0,configurable:!0}),it.prototype.equals=function(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height},it.prototype.uniteRect=function(t){var e=Math.max((isNaN(this.right)||this.x===Number.MAX_VALUE?t:this).right,t.right),i=Math.max((isNaN(this.bottom)||this.y===Number.MAX_VALUE?t:this).bottom,t.bottom);return this.x=Math.min(this.left,t.left),this.y=Math.min(this.top,t.top),this.width=e-this.x,this.height=i-this.y,this},it.prototype.unitePoint=function(t){var e,i,n;this.x===Number.MAX_VALUE?(this.x=t.x,this.y=t.y):(e=Math.min(this.left,t.x),i=Math.min(this.top,t.y),n=Math.max(this.right,t.x),t=Math.max(this.bottom,t.y),this.x=e,this.y=i,this.width=n-this.x,this.height=t-this.y)},it.prototype.Inflate=function(t){return this.x-=t,this.y-=t,this.width+=2*t,this.height+=2*t,this},it.prototype.intersects=function(t){return!(this.right<t.left||this.left>t.right||this.top>t.bottom||this.bottom<t.top)},it.prototype.containsRect=function(t){return this.left<=t.left&&this.right>=t.right&&this.top<=t.top&&this.bottom>=t.bottom},it.prototype.containsPoint=function(t,e){return this.left-(e=void 0===e?0:e)<=t.x&&this.right+e>=t.x&&this.top-e<=t.y&&this.bottom+e>=t.y},it.toBounds=function(t){for(var e=new it,i=0,n=t;i<n.length;i++){var r=n[i];e.unitePoint(r)}return e},it.empty=new it(Number.MAX_VALUE,Number.MIN_VALUE,0,0);var k=it;function it(t,e,i,n){this.x=Number.MAX_VALUE,this.y=Number.MAX_VALUE,this.width=0,void(this.height=0)===t||void 0===e?(t=e=Number.MAX_VALUE,i=n=0):(void 0===i&&(i=0),void 0===n&&(n=0)),this.x=t,this.y=e,this.width=i,this.height=n}(t=Z.MatrixTypes||(Z.MatrixTypes={}))[t.Identity=0]="Identity",t[t.Translation=1]="Translation",t[t.Scaling=2]="Scaling",t[t.Unknown=4]="Unknown";var nt=function(t,e,i,n,r,o,a){this.m11=t,this.m12=e,this.m21=i,this.m22=n,this.offsetX=r,this.offsetY=o,this.type=a};function rt(){return new nt(1,0,0,1,0,0,Z.MatrixTypes.Identity)}function z(t,e){t=function(t,e,i){{var n,r;i=t.type===(Z.MatrixTypes.Translation|Z.MatrixTypes.Scaling)?(e=(e*=t.m11)+t.offsetX,(i*=t.m22)+t.offsetY):(n=i*t.m21+t.offsetX,r=e*t.m12+t.offsetY,e=(e*=t.m11)+n,(i*=t.m22)+r)}return{x:e,y:i}}(t,e.x,e.y);return{x:Math.round(100*t.x)/100,y:Math.round(100*t.y)/100}}function ot(t,e){for(var i=[],n=0,r=e;n<r.length;n++){var o=r[n];i.push(z(t,o))}return i}function at(t,e,i,n){var r,o;dt(t,(t=.017453292519943295*(e%=360),e=i||0,i=n||0,n=rt(),r=Math.sin(t),t=Math.cos(t),o=e*(1-t)+i*r,i=i*(1-t)-e*r,n.type=Z.MatrixTypes.Unknown,lt(n,t,r,-r,t,o,i),n))}function st(t,e,i,n,r){dt(t,(t=e,e=i,i=n=void 0===n?0:n,n=r=void 0===r?0:r,(r=rt()).type=i||n?Z.MatrixTypes.Scaling|Z.MatrixTypes.Translation:Z.MatrixTypes.Scaling,lt(r,t,0,0,e,i-t*i,n-e*n),r))}function ht(t,e,i){t.offsetX+=e,t.offsetY+=i,t.type|=Z.MatrixTypes.Translation}function dt(t,e){var i=t.type,n=e.type;if(i===Z.MatrixTypes.Identity)ct(t,e),t.type=e.type;else if(i!==Z.MatrixTypes.Translation){var r=i<<4|n;switch(r){case 50:return t.m11*=e.m11,t.m22*=e.m22,t.offsetX*=e.m11,void(t.offsetY*=e.m22);case 51:return t.m11*=e.m11,t.m22*=e.m22,t.offsetX=e.m11*t.offsetX+e.offsetX,void(t.offsetY=e.m22*t.offsetY+e.offsetY);case 52:break;default:switch(r){case 66:case 67:case 68:break;default:return}}i=rt();lt(i,t.m11*e.m11+t.m12*e.m21,t.m11*e.m12+t.m12*e.m22,t.m21*e.m11+t.m22*e.m21,t.m21*e.m12+t.m22*e.m22,t.offsetX*e.m11+t.offsetY*e.m21+e.offsetX,t.offsetX*e.m12+t.offsetY*e.m22+e.offsetY),i.m21||i.m12?i.type=Z.MatrixTypes.Unknown:((i.m11&&1!==i.m11||i.m22&&1!==i.m22)&&(i.type=Z.MatrixTypes.Scaling),(i.offsetX||i.offsetY)&&(i.type|=Z.MatrixTypes.Translation),(i.type&(Z.MatrixTypes.Translation|Z.MatrixTypes.Scaling))===Z.MatrixTypes.Identity&&(i.type=Z.MatrixTypes.Identity),i.type=Z.MatrixTypes.Scaling|Z.MatrixTypes.Translation),ct(t,i),t.type=i.type}else{var i=t.offsetX,o=t.offsetY;t.offsetX=i*e.m11+o*e.m21+e.offsetX,t.offsetY=i*e.m12+o*e.m22+e.offsetY,n===Z.MatrixTypes.Unknown?t.type=Z.MatrixTypes.Unknown:t.type=Z.MatrixTypes.Translation|Z.MatrixTypes.Scaling}}function lt(t,e,i,n,r,o,a){t.m11=e,t.m12=i,t.m21=n,t.m22=r,t.offsetX=o,t.offsetY=a}function ct(t,e){t.m11=e.m11,t.m12=e.m12,t.m21=e.m21,t.m22=e.m22,t.offsetX=e.offsetX,t.offsetY=e.offsetY,t.type=e.type}function pt(t){if(t)switch(t.type){case"Linear":return Et;case"Radial":return kt;default:return Et}return Et}gt=function(t,e){return(gt=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)};var gt,ut,C=function(t,e){function i(){this.constructor=t}gt(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},t=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;0<=s;s--)(r=t[s])&&(a=(o<3?r(a):3<o?r(e,i,a):r(e,i))||a);return 3<o&&a&&Object.defineProperty(e,i,a),a},mt=function(t,e,i,n){this.left=t,this.right=e,this.top=i,this.bottom=n},ft=(ut=N.ChildProperty,C(yt,ut),t([N.Property(0)],yt.prototype,"left",void 0),t([N.Property(0)],yt.prototype,"right",void 0),t([N.Property(0)],yt.prototype,"top",void 0),t([N.Property(0)],yt.prototype,"bottom",void 0),yt);function yt(){return null!==ut&&ut.apply(this,arguments)||this}vt=N.ChildProperty,C(St,vt),t([N.Property(45)],St.prototype,"angle",void 0),t([N.Property(5)],St.prototype,"distance",void 0),t([N.Property(.7)],St.prototype,"opacity",void 0),t([N.Property("lightgrey")],St.prototype,"color",void 0);var vt,bt=St;function St(){return null!==vt&&vt.apply(this,arguments)||this}wt=N.ChildProperty,C(It,wt),It.prototype.getClassName=function(){return"Stop"},t([N.Property("")],It.prototype,"color",void 0),t([N.Property(0)],It.prototype,"offset",void 0),t([N.Property(1)],It.prototype,"opacity",void 0);var wt,xt=It;function It(){return null!==wt&&wt.apply(this,arguments)||this}Ct=N.ChildProperty,C(At,Ct),t([N.Collection([],xt)],At.prototype,"stops",void 0),t([N.Property("None")],At.prototype,"type",void 0),t([N.Property("")],At.prototype,"id",void 0);var Ct,Pt=At;function At(){return null!==Ct&&Ct.apply(this,arguments)||this}C(Ot,Tt=Pt),t([N.Property(0)],Ot.prototype,"x1",void 0),t([N.Property(0)],Ot.prototype,"x2",void 0),t([N.Property(0)],Ot.prototype,"y1",void 0),t([N.Property(0)],Ot.prototype,"y2",void 0),t([N.Property(0)],Ot.prototype,"cx",void 0),t([N.Property(0)],Ot.prototype,"cy",void 0),t([N.Property(0)],Ot.prototype,"fx",void 0),t([N.Property(0)],Ot.prototype,"fy",void 0),t([N.Property(50)],Ot.prototype,"r",void 0);var Tt,Dt=Ot;function Ot(){return null!==Tt&&Tt.apply(this,arguments)||this}C(Lt,Mt=Pt),t([N.Property(0)],Lt.prototype,"x1",void 0),t([N.Property(0)],Lt.prototype,"x2",void 0),t([N.Property(0)],Lt.prototype,"y1",void 0),t([N.Property(0)],Lt.prototype,"y2",void 0);var Mt,Et=Lt;function Lt(){return null!==Mt&&Mt.apply(this,arguments)||this}C(Bt,zt=Pt),t([N.Property(0)],Bt.prototype,"cx",void 0),t([N.Property(0)],Bt.prototype,"cy",void 0),t([N.Property(0)],Bt.prototype,"fx",void 0),t([N.Property(0)],Bt.prototype,"fy",void 0),t([N.Property(50)],Bt.prototype,"r",void 0);var zt,kt=Bt;function Bt(){return null!==zt&&zt.apply(this,arguments)||this}Rt=N.ChildProperty,C(jt,Rt),t([N.Property("white")],jt.prototype,"fill",void 0),t([N.Property("black")],jt.prototype,"strokeColor",void 0),t([N.Property("")],jt.prototype,"strokeDashArray",void 0),t([N.Property(1)],jt.prototype,"strokeWidth",void 0),t([N.Property(1)],jt.prototype,"opacity",void 0),t([N.ComplexFactory(pt)],jt.prototype,"gradient",void 0);var Rt,Nt=jt;function jt(){return null!==Rt&&Rt.apply(this,arguments)||this}C(_t,Ht=Nt),t([N.Property("transparent")],_t.prototype,"fill",void 0);var Ht,Wt=_t;function _t(){return null!==Ht&&Ht.apply(this,arguments)||this}C(Vt,Yt=Nt),t([N.Property("black")],Vt.prototype,"color",void 0),t([N.Property("Arial")],Vt.prototype,"fontFamily",void 0),t([N.Property(12)],Vt.prototype,"fontSize",void 0),t([N.Property(!1)],Vt.prototype,"italic",void 0),t([N.Property(!1)],Vt.prototype,"bold",void 0),t([N.Property("CollapseSpace")],Vt.prototype,"whiteSpace",void 0),t([N.Property("WrapWithOverflow")],Vt.prototype,"textWrapping",void 0),t([N.Property("Center")],Vt.prototype,"textAlign",void 0),t([N.Property("None")],Vt.prototype,"textDecoration",void 0),t([N.Property("Wrap")],Vt.prototype,"textOverflow",void 0),t([N.Property("transparent")],Vt.prototype,"fill",void 0);var Yt,Xt=Vt;function Vt(){return null!==Yt&&Yt.apply(this,arguments)||this}Ft=N.ChildProperty,C(Ut,Ft),t([N.Property("white")],Ut.prototype,"fill",void 0),t([N.Property("Wrap")],Ut.prototype,"textOverflow",void 0),t([N.Property(1)],Ut.prototype,"strokeWidth",void 0),t([N.ComplexFactory(pt)],Ut.prototype,"gradient",void 0),t([N.Property(1)],Ut.prototype,"opacity",void 0),t([N.Property(!1)],Ut.prototype,"italic",void 0),t([N.Property("")],Ut.prototype,"strokeDashArray",void 0),t([N.Property("black")],Ut.prototype,"color",void 0),t([N.Property(12)],Ut.prototype,"fontSize",void 0),t([N.Property("Arial")],Ut.prototype,"fontFamily",void 0),t([N.Property("CollapseSpace")],Ut.prototype,"whiteSpace",void 0),t([N.Property("Center")],Ut.prototype,"textAlign",void 0),t([N.Property("None")],Ut.prototype,"textDecoration",void 0),t([N.Property(!1)],Ut.prototype,"bold",void 0),t([N.Property("black")],Ut.prototype,"strokeColor",void 0),t([N.Property("WrapWithOverflow")],Ut.prototype,"textWrapping",void 0);var Ft,C=Ut;function Ut(){return null!==Ft&&Ft.apply(this,arguments)||this}(t=Z.BlazorAction||(Z.BlazorAction={}))[t.Default=0]="Default",t[t.expandNode=2]="expandNode",t[t.interaction=4]="interaction",t[t.GroupingInProgress=8]="GroupingInProgress",t[t.GroupClipboardInProcess=16]="GroupClipboardInProcess",t[t.ClearObject=32]="ClearObject",(t=Z.FlipDirection||(Z.FlipDirection={}))[t.Horizontal=1]="Horizontal",t[t.Vertical=2]="Vertical",t[t.Both=3]="Both",t[t.None=0]="None",(t=Z.PortVisibility||(Z.PortVisibility={}))[t.Visible=1]="Visible",t[t.Hidden=2]="Hidden",t[t.Hover=4]="Hover",t[t.Connect=8]="Connect",(t=Z.SnapConstraints||(Z.SnapConstraints={}))[t.None=0]="None",t[t.ShowHorizontalLines=1]="ShowHorizontalLines",t[t.ShowVerticalLines=2]="ShowVerticalLines",t[t.ShowLines=3]="ShowLines",t[t.SnapToHorizontalLines=4]="SnapToHorizontalLines",t[t.SnapToVerticalLines=8]="SnapToVerticalLines",t[t.SnapToLines=12]="SnapToLines",t[t.SnapToObject=16]="SnapToObject",t[t.All=31]="All",(t=Z.SelectorConstraints||(Z.SelectorConstraints={}))[t.None=1]="None",t[t.ConnectorSourceThumb=2]="ConnectorSourceThumb",t[t.ConnectorTargetThumb=4]="ConnectorTargetThumb",t[t.ResizeSouthEast=8]="ResizeSouthEast",t[t.ResizeSouthWest=16]="ResizeSouthWest",t[t.ResizeNorthEast=32]="ResizeNorthEast",t[t.ResizeNorthWest=64]="ResizeNorthWest",t[t.ResizeEast=128]="ResizeEast",t[t.ResizeWest=256]="ResizeWest",t[t.ResizeSouth=512]="ResizeSouth",t[t.ResizeNorth=1024]="ResizeNorth",t[t.Rotate=2048]="Rotate",t[t.UserHandle=4096]="UserHandle",t[t.ToolTip=8192]="ToolTip",t[t.ResizeAll=2046]="ResizeAll",t[t.All=16382]="All",(t=Z.ConnectionPointOrigin||(Z.ConnectionPointOrigin={})).SamePoint="SamePoint",t.DifferentPoint="DifferentPoint",(t=Z.ChildArrangement||(Z.ChildArrangement={})).Linear="Linear",t.Nonlinear="Nonlinear",(t=Z.ConnectorConstraints||(Z.ConnectorConstraints={}))[t.None=1]="None",t[t.Select=2]="Select",t[t.Delete=4]="Delete",t[t.Drag=8]="Drag",t[t.DragSourceEnd=16]="DragSourceEnd",t[t.DragTargetEnd=32]="DragTargetEnd",t[t.DragSegmentThumb=64]="DragSegmentThumb",t[t.AllowDrop=128]="AllowDrop",t[t.Bridging=256]="Bridging",t[t.BridgeObstacle=512]="BridgeObstacle",t[t.InheritBridging=1024]="InheritBridging",t[t.PointerEvents=2048]="PointerEvents",t[t.Tooltip=4096]="Tooltip",t[t.InheritTooltip=8192]="InheritTooltip",t[t.Interaction=4218]="Interaction",t[t.ReadOnly=16384]="ReadOnly",t[t.LineRouting=32768]="LineRouting",t[t.InheritLineRouting=65536]="InheritLineRouting",t[t.ConnectToNearByNode=131072]="ConnectToNearByNode",t[t.ConnectToNearByPort=262144]="ConnectToNearByPort",t[t.ConnectToNearByElement=393216]="ConnectToNearByElement",t[t.InheritSegmentThumbShape=524288]="InheritSegmentThumbShape",t[t.InheritSegmentThumbSize=1048576]="InheritSegmentThumbSize",t[t.Default=2043454]="Default",(t=Z.AnnotationConstraints||(Z.AnnotationConstraints={}))[t.ReadOnly=2]="ReadOnly",t[t.InheritReadOnly=4]="InheritReadOnly",t[t.Select=8]="Select",t[t.Drag=16]="Drag",t[t.Resize=32]="Resize",t[t.Rotate=64]="Rotate",t[t.Tooltip=128]="Tooltip",t[t.Interaction=120]="Interaction",t[t.None=0]="None",(t=Z.NodeConstraints||(Z.NodeConstraints={}))[t.None=0]="None",t[t.Select=2]="Select",t[t.Drag=4]="Drag",t[t.Rotate=8]="Rotate",t[t.Shadow=16]="Shadow",t[t.PointerEvents=32]="PointerEvents",t[t.Delete=64]="Delete",t[t.InConnect=128]="InConnect",t[t.OutConnect=256]="OutConnect",t[t.Individual=512]="Individual",t[t.Expandable=1024]="Expandable",t[t.AllowDrop=2048]="AllowDrop",t[t.Inherit=78]="Inherit",t[t.ResizeNorthEast=4096]="ResizeNorthEast",t[t.ResizeEast=8192]="ResizeEast",t[t.ResizeSouthEast=16384]="ResizeSouthEast",t[t.ResizeSouth=32768]="ResizeSouth",t[t.ResizeSouthWest=65536]="ResizeSouthWest",t[t.ResizeWest=131072]="ResizeWest",t[t.ResizeNorthWest=262144]="ResizeNorthWest",t[t.ResizeNorth=524288]="ResizeNorth",t[t.Resize=1044480]="Resize",t[t.AspectRatio=1048576]="AspectRatio",t[t.Tooltip=2097152]="Tooltip",t[t.InheritTooltip=4194304]="InheritTooltip",t[t.ReadOnly=8388608]="ReadOnly",t[t.HideThumbs=16777216]="HideThumbs",t[t.AllowMovingOutsideLane=33554432]="AllowMovingOutsideLane",t[t.Default=5240814]="Default",(t=Z.ElementAction||(Z.ElementAction={}))[t.None=0]="None",t[t.ElementIsPort=2]="ElementIsPort",t[t.ElementIsGroup=4]="ElementIsGroup",t[t.HorizontalLaneHeader=8]="HorizontalLaneHeader",(t=Z.ThumbsConstraints||(Z.ThumbsConstraints={}))[t.Rotate=2]="Rotate",t[t.ConnectorSource=4]="ConnectorSource",t[t.ConnectorTarget=8]="ConnectorTarget",t[t.ResizeNorthEast=16]="ResizeNorthEast",t[t.ResizeEast=32]="ResizeEast",t[t.ResizeSouthEast=64]="ResizeSouthEast",t[t.ResizeSouth=128]="ResizeSouth",t[t.ResizeSouthWest=256]="ResizeSouthWest",t[t.ResizeWest=512]="ResizeWest",t[t.ResizeNorthWest=1024]="ResizeNorthWest",t[t.ResizeNorth=2048]="ResizeNorth",t[t.Default=4094]="Default",(t=Z.DiagramConstraints||(Z.DiagramConstraints={}))[t.None=1]="None",t[t.Bridging=2]="Bridging",t[t.UndoRedo=4]="UndoRedo",t[t.Tooltip=8]="Tooltip",t[t.UserInteraction=16]="UserInteraction",t[t.ApiUpdate=32]="ApiUpdate",t[t.PageEditable=48]="PageEditable",t[t.Zoom=64]="Zoom",t[t.PanX=128]="PanX",t[t.PanY=256]="PanY",t[t.Pan=384]="Pan",t[t.ZoomTextEdit=512]="ZoomTextEdit",t[t.Virtualization=1024]="Virtualization",t[t.LineRouting=2048]="LineRouting",t[t.AvoidLineOverlapping=4096]="AvoidLineOverlapping",t[t.Default=500]="Default",(t=Z.DiagramTools||(Z.DiagramTools={}))[t.None=0]="None",t[t.SingleSelect=1]="SingleSelect",t[t.MultipleSelect=2]="MultipleSelect",t[t.ZoomPan=4]="ZoomPan",t[t.DrawOnce=8]="DrawOnce",t[t.ContinuousDraw=16]="ContinuousDraw",t[t.Default=3]="Default",(t=Z.Transform||(Z.Transform={}))[t.Self=1]="Self",t[t.Parent=2]="Parent",(t=Z.RenderMode||(Z.RenderMode={}))[t.Canvas=0]="Canvas",t[t.Svg=1]="Svg",(t=Z.KeyModifiers||(Z.KeyModifiers={}))[t.None=0]="None",t[t.Control=1]="Control",t[t.Meta=1]="Meta",t[t.Alt=2]="Alt",t[t.Shift=4]="Shift",(t=Z.Keys||(Z.Keys={}))[t.None=null]="None",t[t.Number0=0]="Number0",t[t.Number1=1]="Number1",t[t.Number2=2]="Number2",t[t.Number3=3]="Number3",t[t.Number4=4]="Number4",t[t.Number5=5]="Number5",t[t.Number6=6]="Number6",t[t.Number7=7]="Number7",t[t.Number8=8]="Number8",t[t.Number9=9]="Number9",t[t.A=65]="A",t[t.B=66]="B",t[t.C=67]="C",t[t.D=68]="D",t[t.E=69]="E",t[t.F=70]="F",t[t.G=71]="G",t[t.H=72]="H",t[t.I=73]="I",t[t.J=74]="J",t[t.K=75]="K",t[t.L=76]="L",t[t.M=77]="M",t[t.N=78]="N",t[t.O=79]="O",t[t.P=80]="P",t[t.Q=81]="Q",t[t.R=82]="R",t[t.S=83]="S",t[t.T=84]="T",t[t.U=85]="U",t[t.V=86]="V",t[t.W=87]="W",t[t.X=88]="X",t[t.Y=89]="Y",t[t.Z=90]="Z",t[t.Left=37]="Left",t[t.Up=38]="Up",t[t.Right=39]="Right",t[t.Down=40]="Down",t[t.Escape=27]="Escape",t[t.Space=32]="Space",t[t.PageUp=33]="PageUp",t[t.PageDown=34]="PageDown",t[t.End=35]="End",t[t.Home=36]="Home",t[t.Delete=46]="Delete",t[t.Tab=9]="Tab",t[t.Enter=13]="Enter",t[t.BackSpace=8]="BackSpace",t[t.F1=112]="F1",t[t.F2=113]="F2",t[t.F3=114]="F3",t[t.F4=115]="F4",t[t.F5=116]="F5",t[t.F6=117]="F6",t[t.F7=118]="F7",t[t.F8=119]="F8",t[t.F9=120]="F9",t[t.F10=121]="F10",t[t.F11=122]="F11",t[t.F12=123]="F12",t[t.Star=56]="Star",t[t.Plus=187]="Plus",t[t.Minus=189]="Minus",t[t.BracketLeft=219]="BracketLeft",t[t.BracketRight=221]="BracketRight",(t=Z.DiagramAction||(Z.DiagramAction={}))[t.Render=2]="Render",t[t.PublicMethod=4]="PublicMethod",t[t.ToolAction=8]="ToolAction",t[t.UndoRedo=16]="UndoRedo",t[t.TextEdit=32]="TextEdit",t[t.Group=64]="Group",t[t.Clear=128]="Clear",t[t.PreventClearSelection=256]="PreventClearSelection",t[t.Interactions=512]="Interactions",t[t.PreventHistory=1024]="PreventHistory",t[t.PreventIconsUpdate=2048]="PreventIconsUpdate",t[t.PreventCollectionChangeOnDragOver=4096]="PreventCollectionChangeOnDragOver",t[t.PreventZIndexOnDragging=8192]="PreventZIndexOnDragging",t[t.isGroupDragging=16384]="isGroupDragging",t[t.DragUsingMouse=32768]="DragUsingMouse",t[t.DecoratorPropertyChange=65536]="DecoratorPropertyChange",t[t.PreventLaneContainerUpdate=131072]="PreventLaneContainerUpdate",(t=Z.RendererAction||(Z.RendererAction={}))[t.None=2]="None",t[t.DrawSelectorBorder=4]="DrawSelectorBorder",t[t.PreventRenderSelector=8]="PreventRenderSelector",(t=Z.RealAction||(Z.RealAction={}))[t.None=0]="None",t[t.PreventDrag=2]="PreventDrag",t[t.PreventScale=4]="PreventScale",t[t.PreventDataInit=8]="PreventDataInit",t[t.hScrollbarMoved=16]="hScrollbarMoved",t[t.vScrollbarMoved=32]="vScrollbarMoved",t[t.AnimationClick=64]="AnimationClick",t[t.EnableGroupAction=128]="EnableGroupAction",t[t.PanInProgress=256]="PanInProgress",t[t.OverViewAction=512]="OverViewAction",(t=Z.ScrollActions||(Z.ScrollActions={}))[t.None=0]="None",t[t.PropertyChange=1024]="PropertyChange",t[t.Interaction=2048]="Interaction",(t=Z.NoOfSegments||(Z.NoOfSegments={}))[t.Zero=0]="Zero",t[t.One=1]="One",t[t.Two=2]="Two",t[t.Three=3]="Three",t[t.Four=4]="Four",t[t.Five=5]="Five",(t=Z.DiagramEvent||(Z.DiagramEvent={}))[t.collectionChange=0]="collectionChange",t[t.rotateChange=1]="rotateChange",t[t.positionChange=2]="positionChange",t[t.propertyChange=3]="propertyChange",t[t.selectionChange=4]="selectionChange",t[t.sizeChange=5]="sizeChange",t[t.drop=6]="drop",t[t.sourcePointChange=7]="sourcePointChange",t[t.targetPointChange=8]="targetPointChange",t[t.connectionChange=9]="connectionChange",t[t.animationComplete=10]="animationComplete",t[t.click=11]="click",t[t.doubleClick=12]="doubleClick",t[t.scrollChange=13]="scrollChange",t[t.dragEnter=14]="dragEnter",t[t.dragLeave=15]="dragLeave",t[t.dragOver=16]="dragOver",t[t.textEdit=17]="textEdit",t[t.paletteSelectionChange=18]="paletteSelectionChange",t[t.historyChange=19]="historyChange",t[t.mouseEnter=20]="mouseEnter",t[t.mouseLeave=21]="mouseLeave",t[t.mouseOver=22]="mouseOver",t[t.expandStateChange=23]="expandStateChange",t[t.segmentCollectionChange=24]="segmentCollectionChange",t[t.commandExecute=25]="commandExecute",t[t.historyStateChange=26]="historyStateChange",t[t.onUserHandleMouseDown=27]="onUserHandleMouseDown",t[t.onUserHandleMouseUp=28]="onUserHandleMouseUp",t[t.onUserHandleMouseEnter=29]="onUserHandleMouseEnter",t[t.onUserHandleMouseLeave=30]="onUserHandleMouseLeave",t[t.onImageLoad=31]="onImageLoad",t[t.onDoBindingInit=32]="onDoBindingInit",t[t.keyUp=33]="keyUp",t[t.keyDown=34]="keyDown",t[t.fixedUserHandleClick=35]="fixedUserHandleClick",t[t.elementDraw=36]="elementDraw",t[t.mouseWheel=37]="mouseWheel",t[t.segmentChange=38]="segmentChange",t[t.onFixedUserHandleMouseDown=39]="onFixedUserHandleMouseDown",t[t.onFixedUserHandleMouseUp=40]="onFixedUserHandleMouseUp",t[t.onFixedUserHandleMouseEnter=41]="onFixedUserHandleMouseEnter",t[t.onFixedUserHandleMouseLeave=42]="onFixedUserHandleMouseLeave",t[t.loaded=43]="loaded",t[t.layoutUpdated=44]="layoutUpdated",(t=Z.PortConstraints||(Z.PortConstraints={}))[t.None=1]="None",t[t.Drag=2]="Drag",t[t.Draw=4]="Draw",t[t.InConnect=8]="InConnect",t[t.OutConnect=16]="OutConnect",t[t.ToolTip=32]="ToolTip",t[t.InheritTooltip=64]="InheritTooltip",t[t.Default=24]="Default";var Gt="contextMenuClick",Zt="contextMenuOpen",Kt="contextMenuBeforeItemRender",qt=((t=Z.ControlPointsVisibility||(Z.ControlPointsVisibility={}))[t.None=1]="None",t[t.Source=2]="Source",t[t.Target=4]="Target",t[t.Intermediate=8]="Intermediate",t[t.All=14]="All",(t=Z.BezierSmoothness||(Z.BezierSmoothness={}))[t.None=0]="None",t[t.SymmetricAngle=2]="SymmetricAngle",t[t.SymmetricDistance=4]="SymmetricDistance",t[t.Default=6]="Default",Qt.prototype.setOffsetWithRespectToBounds=function(t,e,i){this.unitMode=i,this.position={x:t,y:e}},Qt.prototype.getAbsolutePosition=function(t){if(void 0!==this.position)return"Absolute"===this.unitMode?this.position:{x:this.position.x*t.width,y:this.position.y*t.height}},Object.defineProperty(Qt.prototype,"outerBounds",{get:function(){return this.floatingBounds||this.bounds},set:function(t){this.floatingBounds=t},enumerable:!0,configurable:!0}),Qt.prototype.measure=function(t,e,i){var n=void 0!==this.width?this.width:(t.width||0)-this.margin.left-this.margin.right,r=void 0!==this.height?this.height:(t.height||0)-this.margin.top-this.margin.bottom;return this.id&&0===r&&this.elementActions&Z.ElementAction.HorizontalLaneHeader&&(r=this.actualSize.height),this.desiredSize=new j(n,r),this.isCalculateDesiredSize&&(this.desiredSize=this.validateDesiredSize(this.desiredSize,t)),this.desiredSize},Qt.prototype.arrange=function(t){return this.actualSize=t,this.updateBounds(),this.actualSize},Qt.prototype.updateBounds=function(){this.bounds=up(this)},Qt.prototype.validateDesiredSize=function(t,e){return!this.isRectElement||this.width||this.minWidth||this.maxWidth||(t.width=50),!this.isRectElement||this.height||this.minHeight||this.maxHeight||(t.height=50),(void 0===t||void 0!==this.width&&void 0!==this.height)&&((t=t||new j).width=void 0===this.width?(e.width||0)-this.margin.left-this.margin.right:this.width,t.height=void 0===this.height?(e.height||0)-this.margin.top-this.margin.bottom:this.height),void 0!==this.minWidth&&(t.width=Math.max(t.width,this.minWidth)),void 0!==this.minHeight&&(t.height=Math.max(t.height,this.minHeight)),void 0!==this.maxWidth&&0!==this.maxWidth&&(t.width=Math.min(t.width,this.maxWidth)),void 0!==this.maxHeight&&0!==this.maxHeight&&(t.height=Math.min(t.height,this.maxHeight)),t},Qt);function Qt(){this.pivot={x:.5,y:.5},this.isDirt=!0,this.isExport=!1,this.exportScaleValue={x:0,y:0},this.exportScaleOffset={x:0,y:0},this.canApplyStyle=!0,this.visible=!0,this.offsetX=0,this.offsetY=0,this.cornerRadius=0,this.minHeight=void 0,this.minWidth=void 0,this.maxWidth=void 0,this.maxHeight=void 0,this.width=void 0,this.height=void 0,this.rotateAngle=0,this.margin={left:0,right:0,top:0,bottom:0},this.connectionDirection="Auto",this.horizontalAlignment="Auto",this.verticalAlignment="Auto",this.flip=Z.FlipDirection.None,this.flipMode="All",this.relativeMode="Point",this.transform=Z.Transform.Self|Z.Transform.Parent,this.style={fill:"white",strokeColor:"black",opacity:1,strokeWidth:1},this.desiredSize=new j,this.actualSize=new j,this.parentTransform=0,this.preventContainer=!1,this.isSvgRender=!1,this.bounds=new k(0,0,0,0),this.shadow=null,this.description="",this.staticSize=!1,this.shapeType="",this.isRectElement=!1,this.isCalculateDesiredSize=!0,this.flipOffset={x:0,y:0},this.elementActions=Z.ElementAction.None,this.inversedAlignment=!0,this.position=void 0,this.unitMode=void 0,this.float=!1,this.floatingBounds=void 0}Jt=function(t,e){return(Jt=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)};(function(t,e){function i(){this.constructor=t}Jt(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)})(ee,$t=qt),ee.prototype.hasChildren=function(){return void 0!==this.children&&0<this.children.length},ee.prototype.measure=function(t,e,i){var n,r=this.desiredBounds=void 0;if(this.hasChildren()){for(var o,a=0;a<this.children.length;a++){"Stretch"!==(n=this.children[parseInt(a.toString(),10)]).horizontalAlignment||t.width||(t.width=n.bounds.width),"Stretch"!==n.verticalAlignment||t.height||(t.height=n.bounds.height);var s="Stretch"===n.horizontalAlignment||"Stretch"===n.verticalAlignment;(this.measureChildren||s||n instanceof ee&&void 0!==n.measureChildren)&&n.measure(t,e,i),s=this.GetChildrenBounds(n),"Stretch"!==n.horizontalAlignment&&"Stretch"!==n.verticalAlignment?void 0===this.desiredBounds?this.desiredBounds=s:this.desiredBounds.uniteRect(s):!this.actualSize||this.actualSize.width||this.actualSize.height||n.preventContainer||"Stretch"!==n.horizontalAlignment||"Stretch"!==n.verticalAlignment||(void 0===this.desiredBounds?this.desiredBounds=n.bounds:this.desiredBounds.uniteRect(n.bounds))}void 0!==this.desiredBounds&&0!==this.rotateAngle&&(o={x:this.desiredBounds.x+this.desiredBounds.width*this.pivot.x,y:this.desiredBounds.y+this.desiredBounds.height*this.pivot.y},o=Ap(this.rotateAngle,void 0,void 0,o),this.desiredBounds.x=o.x-this.desiredBounds.width*this.pivot.x,this.desiredBounds.y=o.y-this.desiredBounds.height*this.pivot.y),void 0!==this.desiredBounds&&(this.desiredBounds.width+=this.padding.left+this.padding.right,this.desiredBounds.height+=this.padding.top+this.padding.bottom,this.desiredBounds.x-=this.padding.left,this.desiredBounds.y-=this.padding.top),this.desiredBounds&&(r=new j(this.desiredBounds.width,this.desiredBounds.height))}return r=this.validateDesiredSize(r,t),this.stretchChildren(r),this.desiredSize=r},ee.prototype.arrange=function(t){var e=this.desiredBounds;if(e){this.offsetX,this.offsetY;if(this.offsetX=e.x+e.width*this.pivot.x,this.offsetY=e.y+e.height*this.pivot.y,this.hasChildren())for(var i=0;i<this.children.length;i++){var n,r=!1;"Stretch"===(n=this.children[parseInt(i.toString(),10)]).horizontalAlignment&&(n.offsetX=this.offsetX,n.parentTransform=this.parentTransform+this.rotateAngle,this.flip&&this.elementActions&Z.ElementAction.ElementIsGroup&&(n.parentTransform=this.flip===Z.FlipDirection.Horizontal||this.flip===Z.FlipDirection.Vertical?-n.parentTransform:n.parentTransform),r=!0),"Stretch"===n.verticalAlignment&&(n.offsetY=this.offsetY,n.parentTransform=this.parentTransform+this.rotateAngle,r=!0),(r||this.measureChildren||n instanceof ee&&void 0!==n.measureChildren)&&n.arrange(n.desiredSize),0===i?(r=n.outerBounds,this.outerBounds=new k(r.x,r.y,r.width,r.height)):this.outerBounds.uniteRect(n.outerBounds)}}return this.actualSize=t,this.updateBounds(),this.prevRotateAngle=this.rotateAngle,t},ee.prototype.stretchChildren=function(t){if(this.hasChildren())for(var e=0,i=this.children;e<i.length;e++){var n=i[e];"Stretch"!==n.horizontalAlignment&&void 0!==n.desiredSize.width||(n.desiredSize.width=t.width-n.margin.left-n.margin.right),"Stretch"!==n.verticalAlignment&&void 0!==n.desiredSize.height||(n.desiredSize.height=t.height-n.margin.top-n.margin.bottom),n instanceof ee&&n.stretchChildren(n.desiredSize)}},ee.prototype.applyPadding=function(t){t.width+=this.padding.left+this.padding.right,t.height+=this.padding.top+this.padding.bottom},ee.prototype.findChildOffsetFromCenter=function(t,e){var i=Tp({x:e.x-t.desiredSize.width/2,y:e.y-t.desiredSize.height/2},t),i=Ap(t.rotateAngle,e.x,e.y,i);i=Ap(this.rotateAngle+this.parentTransform,this.offsetX,this.offsetY,i),t.offsetX=i.x,t.offsetY=i.y},ee.prototype.GetChildrenBounds=function(t){var e=t.desiredSize.clone(),i=(t.rotateAngle,this.rotateAngle,t.offsetX),n=t.offsetY,i=i-e.width*t.pivot.x,n=n-e.height*t.pivot.y,r=i+e.width,e=n+e.height,o={x:i,y:n},n={x:r,y:n},i={x:i,y:e},r={x:r,y:e},o=Ap(t.rotateAngle,t.offsetX,t.offsetY,o),n=Ap(t.rotateAngle,t.offsetX,t.offsetY,n),i=Ap(t.rotateAngle,t.offsetX,t.offsetY,i),r=Ap(t.rotateAngle,t.offsetX,t.offsetY,r);return 0!==this.rotateAngle&&(o=Ap(-this.rotateAngle,void 0,void 0,o),n=Ap(-this.rotateAngle,void 0,void 0,n),i=Ap(-this.rotateAngle,void 0,void 0,i),r=Ap(-this.rotateAngle,void 0,void 0,r)),k.toBounds([o,n,i,r])};var Jt,$t,te=ee;function ee(){var t=null!==$t&&$t.apply(this,arguments)||this;return t.padding=new mt(0,0,0,0),t.desiredBounds=void 0,t.measureChildren=!0,t.prevRotateAngle=0,t}ie=function(t,e){return(ie=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)};(function(t,e){function i(){this.constructor=t}ie(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)})(re,ne=qt),Object.defineProperty(re.prototype,"content",{get:function(){return this.textContent},set:function(t){this.textContent!==t&&(this.textContent=t,this.isDirt=!0,this.doWrap=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(re.prototype,"childNodes",{get:function(){return this.textNodes},set:function(t){this.textNodes=t},enumerable:!0,configurable:!0}),Object.defineProperty(re.prototype,"wrapBounds",{get:function(){return this.textWrapBounds},set:function(t){this.textWrapBounds=t},enumerable:!0,configurable:!0}),re.prototype.refreshTextElement=function(){this.isDirt=!0},re.prototype.measure=function(t){var e=this.isDirt&&this.canMeasure?function(t,e,i){var n,r=new j(0,0),o=function(t,e){e={fill:t.style.fill,stroke:t.style.strokeColor,angle:t.rotateAngle+t.parentTransform,pivotX:t.pivot.x,pivotY:t.pivot.y,strokeWidth:t.style.strokeWidth,dashArray:t.style.strokeDashArray,opacity:t.style.opacity,shadow:t.shadow,gradient:t.style.gradient,visible:t.visible,id:t.id,description:t.description,width:e||t.actualSize.width,height:t.actualSize.height,x:t.offsetX-t.actualSize.width*t.pivot.x+.5,y:t.offsetY-t.actualSize.height*t.pivot.y+.5};return e.fontSize=t.style.fontSize,e.fontFamily=t.style.fontFamily,e.textOverflow=t.style.textOverflow,e.textDecoration=t.style.textDecoration,e.doWrap=t.doWrap,e.whiteSpace=Cp(t.style.whiteSpace,t.style.textWrapping),e.content=t.content,e.textWrapping=t.style.textWrapping,e.breakWord=Sp(t.style.textWrapping),e.textAlign=bp(t.style.textAlign),e.color=t.style.color,e.italic=t.style.italic,e.bold=t.style.bold,e.dashArray="",e.strokeWidth=0,e.fill="",e}(t,e);t.childNodes=i=function(t,e,i){var n,r=[],o=0,a=e||t.content;if("nowrap"!==t.whiteSpace&&"pre"!==t.whiteSpace)if("breakall"===t.breakWord)for(n="",n+=a[0],o=0;o<a.length;o++){var s;(s=wp(n,t))>=t.width&&0<n.length?(r[r.length]={text:n,x:0,dy:0,width:s},n=""):(-1<(n+=a[o+1]||"").indexOf("\n")&&(r[r.length]={text:n,x:0,dy:0,width:wp(n,t)},n=""),s=wp(n,t),Math.ceil(s)+2>=t.width&&0<n.length&&(r[r.length]={text:n,x:0,dy:0,width:s},n=""),o===a.length-1&&0<n.length&&(r[r.length]={text:n,x:0,dy:0,width:s},n=""))}else r=function(t,e,i){var n,r,o,a,s=[],h="",d=0,l=0,c="nowrap"!==t.whiteSpace,p=(e||t.content).split("\n");for(d=0;d<p.length;d++)for(n="NoWrap"!==t.textWrapping?p[parseInt(d.toString(),10)].split(" "):"NoWrap"===t.textWrapping?[p[parseInt(d.toString(),10)]]:p,l=0;l<n.length;l++){h+=((0!==l||1===n.length)&&c&&0<h.length?" ":"")+n[parseInt(l.toString(),10)];var g=wp(r=n[l+1]?h+" "+n[l+1]:h,t);Math.floor(g)>(i||t.width)-2&&0<h.length?(s[s.length]={text:h,x:0,dy:0,width:r===h?g:h===a?o:wp(h,t)},h=""):l===n.length-1&&(s[s.length]={text:h,x:0,dy:0,width:g},h=""),a=r,o=g}return s}(t,e,i);else r[r.length]={text:a,x:0,dy:0,width:wp(a,t)};return r}(o,i,t.isLaneOrientation?e:void 0),t.wrapBounds=n=function(t,e){var i,n,r={x:0,width:0},o=0;for(o=0;o<e.length;o++)i=e[parseInt(o.toString(),10)].width,n=i,i="left"===t.textAlign||"justify"===t.textAlign?0:"center"===t.textAlign?i>t.width&&("Ellipsis"===t.textOverflow||"Clip"===t.textOverflow)?0:-i/2:"right"===t.textAlign?-i:1<e.length?0:-i/2,e[parseInt(o.toString(),10)].dy=1.2*t.fontSize,e[parseInt(o.toString(),10)].x=i,r.x=Math.min(r.x,i),r.width=Math.max(r.width,n);return r}(o,i),r.width=n.width,t.wrapBounds.width>=e&&"Wrap"!==o.textOverflow&&(r.width=e);return r.height=i.length*t.style.fontSize*1.2,r}(this,(this.style,this.content,this.isLaneOrientation?t.height:this.width||t.width)):this.desiredSize;return void 0===this.width||void 0===this.height?this.desiredSize=new j(e.width,e.height):this.desiredSize=new j(this.width,this.height),this.desiredSize=this.validateDesiredSize(this.desiredSize,t),this.desiredSize},re.prototype.arrange=function(t){return t.width===this.actualSize.width&&t.height===this.actualSize.height&&!this.isDirt||(this.doWrap=!0),this.actualSize=t,this.updateBounds(),this.isDirt=!1,this.actualSize};var ie,ne,H=re;function re(){var t=ne.call(this)||this;return t.textContent="",t.canMeasure=!0,t.rotationReference="Parent",t.isLaneOrientation=!1,t.canConsiderBounds=!0,t.annotationVisibility="Visible",t.hyperlink={color:"blue"},t.doWrap=!0,t.textNodes=[],t.style={color:"black",fill:"transparent",strokeColor:"black",strokeWidth:1,fontFamily:"Arial",fontSize:12,whiteSpace:"CollapseSpace",textWrapping:"WrapWithOverflow",textAlign:"Center",italic:!1,bold:!1,textDecoration:"None",strokeDashArray:"",opacity:5,gradient:null,textOverflow:"Wrap"},t.style.fill="transparent",t.style.strokeColor="transparent",t}oe=function(t,e){return(oe=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)};(function(t,e){function i(){this.constructor=t}oe(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)})(se,ae=qt),Object.defineProperty(se.prototype,"data",{get:function(){return this.pathData},set:function(t){this.pathData!==t&&(this.pathData=t,this.isDirt=!0)},enumerable:!0,configurable:!0}),se.prototype.getPoints=function(){for(var t=this,e=(this.pointTimer||(this.pointTimer=setTimeout(function(){t.points=null,t.pointTimer=null},200)),this.points=this.points||function(t){var e,i,n=[],r="measureElement";window[r].style.visibility="visible";var o=jc(window[r].children[2])[0],a=(o.setAttributeNS(null,"d",t.data),t.absoluteBounds),t=_c(t,a),s=(o.setAttributeNS(null,"d",t),o.getTotalLength()),a=ru.prototype.getPathData(t);if(0===a.length){for(i=0;i<=s;i+=10)e=o.getPointAtLength(i),n.push({x:e.x,y:e.y});ru.prototype.setPathData(t,n)}else n=a;return window[r].style.visibility="hidden",n}(this),this),i=this.points,n=[],r=e.offsetX-e.actualSize.width*e.pivot.x,o=e.offsetY-e.actualSize.height*e.pivot.y,a=0,s=i;a<s.length;a++){var h=s[a],d=void 0,l=r+h.x,c=o+h.y,p=r+e.actualSize.width-h.x,g=o+e.actualSize.height-h.y;switch(e.flip){case Z.FlipDirection.Both:d={x:p,y:g};break;case Z.FlipDirection.Horizontal:d={x:p,y:c};break;case Z.FlipDirection.Vertical:d={x:l,y:g};break;default:d={x:l,y:c}}var h=void 0,u=e.rotateAngle+e.parentTransform;u&&at(h=rt(),u,e.offsetX,e.offsetY),h&&(d=z(h,d)),n.push(d)}return n},se.prototype.measure=function(t){return this.staticSize&&void 0!==this.width&&void 0!==this.height?this.absoluteBounds=new k(this.offsetX-this.width*this.pivot.x,this.offsetY-this.height*this.pivot.y,this.width,this.height):(!this.isDirt||!this.transformPath&&void 0!==this.width&&void 0!==this.height||this.absoluteBounds&&0!==this.absoluteBounds.height)&&!this.canMeasurePath||(this.absoluteBounds=Hc(this.data||"")),void 0===this.width?this.desiredSize=new j(this.absoluteBounds.width,this.height||this.absoluteBounds.height):void 0===this.height?this.desiredSize=new j(this.width||this.absoluteBounds.width,this.absoluteBounds.height):this.desiredSize=new j(this.width,this.height),this.desiredSize=this.validateDesiredSize(this.desiredSize,t),this.canMeasurePath=!1,this.desiredSize},se.prototype.arrange=function(t){return!this.isDirt&&this.actualSize.width===t.width&&this.actualSize.height===t.height||(this.isDirt=!0,this.absolutePath=this.updatePath(this.data,this.absoluteBounds,t),this.staticSize)||(this.points=null),this.actualSize=this.desiredSize,this.updateBounds(),this.isDirt=!1,this.actualSize},se.prototype.updatePath=function(t,e,i){var n=!1,r="",o=-e.x,a=-e.y;return i.width===e.width&&i.height===e.height||(o=i.width/Number(e.width||1),a=i.height/Number(e.height||1),n=!0),i=$(D(t)),r=(n||this.isDirt)&&this.transformPath?V(i,o,a,n,e.x,e.y,0,0):tt(i),n=!1,r};var oe,ae,P=se;function se(){var t=ae.call(this)||this;return t.pathData="",t.transformPath=!0,t.absolutePath="",t.canMeasurePath=!1,t.absoluteBounds=new k,t}he=function(t,e){return(he=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)};(function(t,e){function i(){this.constructor=t}he(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)})(ce,de=qt),Object.defineProperty(ce.prototype,"source",{get:function(){return this.imageSource},set:function(t){this.imageSource=t,this.isDirt=!0},enumerable:!0,configurable:!0}),ce.prototype.measure=function(t,e,i){var n,r,o,a,s;return this.isDirt&&("Stretch"!==this.stretch||void 0===this.width&&void 0===this.height)&&(this.contentSize=(n=this.source,r=this.contentSize,o=e,a=i,e="measureElement",window[e].style.visibility="visible",(i=window[e].children[1]).setAttribute("src",n),i=i.getBoundingClientRect(),s=i.width,i=i.height,r=new j(s,i),window[e].style.visibility="hidden",(s=document.createElement("img")).setAttribute("src",n),hp(s,{id:o+"sf-imageNode"}),s.style.display="none",document.body.appendChild(s),s.onload=function(t){t=t.currentTarget;a&&a(o,{width:t.width,height:t.height})},r),this.isDirt=!1),void 0!==this.width&&void 0!==this.height?(this.desiredSize=new j(this.width,this.height),this.contentSize=this.desiredSize):this.desiredSize=this.contentSize,this.desiredSize=this.validateDesiredSize(this.desiredSize,t),this.desiredSize},ce.prototype.arrange=function(t){return this.actualSize=new j(this.desiredSize.width,this.desiredSize.height),this.updateBounds(),this.actualSize};var he,de,le=ce;function ce(){var t=de.call(this)||this;return t.imageSource="",t.imageScale="None",t.imageAlign="None",t.stretch="Stretch",t}pe=function(t,e){return(pe=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)};(function(t,e){function i(){this.constructor=t}pe(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)})(ue,ge=te),ue.prototype.measure=function(t,e,i){var n=void 0,r=void 0;if(this.hasChildren()){for(var o,a,s=0,h=this.children;s<h.length;s++){var d=h[s],l=(d instanceof H?d.canMeasure&&(t.width=t.width||this.maxWidth||this.minWidth,d.measure(t)):d instanceof H||d.measure(t,e,i),d.desiredSize.clone()),c=(l=0!==d.rotateAngle?Pp(l,d.rotateAngle):l).width+d.margin.right,p=l.height+d.margin.bottom,c=new k(d.margin.left,d.margin.top,c,p);if(d.float)if(void 0!==d.getAbsolutePosition(l))continue;d instanceof H&&!(d instanceof H&&d.canConsiderBounds)||(void 0===r?r=c:r.uniteRect(c))}r&&(a=o=0,o=Math.max(r.left,0),a=Math.max(r.top,0),n=new j(r.width+o,r.height+a))}return n=ge.prototype.validateDesiredSize.call(this,n,t),ge.prototype.stretchChildren.call(this,n),n.width+=this.padding.left+this.padding.right,n.height+=this.padding.top+this.padding.bottom,this.desiredSize=n},ue.prototype.arrange=function(t,e){if(this.outerBounds=new k,this.hasChildren())for(var i=this.offsetY-t.height*this.pivot.y+this.padding.top,n=this.offsetX-t.width*this.pivot.x+this.padding.left,r=0,o=this.children;r<o.length;r++){var a,s,h,d,l,c,p=o[r];0!=(p.transform&Z.Transform.Parent)&&(p.parentTransform=this.parentTransform+this.rotateAngle,!(this.flip!==Z.FlipDirection.None||this.elementActions&Z.ElementAction.ElementIsGroup)||this.flip!==Z.FlipDirection.Horizontal&&this.flip!==Z.FlipDirection.Vertical||p.elementActions&Z.ElementAction.ElementIsPort||this.setParentTransform(p),a=p.desiredSize.clone(),s=void 0,h={x:0,y:0},d=n,l=i,"Point"===p.relativeMode&&void 0!==(c=p.getAbsolutePosition(t))&&(d+=c.x,l+=c.y),"Object"===p.relativeMode?(s=this.alignChildBasedOnParent(p,a,t,d,l),p.flip=this.flip):s=this.alignChildBasedOnaPoint(p,d,l),h={x:s.x+a.width/2,y:s.y+a.height/2},ge.prototype.findChildOffsetFromCenter.call(this,p,h)),!e||"Stretch"!==p.horizontalAlignment&&"Stretch"!==p.verticalAlignment?!(p instanceof H&&p.canMeasure)&&p instanceof H||(p.arrange(p.desiredSize),this.outerBounds.uniteRect(p.outerBounds)):p.arrange(t)}return this.actualSize=t,this.updateBounds(),this.outerBounds.uniteRect(this.bounds),t},ue.prototype.setParentTransform=function(t){"All"===this.flipMode||t instanceof le||!(t instanceof le||t instanceof H||t instanceof P)&&t instanceof qt?0<t.parentTransform&&(t.parentTransform=-t.parentTransform):t instanceof H&&void 0===t.position?t.parentTransform=-t.parentTransform:"None"===this.flipMode?!(t.elementActions&Z.ElementAction.ElementIsPort)&&t instanceof P&&0<t.parentTransform&&(t.parentTransform=-t.parentTransform):t instanceof P?0<t.parentTransform&&(t.parentTransform=-t.parentTransform):"LabelText"!==this.flipMode&&"LabelAndLabelText"!==this.flipMode&&"PortAndLabelText"!==this.flipMode||t instanceof H&&0<t.parentTransform&&(t.parentTransform=-t.parentTransform)},ue.prototype.alignChildBasedOnParent=function(t,e,i,n,r){switch(t.horizontalAlignment){case"Auto":case"Left":n+=t.margin.left;break;case"Right":n+=i.width-e.width-t.margin.right;break;case"Stretch":case"Center":n+=i.width/2-e.width/2}switch(t.verticalAlignment){case"Auto":case"Top":r+=t.margin.top;break;case"Bottom":r+=i.height-e.height-t.margin.bottom;break;case"Stretch":case"Center":r+=i.height/2-e.height/2}return{x:n,y:r}},ue.prototype.alignChildBasedOnaPoint=function(t,e,i){switch(e+=t.margin.left-t.margin.right,i+=t.margin.top-t.margin.bottom,t.horizontalAlignment){case"Auto":case"Left":e=t.inversedAlignment?e:e-t.desiredSize.width;break;case"Stretch":case"Center":e-=t.desiredSize.width*t.pivot.x;break;case"Right":e=t.inversedAlignment?e-t.desiredSize.width:e}switch(t.verticalAlignment){case"Auto":case"Top":i=t.inversedAlignment?i:i-t.desiredSize.height;break;case"Stretch":case"Center":i-=t.desiredSize.height*t.pivot.y;break;case"Bottom":i=t.inversedAlignment?i-t.desiredSize.height:i}return{x:e,y:i}};var pe,ge,F=ue;function ue(){var t=null!==ge&&ge.apply(this,arguments)||this;return t.measureChildren=void 0,t}function me(t){return fe[t.toString()]}var fe={Rectangle:"M0,0 L50,0 L50,50 L0,50 z",Ellipse:"M80.5,12.5 C80.5,19.127417 62.59139,24.5 40.5,24.5 C18.40861,24.5 0.5,19.127417 0.5,12.5C0.5,5.872583 18.40861,0.5 40.5,0.5 C62.59139,0.5 80.5,5.872583 80.5,12.5 z",Hexagon:"M30,0 L60,0 L90,30 L60,60 L30,60 L0,30 L30,0 z",Parallelogram:"M30,0 L60,0 L45,30 L15,30 z",Triangle:"M45,0 L90,45 L0,45 L45,0 z",Plus:"M696.6084,158.2656 L674.8074,158.2656 L674.8074,136.4656 L658.4084,136.4656 L658.4084,158.2656 L636.6084,158.2656L636.6084,174.6646 L658.4084,174.6646 L658.4084,196.4656 L674.8074,196.4656 L674.8074,174.6646 L696.6084,174.6646L696.6084,158.2656 z",Star:"M540.3643,137.9336 L546.7973,159.7016 L570.3633,159.7296 L550.7723,171.9366 L558.9053,194.9966 L540.3643,179.4996L521.8223,194.9966 L529.9553,171.9366 L510.3633,159.7296 L533.9313,159.7016 L540.3643,137.9336 z",Pentagon:"M30,0 L60,30 L50,70 L10,70 L0,30 L30,0 z",Heptagon:"M223.7783,195.7134 L207.1303,174.8364 L213.0713,148.8034 L237.1303,137.2174 L261.1883,148.8034 L267.1303,174.8364L250.4813,195.7134 L223.7783,195.7134 z",Octagon:"M98.7319,196.4653 L81.1579,178.8923 L81.1579,154.0393 L98.7319,136.4653 L123.5849,136.4653L141.1579,154.0393 L141.1579,178.8923 L123.5849,196.4653 L98.7319,196.4653 z",Trapezoid:"M127.2842,291.4492 L95.0322,291.4492 L81.1582,256.3152 L141.1582,256.3152 L127.2842,291.4492 z",Decagon:"M657.3379,302.4141 L642.3369,291.5161 L636.6089,273.8821 L642.3369,256.2481 L657.3379,245.3511 L675.8789,245.3511L690.8789,256.2481 L696.6089,273.8821L690.8789,291.5161 L675.8789,302.4141 L657.3379,302.4141 z",RightTriangle:"M836.293,292.9238 L776.293,292.9238 L776.293,254.8408 L836.293,292.9238 z",Cylinder:"M 542.802,362.009C 542.802,368.452 525.341,373.676 503.802,373.676C 482.263,373.676 464.802,368.452 464.802,362.009L 464.802,466.484C 464.802,472.928 482.263,478.151 503.802,478.151C 525.341,478.151 542.802,472.928 542.802,466.484L 542.802,362.016C 542.802,368.459 525.341,373.534 503.802,373.534C 482.263,373.534 464.802,368.31 464.802,361.867L 464.802,362.016C 464.802,355.572 482.263,350.349 503.802,350.349C 525.341,350.349 542.802,355.572 542.802,362.016",Diamond:"M397.784,287.875 L369.5,316.159 L341.216,287.875 L369.5,259.591 L397.784,287.875 z"};ye=function(t,e){return(ye=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)};(function(t,e){function i(){this.constructor=t}ye(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)})(Se,ve=qt),Object.defineProperty(Se.prototype,"content",{get:function(){return this.data},set:function(t){this.data=t,this.canReset||(this.canReset=!0,this.template=op(this,!1),this.canReset=!1,this.isDirt=!0)},enumerable:!0,configurable:!0}),Se.prototype.measure=function(t){var e,i,n,r,o,a;return this.isDirt&&(n=this.template,r="measureElement",window[r].style.visibility="visible",(e=window[r].children[2]).appendChild(n),a=n.getBoundingClientRect(),i=e.getBoundingClientRect(),(o=a).x=a.left-i.left,o.y=a.top-i.top,e.removeChild(n),window[r].style.visibility="hidden",a=o,this.contentSize=new j,this.contentSize.width=a.width,this.contentSize.height=a.height,i=a.x,e=a.y,this.templatePosition={x:i,y:e},this.isDirt=!1),void 0===this.width||void 0===this.height?(n=this.template,r="measureElement",window[r].style.visibility="visible",(o=window[r].children[2]).appendChild(n),a=o.getBoundingClientRect(),o.removeChild(n),window[r].style.visibility="hidden",this.desiredSize=new j(a.width,a.height)):this.desiredSize=new j(this.width,this.height),this.desiredSize=this.validateDesiredSize(this.desiredSize,t),this.desiredSize},Se.prototype.arrange=function(t){return this.actualSize=new j(this.desiredSize.width,this.desiredSize.height),this.updateBounds(),this.actualSize};var ye,ve,be=Se;function Se(t,e){var i=ve.call(this)||this;return i.data="",i.nodeId="",i.diagramId="",i.scale="Stretch",i.diagramId=e,i.nodeId=t,i}we=function(t,e){return(we=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)};var we,xe,t=function(t,e){function i(){this.constructor=t}we(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Ie=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;0<=s;s--)(r=t[s])&&(a=(o<3?r(a):3<o?r(e,i,a):r(e,i))||a);return 3<o&&a&&Object.defineProperty(e,i,a),a},t=(xe=N.ChildProperty,t(Ce,xe),Ie([N.Property("")],Ce.prototype,"content",void 0),Ie([N.Property("TopLeft")],Ce.prototype,"position",void 0),Ie([N.Property("Mouse")],Ce.prototype,"relativeMode",void 0),Ie([N.Property(!0)],Ce.prototype,"showTipPointer",void 0),Ie([N.Property("auto")],Ce.prototype,"width",void 0),Ie([N.Property("auto")],Ce.prototype,"height",void 0),Ie([N.Property("Auto")],Ce.prototype,"openOn",void 0),Ie([N.Property()],Ce.prototype,"animation",void 0),Ie([N.Property(!1)],Ce.prototype,"isSticky",void 0),Ce);function Ce(){return null!==xe&&xe.apply(this,arguments)||this}function Pe(t){var e=new v.Tooltip,e=Oe(t.tooltip,e),e=new v.Tooltip(e);return e.beforeCollision=Te,e.beforeOpen=Ae,e.cssClass="e-diagram-tooltip",e.opensOn="custom",e.appendTo("#"+t.element.id),e.close(),e}function Ae(t){""!==this.content&&void 0!==this.content||(t.element.style.display="none")}function Te(t){t.collidedPosition&&t.collidedPosition!==this.position&&(t.element.style.display="none")}function De(t,e){var i=t.tooltipObject;return Oe((e||t).tooltip,i),i}function Oe(t,e){return t.content?(e.content=t.content,"string"==typeof t.content&&(e.content=N.initializeCSPTemplate(function(){return t.content})),e.position=t.position,e.showTipPointer=t.showTipPointer,e.width=t.width,e.height=t.height,t.animation?e.animation=t.animation:e.animation={close:{effect:"None"}}):e.close(),e}Me=function(t,e){return(Me=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)};var Me,Ee,Ie=function(t,e){function i(){this.constructor=t}Me(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},e=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;0<=s;s--)(r=t[s])&&(a=(o<3?r(a):3<o?r(e,i,a):r(e,i))||a);return 3<o&&a&&Object.defineProperty(e,i,a),a},Le=(Ee=N.ChildProperty,Ie(ze,Ee),e([N.Property("")],ze.prototype,"id",void 0),e([N.Property("Center")],ze.prototype,"horizontalAlignment",void 0),e([N.Property("Center")],ze.prototype,"verticalAlignment",void 0),e([N.Complex({},ft)],ze.prototype,"margin",void 0),e([N.Property(12)],ze.prototype,"width",void 0),e([N.Property(12)],ze.prototype,"height",void 0),e([N.Complex({},Nt)],ze.prototype,"style",void 0),e([N.Property("Square")],ze.prototype,"shape",void 0),e([N.Property("Auto")],ze.prototype,"connectionDirection",void 0),e([N.Property(Z.PortVisibility.Connect)],ze.prototype,"visibility",void 0),e([N.Property("")],ze.prototype,"pathData",void 0),e([N.Property(Z.PortConstraints.Default)],ze.prototype,"constraints",void 0),e([N.Property()],ze.prototype,"addInfo",void 0),e([N.Property()],ze.prototype,"outEdges",void 0),e([N.Property()],ze.prototype,"inEdges",void 0),e([N.Complex({},t)],ze.prototype,"tooltip",void 0),ze);function ze(t,e,i,n){t=Ee.call(this,t,e,i,n)||this;return t.inEdges=[],t.outEdges=[],t}Ie(Re,ke=Le),Re.prototype.getClassName=function(){return"PointPort"},e([N.Complex({x:.5,y:.5},K)],Re.prototype,"offset",void 0);var ke,Be=Re;function Re(t,e,i,n){return ke.call(this,t,e,i,n)||this}Ie(He,Ne=Le),He.prototype.getClassName=function(){return"PathPort"},e([N.Property(.5)],He.prototype,"offset",void 0),e([N.Complex({x:0,y:0},K)],He.prototype,"displacement",void 0),e([N.Property("Center")],He.prototype,"alignment",void 0);var Ne,je=He;function He(t,e,i,n){return Ne.call(this,t,e,i,n)||this}We=function(t,e){return(We=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)};var We,_e,Ie=function(t,e){function i(){this.constructor=t}We(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},e=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;0<=s;s--)(r=t[s])&&(a=(o<3?r(a):3<o?r(e,i,a):r(e,i))||a);return 3<o&&a&&Object.defineProperty(e,i,a),a},Ye=(_e=N.ChildProperty,Ie(Xe,_e),e([N.Property("blue")],Xe.prototype,"color",void 0),e([N.Property("")],Xe.prototype,"content",void 0),e([N.Property("")],Xe.prototype,"link",void 0),e([N.Property("None")],Xe.prototype,"textDecoration",void 0),e([N.Property("NewTab")],Xe.prototype,"hyperlinkOpenState",void 0),Xe);function Xe(){return null!==_e&&_e.apply(this,arguments)||this}Ve=N.ChildProperty,Ie(Ue,Ve),e([N.Property("")],Ue.prototype,"content",void 0),e([N.Property(void 0)],Ue.prototype,"template",void 0),e([N.Property("String")],Ue.prototype,"annotationType",void 0),e([N.Property(!0)],Ue.prototype,"visibility",void 0),e([N.Property(Z.AnnotationConstraints.InheritReadOnly)],Ue.prototype,"constraints",void 0),e([N.Complex(void 0,Ye)],Ue.prototype,"hyperlink",void 0),e([N.Property("")],Ue.prototype,"id",void 0),e([N.Property()],Ue.prototype,"width",void 0),e([N.Property()],Ue.prototype,"height",void 0),e([N.Property(0)],Ue.prototype,"rotateAngle",void 0),e([N.Property("Parent")],Ue.prototype,"rotationReference",void 0),e([N.Complex({strokeWidth:0,strokeColor:"transparent",fill:"transparent"},Xt)],Ue.prototype,"style",void 0),e([N.Property("Center")],Ue.prototype,"horizontalAlignment",void 0),e([N.Property("Center")],Ue.prototype,"verticalAlignment",void 0),e([N.Complex({},ft)],Ue.prototype,"margin",void 0),e([N.Complex({top:void 0,bottom:void 0,left:void 0,right:void 0},ft)],Ue.prototype,"dragLimit",void 0),e([N.Property("Shape")],Ue.prototype,"type",void 0),e([N.Complex({},t)],Ue.prototype,"tooltip",void 0),e([N.Property()],Ue.prototype,"addInfo",void 0);var Ve,Fe=Ue;function Ue(t,e,i,n){e=Ve.call(this,t,e,i,n)||this;return i.id||(t.parentObj&&t.parentObj.propName&&"phases"===t.parentObj.propName?e.id=t.parentObj.id:e.id=q()),e}Ie(Ke,Ge=Fe),Ke.prototype.getClassName=function(){return"ShapeAnnotation"},e([N.Complex({x:.5,y:.5},K)],Ke.prototype,"offset",void 0);var Ge,Ze=Ke;function Ke(t,e,i,n){return Ge.call(this,t,e,i,n)||this}Ie(Je,qe=Fe),Je.prototype.getClassName=function(){return"PathAnnotation"},e([N.Property(.5)],Je.prototype,"offset",void 0),e([N.Complex({x:0,y:0},K)],Je.prototype,"displacement",void 0),e([N.Property("Center")],Je.prototype,"alignment",void 0),e([N.Property(!1)],Je.prototype,"segmentAngle",void 0);var qe,Qe=Je;function Je(t,e,i,n){return qe.call(this,t,e,i,n)||this}function $e(t){return ri[t.toString()]}function ti(t,e){return"Custom"===t?e.pathData:oi[""+t]}function ei(t){return ai[""+t]}function ii(t){return si[""+t]}function ni(t){var e;switch(t.shape){case"Minus":e="M0,50 L100,50";break;case"Plus":e="M0,-50 L0,50 M-50,0 L50,0";break;case"ArrowUp":e="M0,100 L50,0 L100,100 Z";break;case"ArrowDown":e="M0,0 L50,100 L100,0 Z";break;case"Path":e=t.pathData}return e}var ri={X:"M14,14 L106,106 M106,14 L14,106",Circle:"M0,50 A50,50,0 1 1 100,50 A50,50,0 1 1 0,50 Z",Square:"M0,0 L10,0 L10,10 L0,10 z"},oi={OpenArrow:"M15.9,23 L5,16 L15.9,9 L17,10.7 L8.7,16 L17,21.3Z",Square:"M0,0 L10,0 L10,10 L0,10 z",Fletch:"M14.8,10c0,0-3.5,6,0.2,12c0,0-2.5-6-10.9-6C4.1,16,11.3,16,14.8,10z",OpenFetch:"M6,17c-0.6,0-1-0.4-1-1s0.4-1,1-1c10.9,0,11-5,11-5c0-0.6,0.4-1,1-1s1,0.4,1,1C19,10.3,18.9,17,6,17C6,17,6,17,6,17z M18,23c-0.5,0-1-0.4-1-1c0-0.2-0.3-5-11-5c-0.6,0-1-0.5-1-1s0.4-1,1-1c0,0,0,0,0,0c12.9,0,13,6.7,13,7    C19,22.6,18.6,23,18,23z",IndentedArrow:"M17,10c0,0-4.5,5.5,0,12L5,16L17,10z",OutdentedArrow:"M14.6,10c0,0,5.4,6,0,12L5,16L14.6,10z",DoubleArrow:"M19,10 L19,22 L13,16Z M12,10 L12,22 L6,16Z",Arrow:"M15,10 L15,22 L5,16Z",Diamond:"M12,23l-7-7l7-7l6.9,7L12,23z",Circle:"M0,50 A50,50,0 1 1 100,50 A50,50,0 1 1 0,50 Z"},ai={Square:"M0,0 L10,0 L10,10 L0,10 z",Rhombus:"M10,5 L5,10 L0,5 L5,0 L10,5 Z ",Rectangle:"M0,0 L15,0 L15,10 L0,10 z ",OpenArrow:"M15.9,23 L5,16 L15.9,9 L17,10.7 L8.7,16 L17,21.3Z",Fletch:"M9.82,0 C9.82,0,6.61,5,10,10 C10,10,7.71,5,0,5 C0,5,6.61,5,9.82,0 Z ",OpenFetch:"M0.71,5.71 C0.29,5.71,0,5.43,0,5 C0,4.57,0.29,4.29,0.71,4.29 C8.5,4.29,8.57,0.71,8.57,0.71 C8.57,0.29,8.86,0,9.29,0 C9.719999999999999,0,10,0.29,10,0.71 C10,0.93,9.93,5.71,0.71,5.71 C0.71,5.71,0.71,5.71,0.71,5.71 Z M9.29,10 C8.93,10,8.57,9.71,8.57,9.29 C8.57,9.14,8.36,5.71,0.71,5.71 C0.29,5.71,0,5.36,0,5 C0,4.64,0.29,4.29,0.71,4.29 C0.71,4.29,0.71,4.29,0.71,4.29 C9.93,4.29,10,9.07,10,9.29 C10,9.71,9.71,10,9.29,10 Z ",IndentedArrow:"M10,0 C10,0,6.25,4.58,10,10 L0,5 L10,0 Z ",OutdentedArrow:"M8,0 C8,0,12.5,5,8,10 L0,5 L8,0 Z ",DoubleArrow:"M19,10 L19,22 L13,16Z M12,10 L12,22 L6,16Z",Arrow:"M15,10 L15,22 L5,16Z",Diamond:"M10,5 L5,10 L0,5 L5,0 L10,5 Z  ",Circle:"M10,5 C10,7.76,7.76,10,5,10 C2.24,10,0,7.76,0,5 C0,2.24,2.24,0,5,0 C7.76,0,10,2.24,10,5 Z ",Ellipse:"M15,5 C15,7.76,11.64,10,7.5,10 C3.36,10,0,7.76,0,5 C0,2.24,3.36,0,7.5,0 C11.64,0,15,2.24,15,5 Z  "},si={Square:"M0,0 L10,0 L10,10 L0,10 z",Rhombus:"M10,5 L5,10 L0,5 L5,0 L10,5 Z ",Rectangle:"M0,0 L15,0 L15,10 L0,10 z",OpenArrow:"M23,15.9 L16,5 L9,15.9 L10.7,17 L16,8.7 L21,17.3Z",Fletch:"M9.82,0 C9.82,0,6.61,5,10,10 C10,10,7.71,5,0,5 C0,5,6.61,5,9.82,0 Z ",OpenFetch:"M0.71,5.71 C0.29,5.71,0,5.43,0,5 C0,4.57,0.29,4.29,0.71,4.29 C8.5,4.29,8.57,0.71,8.57,0.71 C8.57,0.29,8.86,0,9.29,0 C9.719999999999999,0,10,0.29,10,0.71 C10,0.93,9.93,5.71,0.71,5.71 C0.71,5.71,0.71,5.71,0.71,5.71 Z M9.29,10 C8.93,10,8.57,9.71,8.57,9.29 C8.57,9.14,8.36,5.71,0.71,5.71 C0.29,5.71,0,5.36,0,5 C0,4.64,0.29,4.29,0.71,4.29 C0.71,4.29,0.71,4.29,0.71,4.29 C9.93,4.29,10,9.07,10,9.29 C10,9.71,9.71,10,9.29,10 Z ",IndentedArrow:"M10,0 C10,0,6.25,4.58,10,10 L0,5 L10,0 Z ",OutdentedArrow:"M8,0 C8,0,12.5,5,8,10 L0,5 L8,0 Z ",DoubleArrow:"M10,19 L22,19 L16,13Z M10,12 L22,12 L16,6Z",Arrow:"M10,15 L22,15 L16,5Z",Diamond:"M10,5 L5,10 L0,5 L5,0 L10,5 Z ",Circle:"M10,5 C10,7.76,7.76,10,5,10 C2.24,10,0,7.76,0,5 C0,2.24,2.24,0,5,0 C7.76,0,10,2.24,10,5 Z ",Ellipse:"M15,5 C15,7.76,11.64,10,7.5,10 C3.36,10,0,7.76,0,5 C0,2.24,3.36,0,7.5,0 C11.64,0,15,2.24,15,5 Z   "};function hi(t){return di[t.toString()]}var di={Process:"M419.511,76.687L359.511,76.687L359.511,43.086L419.511,43.086z",Decision:"M 253.005,115.687L 200.567,146.071L 148.097,115.687L 200.534,85.304L 253.005,115.687 Z",Document:"M 60 31.9 c 0 0 -11 -7.7 -30 0 s -30 0 -30 0 V 0 h 60 V 31.9 Z",PreDefinedProcess:"M 0,0 L 50,0 L 50,50 L 0,50 Z  M 8.334,0 L 8.334,50 M 41.667,0 L 41.667,50",Terminator:"M 269.711,29.33C 269.71,44.061 257.77,56 243.04,56L 158.058,56C 143.33,56 131.39,44.061 131.39,29.33L 131.39,29.33C 131.391,14.6057 143.33,2.669 158.058,2.669L 243.044,2.669C 257.772,2.669 269.711,14.6057 269.711,29.333 Z",PaperTap:"M0.0009,17.2042 L0.0009,47.165 C0.001,47.165 14.403,53.5455 25.00,47.165 C35.599,40.7852 44.403,43.5087 50.00,47.165L50.001,17.2042 M50.001,32.7987 L50.001,2.8405 C50.001,2.8405 35.599,-3.5427 25.001,2.8405C14.403,9.2237 5.599,6.494 0.0009,2.8405 L0.0009,32.7987",DirectData:"M 132.62 0 L 17.38 0 C 7.78 0 0 13.43 0 30 C 0 46.57 7.78 60 17.38 60 L 132.62 60 M 132.62 0C 123.02 0 115.24 13.43 115.24 30 C 115.24 46.57 123.02 60 132.62 60 C 142.22 60 150 46.57 150 30 C 150 13.43 142.22 0 132.62 0 z ",SequentialData:"M0.0029,24.999 C0.0029,11.1922 10.433,0.0021 23.295,0.0021 C36.159,0.00216 46.585,11.1922 46.585,24.999C46.585,38.8057 36.159,49.9979 23.295,49.9979 C10.433,49.9979 0.0029,38.8057 0.0029,24.999 z M23.294,49.999 L50.002,49.999",Sort:"M50.001,24.9971 L25.001,49.9971 L0.00097,24.9971 L25.001,-0.00286865 L50.001,24.9971 z M0.000976562,24.9971 L50.001,24.9971",MultiDocument:"M43.6826,40 C44.8746,40.6183 45.8586,41.3502 46.8366,42.1122 L46.8366,4.74487 L3.09857,4.74487 L3.09857,10.9544 M46.837,35.143 C48.027,35.765 49.025,36.604 50.003,37.369 L50.003,0.002 L6.264,0.002 L6.264,4.744 M43.682,47.113 L43.682,10.765 L0.0025,10.7652 L0.0025,47.1132 C0.0025,47.1132 12.5846,53.6101 21.8426,47.1132 C31.1006,40.6163 38.792,43.393 43.6826,47.1132 z",Collate:"M50.001,0.0028 L25.001,25.0029 L0.00097,0.0028 L50.001,0.002 z M0.0009,50.002 L25.001,25.002L50.001,50.002 L0.0009,50.0029 z",SummingJunction:"M7.3252,42.6768 L42.6772,7.3247 M42.6768,42.6768 L7.3248,7.3247 M0.0009,25.001 C0.0009,11.193 11.197,0.0009 25.001,0.0009 C38.809,0.0009 50.001,11.193 50.001,25.001 C50.001,38.809 38.809,50.001 25.001,50.001 C11.197,50.00 0.0009,38.809 0.0009,25.00 z",Or:"M 0 50 L 100 50 M 50 100 L 50 0.0 M 0 50 C 0 22.384 22.392 0 50 0 C 77.616 0 100 22.384 100 50 C 100 77.616 77.616 100 50 100 C 22.392 100 0 77.616 0 50 Z",InternalStorage:"M 0 3.81946A 2.5,3.81946 0 0,1 2.5,0L 47.5 0A 2.5,3.81946 0 0,1 50,3.81946L 50 45.836A 2.5,3.819446 0 0,1 47.5,49.652778L 2.5 49.652778A 2.5,3.819446 0 0,1 0,45.8336L 0 3.819446ZM 0 11.45834L 50 11.4583334M 12.5 0L 12.5 49.652778",Extract:"M0,35 L30,0 L60,35 Z",ManualOperation:"M46.4,28.8 L14.8,28.8 L0,0 L60,0 Z",Merge:"M60,0 L30,35 L0,0 Z",OffPageReference:"M60,33.3 L30.1,39 L0,33.3 L0,0 L60,0 Z",SequentialAccessStorage:"M 60 30 C 60 13.4 46.6 0 30 0 S 0 13.4 0 30 s 13.4 30 30 30 h 28.6 v -6.5 h -9.9C 55.5 48 60 39.5 60 30 Z",Annotation:"M49.9984,50.0029 L-0.00271199,50.0029 L-0.00271199,0.00286865 L49.9984,0.00286865",Annotation2:"M49.9977,50.0029 L25.416,50.0029 L25.416,0.00286865 L49.9977,0.00286865 M25.4166,25.0029 L-0.00227869,25.0029",Data:"M 10 0 L 40 0 L 30 40 L 0 40 Z",Card:"M275,60 L400,60 L400,110 L260,110 L260,75 Z",Delay:"M0,0 L12.029,0 C14.212999,0 16,1.7869979 16,3.9709952 C16,6.1549926 14.212999,7.9409904 12.029,7.9409904 L0,7.9409904 z",Preparation:"M 1048.17 572 C 1051.06 568.86 1055.17 567.05 1059.5 567 L 1094.51 567 C 1098.84 567.05 1102.95 568.86 1105.84 572 L 1126.43 595 C 1127.01 596.28 1127.01 597.72 1126.43 599 L 1105.84 622 C 1102.95 625.14 1098.84 626.95 1094.51 627 L 1059.5 627 C 1055.17 626.95 1051.06 625.14 1048.17 622 L 1027.58 599 C 1027 597.72 1027 596.28 1027.58 595 L 1048.17 572 Z",Display:"M47.8809,19.2914 L32.7968,-0.00594145 L11.3902,-0.00594145 C7.93166,-0.00594145 0.00124586,11.187 0.00124586,24.9968C0.00124586,38.8032 7.93166,49.9962 11.3902,49.9962 L32.7968,49.99 L47.615,31.038 C47.615,31.0388 52.798,24.9968 47.880,19.2914 z",ManualInput:"M 912 732 L 1006.85 707 C 1008.2 707 1009.5 707.53 1010.46 708.46 C 1011.41 709.4 1011.95 710.67 1011.95 712 L 1011.95 762C 1012 764.41 1010.28 766.52 1007.87 767 L 917.1 767 C 915.75 767 914.45 766.47 913.49 765.54 C 912.54 764.6 912 763.33 912 762 L 912 732 Z",LoopLimit:"M 8 9 L 27 9 L 33 15 L 33 26 C 33 27 33 27 32 27 L 4 27 C 3 27 2 27 2 26 L 2 15 L 8 9 Z",StoredData:"M 5.55 0L 50 0A 1.5,30 0 0,1 50,0A 5.555,25 0 0,0 50,50A 1.5,30 0 0,1 50,50L 5.555 50A 5.55,25 0 0,1 5.555,0Z"};function li(t,e,i){var n="Straight"!==t.type&&t.sourceWrapper?t.sourceWrapper.corners.center:function(t){{var e,i;e=t.sourcePortWrapper?(e=t.sourcePortWrapper,e={x:e.offsetX,y:e.offsetY},e):t.sourceID&&t.sourceWrapper&&t.targetWrapper?(e=t.sourceWrapper.corners.center,i=t.targetWrapper.corners.center,Mi(t,t.sourceWrapper,e,i,!1)):t.sourcePoint}return e}(t),n=function(t,e,i,n,r){var o,a,s=t.sourceWrapper,h=t.targetWrapper,d=t.sourcePortWrapper,l=t.targetPortWrapper,c=[],p=Ti(t),e={corners:void 0,point:e,direction:void 0,margin:{left:5,right:5,bottom:5,top:5}},i={corners:void 0,point:i,direction:void 0,margin:{left:5,right:5,bottom:5,top:5}};void 0!==s&&void 0!==h&&(o=gp(s),a=gp(h),e.corners=s.corners,i.corners=h.corners);void 0!==d&&(u={x:d.offsetX,y:d.offsetY},"Left"===d.connectionDirection||"Top"===d.connectionDirection||"Bottom"===d.connectionDirection||"Right"===d.connectionDirection?e.direction=d.connectionDirection:e.direction=Vi(u,o,s.bounds));void 0!==l&&(u={x:l.offsetX,y:l.offsetY},"Left"===l.connectionDirection||"Right"===l.connectionDirection||"Bottom"===l.connectionDirection||"Top"===l.connectionDirection?i.direction=l.connectionDirection:i.direction=Vi(u,a,h.bounds));if("Bezier"===t.type&&!t.isBezierEditing&&0<t.segments.length)for(var g=t.segments.length-1;0<=g;)t.segments[parseInt(g.toString(),10)].isInternalSegment&&t.segments.pop(),g--;if(void 0!==s&&void 0!==h)return void 0!==e.direction&&void 0!==i.direction||(n?function(t,e,i){"LeftToRight"===i?(t.direction=t.direction||"Right",e.direction=e.direction||"Left"):"RightToLeft"===i?(t.direction=t.direction||"Left",e.direction=e.direction||"Right"):"TopToBottom"===i?(t.direction=t.direction||"Bottom",e.direction=e.direction||"Top"):"BottomToTop"===i&&(t.direction=t.direction||"Top",e.direction=e.direction||"Bottom")}(e,i,n):e.corners.top>i.corners.bottom&&Math.abs(e.corners.top-i.corners.bottom)>p?(e.direction=e.direction||"Top",i.direction=i.direction||"Bottom"):e.corners.bottom<i.corners.top&&Math.abs(e.corners.bottom-i.corners.top)>p?(e.direction=e.direction||"Bottom",i.direction=i.direction||"Top"):e.corners.right<i.corners.left&&Math.abs(e.corners.right-i.corners.left)>p||e.corners.right+p<i.corners.left||i.corners.right>=e.corners.left-p&&e.corners.left>i.corners.left?(e.direction=e.direction||"Right",i.direction=i.direction||"Left"):e.corners.left>i.corners.right&&Math.abs(e.corners.left-i.corners.right)>e.margin.left+e.margin.right||i.corners.right+p<e.corners.left||e.corners.right>=i.corners.left-p&&e.corners.left<i.corners.left?(e.direction=e.direction||"Left",i.direction=i.direction||"Right"):s.id!==h.id&&!o.equals(o,a)&&a.containsPoint(o.topCenter,e.margin.top)?(e.direction=e.direction||"Bottom",i.direction=i.direction||"Top"):(e.direction=e.direction||"Top",i.direction=i.direction||"Bottom")),function(t,e,i,n,r,o){var a,s=t.sourceWrapper,h=t.targetWrapper,d=t.sourcePortWrapper,l=t.targetPortWrapper,c=[],p=s.corners,g=h.corners,u=(g.center,{corners:p,point:n,direction:e,margin:{left:5,right:5,bottom:5,top:5}}),m={corners:g,point:r,direction:i,margin:{left:5,right:5,bottom:5,top:5}},n=vi(s,p,t.sourceWrapper.bounds),e=vi(h,g,t.targetWrapper.bounds),r=!1;t.sourceWrapper&&t.targetWrapper&&(r=function(t,e,i){for(var n=yi(t,i.sourcePadding),r=yi(e,i.targetPadding),o=0;o<n.length-1;o++)for(var a=n[parseInt(o.toString(),10)],s=0;s<r.length-1;s++){var h=r[parseInt(s.toString(),10)];if(lh(a,h).enabled)return!0}return!1}(t.sourceWrapper,t.targetWrapper,t));if(void 0!==d){switch(u.point={x:d.offsetX,y:d.offsetY},u.direction){case"Bottom":case"Top":u.point.y=u.point.y;break;case"Left":case"Right":u.point.x=u.point.x}t.sourcePadding&&!r&&(l&&(m.point={x:l.offsetX,y:l.offsetY}),u.point=fi(t,u,m,!1))}else"Orthogonal"===t.type||"Bezier"===t.type?(t.segments&&0<t.segments.length&&t.segments[0].direction&&(u.direction=t.segments[0].direction),u.point=Di(n,u.direction),a=Di(n,Ui(u.direction)),u.point=Mi(t,0,u.point,a,!1)):u.point=s.corners.center;if(void 0!==l){switch(m.point={x:l.offsetX,y:l.offsetY},m.direction){case"Bottom":case"Top":m.point.y=m.point.y;break;case"Left":case"Right":m.point.x=m.point.x}t.targetPadding&&!r&&(m.point=fi(t,u,m,!0))}else"Orthogonal"===t.type||"Bezier"===t.type?(m.point=Di(e,m.direction),a=Di(e,Ui(m.direction)),m.point=Mi(t,0,m.point,a,!0)):m.point=h.corners.center;if("Orthogonal"!==t.type){var f,y=void 0,i=void 0;if("Bezier"===t.type&&(t.bezierSettings.allowSegmentsReset||0===t.segments.length||!K.isEmptyPoint(t.segments[t.segments.length-1].point)))return c=Ai(t,u,m,void 0,o),c=bi(t,u,m);wi(t),void 0===t.sourcePortWrapper&&(u.point=u.corners.center,t.segments&&0<t.segments.length&&(i=t.segments[0],y=K.isEmptyPoint(i.point)?void 0:i),p=(void 0!==y?y:m).point,"Bezier"===t.type&&0<t.segments.length&&t.segments[0].vector1.angle&&t.segments[0].vector1.distance&&(f=Math.max(u.corners.width,u.corners.height),p=K.transform(u.point,t.segments[0].vector1.angle,f/2)),u.point=r?t.sourceWrapper.bounds.center:Mi(t,0,u.point,p,!1)),void 0===t.targetPortWrapper&&(m.point=m.corners.center,t.segments&&1<t.segments.length&&(i=t.segments[t.segments.length-2],y=K.isEmptyPoint(i.point)?void 0:i),g=(y||u).point,"Bezier"===t.type&&0<t.segments.length&&t.segments[t.segments.length-1].vector2.angle&&t.segments[t.segments.length-1].vector2.distance&&(f=Math.max(u.corners.width,u.corners.height),g=K.transform(m.point,t.segments[0].vector2.angle,f/2)),m.point=r?t.targetWrapper.bounds.center:Mi(t,0,g,m.point,!0)),c=bi(t,u,m)}else"Orthogonal"===t.type&&t.segments&&0<t.segments.length&&null!==t.segments[0].direction?c=function(t,e,i,n,r,o){var a,s,h,d;wi(t);for(var l=0;l<t.segments.length;l++){var c,p,g;if(s=t.segments[parseInt(l.toString(),10)],n&&e.direction===Ui(s.direction)&&(s.direction=e.direction),0<l&&t.segments[l-1].direction===s.direction?l=xi(t,l,e):s.direction?e.point=ci(e,t.segments[parseInt(l.toString(),10)]):(p=t.segments[l-1])&&p.points&&0<p.points.length&&(e.point=p.points[p.points.length-1]),l===t.segments.length-1)if(Ii(t,e),mi(a=(void 0===r?function(t,e,i){var n;{var r;t.sourcePortWrapper&&(r={x:t.sourcePortWrapper.offsetX,y:t.sourcePortWrapper.offsetY},r=Vi(r,gp(t.sourceWrapper),t.sourceWrapper.bounds))}Pi(t.targetWrapper,e,i,t);var o=Si(i.direction,e.point,i.point);{var a,s;n=void 0===t.sourcePortWrapper||e.direction!==i.direction||("Top"!==e.direction&&"Bottom"!==e.direction||e.corners.center.x!==i.corners.center.x)&&("Left"!==e.direction&&"Right"!==e.direction||e.corners.center.y!==i.corners.center.y)?i.point.x>=e.corners.left&&i.point.x<=e.corners.right&&e.point.y>=e.corners.top&&e.point.y<=e.corners.bottom?(e.direction=i.point.y>e.point.y?"Bottom":"Top",a="Top"===e.direction?e.point.y-e.corners.top+20:e.corners.bottom-e.point.y+20,Ri(t,e,i,a)):t.sourcePortWrapper&&r===Ui(o)?(("Left"===r||"Right"===r)&&e.point.y>=e.corners.top&&e.point.y<=e.corners.bottom?(e.direction=i.point.y>e.point.y?"Bottom":"Top",s=e.corners.height/2+20):("Top"===r||"Bottom"===r)&&e.point.x>=e.corners.left&&e.point.x<=e.corners.right&&(e.direction=i.point.x>e.point.x?"Right":"Left",s=e.corners.width/2+20),e.direction&&s?Ri(t,e,i,s,!0):(e.direction=o,Bi(e,i))):!t.sourcePortWrapper||r!==i.direction||"Top"!==r&&"Bottom"!==r||e.corners.center.x!==i.corners.center.x?e.direction===i.direction&&(("Left"===e.direction||"Right"===e.direction)&&i.point.y>e.corners.top-20&&i.point.y<e.corners.bottom+20||("Top"===e.direction||"Bottom"===e.direction)&&i.point.x>e.corners.left-20&&i.point.x<e.corners.right+20)?(a=e.direction,e.direction=o,Ni(e,i,a,n,20,!1)):(e.direction=o,Bi(e,i)):(e.direction=i.point.y>e.point.y?"Bottom":"Top",s="Bottom"===e.direction?e.corners.bottom-e.point.y+20:e.point.y-e.corners.top+20,Ri(t,e,i,s)):(e.direction=o,n=Ri(t,e,i,"Top"===o||"Bottom"===o?t.sourceWrapper.height/2+20:t.sourceWrapper.width/2+20),e.point=n[1],"Left"===o||"Right"===o?(i.direction=o,i.point="Left"===o?i.corners.middleLeft:i.corners.middleRight):Pi(t.targetWrapper,e,i,t),Ri(t,e,i))}return n}:gi)(t,e,i),t),s.points=[],2<=a.length)for(h=0;h<a.length;h++)t.selectedSegmentIndex&&h===a.length-1&&2<a.length&&2<t.segments.length?(c={x:a[parseInt(h.toString(),10)].x,y:e.point.y},s.points=[],s.points.push(c),s.points.push(a[parseInt(h.toString(),10)]),p=t.segments[l-1],t.segments.length<4&&p.points.pop(),p.points=p.points.concat(s.points)):s.points.push(a[parseInt(h.toString(),10)]);else d=l;void 0===d||t.selectedSegmentIndex||(d===t.segments.length-1&&(t.segments[d-1].direction=null,t.segments[d-1].length=null),t.segments.splice(d,1)),n&&0===l&&(g=ui(t,n,o))&&(e.point=g)}return Ci(t,[])}(t,u,m,d,l,s):(t.segments[0]||(y=new Ua(t,"segments",{type:"Orthogonal"},!0),t.segments.push(y)),t.segments[0].points=c=Ai(t,u,m,void 0,o));return c}(t,e.direction,i.direction,e.point,i.point,r);wi(t),(t.sourceWrapper||t.targetWrapper)&&function(t,e,i){var n=t.sourcePortWrapper,r=t.targetPortWrapper,o=t.sourceWrapper,a=e.point,s={left:0,right:0,top:0,bottom:0},h={x:0,y:0},d="Top";s=(o?(a=i.point,e):(o=t.targetWrapper,i)).margin;{var l;"Orthogonal"===t.type?t.segments&&0<t.segments.length&&t.sourceWrapper&&t.segments[0].direction?(e.direction=t.segments[0].direction,h=Di(o.corners,e.direction),l=Di(o.corners,Ui(e.direction)),h=Mi(t,0,h,l,!1)):(Pi(o,{corners:null,direction:null,point:a,margin:s},l={corners:null,direction:null,point:null,margin:null},t),h=l.point,d=l.direction):(s=void 0,t.segments&&1<t.segments.length&&(s=(o===t.sourceWrapper?t.segments[0]:t.segments[t.segments.length-2]).point),h=Mi(t,0,o.bounds.center,t.segments&&1<t.segments.length?s:a,o===t.targetWrapper))}o===t.sourceWrapper?(e.direction=e.direction||d,e.point=h,t.sourcePortWrapper&&(e.point={x:n.offsetX,y:n.offsetY},t.sourcePadding)&&(e.point=fi(t,e,i,!1))):(i.direction=i.direction||d,i.point=h,t.targetPortWrapper&&(i.point={x:r.offsetX,y:r.offsetY},t.targetPadding)&&(i.point=fi(t,e,i,!0)))}(t,e,i);{var u;"Straight"===t.type||"Bezier"===t.type?c=bi(t,e,i):"Orthogonal"===t.type&&t.segments&&0<t.segments.length&&null!==t.segments[0].length&&null!==t.segments[0].direction?c=function(t,e,i,n,r,o,a){var s,h,d,l=[];if(wi(t),0<t.segments.length){for(var c=0;c<t.segments.length;c++){var p,g,u=t.segments[parseInt(c.toString(),10)];if(0===c&&void 0!==t.sourcePortWrapper&&(p={x:o.offsetX,y:o.offsetY},p=Vi(p,gp(n),n.bounds),u.direction===Ui(p))&&(u.direction=p),0<c&&t.segments[c-1].direction===u.direction?c=xi(t,c,e):(p=t.segments[c-1],e.point=u.direction?ci(e,u):p.points[p.points.length-1]),c===t.segments.length-1&&(h=(a||r?t.targetWrapper&&void 0===t.targetPortWrapper?(Ii(t,e),function(t,e,i){i.corners=t.targetWrapper.corners,Pi(t.targetWrapper,e,i,t);var n,r=Si(i.direction,e.point,i.point);n=e.direction!==i.direction||"Left"!==e.direction&&"Right"!==e.direction?(e.direction=r,Bi(e,i)):(e.direction=r,n=Ri(t,e,i,t.targetWrapper.width/2+20),e.point=n[1],Pi(t.targetWrapper,e,i,t),Ri(t,e,i));return n}):gi:function(t,e,i){var n,r,o;{var a;e.corners=t.sourceWrapper?t.sourceWrapper.corners:void 0,t.sourcePortWrapper&&(a={x:t.sourcePortWrapper.offsetX,y:t.sourcePortWrapper.offsetY},a=Vi(a,gp(t.sourceWrapper),t.sourceWrapper.bounds),!e.corners||"Bottom"!==e.direction&&"Top"!==e.direction?!e.corners||"Left"!==e.direction&&"Right"!==e.direction||i.point.y>e.corners.top&&i.point.y<e.corners.bottom&&(r=e.point.x>i.point.x?"Left":"Right"):i.point.x>e.corners.left&&i.point.x<e.corners.right&&(r=e.point.y>i.point.y?"Top":"Bottom"))}t.sourcePortWrapper&&a===Ui(r)?(("Left"===a||"Right"===a)&&e.point.y>=e.corners.top&&e.point.y<=e.corners.center.y&&i.point.y>=e.corners.top&&i.point.y<=e.corners.center.y?(e.direction="Top",o=e.point.y-e.corners.top+20):("Left"===a||"Right"===a)&&e.point.y>e.corners.center.y&&e.point.y<=e.corners.bottom&&i.point.y>e.corners.center.y&&i.point.y<=e.corners.bottom?(e.direction="Bottom",o=e.corners.bottom-e.point.y+20):("Top"===a||"Bottom"===a)&&e.point.x>=e.corners.left&&e.point.x<=e.corners.center.x&&i.point.x>=e.corners.left&&i.point.x<=e.corners.center.x?(e.direction="Left",o=e.point.x-e.corners.left+20):("Top"===a||"Bottom"===a)&&e.point.x<=e.corners.right&&e.point.x>e.corners.center.x&&i.point.x<=e.corners.right&&i.point.x<e.corners.center.x&&(e.direction="Right",o=e.corners.right-e.point.x+20),e.direction&&o&&(n=Ri(t,e,i,o,!0))):(e.direction=r||Si(e.direction,e.point,i.point),n=Bi(e,i));return n})(t,e,i)))if(mi(h,t),u.points=[],2<=h.length)for(s=0;s<h.length;s++)u.points.push(h[parseInt(s.toString(),10)]);else d=c;o&&0===c&&(g=ui(t,o,n))&&(e.point=g)}void 0!==d&&(d===t.segments.length-1&&(t.segments[d-1].direction=null,t.segments[d-1].length=null),t.segments.splice(d,1)),l=Ci(t,l)}return l}(t,e,i,s,h,d,l):(u=void 0,e.direction?u=ki(s.bounds,e,20):e.direction=i.direction?void 0!==t.targetPortWrapper?i.direction:Ui(i.direction):K.direction(e.point,i.point),t.segments[0].points=c=Ri(t,e,i,u))}return c}(t,n,t.targetPoint,e,i);return Ei(t,n[0],!1),Ei(t,n[n.length-1],!0),n}function ci(t,e){t.direction=e.direction,e.points=[],e.points.push(t.point);var i="Left"===e.direction||"Top"===e.direction?-e.length:e.length,n="Left"===e.direction||"Right"===e.direction?0:90,t=Oi(t.point,i,n);return e.points.push(t),t}function pi(t,e,i){var n;i.corners=t.targetWrapper.corners,"Left"!==e.direction&&"Right"!==e.direction?i.corners.center.y!==e.point.y||i.corners.left<=e.point.x&&e.point.x<=i.corners.right?i.corners.center.y===e.point.y&&"Bottom"===t.segments[t.segments.length-2].direction||i.corners.center.y>e.point.y&&e.point.y>=i.corners.top?(n="Top",o=e.point.y-i.corners.top+20):i.corners.center.y===e.point.y&&"Top"===t.segments[t.segments.length-2].direction||i.corners.center.y<e.point.y&&e.point.y<=i.corners.bottom?(n="Bottom",o=i.corners.bottom-e.point.y+20):void 0!==t.sourcePortWrapper&&void 0!==t.targetPortWrapper&&e.corners.top<=e.point.y&&e.point.y<=e.corners.bottom&&(n=e.direction,o=e.point.y>i.point.y?e.point.y-e.corners.top+20:e.corners.bottom-e.point.y+20):(n="Top",o=i.corners.height/2+20):i.corners.center.x!==e.point.x||i.corners.top<e.point.y&&e.point.y<=i.corners.bottom?i.corners.center.x===e.point.x&&"Right"===t.segments[t.segments.length-2].direction||i.corners.center.x>e.point.x&&e.point.x>=i.corners.left?(n="Left",o=e.point.x-i.corners.left+20):i.corners.center.x===e.point.x&&"Left"===t.segments[t.segments.length-2].direction||i.corners.center.x<=e.point.x&&e.point.x<=i.corners.right?(n="Right",o=i.corners.right-e.point.x+20):void 0!==t.sourcePortWrapper&&void 0!==t.targetPortWrapper&&e.corners.left<=e.point.x&&e.point.x<=e.corners.right&&(n=e.direction,o=e.point.x>i.point.x?e.point.x-e.corners.left+20:e.corners.right-e.point.x+20):(n="Left",o=i.corners.width/2+20);var r=e.point,o=(e.point=Oi(e.point,"Left"===n||"Top"===n?-o:o,"Left"===n||"Right"===n?0:90),e.direction=K.direction(e.point,i.point),void 0===t.sourcePortWrapper||void 0===t.targetPortWrapper||e.corners.center.x!==i.corners.center.x&&e.corners.center.y!==i.corners.center.y||(e.direction=i.direction),Ri(t,e,i));return o.splice(0,0,r),o}function gi(t,e,i){i.corners=t.targetWrapper.corners;var n=function(t,e,i,n){var r=!1;switch(i.direction){case"Left":void 0!==t.sourcePortWrapper&&void 0!==t.targetPortWrapper&&"Right"===n&&e.point.x>i.point.x&&e.point.y>=e.corners.top&&e.point.y<=e.corners.bottom||("Bottom"===n&&e.point.y>i.point.y||"Top"===n&&e.point.y<i.point.y)&&e.point.x>=e.corners.left&&e.point.x<=e.corners.right?(e.direction="Right"===n?e.point.y>i.point.y?"Top":"Bottom":e.point.x<i.point.x?"Right":"Left",r=!0):e.point.x>i.point.x&&(e.point.y>i.point.y||e.point.y<i.point.y)&&!(i.corners.top>e.point.y&&i.corners.bottom<e.point.y)?e.direction="Left":e.point.x<i.point.x&&e.point.y>i.point.y||e.point.x>i.point.x&&e.point.y<=i.point.y&&i.corners.top<e.point.y&&i.corners.center.y>=e.point.y?e.direction="Top":e.point.x<i.point.x&&e.point.y<i.point.y||e.point.x>i.point.x&&e.point.y>i.point.y&&i.corners.bottom<e.point.y&&i.corners.center.y>e.point.y?e.direction="Bottom":e.point.y===i.point.y&&e.point.x<i.point.x&&(e.direction="Right");break;case"Right":void 0!==t.sourcePortWrapper&&void 0!==t.targetPortWrapper&&("Bottom"===n&&e.point.y>i.point.y||"Top"===n&&e.point.y<i.point.y)&&e.point.x>i.point.x&&e.point.x>=e.corners.left&&e.point.x<=e.corners.right?(e.direction=e.point.x>i.point.x?"Left":"Right",r=!0):void 0!==t.sourcePortWrapper&&void 0!==t.targetPortWrapper&&"Left"===n&&e.point.x<i.point.x&&e.point.y>=e.corners.top&&e.point.y<=e.corners.bottom?(e.direction=e.point.y>i.point.y?"Top":"Bottom",r=!0):e.point.x<i.point.x&&i.corners.top<=e.point.y&&i.corners.bottom>=e.point.y&&e.point.y===i.point.y||e.point.y>i.point.y&&e.point.x>i.point.x?e.direction="Top":e.point.y<i.point.y&&e.point.x>i.point.x?e.direction="Bottom":e.point.x<i.point.x&&(e.point.y>i.point.y||e.point.y<i.point.y)?e.direction="Right":e.point.y===i.point.y&&e.point.x>i.point.x&&(e.direction="Left");break;case"Top":void 0!==t.sourcePortWrapper&&void 0!==t.targetPortWrapper&&"Bottom"===n&&e.point.y>i.point.y&&e.point.x>=e.corners.left&&e.point.x<=e.corners.right||("Right"===n&&e.point.x>i.point.x||"Left"===n&&i.point.y>e.point.y&&i.point.x>e.point.x)&&e.point.y>=e.corners.top&&e.point.y<=e.corners.bottom?(e.direction="Bottom"===n?e.point.x>i.point.x?"Left":"Right":e.point.y<i.point.y?"Bottom":"Top",r=!0):e.point.x===i.point.x&&e.point.y<i.point.y?e.direction="Bottom":e.point.y>i.point.y&&e.point.x>i.corners.left&&e.point.x<i.corners.right?e.direction="Left":e.point.y>=i.point.y?e.direction="Top":e.point.y<i.point.y&&e.point.x>i.point.x?e.direction="Left":e.point.y<i.point.y&&e.point.x<i.point.x&&(e.direction="Right");break;case"Bottom":void 0!==t.sourcePortWrapper&&void 0!==t.targetPortWrapper&&(("Right"===n||"Left"===n&&i.point.x>e.point.x)&&e.point.y>i.point.y&&e.point.y>=e.corners.top&&e.point.y<=e.corners.bottom||"Top"===n&&e.point.y<i.point.y&&e.point.x>=e.corners.left&&e.point.x<=e.corners.right)?(e.direction="Right"===n||"Left"===n?e.point.y>i.point.y?"Top":"Bottom":e.point.x>i.point.x?"Left":"Right",r=!0):e.point.y<i.point.y&&e.point.x>i.corners.left&&i.corners.right>e.point.x?e.point.y<i.point.y&&e.point.x>i.corners.left&&i.corners.center.x>=e.point.x?e.direction="Left":e.point.y<i.point.y&&e.point.x<i.corners.right&&i.corners.center.x<e.point.x&&(e.direction="Right"):e.point.y>i.point.y&&e.point.x>i.point.x?e.direction="Left":e.point.y>i.point.y&&e.point.x<i.point.x?e.direction="Right":e.point.y<=i.point.y&&(e.point.x>i.point.x||i.point.x>e.point.x)&&(e.direction="Bottom")}return r}(t,e,i,r=void 0!==t.sourcePortWrapper?Vi({x:t.sourcePortWrapper.offsetX,y:t.sourcePortWrapper.offsetY},gp(t.sourceWrapper),t.sourceWrapper.bounds):r),r=!t.selectedSegmentIndex&&void 0!==t.sourcePortWrapper&&void 0!==t.targetPortWrapper&&i.direction===Ui(r)&&(("Left"===i.direction&&e.point.x>i.point.x||"Right"===i.direction&&e.point.x<i.point.x)&&e.point.y>=e.corners.top&&e.point.y<=e.corners.bottom||"Bottom"===i.direction&&e.point.y<i.point.y&&e.point.x>=e.corners.left&&e.point.x<=e.corners.right)?pi(t,e,i):t.selectedSegmentIndex||e.direction!==i.direction?!t.selectedSegmentIndex&&("Left"===i.direction&&e.point.x>i.point.x||"Right"===i.direction&&e.point.x<i.point.x)&&("Top"===e.direction||"Bottom"===e.direction)&&e.point.y<=i.point.y&&i.corners.top<=e.point.y&&i.corners.bottom>=e.point.y||"Top"===i.direction&&e.point.y>i.point.y||"Bottom"===i.direction&&e.point.y<i.point.y&&i.corners.left<=e.point.x&&i.corners.right>=e.point.x?t.selectedSegmentIndex?Bi(e,i):pi(t,e,i):!t.selectedSegmentIndex&&void 0!==t.sourceWrapper&&void 0!==t.targetWrapper&&void 0!==t.targetPortWrapper&&("Left"===e.direction||"Right"===e.direction)&&e.point.y>=e.corners.top&&e.point.y<=e.corners.bottom&&("Top"===i.direction||"Bottom"===i.direction)&&i.corners.center.x===e.corners.center.x?(e.direction="Top"===i.direction?"Bottom":"Top",Ri(t,e,i,"Top"===i.direction?e.corners.bottom-e.point.y+20:e.point.y-e.corners.top+20)):!t.selectedSegmentIndex&&void 0!==t.sourceWrapper&&void 0!==t.targetWrapper&&void 0!==t.targetPortWrapper&&("Top"===e.direction||"Bottom"===e.direction)&&e.point.x>=e.corners.left&&e.point.x<=e.corners.right&&("Left"===i.direction||"Right"===i.direction)&&i.corners.center.y===e.corners.center.y?(e.direction="Left"===i.direction?"Right":"Left",Ri(t,e,i,"Left"===i.direction?e.corners.right-e.point.x+20:e.point.x-e.corners.left+20)):n?Ri(t,e,i,"Left"===e.direction||"Right"===e.direction?"Left"===e.direction?e.point.x-e.corners.left+20:e.corners.right-e.point.x+20:"Top"===e.direction?e.point.y-e.corners.top+20:e.corners.bottom-e.point.y+20):Bi(e,i):Ri(t,e,i);return r}function ui(t,e,i){var n,r,o,a,s,h,e={x:e.offsetX,y:e.offsetY},d=gp(i),e=Vi(e,d,i.bounds),i=t.segments[0];return i.direction!==e&&(t=e,e=d,n=(d=i).points[0],r=i.points[i.points.length-1],o=!1,(h=[]).push(n),n.y===r.y&&("Left"===t&&r.x<n.x||"Right"===t&&r.x>n.x)||n.x===r.x&&("Top"===t&&r.y<n.y||"Bottom"===t&&r.y>n.y)||("Top"===t||"Bottom"===t?"Top"===t&&r.y<n.y&&r.y>n.y-13||"Bottom"===t&&r.y>n.y&&r.y<n.y+13?(s="Top"===t?e.top-13:e.bottom+13,h.push({x:n.x,y:s}),h.push({x:n.x+(r.x-n.x)/2,y:s}),h.push({x:n.x+(r.x-n.x)/2,y:r.y})):13<Math.abs(n.x-r.x)&&("Top"===t&&r.y<n.y||"Bottom"===t&&r.y>n.y)?h.push({x:n.x,y:r.y}):(s="Top"===t?e.top-13:e.bottom+13,a=r.x<n.x?e.left-13:e.right+13,h.push({x:n.x,y:s}),h.push({x:r.x,y:s})):"Left"===t&&r.x<n.x&&r.x>n.x-13||"right"===t&&r.x>n.x&&r.x<n.x+13?(a="Left"===t?e.left-13:e.right+13,h.push({x:a,y:n.y}),h.push({x:a,y:n.y+(r.y-n.y)/2}),h.push({x:r.x,y:n.y+(r.y-n.y)/2})):13<Math.abs(n.y-r.y)&&("Left"===t&&r.x<n.x||"Right"===t&&r.x>n.x)?h.push({x:r.x,y:n.y}):(a="Left"===t?e.left-13:e.right+13,h.push({x:a,y:n.y}),h.push({x:a,y:r.y})),o&&(h.push(d.points[0]),h.reverse()),d.points=h),s=i.points[i.points.length-1],i.direction=K.direction(i.points[i.points.length-2],i.points[i.points.length-1])),s}function mi(t,e){var i=e.segments[e.segments.length-2],n=i.points[i.points.length-1];("Top"!==i.direction&&"Bottom"!==i.direction||n.x!==t[1].x)&&("Left"!==i.direction&&"Right"!==i.direction||n.y!==t[1].y)||(i.points[i.points.length-1]=t[1],n=K.direction(i.points[0],i.points[i.points.length-1]),void 0!==e.sourceWrapper&&void 0===e.sourcePortWrapper&&n===Ui(i.direction)&&("Left"===i.direction||"Right"===i.direction?i.points[0].x="Right"===i.direction?i.points[0].x-e.sourceWrapper.corners.width:i.points[0].x+e.sourceWrapper.corners.width:i.points[0].y="Bottom"===i.direction?i.points[0].y-e.sourceWrapper.corners.height:i.points[0].y+e.sourceWrapper.corners.height),i.direction=n,i.length=K.distancePoints(i.points[0],i.points[i.points.length-1]),t.splice(0,1))}function fi(t,e,i,n){var r=t.sourcePortWrapper,o=t.targetPortWrapper,t=n?t.targetPadding:t.sourcePadding,o=n?o:r,r=new k(o.bounds.x-t,o.bounds.y-t,o.actualSize.width+2*t,o.actualSize.height+2*t),o=[r.topLeft,r.topRight,r.bottomRight,r.bottomLeft],t=(o[o.length]=o[0],{x1:e.point.x,y1:e.point.y,x2:i.point.x,y2:i.point.y}),r=(n?i:e).point;return Li(t,o,0,r)||r}function yi(t,e){var i=[],n=gh(0,t.corners,e);n.push(n[0]);for(var r,o,a=0;a<n.length-1;a++)i.push((r=n[parseInt(a.toString(),10)],o=n[a+1],{x1:r.x,y1:r.y,x2:o.x,y2:o.y}));return i}function vi(t,e,i){var n,t=t.rotateAngle+t.parentTransform;if(t){if(t<45)return e;if(t<=135)n={width:e.width,height:e.height,topLeft:e.bottomLeft,topCenter:e.middleLeft,topRight:e.topLeft,middleLeft:e.bottomCenter,center:i.center,middleRight:e.topCenter,bottomLeft:e.bottomRight,bottomCenter:e.middleRight,bottomRight:e.topRight,left:i.left,right:i.right,top:i.top,bottom:i.bottom};else if(t<=225)n={width:e.width,height:e.height,topLeft:e.bottomLeft,topCenter:e.bottomCenter,topRight:e.bottomRight,middleLeft:e.middleRight,center:i.center,middleRight:e.middleLeft,bottomLeft:e.topLeft,bottomCenter:e.topCenter,bottomRight:e.topRight,left:i.left,right:i.right,top:i.top,bottom:i.bottom};else{if(!(t<=315))return e;n={width:e.width,height:e.height,topLeft:e.topRight,topCenter:e.middleRight,topRight:e.bottomRight,middleLeft:e.topCenter,center:i.center,middleRight:e.bottomCenter,bottomLeft:e.topLeft,bottomCenter:e.middleLeft,bottomRight:e.bottomLeft,left:i.left,right:i.right,top:i.top,bottom:i.bottom}}return n}return e}function bi(t,e,i){var n=[];if(t.segments&&0<t.segments.length)for(var r=void 0,o=[],a=e.point,r=0;r<t.segments.length;r++){var s=t.segments[parseInt(r.toString(),10)];if((o=[]).push(a),r!==t.segments.length-1?(o.push(s.point),a=s.point):o.push(i.point),t.segments[parseInt(r.toString(),10)].points=o,1<t.segments.length&&K.equals(s.points[0],s.points[1])&&t.segments.splice(r,1),s)for(var h=0;h<s.points.length;h++)(0<h||0===r)&&n.push(s.points[parseInt(h.toString(),10)])}return n}function Si(t,e,i){return"Top"===t||"Bottom"===t?i.x>e.x?"Right":"Left":i.y>e.y?"Bottom":"Top"}function wi(t){if("Straight"===t.type||"Bezier"===t.type)(0===t.segments.length||0<t.segments.length&&!K.isEmptyPoint(t.segments[t.segments.length-1].point))&&(r="Bezier"===t.type?new Xa(t,"segments",{type:"Bezier",isInternalSegment:!0},!0):new Wa(t,"segments",{type:"Straight"},!0),t.segments.push(r));else{if(0<t.segments.length)for(var e=!1,i=0;i<t.segments.length;){var n=t.segments[parseInt(i.toString(),10)];e||n&&!(n instanceof Ua||n instanceof Wa||n instanceof Xa)?(t.segments.splice(i,1),e=!0):i++}var r;0!==t.segments.length&&!t.segments[t.segments.length-1].direction||(r=new Ua(t,"segments",{type:"Orthogonal"},!0),t.segments.push(r))}}function xi(t,e,i){var n=t.segments[parseInt(e.toString(),10)],r="Left"===n.direction||"Top"===n.direction?-n.length:n.length,o="Left"===n.direction||"Right"===n.direction?0:90,r=Oi(i.point,r,o);return t.segments[e-1].length+=n.length,t.segments[e-1].points[1]=i.point=r,t.segments.splice(e,1),--e}function Ii(t,e){var i,n,r;void 0!==t.targetWrapper&&void 0===t.targetPortWrapper&&gp(t.targetWrapper).containsPoint(e.point,1)&&(i=t.targetWrapper,n=(t=t.segments[t.segments.length-2]).points[t.points.length-1],"Bottom"===(r=Ui(t.direction))?n.y<i.corners.bottom+1&&(t.points[t.points.length-1].y=i.corners.bottom+20,t.length=K.distancePoints(t.points[0],t.points[t.points.length-1])):"Top"===r?n.y>i.corners.top-1&&(t.points[t.points.length-1].y=i.corners.top-20,t.length=K.distancePoints(t.points[0],t.points[t.points.length-1])):"Left"===r?n.x>i.corners.left-1&&(t.points[t.points.length-1].x=i.corners.left-20,t.length=K.distancePoints(t.points[0],t.points[t.points.length-1])):"Right"===r&&n.x<i.corners.right+1&&(t.points[t.points.length-1].x=i.corners.right+20,t.length=K.distancePoints(t.points[0],t.points[t.points.length-1])),e.point=t.points[t.points.length-1])}function Ci(t,e){for(var i=0;i<t.segments.length;i++)for(var n=t.segments[parseInt(i.toString(),10)],r=0;r<n.points.length;r++)(0<r||0===i)&&e.push(n.points[parseInt(r.toString(),10)]);return e}function Pi(t,e,i,n){var r,o,a,s,h={x:0,y:0},d=vi(t,t.corners,t.bounds),l=e.margin,e=e.point,l=(d.bottomCenter.y+l.bottom<e.y?(s="Bottom",h=d.bottomCenter):d.topCenter.y-l.top>e.y?(s="Top",h=d.topCenter):d.middleLeft.x-l.left>e.x?(s="Left",h=d.middleLeft):d.middleRight.x+l.right<e.x?(s="Right",h=d.middleRight):(l=Math.abs(e.y-d.topCenter.y),r=Math.abs(e.x-d.middleRight.x),o=Math.abs(e.y-d.bottomCenter.y),e=Math.abs(e.x-d.middleLeft.x),a=Number.MAX_VALUE,s="Top",h=d.topCenter,r<(a=l)&&(a=r,s="Right",h=d.middleRight),o<a&&(a=o,s="Bottom",h=d.bottomCenter),e<a&&(s="Left",h=d.middleLeft)),i.point=h,i.direction=s,Di(d,Ui(i.direction)));i.point=Mi(n,0,i.point,l,t===n.targetWrapper)}function Ai(t,e,i,n,r){var o,a;if((h=function(t,e){var i=!1;switch(t){case"Left":switch(e){case"Right":case"Bottom":i=!0}break;case"Top":switch(e){case"Left":case"Right":case"Bottom":i=!0}break;case"Bottom":"Right"===e&&(i=!0)}return i}(e.direction,i.direction))&&Xi(e,i),"Right"===e.direction&&"Left"===i.direction?o=function(t,e,i,n){var r=t.sourcePortWrapper,o=Math.round(Math.abs(e.point.y-i.point.y)),a={x:Math.max(e.point.x,e.corners.right),y:e.point.y},s={x:Math.min(i.point.x,i.corners.left),y:i.point.y},h=Ti(t);{var d;n&&(d=s,s=a,a=d)}e.corners.bottom+h<i.corners.top-h||e.corners.top-h>i.corners.bottom+h||("Bezier"!==t.type||i.corners.left-e.corners.right<=2*h&&5<=i.corners.left-e.corners.right)&&(h=0);e.margin={left:h,right:h,top:h,bottom:h},i.margin={left:h,right:h,top:h,bottom:h},d=0===o&&(e.corners.right<i.corners.left||n&&e.corners.right<i.corners.left)?Z.NoOfSegments.One:e.point.x+e.margin.right<i.point.x-i.margin.left||t.sourceWrapper!==t.targetWrapper&&(gp(t.sourceWrapper).containsPoint(s)||gp(t.targetWrapper).containsPoint(a))?Z.NoOfSegments.Three:(e.corners.bottom<=i.corners.top||e.corners.top>=i.corners.top||void 0!==r&&r.offsetY<=i.corners.top||void 0===r&&e.corners.right<=i.corners.top||void 0!==r&&r.offsetY>=i.corners.bottom||void 0===r&&(e.corners.right,i.corners.bottom),Z.NoOfSegments.Five);return d}(t,e,i,h):"Right"===e.direction&&"Right"===i.direction?o=function(t,e,i){var n=t.sourcePortWrapper,r=t.targetPortWrapper,o=e.point.x-i.point.x,a=e.point.y-i.point.y,t=Ti(t);i.margin={left:t,right:t,top:t,bottom:t},e.margin={left:t,right:t,top:t,bottom:t},t=e.corners.right>=i.corners.right?void 0!==n&&(n.offsetY<i.corners.top-i.margin.top||n.offsetY>i.corners.bottom+i.margin.bottom)||void 0===n&&e.corners.middleRight.y<i.corners.top||void 0!==n&&n.offsetY>i.corners.bottom+i.margin.bottom&&e.corners.top>i.corners.bottom||void 0===n&&e.corners.middleRight.y>i.corners.bottom||void 0!==n&&n.offsetY<i.corners.top-i.margin.top&&e.corners.bottom>i.corners.top||void 0===n&&e.corners.middleRight.y>i.corners.bottom?Z.NoOfSegments.Three:e.corners.right<i.corners.left||i.corners.right<e.corners.left?Z.NoOfSegments.Five:0==o||0==a?Z.NoOfSegments.One:Z.NoOfSegments.Three:void 0!==r&&e.corners.bottom<r.offsetY-i.margin.top||void 0===r&&e.corners.bottom<i.corners.middleRight.y||void 0!==r&&e.corners.top>r.offsetY+i.margin.right||void 0===r&&e.corners.top>i.corners.middleRight.y||void 0!==r&&(void 0!==n&&n.offsetX<i.corners.left&&n.offsetX!==r.offsetX&&Math.abs(e.corners.right-i.corners.left)<=20||void 0===n&&e.corners.right<i.corners.left&&e.corners.center.x!==i.corners.center.x&&e.corners.center.y!==i.corners.center.y)?Z.NoOfSegments.Three:e.corners.right<i.corners.left?Z.NoOfSegments.Five:0==o||0==a?Z.NoOfSegments.One:Z.NoOfSegments.Three;return t}(t,e,i):"Right"===e.direction&&"Top"===i.direction?o=function(t,e,i,n){var r=t.targetPortWrapper,o=t.sourcePortWrapper,a={x:Math.max(e.point.x,e.corners.right),y:e.point.y},s={x:i.point.x,y:Math.min(i.point.y,i.corners.top)},h=Ti(t);i.margin={left:h,right:h,top:h,bottom:h},e.margin={top:h,bottom:h,left:h,right:h},n&&(h=o,o=r,r=h,n=a,a=s,s=n);h=void 0!==o&&o.offsetY<i.corners.top-i.margin.top||void 0===o&&e.corners.bottom<i.corners.top-i.margin.top?e.corners.bottom<i.corners.top?void 0!==r&&e.corners.right+e.margin.right<r.offsetX||void 0===r&&e.corners.right+e.margin.right<i.corners.topCenter.x?Z.NoOfSegments.Two:Z.NoOfSegments.Four:void 0!==r&&e.corners.left>r.offsetX||void 0===r&&e.corners.left>i.corners.topCenter.x?Z.NoOfSegments.Four:Z.NoOfSegments.Two:void 0!==o&&Math.abs(e.corners.right-i.corners.left)<=5&&Math.abs(o.offsetY-i.corners.top)<=5||void 0!==r&&e.corners.right<i.corners.left&&25<=Math.abs(r.offsetX-e.corners.topCenter.x)&&e.corners.middleRight.y+e.margin.right<r.offsetY||!(e.corners.right<i.corners.left)&&t.sourceWrapper!==t.targetWrapper&&(gp(t.sourceWrapper).containsPoint(s)||gp(t.targetWrapper).containsPoint(a))?Z.NoOfSegments.Two:Z.NoOfSegments.Four;return h}(t,e,i,h):"Right"===e.direction&&"Bottom"===i.direction?o=function(t,e,i,n){var r=Ti(t),r=(e.margin={left:r,right:r,top:r,bottom:r},i.margin={left:r,right:r,top:r,bottom:r},t.sourcePortWrapper),t=t.targetPortWrapper;n&&(n=r,r=t,t=n);n=void 0!==r&&r.offsetY>i.corners.bottom+i.margin.bottom||void 0===r&&e.corners.middleRight.y>i.corners.bottom+i.margin.bottom?e.corners.top>i.corners.bottom?void 0!==t&&e.corners.right+e.margin.right<t.offsetX||void 0===t&&e.corners.right+e.margin.right<i.corners.bottomCenter.x?Z.NoOfSegments.Two:Z.NoOfSegments.Four:void 0!==t&&e.corners.left>t.offsetX||void 0===t&&e.corners.left>i.corners.bottomCenter.x?Z.NoOfSegments.Four:Z.NoOfSegments.Two:void 0!==r&&Math.abs(e.corners.right-i.corners.left)<=25&&Math.abs(r.offsetY-i.corners.bottom)<=25?Z.NoOfSegments.Two:(e.corners.right,i.corners.left,Z.NoOfSegments.Four);return n}(t,e,i,h):"Bottom"===e.direction&&"Top"===i.direction?o=function(t,e,i){var n=e.point.x-i.point.x,r=Ti(t);e.corners.right+r<i.corners.left-r||e.corners.left-r>i.corners.right+r||("Bezier"!==t.type||i.corners.top-e.corners.bottom<=2*r&&5<=i.corners.top-e.corners.bottom)&&(r=0);e.margin={left:r,right:r,top:r,bottom:r},i.margin={left:r,right:r,top:r,bottom:r},t=0==n&&e.corners.bottom<i.corners.top?Z.NoOfSegments.One:e.corners.bottom+e.margin.bottom<i.corners.top-i.margin.top?Z.NoOfSegments.Three:(e.corners.right+e.margin.right<i.corners.left-i.margin.left||(e.corners.left,e.margin.left,i.corners.right,i.margin.right),Z.NoOfSegments.Five);return t}(t,e,i):"Bottom"===e.direction&&"Bottom"===i.direction?(a=Ti(t),e.margin={left:a,right:a,top:a,bottom:a},i.margin={left:a,right:a,top:a,bottom:a},o=function(t,e,i){var n=t.sourcePortWrapper,t=t.targetPortWrapper,r=Math.round(Math.abs(e.point.x-i.point.x)),o=Math.round(Math.abs(i.point.y-i.point.y));n=e.corners.bottom<i.corners.bottom?void 0!==n&&n.offsetX<i.corners.left-i.margin.left||void 0===n&&e.corners.bottomCenter.x<i.corners.left-i.margin.left||void 0!==n&&n.offsetX>i.corners.right+i.margin.right||void 0===n&&e.corners.bottomCenter.x>i.corners.right+i.margin.right?Z.NoOfSegments.Three:e.corners.bottom<i.corners.top?Z.NoOfSegments.Five:0===r||0===o?Z.NoOfSegments.One:Z.NoOfSegments.Three:void 0!==t&&e.corners.left-e.margin.left>t.offsetX||void 0===t&&e.corners.left>i.corners.left||void 0!==t&&e.corners.right+e.margin.right<t.offsetX||void 0===t&&e.corners.right<i.corners.right?Z.NoOfSegments.Three:e.corners.top>i.corners.bottom?Z.NoOfSegments.Five:0===r||0===o?Z.NoOfSegments.One:Z.NoOfSegments.Three;return n}(t,e,i)):"Bottom"===e.direction&&"Left"===i.direction?o=function(t,e,i,n){var r=t.sourcePortWrapper,o=t.targetPortWrapper,t=Ti(t);i.margin={left:t,right:t,top:t,bottom:t},e.margin={top:t,bottom:t,left:t,right:t},n&&(t=r,r=o,o=t);n=void 0!==r&&r.offsetX<i.corners.left-i.margin.left||void 0===r&&e.corners.bottomCenter.x<i.corners.bottomLeft.x-i.margin.left?e.corners.right<i.corners.left?void 0!==o&&e.corners.bottom+e.margin.bottom<o.offsetY||void 0===o&&e.corners.bottom+e.margin.bottom<i.corners.middleLeft.y?Z.NoOfSegments.Two:Z.NoOfSegments.Four:void 0!==o&&e.corners.top>o.offsetY||void 0===o&&e.corners.top>i.corners.middleLeft.y?Z.NoOfSegments.Four:Z.NoOfSegments.Two:void 0!==o&&Math.abs(e.corners.right-i.corners.left)<=25&&Math.abs(o.offsetY-e.corners.bottom)<=25?Z.NoOfSegments.Two:Z.NoOfSegments.Four;return n}(t,e,i,h):"Left"===e.direction&&"Left"===i.direction?o=function(t,e,i){var n=t.sourcePortWrapper,r=t.targetPortWrapper,t=Ti(t),t=(e.margin={left:t,right:t,top:t,bottom:t},i.margin={left:t,right:t,top:t,bottom:t},Math.round(Math.abs(e.point.x-i.point.x))),o=Math.round(Math.abs(e.point.y-i.point.y));r=e.corners.left<i.corners.left?void 0!==r&&e.corners.bottom+e.margin.bottom<r.offsetY||void 0===r&&e.corners.bottom+e.margin.bottom<i.corners.middleLeft.y||void 0!==r&&e.corners.top-e.margin.top>r.offsetY||void 0===r&&e.corners.top-e.margin.top>i.corners.middleLeft.y?Z.NoOfSegments.Three:e.corners.right<i.corners.left||i.corners.right<e.corners.left?Z.NoOfSegments.Five:0===t||0===o?Z.NoOfSegments.One:Z.NoOfSegments.Three:void 0!==n&&n.offsetY<i.corners.top-i.margin.top||void 0===n&&e.corners.middleLeft.y<i.corners.top||void 0!==n&&n.offsetY>i.corners.bottom+i.margin.bottom||void 0===n&&e.corners.middleLeft.y>i.corners.bottom+i.margin.bottom?Z.NoOfSegments.Three:e.corners.left>i.corners.right?Z.NoOfSegments.Five:0===t||0===o?Z.NoOfSegments.One:Z.NoOfSegments.Three;return r}(t,e,i):"Left"===e.direction&&"Top"===i.direction?o=function(t,e,i,n){var r=t.sourcePortWrapper,o=Ti(t),o=(i.margin={left:o,right:o,top:o,bottom:o},e.margin={top:o,bottom:o,left:o,right:o},t.targetPortWrapper),a={x:Math.min(e.point.x,e.corners.left),y:e.point.y},s={x:i.point.x,y:Math.min(i.point.y,i.corners.top)};n&&(n=r,r=o,o=n,n=a,a=s,s=n);n=void 0!==r&&r.offsetY<i.corners.top-i.margin.top||void 0===r&&(e.corners.bottom<i.corners.top-i.margin.top||e.corners.middleLeft.y<i.corners.top-i.margin.top)?e.corners.bottom<i.corners.top?void 0!==o&&e.corners.left-e.margin.left>o.offsetX||void 0===o&&e.corners.left-e.margin.left>i.corners.topCenter.x?Z.NoOfSegments.Two:Z.NoOfSegments.Four:void 0!==o&&e.corners.right<o.offsetX||void 0===o&&e.corners.right<i.corners.topCenter.x?Z.NoOfSegments.Four:Z.NoOfSegments.Two:void 0!==r&&Math.abs(e.corners.left-i.corners.right)<=25&&Math.abs(r.offsetY-i.corners.top)<=25||t.sourceWrapper!==t.targetWrapper&&(gp(t.sourceWrapper).containsPoint(s)||gp(t.targetWrapper).containsPoint(a))?Z.NoOfSegments.Two:(e.corners.left,i.corners.right,Z.NoOfSegments.Four);return n}(t,e,i,h):"Top"===e.direction&&"Top"===i.direction&&(o=function(t,e,i){var n=t.sourcePortWrapper,r=t.targetPortWrapper,o=Math.round(Math.abs(e.point.x-i.point.x)),a=Math.round(Math.abs(e.point.y-i.point.y)),t=Ti(t);i.margin={left:t,right:t,top:t,bottom:t},e.margin={top:t,bottom:t,left:t,right:t},t=e.corners.top<i.corners.top?void 0!==r&&e.corners.left-e.margin.left>r.offsetX||void 0===r&&e.corners.left>i.corners.left||void 0!==r&&e.corners.right+e.margin.right<r.offsetX||void 0===r&&e.corners.right<i.corners.right?Z.NoOfSegments.Three:e.corners.bottom<i.corners.top?Z.NoOfSegments.Five:0===o||0===a?Z.NoOfSegments.One:Z.NoOfSegments.Three:void 0!==n&&n.offsetX>i.corners.right+i.margin.right||void 0===n&&e.corners.left>i.corners.right||void 0!==n&&n.offsetX<i.corners.left-i.margin.left||void 0===n&&e.corners.bottomRight.x<i.corners.left?Z.NoOfSegments.Three:e.corners.top>i.corners.bottom?Z.NoOfSegments.Five:0===o||0===a?Z.NoOfSegments.One:Z.NoOfSegments.Three;return t}(t,e,i)),h&&Xi(e,i),a=function(t,e,i,n,r,o){var a,s,h=t.sourceWrapper,d=t.targetWrapper,l=h.corners,c=d.corners,p=20,h={corners:i.corners,point:i.point,direction:i.direction,margin:i.margin},d={corners:n.corners,point:n.point,direction:n.direction,margin:n.margin};if(!(h.direction===d.direction&&e!==Z.NoOfSegments.Five||h.direction!==Ui(d.direction)&&e!==Z.NoOfSegments.Three))switch(h.direction){case"Left":l.middleLeft.x>c.middleRight.x&&(s=(l.middleLeft.x-c.middleRight.x)/2,p=o?s:Math.min(p,s));break;case"Right":l.middleRight.x<c.middleLeft.x&&(s=(c.middleLeft.x-l.middleRight.x)/2,p=o?s:Math.min(p,s));break;case"Top":l.topCenter.y>c.bottomCenter.y&&(s=(l.topCenter.y-c.bottomCenter.y)/2,p=o?s:Math.min(p,s));break;case"Bottom":l.bottomCenter.y<c.topCenter.y&&(s=(c.topCenter.y-l.bottomCenter.y)/2,p=o?s:Math.min(p,s))}p=ki(l,h,p);i="Bezier"===t.type;r&&(p=Math.max(p,r));e===Z.NoOfSegments.One&&(a=[h.point,d.point]);e===Z.NoOfSegments.Two&&(a=Bi(h,d));e===Z.NoOfSegments.Three&&(a=Ri(t,h,d,p,void 0,i));e===Z.NoOfSegments.Four&&(a=Ni(h,d,void 0,a,p,i));e===Z.NoOfSegments.Five&&(a=function(t,e,i,n){void 0===i&&(i=20);void 0===n&&(n=!1);n&&(i=20);var r,o,a=i,s=t.corners.left-t.margin.left,h=t.corners.right+t.margin.right,d=t.corners.bottom+t.margin.bottom,l=t.corners.top-t.margin.top,c=e.corners.left-e.margin.left,p=e.corners.right+e.margin.right,g=e.corners.bottom+e.margin.bottom,u=e.corners.top-e.margin.top;switch(t.direction){case"Left":(u<l&&l<g||d<g&&u<d)&&c<s&&s<=p&&20<=i&&(a=t.point.x-e.corners.left+a),n&&t.direction===e.direction&&t.corners.left>e.corners.left&&20<=t.corners.left-e.corners.right&&(a=(t.corners.left-e.corners.right)/2),o=Oi(t.point,a,180);break;case"Top":(c<s&&s<p||h<p&&c<h)&&u<l&&l<=g&&20<=i&&(a=t.point.y-e.corners.top+a),n&&t.direction===e.direction&&t.corners.top>e.corners.top&&20<=t.corners.top-e.corners.bottom&&(a=(t.corners.top-e.corners.bottom)/2),o=Oi(t.point,a,270);break;case"Right":(u<l&&l<g||d<g&&u<d)&&h<p&&c<=h&&20<=i&&(a=e.corners.right-t.point.x+a),n&&t.direction===e.direction&&t.corners.right<e.corners.right&&20<=e.corners.left-t.corners.right&&(a=(e.corners.left-t.corners.right)/2),o=Oi(t.point,a,0);break;case"Bottom":(c<s&&s<p||h<p&&c<h)&&d<g&&u<=d&&20<=i&&(a=e.corners.bottom-t.point.y+a),n&&t.direction===e.direction&&t.corners.bottom<e.corners.bottom&&20<=e.corners.top-t.corners.bottom&&(a=(e.corners.top-t.corners.bottom)/2),o=Oi(t.point,a,90)}r=[t.point,o];var m=void 0;{var f;r=(m="Top"===t.direction||"Bottom"===t.direction?(f=t.direction,t.direction=o.x>e.point.x?"Left":"Right",t.point=o,n?.5*Math.abs(o.x-e.point.x):m):(f=t.direction,t.direction=o.y>e.point.y?"Top":"Bottom",t.point=o,n?.5*Math.abs(o.y-e.point.y):m),Ni(t,e,f,r,m,n))}return r}(h,d,p,i));return a}(t,o,e,i,n,r),"Bezier"===t.type){var s=t,h=o,e=a;if("Bezier"===s.type)if(0===s.segments.length){var d,l,c,p,g,u,m,f,y,v,b,S,w,x,I,C,P,A,T,D,i=e[0],n=e[e.length-1];h===Z.NoOfSegments.One?(f=Math.min(20,.5*K.findLength(i,n)),m={angle:M(i,n),distance:f},f={angle:M(n,i),distance:f},c=K.direction(i,n),D=new Xa(s,"segments",{type:"Bezier",isInternalSegment:!0,vector1:m,vector2:f,orientation:"Left"===c||"Right"===c?"Horizontal":"Vertical"},!0),s.segments.push(D)):h===Z.NoOfSegments.Two?(u=e[1],m={angle:M(i,u),distance:.5*K.findLength(i,u)},f={angle:M(n,u),distance:.5*K.findLength(n,u)},c=K.direction(i,u),D=new Xa(s,"segments",{type:"Bezier",isInternalSegment:!0,vector1:m,vector2:f,orientation:"Left"===c||"Right"===c?"Horizontal":"Vertical"},!0),s.segments.push(D)):h===Z.NoOfSegments.Three?(T=e[1],d=e[e.length-2],u={x:.5*(T.x+d.x),y:.5*(T.y+d.y)},m={angle:M(i,T),distance:.5*K.findLength(i,T)},f={angle:M(u,T),distance:.5*K.findLength(u,T)},y=K.direction(i,T),v=new Xa(s,"segments",{type:"Bezier",isInternalSegment:!0,vector1:m,vector2:f,point:u,orientation:"Left"===y||"Right"===y?"Horizontal":"Vertical"},!0),s.segments.push(v),b={angle:M(u,d),distance:.5*K.findLength(u,d)},S={angle:M(n,d),distance:.5*K.findLength(n,d)},w=K.direction(u,d),x=new Xa(s,"segments",{type:"Bezier",isInternalSegment:!0,vector1:b,vector2:S,orientation:"Left"===w||"Right"===w?"Horizontal":"Vertical"},!0),s.segments.push(x)):h===Z.NoOfSegments.Four?(T=e[1],d=e[2],l=e[3],p={x:.5*(T.x+d.x),y:.5*(T.y+d.y)},g={x:.5*(d.x+l.x),y:.5*(d.y+l.y)},m={angle:M(i,T),distance:.5*K.findLength(i,T)},f={angle:M(p,T),distance:.5*K.findLength(p,T)},y=K.direction(i,T),v=new Xa(s,"segments",{type:"Bezier",isInternalSegment:!0,vector1:m,vector2:f,point:p,orientation:"Left"===y||"Right"===y?"Horizontal":"Vertical"},!0),s.segments.push(v),b={angle:M(p,d),distance:.5*K.findLength(p,d)},S={angle:M(g,d),distance:.5*K.findLength(g,d)},w=K.direction(p,d),x=new Xa(s,"segments",{type:"Bezier",isInternalSegment:!0,vector1:b,vector2:S,point:g,orientation:"Left"===w||"Right"===w?"Horizontal":"Vertical"},!0),s.segments.push(x),I={angle:M(g,l),distance:.5*K.findLength(g,l)},C={angle:M(n,l),distance:.5*K.findLength(n,l)},P=K.direction(g,l),A=new Xa(s,"segments",{type:"Bezier",isInternalSegment:!0,vector1:I,vector2:C,orientation:"Left"===P||"Right"===P?"Horizontal":"Vertical"},!0),s.segments.push(A)):h===Z.NoOfSegments.Five?(T=e[1],d=e[2],l=e[3],c=e[4],p={x:.5*(T.x+d.x),y:.5*(T.y+d.y)},g={x:.5*(d.x+l.x),y:.5*(d.y+l.y)},u={x:.5*(l.x+c.x),y:.5*(l.y+c.y)},m={angle:M(i,T),distance:.5*K.findLength(i,T)},f={angle:M(p,T),distance:.5*K.findLength(p,T)},y=K.direction(i,T),v=new Xa(s,"segments",{type:"Bezier",isInternalSegment:!0,vector1:m,vector2:f,point:p,orientation:"Left"===y||"Right"===y?"Horizontal":"Vertical"},!0),s.segments.push(v),b={angle:M(p,d),distance:.5*K.findLength(p,d)},S={angle:M(g,d),distance:.5*K.findLength(g,d)},w=K.direction(p,d),x=new Xa(s,"segments",{type:"Bezier",isInternalSegment:!0,vector1:b,vector2:S,point:g,orientation:"Left"===w||"Right"===w?"Horizontal":"Vertical"},!0),s.segments.push(x),I={angle:M(g,l),distance:.5*K.findLength(g,l)},C={angle:M(u,l),distance:.5*K.findLength(u,l)},P=K.direction(g,l),A=new Xa(s,"segments",{type:"Bezier",isInternalSegment:!0,vector1:I,vector2:C,point:u,orientation:"Left"===P||"Right"===P?"Horizontal":"Vertical"},!0),s.segments.push(A),h={angle:M(u,c),distance:.5*K.findLength(u,c)},e={angle:M(n,c),distance:.5*K.findLength(n,c)},i=K.direction(u,c),T=new Xa(s,"segments",{type:"Bezier",isInternalSegment:!0,vector1:h,vector2:e,orientation:"Left"===i||"Right"===i?"Horizontal":"Vertical"},!0),s.segments.push(T)):(D=new Xa(s,"segments",{type:"Bezier"},!0),s.segments.push(D))}else for(var O=0;O<s.segments.length;O++)s.bezierSettings.allowSegmentsReset&&(s.segments[parseInt(O.toString(),10)].isInternalSegment=!0)}return a}function Ti(t){t=13<=t.connectorSpacing?13:t.connectorSpacing<=1?1:t.connectorSpacing;return t}function M(t,e){var i={x:e.x,y:t.y},i=K.findLength(i,e),n=K.findLength(e,t),i=180*(i=Math.asin(i/n))/Math.PI;return t.x<e.x?t.y>e.y&&(i=360-i):i=t.y<e.y?180-i:180+i,i}function Di(t,e){var i;switch(e){case"Left":i=t.middleLeft;break;case"Top":i=t.topCenter;break;case"Right":i=t.middleRight;break;case"Bottom":i=t.bottomCenter}return i}function Oi(t,e,i){return K.transform(t,i,e)}function Mi(t,e,i,n,r){i={x:i.x,y:i.y},n={x:n.x,y:n.y};var o,a,s,h=r?t.targetWrapper:t.sourceWrapper,d=r?t.targetPadding:t.sourcePadding,l=r||"Orthogonal"===t.type||"Bezier"===t.type?i:n,c=h,p=Ap(-h.parentTransform,h.offsetX,h.offsetY,i),g=Ap(-h.parentTransform,h.offsetX,h.offsetY,n);return"Orthogonal"===t.type||"Bezier"===t.type?(p.x===g.x&&(p.y<g.y?p.y-=5:p.y+=5),p.y===g.y&&(p.x<g.x?p.x-=5:p.x+=5),i=Ap(h.parentTransform,h.offsetX,h.offsetY,p)):r?(s=K.findAngle(i,n),n=K.transform({x:n.x,y:n.y},s,Math.max(h.actualSize.width,h.actualSize.height))):(s=K.findAngle(n,i),i=K.transform({x:i.x,y:i.y},s,Math.max(h.actualSize.width,h.actualSize.height))),(t.sourcePadding||t.targetPadding)&&(o=new k(h.bounds.x-d,h.bounds.y-d,h.actualSize.width+2*d,h.actualSize.height+2*d)),h instanceof P&&h.data?(a=o?[o.topLeft,o.topRight,o.bottomRight,o.bottomLeft]:c.getPoints(),c.data.split("m").length-1+(c.data.split("M").length-1)==1&&(a[a.length]=a[0])):(a=o?[o.topLeft,o.topRight,o.bottomRight,o.bottomLeft]:gh(0,h.corners))[a.length]=a[0],Li({x1:i.x,y1:i.y,x2:n.x,y2:n.y},a,0,l)||i}function Ei(t,e,i){e.x=Math.round(100*e.x)/100,e.y=Math.round(100*e.y)/100,i?t.targetPoint=e:t.sourcePoint=e}function Li(t,e,i,n){var r,o=e.length,a=zi(t,{x1:e[0].x,y1:e[0].y,x2:e[1].x,y2:e[1].y});if(a&&(r=K.distancePoints(a,n)),isNaN(r)||0<r)for(var s=1;s<o-1;s++){var h=zi(t,{x1:e[parseInt(s.toString(),10)].x,y1:e[parseInt(s.toString(),10)].y,x2:e[s+1].x,y2:e[s+1].y});if(h){var d=K.distancePoints(h,n);if((isNaN(r)||d<r)&&(r=d,a=h),0<=r&&r<=1)break}}return a}function zi(t,e){var i=t.x1,n=t.y1,r=t.x2,t=t.y2,o=e.x1,a=e.y1,s=e.x2,e=e.y2,h=t-n,d=i-r,l=r*n-i*t,c=h*o+d*a+l,p=h*s+d*e+l;return 0!=c&&0!=p&&0<=c*p||(t=(c=e-a)*r+(p=o-s)*t+(r=s*a-o*e),0!=(s=c*i+p*n+r)&&0!=t&&0<=s*t)||0==(a=h*p-c*d)?null:(a<0?-a/2:a/2,{x:(o=d*r-p*l)<(e=0)?(o-e)/a:(o+e)/a,y:(o=c*l-h*r)<0?(o-e)/a:(o+e)/a})}function ki(t,e,i){switch(e.direction){case"Left":e.point.x>t.left&&(i=e.point.x-t.left>i?e.point.x-t.left+i:i);break;case"Right":e.point.x<t.right&&(i=t.right-e.point.x>i?t.right-e.point.x+i:i);break;case"Top":e.point.y>t.top&&(i=e.point.y-t.top>i?e.point.y-t.top+i:i);break;case"Bottom":e.point.y<t.bottom&&(i=t.bottom-e.point.y>i?t.bottom-e.point.y+i:i)}return i}function Bi(t,e){switch(t.direction){case"Left":case"Right":var i={x:e.point.x,y:t.point.y},n=K.equals(t.point,i)||K.equals(e.point,i)?[t.point,e.point]:[t.point,i,e.point];break;case"Top":case"Bottom":i={x:t.point.x,y:e.point.y};n=K.equals(t.point,i)||K.equals(e.point,i)?[t.point,e.point]:[t.point,i,e.point]}return n}function Ri(t,e,i,n,r,o){n=n||20,(o=void 0===o?!1:o)&&e.direction!==i.direction&&(n="Left"===e.direction||"Right"===e.direction?Math.floor(.5*Math.abs(e.point.x-i.point.x)):Math.floor(.5*Math.abs(e.point.y-i.point.y)));var a,s,h,o=t.sourcePortWrapper,d=i.point.x-e.point.x,l=i.point.y-e.point.y;if(!r&&(Math.abs(d)<.001||Math.abs(l)<.001)&&void 0===i.direction)return[e.point,i.point];if(void 0===t.targetWrapper&&Math.abs(d)<=31&&Math.abs(l)<=31){if("Left"===e.direction||"Right"===e.direction?Math.abs(l)<12&&(e.direction=e.point.y>i.point.y?"Top":"Bottom"):Math.abs(d)<12&&(e.direction=e.point.x>i.point.x?"Left":"Right"),12<Math.abs(d)||12<Math.abs(l))return Bi(e,i);n+=5}return"Left"===e.direction||"Right"===e.direction?("Right"===e.direction?(void 0!==i.direction&&"Right"===i.direction&&(n=Math.max(e.point.x,i.point.x)-e.point.x+n),e.point.x>i.point.x&&void 0===o&&(n=-n)):(void 0!==i.direction&&"Left"===i.direction&&(n=e.point.x-Math.min(e.point.x,i.point.x)+n),(e.point.x>i.point.x||void 0!==o||"Left"===e.direction)&&(n=-n)),h=i.point.y-e.point.y,a=Oi(e.point,n,0),0!==(h=i.point.y-a.y)&&(s=Oi(a,i.point.y-a.y,90))):"Top"!==e.direction&&"Bottom"!==e.direction||("Bottom"===e.direction?void 0!==i.direction&&"Bottom"===i.direction&&(n=Math.max(e.point.y,i.point.y)-e.point.y+n):(void 0!==i.direction&&"Top"===i.direction&&(n=e.point.y-Math.min(e.point.y,i.point.y)+n),(e.point.y>i.point.y||void 0!==o||"Top"===e.direction)&&(n=-n)),h=i.point.x-e.point.x,a=(e.direction,Oi(e.point,n,90)),0!==(h=i.point.x-a.x)&&(s=Oi(a,i.point.x-a.x,0))),0===h?[e.point,i.point]:[e.point,a,s,i.point]}function Ni(t,e,i,n,r,o){var a;switch(void 0===r&&(r=20),void 0===o&&(o=!1),void 0===i?(t.margin={left:2,right:2,top:2,bottom:2},e.margin={left:0,right:5,top:0,bottom:5},o&&(t.margin={left:10,right:10,top:10,bottom:10},e.margin={left:10,right:10,top:10,bottom:10},"Left"===t.direction?(r=Wi(t,e,i,r),5<=t.corners.left-e.corners.right&&(r=Math.abs(t.point.x-t.corners.left)+.5*Math.floor(t.corners.left-e.corners.right))):"Right"===t.direction?(r=_i(t,e,r,i),5<=e.corners.left-t.corners.right&&(r=Math.abs(t.point.x-t.corners.right)+.5*Math.floor(e.corners.left-t.corners.right))):"Top"===t.direction?(r=Hi(t,e,i,r),5<=t.corners.top-e.corners.bottom&&(r=Math.abs(t.point.y-t.corners.top)+.5*Math.floor(t.corners.top-e.corners.bottom))):"Bottom"===t.direction&&(r=Yi(t,e,r,i),5<=e.corners.top-t.corners.bottom)&&(r=Math.abs(t.point.y-t.corners.bottom)+.5*Math.floor(e.corners.top-t.corners.bottom)))):("Bottom"===t.direction?o?e.corners.top-t.corners.bottom<20&&(r=e.corners.bottom-t.point.y+25):e.corners.top>t.corners.bottom&&e.corners.top-t.corners.bottom<20&&(r=(e.corners.top-t.corners.bottom)/2):"Top"===t.direction?o?t.corners.top-e.corners.bottom<20&&(r=t.point.y-e.corners.top+25):e.corners.bottom<t.corners.top&&t.corners.top-e.corners.bottom<20&&(r=(t.corners.top-e.corners.bottom)/2):"Right"===t.direction?o?e.corners.left-t.corners.right<20&&(r=e.corners.right-t.point.x+25):e.corners.left>t.corners.right&&e.corners.left-t.corners.right<20&&(r=(e.corners.left-t.corners.right)/2):"Left"===t.direction&&(o?t.corners.left-e.corners.right<20&&(r=t.point.x-e.corners.left+25):e.corners.right<t.corners.left&&t.corners.left-e.corners.right<20&&(r=(t.corners.left-e.corners.right)/2)),i===e.direction&&o&&("Bottom"===e.direction&&t.point.y>e.point.y||"Top"===e.direction&&t.point.y<e.point.y?"Left"===t.direction?r=Wi(t,e,i,20):"Right"===t.direction&&(r=_i(t,e,20,i)):("Right"===e.direction&&t.point.x>e.point.x||"Left"===e.direction&&t.point.x<e.point.x)&&("Top"===t.direction?r=Hi(t,e,i,20):"Bottom"===t.direction&&(r=Yi(t,e,20,i))))),t.direction){case"Left":r=o?r:Wi(t,e,i,r),a=Oi(t.point,r,180);break;case"Right":r=o?r:_i(t,e,r,i),a=Oi(t.point,r,0);break;case"Top":r=o?r:Hi(t,e,i,r),a=Oi(t.point,r,270);break;case"Bottom":r=o?r:Yi(t,e,r,i),a=Oi(t.point,r,90)}return void 0!==n?n.push(a):n=[t.point,a],"Top"===t.direction||"Bottom"===t.direction?ji(a,"horizontal",t,e,n,o):"Right"!==t.direction&&"Left"!==t.direction||ji(a,"vertical",t,e,n,o),n}function ji(t,e,i,n,r,o){"horizontal"===e?(i.margin={left:0,right:10,top:0,bottom:10},n.margin={left:0,right:10,top:0,bottom:10}):"vertical"===e&&(i.margin={left:10,right:0,top:10,bottom:0},n.margin={left:10,right:0,top:10,bottom:0});var a,s,h,d,l=20;if("horizontal"===e){switch(n.direction){case"Left":l=i.corners.right+i.margin.right<n.corners.left-n.margin.left&&(n.corners.left-i.margin.right-i.corners.right>l||i.corners.top-i.margin.top<=n.point.y&&i.corners.bottom+i.margin.bottom>=n.point.y)?(d=!o||"Top"!==i.direction&&"Bottom"!==i.direction?Math.min(Math.abs(n.corners.left-i.corners.right)/2,20):Math.abs(n.corners.left-i.corners.right)/2,i.corners.right-t.x+d):"Top"===i.direction&&t.y>n.point.y||"Bottom"===i.direction&&t.y<n.point.y?Math.min(n.corners.left,t.x)-t.x-20:t.x>=i.corners.left-i.margin.left&&t.x<=i.corners.right+i.margin.right?Math.min(n.corners.left,i.corners.left)-t.x-20:n.corners.left-t.x-20;break;case"Right":l=i.corners.left-i.margin.left>n.corners.right+n.margin.right&&(i.corners.left-i.margin.right-n.corners.right>l||i.corners.top-i.margin.top<=n.point.y&&i.corners.bottom+i.margin.bottom>=n.point.y)?(d=!o||"Top"!==i.direction&&"Bottom"!==i.direction?Math.min(Math.abs(i.corners.left-n.corners.right)/2,20):Math.abs(i.corners.left-n.corners.right)/2,i.corners.left-t.x-d):"Top"===i.direction&&t.y>n.point.y||"Bottom"===i.direction&&t.y<n.point.y?Math.max(n.corners.right,t.x)-t.x+20:t.x>=i.corners.left-i.margin.left&&t.x<=i.corners.right+i.margin.right?Math.max(n.corners.right,i.corners.right)-t.x+20:n.corners.right-t.x+20}a=Oi(t,l,0),s=Oi(a,n.point.y-t.y,90),h=n.point}else if("vertical"===e){switch(n.direction){case"Top":l=i.corners.bottom+i.margin.bottom<n.corners.top-n.margin.top&&(n.corners.top-i.margin.top-i.corners.bottom>l||i.corners.left-i.margin.left<=n.point.x&&i.corners.right+i.margin.right>=n.point.x)?(d=!o||"Right"!==i.direction&&"Left"!==i.direction?Math.min(Math.abs(n.corners.top-i.corners.bottom)/2,20):Math.abs(n.corners.top-i.corners.bottom)/2,i.corners.bottom-t.y+d):"Left"===i.direction&&t.x>n.point.x||"Right"===i.direction&&t.x<n.point.x?Math.min(n.corners.top,t.y)-t.y-20:t.y>=i.corners.top-i.margin.top&&t.y<=i.corners.bottom+i.margin.bottom?Math.min(n.corners.top,i.corners.top)-t.y-20:n.corners.top-t.y-20;break;case"Bottom":l=i.corners.top-i.margin.top>n.corners.bottom+n.margin.bottom&&(i.corners.top-i.margin.top-n.corners.bottom>l||i.corners.left-i.margin.left<=n.point.x&&i.corners.right+i.margin.right>=n.point.x)?(d=!o||"Right"!==i.direction&&"Left"!==i.direction?Math.min(Math.abs(i.corners.top-n.corners.bottom)/2,20):Math.abs(i.corners.top-n.corners.bottom)/2,i.corners.top-t.y-d):"Left"===i.direction&&t.x>n.point.x||"Right"===i.direction&&t.x<n.point.x?Math.max(n.corners.bottom,t.y)-t.y+20:t.y>=i.corners.top-i.margin.top&&t.y<=i.corners.bottom+i.margin.bottom?Math.max(n.corners.bottom,i.corners.bottom)-t.y+20:n.corners.bottom-t.y+20}a=Oi(t,l,90),s=Oi(a,n.point.x-t.x,0),h=n.point}r.push(a),r.push(s),r.push(h)}function Hi(t,e,i,n){return t.corners.top-t.margin.top>e.corners.top+e.margin.top&&t.corners.top-t.margin.top<=e.corners.bottom+e.margin.bottom?(("Right"===e.direction&&t.point.x<e.point.x||"Left"===e.direction&&t.point.x>e.point.x)&&(n+=t.corners.top-e.corners.top),n+=t.point.y-t.corners.top):void 0!==i&&"Left"!==i&&"Right"===e.direction&&t.point.x<e.point.x||void 0!==i&&"Right"!==i&&"Left"===e.direction&&e.point.x<t.point.x?n+=Math.abs(t.point.y-e.corners.bottom):n+=t.point.y-t.corners.top,n}function Wi(t,e,i,n){return t.corners.left-t.margin.left>e.corners.left-e.margin.left&&t.corners.left-t.margin.left<=e.corners.right+e.margin.right?(("Bottom"===e.direction&&t.point.y<e.point.y||"Top"===e.direction&&t.point.y>e.point.y)&&(n+=t.corners.left-e.corners.left),n+=t.point.x-t.corners.left):void 0!==i&&"Top"!==i&&"Bottom"===e.direction&&t.point.y<e.point.y||void 0!==i&&"Bottom"!==i&&"Top"===e.direction&&e.point.y<t.point.y?n+=Math.abs(t.point.x-e.corners.right):n+=t.point.x-t.corners.left,n}function _i(t,e,i,n){return t.corners.right+t.margin.right<e.corners.right+e.margin.right&&t.corners.right+t.margin.right>=e.corners.left-e.margin.left?(("Bottom"===e.direction&&t.point.y<e.point.y||"Top"===e.direction&&t.point.y>e.point.y)&&(i+=e.corners.right-t.corners.right),i+=t.corners.right-t.point.x):void 0!==n&&"Top"!==n&&"Bottom"===e.direction&&t.point.y<e.point.y||void 0!==n&&"Bottom"!==n&&"Top"===e.direction&&e.point.y<t.point.y?i+=Math.abs(t.point.x-e.corners.right):i+=t.corners.right-t.point.x,i}function Yi(t,e,i,n){return t.corners.bottom+t.margin.bottom<e.corners.bottom+e.margin.bottom&&t.corners.bottom+t.margin.bottom>=e.corners.top-e.margin.top?(("Right"===e.direction&&t.point.x<e.point.x||"Left"===e.direction&&t.point.x>e.point.x)&&(i+=e.corners.bottom-t.corners.bottom),i+=t.corners.bottom-t.point.y):void 0!==n&&"Left"!==n&&"Right"===e.direction&&t.point.x<e.point.x||void 0!==n&&"Right"!==n&&"Left"===e.direction&&e.point.x<t.point.x?i+=Math.abs(t.point.y-e.corners.bottom):i+=t.corners.bottom-t.point.y,i}function Xi(t,e){var i=t.direction,i=(t.direction=e.direction,e.direction=i,t.point),i=(t.point=e.point,e.point=i,t.corners);t.corners=e.corners,e.corners=i}function Vi(t,e,i,n){var i=void 0===e?i:e,e=i.topLeft,r=i.topRight,o=i.bottomRight,a=i.bottomLeft,i=i.center,t=M(i,t),o=M(i,o),a=M(i,a),e=M(i,e),i=M(i,r),r=e<t&&t<i?"Top":o<=t&&t<a?"Bottom":a<=t&&t<=e?"Left":"Right";return r}function Fi(t){var e=t.wrapper.children[0].bounds;return"None"!==t.sourceDecorator.shape&&e.uniteRect(t.wrapper.children[1].bounds),"None"!==t.targetDecorator.shape&&e.uniteRect(t.wrapper.children[2].bounds),e}function Ui(t){switch(t){case"Top":return"Bottom";case"Bottom":return"Top";case"Left":return"Right";case"Right":return"Left"}return"auto"}Gi=function(t,e){return(Gi=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)};var Gi,Zi,Ie=function(t,e){function i(){this.constructor=t}Gi(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},e=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;0<=s;s--)(r=t[s])&&(a=(o<3?r(a):3<o?r(e,i,a):r(e,i))||a);return 3<o&&a&&Object.defineProperty(e,i,a),a},Ki=(Zi=N.ChildProperty,Ie(qi,Zi),e([N.Property()],qi.prototype,"width",void 0),e([N.Property()],qi.prototype,"height",void 0),qi);function qi(){return null!==Zi&&Zi.apply(this,arguments)||this}Qi=N.ChildProperty,Ie(Ji,Qi),e([N.Property()],Ji.prototype,"width",void 0),e([N.Property()],Ji.prototype,"height",void 0),e([N.Property()],Ji.prototype,"fit",void 0),e([N.Property()],Ji.prototype,"description",void 0),e([N.Property()],Ji.prototype,"template",void 0),e([N.Property()],Ji.prototype,"tooltip",void 0);var Qi,Ie=Ji;function Ji(){return null!==Qi&&Qi.apply(this,arguments)||this}$i=function(t,e){return($i=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)};var $i,tn,e=function(t,e){function i(){this.constructor=t}$i(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},en=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;0<=s;s--)(r=t[s])&&(a=(o<3?r(a):3<o?r(e,i,a):r(e,i))||a);return 3<o&&a&&Object.defineProperty(e,i,a),a},e=(tn=N.ChildProperty,e(nn,tn),en([N.Property("")],nn.prototype,"id",void 0),en([N.Property(Number.MIN_VALUE)],nn.prototype,"zIndex",void 0),en([N.Complex({},ft)],nn.prototype,"margin",void 0),en([N.Property(!0)],nn.prototype,"visible",void 0),en([N.Complex({},t)],nn.prototype,"tooltip",void 0),en([N.Property(!1)],nn.prototype,"excludeFromLayout",void 0),en([N.Property()],nn.prototype,"addInfo",void 0),en([N.Property(Z.FlipDirection.None)],nn.prototype,"flip",void 0),en([N.Property("All")],nn.prototype,"flipMode",void 0),en([N.Complex({},Ie)],nn.prototype,"symbolInfo",void 0),nn);function nn(){return null!==tn&&tn.apply(this,arguments)||this}rn=function(t,e){return(rn=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)};(function(t,e){function i(){this.constructor=t}rn(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)})(sn,on=qt),sn.prototype.getNodeTemplate=function(){return this.templateFn},Object.defineProperty(sn.prototype,"content",{get:function(){return this.data},set:function(t){this.data=t,this.canReset||(this.canReset=!0,this.isTemplate||(this.template=op(this,!0)),this.canReset=!1,this.isDirt=!0)},enumerable:!0,configurable:!0});var rn,on,an=sn;function sn(t,e,i,n){var r=on.call(this)||this;return r.data="",r.nodeId="",r.annotationId="",r.diagramId="",r.diagramId=e,r.nodeId=t,r.annotationId=i,r.templateFn=pp(n),r}hn=function(t,e){return(hn=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)};var hn,dn,en=function(t,e){function i(){this.constructor=t}hn(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},i=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;0<=s;s--)(r=t[s])&&(a=(o<3?r(a):3<o?r(e,i,a):r(e,i))||a);return 3<o&&a&&Object.defineProperty(e,i,a),a},ln=(dn=N.ChildProperty,en(cn,dn),i([N.Property("")],cn.prototype,"id",void 0),i([N.Property("transparent")],cn.prototype,"fill",void 0),i([N.Property("black")],cn.prototype,"iconStrokeColor",void 0),i([N.Property(0)],cn.prototype,"iconStrokeWidth",void 0),i([N.Property(!0)],cn.prototype,"visibility",void 0),i([N.Property(10)],cn.prototype,"width",void 0),i([N.Property(10)],cn.prototype,"height",void 0),i([N.Property("transparent")],cn.prototype,"handleStrokeColor",void 0),i([N.Property(1)],cn.prototype,"handleStrokeWidth",void 0),i([N.Property("")],cn.prototype,"pathData",void 0),i([N.Property(0)],cn.prototype,"cornerRadius",void 0),i([N.Complex({left:0,right:0,top:0,bottom:0},ft)],cn.prototype,"padding",void 0),i([N.Complex({},t)],cn.prototype,"tooltip",void 0),cn);function cn(){return null!==dn&&dn.apply(this,arguments)||this}en(un,pn=ln),i([N.Complex({x:0,y:0},K)],un.prototype,"offset",void 0),i([N.Complex({},ft)],un.prototype,"margin",void 0);var pn,gn=un;function un(){return null!==pn&&pn.apply(this,arguments)||this}en(yn,mn=ln),i([N.Property(.5)],yn.prototype,"offset",void 0),i([N.Property("Center")],yn.prototype,"alignment",void 0),i([N.Complex({x:0,y:0},K)],yn.prototype,"displacement",void 0);var mn,fn=yn;function yn(){return null!==mn&&mn.apply(this,arguments)||this}function vn(t){return!t||(t instanceof Ze||t instanceof Qe?t.constraints&Z.AnnotationConstraints.Select:t instanceof W?t.constraints&Z.ConnectorConstraints.Select:t.constraints&Z.NodeConstraints.Select)}function bn(t){return t?t instanceof Ze||t instanceof Qe?t.constraints&Z.AnnotationConstraints.Drag:t instanceof W?t.constraints&Z.ConnectorConstraints.Drag:t instanceof B?1:t.constraints&Z.NodeConstraints.Drag:1}function Sn(t){return t instanceof W?t.constraints&Z.ConnectorConstraints.Delete:t.constraints&Z.NodeConstraints.Delete}function wn(t){return t.constraints&Z.ConnectorConstraints.DragSourceEnd}function xn(t){return t.constraints&Z.ConnectorConstraints.DragTargetEnd}function In(t){return t.constraints&Z.ConnectorConstraints.DragSegmentThumb}function Cn(t){return t instanceof Ze||t instanceof Qe?t.constraints&Z.AnnotationConstraints.Rotate:t.constraints&Z.NodeConstraints.Rotate}function Pn(t){return t.constraints&Z.NodeConstraints.Shadow}function An(t){return t instanceof _&&t.constraints&Z.NodeConstraints.InConnect&&t.constraints&Z.NodeConstraints.InConnect}function Tn(t){return t&&t.constraints&&!(t.constraints&Z.PortConstraints.None)&&t.constraints&Z.PortConstraints.InConnect&&t.constraints&Z.PortConstraints.InConnect}function Dn(t){return t instanceof _&&t.constraints&Z.NodeConstraints.OutConnect&&t.constraints&Z.NodeConstraints.OutConnect}function On(t){return t&&t.constraints&&!(t.constraints&Z.PortConstraints.None)&&t.constraints&Z.PortConstraints.OutConnect&&t.constraints&Z.PortConstraints.OutConnect}function Mn(t,e){var i=0;return t instanceof Ze||t instanceof Qe?i=t.constraints&Z.AnnotationConstraints.Resize:t&&("SouthEast"===e?i=t.constraints&Z.NodeConstraints.ResizeSouthEast:"East"===e?i=t.constraints&Z.NodeConstraints.ResizeEast:"NorthEast"===e?i=t.constraints&Z.NodeConstraints.ResizeNorthEast:"South"===e?i=t.constraints&Z.NodeConstraints.ResizeSouth:"North"===e?i=t.constraints&Z.NodeConstraints.ResizeNorth:"SouthWest"===e?i=t.constraints&Z.NodeConstraints.ResizeSouthWest:"West"===e?i=t.constraints&Z.NodeConstraints.ResizeWest:"NorthWest"===e&&(i=t.constraints&Z.NodeConstraints.ResizeNorthWest)),i}function En(t){return t instanceof W?t.constraints&Z.ConnectorConstraints.AllowDrop:t.constraints&Z.NodeConstraints.AllowDrop}function Ln(t){return t.constraints&Z.DiagramConstraints.Virtualization}function zn(t){return t.tool&Z.DiagramTools.SingleSelect}function kn(t){return t.tool&Z.DiagramTools.MultipleSelect}function Bn(t){return t.tool&Z.DiagramTools.ZoomPan}function Rn(t){return t.tool&Z.DiagramTools.ContinuousDraw}function Nn(t){return t.tool&Z.DiagramTools.DrawOnce}function jn(t){return t.tool&Z.DiagramTools.SingleSelect||t.tool&Z.DiagramTools.MultipleSelect}function Hn(t){return t.constraints&Z.DiagramConstraints.UserInteraction}function Wn(t){return t.constraints&Z.DiagramConstraints.ZoomTextEdit}function _n(t){return t.constraints&Z.DiagramConstraints.ApiUpdate||t.diagramActions&Z.DiagramAction.ToolAction}function Yn(t){return t.constraints&Z.PortConstraints.Draw}function Xn(t){return t.constraints&Z.PortConstraints.Drag}function Vn(t){return!(t&Z.RendererAction.DrawSelectorBorder)}function Fn(t){return!!(t&Z.RendererAction.PreventRenderSelector)}Un=function(t,e){return(Un=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)};var Un,Gn,en=function(t,e){function i(){this.constructor=t}Un(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Zn=(en(Kn,Gn=te),Kn.prototype.rowDefinitions=function(){return this.rowDefns},Kn.prototype.columnDefinitions=function(){return this.colDefns},Kn.prototype.addObject=function(t,e,i,n,r){var o;this.rows.length>=e&&(o=this.rows[parseInt(e.toString(),10)]).cells.length>i&&(r=r||1,n=n||1,(o=o.cells[parseInt(i.toString(),10)]).columnSpan=Math.max(r,o.columnSpan),o.rowSpan=Math.max(n,o.rowSpan),n=new nr,(n=t).rowId=e,n.columnId=i,n.columnSpan=r,this.childTable[n.id]=n,this.addObjectToCell(n,o))},Kn.prototype.addObjectToCell=function(t,e){e.children||(e.children=[]),t.style.strokeColor="black",t.style.strokeWidth=1,e.children.push(t)},Kn.prototype.updateProperties=function(t,e,i,n){this.offsetX=t,this.offsetY=e,this.width=i,this.height=n},Kn.prototype.setDefinitions=function(t,e){this.rowDefns=t,this.colDefns=e,this.children=[],this.rows=this.rows||[];for(var i=0;i<t.length;i++){var n=t[parseInt(i.toString(),10)],r=new $n,o=(r.cells=[],new Jn),a=(o.width=this.width,this.colDefns);(void 0===a||a.length<1)&&(a=[o]),this.addCellInRow(a,n,r),this.rows.push(r)}},Kn.prototype.addCellInRow=function(t,e,i){for(var n=0;n<t.length;n++){var r=t[parseInt(n.toString(),10)],o=new tr;o.children=[],this.cellStyle.fill="none",this.cellStyle.strokeColor="none",o.id=q(),o.style=this.cellStyle,o.desiredCellWidth=o.minWidth=r.width,o.desiredCellHeight=o.minHeight=e.height,i.cells.push(o),this.children.push(o)}},Kn.prototype.calculateSize=function(){for(var t=this.rows||[],e=0,i=0,n=0;n<t.length;n++)for(var r=this.rows[parseInt(n.toString(),10)],i=0,o=0;o<r.cells.length;o++)if(i+=r.cells[parseInt(o.toString(),10)].desiredCellWidth,o===r.cells.length-1&&(this.width&&this.width!==i&&(r.cells[parseInt(o.toString(),10)].desiredCellWidth+=this.width-i,r.cells[parseInt(o.toString(),10)].minWidth=r.cells[parseInt(o.toString(),10)].desiredCellWidth,r.cells[parseInt(o.toString(),10)].children&&r.cells[parseInt(o.toString(),10)].children.length&&(r.cells[parseInt(o.toString(),10)].children[0].width=r.cells[parseInt(o.toString(),10)].desiredCellWidth),this.colDefns[parseInt(o.toString(),10)].width=r.cells[parseInt(o.toString(),10)].desiredCellWidth),e+=r.cells[parseInt(o.toString(),10)].desiredCellHeight,n===t.length-1)&&this.height&&this.height!==e){var a=this.height-e;if(0<a){for(var s=0;s<r.cells.length;s++)r.cells[parseInt(s.toString(),10)].desiredCellHeight+=a,r.cells[parseInt(s.toString(),10)].minHeight=r.cells[parseInt(s.toString(),10)].desiredCellHeight=r.cells[parseInt(s.toString(),10)].desiredCellHeight,r.cells[parseInt(s.toString(),10)].children&&r.cells[parseInt(s.toString(),10)].children.length&&(r.cells[parseInt(s.toString(),10)].children[0].height=r.cells[parseInt(s.toString(),10)].desiredCellHeight);this.rowDefns[parseInt(n.toString(),10)].height+=a}}},Kn.prototype.updateRowHeight=function(t,e,i,n,r){var o=this.rows[parseInt(t.toString(),10)];this.rowDefns[parseInt(t.toString(),10)].height=e,void 0!==this.height&&(this.height+=e-o.cells[0].desiredCellHeight);for(var a=0;a<o.cells.length;a++)o.cells[parseInt(a.toString(),10)].desiredCellHeight=o.cells[parseInt(a.toString(),10)].minHeight=e,o.cells[parseInt(a.toString(),10)].children&&o.cells[parseInt(a.toString(),10)].children.length&&(o.cells[parseInt(a.toString(),10)].children[0].height=e,this.setTextRefresh(o.cells[parseInt(a.toString(),10)].children[0]));this.desiredRowHeight[parseInt(t.toString(),10)]=e,this.measure(new j(this.width,this.height)),this.arrange(this.desiredSize),i&&e<(i=void 0!==n?this.calculateCellHeightBasedOnChildren(t,n):this.calculateCellHeight(t))&&!r&&this.updateRowHeight(t,i,!1)},Kn.prototype.setTextRefresh=function(t){if(t.children&&t.children.length)for(var e=t.children,i=0;i<e.length;i++)e[parseInt(i.toString(),10)]instanceof H&&e[parseInt(i.toString(),10)].refreshTextElement(),e[parseInt(i.toString(),10)]instanceof F&&this.setTextRefresh(e[parseInt(i.toString(),10)])},Kn.prototype.updateColumnWidth=function(t,e,i,n,r){this.colDefns[parseInt(t.toString(),10)].width=e,void 0!==this.width&&(this.width+=e-this.rows[this.rows.length-1].cells[parseInt(t.toString(),10)].desiredCellWidth);for(var o=0;o<this.rows.length;o++)this.setTextRefresh(this.rows[parseInt(o.toString(),10)].cells[0]),this.rows[parseInt(o.toString(),10)].cells[parseInt(t.toString(),10)].desiredCellWidth=this.rows[parseInt(o.toString(),10)].cells[parseInt(t.toString(),10)].minWidth=e,this.rows[parseInt(o.toString(),10)].cells[parseInt(t.toString(),10)].children&&this.rows[parseInt(o.toString(),10)].cells[parseInt(t.toString(),10)].children.length&&(this.rows[parseInt(o.toString(),10)].cells[parseInt(t.toString(),10)].children[0].width=e);this.desiredCellWidth[parseInt(t.toString(),10)]=e,this.measure(new j(this.width,this.height)),this.arrange(this.desiredSize),i&&e<(i=void 0!==n?this.calculateCellWidthBasedOnChildren(t,n):this.calculateCellWidth(t))&&!r&&this.updateColumnWidth(t,i,!1)},Kn.prototype.calculateCellWidth=function(t){for(var e,i,n=0;n<this.rows.length;n++)1===(i=this.rows[parseInt(n.toString(),10)].cells[parseInt(t.toString(),10)]).columnSpan&&(i=(i.outerBounds.width>i.bounds.width&&(0===i.children.length||void 0===i.children[0].maxWidth)?i.outerBounds:i.bounds).width,e=!e||e<i?i:e);return e},Kn.prototype.calculateCellHeight=function(t){for(var e,i,n=this.rows[parseInt(t.toString(),10)],r=0;r<n.cells.length;r++)i=((i=n.cells[parseInt(r.toString(),10)]).outerBounds.height>i.bounds.height?i.outerBounds:i.bounds).height,e=!e||e<i?i:e;return e},Kn.prototype.calculateCellSizeBasedOnChildren=function(t,e,i,n){var r,o=t&&0<t.children.length?t.children[0]:void 0;if(o&&1===t.columnSpan){r="Width"===e?o.bounds.right:o.bounds.bottom,n=n||("Width"===e?o.bounds.width:o.bounds.height);for(var a=0;a<o.children.length;a++){var s=o.children[parseInt(a.toString(),10)];s instanceof F&&-1===s.id.indexOf("header")&&r<(s=("Width"===e?s.bounds.right:s.bounds.bottom)+i)&&(s=s-r+("Width"===e?o.bounds.width:o.bounds.height),n=n&&(n<s?s:n))}}return n},Kn.prototype.calculateCellWidthBasedOnChildren=function(t,e){for(var i,n,r=0;r<this.rows.length;r++)n=this.rows[parseInt(r.toString(),10)].cells[parseInt(t.toString(),10)],i=this.calculateCellSizeBasedOnChildren(n,"Width",e,i);return i},Kn.prototype.calculateCellHeightBasedOnChildren=function(t,e){for(var i,n,r=this.rows[parseInt(t.toString(),10)],o=0;o<r.cells.length;o++)n=r.cells[parseInt(o.toString(),10)],i=this.calculateCellSizeBasedOnChildren(n,"Height",e,i);return i},Kn.prototype.addRow=function(t,e,i){0<this.rowDefns.length?this.rowDefns.splice(t,0,e):this.rowDefns.push(e);var n=new $n;n.cells=[];(new Jn).width=this.width;var r=this.colDefns;this.addCellInRow(r,e,n),t>this.rows.length-1?this.rows.push(n):this.rows.splice(t,0,n),i&&(this.measure(new j(this.width,this.height)),this.arrange(this.desiredSize))},Kn.prototype.addColumn=function(t,e,i){var n,r,o,a,s=this.rows;0<this.colDefns.length?this.colDefns.splice(t,0,e):this.colDefns.push(e),void 0!==this.width&&(this.width+=e.width);for(var h=0;h<s.length;h++)n=s[parseInt(h.toString(),10)],r=this.rowDefns[parseInt(h.toString(),10)],o=e,(a=new tr).style=this.cellStyle,a.desiredCellWidth=a.minWidth=o.width,a.desiredCellHeight=a.minHeight=r.height,a.children=[],t>n.cells.length-1?n.cells.push(a):n.cells.splice(t,0,a),this.children.push(a);i&&(this.measure(new j(this.width,this.height)),this.arrange(this.desiredSize))},Kn.prototype.removeRow=function(t){var e,i=this.rows[parseInt(t.toString(),10)];this.height-=this.rowDefns[parseInt(t.toString(),10)].height;for(var n=0;n<i.cells.length;n++)e=i.cells[parseInt(n.toString(),10)],this.children.splice(this.children.indexOf(e),1),(e=document.getElementById(e.id+"_groupElement"))&&e.parentElement&&e.parentElement.removeChild(e);this.rows.splice(t,1),this.rowDefns.splice(t,1),this.measure(new j(this.width,this.height)),this.arrange(this.desiredSize)},Kn.prototype.removeColumn=function(t){var e,i=this.rows;this.width-=this.colDefns[parseInt(t.toString(),10)].width;for(var n=0;n<i.length;n++)e=i[parseInt(n.toString(),10)].cells[parseInt(t.toString(),10)],this.children.splice(this.children.indexOf(e),1),(e=document.getElementById(e.id+"_groupElement"))&&e.parentElement&&e.parentElement.removeChild(e),i[parseInt(n.toString(),10)].cells.splice(t,1);this.colDefns.splice(t,1),this.measure(new j(this.width,this.height)),this.arrange(this.desiredSize)},Kn.prototype.updateRowIndex=function(t,e){var i=this.rows[parseInt(t.toString(),10)],i=(this.rows.splice(t,1),this.rows.splice(e,0,i),this.rowDefns[parseInt(t.toString(),10)]);this.rowDefns.splice(t,1),this.rowDefns.splice(e,0,i),this.measure(new j(this.width,this.height)),this.arrange(this.desiredSize)},Kn.prototype.updateColumnIndex=function(t,e,i){for(var n,r,o=t;o<this.rows.length;o++)n=this.rows[parseInt(o.toString(),10)],r=this.rows[parseInt(o.toString(),10)].cells[parseInt(e.toString(),10)],n.cells.splice(e,1),n.cells.splice(i,0,r);t=this.colDefns[parseInt(e.toString(),10)],this.colDefns.splice(e,1),this.colDefns.splice(i,0,t),t=this.desiredCellWidth[parseInt(e.toString(),10)];this.desiredCellWidth.splice(e,1),this.desiredCellWidth.splice(i,0,t),this.measure(new j(this.width,this.height)),this.arrange(this.desiredSize)},Kn.prototype.measure=function(t){var e=void 0;if(void 0!==this.rows&&0<this.rows.length){var i=0,n=0,e=new j(0,0);this.calculateSize();for(var r=0,o=this.rows;r<o.length;r++){for(var n=0,a=0,s=(p=o[r]).cells;a<s.length;a++){var h=(g=s[a]).measure(new j(g.desiredCellWidth,g.desiredCellHeight));1===g.rowSpan&&(0===n||void 0===this.desiredRowHeight[parseInt(i.toString(),10)]?this.desiredRowHeight[parseInt(i.toString(),10)]=h.height:this.desiredRowHeight[parseInt(i.toString(),10)]=Math.max(h.height,this.desiredRowHeight[parseInt(i.toString(),10)])),1===g.columnSpan&&(0===i||void 0===this.desiredCellWidth[parseInt(n.toString(),10)]?this.desiredCellWidth[parseInt(n.toString(),10)]=h.width:this.desiredCellWidth[parseInt(n.toString(),10)]=Math.max(h.width,this.desiredCellWidth[parseInt(n.toString(),10)]),i===this.rows.length-1)&&(e.width+=this.desiredCellWidth[parseInt(n.toString(),10)]),n++}e.height+=this.desiredRowHeight[parseInt(i.toString(),10)],i++}for(var i=n=0,d=0,l=0,c=this.rows;l<c.length;l++){for(var p,g,u=n=0,m=0,f=(p=c[l]).cells;m<f.length;m++){if(1!==(g=f[m]).columnSpan){for(var y=g.desiredSize.width=0;y<g.columnSpan;y++)y+n<p.cells.length&&(g.desiredSize.width+=this.desiredCellWidth[y+n],g.minWidth=g.desiredSize.width,g.measure(g.desiredSize));n++}else g.desiredSize.width=this.desiredCellWidth[parseInt(u.toString(),10)],g.measure(g.desiredSize);if(1!==g.rowSpan)for(y=g.desiredSize.height=0;y<g.rowSpan;y++)y+d<this.rows.length&&(g.desiredSize.height+=this.desiredRowHeight[y+d],g.minHeight=g.desiredSize.height,g.measure(g.desiredSize));else g.desiredSize.height=this.desiredRowHeight[parseInt(d.toString(),10)],g.measure(g.desiredSize);i++,u++}d++}}return void 0===e&&(e=Gn.prototype.validateDesiredSize.call(this,e,t)),Gn.prototype.stretchChildren.call(this,e),this.desiredSize=e},Kn.prototype.arrange=function(t,e){var i=0,n=0;if(void 0!==this.rows&&0<this.rows.length){for(var r=this.offsetX-t.width*this.pivot.x,o=this.offsetY-t.height*this.pivot.y,a=r,s=0,h=this.rows;s<h.length;s++){for(var a=r,i=0,d=0,l=(m=h[s]).cells;d<l.length;d++){var c=l[d],p=Math.max(this.desiredCellWidth[parseInt(i.toString(),10)],c.desiredSize.width),g=Math.max(this.desiredRowHeight[parseInt(n.toString(),10)],c.desiredSize.height);c.offsetX=a+p*c.pivot.x,c.offsetY=o+g*c.pivot.y,a+=this.desiredCellWidth[parseInt(i.toString(),10)],c.arrange(new j(p,g)),i++}o+=this.desiredRowHeight[parseInt(n.toString(),10)],n++}if(e)for(var u,c=void 0,m=void 0,f=void 0,y=void 0,n=0;n<this.rows.length;n++)for(m=this.rows[parseInt(n.toString(),10)],i=0;i<m.cells.length;i++)if(1<(c=m.cells[parseInt(i.toString(),10)]).columnSpan&&this.children.splice(this.children.indexOf(c)+1,c.columnSpan-1),1<c.rowSpan)for(f=n,y=0;f+c.rowSpan-1<this.rows.length&&y<c.rowSpan-1;f++,y++)u=this.rows[f+1].cells[parseInt(i.toString(),10)],this.children.splice(this.children.indexOf(u),1)}return this.actualSize=t,this.updateBounds(),t},Kn);function Kn(){var t=null!==Gn&&Gn.apply(this,arguments)||this;return t.childTable=[],t.cellStyle={},t.desiredRowHeight=[],t.desiredCellWidth=[],t}var qn,Qn=function(){this.height=void 0},Jn=function(){this.width=void 0},$n=function(){this.cells=null},tr=(en(er,qn=F),er);function er(){var t=null!==qn&&qn.apply(this,arguments)||this;return t.columnSpan=1,t.rowSpan=1,t}en(rr,ir=qt);var ir,nr=rr;function rr(){var t=null!==ir&&ir.apply(this,arguments)||this;return t.rowId=0,t.columnId=0,t.rowSpan=1,t.columnSpan=1,t}function or(t,e,i){i.width||0!==i.shape.phases.length||(i.width=100);var n,r=[],o=[],a=0,s=i.shape,h="Horizontal"===s.orientation,d=(s.header&&s.hasHeader&&dr(r,s.header.height),r),l=h,c=i,p=0,g=c.shape;if(0<d.length)for(var u=0;u<d.length;u++)p+=d[parseInt(u.toString(),10)].height;if(l){if(0<g.phases.length&&g.phaseSize&&(p+=g.phaseSize,dr(d,g.phaseSize)),0<g.lanes.length)for(u=0;u<g.lanes.length;u++)n=g.lanes[parseInt(u.toString(),10)].height,p+=n,u===g.lanes.length-1&&p<c.height&&(n+=c.height-p),dr(d,n)}else if(0<g.phases.length)for(var m=0,u=0;u<g.phases.length;u++){var f=g.phases[parseInt(u.toString(),10)].offset;m+=0===u?f:f-=m,p+=n=f,u===g.phases.length-1&&p<c.height&&(n+=c.height-p),dr(d,n)}else dr(d,c.height);var y,v,b,S,w=o,l=h,x=i,I=0,C=x.shape;if(0<C.phases.length&&"Horizontal"===C.orientation)for(S=0;S<C.phases.length;S++)y=C.phases[parseInt(S.toString(),10)].offset,I+=0===S?y:y-=I,v=lr(y),S===C.phases.length-1&&I<x.width&&(v.width+=x.width-I),w.push(v);else if(l)v=lr(x.width),w.push(v);else{for(C.phaseSize&&0<C.phases.length?C.lanes.length:C.lanes.length,C.phaseSize&&0<C.phases.length&&(I+=C.phaseSize,v=lr(C.phaseSize),w.push(v)),b=0;b<C.lanes.length;b++)I+=C.lanes[parseInt(b.toString(),10)].width,v=lr(C.lanes[parseInt(b.toString(),10)].width),b===C.lanes.length-1&&I<x.width&&(v.width+=x.width-I),w.push(v);0===C.phases.length&&0===C.lanes.length&&(v=lr(x.width),w.push(v))}if(t.setDefinitions(r,o),s.header&&s.hasHeader){for(var l=t,r=e,o=i,P=0,A=l.columnDefinitions(),T=o.shape,D=0;D<A.length;D++)P+=A[parseInt(D.toString(),10)].width;T.header.id=T.header.id||q(),T={id:o.id+T.header.id,annotations:[Q(T.header.annotation)],style:T.header.style||void 0,offsetX:o.offsetX,offsetY:o.offsetY,rowIndex:0,columnIndex:0,maxWidth:P,container:{type:"Canvas",orientation:"Horizontal"}},vn(o)||(T.constraints&=~Z.NodeConstraints.Select),r=ar(r,0,o,T,!0),l.addObject(r,0,0,1,l.columnDefinitions().length),a++}if(0<s.phases.length&&s.phaseSize){for(var O=0;O<s.phases.length;O++)""===s.phases[parseInt(O.toString(),10)].id&&(s.phases[parseInt(O.toString(),10)].id=q()),sr(t,e,i,a,h,O);a++}if(0<s.lanes.length)for(O=0;O<s.lanes.length;O++)""===s.lanes[parseInt(O.toString(),10)].id&&(s.lanes[parseInt(O.toString(),10)].id=q()),hr(t,e,i,a,O,h),a++}function ar(t,e,i,n,r,o,a,s){var h=new _(t,"nodes",n,!0),n=(h.parentId=i.id,h.isHeader=!!r,h.isPhase=!!o,h.isLane=!!a,o?"PhaseHeaderParent":"LaneHeaderParent");if(s&&(h[n]=s),h.constraints&=~(Z.NodeConstraints.InConnect|Z.NodeConstraints.OutConnect),h.constraints|=Z.NodeConstraints.HideThumbs,t.initObject(h),t.nodes.push(h),0<h.wrapper.children.length){for(var d=0;d<h.wrapper.children.length;d++){var l=h.wrapper.children[parseInt(d.toString(),10)];l instanceof qt&&(l.isCalculateDesiredSize=!1),l instanceof H&&(l.canConsiderBounds=!1,!r&&"Vertical"===i.shape.orientation&&o||"Vertical"!==i.shape.orientation&&a)&&(l.isLaneOrientation=!0,l.refreshTextElement())}h.wrapper.measure(new j(void 0,void 0)),h.wrapper.arrange(h.wrapper.desiredSize)}return h.wrapper}function sr(t,e,i,n,r,o){var a=0,s=0,h=i.shape,n=(r?(s=o,a=n,d=t.columnDefinitions()[parseInt(o.toString(),10)].width):a=h.header&&h.hasHeader?o+1:o,{annotations:[Q(h.phases[parseInt(o.toString(),10)].header.annotation)],maxWidth:d,id:i.id+h.phases[parseInt(o.toString(),10)].id+"_header",addInfo:h.phases[parseInt(o.toString(),10)].addInfo,offsetX:i.offsetX,offsetY:i.offsetY,style:h.phases[parseInt(o.toString(),10)].style,rowIndex:a,columnIndex:s,container:{type:"Canvas",orientation:r?"Horizontal":"Vertical"}}),d=(n.annotations[0].rotateAngle=r?0:270,vn(i)||(n.constraints&=~Z.NodeConstraints.Select),h.phases[parseInt(o.toString(),10)].header.id=n.id,ar(e,0,i,n,!1,!0,!1,h.phases[parseInt(o.toString(),10)].id));t.addObject(d,a,s)}function hr(t,e,i,n,r,o){for(var a,s=i.shape,h=s.phases.length||1,d=s.header&&s.hasHeader?1:0,l=o?n:d,c=s.phaseSize&&0<s.phases.length?1:0,p=0;p<h;p++){var g,u=o?p:r+c,m=t.rows[parseInt(l.toString(),10)].cells[parseInt(u.toString(),10)],m={id:i.id+s.lanes[parseInt(r.toString(),10)].id+p,rowIndex:l,columnIndex:u,width:m.minWidth,height:m.minHeight,offsetX:i.offsetX,offsetY:i.offsetY,style:s.lanes[parseInt(r.toString(),10)].style,addInfo:s.lanes[parseInt(r.toString(),10)].addInfo,constraints:Z.NodeConstraints.Default|Z.NodeConstraints.ReadOnly|Z.NodeConstraints.AllowDrop,container:{type:"Canvas",orientation:o?"Horizontal":"Vertical"}};vn(i)||(m.constraints&=~Z.NodeConstraints.Select),a=ar(e,0,i,m,!1,!1,!0),s.phases&&0<s.phases.length&&s.phases[parseInt(p.toString(),10)]&&(g=e.nameTable[s.phases[parseInt(p.toString(),10)].header.id])&&g.laneGrids.splice(r,0,m.id),a.children[0].isCalculateDesiredSize=!1,0===p&&((g={id:i.id+s.lanes[parseInt(r.toString(),10)].id+"_"+p+"_header",style:s.lanes[parseInt(r.toString(),10)].header.style,annotations:[Q(s.lanes[parseInt(r.toString(),10)].header.annotation)],offsetX:i.offsetX,offsetY:i.offsetY,rowIndex:l,columnIndex:u,container:{type:"Canvas",orientation:o?"Horizontal":"Vertical"}}).annotations[0].rotateAngle=o?270:0,s.lanes[parseInt(r.toString(),10)].header.id=g.id,o?g.width=s.lanes[r].header.width:g.height=s.lanes[parseInt(r.toString(),10)].header.height,vn(i)||(g.constraints&=~Z.NodeConstraints.Select),m=ar(e,0,i,g,!1,!1,!0,s.lanes[parseInt(r.toString(),10)].id),o&&(m.children[0].elementActions=m.children[0].elementActions|Z.ElementAction.HorizontalLaneHeader),a.children.push(m)),t.addObject(a,l,u),o||l++,u=o?p:r+1}}function dr(t,e){var i=new Qn;i.height=e,t.push(i)}function lr(t){var e=new Jn;return e.width=t,e}function cr(t,e){for(var i,n,r,o,a,s,h=[],d=0,l=e.rowDefinitions().length,c=0;c<l;c++)for(a=e.rows[parseInt(c.toString(),10)],r=0;r<a.cells.length;r++)if((o=a.cells[parseInt(r.toString(),10)].children[0])&&o.children&&o.children.length)for(n=1;n<o.children.length;n++)if(i=o.children[parseInt(n.toString(),10)],(i=t.getObject(i.id))&&(0<i.inEdges.length||0<i.outEdges.length))for(s=i.inEdges.concat(i.outEdges),d=0;d<s.length;d++)-1===h.indexOf(s[parseInt(d.toString(),10)])&&h.push(s[parseInt(d.toString(),10)]);return h}function pr(t){var e,i=t.wrapper;i.measure(new j(t.width,t.height)),i.children[0]instanceof Zn&&(t=!1,(e=i.children[0]).width&&e.width<e.desiredSize.width&&(t=!0,e.width=e.desiredSize.width),e.height&&e.height<e.desiredSize.height&&(t=!0,e.height=e.desiredSize.height),t)&&e.measure(new j(e.width,e.height)),i.arrange(i.desiredSize)}function gr(t,e,i){for(var n,r,o,a,s,h,d,l,c=e.wrapper.children[0],p=i;p<c.rows.length;p++)for(h=c.rows[parseInt(p.toString(),10)],n=0;n<h.cells.length;n++)if((d=h.cells[parseInt(n.toString(),10)]).children&&0<d.children.length)for(r=0;r<d.children.length;r++){if(l=d.children[parseInt(r.toString(),10)],(a=t.nameTable[l.id]).isLane&&1<l.children.length)for(o=1;o<l.children.length;o++)(s=t.nameTable[l.children[parseInt(o.toString(),10)].id])&&s.isLane&&(s.rowIndex=p,s.columnIndex=n);a.rowIndex=p,a.columnIndex=n}}function ur(t,e){var i,n,r,o,a,s,h,d,l=e.wrapper.children[0],c=e.shape,p=c.padding,g=c.lanes,u=l.bounds.y,m=0<c.phaseSize?c.phases.length:0,f="Horizontal"===c.orientation,y=f?c.phases.length||1:g.length+1,v=f?(c.header&&c.hasHeader?1:0)+(0<c.phases.length?1:0)+c.lanes.length:(c.header&&c.hasHeader?1:0)+c.phases.length;if(0===m&&!f&&c.lanes.length&&(v+=1),n=f?(i=(c.header&&c.hasHeader?1:0)+(0<m?1:0),0):(i=c.header&&c.hasHeader?1:0,0<m?1:0),0<g.length)for(u+=c.header&&c.hasHeader?c.header.height:0,s=0;s<g.length;s++){for(h=0;h<g[parseInt(s.toString(),10)].children.length;h++)if((r=g[parseInt(s.toString(),10)].children[parseInt(h.toString(),10)]).offsetX=g[parseInt(s.toString(),10)].width,r.offsetY=g[parseInt(s.toString(),10)].height,t.initObject(r),t.nodes.push(r),o=r.wrapper,f){for(d=n;d<y;d++)if(a=l.rows[parseInt(i.toString(),10)].cells[parseInt(d.toString(),10)],o.margin.left<a.bounds.right-l.bounds.x){r.parentId=a.children[0].id,n<d?o.margin.left=o.margin.left-(a.bounds.left-l.bounds.left):a.children[0].children[1].actualSize.width+p>=o.margin.left&&(o.margin.left=a.children[0].children[1].actualSize.width+p),o.margin.left<p&&(o.margin.left=p),o.margin.top<p&&(o.margin.top=p),mr(o,r,t);break}}else for(var b=i;b<v;b++)if(a=l.rows[parseInt(b.toString(),10)].cells[parseInt(n.toString(),10)],o.margin.top<a.bounds.bottom-u){r.parentId=a.children[0].id,i<b?o.margin.top=o.margin.top-(a.bounds.top-u):a.children[0].children[1].actualSize.height+p>=o.margin.top&&(o.margin.top=a.children[0].children[1].actualSize.height+p),o.margin.left<p&&(o.margin.left=p),o.margin.top<p&&(o.margin.top=p),mr(o,r,t);break}f?i++:n++}l.measure(new j(e.width,e.height)),l.arrange(l.desiredSize);var S,w,x,I,C,P,A=l,m=e,T=A.columnDefinitions(),D=A.rowDefinitions(),c=Ir(m),O=("Vertical"===m.shape.orientation&&0===c&&(c=m.shape.header&&m.shape.hasHeader?1:0),m.shape.padding);for(S=0;S<T.length;S++)A.updateColumnWidth(S,T[parseInt(S.toString(),10)].width,!0,O);for(S=c;S<D.length;S++)A.updateRowHeight(S,D[parseInt(S.toString(),10)].height,!0,O);for(w=0;w<D.length;w++)for(P=A.rows[parseInt(w.toString(),10)],S=0;S<T.length;S++)if((I=P.cells[parseInt(S.toString(),10)]).children&&0<I.children.length)for(x=0;x<I.children.length;x++)(C=I.children[parseInt(x.toString(),10)]).maxWidth&&(C.maxWidth=I.actualSize.width),C.maxHeight&&(C.maxHeight=I.actualSize.height);e.width=e.wrapper.width=l.width,e.height=e.wrapper.height=l.height,Pr(t,e),e.wrapper.measure(new j(e.width,e.height)),e.wrapper.arrange(l.desiredSize);m=e;if("SwimLane"===m.shape.type)for(var M=m.shape.lanes,E=void 0,L=void 0,z=0;z<M.length;z++){E=M[parseInt(z.toString(),10)];for(var k=0;k<E.children.length;k++)(L=E.children[parseInt(k.toString(),10)]).offsetX=L.wrapper.offsetX,L.offsetY=L.wrapper.offsetY}yr(e,t),fr(e)}function mr(t,e,i){t.measure(new j(e.width,e.height)),t.arrange(t.desiredSize);t=i.getObject(e.parentId);i.addChild(t,e.id)}function fr(t){if("SwimLane"===t.shape.type&&!t.shape.isLane&&!t.shape.isPhase)for(var e,i,n=void 0,r=void 0,o=void 0,a=void 0,s=void 0,h=t.shape.lanes,d=Ir(t),l=t.wrapper.children[0].rowDefinitions(),c=t.wrapper.children[0].columnDefinitions(),r=0;r<h.length;r++,d++)if(n=h[parseInt(r.toString(),10)],"Horizontal"===t.shape.orientation)for(s=l[parseInt(d.toString(),10)].height,n.height!==s&&(n.height=s),o=0;o<c.length;o++)e=c[parseInt(o.toString(),10)].width,n.width!==e&&(n.width=e);else for(s=c[parseInt(d.toString(),10)].width,n.width!==s&&(n.width=s),a=0;a<l.length;a++)i=l[parseInt(a.toString(),10)].height,n.height!==i&&(n.height=i)}function yr(t,e){var i,n,r,o,a,s=t.shape,h=s.phases,d=s.header&&s.hasHeader?1:0,l=t.wrapper.children[0].bounds.y+(s.header&&s.hasHeader?s.header.height:0);if("SwimLane"===t.shape.type&&(t=e.getObject(t.id)||t,0<h.length))if(a=t.wrapper.children[0],"Horizontal"===s.orientation)for(r=s.header&&s.hasHeader?a.rows[1]:a.rows[0],i=0;i<h.length;i++)n=(o=r.cells[parseInt(i.toString(),10)].children[0]).bounds.right-a.bounds.x,h[parseInt(i.toString(),10)].offset!==n&&(h[parseInt(i.toString(),10)].offset=n),e.nameTable[o.id].maxWidth=o.maxWidth;else for(i=0;i<h.length;i++)n=(o=a.rows[d+i].cells[0].children[0]).bounds.bottom-l,h[parseInt(i.toString(),10)].offset!==n&&(h[parseInt(i.toString(),10)].offset=n),e.nameTable[o.id].maxWidth=o.maxWidth}function vr(t,e){if(t&&0<t.length){var i;e.lineRoutingModule&&e.constraints&Z.DiagramConstraints.LineRouting&&e.lineRoutingModule.renderVirtualRegion(e,!0);for(var n=0;n<t.length;n++)i=e.getObject(t[parseInt(n.toString(),10)]),e.lineRoutingModule&&e.constraints&Z.DiagramConstraints.LineRouting&&"Orthogonal"===i.type?e.lineRoutingModule.refreshConnectorSegments(e,i,!0):e.connectorPropertyChange(i,{},{sourceID:i.sourceID,targetID:i.targetID})}}function br(t,e,i,n){var r,o,a,s,h,d=t.getObject(e.parentId),l=d.shape,c=d.wrapper.children[0],p=l.lanes,g=cr(t,c,e.rowIndex);if(("Horizontal"===l.orientation&&e.rowIndex!==i.rowIndex||"Vertical"===l.orientation&&e.columnIndex!==i.columnIndex)&&("Horizontal"===l.orientation?(r=e.rowIndex,o=i.rowIndex,a=(l.header&&l.hasHeader?1:0)+(l.phases.length&&l.phaseSize?1:0),s=e.rowIndex-a,h=i.rowIndex-a,p[parseInt(s.toString(),10)].canMove&&(s<h?n&&i.wrapper.offsetY>n.y&&(o+=0<h?-1:1,h+=0<h?-1:1):n&&i.wrapper.offsetY<n.y&&(o+=1,h+=1),r!==o)&&(c.updateRowIndex(r,o),Sr(s,h,d,t))):(r=e.columnIndex,o=i.columnIndex,a=l.phases.length&&l.phaseSize?1:0,s=e.columnIndex-a,h=i.columnIndex-a,l.header&&l.hasHeader,p[parseInt(s.toString(),10)].canMove&&(s<h?n&&i.wrapper.offsetX>n.x&&(o+=0<h?-1:1,h+=0<h?-1:1):n&&i.wrapper.offsetX<n.x&&(o+=1,h+=1),r!==o)&&(0!==l.phaseSize&&0!==l.phases.length||0!==o&&0!==r||l.header&&l.hasHeader&&(a=0===o?r:o,c.rows[0].cells[parseInt(a.toString(),10)].children=c.rows[0].cells[0].children,c.rows[0].cells[parseInt(a.toString(),10)].columnSpan=c.rows[0].cells[0].columnSpan,c.rows[0].cells[0].children=[]),c.updateColumnIndex(0,r,o),Sr(s,h,d,t))),r!==o&&p[parseInt(s.toString(),10)].canMove)){n={target:Q(i),source:Q(e)},l=p[parseInt(s.toString(),10)],p.splice(s,1),p.splice(h,0,l),a={target:Q(n.source),source:Q(n.target)},t.diagramActions&Z.DiagramAction.UndoRedo||t.commandHandler.addHistoryEntry({type:"LanePositionChanged",redoObject:a,undoObject:n,category:"Internal"}),gr(t,d,0),vr(g,t);for(var u,m,f=p,y=t,v=0;v<f.length;v++){u=f[parseInt(v.toString(),10)];for(var b=0;b<u.children.length;b++)(m=y.nameTable[u.children[parseInt(b.toString(),10)].id]).offsetX=m.wrapper.offsetX,m.offsetY=m.wrapper.offsetY}d.wrapper.measure(new j(d.width,d.height)),d.wrapper.arrange(d.wrapper.desiredSize),t.updateDiagramObject(d)}t.updateDiagramElementQuad()}function Sr(t,e,i,n){var r=i.shape.phases;if(r&&0<r.length)for(var o=0;o<r.length;o++){var a,s=i.id+r[parseInt(o.toString(),10)].id+"_header",s=n.nameTable[s];s&&s.laneGrids&&0<=t&&0<=e&&t<s.laneGrids.length&&e<s.laneGrids.length&&(a=s.laneGrids.splice(t,1)[0],s.laneGrids.splice(e,0,a))}}function wr(t,e,i,n,r,o){var a,s,i=t.getObject(i.id),h=i.shape,d=h.header&&h.hasHeader?1:0,l=h.lanes,c=h.phases,p=n.wrapper.actualSize.width,n=n.wrapper.actualSize.height,g=(e.wrapper.actualSize.width,e.wrapper.actualSize.height,!1),u=(t.diagramActions&Z.DiagramAction.UndoRedo&&(g=!0),i.wrapper.children[0]);if("SwimLane"===i.shape.type)if("Horizontal"===h.orientation)if(e.isPhase){for(var m,f=e.columnIndex;f<c.length;f++)c[parseInt(f.toString(),10)].offset+=r,(y=t.nameTable[c[parseInt(f.toString(),10)].header.id])&&(m=u.rows[y.rowIndex].cells[y.columnIndex].minWidth,c[parseInt(f.toString(),10)].offset<m)&&(c[parseInt(f.toString(),10)].offset=m);for(a=0;a<l.length;a++)l[parseInt(a.toString(),10)].width=g?p:e.wrapper.width}else d=h.phaseSize&&0<h.phases.length?d+1:d,l[e.rowIndex-d].height=g?n:e.wrapper.height;else if(e.isPhase){for(var y,v,f=e.rowIndex-d;f<c.length;f++)c[parseInt(f.toString(),10)].offset+=o,(y=t.nameTable[c[parseInt(f.toString(),10)].header.id])&&(v=u.rows[y.rowIndex].cells[y.columnIndex].minHeight,c[parseInt(f.toString(),10)].offset<v)&&(c[parseInt(f.toString(),10)].offset=v);for(s=0;s<l.length;s++)l[parseInt(s.toString(),10)].height=e.wrapper.height}else d=h.phaseSize&&0<h.phases.length?1:0,l[e.columnIndex-d].width=e.wrapper.width}function xr(t,e){var t=t.shape,i=t.header&&t.hasHeader?1:0,i="Horizontal"===t.orientation?(i+=0<t.phases.length?1:0,e.rowIndex-i):e.columnIndex-(t.phaseSize&&0<t.phases.length?1:0);return i}function Ir(t){var e=0,t=t.shape;return"Horizontal"===t.orientation&&(e=t.header&&t.hasHeader?1:0),0<t.phases.length&&t.phaseSize&&(e+=1),e}function Cr(t,e,i,n){t=t.shape;0<t.phases.length&&(e=e.nameTable[t.phases[parseInt(n.toString(),10)].header.id])&&e.maxWidth<i.outerBounds.width&&(e.maxWidth=i.outerBounds.width,e.wrapper.maxWidth=i.outerBounds.width)}function Pr(t,e){var i;e.shape.header&&e.shape.hasHeader&&(i=e.wrapper.children[0].rows[0].cells[0].children[0].id,t=t.nameTable[""+i])&&t.isHeader&&(t.maxWidth<e.width||t.wrapper.maxWidth<e.width)&&(t.maxWidth=e.width,t.wrapper.maxWidth=e.width)}function Ar(t,e,i,n,r){var o,a,s,h,d,l=!1;return e.children&&0<e.children.length&&(e=e.children[0],o=t.nameTable[e.id],e=e.bounds,i=i,s=(a=r).left||0,h=r.right||0,d=r.top||0,a=r.bottom||0,e.left-s<=i.x)&&e.right+h>=i.x&&e.top-d<=i.y&&e.bottom+a>=i.y&&(t.addChild(o,n),l=!0),l}function Tr(t,e,i){if("SwimLane"===e.shape.type){var n,r=void 0,o=void 0,a=void 0,s=void 0,h=void 0,R=e.wrapper.bounds.x,N=e.wrapper.bounds.y,d=e.shape,l=d.padding,c=d.phases,p=e.wrapper.children[0],g="Horizontal"===d.orientation,r=d.header&&d.hasHeader?0:-1,u=(0<d.phases.length&&(r+=1),g?d.lanes[0].header.width:d.lanes[0].header.height);if(i.offset>u){for(h=0;h<c.length;h++)if(n=c[parseInt(h.toString(),10)],m=0<h?c[h-1]:n,n.offset>i.offset){if(n=0<h?i.offset-m.offset:i.offset,g){var m=p.columnDefinitions()[parseInt(h.toString(),10)],m=(m.width-=n,(a=t.nameTable[d.phases[parseInt(h.toString(),10)].header.id]).maxWidth=a.wrapper.maxWidth=m.width,p.updateColumnWidth(h,m.width,!1),new Jn);m.width=n,s=h,p.addColumn(h,m,!1);break}m=p.rowDefinitions()[h+r],m=(m.height-=n,a=t.nameTable[d.phases[parseInt(h.toString(),10)].header.id],p.updateRowHeight(h+r,m.height,!1),new Qn);m.height=n,s=h,p.addRow(h+r,m,!1);break}if(t.diagramActions&Z.DiagramAction.UndoRedo&&void 0===s&&(f=t.historyManager.currentEntry.next).isLastPhase&&(u=s=c.length,y=f,M=p,L=g,D=(D=e).shape.phases[u-2],O=y.previousPhase.offset,L?(E=M.columnDefinitions()[u-1],L=new Jn,1<u?(L.width=E.width-(O-D.offset),E.width=O-D.offset):(L.width=E.width-O,E.width=O),M.updateColumnWidth(u-1,E.width,!1),M.addColumn(u,L,!1)):(E=M.rowDefinitions()[parseInt(u.toString(),10)],L=new Qn,1<u?(L.height=y.undoObject.offset-O,E.height=O-D.offset):(L.height=E.height-O,E.height=O),M.updateRowHeight(u,E.height,!1),M.addRow(1+u,L,!1))),0<=s){var f,y=new Oc(e.shape,"phases",i,!0);if(t.diagramActions&Z.DiagramAction.UndoRedo||(y.id+=q()),d.phases.splice(s,0,y),sr(p,t,e,r,g,s),g){if(o=t.nameTable[p.rows[parseInt(r.toString(),10)].cells[parseInt(s.toString(),10)].children[0].id],0===s&&d.header&&d.hasHeader){p.rows[0].cells[0].children=p.rows[0].cells[1].children,p.rows[0].cells[1].children=[];for(var v=p.rows[0],b=0;b<v.cells.length;b++)v.cells[parseInt(b.toString(),10)].minWidth=void 0,v.cells[parseInt(b.toString(),10)].columnSpan=0===b?p.rows[0].cells.length:1}var S,w,x,I,C=t,P=e,A=p,T=s,j=i,D=P.shape,O=Ir(P);for(D.header&&D.hasHeader&&(A.rows[0].cells[0].columnSpan=A.rows[0].cells.length),S=O;S<A.rows.length;S++)I=A.rows[parseInt(S.toString(),10)],w=I.cells[T-1],x=I.cells[parseInt(T.toString(),10)],I=I.cells[T+1],Dr(C,P,w,x,I,S,T,j);gr(C,P,1);var M,E=p.columnDefinitions();p.updateColumnWidth(s,E[parseInt(s.toString(),10)].width,!0,l),o.maxWidth=o.wrapper.maxWidth=E[parseInt(s.toString(),10)].width,E.length>s+1&&(M=t.nameTable[p.rows[parseInt(r.toString(),10)].cells[s+1].children[0].id],p.updateColumnWidth(s+1,E[s+1].width,!0,l),M.maxWidth=M.wrapper.maxWidth=E[s+1].width),e.width=e.wrapper.width=e.wrapper.children[0].width=p.width}else{for(var H,W,_,o=t.nameTable[p.rows[r+s].cells[0].children[0].id],u=p.rowDefinitions(),L=u[r+s].height,Y=t,X=e,z=p,k=r+s,V=i,F=z.rows[parseInt(k.toString(),10)],U=z.rows[k+1],G=z.rows[k-1],B=1;B<F.cells.length;B++)W=F.cells[parseInt(B.toString(),10)],_=U?U.cells[parseInt(B.toString(),10)]:void 0,H=G?G.cells[parseInt(B.toString(),10)]:void 0,Dr(Y,X,H,W,_,k,B,V);gr(Y,X,1),p.updateRowHeight(r+s,L,!0,l),u.length>r+s+1&&(L=u[r+s+1].height,p.updateRowHeight(r+s+1,L,!0,l)),e.height=e.wrapper.height=e.wrapper.children[0].height=p.actualSize.height}pr(e),e.width=e.wrapper.actualSize.width,Pr(t,e),t.drag(e,R-e.wrapper.bounds.x,N-e.wrapper.bounds.y),yr(e,t),t.commandHandler.select(o),t.diagramActions&Z.DiagramAction.UndoRedo||(f={type:"PhaseCollectionChanged",changeType:"Insert",undoObject:Q(y),redoObject:Q(o),category:"Internal"},t.addHistoryEntry(f)),t.updateDiagramObject(e)}}}}function Dr(t,e,i,n,r,o,a,s){for(var h,d=e.shape,l="Horizontal"===d.orientation,c=e.wrapper.children[0],p=n.desiredCellWidth,g=n.desiredCellHeight,u=l?e.shape.hasHeader?o:o+1:a,m=i?(f=l?i.bounds.x+i.bounds.width:i.bounds.x,l?i.bounds.y:i.bounds.y+i.bounds.height):(f=c.bounds.x,r.bounds.y),f=new k(f,m,p,g),y=e.shape.hasHeader?o-1:o,v=e.id+(l?d.lanes[u-2]:d.lanes[u-1]).id,b=(l?a-1:y-1).toString()+(l?a:y).toString(),S=v+b;Object.prototype.hasOwnProperty.call(t.nameTable,S);)S=v+(b=(l?a-1:y-1).toString()+b);var m={id:S,rowIndex:o,columnIndex:a,width:n.minWidth,height:n.minHeight,style:(l?d.lanes[u-2]:d.lanes[u-1]).style,constraints:Z.NodeConstraints.Default|Z.NodeConstraints.AllowDrop,container:{type:"Canvas",orientation:l?"Horizontal":"Vertical"}},p=d.hasHeader?0:-1,u=(s.laneGrids&&0<s.laneGrids.length&&(g=l?o-(2+p):a-1,t.nameTable[s.laneGrids[parseInt(g.toString(),10)]]||(m.id=s.laneGrids[parseInt(g.toString(),10)])),l?a:o-1),s=(d.phases[parseInt(u.toString(),10)]&&(p=t.nameTable[d.phases[parseInt(u.toString(),10)].header.id])&&p.laneGrids.push(m.id),ar(t,0,e,m,!1,!1,!0));if(s.children[0].isCalculateDesiredSize=!1,c.addObject(s,o,a),r&&r.children&&r.children.length)for(h=0;h<r.children.length;h++)l?t.nameTable[r.children[parseInt(h.toString(),10)].id].columnIndex+=1:t.nameTable[r.children[parseInt(h.toString(),10)].id].rowIndex+=1;var w,x,I,C=t,P=r,A=n,T=f,D=s,O=l,g=i,M=C.nameTable[D.id],E=P||g,L=C.nameTable[M.parentId].shape.padding;if(E.children&&1<E.children[0].children.length)for(var z=1;z<E.children[0].children.length;z++)w=E.children[0].children[parseInt(z.toString(),10)],I=C.nameTable[w.id],x=O?{x:w.bounds.x,y:w.bounds.center.y}:{x:w.bounds.center.x,y:w.bounds.top},T.containsPoint(x)?(A.children[0].children.push(w),E.children[0].children.splice(z,1),z--,C.deleteChild(I,void 0,!0),I.isLane||(I.parentId=D.id),M.children||(M.children=[]),P||(O?I.margin.left=I.wrapper.bounds.x-E.children[0].bounds.right:I.margin.top=I.wrapper.bounds.y-E.children[0].bounds.bottom),M.children.push(w.id),I.zIndex=M.zIndex+1,C.removeElements(I)):P&&(O?(I.margin.left-=A.desiredCellWidth,L>I.margin.left&&(I.margin.left=L)):(I.margin.top-=A.desiredCellHeight,L>I.margin.top&&(I.margin.top=L)))}function Or(t,e,i){var n,r,o;"SwimLane"!==e.shape.type||"ResizeSouth"!==i&&"ResizeEast"!==i||(n=e.shape,e=e.wrapper.children[0],r=o=void 0,o="ResizeSouth"===i?"Vertical"===n.orientation?e.rows[e.rows.length-1].cells[0]:(r=e.rows.length-1,e.rows[parseInt(r.toString(),10)].cells[e.rows[parseInt(r.toString(),10)].cells.length-1]):(r=n.header&&n.hasHeader?1:0,e.rows[parseInt(r.toString(),10)].cells[e.rows[parseInt(r.toString(),10)].cells.length-1]),t.commandHandler.select(t.nameTable[o.children[0].id]))}function Mr(t,e,i,n,r,o){var a,s,h,d,l,c=q(),p=t.shape,g=p.phases,u=t.offsetX-t.wrapper.actualSize.width/2,m=t.offsetY-t.wrapper.actualSize.height/2,f=[];if("Vertical"===p.orientation&&(m+=p.header&&p.hasHeader?p.header.height:0),!o)for(r||(t.id+=c,p&&p.header&&p.hasHeader?p.header.id+=c:p.header=void 0),S=0;g&&S<g.length;S++)g[parseInt(S.toString(),10)].id+=c;for(var y,v,b=r?[i.childTable[n.id]]:p.lanes,S=0;b&&S<b.length;S++)for(s=b[parseInt(S.toString(),10)],o||(s.id+=c),a=0;s.children&&a<s.children.length;a++)h=s.children[parseInt(a.toString(),10)],f.push(h.id),d=h.wrapper.offsetX-h.width/2,l=h.wrapper.offsetY-h.height/2,h.zIndex=Number.MIN_VALUE,h.inEdges=h.outEdges=[],(o||i&&(1===i.pasteIndex||0===i.pasteIndex))&&("Vertical"===p.orientation?h.margin.top=l-m:h.margin.left=d-u),o||(h.id+=c);if(!o){if(r&&(v={shape:{lanes:b,phases:g,phaseSize:p.phaseSize,type:"SwimLane",orientation:p.orientation,header:{annotation:{content:"Title"},height:50}}},"Horizontal"===p.orientation?(y=0,p.hasHeader&&(y=p.header.height),v.width=t.wrapper.actualSize.width,v.height=n.wrapper.actualSize.height+y+p.phaseSize,v.offsetX=t.wrapper.offsetX+10*i.pasteIndex,v.offsetY=n.wrapper.offsetY+10*i.pasteIndex):(v.width=n.wrapper.actualSize.width,v.height=t.wrapper.actualSize.height,v.offsetX=n.wrapper.offsetX+10*i.pasteIndex,v.offsetY=t.wrapper.offsetY+10*i.pasteIndex),t=v),0!==i.pasteIndex&&(t.offsetX+=10,t.offsetY+=10),t.zIndex=Number.MIN_VALUE,t=e.add(t),!r)for(var w=0,x=Object.keys(i.childTable);w<x.length;w++){var I=x[w],I=i.childTable[""+I];I.parentSwimlaneId&&I.parentSwimlaneId+c===t.id?(I.id+=c,-1!==f.indexOf(I.sourceID)&&(I.sourceID+=c),-1!==f.indexOf(I.targetID)&&(I.targetID+=c),I.zIndex=Number.MIN_VALUE,e.add(I)):-1!==f.indexOf(I.sourceID)?I.sourceID+=c:-1!==f.indexOf(I.targetID)&&(I.targetID+=c)}"SVG"!==e.mode&&e.refreshDiagramLayer(),e.select([t])}}function Er(t,e,i,n){var r,o,a,s,h,e=e.nodes[0];return(n||Ur(t,e,!0))&&(s=a=o=void 0,h=new qt,i&&(s=t.nameTable[""+i].parentId,o=e=t.nameTable[""+i]),i=(i?o:e).wrapper,t=t.nameTable[s||e.parentId])&&"Grid"===t.container.type&&((r=new F).children=[],!n&&e.isHeader||("Horizontal"===t.container.orientation&&e.isPhase||"Vertical"===t.container.orientation&&(0<e.rowIndex&&0<e.columnIndex||e.isLane)?(a=Xr(t,(o||e).columnIndex,!(!t.shape.header||!t.shape.hasHeader)),r.offsetX=a.center.x,r.offsetY=a.center.y,h.width=a.width,h.height=a.height):(r.offsetX=t.offsetX,r.offsetY=i.offsetY,h.width=t.wrapper.actualSize.width,h.height=i.actualSize.height)),r.children.push(h),r.measure(new j),r.arrange(r.desiredSize)),r}function Lr(t,e,i,n,r){r=void 0!==r?r:xr(e,i);for(var o=!1,a=e.shape.lanes[parseInt(r.toString(),10)],s=a.children.length-1;0<=s;s--)n?n.id===a.children[parseInt(s.toString(),10)].id&&a.children.splice(s,1):(t.removeDependentConnector(a.children[parseInt(s.toString(),10)]),t.diagramActions&Z.DiagramAction.UndoRedo||(t.diagramActions=t.diagramActions|Z.DiagramAction.UndoRedo,o=!0),t.remove(a.children[parseInt(s.toString(),10)]),a.children.splice(s,1),o&&(t.diagramActions=t.diagramActions&~Z.DiagramAction.UndoRedo))}function zr(t,e){e&&(t.nodes.splice(t.nodes.indexOf(e),1),t.removeFromAQuad(e),t.removeObjectsFromLayer(e),delete t.nameTable[e.id],t.removeElements(e))}function kr(t,e,i,n){if("SwimLane"===i.shape.type){var r=i.shape,o=void 0;if(1===r.lanes.length)t.remove(i);else{var a,s=i.wrapper.bounds.x,h=i.wrapper.bounds.y,d=void 0,l=void 0,c=void 0,p=void 0,g=i.wrapper.children[0],o=n?r.lanes.indexOf(n):xr(i,e),n={element:e,cause:t.diagramActions,diagramAction:t.getDiagramAction(t.diagramActions),state:"Changing",type:"Removal",cancel:!1,laneIndex:o};if(t.triggerEvent(Z.DiagramEvent.collectionChange,n),!n.cancel){var u=r.lanes[parseInt(o.toString(),10)],m=u.children;u.children=[];for(var f=0;f<m.length;f++){var y=t.getObject(m[parseInt(f.toString(),10)].id);y&&u.children.push(y)}var v=Q(r.lanes[parseInt(o.toString(),10)]),b=(Lr(t,i,e,void 0,o),t.diagramActions&Z.DiagramAction.UndoRedo||(v={type:"LaneCollectionChanged",changeType:"Remove",undoObject:v,redoObject:Q(e),category:"Internal"},t.addHistoryEntry(v)),r.lanes.splice(o,1),e?"Horizontal"===r.orientation?e.rowIndex:e.columnIndex:Ir(i)+o);if("Horizontal"===r.orientation){for(a=g.rows[parseInt(b.toString(),10)],d=0;d<a.cells.length;d++)if((l=a.cells[parseInt(d.toString(),10)])&&0<l.children.length)for(c=0;c<l.children.length;c++)Rr(t,p=l.children[parseInt(c.toString(),10)]),Br(p,i,t);g.removeRow(b)}else{for(i.width=void 0!==i.width?i.width-g.rows[0].cells[parseInt(b.toString(),10)].actualSize.width:i.width,d=0;d<g.rows.length;d++)if((l=g.rows[parseInt(d.toString(),10)].cells[parseInt(b.toString(),10)])&&0<l.children.length)for(c=0;c<l.children.length;c++)Rr(t,p=l.children[parseInt(c.toString(),10)]),Br(p,i,t);g.removeColumn(b)}n={element:e,cause:t.diagramActions,diagramAction:t.getDiagramAction(t.diagramActions),state:"Changed",type:"Removal",cancel:!1,laneIndex:o},t.triggerEvent(Z.DiagramEvent.collectionChange,n),i.width=i.wrapper.width=g.width,i.height=i.wrapper.height=g.height,pr(i),gr(t,i,b="Vertical"===i.shape.orientation?0:b),t.drag(i,s-i.wrapper.bounds.x,h-i.wrapper.bounds.y),t.updateDiagramObject(i)}}}}function Br(t,e,i){var n=t.id,r=e.shape.phases;if(r&&0<r.length)for(var o=0;o<r.length;o++){var a=e.id+r[parseInt(o.toString(),10)].id+"_header",a=i.nameTable[a],s=a.laneGrids.indexOf(n);-1!==s&&a.laneGrids.splice(s,1)}}function Rr(t,e){var i,n;if(e instanceof F){if(0<e.children.length)for(i=0;i<e.children.length;i++)e.children[parseInt(i.toString(),10)]instanceof F&&Rr(t,e.children[parseInt(i.toString(),10)]);n=t.getObject(e.id),zr(t,n)}}function Nr(t,e,i,n){t.protectPropertyChange(!0);i.wrapper.bounds.x,i.wrapper.bounds.y;var r=!1,o=i.shape,R=i.wrapper.children[0],a=n?o.phases.indexOf(n):(n=e,s=(a=(a=i).shape).header&&a.hasHeader?1:0,"Horizontal"===a.orientation?n.columnIndex:n.rowIndex-s),n=o.phases.length;if(1<o.phases.length){a===n-1&&(r=!0,w=Q(o.phases[a-1]));var s=Q(o.phases[parseInt(a.toString(),10)]);if(o.phases.splice(a,1),t.diagramActions&Z.DiagramAction.UndoRedo||((n={type:"PhaseCollectionChanged",changeType:"Remove",undoObject:s,previousPhase:w,redoObject:Q(e),category:"Internal",isLastPhase:r}).undoObject.laneGrids=e.laneGrids,n.redoObject.laneGrids=e.laneGrids,t.addHistoryEntry(n)),"Horizontal"===o.orientation){var h,d,l,c,p,g,u,m,f,y,N,v,b=t,S=R,w=e,x=a;for(x=void 0!==x?x:w.columnIndex,p=0;p<S.rows.length;p++)if(1<(h=S.rows[parseInt(p.toString(),10)]).cells.length&&(d=h.cells[parseInt(x.toString(),10)],v=h.cells.length-1===x?h.cells[x-1]:h.cells[x+1],c=v.children[0],0<d.children.length))if(l=d.children[0],f=b.nameTable[l.id],0===v.children.length&&0<d.children.length)v.children=d.children,v.columnSpan=d.columnSpan-1;else{for(g=0;g<l.children.length;g++)if((m=l.children[parseInt(g.toString(),10)])instanceof F&&((y=b.nameTable[m.id]).isLane||(y.parentId=c.id),h.cells.length-1===x&&(y.margin.left=y.wrapper.bounds.x-c.bounds.x,m.margin.left=y.wrapper.bounds.x-c.bounds.x),c.children.push(m),b.nameTable[c.id]&&((N=b.nameTable[c.id]).children||(N.children=[]),N.children.push(m.id)),l.children.splice(g,1),g--,f)&&f.children&&-1!==f.children.indexOf(y.id)&&f.children.splice(f.children.indexOf(y.id),1),h.cells.length-1!==x)for(u=0;u<c.children.length;u++){var j,H=c.children[parseInt(u.toString(),10)];H instanceof F&&((j=b.nameTable[H.id]).margin.left=j.wrapper.bounds.x-l.bounds.x,H.margin.left=j.wrapper.bounds.x-l.bounds.x)}f&&f.isPhase&&(v=b.nameTable[c.id])&&(c.maxWidth=v.wrapper.maxWidth=v.wrapper.maxWidth+=f.wrapper.maxWidth),zr(b,f)}w=S.columnDefinitions()[parseInt(x.toString(),10)].width,S.removeColumn(x),x<S.columnDefinitions().length?(L=S.columnDefinitions()[parseInt(x.toString(),10)].width,L+=w,S.updateColumnWidth(x,L,!0)):(L=S.columnDefinitions()[x-1].width,L+=w,S.updateColumnWidth(x-1,L,!0))}else{var W,I,C,P,A,_,T,D,O,M=t,r=R,n=e,E=a,o=i,L=o.shape,n=void 0!==E?L.header?E+1:E:n.rowIndex,Y=r.rows[parseInt(n.toString(),10)],z=o.wrapper.bounds.y,X=L.phases.length,V=(void 0!==L.header&&L.hasHeader&&(z+=r.rowDefinitions()[0].height),E===X?r.rows[n-1]:r.rows[n+1]);for(C=0;C<Y.cells.length;C++)if(W=Y.cells[parseInt(C.toString(),10)],_=V.cells[parseInt(C.toString(),10)],T=_.children[0],0<W.children.length){var k=W.children[0],B=M.nameTable[k.id];if(E<X)for(A=0;A<T.children.length;A++)(D=T.children[parseInt(A.toString(),10)])instanceof F&&((O=M.nameTable[D.id]).margin.top=O.wrapper.bounds.y-(0===E?z:k.bounds.y),D.margin.top=O.wrapper.bounds.y-(0===E?z:k.bounds.y));for(P=0;P<k.children.length;P++)(D=k.children[parseInt(P.toString(),10)])instanceof F&&((O=M.nameTable[D.id]).parentId=T.id,E===X&&(O.margin.top=O.wrapper.bounds.y-(0===E?z:T.bounds.y),D.margin.top=O.wrapper.bounds.y-(0===E?z:T.bounds.y)),T.children.push(D),k.children.splice(P,1),P--,B.children)&&-1!==B.children.indexOf(O.id)&&B.children.splice(B.children.indexOf(O.id),1);zr(M,B)}o=r.rowDefinitions()[parseInt(n.toString(),10)].height,r.removeRow(n),n<r.rowDefinitions().length?(I=r.rowDefinitions()[parseInt(n.toString(),10)].height,I+=o,r.updateRowHeight(n,I,!0)):(I=r.rowDefinitions()[n-1].height,I+=o,r.updateRowHeight(n-1,I,!0))}Pr(t,i),gr(t,i,i.isHeader?1:0),yr(i,t),t.protectPropertyChange(!1),t.updateDiagramObject(i)}}function jr(t,e,i){var n=t.nameTable[e.parentId];if(n&&n.isLane){var r=t.nameTable[n.parentId],o=r.wrapper.children[0],a=(t.multiselect||(o.updateColumnWidth(n.columnIndex,o.columnDefinitions()[n.columnIndex].width,!0,i),o.updateRowHeight(n.rowIndex,o.rowDefinitions()[n.rowIndex].height,!0,i)),n.wrapper),s=void 0;e.diffX=e.diffX||0,e.diffY=e.diffY||0,0<e.diffX&&(e.margin.left+=e.diffX+i),0<e.diffY&&(e.margin.top+=e.diffY+i),e.margin.left<i&&(e.margin.left=i),e.margin.top<i&&(e.margin.top=i);for(var h=0;h<a.children.length;h++){var d=a.children[parseInt(h.toString(),10)];if(d instanceof F){d=t.nameTable[d.id];if(d.isLane){s=d.wrapper;break}}}s&&("Horizontal"===r.shape.orientation?e.margin.left<i+s.actualSize.width&&(e.margin.left=i+s.actualSize.width):e.margin.top<i+s.actualSize.height&&(e.margin.top=i+s.actualSize.height)),r.wrapper.measure(new j(r.width,r.height)),r.wrapper.arrange(r.wrapper.desiredSize),e.offsetX=e.wrapper.offsetX,e.offsetY=e.wrapper.offsetY,t.nodePropertyChange(e,{},{margin:{left:e.margin.left,top:e.margin.top}}),e.isResized=!1,o.measure(new j(o.width,o.height)),o.arrange(o.desiredSize),r.width=r.wrapper.width=r.wrapper.children[0].actualSize.width,r.height=r.wrapper.height=r.wrapper.children[0].actualSize.height}}function Hr(t,e){var i;return t.isLane&&(e=e.getObject(t.parentId))&&"SwimLane"===e.shape.type&&t.isLane&&(t=xr(e,t),i=e.shape.lanes[parseInt(t.toString(),10)]),i}function Wr(t,e){if(t.isLane){t=Hr(t,e);if(e.eventHandler.action.includes("Resize")||t.canMove)return 1}}function _r(t,e,i,n){var r,o,a,s,h,d=!1;return Ur(t,e,!0)&&(t.protectPropertyChange(!0),o=(r=t.nameTable[e.parentId]).wrapper,1<t.selectedItems.nodes.length?t.multiselect=!0:t.multiselect=!1,r&&"Canvas"===r.container.type&&((n||o.bounds.x<=i.x&&o.bounds.right>=i.x&&o.bounds.y<=i.y&&o.bounds.bottom>=i.y&&!t.multiselect)&&(n=void 0,i=o.bounds.y,a=o.bounds.x,"SwimLane"===(s=t.nameTable[r.parentId]||r).shape.type?d=$r(r,s,e,t,!0):(h=(s=t.nameTable[r.parentId]||r).shape,n=s.wrapper,o.actualSize.width<o.outerBounds.width&&!(o.bounds.x>o.outerBounds.x)&&(void 0!==r.rowIndex?(n.updateColumnWidth(r.columnIndex,o.outerBounds.width,!0),"Horizontal"===h.orientation&&h.phaseSize&&Cr(s,t,o,r.columnIndex),Pr(t,s),t.drag(s,a-o.bounds.x,i-o.bounds.y)):t.scale(r,1+(o.outerBounds.width-o.actualSize.width)/o.actualSize.width,1,o.outerBounds.x<o.bounds.x?{x:1,y:.5}:{x:0,y:.5})),o.actualSize.height<o.outerBounds.height&&!(o.bounds.y>o.outerBounds.y)&&(void 0!==r.rowIndex?(n.updateRowHeight(r.rowIndex,o.outerBounds.height,!0),t.drag(s,a-o.bounds.x,i-o.bounds.y)):t.scale(r,1,1+(o.outerBounds.height-o.actualSize.height)/o.actualSize.height,o.outerBounds.y<o.bounds.y?{x:.5,y:1}:{x:.5,y:0})))),t.select([e]),vr([],t)),t.protectPropertyChange(!1)),d}function Yr(t,e,i,n){var r,o,a;Ur(t,e,!0)&&!t.cancelPositionChange&&(r=t.isProtectedOnChange,t.protectPropertyChange(!0),o=(a=t.nameTable[e.parentId]).wrapper,!a||"Canvas"!==a.container.type||n||o.bounds.x<=i.x&&o.bounds.right>=i.x&&o.bounds.y<=i.y&&o.bounds.bottom>=i.y||e.constraints&Z.NodeConstraints.AllowMovingOutsideLane||(a=Q(e),t.clearSelection(),Zr(t,e),e.parentId="",e.parentObj=t,e.propName="nodes",n={type:"ChildCollectionChanged",category:"Internal",undoObject:a,redoObject:Q(e)},t.addHistoryEntry(n),t.commandHandler.isContainer&&(t.commandHandler.isContainer=!1,t.endGroupAction()),Qr(e,t)),t.protectPropertyChange(r))}function Xr(t,e,i){for(var n=new k,r=("SwimLane"===t.shape.type?t.wrapper.children[0]:t.wrapper).rows,o=i?1:0;o<r.length;o++)n.uniteRect(r[parseInt(o.toString(),10)].cells[parseInt(e.toString(),10)].bounds);return n}function Vr(t,e){for(var i,n={},r=0,o=Object.keys(e);r<o.length;r++){var a=o[r];n[""+a]=e[""+a]}return ld(e)===_&&((i=new _(t,"nodes",n,!0)).id=e.id,t.initObject(i)),t.updateDiagramObject(i),i}function Fr(t,e){var i,n,r;return t.enableServerDataBinding(!1),N.isBlazor()||(t.selectedObject.helperObject?r=t.selectedObject.helperObject:(0<t.selectedItems.nodes.length||0<t.selectedItems.connectors.length)&&(e=e instanceof B&&e.nodes.length+e.connectors.length===1?(i=(0<e.nodes.length?e.nodes:e.connectors)[0],t.selectedItems.wrapper.children[0]):(i=e,t.selectedItems.wrapper),n=(t.selectedObject.actualObject=i)instanceof B&&0<i.nodes.length?i.nodes[0]:i,t.selectedObject.actualObject=i,!t.currentSymbol)&&(n.isLane&&Wr(n,t)&&Ur(t,n)||!n.isLane&&Ur(t,n)||t.constraints&Z.DiagramConstraints.LineRouting&&0<t.selectedItems.nodes.length)&&(r=Vr(t,{id:"helper",rotateAngle:e.rotateAngle,offsetX:e.offsetX,offsetY:e.offsetY,minWidth:e.minWidth,minHeight:e.minHeight,maxWidth:e.maxWidth,maxHeight:e.maxHeight,width:e.actualSize.width,height:e.actualSize.height,style:{strokeDashArray:"2 2",fill:"transparent",strokeColor:"#7D7D7D",strokeWidth:2}}),t.selectedObject.helperObject=r)),t.enableServerDataBinding(!0),r}function Ur(t,e,i){i=i?t.nameTable[e.parentId]:t.nameTable[e.parentId]||e;return!(!i||!i.container)}function Gr(t,e){var i=t.nameTable[e.parentId];if(e.laneMargin={left:e.margin.left,right:e.margin.right,top:e.margin.top,bottom:e.margin.bottom},e.hasTextAnnotation)for(var n=0;n<e.outEdges.length;n++){var r,o,a,s=t.nameTable[e.outEdges[parseInt(n.toString(),10)]];s.isBpmnAnnotationConnector&&(s=t.nameTable[s.targetID],a={width:e.wrapper.actualSize.width,height:e.wrapper.actualSize.height,offsetX:e.wrapper.offsetX,offsetY:e.wrapper.offsetY},o=e.wrapper.offsetX,r=e.wrapper.offsetY,o=(a=t.getTextAnnotationOffset(e,s,a,o,r)).x-o,a=a.y-r,o||a||e.width!==e.wrapper.actualSize.width||e.height!==e.wrapper.actualSize.height)&&(e.isResized=!0,e.resizeDif||(e.resizeDif=[]),e.resizeDif[s.id]={x:o,y:a})}"Canvas"===i.container.type&&(e.margin.left=e.offsetX-i.wrapper.bounds.x-e.width/2,e.margin.top=e.offsetY-i.wrapper.bounds.y-e.height/2),t.nodePropertyChange(e,{},{width:e.width,height:e.height,offsetX:e.offsetX,offsetY:e.offsetY,margin:{left:e.margin.left,right:e.margin.right,top:e.margin.top,bottom:e.margin.bottom},rotateAngle:e.rotateAngle}),t.undoRedoModule&&i.isLane&&t.undoRedoModule.checkRedo&&(e.margin.left<0||e.margin.top<0)&&Zr(t,e),i.isLane||(i.wrapper.measure(new j),i.wrapper.arrange(i.wrapper.desiredSize))}function Zr(t,e){if(e.parentId&&""!==e.parentId){var i=t.nameTable[e.parentId];if(i.isLane&&i.parentId)for(var n=t.nameTable[i.parentId],i=i.id.slice(n.id.length),r=i.substring(0,i.length-1),o=n.shape.lanes,a=void 0,s=0;s<o.length;s++)if(r===(a=o[parseInt(s.toString(),10)]).id)for(var h=0;h<a.children.length;h++)a.children[parseInt(h.toString(),10)].id===e.id&&(a.children.splice(h,1),h--);t.deleteChild(e)}}function Kr(t,e,i){for(var i=i.commandHandler.getObjectLayer(t.id),n=i.zIndexTable,r=e.zIndex+1;void 0!==n[parseInt(r.toString(),10)];)r++;delete i.zIndexTable[t.zIndex],t.zIndex=r,i.zIndexTable[parseInt(r.toString(),10)]=t.id}function qr(t,e,i,n,r,o){if(!t.currentSymbol){t.protectPropertyChange(!0);var a=t.nameTable[e.parentId],o=(i=t.getObject(i.id)||i,a&&a.zIndex>i.zIndex&&o&&Kr(i,a,t),-1!==t.nodes.indexOf(i)?i.id:i),s=("Canvas"!==e.container.type||r?a&&(h=a.wrapper.bounds,c=e.wrapper.bounds,"Horizontal"===a.shape.orientation?i.margin.left-=c.x-h.x:(d=e.parentId+a.shape.lanes[0].id+"_0_header",i.margin.top-=c.y-h.y-t.nameTable[d].wrapper.bounds.height)):(c=i.wrapper.offsetX-i.wrapper.actualSize.width/2-(e.wrapper.offsetX-e.wrapper.actualSize.width/2),h=i.wrapper.offsetY-i.wrapper.actualSize.height/2-(e.wrapper.offsetY-e.wrapper.actualSize.height/2),i.margin.left=c,i.margin.top=h),t.nameTable[e.id]);if(s.children||(s.children=[]),-1===s.children.indexOf(i.id)){Zr(t,i),t.getObject(i.id)&&t.removeElements(i);var h,d=Q(i);if(t.addChild(s,o),i=t.getObject(i.id),s.isLane&&s.parentId)for(var l=(a=t.nameTable[s.parentId]).shape.lanes,c=s.id.slice(a.id.length),p=c.substring(0,c.length-1),g=0;g<l.length;g++)s.isLane&&p===l[parseInt(g.toString(),10)].id&&(i.parentObj instanceof ru||(i.parentObj=l[parseInt(g.toString(),10)]),t.nameTable.hasOwnProperty(i.id)||l[parseInt(g.toString(),10)].children.push(i));t.updateDiagramObject(i),Qr(i,t),s.parentId?n||(t.multiselect?(jr(t,i,20),t.updateDiagramElementQuad()):$r(s,a,i,t)):t.updateDiagramObject(s),t.diagramActions&Z.DiagramAction.UndoRedo||(h={type:"ChildCollectionChanged",category:"Internal",undoObject:d,redoObject:Q(i),historyAction:r?"AddNodeToLane":void 0},t.addHistoryEntry(h))}else!n&&t.multiselect&&(jr(t,i,20),t.updateDiagramElementQuad());t.protectPropertyChange(!1)}}function Qr(t,e){var i=Y(t.id+"_groupElement",e.element.id),t=Y(t.parentId?t.parentId+"_groupElement":e.element.id+"_diagramLayer",e.element.id);i&&t&&t.appendChild(i)}function Jr(t,e,i,n){$r(t,i.nameTable[t.parentId],e,i,n,!0)}function $r(t,e,i,n,r,o){var a,s,h,d,l,c,p,g,u,m,f=Q(t),y=!1,v=e.shape.padding,b=t.wrapper.bounds,S=t.wrapper.outerBounds,w=i.wrapper.bounds;return e&&"SwimLane"===e.shape.type&&(b.right<w.right+v||b.bottom<w.bottom+v||o&&b.top>w.top+v)&&(d=(h=e.wrapper.children[0]).bounds.x,l=h.bounds.y,p=c=void 0,g=t.wrapper.children.find(function(t){return t.id.includes("header")}),u="Horizontal"===e.shape.orientation,b.right<w.right+v&&S.x<=b.x&&(c=u&&g?(p=g?g.width:0,w.right-b.right+(b.left-w.left)+p+2*v):w.right-b.right+(b.left-w.left)+2*v,h.updateColumnWidth(t.columnIndex,b.width+c,s=!0,v)),b.bottom<w.bottom+v&&S.y<=b.y&&(c=!u&&g?(p=g?g.height:0,w.bottom-b.bottom+(b.top-w.top)+p+2*v):w.bottom-b.bottom+(b.top-w.top)+2*v,h.updateRowHeight(t.rowIndex,b.height+c,a=!0,v)),o&&b.top>w.top-v&&S.y<=b.y&&0<(c=!u&&g?(p=g?g.height:0,b.top-w.top+(w.bottom-b.bottom)+p+2*v):b.top-w.top+(w.bottom-b.bottom)+2*v)&&h.updateRowHeight(t.rowIndex,b.height+c,a=!0,v),n.diagramActions&Z.DiagramAction.UndoRedo||(r&&(n.startGroupAction(),y=!0),a&&(m={category:"Internal",type:"RowHeightChanged",undoObject:f,redoObject:Q(t)},n.addHistoryEntry(m)),s&&(m={category:"Internal",type:"ColumnWidthChanged",undoObject:f,redoObject:Q(t)},n.addHistoryEntry(m))),e.width=e.wrapper.width=h.width,e.height=e.wrapper.height=h.height,pr(e),"Horizontal"===e.shape.orientation&&Cr(e,n,t.wrapper,t.columnIndex),Pr(n,e),n.drag(e,d-h.bounds.x,l-h.bounds.y),yr(e,n),fr(e)),o||jr(n,i,v),n.updateDiagramElementQuad(),y}function to(t,e,i,n,r,o){var a=Vc(n.element.id);n.diagramRenderer.renderStackHighlighter(t,a,n.scroller.transform,e,i,r,o)}function eo(t,e,i,n){var r,o=t,a=i.nameTable[o.parentId],s=i.nameTable[o.parentId];e&&s&&s.container&&"Stack"===s.container.type&&e.container&&"Stack"===e.container.type&&s.id!==e.parentId&&-1<(r=s.wrapper.children.indexOf(o.wrapper))&&(i.nameTable[o.id].parentId=e.id,s.wrapper.children.splice(r,1)),e&&e.parentId&&o.parentId&&"Drag"===n&&s.container&&"Stack"===s.container.type&&(s={targetIndex:r=a.wrapper.children.indexOf(e.wrapper),target:e,sourceIndex:n=a.wrapper.children.indexOf(o.wrapper),source:t},a.wrapper.children.splice(n,1),a.wrapper.children.splice(r,0,o.wrapper),i.commandHandler.addHistoryEntry({type:"StackChildPositionChanged",redoObject:{targetIndex:n,target:e,sourceIndex:r,source:t},undoObject:s,category:"Internal"}))}function io(t,e,i,n,r,o,a){if(o&&1<o.length&&r&&1<r.length)return"PinchZoom";if(n.currentSymbol)return"Drag";if("PortDraw"===n.eventHandler.action&&(n.tool&=~Z.DiagramTools.DrawOnce),(Nn(n)||Rn(n))&&n.drawingObject)return"Draw";if(oo(n)&&((l=n.selectedItems).wrapper&&Uh(l.constraints,"UserHandle")))for(var s=0,h=l.userHandles;s<h.length;s++){var d=h[s];if(d.visible)if(ro(i,c=Vh(l,d,n.scroller.transform),d.size/(2*n.scroller.transform.scale)))return d.name}if(oo(n)){var o=n.selectedItems.annotation?n.selectedItems.wrapper.children[0]:n.selectedItems.wrapper,r=o.bounds,l=n.selectedItems,c=new k(r.x,r.y,r.width,r.height);if(ao(n)&&!n.selectedItems.annotation){var r=n.selectedItems.connectors[0],p=n.selectedItems.handleSize/2/n.scrollSettings.currentZoom,g=n.selectedItems.handleSize/2/n.scrollSettings.currentZoom;if(Uh(l.constraints,"ResizeAll")){if(Uh(l.constraints,"ConnectorSourceThumb")&&wn(r)&&ro(i,r.sourcePoint,p))return"ConnectorSourceEnd";if(Uh(l.constraints,"ConnectorTargetThumb")&&xn(r)&&ro(i,r.targetPoint,g))return"ConnectorTargetEnd";if("OrthoThumb"===(u=function(t,e,i,n){var r=e.handleSize/2/n.scrollSettings.currentZoom,o=e.handleSize/2/n.scrollSettings.currentZoom;if("Bezier"===t.type&&n.connectorEditingToolModule)for(var a=0;a<t.segments.length;a++){var s=t.segments[parseInt(a.toString(),10)];if(ro(i,K.isEmptyPoint(s.point1)?s.bezierPoint1:s.point1,o)&&(0===a&&Gh(t.bezierSettings.controlPointsVisibility,"Source")||0!==a&&Gh(t.bezierSettings.controlPointsVisibility,"Intermediate")))return"BezierSourceThumb";if(ro(i,K.isEmptyPoint(s.point2)?s.bezierPoint2:s.point2,r)&&(a===t.segments.length-1&&Gh(t.bezierSettings.controlPointsVisibility,"Target")||a!==t.segments.length-1&&Gh(t.bezierSettings.controlPointsVisibility,"Intermediate")))return"BezierTargetThumb"}if(n.connectorEditingToolModule&&In(t)){var e=(t.constraints&Z.ConnectorConstraints.InheritSegmentThumbSize?n:t).segmentThumbSize,h=20<e&&"Straight"!==t.type?e/2:10;if(h/=n.scrollSettings.currentZoom,"Straight"===t.type||"Bezier"===t.type)for(a=0;a<t.segments.length;a++){s=t.segments[parseInt(a.toString(),10)];if(ro(i,s.point,h))return"SegmentEnd"}else for(a=0;a<t.segments.length;a++){var d={x:0,y:0};if((s=t.segments[parseInt(a.toString(),10)]).allowDrag)for(var l=0;l<s.points.length-1;l++){var c=K.distancePoints(s.points[parseInt(l.toString(),10)],s.points[l+1]);if(50<=c&&(d.x=(s.points[parseInt(l.toString(),10)].x+s.points[l+1].x)/2,d.y=(s.points[parseInt(l.toString(),10)].y+s.points[l+1].y)/2,ro(i,d,h)))return"OrthoThumb"}}}else In(t)&&console.warn('[WARNING] :: Module "ConnectorEditing" is not available in Diagram component! You either misspelled the module name or forgot to load it.');return null}(r,l,i,n)))return u;if(Uh(l.constraints,"ConnectorSourceThumb")&&wn(r)&&u)return u;if(Uh(l.constraints,"ConnectorTargetThumb")&&xn(r)&&u)return u}}else{var u,p=n.selectedItems.handleSize/2/n.scroller.currentZoom,g=10/n.scroller.currentZoom,r=rt(),m=(at(r,o.rotateAngle+o.parentTransform,o.offsetX,o.offsetY),o.offsetX-o.pivot.x*o.actualSize.width),f=o.offsetY-o.pivot.y*o.actualSize.height,y=z(r,{x:m+(.5===o.pivot.x?2*o.pivot.x:o.pivot.x)*o.actualSize.width/2,y:f-30/n.scroller.currentZoom}),v=!!n.selectedItems.annotation,b=!(!v||!Cn(n.selectedItems.annotation));if(Uh(l.constraints,"Rotate")&&ro(i,y,g)&&n.selectedItems.thumbsConstraints&Z.ThumbsConstraints.Rotate){if(v&&b)return"LabelRotate";if(!v)return"Rotate"}if(c.Inflate(p),c.containsPoint(i))if(u=function(t,e,i,n,r,o){var a;1===t.selectedItems.nodes.length&&0===t.selectedItems.connectors.length&&t.selectedItems.nodes[0].container&&(a=function(t,e,i,n,r){var o=10/t.scroller.currentZoom,a=t.selectedItems,s=e.actualSize.width,h=e.actualSize.height,d=new k(n,r,e.style.strokeWidth,h),l=new k(n+s,r,e.style.strokeWidth,h),c=new k(n,r,s,e.style.strokeWidth),n=new k(n,r+h,s,e.style.strokeWidth),r=Ur(t,t.selectedItems.nodes[0],!0)?t.nameTable[t.selectedItems.nodes[0].parentId]:t.selectedItems.nodes[0];if(Fh(a.constraints,"ResizeEast",a.thumbsConstraints,a)&&l.containsPoint(i,o))return"ResizeEast";if(Fh(a.constraints,"ResizeSouth",a.thumbsConstraints,a)&&n.containsPoint(i,o))return"ResizeSouth";if("Grid"!==r.container.type){if(Fh(a.constraints,"ResizeWest",a.thumbsConstraints,a)&&d.containsPoint(i,o))return"ResizeWest";if(Fh(a.constraints,"ResizeNorth",a.thumbsConstraints,a)&&c.containsPoint(i,o))return"ResizeNorth"}return null}(t,e,i,r,o));a||t.selectedItems.nodes[0]&&(t.selectedItems.nodes[0].isPhase||t.selectedItems.nodes[0].isLane||"SwimLane"===t.selectedItems.nodes[0].shape.type)||(a=function(t,e,i,n,r,o){var a=40/t.scroller.currentZoom,s=t.selectedItems.handleSize/2/t.scroller.currentZoom,t=t.selectedItems,h=!!t.annotation;if(e.actualSize.width>=a&&e.actualSize.height>=a){if(Fh(t.constraints,"ResizeSouthEast",t.thumbsConstraints,t)&&ro(i,z(n,{x:r+e.actualSize.width,y:o+e.actualSize.height}),s))return h?"LabelResizeSouthEast":"ResizeSouthEast";if(Fh(t.constraints,"ResizeSouthWest",t.thumbsConstraints,t)&&ro(i,z(n,{x:r,y:o+e.actualSize.height}),s))return h?"LabelResizeSouthWest":"ResizeSouthWest";if(Fh(t.constraints,"ResizeNorthEast",t.thumbsConstraints,t)&&ro(i,z(n,{x:r+e.actualSize.width,y:o}),s))return h?"LabelResizeNorthEast":"ResizeNorthEast";if(Fh(t.constraints,"ResizeNorthWest",t.thumbsConstraints,t)&&ro(i,z(n,{x:r,y:o}),s))return h?"LabelResizeNorthWest":"ResizeNorthWest"}if(Fh(t.constraints,"ResizeEast",t.thumbsConstraints,t)&&ro(i,z(n,{x:r+e.actualSize.width,y:o+e.actualSize.height/2}),s))return h?"LabelResizeEast":"ResizeEast";if(Fh(t.constraints,"ResizeWest",t.thumbsConstraints,t)&&ro(i,z(n,{x:r,y:o+e.actualSize.height/2}),s))return h?"LabelResizeWest":"ResizeWest";if(Fh(t.constraints,"ResizeSouth",t.thumbsConstraints,t)&&ro(i,z(n,{x:r+e.actualSize.width/2,y:o+e.actualSize.height}),s))return h?"LabelResizeSouth":"ResizeSouth";if(Fh(t.constraints,"ResizeNorth",t.thumbsConstraints,t)&&ro(i,z(n,{x:r+e.actualSize.width/2,y:o}),s))return h?"LabelResizeNorth":"ResizeNorth";return null}(t,e,i,n,r,o));if(a)return a;return null}(n,o,i,r,m,f))return u}}if(Bn(n)&&!t)return"Pan";if((a instanceof Be||a instanceof je)&&(!Bn(n)||zn(n)||kn(n))&&"None"!==(u=no(n,a)))return u;if((a instanceof Ze||a instanceof Qe)&&!Bn(n)&&vn(a))return so(n,a,void 0,e)&&bn(a)?"LabelDrag":"LabelSelect";if(null!==t){if(!(t instanceof _||t instanceof W))return"Select";if(e&&e.id){y=e.id.split(t.id)[1];if(y&&y.match("^_icon"))return"LayoutAnimation"}if(e&&e.id)for(var S,w=0;w<t.fixedUserHandles.length;w++)if(S=t.fixedUserHandles[parseInt(w.toString(),10)].id,e.id&&-1<e.id.indexOf(S))return"FixedUserHandle";if(e instanceof H&&e.hyperlink.link)return"Hyperlink";if(!bn(t)||!so(n,t,!1)||void 0!==n.selectedItems.annotation)return t&&Bn(n)&&!jn(n)?"Pan":n.selectedItems.nodes.length&&n.selectedItems.nodes[0].isLane&&n.selectedItems.wrapper&&n.selectedItems.wrapper.bounds.containsPoint(i)?"Drag":"Select";if(t instanceof W&&!ro(i,t.sourcePoint,t.hitPadding)&&!ro(i,t.targetPoint,t.hitPadding)||!(t instanceof W))return"Drag"}return"Select"}function no(t,e,i,n){if(Xn(e)&&(Zh(e,Z.PortVisibility.Hover)||Zh(e,Z.PortVisibility.Visible))){if(e.constraints&Z.PortConstraints.Drag)return"PortDrag"}else if(Yn(e)&&(Zh(e,Z.PortVisibility.Hover)||Zh(e,Z.PortVisibility.Visible)))if(e.constraints&Z.PortConstraints.Draw)return t.drawingObject={},e={type:"Orthogonal",sourcePortID:e.id},t.drawingObject=e,t.tool|=Z.DiagramTools.DrawOnce,t.currentDrawingObject=e,"PortDraw";return"None"}function ro(t,e,i){return t.x>=e.x-i&&t.x<=e.x+i&&t.y>=e.y-i&&t.y<=e.y+i}function oo(t){return 0<t.selectedItems.nodes.length||0<t.selectedItems.connectors.length}function ao(t){return 1===t.selectedItems.connectors.length&&!t.selectedItems.nodes.length}function so(t,e,i,n){if(void 0===i&&(i=!0),e instanceof B)return!0;if(e instanceof _)for(;e;){if(-1!==t.selectedItems.nodes.indexOf(e)&&void 0===t.selectedItems.annotation)return!0;if(i)break;e=t.nameTable[e.parentId]}else if(e instanceof W){if(-1!==t.selectedItems.connectors.indexOf(e)&&void 0===t.selectedItems.annotation)return!0}else if((e instanceof Ze||e instanceof Qe)&&t.selectedItems.annotation&&t.selectedItems.wrapper.children[0].id===n.id)return!0;return!1}function ho(t,e){var i;return e=(e+360)%360,-1===t.indexOf("Resize")?co[""+t]:(i=co[""+t],0<=e&&e<25||160<=e&&e<=205||340<=e&&e<=360?i:25<=e&&e<=70||205<=e&&e<=250?"n-resize"===i||"s-resize"===i?"ne-resize":"nw-resize"===i||"se-resize"===i?"n-resize":"e-resize"===i||"w-resize"===i?"nw-resize":"e-resize":70<=e&&e<=115||250<=e&&e<=295?"n-resize"===i||"s-resize"===i?"e-resize":"nw-resize"===i||"se-resize"===i?"ne-resize":"e-resize"===i||"w-resize"===i?"n-resize":"nw-resize":115<=e&&e<=155||295<=e&&e<=340?"n-resize"===i||"s-resize"===i?"nw-resize":"nw-resize"===i||"se-resize"===i?"e-resize":"e-resize"===i||"w-resize"===i?"ne-resize":co[""+t]:"n-resize")}var lo,co={None:"default",Rotate:"crosshair",Select:"default",Drag:"move",ResizeWest:"w-resize",ResizeEast:"e-resize",ResizeSouth:"s-resize",ResizeNorth:"n-resize",Draw:"crosshair",PortDraw:"crosshair",ResizeNorthEast:"ne-resize",ResizeNorthWest:"nw-resize",ResizeSouthEast:"se-resize",ResizeSouthWest:"sw-resize",ConnectorSourceEnd:"move",ConnectorTargetEnd:"move",BezierSourceThumb:"move",BezierTargetThumb:"move",OrthoThumb:"move",SegmentEnd:"move",Pan:"grab",Hyperlink:"pointer",PortDrag:"pointer",LabelSelect:"pointer",LabelDrag:"move",LabelRotate:"crosshair",LabelResizeWest:"w-resize",LabelResizeEast:"e-resize",LabelResizeSouth:"s-resize",LabelResizeNorth:"n-resize",LabelResizeNorthEast:"ne-resize",LabelResizeNorthWest:"nw-resize",LabelResizeSouthEast:"se-resize",LabelResizeSouthWest:"sw-resize"},i=(lo=function(t,e){return(lo=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)},function(t,e){function i(){this.constructor=t}lo(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),po=function(o,a,s,h){return new(s=s||Promise)(function(t,e){function i(t){try{r(h.next(t))}catch(t){e(t)}}function n(t){try{r(h.throw(t))}catch(t){e(t)}}function r(e){e.done?t(e.value):new s(function(t){t(e.value)}).then(i,n)}r((h=h.apply(o,a||[])).next())})},go=function(n,r){var o,a,s,h={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(i){return function(t){var e=[i,t];if(o)throw new TypeError("Generator is already executing.");for(;h;)try{if(o=1,a&&(s=2&e[0]?a.return:e[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,e[1])).done)return s;switch(a=0,(e=s?[2&e[0],s.value]:e)[0]){case 0:case 1:s=e;break;case 4:return h.label++,{value:e[1],done:!1};case 5:h.label++,a=e[1],e=[0];continue;case 7:e=h.ops.pop(),h.trys.pop();continue;default:if(!(s=0<(s=h.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){h=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3]))h.label=e[1];else if(6===e[0]&&h.label<s[1])h.label=s[1],s=e;else{if(!(s&&h.label<s[2])){s[2]&&h.ops.pop(),h.trys.pop();continue}h.label=s[2],h.ops.push(e)}}e=r.call(n,h)}catch(t){e=[6,t],a=0}finally{o=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}}},en=(uo.prototype.startAction=function(t){this.currentElement=t,this.inAction=!0},uo.prototype.mouseDown=function(t){this.currentElement=t.source,this.startPosition=this.currentPosition=this.prevPosition=t.position,this.isTooltipVisible=!0,this.startAction(t.source),this.checkProperty=!0,this.mouseDownElement=t.source},uo.prototype.checkPropertyValue=function(){this.checkProperty&&this.commandHandler.startTransaction(this.isProtectChange)},uo.prototype.mouseMove=function(t){return this.currentPosition=t.position,this.inAction&&(this.commandHandler.startTransaction(this.isProtectChange),this.checkProperty=!1),!this.blocked},uo.prototype.mouseUp=function(t){this.checkPropertyValue(),this.currentPosition=t.position,this.isTooltipVisible=!1,this.commandHandler.endTransaction(this.isProtectChange),this.endAction(),this.mouseDownElement=null},uo.prototype.endAction=function(){this.isTooltipVisible||this.commandHandler.closeTooltip(),this.commandHandler=null,this.currentElement=null,this.currentPosition=null,this.inAction=!1,this.blocked=!1},uo.prototype.mouseWheel=function(t){this.currentPosition=t.position},uo.prototype.mouseLeave=function(t){this.mouseUp(t)},uo.prototype.updateSize=function(t,e,i,n,r,o){t=this.commandHandler.renderContainerHelper(t)||t;var a,s={snapped:!1,offset:0,left:!1,right:!1},h={snapped:!1,offset:0,top:!1,bottom:!1},d=this.currentPosition.x-this.startPosition.x,l=this.currentPosition.y-this.startPosition.y,c=!(t instanceof H)&&this.commandHandler.snappingModule&&this.commandHandler.snappingModule.canSnap(),p=c?this.commandHandler.snappingModule.getLayer():null,o=t instanceof H?o:t.rotateAngle,g=rt(),u=(at(g,-o,0,0),t.offsetX,t.offsetY,t.width,t.height,t.pivot.x,t.pivot.y,0),m=0,f=(t instanceof H?t.actualSize:t).width,y=(t instanceof H?t.actualSize:t).height;switch(n){case"ResizeWest":d=(a=z(g,{x:d,y:l})).x,l=a.y,m=1,d=c?this.commandHandler.snappingModule.snapLeft(s,h,p,d,l,t,i===e,r):d,l=0,u=(r.width-d)/f;break;case"ResizeEast":d=(a=z(g,{x:d,y:l})).x,l=a.y,d=c?this.commandHandler.snappingModule.snapRight(s,h,p,d,l,t,i===e,r):d,l=0,u=(r.width+d)/f,m=1;break;case"ResizeNorth":u=1,d=(a=z(g,{x:d,y:l})).x,l=a.y,l=c?this.commandHandler.snappingModule.snapTop(s,h,p,d,l,t,i===e,r):l,m=(r.height-l)/y;break;case"ResizeSouth":u=1,d=(a=z(g,{x:d,y:l})).x,l=a.y,l=c?this.commandHandler.snappingModule.snapBottom(s,h,p,d,l,t,i===e,r):l,m=(r.height+l)/y;break;case"ResizeNorthEast":d=(a=z(g,{x:d,y:l})).x,l=a.y,d=c?this.commandHandler.snappingModule.snapRight(s,h,p,d,l,t,i===e,r):d,l=c?this.commandHandler.snappingModule.snapTop(s,h,p,d,l,t,i===e,r):l,u=(r.width+d)/f,m=(r.height-l)/y;break;case"ResizeNorthWest":d=(a=z(g,{x:d,y:l})).x,l=a.y,l=c?this.commandHandler.snappingModule.snapTop(s,h,p,d,l,t,i===e,r):l,d=c?this.commandHandler.snappingModule.snapLeft(s,h,p,d,l,t,i===e,r):d,u=(r.width-d)/f,m=(r.height-l)/y;break;case"ResizeSouthEast":d=(a=z(g,{x:d,y:l})).x,l=a.y,l=c?this.commandHandler.snappingModule.snapBottom(s,h,p,d,l,t,i===e,r):l,d=c?this.commandHandler.snappingModule.snapRight(s,h,p,d,l,t,i===e,r):d,m=(r.height+l)/y,u=(r.width+d)/f;break;case"ResizeSouthWest":d=(a=z(g,{x:d,y:l})).x,l=a.y,l=c?this.commandHandler.snappingModule.snapBottom(s,h,p,d,l,t,i===e,r):l,d=c?this.commandHandler.snappingModule.snapLeft(s,h,p,d,l,t,i===e,r):d,u=(r.width-d)/f,m=(r.height+l)/y}return{width:u,height:m}},uo.prototype.getPivot=function(t){switch(t){case"ResizeWest":return{x:1,y:.5};case"ResizeEast":return{x:0,y:.5};case"ResizeNorth":return{x:.5,y:1};case"ResizeSouth":return{x:.5,y:0};case"ResizeNorthEast":return{x:0,y:1};case"ResizeNorthWest":return{x:1,y:1};case"ResizeSouthEast":return{x:0,y:0};case"ResizeSouthWest":return{x:1,y:0}}return{x:.5,y:.5}},uo.prototype.getShapeType=function(){var t="Image"===this.commandHandler.diagram.drawingObject.shape.type||"HTML"===this.commandHandler.diagram.drawingObject.shape.type||"Native"===this.commandHandler.diagram.drawingObject.shape.type||"Path"===this.commandHandler.diagram.drawingObject.shape.type?this.commandHandler.diagram.drawingObject.shape.type:this.commandHandler.diagram.drawingObject.shape.shape;return t},uo.prototype.triggerElementDrawEvent=function(t,e,i,n,r){t={source:t,state:e,objectType:i,cancel:!1,elementType:n};this.commandHandler.triggerEvent(Z.DiagramEvent.elementDraw,t),r&&t.cancel&&(this.commandHandler.diagram.resetTool(),this.inAction=!1)},uo);function uo(t,e){void 0===e&&(e=!1),this.commandHandler=null,this.inAction=!1,this.isProtectChange=!1,this.currentElement=null,this.blocked=!1,this.isTooltipVisible=!1,this.childTable={},this.undoElement={nodes:[],connectors:[]},this.checkProperty=!0,this.undoParentElement={nodes:[],connectors:[]},this.commandHandler=t,this.isProtectChange=e}i(yo,mo=en),yo.prototype.mouseDown=function(t){this.inAction=!0,mo.prototype.mouseDown.call(this,t)},yo.prototype.mouseMove=function(t){return mo.prototype.mouseMove.call(this,t),this.inAction&&!1===K.equals(this.currentPosition,this.prevPosition)&&(t=k.toBounds([this.prevPosition,this.currentPosition]),this.mouseDownElement&&!bn(this.mouseDownElement)?this.commandHandler.clearObjectSelection(this.mouseDownElement):(this.commandHandler.clearSelectedItems(),this.commandHandler.drawSelectionRectangle(t.x,t.y,t.width,t.height))),!this.blocked},yo.prototype.mouseUp=function(t){var e;this.checkPropertyValue(),this.commandHandler.isUserHandle(this.currentPosition)||(!1===K.equals(this.currentPosition,this.prevPosition)&&this.inAction?(e=k.toBounds([this.prevPosition,this.currentPosition]),this.commandHandler.doRubberBandSelection(e)):(e=this.commandHandler.getSelectedObject(),this.commandHandler.hasSelection()&&t.info&&t.info.ctrlKey?t&&t.source&&(this.commandHandler.isSelected(t.source)?1===t.clickCount&&this.commandHandler.unSelect(t.source):this.commandHandler.selectObjects([t.source],!0)):(this.commandHandler.clearSelection(null===t.source),"LabelSelect"===this.action?this.commandHandler.labelSelect(t.source,t.sourceWrapper,e):t.source&&this.commandHandler.selectObjects([t.source],!1,e)))),this.inAction=!1,mo.prototype.mouseUp.call(this,t)},yo.prototype.mouseLeave=function(t){this.inAction&&this.mouseUp(t)};var mo,fo=yo;function yo(t,e,i){t=mo.call(this,t,!0)||this;return t.action=i,t}i(So,vo=en),So.prototype.mouseUp=function(t){this.checkPropertyValue(),this.inAction=!1;for(var e,i=t.source,n=t.sourceWrapper.id,r=0;r<i.fixedUserHandles.length;r++)-1<n.indexOf(i.fixedUserHandles[parseInt(r.toString(),10)].id)&&(e=i.fixedUserHandles[parseInt(r.toString(),10)]);var o={fixedUserHandle:e,element:t.source},a=Z.DiagramEvent.fixedUserHandleClick;this.commandHandler.triggerEvent(a,o),vo.prototype.mouseUp.call(this,t)};var vo,bo=So;function So(){return null!==vo&&vo.apply(this,arguments)||this}i(Io,wo=en),Io.prototype.mouseDown=function(a){return po(this,void 0,void 0,function(){var e,i,n,r,o;return go(this,function(t){if(this.inAction=!0,this.undoElement=void 0,this instanceof No||(this.undoElement=Q(a.source)),wo.prototype.mouseDown.call(this,a),a.source&&a.source.connectors&&(this.prevPosition.x,this.prevPosition.y,e=a.source.connectors[0],this.oldConnector=Q(e)),"BezierSourceThumb"===this.endPoint||"BezierTargetThumb"===this.endPoint)for(i=0;i<e.segments.length;i++)n=e.segments[parseInt(i.toString(),10)],r=K.isEmptyPoint(n.point1)?n.bezierPoint1:n.point1,o=K.isEmptyPoint(n.point2)?n.bezierPoint2:n.point2,this.currentElement.handleSize!==e.hitPadding&&(e.hitPadding=this.currentElement.handleSize),(ro(this.currentPosition,r,e.hitPadding)||ro(this.currentPosition,o,e.hitPadding))&&(this.selectedSegment=n);return this.currentPosition=a.position,[2]})})},Io.prototype.mouseUp=function(l){return po(this,void 0,void 0,function(){var e,i,n,r,o,a,s,h,d;return go(this,function(t){return!N.isBlazor()&&this.isConnected&&l.source.connectors&&(d=l.source.connectors[0],e="ConnectorSourceEnd"===this.endPoint?"sourceID":"targetID",i="ConnectorSourceEnd"===this.endPoint?"sourcePortID":"targetPortID",o={connector:d,oldValue:{nodeId:this.oldConnector[e],portId:this.oldConnector[i]},newValue:{nodeId:d[e],portId:d[i]},cancel:!1,state:"Changed",connectorEnd:this.endPoint},d[e]===this.oldConnector[e]&&d[i]===this.oldConnector[i]||(this.commandHandler.triggerEvent(Z.DiagramEvent.connectionChange,o),this.isConnected=!1)),this.checkPropertyValue(),this.commandHandler.updateSelector(),this.commandHandler.removeSnap(),this instanceof No||("ConnectorSourceEnd"!==this.endPoint||!l.source.connectors.length||K.equals(l.source.connectors[0].sourcePoint,this.undoElement.connectors[0].sourcePoint)&&l.source.connectors[0].sourceID===this.undoElement.connectors[0].sourceID)&&("ConnectorTargetEnd"!==this.endPoint||K.equals(l.source.connectors[0].targetPoint,this.undoElement.connectors[0].targetPoint)&&l.source.connectors[0].targetID===this.undoElement.connectors[0].targetID)?this instanceof No||"BezierTargetThumb"!==this.endPoint&&"BezierSourceThumb"!==this.endPoint||this.undoElement&&l.source&&(s=Q(l.source),h={type:"SegmentChanged",redoObject:s,undoObject:this.undoElement,category:"Internal"},this.commandHandler.addHistoryEntry(h)):(d=i=e=void 0,l.source&&l.source.connectors&&"ConnectorSourceEnd"===this.endPoint?(e={x:this.oldConnector.sourcePoint.x,y:this.oldConnector.sourcePoint.y},d=l.source.connectors[0],i={x:d.sourcePoint.x,y:d.sourcePoint.y}):l.source&&l.source.connectors&&"ConnectorTargetEnd"===this.endPoint&&(e={x:this.oldConnector.targetPoint.x,y:this.oldConnector.targetPoint.y},d=l.source.connectors[0],i={x:d.targetPoint.x,y:d.targetPoint.y}),r=n=void 0,l.target&&(a=this.commandHandler.findTarget(l.targetWrapper,l.target,"ConnectorSourceEnd"===this.endPoint,!0),r=a.id,a instanceof Be)&&(n=a.id,r=l.target.id),o={connector:d,state:"Completed",targetNode:r,oldValue:e,newValue:i,cancel:!1,targetPort:n},a="ConnectorSourceEnd"===this.endPoint?Z.DiagramEvent.sourcePointChange:Z.DiagramEvent.targetPointChange,this.commandHandler.triggerEvent(a,o),this.commandHandler.removeTerminalSegment(d,!0),this.undoElement&&l.source&&(s=void 0,s=Q(l.source),h={type:"ConnectionChanged",redoObject:Q(s),undoObject:Q(this.undoElement),category:"Internal"},this.commandHandler.addHistoryEntry(h))),this.canCancel=void 0,this.tempArgs=void 0,l.source&&l.source.connectors&&(d=l.source.connectors[0]).isBezierEditing&&(d.isBezierEditing=!1),wo.prototype.mouseUp.call(this,l),[2]})})},Io.prototype.mouseMove=function(t){var e,i,n,r,o,a,s,h,d,l,c,p,g,u;return wo.prototype.mouseMove.call(this,t),this instanceof No||!("ConnectorSourceEnd"===this.endPoint&&K.equals(t.source.connectors[0].sourcePoint,this.undoElement.connectors[0].sourcePoint)||"ConnectorTargetEnd"===this.endPoint&&K.equals(t.source.connectors[0].targetPoint,this.undoElement.connectors[0].targetPoint))||(c=o=void 0,n=void(t.source&&t.source.connectors&&(o={x:this.prevPosition.x,y:this.prevPosition.y},c=t.source.connectors[0])),i=void 0,t.target&&(i=t.target.id,(g=this.commandHandler.findTarget(t.targetWrapper,t.target,"ConnectorSourceEnd"===this.endPoint,!0))instanceof Be||g instanceof Pl?n=g.id:i=g.id),p="ConnectorSourceEnd"===this.endPoint?Z.DiagramEvent.sourcePointChange:Z.DiagramEvent.targetPointChange,this.commandHandler.triggerEvent(p,c={connector:c,state:"Start",targetNode:i,oldValue:o,newValue:o,cancel:!1,targetPort:n})),this.currentPosition=t.position,this.currentPosition&&this.prevPosition&&(i=this.currentPosition.x-this.prevPosition.x,n=this.currentPosition.y-this.prevPosition.y,s=a=o=r=void 0,h=void(this.currentPosition=this.commandHandler.snapConnectorEnd(this.currentPosition)),d=void(t.source&&t.source.connectors&&(r={x:this.currentPosition.x,y:this.currentPosition.y},o={x:this.prevPosition.x,y:this.prevPosition.y},h=t.source.connectors[0])),l=void 0,t.target&&((g=this.commandHandler.findTarget(t.targetWrapper,t.target,"ConnectorSourceEnd"===this.endPoint,!0))instanceof Be?d=g.id:l=g.id),c={connector:h,state:"Progress",targetNode:l,oldValue:o,newValue:r,cancel:!1,targetPort:d},this instanceof No||(p="ConnectorSourceEnd"===this.endPoint?Z.DiagramEvent.sourcePointChange:Z.DiagramEvent.targetPointChange,this.commandHandler.triggerEvent(p,c)),t.target&&(a=Qh(t.target,!0),s=Qh(t.target,!1)),(!c.cancel&&this.inAction&&void 0!==this.endPoint&&0!=i||0!=n)&&(c.cancel||(this.blocked=!this.commandHandler.dragConnectorEnds(this.endPoint,t.source,this.currentPosition,this.selectedSegment,t.target,d),this.commandHandler.updateSelector()),t.target&&("ConnectorSourceEnd"===this.endPoint&&(Dn(t.target)||On(s))||"ConnectorTargetEnd"===this.endPoint&&(An(t.target)||Tn(a)))?(this.commandHandler.canDisconnect(this.endPoint,t,d,l)&&(e=this.commandHandler.disConnect(t.source,this.endPoint,this.canCancel),this.isConnected=!0),(g=this.commandHandler.findTarget(t.targetWrapper,t.target,"ConnectorSourceEnd"===this.endPoint,!0))instanceof _?(An(g)&&"ConnectorTargetEnd"===this.endPoint||Dn(g)&&"ConnectorSourceEnd"===this.endPoint)&&(e=this.commandHandler.connect(this.endPoint,t,this.canCancel),this.isConnected=!0):this.checkConnect(g)&&(this.isConnected=!0,e=this.commandHandler.connect(this.endPoint,t,this.canCancel))):-1===this.endPoint.indexOf("Bezier")&&(this.isConnected=!0,e=this.commandHandler.disConnect(t.source,this.endPoint,this.canCancel),this.commandHandler.updateSelector())),this.commandHandler.canEnableDefaultTooltip()&&(u=this.getTooltipContent(t.position),this.commandHandler.showTooltip(t.source,t.position,N.initializeCSPTemplate(function(){return u}),"ConnectTool",this.isTooltipVisible),this.isTooltipVisible=!1),e)&&(this.tempArgs=e),this.prevPosition=this.currentPosition,!this.blocked},Io.prototype.mouseLeave=function(t){this.mouseUp(t)},Io.prototype.getTooltipContent=function(t){return"X:"+Math.round(t.x)+" Y:"+Math.round(t.y)},Io.prototype.checkConnect=function(t){return!(!Tn(t)||"ConnectorTargetEnd"!==this.endPoint)||!(!On(t)||"ConnectorSourceEnd"!==this.endPoint)||!(t.constraints&Z.PortConstraints.None||Tn(t)||On(t))&&(void 0===t.constraints||0<(t.constraints&(Z.PortConstraints.Default&~(Z.PortConstraints.InConnect|Z.PortConstraints.OutConnect))))},Io.prototype.endAction=function(){wo.prototype.endAction.call(this),this.prevPosition=null,this.endPoint=null};var wo,xo=Io;function Io(t,e){t=wo.call(this,t,!0)||this;return t.isConnected=!1,t.endPoint=e,t}i(Ao,Co=en),Ao.prototype.mouseDown=function(t){var e;t.source instanceof _||t.source instanceof W?(e=this.commandHandler.getSelectedObject(),this.commandHandler.selectObjects([t.source],t.info&&t.info.ctrlKey,e),e={nodes:[],connectors:[]},(t.source instanceof _?e.nodes:e.connectors).push(Q(t.source)),this.undoElement=Q(e),e=t.source.wrapper,this.undoElement.offsetX=e.offsetX,this.undoElement.offsetY=e.offsetY):this.undoElement=Q(t.source),this.undoParentElement=this.commandHandler.getSubProcess(t.source),"Port"===this.objectType&&(this.portId=t.sourceWrapper.id),this.commandHandler.insertBlazorConnector(t.source),Co.prototype.mouseDown.call(this,t),this.initialOffset={x:0,y:0}},Ao.prototype.getPort=function(t){for(var e,i=t.source.id,n=t.source.ports,r=0;r<n.length;r++)if(t.sourceWrapper.id===i+"_"+n[parseInt(r.toString(),10)].id){e=n[parseInt(r.toString(),10)];break}return e},Ao.prototype.mouseUp=function(A,T){return po(this,void 0,void 0,function(){var e,i,n,r,o,a,s,h,d,l,c,p,g,u,m,f,y,v,b,S,w,x,I,C,P;return go(this,function(t){if(this.checkPropertyValue(),r=!1,o={nodes:[],connectors:[]},"Port"!==this.objectType){if(A.source instanceof _||A.source instanceof W?((A.source instanceof _?o.nodes:o.connectors).push(Q(A.source)),n=Q(o),a=A.source.wrapper,n.offsetX=a.offsetX,n.offsetY=a.offsetY):n=Q(A.source),"helper"===(a=this.commandHandler.renderContainerHelper(A.source)||A.source||this.commandHandler.renderContainerHelper(A.source)).id||"helper"!==a.id){if(s=!1,a instanceof B&&(h=Q(a)).selectedObjects.length===this.undoElement.selectedObjects.length)for(C=0;C<h.selectedObjects.length;C++)if(h.selectedObjects[parseInt(C.toString(),10)].id!==this.undoElement.selectedObjects[parseInt(C.toString(),10)].id){s=!0;break}if(d=a instanceof B,b=a instanceof B&&a.selectedObjects&&1===a.selectedObjects.length,m=a instanceof B&&Math.round(a.width)===Math.round(this.undoElement.width)&&Math.round(a.height)===Math.round(this.undoElement.height),l=a.offsetX!==this.undoElement.offsetX||a.offsetY!==this.undoElement.offsetY,c=a.sourcePoint!==this.undoElement.sourcePoint,p=a.targetPoint!==this.undoElement.targetPoint,!s&&(d&&(m||b)||!d)&&(l||c||p)||this.isSelectionHasConnector(a)){if(A.source&&(i={offsetX:A.source.wrapper.offsetX,offsetY:A.source.wrapper.offsetY},e={offsetX:A.source.wrapper.offsetX,offsetY:A.source.wrapper.offsetY}),P={source:A.source,state:"Completed",oldValue:this.intialValue,newValue:i,target:this.currentTarget,targetPosition:this.currentPosition,allowDrop:!0,cancel:!1},P={source:A.source,state:"Completed",oldValue:this.intialValue,newValue:i,target:this.currentTarget,targetPosition:this.currentPosition,allowDrop:P.allowDrop,cancel:P.cancel},g=!0,"helper"===a.id)if(this.canTrigger){if((1<n.nodes.length||1<n.connectors.length)&&this.commandHandler.diagram.lineRoutingModule&&this.commandHandler.diagram.constraints&Z.DiagramConstraints.LineRouting){for(u=this.commandHandler.diagram.nameTable,C=0;C<n.nodes.length;C++)if(!u[n.nodes[parseInt(C.toString(),10)].parentId]||!u[n.nodes[parseInt(C.toString(),10)].parentId].isLane){g=!1;break}}else g=!0;this.commandHandler.triggerEvent(Z.DiagramEvent.positionChange,P),this.connectorEndPointChangeEvent(P)}else g=!1;else this.commandHandler.triggerEvent(Z.DiagramEvent.positionChange,P),this.connectorEndPointChangeEvent(P);!T&&g&&(this.commandHandler.startGroupAction(),r=!0,S={type:"PositionChanged",redoObject:Q(n),undoObject:Q(this.undoElement),category:"Internal"},n.nodes[0]&&n.nodes[0].processId&&(m={type:"SizeChanged",category:"Internal",undoObject:this.undoParentElement,redoObject:this.commandHandler.getSubProcess(A.source)},this.commandHandler.addHistoryEntry(m)),this.commandHandler.addHistoryEntry(S))}}if(this.commandHandler.snapPoint(this.prevPosition,this.currentPosition,0,0),this.commandHandler.removeSnap(),this.commandHandler.removeHighlighter(),A.source&&this.currentTarget&&En(this.currentTarget)&&this.commandHandler.isDroppable(A.source,this.currentTarget)){if(f=!0,this.commandHandler.drop(this.currentElement,this.currentTarget,this.currentPosition),this.currentTarget&&this.currentTarget instanceof W&&!0===this.commandHandler.diagram.enableConnectorSplit)if(this.currentElement&&this.currentElement instanceof _){if(void 0!==this.currentElement.children)for(C=0;C<this.currentElement.children.length;C++)this.currentElement.children[parseInt(C.toString(),10)]!==this.currentTarget.sourceID&&this.currentElement.children[parseInt(C.toString(),10)]!==this.currentTarget.targetID||(f=!1);else this.currentElement.id!==this.currentTarget.sourceID&&this.currentElement.id!==this.currentTarget.targetID||(f=!1);f&&this.commandHandler.connectorSplit(this.currentElement,this.currentTarget)}else if(this.currentElement instanceof B&&!this.commandHandler.PreventConnectorSplit){if(this.currentElement.nodes[0].children)for(C=0;C<this.currentElement.nodes[0].children.length;C++)this.currentElement.nodes[0].children[parseInt(C.toString(),10)]!==this.currentTarget.sourceID&&this.currentElement.nodes[0].children[parseInt(C.toString(),10)]!==this.currentTarget.targetID||(f=!1);else this.currentElement.nodes[0].id!==this.currentTarget.sourceID&&this.currentElement.nodes[0].id!==this.currentTarget.targetID||(f=!1);f&&(this.commandHandler.connectorSplit(this.currentElement.nodes[0],this.currentTarget),this.commandHandler.PreventConnectorSplit=!1)}if(P={element:A.source,target:this.currentTarget,position:this.currentPosition,cancel:!1},this.commandHandler.triggerEvent(Z.DiagramEvent.drop,P),!P.cancel&&A.source&&this.commandHandler.isParentAsContainer(this.currentTarget)&&!this.commandHandler.isTargetSubProcess(this.currentTarget)){for(y=A.source instanceof B?A.source.nodes:[A.source],v=!1,C=0;C<y.length&&y[0].parentId===y[parseInt(C.toString(),10)].parentId;C++);for(this.commandHandler.diagram.selectedItems.nodes.length!==y.length&&(y=this.commandHandler.diagram.selectedItems.nodes),1<this.commandHandler.diagram.selectedItems.nodes.length?(y=this.calculateDiff(this.commandHandler.diagram.selectedItems,this.currentTarget,this.commandHandler.diagram),this.commandHandler.diagram.multiselect=!0):this.commandHandler.diagram.multiselect=!1,C=0;C<y.length;C++)y[parseInt(C.toString(),10)].container||this.commandHandler.diagram.cancelPositionChange||(v=!0,this.commandHandler.updateLaneChildrenZindex(y[parseInt(C.toString(),10)],this.currentTarget),this.commandHandler.dropChildToContainer(this.currentTarget,y[parseInt(C.toString(),10)]),this.commandHandler.renderContainerHelper(y[parseInt(C.toString(),10)]));1<y.length&&(b=this.commandHandler.diagram.nameTable.helper)&&Jr(this.currentTarget,b,this.commandHandler.diagram),r&&this.commandHandler.isContainer&&v&&this.commandHandler.endGroupAction()}}A.source&&this.currentTarget&&this.commandHandler.dropAnnotation(A.source,this.currentTarget),this.commandHandler.updateSelector(),r&&!this.commandHandler.isContainer&&this.commandHandler.endGroupAction()}else{if(o.nodes.push(Q(A.source)),A.portId=this.portId,n=Q(o),S={type:"PortPositionChanged",objectId:this.portId,redoObject:Q(n),undoObject:Q(this.undoElement),category:"Internal"},this.commandHandler.addHistoryEntry(S),w=this.getPort(A)){for(x=0<this.undoElement.nodes.length?this.undoElement.nodes[0].ports:[],I=0<this.undoElement.connectors.length?this.undoElement.connectors[0].ports:[],C=0;C<x.length;C++)if(w.id===x[parseInt(C.toString(),10)].id){e={offsetX:x[parseInt(C.toString(),10)].offset.x,offsetY:x[parseInt(C.toString(),10)].offset.y},i={offsetX:w.offset.x,offsetY:w.offset.y};break}for(C=0;C<I.length;C++)if(w.id===I[parseInt(C.toString(),10)].id){e={offset:I[parseInt(C.toString(),10)].offset},i={offset:w.offset};break}}P={source:w,state:"Completed",oldValue:e,newValue:i,target:this.currentTarget,targetPosition:this.currentPosition,allowDrop:!0,cancel:!1},this.commandHandler.triggerEvent(Z.DiagramEvent.positionChange,P)}return Co.prototype.mouseUp.call(this,A),[2]})})},Ao.prototype.clearDiff=function(t){t.forEach(function(t,e){delete t.diffX,delete t.diffY})},Ao.prototype.calculateDiff=function(t,e,i){this.clearDiff(t.nodes);var n,r,o=t.wrapper.bounds.left,a=t.wrapper.bounds.top,s=e.wrapper.bounds.left,h=e.wrapper.bounds.top,i=i.nameTable[e.parentId],e=(0===e.columnIndex&&i&&"Horizontal"===i.shape.orientation&&(s+=50),1===e.rowIndex&&i&&"Vertical"===i.shape.orientation&&(h+=50),n=o<s?s-o:0,r=a<h?h-a:0,t.nodes);return e.forEach(function(t,e){t.diffX=n,t.diffY=r}),e},Ao.prototype.connectorEndPointChangeEvent=function(t,e){var i=t.source;if(i instanceof B&&0<i.nodes.length)for(var n=0;n<i.nodes.length;n++){var r=i.nodes[parseInt(n.toString(),10)];if(r&&0<r.inEdges.length)for(var o=0;o<r.inEdges.length;o++){var a=this.commandHandler.diagram.getObject(r.inEdges[parseInt(o.toString(),10)]);this.triggerEndPointEvent(a,t,e,"targetPointChange")}if(r&&0<r.outEdges.length)for(o=0;o<r.outEdges.length;o++){a=this.commandHandler.diagram.getObject(r.outEdges[parseInt(o.toString(),10)]);this.triggerEndPointEvent(a,t,e,"sourcePointChange")}}},Ao.prototype.triggerEndPointEvent=function(t,e,i,n){t={connector:t,state:e.state,targetNode:t.targetID,targetPort:t.targetPortID,sourceNode:t.sourceID,sourcePort:t.sourcePortID,oldValue:{x:t.targetPoint.x,y:t.targetPoint.y},newValue:{x:t.targetPoint.x+(i?i.x:0),y:t.targetPoint.y+(i?i.y:0)},cancel:e.cancel};this.commandHandler.triggerEvent("targetPointChange"===n?Z.DiagramEvent.targetPointChange:Z.DiagramEvent.sourcePointChange,t)},Ao.prototype.isSelectionHasConnector=function(t){return!(!(t.nodes&&t.connectors&&0<t.nodes.length&&0<t.connectors.length)||t.width===this.undoElement.width&&t.height===this.undoElement.height)},Ao.prototype.mouseMove=function(t){Co.prototype.mouseMove.call(this,t);var e,i=!1,n=this.commandHandler.renderContainerHelper(t.source)||t.source,r=(n instanceof _||n instanceof W?n instanceof _?n.offsetX===this.undoElement.nodes[0].offsetX&&n.offsetY===this.undoElement.nodes[0].offsetY&&(i=!0):K.equals(n.sourcePoint,this.undoElement.connectors[0].sourcePoint)&&K.equals(n.targetPoint,this.undoElement.connectors[0].targetPoint)&&(i=!0):n.wrapper.offsetX===this.undoElement.wrapper.offsetX&&n.wrapper.offsetY===this.undoElement.wrapper.offsetY&&(i=!0),{source:n,state:"Start",oldValue:e=n?{offsetX:n.wrapper.offsetX,offsetY:n.wrapper.offsetY}:e,newValue:e,target:t.target,targetPosition:t.position,allowDrop:!0,cancel:!1}),r={source:n,state:"Start",oldValue:e,newValue:e,target:t.target,targetPosition:t.position,allowDrop:r.allowDrop,cancel:r.cancel};if("Port"===this.objectType){if(f=this.getPort(t)){for(var o=0<this.undoElement.nodes.length?this.undoElement.nodes[0].ports:[],a=0<this.undoElement.connectors.length?this.undoElement.connectors[0].ports:[],s=0;s<o.length;s++)if(e={offsetX:f.offset.x,offsetY:f.offset.y},f.offset.x!==o[parseInt(s.toString(),10)].offset.x||f.offset.y!==o[parseInt(s.toString(),10)].offset.y){i=!1;break}for(s=0;s<a.length;s++)if(e={offset:f.offset},f.offset!==a[parseInt(s.toString(),10)].offset){i=!1;break}}r={source:f,state:"Start",oldValue:e,newValue:e,target:t.target,targetPosition:t.position,allowDrop:!0,cancel:!1}}if(!this.isStartAction&&(this.intialValue={offsetX:n.wrapper.offsetX,offsetY:n.wrapper.offsetY},this.commandHandler.diagram.lineRoutingModule)&&this.commandHandler.diagram.constraints&Z.DiagramConstraints.LineRouting&&"ComplexHierarchicalTree"!==this.commandHandler.diagram.layout.type){var h=up(n.wrapper);h.Inflate(40);for(var d=0,l=this.commandHandler.diagram.spatialSearch.findObjects(h);d<l.length;d++){var c=l[d];c instanceof W&&this.commandHandler.diagram.routedConnectors.indexOf(c.id)}}if(i&&!N.isBlazor()&&(this.commandHandler.triggerEvent(Z.DiagramEvent.positionChange,r),this.connectorEndPointChangeEvent(r),this.isStartAction=!0),this.commandHandler.diagram.cancelPositionChange=r.cancel,this.currentPosition=t.position,"Port"!==this.objectType){this.currentPosition.x,this.prevPosition.x,this.currentPosition.y,this.prevPosition.y;var p,h=this.initialOffset.x+(this.currentPosition.x-this.prevPosition.x),r=this.initialOffset.y+(this.currentPosition.y-this.prevPosition.y),g=(this.commandHandler.dragOverElement(t,this.currentPosition),this.commandHandler.disConnect(t.source),this.commandHandler.removeSnap(),void 0),u=this.commandHandler.snapPoint(this.prevPosition,this.currentPosition,h,r),h=(this.initialOffset.x=h-u.x,this.initialOffset.y=r-u.y,n&&(y={offsetX:n.wrapper.offsetX,offsetY:n.wrapper.offsetY},g={offsetX:n.wrapper.offsetX+u.x,offsetY:n.wrapper.offsetY+u.y}),this.currentTarget&&t.target!==this.currentTarget&&this.commandHandler.removeChildFromBPmn(t.source,t.target,this.currentTarget),this.currentTarget=t.target,{source:n,state:"Progress",oldValue:y,newValue:g,target:t.target,targetPosition:t.position,allowDrop:!0,cancel:!1});this.commandHandler.triggerEvent(Z.DiagramEvent.positionChange,h),this.commandHandler.diagram.cancelPositionChange=h.cancel,this.canTrigger=!0,this.connectorEndPointChangeEvent(h,u),h.cancel||this.canCancel||(this.blocked=!this.commandHandler.dragSelectedObjects(u.x,u.y),r=!this.commandHandler.mouseOver(this.currentElement,this.currentTarget,this.currentPosition),this.blocked=this.blocked||r),this.commandHandler.removeStackHighlighter(),this.commandHandler.renderStackHighlighter(t),this.currentTarget&&t.source!==this.currentTarget&&this.commandHandler.isDroppable(t.source,this.currentTarget)&&"helper"!==t.source.id?(n=t.source instanceof B?t.source.nodes[0]:t.source,this.commandHandler.isParentAsContainer(n,!0)||"SwimLane"===n.shape.type||n.shape.isPhase||(this.currentTarget.isLane?this.commandHandler.renderStackHighlighter(t,this.currentTarget):this.commandHandler.drawHighlighter(this.currentTarget))):this.commandHandler.removeHighlighter(),this.commandHandler.canEnableDefaultTooltip()&&(p=this.getTooltipContent(t.source),this.commandHandler.showTooltip(t.source,t.position,N.initializeCSPTemplate(function(){return p}),"MoveTool",this.isTooltipVisible),this.isTooltipVisible=!1)}else{var m,f,y=rt(),h=t.source,g=void 0,o=0<this.undoElement.nodes.length?this.undoElement.nodes[0].ports:[],a=0<this.undoElement.connectors.length?this.undoElement.connectors[0].ports:[];if(f=this.getPort(t)){for(s=0;s<o.length;s++){m={offsetX:f.offset.x,offsetY:f.offset.y};break}for(s=0;s<a.length;s++){m={offset:f.offset};break}}at(y,-h.rotateAngle||-h.wrapper.rotateAngle,h.offsetX||h.wrapper.offsetX,h.offsetY||h.wrapper.offsetY);u=z(y,{x:this.prevPosition.x,y:this.prevPosition.y}),r=z(y,{x:t.position.x,y:t.position.y});if(this.commandHandler.portDrag(t.source,t.sourceWrapper,r.x-u.x,r.y-u.y),f){for(s=0;s<o.length;s++){g={offsetX:f.offset.x,offsetY:f.offset.y};break}for(s=0;s<a.length;s++){g={offset:f.offset};break}}n={source:f,state:"Progress",oldValue:m,newValue:g,target:t.target,targetPosition:t.position,allowDrop:!0,cancel:!1};this.commandHandler.triggerEvent(Z.DiagramEvent.positionChange,n)}return this.prevPosition=this.currentPosition,!this.blocked},Ao.prototype.getTooltipContent=function(t){return"X:"+Math.round(t.wrapper.bounds.x)+" Y:"+Math.round(t.wrapper.bounds.y)},Ao.prototype.mouseLeave=function(t){this.mouseUp(t)},Ao.prototype.endAction=function(){Co.prototype.endAction.call(this),this.currentTarget=null,this.prevPosition=null};var Co,Po=Ao;function Ao(t,e){t=Co.call(this,t,!0)||this;return t.currentTarget=null,t.isStartAction=!1,t.canCancel=!1,t.canTrigger=!1,t.objectType=e,t}i(Oo,To=en),Oo.prototype.mouseDown=function(t){if(this.undoElement=Q(t.source),this.undoElement.nodes[0]&&this.undoElement.nodes[0].children)for(var e=this.commandHandler.getAllDescendants(this.undoElement.nodes[0],[]),i=0;i<e.length;i++){var n=this.commandHandler.cloneChild(e[parseInt(i.toString(),10)].id);this.childTable[e[parseInt(i.toString(),10)].id]=Q(n)}To.prototype.mouseDown.call(this,t)},Oo.prototype.mouseUp=function(n){return po(this,void 0,void 0,function(){var e,i;return go(this,function(t){return this.checkPropertyValue(),e=this.commandHandler.renderContainerHelper(n.source)||n.source,this.undoElement.rotateAngle!==e.wrapper.rotateAngle&&(i={rotateAngle:this.undoElement.rotateAngle},e={rotateAngle:e.wrapper.rotateAngle},i={source:n.source,state:"Completed",oldValue:i,newValue:e,cancel:!1},this.commandHandler.triggerEvent(Z.DiagramEvent.rotateChange,i),e=Q(n.source),i={type:"RotationChanged",redoObject:Q(e),undoObject:Q(this.undoElement),category:"Internal",childTable:this.childTable},this.commandHandler.addHistoryEntry(i),this.commandHandler.updateSelector(),this.rotateStart=!1),this.canCancel=void 0,this.tempArgs=void 0,To.prototype.mouseUp.call(this,n),[2]})})},Oo.prototype.mouseMove=function(t){To.prototype.mouseMove.call(this,t),e=this.commandHandler.renderContainerHelper(t.source)||t.source,this.undoElement.rotateAngle!==e.wrapper.rotateAngle||this.rotateStart||(n={rotateAngle:e.wrapper.rotateAngle},n={source:t.source,state:"Start",oldValue:n,newValue:n,cancel:!1},this.commandHandler.triggerEvent(Z.DiagramEvent.rotateChange,n),this.rotateStart=!0),this.currentPosition=t.position;var e,i,n={x:e.wrapper.offsetX,y:e.wrapper.offsetY},n=K.findAngle(n,this.currentPosition)+90,r=this.commandHandler.snapAngle(n),o={rotateAngle:e.wrapper.rotateAngle},r={rotateAngle:n=((0!==r?r:n)+360)%360},a=(t.source,!1),o={source:t.source,state:"Progress",oldValue:o,newValue:r,cancel:a};return this.commandHandler.triggerEvent(Z.DiagramEvent.rotateChange,o),o.cancel||(this.blocked=!this.commandHandler.rotateSelectedItems(n-e.wrapper.rotateAngle)),this.commandHandler.canEnableDefaultTooltip()&&(i=this.getTooltipContent(t.source),this.commandHandler.showTooltip(t.source,t.position,N.initializeCSPTemplate(function(){return i}),"RotateTool",this.isTooltipVisible),this.isTooltipVisible=!1),!this.blocked},Oo.prototype.getTooltipContent=function(t){return Math.round(t.rotateAngle%360).toString()+"°"},Oo.prototype.mouseLeave=function(t){this.mouseUp(t)},Oo.prototype.endAction=function(){To.prototype.endAction.call(this)};var To,Do=Oo;function Oo(t){t=To.call(this,t,!0)||this;return t.rotateStart=!1,t}i(Lo,Mo=en),Lo.prototype.mouseDown=function(t){if(this.undoElement=Q(t.source),this.undoParentElement=this.commandHandler.getSubProcess(t.source),Mo.prototype.mouseDown.call(this,t),this.undoElement.nodes[0]&&this.undoElement.nodes[0].children)for(var e=this.commandHandler.getAllDescendants(this.undoElement.nodes[0],[]),i=0;i<e.length;i++){var n=this.commandHandler.cloneChild(e[parseInt(i.toString(),10)].id);this.childTable[e[parseInt(i.toString(),10)].id]=Q(n)}this.commandHandler.checkSelection(t.source,this.corner),Mo.prototype.mouseDown.call(this,t),this.initialBounds.x=t.source.wrapper.offsetX,this.initialBounds.y=t.source.wrapper.offsetY,this.initialBounds.height=t.source.wrapper.actualSize.height,this.initialBounds.width=t.source.wrapper.actualSize.width},Lo.prototype.mouseUp=function(n,r){return po(this,void 0,void 0,function(){var e,i;return go(this,function(t){return this.checkPropertyValue(),this.commandHandler.removeSnap(),this.commandHandler.updateSelector(),i=this.commandHandler.renderContainerHelper(n.source)||n.source,this.undoElement.offsetX===i.wrapper.offsetX&&this.undoElement.offsetY===i.wrapper.offsetY&&this.undoElement.width===i.wrapper.bounds.width&&this.undoElement.height===i.wrapper.bounds.height||(e=this.updateSize(n.source,this.currentPosition,this.prevPosition,this.corner,this.initialBounds),this.blocked=this.scaleObjects(e.width,e.height,this.corner,this.currentPosition,this.prevPosition,i),e={width:n.source.wrapper.actualSize.width,height:n.source.wrapper.actualSize.height},i={source:n.source,state:"Completed",oldValue:this.startValues,newValue:e,cancel:!1},this.commandHandler.triggerEvent(Z.DiagramEvent.sizeChange,i),e=Q(n.source),i={type:"SizeChanged",redoObject:Q(e),undoObject:Q(this.undoElement),category:"Internal",childTable:this.childTable},this.resizeStart=!1,r)||(this.commandHandler.startGroupAction(),this.commandHandler.addHistoryEntry(i),e.nodes[0]&&e.nodes[0].processId&&(i={type:"SizeChanged",redoObject:this.commandHandler.getSubProcess(n.source),undoObject:this.undoParentElement,category:"Internal"},this.commandHandler.addHistoryEntry(i)),this.commandHandler.endGroupAction()),Mo.prototype.mouseUp.call(this,n),[2,!this.blocked]})})},Lo.prototype.mouseMove=function(t){Mo.prototype.mouseMove.call(this,t),e=this.commandHandler.renderContainerHelper(t.source)||t.source,this.undoElement.offsetX!==e.wrapper.offsetX||this.undoElement.offsetY!==e.wrapper.offsetY||this.resizeStart||(n={width:t.source.wrapper.actualSize.width,height:t.source.wrapper.actualSize.height},this.startValues=n,n={source:t.source,state:"Start",oldValue:n,newValue:this.currentElement,cancel:!1},this.commandHandler.triggerEvent(Z.DiagramEvent.sizeChange,n),this.resizeStart=!0),this.currentPosition=t.position;var e,i,n=this.currentPosition.x-this.startPosition.x,r=this.currentPosition.y-this.startPosition.y,n=Ap(-this.currentElement.wrapper.rotateAngle,void 0,void 0,{x:n,y:r}),r=(this.currentElement.wrapper.actualSize.width,n.x,this.currentElement.wrapper.actualSize.width,this.currentElement.wrapper.actualSize.height,n.y,this.currentElement.wrapper.actualSize.height,this.getChanges(n),this.commandHandler.removeSnap(),this.updateSize(t.source,this.startPosition,this.currentPosition,this.corner,this.initialBounds));return this.blocked=!this.scaleObjects(r.width,r.height,this.corner,this.startPosition,this.currentPosition,e),this.commandHandler.canEnableDefaultTooltip()&&(i=this.getTooltipContent(t.source),this.commandHandler.showTooltip(t.source,t.position,N.initializeCSPTemplate(function(){return i}),"ResizeTool",this.isTooltipVisible),this.isTooltipVisible=!1),this.prevPosition=this.currentPosition,!this.blocked},Lo.prototype.mouseLeave=function(t){this.mouseUp(t)},Lo.prototype.getTooltipContent=function(t){return"W:"+Math.round(t.wrapper.bounds.width)+" H:"+Math.round(t.wrapper.bounds.height)},Lo.prototype.getChanges=function(t){switch(this.corner){case"ResizeEast":return{x:t.x,y:0};case"ResizeSouthEast":return t;case"ResizeSouth":return{x:0,y:t.y};case"ResizeNorth":return{x:0,y:-t.y};case"ResizeNorthEast":return{x:t.x,y:-t.y};case"ResizeNorthWest":return{x:-t.x,y:-t.y};case"ResizeWest":return{x:-t.x,y:0};case"ResizeSouthWest":return{x:-t.x,y:t.y}}return t},Lo.prototype.scaleObjects=function(t,e,i,n,r,o){o instanceof B&&1===o.nodes.length&&o.nodes[0].constraints&Z.NodeConstraints.AspectRatio&&("ResizeWest"===i||"ResizeEast"===i||"ResizeNorth"===i||"ResizeSouth"===i?1===e&&1===t||(e=t=Math.max(1===e?0:e,1===t?0:t)):e=t=Math.max(e,t));var i={width:o.width,height:o.height},a=(this.blocked=this.commandHandler.scaleSelectedItems(t,e,this.getPivot(this.corner)),{width:o.width,height:o.height}),o={source:o,state:"Progress",oldValue:i,newValue:a,cancel:{source:o,state:"Progress",oldValue:i,newValue:a,cancel:!1}.cancel};return this.commandHandler.triggerEvent(Z.DiagramEvent.sizeChange,o),(o.cancel||this.canCancel)&&this.commandHandler.scaleSelectedItems(1/t,1/e,this.getPivot(this.corner)),this.blocked};var Mo,Eo=Lo;function Lo(t,e){t=Mo.call(this,t,!0)||this;return t.resizeStart=!1,t.initialBounds=new k,t.canCancel=!1,t.corner=e,t}i(Bo,zo=en),Bo.prototype.mouseDown=function(t){zo.prototype.mouseDown.call(this,t),this.inAction=!0,this.commandHandler.setFocus(),this.triggerElementDrawEvent(t.source,"Start","Node",this.getShapeType(),!0)},Bo.prototype.mouseMove=function(t){zo.prototype.mouseMove.call(this,t);var e,t={offsetX:this.currentPosition.x,width:3,height:3,offsetY:this.currentPosition.y};return this.drawingObject||(this.drawingObject=this.commandHandler.drawObject(t)),this.triggerElementDrawEvent(this.drawingObject,"Progress","Node",this.getShapeType(),!1),this.inAction&&!1===K.equals(this.currentPosition,this.prevPosition)&&(t=k.toBounds([this.prevPosition,this.currentPosition]),e=this.commandHandler.checkBoundaryConstraints(void 0,void 0,t))&&this.commandHandler.updateNodeDimension(this.drawingObject,t),e},Bo.prototype.mouseUp=function(t){this.checkPropertyValue();var e=k.toBounds([this.prevPosition,this.currentPosition]);this.commandHandler.checkBoundaryConstraints(void 0,void 0,e);this.drawingObject&&this.drawingObject instanceof _&&(this.commandHandler.addObjectToDiagram(this.drawingObject),this.triggerElementDrawEvent(this.drawingObject,"Completed","Node",this.getShapeType(),!1),this.drawingObject=null),zo.prototype.mouseUp.call(this,t),this.inAction=!1},Bo.prototype.endAction=function(){zo.prototype.endAction.call(this)},Bo.prototype.mouseLeave=function(t){this.inAction&&this.mouseUp(t)};var zo,ko=Bo;function Bo(t,e){t=zo.call(this,t,!0)||this;return t.sourceObject=e,t}i(jo,Ro=xo),jo.prototype.mouseDown=function(e){return po(this,void 0,void 0,function(){return go(this,function(t){return Ro.prototype.mouseDown.call(this,e),this.inAction=!0,this.commandHandler.setFocus(),this.triggerElementDrawEvent(e.source,"Start","Connector",this.commandHandler.diagram.drawingObject.type,!0),[2]})})},jo.prototype.mouseMove=function(t){var e;return this.commandHandler.enableServerDataBinding(!1),this.inAction&&(e={sourcePoint:this.currentPosition,targetPoint:this.currentPosition},this.drawingObject||(this.drawingObject=this.commandHandler.drawObject(e)),t.source=this.drawingObject,this.triggerElementDrawEvent(t.source,"Progress","Connector",this.drawingObject.type,!1),t.actualObject&&(t.actualObject.parentId||t.actualObject.children)&&""===this.drawingObject.sourceID&&this.setTarget(t),(t.target&&t.target instanceof _||t.actualObject&&t.sourceWrapper&&md(t.actualObject,t.sourceWrapper))&&("ConnectorTargetEnd"!==this.endPoint||An(t.target))&&this.commandHandler.connect(this.endPoint,t),this.endPoint="ConnectorTargetEnd"),this.inAction||(this.commandHandler.updateSelector(),t.source&&!t.source.isLane&&t.sourceWrapper&&this.commandHandler.renderHighlighter(t,!0)),Ro.prototype.mouseMove.call(this,t),this.commandHandler.enableServerDataBinding(!0),!this.blocked},jo.prototype.setTarget=function(t){t.target?t.sourceWrapper.id.includes(t.target.id)||t.target.parentId&&t.sourceWrapper.id.includes(t.target.parentId)&&(t.target=this.commandHandler.diagram.nameTable[t.target.parentId]):t.sourceWrapper.id.includes(t.actualObject.id)?t.target=t.actualObject:t.actualObject.parentId&&t.sourceWrapper.id.includes(t.actualObject.parentId)&&(t.target=this.commandHandler.diagram.nameTable[t.actualObject.parentId])},jo.prototype.mouseUp=function(e){return po(this,void 0,void 0,function(){return go(this,function(t){return this.commandHandler.enableServerDataBinding(!1),this.checkPropertyValue(),this.drawingObject&&this.drawingObject instanceof W&&(this.commandHandler.addObjectToDiagram(this.drawingObject),this.triggerElementDrawEvent(this.drawingObject,"Completed","Connector",this.drawingObject.type,!1),this.drawingObject=null),this.inAction=!1,this.commandHandler.enableServerDataBinding(!0),Ro.prototype.mouseUp.call(this,e),[2]})})},jo.prototype.endAction=function(){Ro.prototype.endAction.call(this)},jo.prototype.mouseLeave=function(t){this.inAction&&this.mouseUp(t)};var Ro,No=jo;function jo(t,e,i){t=Ro.call(this,t,e)||this;return t.sourceObject=i,t}i(_o,Ho=en),_o.prototype.mouseDown=function(t){Ho.prototype.mouseDown.call(this,t),this.commandHandler.clearSelection();var e={shape:{type:"Text"},offsetX:this.currentPosition.x,offsetY:this.currentPosition.y};t.source||(this.drawingNode=this.commandHandler.drawObject(e))},_o.prototype.mouseMove=function(t){return Ho.prototype.mouseMove.call(this,t),this.drawingNode?this.drawingNode.style.strokeColor="black":(t={shape:{type:"Text"},offsetX:this.currentPosition.x,width:30,height:30,offsetY:this.currentPosition.y},this.drawingNode=this.commandHandler.drawObject(t)),this.drawingNode.style.strokeDashArray="2 2",this.drawingNode.style.fill="transparent",this.inAction&&!1===K.equals(this.currentPosition,this.prevPosition)&&(t=k.toBounds([this.prevPosition,this.currentPosition]),this.commandHandler.updateNodeDimension(this.drawingNode,t)),!this.blocked},_o.prototype.mouseUp=function(t){this.checkPropertyValue(),this.drawingNode?(this.drawingNode.style.strokeColor="none",this.drawingNode.style.fill="none"):this.drawingNode=t.source,this.drawingNode&&this.drawingNode instanceof _&&this.commandHandler.addText(this.drawingNode,this.currentPosition),Ho.prototype.mouseUp.call(this,t),this.inAction=!1},_o.prototype.endAction=function(){Ho.prototype.endAction.call(this)};var Ho,Wo=_o;function _o(t){return Ho.call(this,t,!0)||this}i(Vo,Yo=en),Vo.prototype.mouseDown=function(t){Yo.prototype.mouseDown.call(this,t),this.inAction=!0,this.commandHandler.setBlazorDiagramProps(!0)},Vo.prototype.mouseMove=function(t){var e,i,n,r,o;return Yo.prototype.mouseMove.call(this,t),this.inAction&&(this.zooming||!1!==K.equals(this.currentPosition,this.prevPosition)?t.moveTouches&&t.moveTouches.length&&2<=t.moveTouches.length&&(e=t.startTouches[0],i=t.startTouches[1],n=t.moveTouches[0],r=t.moveTouches[1],o=this.getDistance(n,r)/this.getDistance(e,i),t=t.position,1!=o&&this.commandHandler.zoom(o,0,0,t),this.updateTouch(e,n),this.updateTouch(i,r)):(o=this.currentPosition.x-this.prevPosition.x,t=this.currentPosition.y-this.prevPosition.y,this.commandHandler.scroll(o,t,this.currentPosition))),this.commandHandler.dataBinding(),!this.blocked},Vo.prototype.mouseUp=function(t){this.commandHandler.setBlazorDiagramProps(!1),this.checkPropertyValue(),this.commandHandler.updatePanState(!1),Yo.prototype.mouseUp.call(this,t),this.inAction=!1},Vo.prototype.endAction=function(){Yo.prototype.endAction.call(this)},Vo.prototype.getDistance=function(t,e){var i=e.pageX-t.pageX,e=e.pageY-t.pageY;return Math.sqrt(i*i+e*e)},Vo.prototype.updateTouch=function(t,e){t.pageX=e.pageX,t.pageY=e.pageY};var Yo,Xo=Vo;function Vo(t,e){t=Yo.call(this,t)||this;return t.zooming=e,t}i(Go,Fo=en),Go.prototype.mouseUp=function(t){this.checkPropertyValue(),this.commandHandler.initExpand(t),Fo.prototype.mouseUp.call(this,t)};var Fo,Uo=Go;function Go(t){return Fo.call(this,t,!0)||this}i(qo,Zo=en),qo.prototype.mouseUp=function(t){this.checkPropertyValue();var e="_blank",i="",n=window.innerHeight,r=window.innerWidth,o=window.screenTop,a=window.screenLeft;"CurrentTab"===t.sourceWrapper.hyperlink.hyperlinkOpenState?e="_self":"NewWindow"===t.sourceWrapper.hyperlink.hyperlinkOpenState&&(i="height="+n+",width="+r+",top="+o+",left="+a),window.open(t.sourceWrapper.hyperlink.link,e,i).focus(),Zo.prototype.mouseUp.call(this,t)};var Zo,Ko=qo;function qo(t){return Zo.call(this,t,!0)||this}i($o,Qo=en),$o.prototype.mouseDown=function(t){var e,i;Qo.prototype.mouseDown.call(this,t),this.inAction=!0,this.drawingObject?(e=void 0,e={x:(e=(i=this.drawingObject.shape).points[i.points.length-1]).x,y:e.y},this.drawingObject.shape.points.push(e)):(this.startPoint={x:this.startPosition.x,y:this.startPosition.y},i={offsetX:this.currentPosition.x,offsetY:this.currentPosition.y,width:5,height:5,shape:{type:"Basic",shape:"Polygon",points:[{x:this.startPoint.x,y:this.startPoint.y},{x:this.currentPosition.x,y:this.currentPosition.y}]}},this.triggerElementDrawEvent(t.source,"Start","Node",this.getShapeType(),!0),this.drawingObject=this.commandHandler.drawObject(i))},$o.prototype.mouseMove=function(t){return Qo.prototype.mouseMove.call(this,t),this.inAction&&((t=this.drawingObject.shape).points[t.points.length-1].x=this.currentPosition.x,t.points[t.points.length-1].y=this.currentPosition.y,this.drawingObject.wrapper.children[0].data=L(this.drawingObject.shape.points),this.triggerElementDrawEvent(this.drawingObject,"Progress","Node",this.getShapeType(),!1),this.inAction)&&!1===K.equals(this.currentPosition,this.prevPosition)&&(t=k.toBounds(this.drawingObject.shape.points),this.commandHandler.updateNodeDimension(this.drawingObject,t)),!0},$o.prototype.mouseUp=function(t,e){this.checkPropertyValue(),Qo.prototype.mouseMove.call(this,t),this.inAction&&(this.inAction=!1,this.commandHandler.addObjectToDiagram(this.drawingObject),this.triggerElementDrawEvent(this.drawingObject,"Completed","Node",this.getShapeType(),!1)),this.endAction()},$o.prototype.mouseWheel=function(t){Qo.prototype.mouseWheel.call(this,t),this.mouseMove(t)},$o.prototype.endAction=function(){this.inAction=!1,this.drawingObject=null};var Qo,Jo=$o;function $o(t){return Qo.call(this,t,!0)||this}i(ia,ta=en),ia.prototype.mouseMove=function(t){return ta.prototype.mouseMove.call(this,t),this.inAction&&((t=this.drawingObject).targetPoint=this.currentPosition,this.triggerElementDrawEvent(this.drawingObject,"Progress","Connector",this.commandHandler.diagram.drawingObject.type,!1),this.commandHandler.updateConnectorPoints(t)),!0},ia.prototype.mouseDown=function(t){var e,i;ta.prototype.mouseDown.call(this,t),this.inAction=!0,this.drawingObject?(i=this.drawingObject,(e=new Wa(i,"segments",{type:"Straight"},!(e=void 0))).point=this.currentPosition,i.segments[i.segments.length-1]=e):(i={id:"Connector",type:"Straight",sourcePoint:this.currentPosition,targetPoint:this.currentPosition},this.triggerElementDrawEvent(t.source,"Start","Connector",this.commandHandler.diagram.drawingObject.type,!0),this.inAction&&(this.drawingObject=this.commandHandler.drawObject(i)))},ia.prototype.mouseWheel=function(t){ta.prototype.mouseWheel.call(this,t),this.mouseMove(t)},ia.prototype.mouseUp=function(t){this.checkPropertyValue(),ta.prototype.mouseMove.call(this,t),this.inAction&&this.drawingObject&&((t=this.drawingObject).segments[t.segments.length-1].point={x:0,y:0},this.commandHandler.addObjectToDiagram(this.drawingObject),this.triggerElementDrawEvent(this.drawingObject,"Completed","Connector",this.commandHandler.diagram.drawingObject.type,!1)),this.endAction()},ia.prototype.endAction=function(){this.drawingObject=null,this.inAction=!1};var ta,ea=ia;function ia(t){return ta.call(this,t,!0)||this}i(oa,na=en),oa.prototype.mouseDown=function(t){this.inAction=!0,this.undoElement=Q(t.source),this.annotationId=t.sourceWrapper.id,na.prototype.mouseDown.call(this,t)},oa.prototype.mouseMove=function(t){na.prototype.mouseMove.call(this,t);var e,i=this.currentPosition.x-this.prevPosition.x,n=this.currentPosition.y-this.prevPosition.y,r=t.source;return r instanceof _&&(at(e=rt(),-r.rotateAngle,0,0),i=(r=z(e,{x:i,y:n})).x,n=r.y),this.inAction&&(this.commandHandler.labelDrag(t.source,t.sourceWrapper,i,n),this.commandHandler.updateSelector()),this.prevPosition=this.currentPosition,!this.blocked},oa.prototype.mouseUp=function(t){this.checkPropertyValue();var e=t.source,e=(this.inAction=!1,{type:"AnnotationPropertyChanged",objectId:this.annotationId,undoObject:Q(this.undoElement),category:"Internal",redoObject:Q(e)});this.commandHandler.addHistoryEntry(e),na.prototype.mouseUp.call(this,t)},oa.prototype.mouseLeave=function(t){this.mouseUp(t)};var na,ra=oa;function oa(t){return na.call(this,t,!0)||this}i(ha,aa=en),ha.prototype.mouseDown=function(t){this.inAction=!0;var e=(t.source.nodes.length?t.source.nodes:t.source.connectors)[0],e=(this.annotationId=t.source.wrapper.children[0].id,this.undoElement=Q(e),t.source.wrapper.children[0]);this.initialBounds={x:e.offsetX,y:e.offsetY,width:e.actualSize.width,height:e.actualSize.height},aa.prototype.mouseDown.call(this,t)},ha.prototype.mouseMove=function(t){return aa.prototype.mouseMove.call(this,t),this.inAction&&this.resizeObject(t),!this.blocked},ha.prototype.mouseUp=function(t){this.checkPropertyValue();var e=(t.source.nodes.length?t.source.nodes:t.source.connectors)[0],e=(this.inAction=!1,{type:"AnnotationPropertyChanged",objectId:this.annotationId,redoObject:Q(e),undoObject:Q(this.undoElement),category:"Internal"});this.commandHandler.addHistoryEntry(e),aa.prototype.mouseUp.call(this,t)},ha.prototype.mouseLeave=function(t){this.mouseUp(t)},ha.prototype.resizeObject=function(t){var e=(t.source.nodes.length?t.source.nodes:t.source.connectors)[0],i=t.source.wrapper.children[0],n={x:i.offsetX,y:i.offsetY},r=i.rotateAngle,o=(r=((r+=e instanceof _?e.rotateAngle:0)+360)%360,rt()),n=(at(o,r,n.x,n.y),this.corner.slice(5)),r=this.updateSize(i,this.startPosition,this.currentPosition,n,this.initialBounds,r),a=i.offsetX-i.actualSize.width*i.pivot.x,s=i.offsetY-i.actualSize.height*i.pivot.y,n=this.getPivot(n),o=z(o,{x:a+i.actualSize.width*n.x,y:s+i.actualSize.height*n.y});r.x=o.x,r.y=o.y,a=r.width,s=r.height,this.commandHandler.labelResize(e,t.source.annotation,a<0?1:a,s<0?1:s,r,t.source),this.commandHandler.updateSelector()};var aa,sa=ha;function ha(t,e){t=aa.call(this,t,!0)||this;return t.corner=e,t}i(ca,da=en),ca.prototype.mouseDown=function(t){this.inAction=!0,this.annotationId=t.source.wrapper.children[0].id;var e=(t.source.nodes.length?t.source.nodes:t.source.connectors)[0];this.undoElement=Q(e),da.prototype.mouseDown.call(this,t)},ca.prototype.mouseMove=function(t){var e,i;return da.prototype.mouseMove.call(this,t),t.source&&this.inAction&&(e=t.source.nodes[0]||t.source.connectors[0],i=void 0,i=t.source.annotation,this.commandHandler.labelRotate(e,i,this.currentPosition,t.source),this.commandHandler.updateSelector()),this.prevPosition=this.currentPosition,!this.blocked},ca.prototype.mouseUp=function(t){this.checkPropertyValue(),this.inAction=!1;var e=(t.source.nodes.length?t.source.nodes:t.source.connectors)[0],e={type:"AnnotationPropertyChanged",objectId:this.annotationId,redoObject:Q(e),undoObject:Q(this.undoElement),category:"Internal"};this.commandHandler.addHistoryEntry(e),da.prototype.mouseUp.call(this,t)},ca.prototype.mouseLeave=function(t){this.mouseUp(t)};var da,la=ca;function ca(t){return da.call(this,t,!0)||this}i(ua,pa=en),ua.prototype.mouseMove=function(t){var e,i;return pa.prototype.mouseMove.call(this,t),this.inAction&&(e=this.drawingObject.shape,i=this.currentPosition,e.points.push(i),this.drawingObject.wrapper.children[0].data=R(this.drawingObject.shape.points),e.data=R(e.points),this.triggerElementDrawEvent(t.source,"Progress","Connector",this.drawingObject.type,!1),this.inAction)&&!1===K.equals(this.currentPosition,this.prevPosition)&&(i=k.toBounds(this.drawingObject.shape.points),this.commandHandler.updateNodeDimension(this.drawingObject,i)),!0},ua.prototype.mouseDown=function(t){pa.prototype.mouseDown.call(this,t),this.inAction=!0,this.startPoint={x:this.startPosition.x,y:this.startPosition.y};var e={offsetX:this.currentPosition.x,offsetY:this.currentPosition.y,width:5,height:5,style:{strokeColor:"black",strokeWidth:1,fill:"transparent"},shape:{type:"Path",points:[{x:this.startPoint.x,y:this.startPoint.y},{x:this.currentPosition.x,y:this.currentPosition.y}]}};this.triggerElementDrawEvent(t.source,"Start","Connector",this.commandHandler.diagram.drawingObject.type,!0),this.drawingObject=this.commandHandler.drawObject(e)},ua.prototype.mouseUp=function(t){this.checkPropertyValue();var e,i,n;this.inAction&&(this.inAction=!1,i=(e=this.drawingObject.shape).points,this.commandHandler.addObjectToDiagram(this.drawingObject),n=this.drawingObject.id,n=this.commandHandler.diagram.nameTable[""+n],this.commandHandler.diagram.remove(n),i=this.pointReduction(i,10),n={},void 0===(n=this.commandHandler.diagram.drawingObject.bezierSettings?this.commandHandler.diagram.drawingObject.bezierSettings:n).allowSegmentsReset&&(n.allowSegmentsReset=!1),n={id:"newConnector"+q(),type:"Bezier",sourcePoint:{x:i[0].x,y:i[0].y},targetPoint:{x:i[i.length-1].x,y:i[i.length-1].y},segments:[],bezierSettings:n},this.drawingObject=this.commandHandler.drawObject(n),this.drawingObject=this.bezierCurveSmoothness(i,.5,this.drawingObject,e),this.commandHandler.updateConnectorPoints(this.drawingObject),this.commandHandler.addObjectToDiagram(this.drawingObject),this.triggerElementDrawEvent(this.drawingObject,"Completed","Connector",this.commandHandler.diagram.drawingObject.type,!1),pa.prototype.mouseUp.call(this,t))},ua.prototype.pointReduction=function(e,t){if(null===e||e.length<3)return e;var i=e.length-1,n=[];for(n.push(0),n.push(i);e[parseInt(0..toString(),10)]===e[parseInt(i.toString(),10)];)i--;this.reduction(e,0,i,t,n);var r=[];return n.sort(function(t,e){return t-e}),n.forEach(function(t){r.push(e[parseInt(t.toString(),10)])}),r},ua.prototype.reduction=function(t,e,i,n,r){for(var o=0,a=0,s=e;s<i;s++){var h=this.perpendicularDistance(t[parseInt(e.toString(),10)],t[parseInt(i.toString(),10)],t[parseInt(s.toString(),10)]);o<h&&(o=h,a=s)}n<o&&0!==a&&(r.push(a),this.reduction(t,e,a,n,r),this.reduction(t,a,i,n,r))},ua.prototype.perpendicularDistance=function(t,e,i){return Math.abs(.5*(t.x*e.y-e.x*t.y+(e.x*i.y-i.x*e.y)+(i.x*t.y-t.x*i.y)))/Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))*2},ua.prototype.bezierCurveSmoothness=function(t,e,i,n){if(!(t.length<3))for(var r=0;r<t.length-1;r++){var o=t[parseInt(r.toString(),10)].x,a=t[parseInt(r.toString(),10)].y,s=t[r+1].x,h=t[r+1].y,d=void 0,l=void 0,c=(l=(0===r?(d=(c=t[parseInt(r.toString(),10)]).x,c):(d=t[r-1].x,t[r-1])).y,void 0),p=void 0,g=(p=(r===t.length-2?(c=(g=t[r+1]).x,g):(c=t[r+2].x,t[r+2])).y,(d+o)/2),u=(l+a)/2,m=(o+s)/2,f=(a+h)/2,y=(s+c)/2,v=(h+p)/2,b={},S={},w={},x={},d=(b.x=d,b.y=l,S.x=o,S.y=a,w.x=s,w.y=h,x.x=c,x.y=p,K.findLength(b,S)),l=K.findLength(S,w),p=d/(d+l),b=l/(l+K.findLength(w,x)),S=g+(m-g)*p,d=u+(f-u)*p,l=m+(y-m)*b,w=f+(v-f)*b,x=S+(m-S)*e+o-S,u=d+(f-d)*e+a-d,p=l+(m-l)*e+s-l,y=w+(f-w)*e+h-w,v=new Xa(n,"segments",{type:"Bezier"},!0),b={x:x,y:u},S={x:p,y:y},d={x:o,y:a},m={x:s,y:h};v.type="Bezier",i.segments[parseInt(r.toString(),10)]=v,0===r&&(b={x:o,y:a}),r===t.length-2&&(S={x:s,y:h}),i.segments[parseInt(r.toString(),10)].vector1={angle:M(d,b),distance:K.findLength(d,b)},i.segments[parseInt(r.toString(),10)].vector2={angle:M(m,S),distance:K.findLength(m,S)},i.segments[parseInt(r.toString(),10)].point=m}return i};var pa,ga=ua;function ua(t){return pa.call(this,t,!0)||this}function ma(t){if(t)switch(t.type){case"Bpmn":return ka;case"UmlActivity":return Ea;case"UmlClassifier":return ds;default:return Da}return Da}function fa(t){if(t)switch(t.type){case"Straight":return Wa;case"Bezier":return Xa;case"Orthogonal":return Ua;default:return Wa}}ya=function(t,e){return(ya=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)};var ya,va,i=function(t,e){function i(){this.constructor=t}ya(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},n=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;0<=s;s--)(r=t[s])&&(a=(o<3?r(a):3<o?r(e,i,a):r(e,i))||a);return 3<o&&a&&Object.defineProperty(e,i,a),a},ba=(va=N.ChildProperty,i(Sa,va),n([N.Property(10)],Sa.prototype,"width",void 0),n([N.Property(10)],Sa.prototype,"height",void 0),n([N.Property("Arrow")],Sa.prototype,"shape",void 0),n([N.Complex({fill:"black",strokeColor:"black",strokeWidth:1},Nt)],Sa.prototype,"style",void 0),n([N.Complex({x:0,y:.5},K)],Sa.prototype,"pivot",void 0),n([N.Property("")],Sa.prototype,"pathData",void 0),Sa);function Sa(){return null!==va&&va.apply(this,arguments)||this}wa=N.ChildProperty,i(Ia,wa),n([N.Property(0)],Ia.prototype,"angle",void 0),n([N.Property(0)],Ia.prototype,"distance",void 0);var wa,xa=Ia;function Ia(){return null!==wa&&wa.apply(this,arguments)||this}Ca=N.ChildProperty,i(Aa,Ca),n([N.Property(Z.ControlPointsVisibility.All)],Aa.prototype,"controlPointsVisibility",void 0),n([N.Property("FreeForm")],Aa.prototype,"segmentEditOrientation",void 0),n([N.Property(Z.BezierSmoothness.Default)],Aa.prototype,"smoothness",void 0),n([N.Property(!0)],Aa.prototype,"allowSegmentsReset",void 0);var Ca,Pa=Aa;function Aa(){return null!==Ca&&Ca.apply(this,arguments)||this}Ta=N.ChildProperty,i(Oa,Ta),n([N.Property("None")],Oa.prototype,"type",void 0);var Ta,Da=Oa;function Oa(){return null!==Ta&&Ta.apply(this,arguments)||this}i(La,Ma=Da),n([N.Property("Object")],La.prototype,"flow",void 0),n([N.Property(30)],La.prototype,"exceptionFlowHeight",void 0);var Ma,Ea=La;function La(){return null!==Ma&&Ma.apply(this,arguments)||this}i(Ba,za=Da),n([N.Property("Sequence")],Ba.prototype,"flow",void 0),n([N.Property("Normal")],Ba.prototype,"sequence",void 0),n([N.Property("Default")],Ba.prototype,"message",void 0),n([N.Property("Default")],Ba.prototype,"association",void 0);var za,ka=Ba;function Ba(){return null!==za&&za.apply(this,arguments)||this}Ra=N.ChildProperty,i(ja,Ra),n([N.Property("Straight")],ja.prototype,"type",void 0),n([N.Property(!0)],ja.prototype,"allowDrag",void 0);var Ra,Na=ja;function ja(t,e,i,n){t=Ra.call(this,t,e,i,n)||this;return t.points=[],t}i(_a,Ha=Na),_a.prototype.getClassName=function(){return"StraightSegment"},n([N.Complex({x:0,y:0},K)],_a.prototype,"point",void 0);var Ha,Wa=_a;function _a(){return null!==Ha&&Ha.apply(this,arguments)||this}i(Va,Ya=Wa),Va.prototype.getClassName=function(){return"BezierSegment"},Va.prototype.getPoints=function(t,e){var i=[];return(0<i.length||null!=e)&&(e=0<i.length?i[i.length-1]:e,e=this.bezireToPoly(e,t),i.push.apply(i,e)),i},Va.prototype.bezireToPoly=function(t,e){var i,n,r=[];return e&&(i=e.bezierPoint1,n=e.bezierPoint2,e={x:e.points[1].x,y:e.points[1].y},this.flattenCubicBezier(r,t,i,n,e,10)),r},Va.prototype.flattenCubicBezier=function(t,e,i,n,r,o){for(var a=(K.findLength(e,i)+K.findLength(i,n)+K.findLength(n,r))/o,s=0;s<=a;s++){var h=s/a,d=(1-h)*(1-h)*(1-h)*e.x+3*h*(1-h)*(1-h)*i.x+3*h*h*(1-h)*n.x+h*h*h*r.x,h=(1-h)*(1-h)*(1-h)*e.y+3*h*(1-h)*(1-h)*i.y+3*h*h*(1-h)*n.y+h*h*h*r.y;t.push({x:d,y:h})}},n([N.Property("Horizontal")],Va.prototype,"orientation",void 0),n([N.Complex({x:0,y:0},K)],Va.prototype,"point1",void 0),n([N.Complex({x:0,y:0},K)],Va.prototype,"point2",void 0),n([N.Complex({angle:0,distance:0},xa)],Va.prototype,"vector1",void 0),n([N.Complex({angle:0,distance:0},xa)],Va.prototype,"vector2",void 0);var Ya,Xa=Va;function Va(){return null!==Ya&&Ya.apply(this,arguments)||this}i(Ga,Fa=Na),Ga.prototype.getClassName=function(){return"OrthogonalSegment"},n([N.Property(null)],Ga.prototype,"length",void 0),n([N.Property(null)],Ga.prototype,"direction",void 0);var Fa,Ua=Ga;function Ga(){return null!==Fa&&Fa.apply(this,arguments)||this}Za=N.ChildProperty,i(qa,Za),qa.prototype.getClassName=function(){return"DiagramConnectorSegment"},n([N.Property("Straight")],qa.prototype,"type",void 0),n([N.Property(!0)],qa.prototype,"allowDrag",void 0),n([N.Complex({x:0,y:0},K)],qa.prototype,"point",void 0),n([N.Complex({x:0,y:0},K)],qa.prototype,"point1",void 0),n([N.Complex({x:0,y:0},K)],qa.prototype,"point2",void 0),n([N.Complex({angle:0,distance:0},xa)],qa.prototype,"vector1",void 0),n([N.Complex({angle:0,distance:0},xa)],qa.prototype,"vector2",void 0),n([N.Property(null)],qa.prototype,"length",void 0),n([N.Property(null)],qa.prototype,"direction",void 0);var Za,Ka=qa;function qa(){return null!==Za&&Za.apply(this,arguments)||this}function Qa(t,e,i){var n=t.center,i=i?45:180/(2+2/(t.height/t.width)),t=i,r=180-i,o=r+2*i,i=360-i,e=M(e,n);return t<e&&e<r?"top":r<e&&e<o?"right":o<e&&e<i?"bottom":"left"}function Ja(t){return!t.distance&&!t.angle}function $a(t,e,i){var n=60,r={x:0,y:0};switch(i=i||(Math.abs(e.x-t.x)>Math.abs(e.y-t.y)?t.x<e.x?"right":"left":t.y<e.y?"bottom":"top")){case"bottom":case"top":n=Math.min(.45*Math.abs(t.y-e.y),n),r={x:t.x,y:t.y+("bottom"===i?n:-n)};break;case"right":case"left":n=Math.min(.45*Math.abs(t.x-e.x),n),r={x:t.x+("right"===i?n:-n),y:t.y}}return r}function ts(t,e,i,n,r){var o=0,a=0,s=0,h=0,d=Number((r.distance(e,t)+r.distance(i,e)+r.distance(n,i))/3);if(0!==d)for(var l=0;l<=d;l++){var c=l/d,p=(1-c)*(1-c)*(1-c)*t.x+3*c*(1-c)*(1-c)*e.x+3*c*c*(1-c)*i.x+c*c*c*n.x,c=(1-c)*(1-c)*(1-c)*t.y+3*c*(1-c)*(1-c)*e.y+3*c*c*(1-c)*i.y+c*c*c*n.y;0===l?(o=s=p,a=h=c):(o=Math.min(p,o),a=Math.min(c,a),s=Math.max(p,s),h=Math.max(c,h))}return{x:o,y:a,width:s-o,height:h-a,left:o,top:a,right:o+(s-o),bottom:a+(h-a),center:{x:(o+(s-o))/2,y:(a+(h-a))/2}}}function es(t,e,i,n,r,o,a){var s={x:0,y:0},o=o/a,a=(1-o)*(1-o)*(1-o)*e.x+3*o*(1-o)*(1-o)*i.x+3*o*o*(1-o)*n.x+o*o*o*r.x,a=(s.x=a,(1-o)*(1-o)*(1-o)*e.y+3*o*(1-o)*(1-o)*i.y+3*o*o*(1-o)*n.y+o*o*o*r.y);return s.y=a,s}is=N.ChildProperty,i(rs,is),n([N.Property(!0)],rs.prototype,"optional",void 0),n([N.Property(void 0)],rs.prototype,"lowerBounds",void 0),n([N.Property(void 0)],rs.prototype,"upperBounds",void 0);var is,ns=rs;function rs(){return null!==is&&is.apply(this,arguments)||this}os=N.ChildProperty,i(ss,os),n([N.Property("OneToOne")],ss.prototype,"type",void 0),n([N.Complex({},ns)],ss.prototype,"target",void 0),n([N.Complex({},ns)],ss.prototype,"source",void 0);var os,as=ss;function ss(){return null!==os&&os.apply(this,arguments)||this}i(ls,hs=Da),n([N.Property("UmlClassifier")],ls.prototype,"type",void 0),n([N.Property("Aggregation")],ls.prototype,"relationship",void 0),n([N.Property("Directional")],ls.prototype,"associationType",void 0),n([N.Complex({},as)],ls.prototype,"multiplicity",void 0);var hs,ds=ls;function ls(){return null!==hs&&hs.apply(this,arguments)||this}cs=N.ChildProperty,i(gs,cs),n([N.Property("None")],gs.prototype,"type",void 0),n([N.Property("Directional")],gs.prototype,"associationType",void 0),n([N.Property("Aggregation")],gs.prototype,"relationship",void 0),n([N.Complex({},as)],gs.prototype,"multiplicity",void 0),n([N.Property("Sequence")],gs.prototype,"bpmnFlow",void 0),n([N.Property("Default")],gs.prototype,"message",void 0),n([N.Property("Normal")],gs.prototype,"sequence",void 0),n([N.Property("Default")],gs.prototype,"association",void 0),n([N.Property("Object")],gs.prototype,"umlActivityFlow",void 0),n([N.Property(30)],gs.prototype,"exceptionFlowHeight",void 0);var cs,ps=gs;function gs(){return null!==cs&&cs.apply(this,arguments)||this}i(r,us=e),r.prototype.setPortID=function(t,e){if(this.targetID&&this.sourceID)for(var i,n=t.nameTable[this.targetID],t=t.nameTable[this.sourceID],r=e?n&&n.ports:t&&t.ports,o=0;r&&o<r.length;o++)i=r[parseInt(o.toString(),10)],this.targetPortID===i.id&&e?!(i.constraints&Z.PortConstraints.None)&&i.constraints&Z.PortConstraints.InConnect||(this.targetPortID=""):this.sourcePortID!==i.id||e||!(i.constraints&Z.PortConstraints.None)&&i.constraints&Z.PortConstraints.OutConnect||(this.sourcePortID="")},r.prototype.init=function(t){this.id||(this.id=q()),this.sourcePortID&&this.setPortID(t),this.targetPortID&&this.setPortID(t,!0);var e,i=new F,n=((o=new P).id=this.id+"_path",new P),r=new P,o=this.getSegmentElement(this,o),a="Bezier"===this.type?this.intermediatePoints:this.getConnectorPoints(this.type),s=(a=this.clipDecorators(this,a),k.toBounds(a));switch(i.width=s.width,i.height=s.height,i.offsetX=s.x+i.pivot.x*s.width,i.offsetY=s.y+i.pivot.y*s.height,this.shape.type){case"Bpmn":switch(this.shape.flow){case"Sequence":e=this.getBpmnSequenceFlow();break;case"Association":(e=new P).visible=!1,this.getBpmnAssociationFlow();break;case"Message":e=this.getBpmnMessageFlow(),o=this.getSegmentElement(this,o),this.updateShapePosition(this,e)}break;case"UmlActivity":switch(this.shape.flow){case"Object":this.getUMLObjectFlow();break;case"Exception":this.getUMLExceptionFlow(o)}break;case"UmlClassifier":this.getConnectorRelation()}var h,d,l=this.intermediatePoints,c=("Bezier"===this.type&&(h=this.segments[0],d=this.segments[this.segments.length-1],l=[K.isEmptyPoint(d.point2)?d.bezierPoint2:d.point2,K.isEmptyPoint(h.point1)?h.bezierPoint1:h.point1]),t.getDescription),n=this.getDecoratorElement(a[0],l[1],this.sourceDecorator,!0,c),r=this.getDecoratorElement(a[a.length-1],l[l.length-2],this.targetDecorator,!1,c);n.id=this.id+"_srcDec",r.id=this.id+"_tarDec",o.style=this.style,o.style.fill="transparent",void 0!==c&&(d=c(this,t),o.description=d||this.id),i.style.strokeColor="transparent",i.style.fill="transparent",i.style.strokeWidth=0,i.children=[o,n,r],i.id=this.id,void 0!==e&&i.children.push(e),i.offsetX=o.offsetX,i.offsetY=o.offsetY,i.width=o.width,i.height=o.height;for(var p=0;this.annotations,p<this.annotations.length;p++)i.children.push(this.getAnnotationElement(this.annotations[parseInt(p.toString(),10)],this.intermediatePoints,s,c,t.element.id,t.annotationTemplate));for(p=0;this.fixedUserHandles,p<this.fixedUserHandles.length;p++)i.children.push(this.getFixedUserHandle(this.fixedUserHandles[parseInt(p.toString(),10)],this.intermediatePoints,s,t.fixedUserHandleTemplate,t.element.id));return this.initPorts(c,i,s),this.wrapper=i},r.prototype.initPorts=function(t,e,i){for(var n=0;this.ports,n<this.ports.length;n++)e.children.push(this.initPort(this.ports[parseInt(n.toString(),10)],this.intermediatePoints,i,t))},r.prototype.initPort=function(t,e,i,n){var r,o=new P,a=(o.height=t.height,o.width=t.width,o.margin=t.margin,t.shape=t.shape||"Square","Custom"===t.shape?t.pathData:$e(t.shape)),a=(o.data=a,o.horizontalAlignment=t.horizontalAlignment,o.verticalAlignment=t.verticalAlignment,o=this.initPortWrapper(t,e,i,o,this),Dp(n));return a&&(r=a(o,this)),o.description=r||o.id,o.elementActions=o.elementActions|Z.ElementAction.ElementIsPort,o.isPathPort=!0,o},r.prototype.initPortWrapper=function(t,e,i,n,r){t.id=t.id||q();var o={x:0,y:0},a=bh(e,t),s=a.point,h=(n.id=this.id+"_"+t.id,t.style);n.style={fill:h.fill,strokeColor:h.strokeColor,gradient:null,opacity:h.opacity,strokeDashArray:h.strokeDashArray,strokeWidth:h.strokeWidth},0===i.width&&(i.width=this.style.strokeWidth),0===i.height&&(i.height=this.style.strokeWidth);var d,l,h=(s.x-i.x)/i.width,s=(s.y-i.y)/i.height,h=(o.x=i.width*h,o.y=i.height*s,Ch(t,a.angle,e)),i=h.hAlign,s=h.vAlign;return"left"===i?(d="Left",o.x+=t.displacement.x):"right"===i?(d="Right",o.x-=t.displacement.x):"center"===i&&(d="Center"),"top"===s?(l="Top",o.y+=t.displacement.y):"bottom"===s?(l="Bottom",o.y-=t.displacement.y):"center"===s&&(l="Center"),n.horizontalAlignment=d,n.verticalAlignment=l,(n=r&&"Label"!==r.flipMode&&"None"!==r.flipMode?pd(n,this.flip,t):pd(n,"None",t)).float=!0,n.connectionDirection=t.connectionDirection,n.setOffsetWithRespectToBounds(o.x,o.y,"Absolute"),n.relativeMode="Point",n.visible=!(!Zh(t,Z.PortVisibility.Visible)||Zh(t,Z.PortVisibility.Hover)||Zh(t,Z.PortVisibility.Connect)),n.elementActions=n.elementActions|Z.ElementAction.ElementIsPort,n},r.prototype.getConnectorRelation=function(){var t=this.shape,e=("Association"===t.relationship?(this.segments[0].type="Straight",this.sourceDecorator.shape="None",this.targetDecorator.shape="Arrow"):"Inheritance"===t.relationship?(this.segments[0].type="Orthogonal",this.sourceDecorator.shape="None",this.targetDecorator.shape="Arrow"):"Composition"===t.relationship||"Aggregation"===t.relationship?(this.segments[0].type="Orthogonal",this.sourceDecorator.shape="Diamond",this.targetDecorator.shape="None"):"Dependency"===t.relationship?(this.segments[0].type="Orthogonal",this.sourceDecorator.shape="None",this.targetDecorator.shape="OpenArrow"):"Realization"===t.relationship&&(this.segments[0].type="Orthogonal",this.sourceDecorator.shape="None",this.targetDecorator.shape="Arrow"),"BiDirectional"===t.associationType&&(this.sourceDecorator.shape="None",this.targetDecorator.shape="None"),""),i="",n=(t.multiplicity.source&&(t.multiplicity.source.lowerBounds=t.multiplicity.source.lowerBounds,t.multiplicity.source.upperBounds=t.multiplicity.source.upperBounds),t.multiplicity.target&&(t.multiplicity.target.lowerBounds=t.multiplicity.target.lowerBounds,t.multiplicity.target.upperBounds=t.multiplicity.target.upperBounds),t.multiplicity.source),r=t.multiplicity.target,n=n.upperBounds?n.lowerBounds+"..."+n.upperBounds:n.lowerBounds,r=r.upperBounds?r.lowerBounds+"..."+r.upperBounds:r.lowerBounds;"ManyToOne"===t.multiplicity.type&&(t.multiplicity.target.optional=!1,e=n||"*",i="1"),"OneToMany"===t.multiplicity.type&&(t.multiplicity.source.optional=!1,i=r||"*",e="1"),"ManyToMany"===t.multiplicity.type&&(e=n||"*",i=r||"*"),"OneToOne"===t.multiplicity.type&&(t.multiplicity.target.optional=!1,t.multiplicity.source.optional=!1,i=e="1"),this.annotations=[{id:this.id+"sourcelabel",content:e,offset:0,alignment:"Before",margin:{right:5,bottom:5}},{id:this.id+"targetlabel",content:i,offset:1,alignment:"Before",margin:{right:5,bottom:5}}]},r.prototype.getBpmnSequenceFlow=function(){var t=new P,e=new P;return"Normal"===this.shape.sequence&&"Bezier"!==this.type&&(this.targetDecorator.shape="Arrow"),"Default"===this.shape.sequence&&(t=this.getSegmentElement(this,t),t=this.intermediatePoints,e=gd(t,this),this.targetDecorator.shape="Arrow"),"Conditional"===this.shape.sequence&&(this.targetDecorator.shape="Arrow",this.sourceDecorator.shape="Diamond",e.id=this.id+this.shape.type),e},r.prototype.getUMLObjectFlow=function(){if(this.annotations)for(var t=0;t<this.annotations.length;t++)this.annotations[parseInt(t.toString(),10)].content="["+this.annotations[parseInt(t.toString(),10)].content+"]"},r.prototype.getUMLExceptionFlow=function(t){this.type="Straight";var e=this.shape.exceptionFlowHeight/2,i={x:(this.targetPoint.x+this.sourcePoint.x)/2,y:(this.targetPoint.y+this.sourcePoint.y)/2},n=i.x-this.sourcePoint.x,r=i.y-this.sourcePoint.y,e=e/Math.sqrt(n*n+r*r),o={x:i.x-n*e,y:i.y-r*e},n={x:i.x+n*e,y:i.y+r*e},r=rt(),e=(at(r,315,i.x,i.y),this.segments=[],new Wa(this,"segments",{type:"Straight",point:z(r,n)},!0));this.segments.push(e),e=new Wa(this,"segments",{type:"Straight",point:z(r,o)},!0),this.segments.push(e),this.getSegmentElement(this,t)},r.prototype.getBpmnAssociationFlow=function(){"Default"===this.shape.association&&(this.targetDecorator.shape="None",this.style.strokeDashArray="2 2"),"Directional"===this.shape.association&&(this.targetDecorator.shape="OpenArrow",this.style.strokeDashArray="2 2"),"BiDirectional"===this.shape.association&&(this.targetDecorator.shape="OpenArrow",this.sourceDecorator.shape="OpenArrow",this.style.strokeDashArray="2 2")},r.prototype.getFixedUserHandle=function(t,e,i,n,r){var o;return""===t.pathData&&n?((o=new an(this.id,r,void 0,n)).isTemplate=!0,o.template=op(o,!0,t),t.id=t.id||q(),o.id=this.id+"_"+t.id):((o=new F).children=[],t.id=t.id||q(),o.id=this.id+"_"+t.id,r=fh(t,o),o.children.push(r)),o.float=!0,o.visible=t.visibility,o.width=t.width,o.height=t.height,o.style.strokeWidth=t.handleStrokeWidth,o.style.fill=t.fill,o.style.strokeColor=t.handleStrokeColor,o.cornerRadius=t.cornerRadius,this.updateAnnotation(t,e,i,o),o.description=o.id,o},r.prototype.getBpmnMessageFlow=function(){var t=new P;return this.targetDecorator.shape="Arrow",this.targetDecorator.width=10,this.targetDecorator.height=10,this.sourceDecorator.shape="Circle",this.sourceDecorator.style.fill="white",this.targetDecorator.style.fill="white","InitiatingMessage"!==this.shape.message&&"NonInitiatingMessage"!==this.shape.message||(t.id=this.id+"_"+this.shape.message,t.width=25,t.height=15,t.data="M0,0 L19.8,12.8 L40,0 L0, 0 L0, 25.5 L40, 25.5 L 40, 0",t.horizontalAlignment="Center",t.verticalAlignment="Center",t.transform=Z.Transform.Self,t.style.fill="NonInitiatingMessage"===this.shape.message?"lightgrey":"white"),t},r.prototype.distance=function(t,e){return yd(t,e)},r.prototype.findPath=function(t,e){return fd(t,e)},r.prototype.getAnnotationElement=function(t,e,i,n,r,o){t.content=t.content||"",t.id=t.id||q(),r&&(t.template||"Template"===t.annotationType||o&&""===t.content)?(a=document.getElementById(r).ej2_instances[0],s=new an(this.id,r,t.id,o),t.template&&"function"==typeof t.template&&a.isReact&&(s.templateFn=N.compile(t.template),s.isTemplate=!0),void 0!==t.height||"String"!==t.annotationType||!t.template&&""!==t.content||(t.height=i.height),s=cp(s,t,o,a)):(s=new H,r=t.hyperlink.link?t.hyperlink:void 0,s.style=t.style,s.style.color=r?r.color||s.hyperlink.color:t.style.color,s.hyperlink.link=t.hyperlink.link||void 0,s.hyperlink.hyperlinkOpenState=t.hyperlink.hyperlinkOpenState||void 0,s.hyperlink.textDecoration=t.hyperlink.textDecoration||void 0,s.content=r?r.content||s.hyperlink.link:t.content),s.constraints=t.constraints,s.visible=t.visibility,s.annotationVisibility=s.visible?"Visible":"Collapsed",s.rotateAngle=t.rotateAngle,s.horizontalAlignment=t.horizontalAlignment,s.verticalAlignment=t.verticalAlignment,s.width=t.width,s.height=t.height,void 0===i.width||t.template||(s.width=(t.width||i.width)-t.margin.left-t.margin.right),s.margin=t.margin,s.id=this.id+"_"+t.id,0===i.width&&(i.width=this.style.strokeWidth),0===i.height&&(i.height=this.style.strokeWidth);var a,s,h,o=Dp(n);return o&&(h=o(t,this)),s.description=h||s.id,this.updateAnnotation(t,e,i,s),s},r.prototype.updateAnnotation=function(t,e,i,n,r){var o={x:0,y:0},r=(n instanceof H&&!r&&n.refreshTextElement(),n.width=t.width||i.width,vh(e,t)),a=r.point;t instanceof Qe&&t.segmentAngle&&(n.rotateAngle=t.rotateAngle+r.angle,n.rotateAngle=(n.rotateAngle+360)%360),0===i.width&&(i.width=this.style.strokeWidth),0===i.height&&(i.height=this.style.strokeWidth);var s,h,d=(a.x-i.x)/i.width,a=(a.y-i.y)/i.height,d=(o.x=i.width*d,o.y=i.height*a,Ch(t,r.angle,e)),i=d.hAlign,a=d.vAlign;"left"===i?(s="Left",o.x+=t.displacement.x):"right"===i?(s="Right",o.x-=t.displacement.x):"center"===i&&(s="Center"),"top"===a?(h="Top",o.y+=t.displacement.y):"bottom"===a?(h="Bottom",o.y-=t.displacement.y):"center"===a&&(h="Center"),n.horizontalAlignment=s,n.verticalAlignment=h,n.setOffsetWithRespectToBounds(o.x,o.y,"Absolute"),n.relativeMode="Point"},r.prototype.getConnectorPoints=function(t,e,i,n){i=li(this,i,n).slice(0);return i&&0<i.length&&(this.sourcePoint=i[0],this.targetPoint=i[i.length-1]),i},r.prototype.clipDecorator=function(t,e,i,n){var r={x:0,y:0},o=e.length,a=i?e[0]:e[o-1],e=i?e[1]:e[o-2],o=0===(o=K.distancePoints(a,e))?1:o,s=1,h=i?t.sourceWrapper:t.targetWrapper,h=(s=h&&(s=h.style.strokeWidth,n)&&n&Z.DiagramAction.DecoratorPropertyChange?1:s)-1;return r.x=Math.round(a.x+h*(e.x-a.x)/o),r.y=Math.round(a.y+h*(e.y-a.y)/o),r=i&&"None"!==t.sourceDecorator.shape||!i&&"None"!==t.targetDecorator.shape?K.adjustPoint(r,e,!0,n&Z.DiagramAction.DecoratorPropertyChange?0:s/2):r},r.prototype.clipDecorators=function(t,e,i){return"None"!==t.sourceDecorator.shape&&(e[0]=this.clipDecorator(t,e,!0,i)),"None"!==t.targetDecorator.shape&&(e[e.length-1]=this.clipDecorator(t,e,!1,i)),e},r.prototype.updateSegmentElement=function(t,e,i,n){var r=new k,n=this.getSegmentPath(t,e,n);if("Bezier"===t.type){if(0<this.segments.length)for(var o=0;o<this.segments.length;o++){var a=this.segments[parseInt(o.toString(),10)],s=t.segments[parseInt(o.toString(),10)],h=K.isEmptyPoint(a.point1)?s.bezierPoint1:s.point1,s=K.isEmptyPoint(a.point2)?s.bezierPoint2:s.point2;r.uniteRect(ts(a.points[0],h,s,a.points[1],t))}}else r=k.toBounds(e);return i.width=r.width,i.height=r.height,i.offsetX=r.x+i.width/2,i.offsetY=r.y+i.height/2,i.data=n,t.wrapper&&(t.wrapper.offsetX=i.offsetX,t.wrapper.offsetY=i.offsetY,t.wrapper.width=r.width,t.wrapper.height=r.height),i},r.prototype.getSegmentElement=function(t,e,i,n,r){return(r=void 0===r?!0:r)&&cd(t),r=this.getConnectorPoints(t.type,void 0,i),this.intermediatePoints=r,e.staticSize=!0,e=this.updateSegmentElement(t,r,e,n)},r.prototype.getDecoratorElement=function(t,e,i,n,r){var o=new P;return o.transform=Z.Transform.Self,this.updateDecoratorElement(o,t,e,i),void 0!==r&&(t=r(i,this),o.description=t||"source"),o},r.prototype.bridgePath=function(t,e,i){var n=e;if(0<t.bridges.length)if("Straight"===t.type&&t.segments.length<2)for(var r=0;r<t.bridges.length;r++)(o=t.bridges[parseInt(r.toString(),10)]).rendered||(n=(n+=" L"+o.startPoint.x+" "+o.startPoint.y)+o.path,o.rendered=!0);else if("Orthogonal"===t.type||"Straight"===t.type&&1<t.segments.length)for(var o,r=0;r<t.bridges.length;r++)(o=t.bridges[parseInt(r.toString(),10)]).segmentPointIndex!==i||o.rendered||o.segmentPointIndex===i&&(n=(n+=" L"+o.startPoint.x+" "+o.startPoint.y)+o.path,o.rendered=!0);return n},r.prototype.updateDecoratorElement=function(t,e,i,n){t.offsetX=e.x,t.offsetY=e.y;var e=K.findAngle(e,i),i=ti(n.shape,n),r=new j(n.width,n.height);t.pivot.x=n.pivot.x,t.pivot.y=n.pivot.y,t.style=n.style,t.rotateAngle=e,t.data=i,t.canMeasurePath=!0,t.width=r.width,t.height=r.height},r.prototype.getSegmentPath=function(t,e,i){for(var n,r,o,a="",s=[],h=0;h<e.length;)s.push({x:e[parseInt(h.toString(),10)].x,y:e[parseInt(h.toString(),10)].y}),h++;for(var d=0;d<t.bridges.length;d++)t.bridges[parseInt(d.toString(),10)].rendered=!1;if(s=this.clipDecorators(t,s,i),0<this.cornerRadius&&"Bezier"!==this.type)for(var l=0;l<s.length-1;l++){n=s[parseInt(l.toString(),10)],0===l&&(a="M"+n.x+" "+n.y);var c=K.distancePoints(s[parseInt(l.toString(),10)],s[l+1]);0<c&&(r=l<s.length-2?c<2*this.cornerRadius?K.adjustPoint(s[parseInt(l.toString(),10)],s[l+1],!1,c/2):K.adjustPoint(s[parseInt(l.toString(),10)],s[l+1],!1,this.cornerRadius):s[l+1],0<l&&(c<2*this.cornerRadius?(o=K.adjustPoint(s[parseInt(l.toString(),10)],s[l+1],!0,c/2),l<s.length-2&&(r=null)):o=K.adjustPoint(s[parseInt(l.toString(),10)],s[l+1],!0,this.cornerRadius)),o&&(a+="Q"+n.x+" "+n.y+" "+o.x+" "+o.y),r)&&(0<t.bridges.length&&(a=this.bridgePath(t,a,l),"Orthogonal"===t.type)&&(a=this.bridgePath(t,a,l+1)),a+=" L"+r.x+" "+r.y)}else if("Bezier"===this.type){for(var p,g=void 0,u=void 0,m=(this.parentObj.element&&(p=this.parentObj.element.ej2_instances[0].eventHandler.action,g=this.parentObj.element.ej2_instances[0].eventHandler.tool instanceof Eo,u=p.includes("PortDraw")||p.includes("Drag")),void 0),f=this.segments,y=0;y<f.length;y++)2<s.length&&(f[parseInt(y.toString(),10)].bezierPoint1={x:0,y:0},f[parseInt(y.toString(),10)].bezierPoint2={x:0,y:0}),!K.isEmptyPoint(f[parseInt(y.toString(),10)].point1)||f[parseInt(y.toString(),10)].vector1.angle||f[parseInt(y.toString(),10)].vector1.distance?f[parseInt(y.toString(),10)].vector1.angle||f[parseInt(y.toString(),10)].vector1.distance?f[parseInt(y.toString(),10)].bezierPoint1=K.transform(s[parseInt(y.toString(),10)],f[parseInt(y.toString(),10)].vector1.angle,f[parseInt(y.toString(),10)].vector1.distance):f[parseInt(y.toString(),10)].bezierPoint1={x:f[parseInt(y.toString(),10)].point1.x||f[parseInt(y.toString(),10)].bezierPoint1.x,y:f[parseInt(y.toString(),10)].point1.y||f[parseInt(y.toString(),10)].bezierPoint1.y}:(!t.sourceID&&!this.sourcePortID||!this.sourceWrapper||u||g||(m=Qa(this.sourceWrapper.bounds,s[parseInt(y.toString(),10)],!0)),f[parseInt(y.toString(),10)].bezierPoint1=$a(s[parseInt(y.toString(),10)],s[y+1],m)),!K.isEmptyPoint(f[parseInt(y.toString(),10)].point2)||f[parseInt(y.toString(),10)].vector2.angle||f[parseInt(y.toString(),10)].vector2.distance?f[parseInt(y.toString(),10)].vector2.angle||f[parseInt(y.toString(),10)].vector2.distance?f[parseInt(y.toString(),10)].bezierPoint2=K.transform(s[y+1],f[parseInt(y.toString(),10)].vector2.angle,f[parseInt(y.toString(),10)].vector2.distance):f[parseInt(y.toString(),10)].bezierPoint2={x:f[parseInt(y.toString(),10)].point2.x||f[parseInt(y.toString(),10)].bezierPoint2.x,y:f[parseInt(y.toString(),10)].point2.y||f[parseInt(y.toString(),10)].bezierPoint2.y}:(!t.targetID&&!this.targetPortID||!this.targetWrapper||u||g||(m=Qa(this.targetWrapper.bounds,s[y+1],!0)),f[parseInt(y.toString(),10)].bezierPoint2=$a(s[y+1],s[parseInt(y.toString(),10)],m));s.splice(1,0,{x:f[0].bezierPoint1.x,y:f[0].bezierPoint1.y}),s.splice(s.length-1,0,{x:f[f.length-1].bezierPoint2.x,y:f[f.length-1].bezierPoint2.y});for(var s=this.clipDecorators(t,s,i),v=0;v<f.length;v++){0===v&&(a="M"+s[0].x+" "+s[0].y);var b=v===f.length-1?s[s.length-1].x+" "+s[s.length-1].y:f[parseInt(v.toString(),10)].points[f[parseInt(v.toString(),10)].points.length-1].x+" "+f[parseInt(v.toString(),10)].points[f[parseInt(v.toString(),10)].points.length-1].y;a+="C"+f[parseInt(v.toString(),10)].bezierPoint1.x+" "+f[parseInt(v.toString(),10)].bezierPoint1.y+" "+f[parseInt(v.toString(),10)].bezierPoint2.x+" "+f[parseInt(v.toString(),10)].bezierPoint2.y+" "+b}}else for(var S=0;S<s.length;S++)n=s[parseInt(S.toString(),10)],0===S&&(a="M"+n.x+" "+n.y),0<S&&(a=this.bridgePath(t,a,S),a+=" L"+n.x+" "+n.y);return a},r.prototype.updateShapeElement=function(t){var e;switch(t.shape.type){case"Bpmn":t.wrapper.children[3]instanceof P&&(e=t.wrapper.children[3]),"Message"===t.shape.flow&&this.updateShapePosition(t,e);break;case"UmlActivity":"Exception"===t.shape.flow&&this.getUMLExceptionFlow(t.wrapper.children[0])}},r.prototype.updateShapePosition=function(t,e){var i=this.intermediatePoints,i=ud(i,e,.5);e.offsetX=i.x,e.offsetY=i.y},r.prototype.scale=function(t,e,i,n,r){var o,a,s=0,h=0,d=(this.wrapper&&this.wrapper.outerBounds&&(d=Fi(this),o=Math.abs((this.wrapper.bounds.width||this.style.strokeWidth||1)-2),a=Math.abs((this.wrapper.bounds.height||this.style.strokeWidth||1)-2),s=d.width-o,h=d.height-a,t=Math.abs((i-Math.max(s,h))/o),e=Math.abs((n-Math.max(s,h))/a),s=h=Math.min(s,h)),t=e=Math.min(t,e),rt()),i=(at(d,-(r=r||this.wrapper).rotateAngle,r.offsetX,r.offsetY),st(d,t,e,r.offsetX,r.offsetY),at(d,r.rotateAngle,r.offsetX,r.offsetY),ot(d,this.intermediatePoints));return this.sourcePoint=i[0],this.targetPoint=i[i.length-1],i=this.intermediatePoints=li(this),Xh(this,i),{x:s,y:h}},r.prototype.getClassName=function(){return"Connector"},n([N.ComplexFactory(ma)],r.prototype,"shape",void 0),n([N.Property(Z.ConnectorConstraints.Default)],r.prototype,"constraints",void 0),n([N.Property(10)],r.prototype,"bridgeSpace",void 0),n([N.Collection([],Qe)],r.prototype,"annotations",void 0),n([N.Complex({},K)],r.prototype,"sourcePoint",void 0),n([N.Complex({},K)],r.prototype,"targetPoint",void 0),n([N.Collection([],fn)],r.prototype,"fixedUserHandles",void 0),n([N.CollectionFactory(fa)],r.prototype,"segments",void 0),n([N.Property("")],r.prototype,"sourceID",void 0),n([N.Property("")],r.prototype,"targetID",void 0),n([N.Property(10)],r.prototype,"hitPadding",void 0),n([N.Property(0)],r.prototype,"connectionPadding",void 0),n([N.Property("Straight")],r.prototype,"type",void 0),n([N.Property("Circle")],r.prototype,"segmentThumbShape",void 0),n([N.Property(10)],r.prototype,"segmentThumbSize",void 0),n([N.Property(0)],r.prototype,"cornerRadius",void 0),n([N.Complex({shape:"None"},ba)],r.prototype,"sourceDecorator",void 0),n([N.Complex({shape:"Arrow"},ba)],r.prototype,"targetDecorator",void 0),n([N.Complex({},t)],r.prototype,"tooltip",void 0),n([N.Property("")],r.prototype,"sourcePortID",void 0),n([N.Property("")],r.prototype,"targetPortID",void 0),n([N.Property(0)],r.prototype,"sourcePadding",void 0),n([N.Complex({},Ki)],r.prototype,"previewSize",void 0),n([N.Complex({},Ki)],r.prototype,"dragSize",void 0),n([N.Property(0)],r.prototype,"targetPadding",void 0),n([N.Property(13)],r.prototype,"connectorSpacing",void 0),n([N.Complex({strokeWidth:1,strokeColor:"black"},Wt)],r.prototype,"style",void 0),n([N.Property(null)],r.prototype,"maxSegmentThumb",void 0),n([N.Property(!1)],r.prototype,"allowNodeOverlap",void 0),n([N.Complex({},Pa)],r.prototype,"bezierSettings",void 0),n([N.Collection([],je)],r.prototype,"ports",void 0),n([N.Property(null)],r.prototype,"wrapper",void 0);var us,W=r;function r(t,e,i,n){t=us.call(this,t,e,i,n)||this;return t.parentId="",t.bridges=[],t.status="None",t.outEdges=[],t.inEdges=[],t.shape&&"UmlActivity"===t.shape.type&&ih(i,t),i&&i.shape&&"None"!==i.shape.type&&nh(i,t),t}ms=function(t,e){return(ms=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)};var ms,fs,i=function(t,e){function i(){this.constructor=t}ms(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},n=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;0<=s;s--)(r=t[s])&&(a=(o<3?r(a):3<o?r(e,i,a):r(e,i))||a);return 3<o&&a&&Object.defineProperty(e,i,a),a},ys=(fs=N.Component,i(vs,fs),vs.prototype.preRender=function(){this.unWireEvents(),this.wireEvents()},vs.prototype.render=function(){this.updateRulerGeometry(),this.renderComplete()},vs.prototype.getModuleName=function(){return"Ruler"},vs.prototype.destroy=function(){this.unWireEvents(),this.notify("destroy",{}),fs.prototype.destroy.call(this),this.element.classList.remove("e-ruler")},vs.prototype.getPersistData=function(){return this.addOnPersist(["loaded"])},vs.prototype.onPropertyChanged=function(t,e){for(var i=0,n=Object.keys(t);i<n.length;i++)switch(n[i]){case"length":case"interval":case"segmentWidth":case"tickAlignment":case"markerColor":case"thickness":this.updateRuler()}},vs.prototype.updateRulerGeometry=function(){this.element.style.textAlign="left",this.renderRulerSpace(),this.updateRuler()},vs.prototype.renderRulerSpace=function(){var t=this.getRulerGeometry(),e=document.getElementById(this.element.id+"_ruler_space");return e||(e=A("div",{id:this.element.id+"_ruler_space",style:"height:"+t.height+"px;width:"+t.width+"px;cssFloat:left;"}),this.element.appendChild(e)),e},vs.prototype.updateRuler=function(){var t=this.getRulerSize(),e=this.getRulerGeometry(),i=0,n=new j,e=this.getRulerSVG(e);e&&(i=this.length,n.height=t,n=this.offset,i)&&i!==1/0&&(i=i+this.segmentWidth,this.updateSegments(n,i+Math.abs(n),e,t))},vs.prototype.updateSegments=function(t,e,i,n){for(var r=t,o={trans:0};r<e;){var a=this.getNewSegment(r,i);a&&(i.appendChild(a.segment),r=this.updateSegment(t,e,a,r,o,n))}},vs.prototype.updateSegment=function(t,e,i,n,r,o){var a=this.updateSegmentWidth(this.scale),t=(n===t?(this.startValue=Math.floor(t/a)*a/this.scale,this.startValue=this.startValue%1!=0?Number(this.startValue.toFixed(1)):this.startValue,i.label.textContent=this.startValue.toString(),this.defStartValue=n=this.startValue*this.scale,"Horizontal"===this.orientation?this.hRulerOffset=t-n:this.vRulerOffset=t-n):(this.startValue=n/this.scale,this.startValue=this.startValue%1!=0?Number(this.startValue.toFixed(1)):this.startValue,i.label.textContent=this.startValue.toString()),this.updateTickLabel(i,o),"Horizontal"===this.orientation?r.trans+.5+",0.5":"0.5,"+(r.trans+.5));return i.segment.setAttribute("transform","translate("+t+")"),r.trans+=a,n+=a},vs.prototype.updateTickLabel=function(t,e){var i=t.segment.lastChild.getBBox(),n="Horizontal"===this.orientation,r="RightOrBottom"===this.tickAlignment,o=n?2:0,a=n?r?e/2+5.5-5.5:e/2+5.5:i.height,r=r?-(i.width+2)+","+(e/2-i.height):-(i.width+2)+","+(e/2-i.height/2);ap(t.segment.lastChild,n?{x:o,y:a}:{x:o,y:a,transform:"rotate(270)translate("+r+")"})},vs.prototype.getNewSegment=function(t,e){t=this.createNewTicks(t,e);return{segment:t,label:this.createTickLabel(e,t)}},vs.prototype.createNewTicks=function(t,e){for(var i,n=this.updateSegmentWidth(this.scale),r=tp("g",{class:"e-ruler-segment"}),o=0;o<this.interval;o++)i=n/this.interval,i=this.createTick(e,i,o+1,t),r.appendChild(i);return r},vs.prototype.getLinePoint=function(t,e,i){var n=this.updateSegmentWidth(this.scale),r=this.getRulerSize();return i=(e*=i-1)%n==0?r:.3*r},vs.prototype.createTick=function(t,e,i,n){var t=this.getLinePoint(t,e,i),r=this.getRulerSize(),o="Horizontal"===this.orientation,a="RightOrBottom"===this.tickAlignment,s=Dp(this.arrangeTick),h={ruler:void 0,tickLength:t,tickInterval:this.segmentWidth/this.interval*(i-1)},s=(s&&s(h),t=h.tickLength,e*(i-1)),h=tp("line",{x1:o?s:a?r:0,y1:o?a?r:r-(r-t):s,x2:o?s:a?r-t:r-(r-t),y2:o?a?r-t:0:s,"stroke-width":"1",stroke:"black"});return h.setAttribute("class","e-ruler-tick"),h},vs.prototype.createTickLabel=function(t,e){var i;return e&&(i=tp("text",{class:"e-ruler-tick-label"}),e.appendChild(i)),i},vs.prototype.updateSegmentWidth=function(t){if(100!==this.segmentWidth)return this.segmentWidth;var e=1,i=100;for(i=100/Math.pow(2,Math.round(Math.log(t)/Math.log(2)));100<i;)e/=10,i/=10;for(;i<25;)e*=10,i*=10;return(i=25<=i&&i%25!=0?25*Math.round(i/25):i)*t/e},vs.prototype.createMarkerLine=function(t,e,i){var n;return e&&((n=t.getElementById(e.id+"_marker"))&&n.parentNode.removeChild(n),n=tp("line",i)),n},vs.prototype.drawRulerMarker=function(t,e,i){for(var n,r,o,a="Horizontal"===this.orientation,s=t.getElementsByTagName("svg"),h=0;h<s.length;h++){s[parseInt(h.toString(),10)]&&(n=s[parseInt(h.toString(),10)]);break}n&&(r=this.getRulerSize(),r={id:t.id+"_marker",x1:0,y1:0,x2:a?0:r,y2:a?r:0,stroke:this.markerColor,"stroke-width":1.5,class:"e-d-ruler-marker"},t=this.createMarkerLine(n,t,r),r=this.scale,o=this.offset-this.defStartValue,e=(a?e.x:e.y)*r+i+o,t.setAttribute("transform","translate("+(a?e+.5+" 0.5":"0.5 "+(e+.5))+")"),n.appendChild(t))},vs.prototype.getRulerGeometry=function(){return new j(this.element?this.element.getBoundingClientRect().width:0,this.element?this.element.getBoundingClientRect().height:0)},vs.prototype.getRulerSize=function(){return this.thickness},vs.prototype.getRulerSVG=function(t){var e,i=this.getRulerSize();if(this.element&&(e=document.getElementById(this.element.id+"_ruler_space"))){var n=tp("svg",{id:this.element.id+"_Ruler_svg",width:"Horizontal"===this.orientation?t.width+200:i+"px",height:"Horizontal"===this.orientation?i:t.height+200+"px",style:"position:inherit;"});if(0<e.childNodes.length)for(var r=e.childNodes.length-1;0<=r;r--)e.childNodes[parseInt(r.toString(),10)].parentNode.removeChild(e.childNodes[parseInt(r.toString(),10)]);e.appendChild(n)}return n},vs.prototype.wireEvents=function(){},vs.prototype.unWireEvents=function(){},n([N.Property(5)],vs.prototype,"interval",void 0),n([N.Property(100)],vs.prototype,"segmentWidth",void 0),n([N.Property("Horizontal")],vs.prototype,"orientation",void 0),n([N.Property("RightOrBottom")],vs.prototype,"tickAlignment",void 0),n([N.Property("red")],vs.prototype,"markerColor",void 0),n([N.Property(25)],vs.prototype,"thickness",void 0),n([N.Property(null)],vs.prototype,"arrangeTick",void 0),n([N.Property(400)],vs.prototype,"length",void 0),vs);function vs(t,e){t=fs.call(this,t,e)||this;return t.offset=0,t.scale=1,t}function bs(t,e){var i=document.getElementById(t.element.id+(e?"_hRuler":"_vRuler")),n=xs(t),r=Is(t),o=e?"margin-left:"+n.width+"px;":"margin-top:"+n.height+"px;",o=(i||(n="height:"+(e?n.height:r.height+100)+"px;overflow:hidden;width:"+(e?r.width+100:n.width)+"px;position:absolute;font-size:11px;"+o,i=A("div",{id:t.element.id+(e?"_hRuler":"_vRuler"),style:n})),t.element.insertBefore(i,t.element.firstChild),e?t.rulerSettings.horizontalRuler:t.rulerSettings.verticalRuler),n=new ys(o),i=(n.orientation=e?"Horizontal":"Vertical",n.length=(e?r.width:r.height)+o.segmentWidth,n.appendTo("#"+t.element.id+(e?"_hRuler":"_vRuler")),e?t.hRuler=n:t.vRuler=n,document.getElementById(t.element.id+(e?"_hRuler":"_vRuler")));e?t.hRuler.element=i:t.vRuler.element=i}function Ss(t){var e=-t.scroller.horizontalOffset,i=-t.scroller.verticalOffset;t&&t.rulerSettings.showRulers?(t.hRuler.length=0,t.vRuler.length=0,t.hRuler.element&&Cs(t,t.hRuler,e,!0),t.vRuler.element&&Cs(t,t.vRuler,i,!1)):ws(t)}function ws(t){rp(t.element.id+"_hRuler"),rp(t.element.id+"_vRuler"),rp(t.element.id+"_overlapRuler")}function xs(t){var e=0,i=0;return t.rulerSettings.showRulers&&(e=t.rulerSettings.horizontalRuler.thickness,i=t.rulerSettings.verticalRuler.thickness),new j(i,e)}function Is(t){var e=xs(t),i=t.scroller.viewPortHeight,n=t.scroller.viewPortWidth;return n<t.element.clientWidth-e.width&&(n=t.element.clientWidth-e.width),i<t.element.clientHeight-e.height&&(i=t.element.clientHeight-e.height),t.hRuler&&t.hRuler.length&&(n=t.hRuler.length),t.vRuler&&t.vRuler.length&&(i=t.vRuler.length),new j(n,i)}function Cs(t,e,i,n){var r,o,a,s,h=xs(t),d=Is(t),l=n?t.rulerSettings.horizontalRuler:t.rulerSettings.verticalRuler,c=(r=t,c=d,o=n,a=document.getElementById(r.element.id+(o?"_hRuler":"_vRuler")),s=o?r.hRuler:r.vRuler,a&&r&&c&&(a.style.width=(o?c.width+s.segmentWidth:s.thickness)+"px",a.style.height=(o?s.thickness:c.height+s.segmentWidth)+"px",a=document.getElementById(r.element.id+"_overlapRuler"))&&(o?a.style.height=s.thickness+"px":a.style.width=s.thickness+"px"),c=t,r=d,o=n,a=document.getElementById(c.element.id+(o?"_hRuler_ruler_space":"_vRuler_ruler_space")),s=o?c.hRuler:c.vRuler,a&&c&&r&&(a.style.width=(o?r.width+2*s.segmentWidth:s.thickness)+"px",a.style.height=(o?s.thickness:r.height+2*s.segmentWidth)+"px"),e.offset=i,e.scale=t.scroller.currentZoom,e.length=(n?d.width:d.height)+100,e.arrangeTick=Dp(l.arrangeTick),e.dataBind(),(n?t.hRuler:t.vRuler).element);n?c.style.marginLeft=h.width-e.hRulerOffset+"px":c.style.marginTop=h.height-e.vRulerOffset+"px"}Ps=function(t,e){return(Ps=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)};var Ps,As,i=function(t,e){function i(){this.constructor=t}Ps(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},n=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;0<=s;s--)(r=t[s])&&(a=(o<3?r(a):3<o?r(e,i,a):r(e,i))||a);return 3<o&&a&&Object.defineProperty(e,i,a),a},Ts=(As=N.ChildProperty,i(Ds,As),Ds.prototype.getClassName=function(){return"UserHandle"},n([N.Property("")],Ds.prototype,"name",void 0),n([N.Property("")],Ds.prototype,"pathData",void 0),n([N.Property("")],Ds.prototype,"content",void 0),n([N.Property("")],Ds.prototype,"source",void 0),n([N.Property("#000000")],Ds.prototype,"backgroundColor",void 0),n([N.Property("Top")],Ds.prototype,"side",void 0),n([N.Property("")],Ds.prototype,"borderColor",void 0),n([N.Property(.5)],Ds.prototype,"borderWidth",void 0),n([N.Property(25)],Ds.prototype,"size",void 0),n([N.Property("white")],Ds.prototype,"pathColor",void 0),n([N.Property(10)],Ds.prototype,"displacement",void 0),n([N.Property(!0)],Ds.prototype,"visible",void 0),n([N.Property(0)],Ds.prototype,"offset",void 0),n([N.Complex({},ft)],Ds.prototype,"margin",void 0),n([N.Property("Center")],Ds.prototype,"horizontalAlignment",void 0),n([N.Property("Center")],Ds.prototype,"verticalAlignment",void 0),n([N.Property(!1)],Ds.prototype,"disableNodes",void 0),n([N.Property(!1)],Ds.prototype,"disableConnectors",void 0),n([N.Complex({},t)],Ds.prototype,"tooltip",void 0),n([N.Property("")],Ds.prototype,"template",void 0),Ds);function Ds(){return null!==As&&As.apply(this,arguments)||this}function Os(t){return Ls[t.toString()]}var Ms,Es,Ls={Action:"M 90 82.895 C 90 86.819 86.776 90 82.8 90 H 7.2 C 3.224 90 0 86.819 0 82.895 V 7.105 C 0 3.181 3.224 0 7.2 0 h 75.6 C 86.776 0 90 3.181 90 7.105 V 82.895 Z",Decision:"M10,19.707L0.293,10L10,0.293L19.707,10L10,19.707z",MergeNode:"M10,19.707L0.293,10L10,0.293L19.707,10L10,19.707z",InitialNode:"M10,19.5c-5.238,0-9.5-4.262-9.5-9.5S4.762,0.5,10,0.5s9.5,4.262,9.5,9.5S15.238,19.5,10,19.5z",ForkNode:"m0.75,0.75l636.00002,0l0,290l-636.00002,0l0,-290z",JoinNode:"m0.75,0.75l636.00002,0l0,290l-636.00002,0l0,-290z",TimeEvent:"M50.001,0.00286865 L25.001,25.0029 L0.000976562,0.00286865 L50.001,0.00286865 z M0.000976562,50.0029 L25.001,25.0029 L50.001,50.0029 L0.000976562,50.0029 z",AcceptingEvent:"M17.8336 32.164 L29.64 24 L17.32 16 L48.1664 16 L48.5 32 Z",SendSignal:"M48.164 31.8336 L56 23.832 L47.836 16 L16.168 16 L16.1668 31.8336 Z",ReceiveSignal:"M48.1664 31.8336 L39.836 24 L47.836 16 L16.168 16 L16.168 31.836 Z",StructuredNode:"M0,0 L50,0 L50,50 L0,50 z",Note:"M20 12 L4 12 L4 22 L22 22 L22 14 L20 14 L20 12 L22 14 Z"},i=(Ms=function(t,e){return(Ms=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)},function(t,e){function i(){this.constructor=t}Ms(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;0<=s;s--)(r=t[s])&&(a=(o<3?r(a):3<o?r(e,i,a):r(e,i))||a);return 3<o&&a&&Object.defineProperty(e,i,a),a},zs=(Es=N.ChildProperty,i(ks,Es),n([N.Property()],ks.prototype,"key",void 0),n([N.Property()],ks.prototype,"keyModifiers",void 0),ks);function ks(){return null!==Es&&Es.apply(this,arguments)||this}Bs=N.ChildProperty,i(Ns,Bs),Ns.prototype.getClassName=function(){return"Command"},n([N.Property("")],Ns.prototype,"name",void 0),n([N.Property()],Ns.prototype,"canExecute",void 0),n([N.Property()],Ns.prototype,"execute",void 0),n([N.Complex({},zs)],Ns.prototype,"gesture",void 0),n([N.Property("")],Ns.prototype,"parameter",void 0);var Bs,Rs=Ns;function Ns(){return null!==Bs&&Bs.apply(this,arguments)||this}js=N.ChildProperty,i(Ws,js),n([N.Collection([],Rs)],Ws.prototype,"commands",void 0);var js,Hs=Ws;function Ws(){return null!==js&&js.apply(this,arguments)||this}_s=N.ChildProperty,i(Ys,_s),n([N.Property()],Ys.prototype,"show",void 0),n([N.Property()],Ys.prototype,"showCustomMenuOnly",void 0),n([N.Property()],Ys.prototype,"items",void 0);var _s,i=Ys;function Ys(){return null!==_s&&_s.apply(this,arguments)||this}Vs.prototype.renderShadow=function(t,e,i,n){void 0===i&&(i=null);var r,o=K.transform({x:0,y:0},t.shadow.angle,t.shadow.distance),o=((r=n?n.getElementById(e.id+"_shadow"):r)||(r=document.createElementNS("http://www.w3.org/2000/svg",i?"path":"rect"),e.appendChild(r)),{id:e.id+"_shadow",fill:t.shadow.color,stroke:t.shadow.color,opacity:t.shadow.opacity.toString(),transform:"rotate("+t.angle+","+(t.x+t.width*t.pivotX)+","+(t.y+t.height*t.pivotY)+")translate("+(t.x+o.x)+","+(t.y+o.y)+")"});n&&(n=n.getElementById(e.id))&&n.insertBefore(r,n.firstChild),ap(r,o),i?this.renderPath(r,t,i):ap(r,{width:t.width,height:t.height})},Vs.prototype.parseDashArray=function(t){return[]},Vs.prototype.drawRectangle=function(t,e,i,n,r,o,a,s,h){e.shadow&&!n&&this.renderShadow(e,t,void 0,o),n=e.id===t.id?e.id+"_container":e.id,(d=o?o.getElementById(n):d)&&!r||(d=document.createElementNS("http://www.w3.org/2000/svg","rect"),t.appendChild(d)),o&&!e.shadow&&(l=o.getElementById(e.id+"_groupElement_shadow"))&&l.parentNode.removeChild(l),o&&(l=o.getElementById(e.id+"_groupElement_shadow"))&&(l.style.visibility=e.visible?"visible":"hidden"),r=s?{id:n,x:e.x.toString(),y:e.y.toString(),width:e.width.toString(),height:e.height.toString(),visibility:e.visible?"visible":"hidden",transform:"rotate("+e.angle+","+(e.x+e.width/2)+","+(e.y+e.height/2)+")",rx:e.cornerRadius||0,ry:e.cornerRadius||0,opacity:e.opacity}:{id:n,x:e.x.toString(),y:e.y.toString(),width:e.width.toString(),height:e.height.toString(),visibility:e.visible?"visible":"hidden",transform:"rotate("+e.angle+","+(e.x+e.width*e.pivotX)+","+(e.y+e.height*e.pivotY)+")",rx:e.cornerRadius||0,ry:e.cornerRadius||0,opacity:e.opacity},a&&(r.role="img",r["aria-label"]=a);var d,l,t=e.class||"";h||(t.includes("e-diagram-resize-handle")||t.includes("e-diagram-endpoint-handle")||t.includes("e-diagram-bezier-control-handle"))&&(t+=" e-disabled"),e.class&&(r.class=t);a||(r["pointer-events"]="none"),ap(d,r),this.setSvgStyle(d,e,i)},Vs.prototype.updateSelectionRegion=function(t,e){var i=t.parentNode.getElementById(e.id),n={id:e.id,x:e.x.toString(),y:e.y.toString(),width:e.width.toString(),height:e.height.toString(),transform:"rotate("+e.angle+","+(e.x+e.width*e.pivotX)+","+(e.y+e.height*e.pivotY)+")",class:"e-diagram-selected-region"};i||(i=document.createElementNS("http://www.w3.org/2000/svg","rect"),t.appendChild(i)),this.setSvgStyle(i,e),ap(i,n)},Vs.prototype.createGElement=function(t,e){return tp(t,e)},Vs.prototype.drawLine=function(t,e){var i=document.createElementNS("http://www.w3.org/2000/svg","line"),n=(this.setSvgStyle(i,e),e.x+e.width*e.pivotX),r=e.y+e.height*e.pivotY,n={id:e.id,x1:e.startPoint.x+e.x,y1:e.startPoint.y+e.y,x2:e.endPoint.x+e.x,y2:e.endPoint.y+e.y,stroke:e.stroke,"stroke-width":e.strokeWidth.toString(),opacity:e.opacity.toString(),transform:"rotate("+e.angle+" "+n+" "+r+")",visibility:e.visible?"visible":"hidden"};e.class&&(n.class=e.class),ap(i,n),t.appendChild(i)},Vs.prototype.drawCircle=function(t,e,i,n){var r=document.createElementNS("http://www.w3.org/2000/svg","circle"),o=(this.setSvgStyle(r,e),e.class||""),i=(i||(o+=" e-disabled"),{id:e.id,cx:e.centerX,cy:e.centerY,r:e.radius,visibility:e.visible?"visible":"hidden",class:o});n&&(i.role="img",i["aria-label"]=n),r.style.display=e.visible?"block":"none",ap(r,i),t.appendChild(r)},Vs.prototype.drawPath=function(t,e,i,n,r,o,a){d=X(D(e.data)),e.shadow&&this.renderShadow(e,t,d,r),r&&!e.shadow&&(s=r.getElementById(e.id+"_groupElement_shadow"))&&s.parentNode.removeChild(s),r&&(s=r.getElementById(e.id+"_groupElement_shadow"))&&(s.style.visibility=e.visible?"visible":"hidden"),(h=r?r.getElementById(e.id):h)&&!n||(h=document.createElementNS("http://www.w3.org/2000/svg","path"),(t.parentElement&&"diagram_nativeLayer"===t.parentElement.id?((s=document.createElementNS("http://www.w3.org/2000/svg","g")).id=e.id+"_groupElement",t.appendChild(s),s):t).appendChild(h)),this.renderPath(h,e,d);var s,h,d,r={},r=a?{id:e.id,transform:"rotate("+e.angle+","+(e.x+e.width*e.pivotX)+","+(e.y+e.height*e.pivotY)+")translate("+e.x+","+e.y+"),scale("+a+")",visibility:e.visible?"visible":"hidden",opacity:e.opacity}:{id:e.id,transform:"rotate("+e.angle+","+(e.x+e.width*e.pivotX)+","+(e.y+e.height*e.pivotY)+")translate("+e.x+","+e.y+")",visibility:e.visible?"visible":"hidden",opacity:e.opacity};o&&(r.role="img",r["aria-label"]=o),e.class&&(r.class=e.class),ap(h,r),this.setSvgStyle(h,e,i)},Vs.prototype.renderPath=function(t,e,i){for(var n,r,o,a,s=i,h="",d=0,l=0,c=0,p=s.length;c<p;++c){var g=s[parseInt(c.toString(),10)],u=g.command;switch("x1"in g&&(n=g.x1),"x2"in g&&(o=g.x2),"y1"in g&&(r=g.y1),"y2"in g&&(a=g.y2),"x"in g&&(d=g.x),"y"in g&&(l=g.y),u){case"M":h=h+"M"+d.toString()+","+l.toString()+" ";break;case"L":h=h+"L"+d.toString()+","+l.toString()+" ";break;case"C":h=h+"C"+n.toString()+","+r.toString()+","+o.toString()+","+a.toString()+",",h+=d.toString()+","+l.toString()+" ";break;case"Q":h=h+"Q"+n.toString()+","+r.toString()+","+d.toString()+","+l.toString()+" ";break;case"A":h=h+"A"+g.r1.toString()+","+g.r2.toString()+","+g.angle.toString()+",",h+=g.largeArc.toString()+","+g.sweep+","+d.toString()+","+l.toString()+" ";break;case"Z":case"z":h+="Z "}}t.setAttribute("d",h)},Vs.prototype.setSvgFontStyle=function(t,e){t.style.fontStyle=e.italic?"italic":"normal",t.style.fontWeight=e.bold?"bold":"normal",t.style.fontSize=e.fontSize.toString()+"px",t.style.fontFamily=e.fontFamily},Vs.prototype.drawText=function(t,e,i,n,r,o,a){if(void 0!==e.content){var s,h,d,l,c=a.groupElement,p=void 0,g=void 0,u=void 0,m=0,f=0,y=void 0,a=void 0;if(y=i?i.getElementById(e.id+"_text"):y){if(e.doWrap)for(;y.firstChild;)y.removeChild(y.firstChild)}else e.doWrap=!0,y=document.createElementNS("http://www.w3.org/2000/svg","text"),"pre-wrap"===e.whiteSpace&&y.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),((a=c?document.getElementById(c.id+"_content_groupElement"):a)&&c&&c.children&&c.children[0]instanceof be?(i=this.createGElement("g",{id:n+"_groupElement"}),a.appendChild(i),i):t).appendChild(y);var a=e.x+e.width*e.pivotX,i=e.y+e.height*e.pivotY,v=0;if(e.doWrap||"Wrap"!==e.textOverflow){for(;y.firstChild;)y.removeChild(y.firstChild);for(this.setSvgStyle(y,e,r),this.setSvgFontStyle(y,e),p=document.createTextNode(e.content),g=e.childNodes,s=e.wrapBounds,h=this.svgLabelAlign(e,s,g),s.width>e.width&&"Wrap"!==e.textOverflow&&"NoWrap"===e.textWrapping&&(g[0].text=Ip(e.content,e)),f=0;f<g.length;f++)if(d=document.createElementNS("http://www.w3.org/2000/svg","tspan"),p=document.createTextNode(g[parseInt(f.toString(),10)].text),(u=g[parseInt(f.toString(),10)]).x=lp(u,g,f,e),m="justify"===e.textAlign||"left"===e.textAlign?0:h.x+u.x-s.x,l=h.y+u.dy*f+.8*e.fontSize,"Clip"!==e.textOverflow&&"Ellipsis"!==e.textOverflow||"WrapWithOverflow"!==e.textWrapping&&"Wrap"!==e.textWrapping||!c)this.alignText(y,d,u,p,m,l,f,e,g);else{var b,S=e.isHorizontalLane?c.actualSize.width:c.actualSize.height;if(!(l<S))break;"Ellipsis"===e.textOverflow&&g[f+1]&&(b=g[f+1],S<h.y+b.dy*(f+1)+.8*e.fontSize)&&(u.text=u.text.slice(0,u.text.length-3),u.text=u.text.concat("..."),p.data=u.text),this.alignText(y,d,u,p,m,l,f,e,g),v+=u.dy}}v&&e.isHorizontalLane&&(a=e.parentOffsetX+e.pivotX,i=e.parentOffsetY+e.pivotY,e.y=e.parentOffsetY-v*e.pivotY+.5),e.textDecoration&&"LineThrough"===e.textDecoration&&(e.textDecoration=Sp(e.textDecoration));t={id:e.id+"_text",fill:e.color,visibility:e.visible?"visible":"hidden","text-decoration":e.textDecoration,transform:"rotate("+e.angle+","+a+","+i+")translate("+e.x+","+e.y+")",opacity:e.opacity};n&&(t.role="img",t["aria-label"]=n),ap(y,t)}},Vs.prototype.alignText=function(t,e,i,n,r,o,a,s,h){"justify"===s.textAlign&&a!==h.length-1?(a=s.width,this.setText(t,e,i,n,r,o,s,a,"spacing")):this.setText(t,e,i,n,r,o,s)},Vs.prototype.setText=function(t,e,i,n,r,o,a,s,h){"justify"!==a.textAlign?ap(e,{x:r.toString(),y:o.toString()}):ap(e,{x:r.toString(),y:o.toString(),textLength:s||0,lengthAdjust:h||"spacing"}),t.setAttribute("fill",i.text),e.appendChild(n),t.appendChild(e)},Vs.prototype.drawImage=function(t,e,i,n){(r=i?i.getElementById(e.id+"image"):r)||(r=document.createElementNS("http://www.w3.org/2000/svg","image"),t.appendChild(r));var r,i=new Image,t=(i.src=e.source,"None"!==e.scale?e.scale:""),o=e.alignment,o=o.charAt(0).toLowerCase()+o.slice(1);"Stretch"!==t&&(o+=" "+t.charAt(0).toLowerCase()+t.slice(1)),ap(r,{id:e.id+"image",x:e.x.toString(),y:e.y.toString(),transform:"rotate("+e.angle+","+(e.x+e.width*e.pivotX)+","+(e.y+e.height*e.pivotY)+")",width:e.width.toString(),visibility:e.visible?"visible":"hidden",height:e.height.toString(),preserveAspectRatio:o,opacity:e.opacity.toString()}),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",i.src.toString())},Vs.prototype.drawHTMLContent=function(e,t,i,n,r){(a=t?t.querySelector("#"+e.id+"_html_element"):a)||(o=(o=t.querySelector("#"+e.id+"_html_element")||t.querySelector("#"+e.nodeId+"_html_element"))||A("div",{id:e.nodeId+"_html_element",class:"foreign-object"}),s={id:e.id+"_html_element",class:"foreign-object"},a=A("div",s),s=document.getElementById(e.diagramId).ej2_instances[0],h=!1,(h=t.parentNode&&t.parentNode.parentNode&&t.parentNode.parentNode.parentNode&&t.parentNode.parentNode.parentNode.classList.contains("e-overview")?!0:h)?s.isReact?s.renderReactTemplates(function(){a.appendChild(e.template.cloneNode(!0))}):a.appendChild(e.template.cloneNode(!0)):("string"==typeof e.template&&((h=document.createElement("div")).innerHTML=e.template,e.template=h,s.selectedItems.userHandles.filter(function(t){return t.name===e.id.split("_shape")[0]&&""!==t.template})[0].template=e.template),e.isTemplate&&e.template?a.appendChild(e.template):e.template&&a.appendChild(e.template.cloneNode(!0))),void 0!==r&&t.childNodes.length>r&&t.insertBefore(a,t.childNodes[parseInt(r.toString(),10)]),o.appendChild(a),t.appendChild(o));var o,a,s,h=gp(e).topLeft;a.style.height=e.actualSize.height+"px",a.style.width=e.actualSize.width+"px",a.style.left=h.x+"px",a.style.top=h.y+"px",a.style.position="absolute",a.style.transform="rotate("+(e.rotateAngle+e.parentTransform)+"deg)",a.style.pointerEvents=n?"all":"none",a.style.visibility=e.visible?"visible":"hidden",a.style.opacity=e.style.opacity.toString()},Vs.prototype.drawNativeContent=function(t,e,i,n,r){var o,a,s;r&&(o=r.getElementById(t.id+"_native_element"),a=r.getElementById(t.id+"_clip")),o||((o=document.createElementNS("http://www.w3.org/2000/svg","g")).setAttribute("id",t.id+"_native_element"),o.appendChild(t.template.cloneNode(!0)),(s=this.createGElement("g",{id:t.id+"_inner_native_element"})).appendChild(o),e.appendChild(s)),a&&o.removeChild(a),o.style.visibility=t.visible?"visible":"hidden",o.style.opacity=t.style.opacity?t.style.opacity.toString():"1",this.setNativTransform(t,o,i,n),"Slice"===t.scale&&this.drawClipPath(t,o,i,n,r),ap(o,t.description?{role:"img","aria-label":t.description}:{})},Vs.prototype.setNativTransform=function(t,e,i,n){var r=0!==t.contentSize.width?t.contentSize.width:1,o=0!==t.contentSize.height?t.contentSize.height:1,a=t.templatePosition.x*n/r,s=t.templatePosition.y*i/o;e.setAttribute("transform","rotate("+t.parentTransform+","+t.offsetX+","+t.offsetY+") translate("+(t.offsetX-a-n*t.pivot.x)+","+(t.offsetY-s-i*t.pivot.y)+") scale("+n/r+","+i/o+")")},Vs.prototype.drawClipPath=function(t,e,i,n,r){var o=t.contentSize.width,a=t.contentSize.height,n=t.width/(n/o),i=t.height/(i/a),o=t.templatePosition.x+(t.width>=t.height?0:(o-n)/2),a=t.templatePosition.y+(t.height>=t.width?0:(a-i)/2),s=r.getElementById(t.id+"_clip"),r=((s=document.createElementNS("http://www.w3.org/2000/svg","clipPath")).setAttribute("id",t.id+"_clip"),e.appendChild(s),r.getElementById(t.id+"_clip_rect"),document.createElementNS("http://www.w3.org/2000/svg","rect"));return s.appendChild(r),ap(r,{id:t.id+"_clip_rect",width:n.toString(),height:i.toString(),x:o.toString(),y:a.toString()}),bd()?e.setAttribute("clip-path","url("+location.protocol+"//"+location.host+location.pathname+"#"+t.id+"_clip)"):e.setAttribute("clip-path","url(#"+t.id+"_clip)"),e},Vs.prototype.renderGradient=function(t,e,i){var n,r,o,a=qc(i),s=a.getElementById(i+"gradient_pattern");if(s||(s=tp("defs",{id:i+"gradient_pattern"}),a.insertBefore(s,a.firstChild)),_h(e.id),"None"!==t.gradient.type){for(var h=0;h<t.gradient.stops.length;h++)n=n?Math.max(n,t.gradient.stops[parseInt(h.toString(),10)].offset):t.gradient.stops[parseInt(h.toString(),10)].offset,r=r?Math.min(r,t.gradient.stops[parseInt(h.toString(),10)].offset):t.gradient.stops[parseInt(h.toString(),10)].offset;o="Linear"===t.gradient.type?((i=t.gradient).id=e.id+"_linear",this.createLinearGradient(i)):((a=t.gradient).id=e.id+"_radial",this.createRadialGradient(a)),s.appendChild(o);for(h=0;h<t.gradient.stops.length;h++){var d=t.gradient.stops[parseInt(h.toString(),10)],l=r<0?(n+d.offset)/(2*n):d.offset/n,c=document.createElementNS("http://www.w3.org/2000/svg","stop");ap(c,{offset:l.toString(),style:"stop-color:"+d.color}),o.appendChild(c)}}return o},Vs.prototype.createLinearGradient=function(t){var e=document.createElementNS("http://www.w3.org/2000/svg","linearGradient");return ap(e,{id:t.id,x1:t.x1+"%",y1:t.y1+"%",x2:t.x2+"%",y2:t.y2+"%"}),e},Vs.prototype.createRadialGradient=function(t){var e=document.createElementNS("http://www.w3.org/2000/svg","radialGradient");return ap(e,{id:t.id,cx:t.cx+"%",cy:t.cy+"%",r:t.r+"%",fx:t.fx+"%",fy:t.fy+"%"}),e},Vs.prototype.setSvgStyle=function(t,e,i){var n,r;(e.canApplyStyle||void 0===e.canApplyStyle)&&("none"===e.fill&&(e.fill="transparent"),"none"===e.stroke&&(e.stroke="transparent"),n=[],r=void 0,e.dashArray&&(n=(new Op).parseDashArray(e.dashArray)),r=e.gradient&&"None"!==e.gradient.type&&i?(i=this.renderGradient(e,t,i),bd()?"url("+location.protocol+"//"+location.host+location.pathname+"#"+i.id+")":"url(#"+i.id+")"):e.fill,e.stroke&&t.setAttribute("stroke",e.stroke),void 0!==e.strokeWidth&&null!==e.strokeWidth&&t.setAttribute("stroke-width",e.strokeWidth.toString()),n&&t.setAttribute("stroke-dasharray",n.toString()||"none"),r)&&t.setAttribute("fill",r)},Vs.prototype.svgLabelAlign=function(t,e,i){var i=new j(e.width,i.length*(1.2*t.fontSize)),n={x:0,y:0},r=.5*t.width,o=.5*t.height;return"left"===t.textAlign||"justify"===t.textAlign?r=0:"center"===t.textAlign?r=e.width>t.width&&("Ellipsis"===t.textOverflow||"Clip"===t.textOverflow)&&"NoWrap"===t.textWrapping?0:.5*t.width:"right"===t.textAlign&&(r=+t.width),n.x=0+r+(e?e.x:0),n.y=1.2+o-i.height/2,n};var Xs=Vs;function Vs(){}o.prototype.setCursor=function(t,e){t.style.cursor=e},o.prototype.setLayers=function(){this.iconSvgLayer=this.element.getElementsByClassName("e-ports-expand-layer")[0],this.adornerSvgLayer=this.element.getElementsByClassName("e-adorner-layer")[0],this.nativeSvgLayer=this.element.getElementsByClassName("e-native-layer")[0],this.diagramSvgLayer=this.element.getElementsByClassName("e-diagram-layer")[0]},o.prototype.getAdornerLayer=function(){return Uc(this.diagramId)},o.prototype.getParentSvg=function(t,e,i){return this.diagramId&&t&&t.id?1<t.id.split("_icon_content").length||1<t.id.split("_nodeport").length||t.elementActions&Z.ElementAction.ElementIsPort?this.iconSvgLayer:e&&"selector"===e?this.adornerSvgLayer:t instanceof be?this.nativeSvgLayer:this.diagramSvgLayer:i},o.prototype.getParentElement=function(t,e,i,n){var r=e;return i&&this.diagramId&&t&&t.id&&(1<t.id.split("_icon_content").length?(r=i.getElementById(this.diagramId+"_diagramExpander"),e=null):1<t.id.split("_nodeport").length?r=i.getElementById(this.diagramId+"_diagramPorts"):t instanceof be?(r=i.getElementById(this.diagramId+"_nativeLayer"),e=null):t.elementActions&Z.ElementAction.ElementIsPort?(r=i.getElementById(this.diagramId+"_diagramPorts"),e=null):r=i.getElementById(this.diagramId+"_diagramLayer"),r=(t=this.getGroupElement(t,e||r,n)).g,t.svg)&&(i=t.svg),{g:r,svg:i}},o.prototype.getGroupElement=function(t,e,i){var n,r,o=this.getParentSvg(t);return e&&o&&(o&&!(n=o.getElementById(t.id+"_groupElement"))&&o!==this.nativeSvgLayer&&(n=(o=this.nativeSvgLayer).getElementById(t.id+"_groupElement"),r=o),n||(n=this.svgRenderer.createGElement("g",{id:t.id+"_groupElement"}),void 0!==i&&e.childNodes.length>i?e.insertBefore(n,e.childNodes[parseInt(i.toString(),10)]):e.appendChild(n))),{g:n,svg:r}},o.prototype.renderElement=function(t,e,i,n,r,o,a,s,h,d,l){t instanceof te?(t.id=t.id||q(),this.renderContainer(t,e,i,n,r,o,a,s,h,d,l)):t instanceof le?this.renderImageElement(t,e,n,r,a):t instanceof P?this.renderPathElement(t,e,n,r,a,h,l):t instanceof H?this.renderTextElement(t,e,n,r,a,d):t instanceof be?this.renderNativeElement(t,e,n,r,a):t instanceof an?this.renderHTMLElement(t,e,i,n,r,a,s):this.renderRect(t,e,n,r,h)},o.prototype.drawSelectionRectangle=function(t,e,i,n,r,o){t=(t+o.tx)*o.scale,e=(e+o.ty)*o.scale;i={width:i*o.scale,height:n*o.scale,x:t+.5,y:e+.5,fill:"transparent",stroke:"gray",angle:0,pivotX:.5,pivotY:.5,strokeWidth:1,dashArray:"6 3",opacity:1,visible:!0,id:r.id+"_selected_region"},n=this.getAdornerLayer();this.svgRenderer.updateSelectionRegion(n,i)},o.prototype.renderHighlighter=function(t,e,i){var n=t.actualSize.width||2,r=t.actualSize.height||2,o=t.offsetX-n*t.pivot.x,a=t.offsetY-r*t.pivot.y,o=(o+i.tx)*i.scale,a=(a+i.ty)*i.scale,n={width:n*i.scale,height:r*i.scale,x:o,y:a,fill:"transparent",stroke:"#8CC63F",angle:t.rotateAngle,pivotX:t.pivot.x,pivotY:t.pivot.y,strokeWidth:4,dashArray:"",opacity:1,cornerRadius:0,visible:!0,id:e.id+"_highlighter",class:"e-diagram-highlighter"};this.svgRenderer.drawRectangle(e,n,this.diagramId,void 0,void 0,e)},o.prototype.renderSelectionRectangle=function(t,e,i,n){var r=t.actualSize.width||2,o=t.actualSize.height||2,a=t.offsetX-r*t.pivot.x,s=t.offsetY-o*t.pivot.y,a=(a+i.tx)*i.scale,s=(s+i.ty)*i.scale,r={width:r*i.scale,height:o*i.scale,x:a,y:s,fill:"transparent",stroke:"#00cc00",angle:t.rotateAngle,pivotX:t.pivot.x,pivotY:t.pivot.y,strokeWidth:n?2:1,dashArray:"",opacity:1,cornerRadius:0,visible:!0,id:t.id+"_highlighter",class:n?"e-diagram-first-selection-indicator e-diagram-selection-indicator":"e-diagram-selection-indicator"},o=this.getParentSvg(t,"selector");this.svgRenderer.drawRectangle(e,r,this.diagramId,void 0,void 0,o)},o.prototype.renderSelectionLine=function(t,e,i,n){var r=this.getBaseAttributes(t,i),o=(r.data=t.absolutePath,r.id=r.id+"_highlighter",t.description||t.id),n=(this.isSvgMode||(r.x=t.flipOffset.x||r.x,r.y=t.flipOffset.y||r.y),i&&(r.x=r.x*i.scale,r.y=r.y*i.scale),r.stroke="#00cc00",r.strokeWidth=n?2:1,r.class=n?"e-diagram-first-selection-indicator e-diagram-selection-indicator":"e-diagram-selection-indicator",this.getParentSvg(t,"selector"));this.svgRenderer.drawPath(e,r,this.diagramId,void 0,n,o,i.scale)},o.prototype.renderStackHighlighter=function(t,e,i,n,r,o,a){var s,h,d=t.actualSize.width||2,l=t.offsetX-d*t.pivot.x,c=t.actualSize.height||2,p=t.offsetY-c*t.pivot.y,l=(l+i.tx)*i.scale,g=t.bounds,u="",p=(p+i.ty)*i.scale,n=(n?o?(h="M 0 0 L "+((s=d*i.scale)+2)+" 0 Z",n=-g.x,o=-g.y,n=t.actualSize.width/Number(g.width||1)*i.scale,o=t.actualSize.height/Number(g.height||1)*i.scale,u=V($(D("M7,4 L8,4 8,7 11,7 11,8 8,8 8,11 7,11 7,8 4,8 4,7 7,7 z M7.5,0.99999994C3.9160004,1 1,3.9160004 0.99999994,7.5 1,11.084 3.9160004,14 7.5,14 11.084,14 14,11.084 14,7.5 14,3.9160004 11.084,1 7.5,0.99999994 z M7.5,0 C11.636002,0 15,3.3639984 15,7.5 15,11.636002 11.636002,15 7.5,15 3.3640003,15 0,11.636002 0,7.5 0,3.3639984 3.3640003,0 7.5,0 z")),n+s+2,o-8,!1,g.x,g.y,0,0),r.y>=t.offsetY&&(p+=c)):(a&&r.y>=t.offsetY&&(p+=c*i.scale),h="M -10 -10 L 0 0 Z M -10 10 L 0 0 Z M 0 0 L "+(s=d*i.scale)+" 0 Z M "+s+" 0 L "+(s+10)+" 10 Z L "+(s+10)+" -10 Z"):(h="M 10 -10 L 0 0 Z M -10 -10 L 0 0 Z M 0 0 L 0 "+(s=c*i.scale)+" Z M 0  "+s+" L -10  "+(s+10)+" Z L 10  "+(s+10)+" Z",r.x>=t.offsetX&&(l+=d*i.scale)),{data:h+u,width:d*i.scale,height:c*i.scale,x:l,y:p,fill:"transparent",stroke:"#8CC63F",angle:t.rotateAngle,pivotX:t.pivot.x,pivotY:t.pivot.y,strokeWidth:1,dashArray:"",opacity:1,visible:!0,id:e.id+"_stack_highlighter",class:"e-diagram-highlighter"});this.svgRenderer.drawPath(e,n,this.diagramId)},o.prototype.drawLine=function(t,e){this.svgRenderer.drawLine(t,e)},o.prototype.drawPath=function(t,e){this.svgRenderer.drawPath(t,e,this.diagramId)},o.prototype.renderResizeHandle=function(t,e,i,n,r,o,a,s,h,d,l){var c=t.offsetX-t.actualSize.width*t.pivot.x,p=t.offsetY-t.actualSize.height*t.pivot.y,g=t.actualSize.height,u=t.actualSize.width,m=(!d&&i&Z.ThumbsConstraints.Rotate&&Vn(this.rendererActions)&&!Fn(this.rendererActions)?(this.renderPivotLine(t,e,o,r,a),this.renderRotateThumb(t,e,o,r,a)):this.touchMove&&(m=document.getElementById("rotateThumb"))&&m.setAttribute("visibility","hidden"),this.renderBorder(t,e,o,s,h,d),t.actualSize.width*n),s=t.actualSize.height*n;h||!Vn(this.rendererActions)||Fn(this.rendererActions)||t.isTextAnnotation||(40<=m&&40<=s&&(r&Z.SelectorConstraints.ResizeNorthWest&&this.renderCircularHandle("resizeNorthWest",t,c,p,e,Uh(r,"ResizeNorthWest"),i&Z.ThumbsConstraints.ResizeNorthWest,o,void 0,a,{"aria-label":"Thumb to resize the selected object on top left side direction"},void 0,"e-diagram-resize-handle e-northwest",l),r&Z.SelectorConstraints.ResizeNorthEast&&this.renderCircularHandle("resizeNorthEast",t,c+u,p,e,Uh(r,"ResizeNorthEast"),i&Z.ThumbsConstraints.ResizeNorthEast,o,void 0,a,{"aria-label":"Thumb to resize the selected object on top right side direction"},void 0,"e-diagram-resize-handle e-northeast",l),r&Z.SelectorConstraints.ResizeSouthWest&&this.renderCircularHandle("resizeSouthWest",t,c,p+g,e,Uh(r,"ResizeSouthWest"),i&Z.ThumbsConstraints.ResizeSouthWest,o,void 0,a,{"aria-label":"Thumb to resize the selected object on bottom left side direction"},void 0,"e-diagram-resize-handle e-southwest",l),r&Z.SelectorConstraints.ResizeSouthEast)&&this.renderCircularHandle("resizeSouthEast",t,c+u,p+g,e,Uh(r,"ResizeSouthEast"),i&Z.ThumbsConstraints.ResizeSouthEast,o,void 0,a,{"aria-label":"Thumb to resize the selected object on bottom right side direction"},void 0,"e-diagram-resize-handle e-southeast",l),r&Z.SelectorConstraints.ResizeNorth&&this.renderCircularHandle("resizeNorth",t,c+u/2,p,e,Uh(r,"ResizeNorth"),i&Z.ThumbsConstraints.ResizeNorth,o,void 0,a,{"aria-label":"Thumb to resize the selected object on top side direction"},void 0,"e-diagram-resize-handle e-north",l),r&Z.SelectorConstraints.ResizeSouth&&this.renderCircularHandle("resizeSouth",t,c+u/2,p+g,e,Uh(r,"ResizeSouth"),i&Z.ThumbsConstraints.ResizeSouth,o,void 0,a,{"aria-label":"Thumb to resize the selected object on bottom side direction"},void 0,"e-diagram-resize-handle e-south",l),r&Z.SelectorConstraints.ResizeWest&&this.renderCircularHandle("resizeWest",t,c,p+g/2,e,Uh(r,"ResizeWest"),i&Z.ThumbsConstraints.ResizeWest,o,void 0,a,{"aria-label":"Thumb to resize the selected object on left side direction"},void 0,"e-diagram-resize-handle e-west",l),r&Z.SelectorConstraints.ResizeEast&&this.renderCircularHandle("resizeEast",t,c+u,p+g/2,e,Uh(r,"ResizeEast"),i&Z.ThumbsConstraints.ResizeEast,o,void 0,a,{"aria-label":"Thumb to resize the selected object on right side direction"},void 0,"e-diagram-resize-handle e-east",l))},o.prototype.renderEndPointHandle=function(t,e,i,n,r,o,a,s,h,d){var l=t.sourcePoint,c=t.targetPoint,p=t.wrapper;if(this.renderCircularHandle("connectorSourceThumb",p,l.x,l.y,e,Uh(n,"ConnectorSourceThumb"),i&Z.ThumbsConstraints.ConnectorSource,r,o,void 0,{"aria-label":"Thumb to move the source point of the connector"},void 0,"e-diagram-endpoint-handle e-sourceend",d),this.renderCircularHandle("connectorTargetThumb",p,c.x,c.y,e,Uh(n,"ConnectorTargetThumb"),i&Z.ThumbsConstraints.ConnectorTarget,r,a,void 0,{"aria-label":"Thumb to move the target point of the connector"},void 0,"e-diagram-endpoint-handle e-targetend",d),s)if("Straight"===t.type&&0<t.segments.length)for(b=0;b<t.segments.length-1;b++){var g=t.segments[parseInt(b.toString(),10)],u="e-diagram-straight-segment-handle";this.renderCircularHandle("segementThumb_"+(b+1),p,g.point.x,g.point.y,e,!0,i&Z.ThumbsConstraints.ConnectorSource,r,o,null,null,b,u,d)}else if("Bezier"===t.type&&0<t.segments.length)for(b=0;b<t.segments.length-1;b++){g=t.segments[parseInt(b.toString(),10)];u="e-diagram-bezier-segment-handle";this.renderBezierHandle("segementThumb_"+(b+1),p,g.point.x,g.point.y,e,!0,t,r,o,null,b,u,d)}else if(t.maxSegmentThumb){var l=t.segments.length<=t.maxSegmentThumb?0:1,m=t.segments.length<=t.maxSegmentThumb?t.segments.length:t.segments.length-1;for(3<=t.maxSegmentThumb&&3===t.segments.length&&(m=t.segments.length-(l=1)),l=t.segments.length>t.maxSegmentThumb+2?2:l,m=t.segments.length>t.maxSegmentThumb+2?t.segments.length-2:m,1===t.segments.length&&t.segments[0].points.length<=2&&(l=1,m=t.segments.length),b=l;b<m;b++){f=t.segments[parseInt(b.toString(),10)];this.renderOrthogonalThumbs("orthoThumb_"+(b+1),p,f,e,Uh(n,"ConnectorSourceThumb"),r,t)}}else for(b=0;b<t.segments.length;b++){var f=t.segments[parseInt(b.toString(),10)];this.renderOrthogonalThumbs("orthoThumb_"+(b+1),p,f,e,Uh(n,"ConnectorSourceThumb"),r,t)}if("Bezier"===t.type&&h)for(var y=t.segments.length-1,v=null!=t.bezierSettings?t.bezierSettings.controlPointsVisibility:null,b=0;b<=y;b++){var S=t.segments[parseInt(b.toString(),10)],w=K.isEmptyPoint(S.point1)?S.bezierPoint1:S.point1;(null!=v&&0===b&&Gh(v,"Source")||0!==b&&Gh(v,"Intermediate"))&&(this.renderCircularHandle("bezierPoint_"+(b+1)+"_1",p,w.x,w.y,e,Uh(n,"ConnectorSourceThumb"),i&Z.ThumbsConstraints.ConnectorSource,r,void 0,void 0,{"aria-label":"Thumb to move the source point of the connector"},void 0,"e-diagram-bezier-control-handle e-source",d),Uh(n,"ConnectorSourceThumb"))&&this.renderBezierLine("bezierLine_"+(b+1)+"_1",p,e,S.points[0],K.isEmptyPoint(S.point1)?S.bezierPoint1:S.point1,r),w=K.isEmptyPoint(S.point2)?S.bezierPoint2:S.point2,(null!=v&&b===y&&Gh(v,"Target")||b!==y&&Gh(v,"Intermediate"))&&(this.renderCircularHandle("bezierPoint_"+(b+1)+"_2",p,w.x,w.y,e,Uh(n,"ConnectorTargetThumb"),i&Z.ThumbsConstraints.ConnectorTarget,r,void 0,void 0,{"aria-label":"Thumb to move the target point of the connector"},void 0,"e-diagram-bezier-control-handle e-target",d),Uh(n,"ConnectorTargetThumb"))&&this.renderBezierLine("bezierLine_"+(b+1)+"_2",p,e,S.points[1],K.isEmptyPoint(S.point2)?S.bezierPoint2:S.point2,r)}},o.prototype.renderOrthogonalThumbs=function(t,e,i,n,r,o,a){var s,h,d,l,c=0;if(a.maxSegmentThumb)for(var p=i.points.length<3?0:1,g=i.points.length<3?i.points.length-1:i.points.length-2,p=1===a.segments.length?p:0,g=1===a.segments.length?g:i.points.length-1,c=p;c<g;c++)d=K.distancePoints(i.points[parseInt(c.toString(),10)],i.points[c+1]),s=i.points[parseInt(c.toString(),10)].y.toFixed(2)===i.points[c+1].y.toFixed(2)?"horizontal":"vertical",h=!!(50<=d&&i.allowDrag),this.renderOrthogonalThumb(t+"_"+(c+1),e,(i.points[parseInt(c.toString(),10)].x+i.points[c+1].x)/2,(i.points[parseInt(c.toString(),10)].y+i.points[c+1].y)/2,n,h,s,o,a,l);else for(c=0;c<i.points.length-1;c++)d=K.distancePoints(i.points[parseInt(c.toString(),10)],i.points[c+1]),s=i.points[parseInt(c.toString(),10)].y.toFixed(2)===i.points[c+1].y.toFixed(2)?"horizontal":"vertical",l=K.direction(i.points[parseInt(c.toString(),10)],i.points[c+1]),h=!!(50<=d&&i.allowDrag),this.renderOrthogonalThumb(t+"_"+(c+1),e,(i.points[parseInt(c.toString(),10)].x+i.points[c+1].x)/2,(i.points[parseInt(c.toString(),10)].y+i.points[c+1].y)/2,n,h,s,o,a,l)},o.prototype.renderOrthogonalThumb=function(t,e,i,n,r,o,a,s,h,d){var l=0,c=document.getElementById(this.diagramId);c&&(p=c.ej2_instances[0]);var c=(h.constraints&Z.ConnectorConstraints.InheritSegmentThumbShape?p:h).segmentThumbShape,p=(h.constraints&Z.ConnectorConstraints.InheritSegmentThumbSize?p:h).segmentThumbSize,h=("horizontal"===a?ei:ii)(c);if("Arrow"===c||"DoubleArrow"===c||"OpenArrow"===c)switch(d){case"Bottom":case"Right":l=180;break;default:l=0}else if("Fletch"===c||"OpenFetch"===c||"IndentedArrow"===c||"OutdentedArrow"===c)switch(d){case"Bottom":l=-90;break;case"Top":l=90;break;case"Right":l=180;break;default:l=0}a={x:(i+s.tx)*s.scale-p/2,y:(n+s.ty)*s.scale-p/2,angle:l,fill:"#e2e2e2",stroke:"black",strokeWidth:1,dashArray:"",data:h,width:p,height:p,pivotX:.5,pivotY:.5,opacity:1,visible:o,id:t,class:"e-diagram-ortho-segment-handle"},c=Hc(a.data),d=new j(a.width,a.height),i=new P;a.data=i.updatePath(a.data,c,d),this.touchMove&&(n=document.getElementById(t))?this.updateSegmentPosition(n,a):this.svgRenderer.drawPath(r,a,this.diagramId)},o.prototype.renderPivotLine=function(t,e,i,n,r){n=!!(n&Z.SelectorConstraints.Rotate),r&&(n=!1),r=this.getBaseAttributes(t,i),r.fill="None",r.stroke="black",r.strokeWidth=1,r.dashArray="2,3",r.visible=n,n=i.scale,r.x*=n,r.y*=n,r.width*=n,r.height*=n,r.id="pivotLine",r.class="e-diagram-pivot-line",i={x:t.actualSize.width*t.pivot.x*n,y:-20},t={x:t.actualSize.width*t.pivot.x*n,y:0};r.startPoint=i,r.endPoint=t,this.svgRenderer.drawLine(e,r)},o.prototype.renderBezierLine=function(t,e,i,n,r,o){var e=this.getBaseAttributes(e,o),t=(e.id=t,e.stroke="black",e.strokeWidth=1,e.dashArray="3,3",e.fill="None",e.class="e-diagram-bezier-control-line",e.x=0,e.y=0,o.scale),a=(n.x+o.tx)*t,n=(n.y+o.ty)*t,r={x:(r.x+o.tx)*t,y:(r.y+o.ty)*t};e.startPoint={x:a,y:n},e.endPoint=r,this.svgRenderer.drawLine(i,e)},o.prototype.renderCircularHandle=function(t,e,i,n,r,o,a,s,h,d,l,c,p,g){var u=e,i={x:i,y:n},n=(0===u.rotateAngle&&0===u.parentTransform||(at(n=rt(),u.rotateAngle+u.parentTransform,u.offsetX,u.offsetY),i=z(n,i)),this.getBaseAttributes(u));n.stroke="black",n.strokeWidth=1,void 0!==c?(n.id="segmentEnd_"+c,n.fill="#e2e2e2"):n.fill=h?"#8CC63F":"white",n.cornerRadius=g/2,n.angle=e.rotateAngle,n.id=t,n.visible=o,n.class=p,n.width=g,n.height=g,n.x=(i.x+s.tx)*s.scale,n.y=(i.y+s.ty)*s.scale,n.x=n.x-n.width/2,n.y=n.y-n.height/2,h&&(n.class+=" e-connected"),d&&(n.visible=!1),this.touchMove&&(u=document.getElementById(t))?this.updateResizeHandle(u,n):(c=this.getParentSvg(e,"selector"),this.svgRenderer.drawRectangle(r,n,this.diagramId,!0,!0,c,l,!0,a))},o.prototype.updateResizeHandle=function(t,e){ap(t,{id:e.id,x:e.x.toString(),y:e.y.toString(),width:e.width.toString(),height:e.height.toString(),visibility:e.visible?"visible":"hidden",transform:"rotate("+e.angle+","+(e.x+e.width/2)+","+(e.y+e.height/2)+")",rx:e.cornerRadius||0,ry:e.cornerRadius||0,opacity:e.opacity})},o.prototype.renderBezierHandle=function(t,e,i,n,r,o,a,s,h,d,l,c,p){var g=document.getElementById(this.diagramId),g=(g&&(u=g.ej2_instances[0]),e),i={x:i,y:n};0===g.rotateAngle&&0===g.parentTransform||(at(n=rt(),g.rotateAngle+g.parentTransform,g.offsetX,g.offsetY),i=z(n,i));var n=(a.constraints&Z.ConnectorConstraints.InheritSegmentThumbShape?u:a).segmentThumbShape,u=(a.constraints&Z.ConnectorConstraints.InheritSegmentThumbSize?u:a).segmentThumbSize,a=ii(n),n=this.getBaseAttributes(g),g=(n.stroke="black",n.strokeWidth=1,void 0!==l?(n.id="segmentEnd_"+l,n.fill="#e2e2e2"):n.fill=h?"#8CC63F":"white",n.angle=e.rotateAngle,n.id=t,n.visible=o,n.class=c,n.width=u,n.height=u,n.data=a,n.x=(i.x+s.tx)*s.scale,n.y=(i.y+s.ty)*s.scale,n.x=n.x-n.width/2,n.y=n.y-n.height/2,h&&(n.class+=" e-connected"),d&&(n.visible=!1),Hc(n.data)),l=new j(n.width,n.height),o=new P;n.data=o.updatePath(n.data,g,l),this.touchMove&&(c=document.getElementById(t))?this.updateSegmentPosition(c,n):(u=this.getParentSvg(e,"selector"),this.svgRenderer.drawPath(r,n,this.diagramId,!0,u))},o.prototype.updateSegmentPosition=function(t,e){ap(t,{id:e.id,transform:"rotate("+e.angle+","+(e.x+e.width*e.pivotX)+","+(e.y+e.height*e.pivotY)+")translate("+e.x+","+e.y+")",visibility:e.visible?"visible":"hidden",opacity:e.opacity})},o.prototype.renderBorder=function(t,e,i,n,r,o){var a=this.getBaseAttributes(t,i),i=(a.x*=i.scale,a.y*=i.scale,a.width*=i.scale,a.height*=i.scale,a.fill="transparent",a.stroke="#097F7F",a.strokeWidth=1.2,a.gradient=null,a.dashArray="6,3",a.class="e-diagram-selector",o&&(a.class+=" e-diagram-lane"),a.id="borderRect",a.id=this.rendererActions&Z.RendererAction.DrawSelectorBorder?"borderRect_symbol":"borderRect",n||(a.class+=" e-disabled"),r&&(a.class+=" e-thick-border"),a.cornerRadius=0,this.getParentSvg(t,"selector"));this.svgRenderer.drawRectangle(e,a,this.diagramId,void 0,!0,i)},o.prototype.renderUserHandler=function(t,e,i,n,r,o){for(var a=t.wrapper,s=0,h=t.userHandles;s<h.length;s++){var d,l=h[s],c=!0,p=((l.disableConnectors&&0<t.connectors.length||l.disableNodes&&0<t.nodes.length||"Drag"===r&&o)&&(c=!1),document.getElementById(l.name+"_template_hiddenUserHandle")),p=(p&&(l.template=p.childNodes[0].cloneNode(!0)),Vh(t,l,i));p.x=(p.x+i.tx)*i.scale,p.y=(p.y+i.ty)*i.scale,l.visible&&(l.visible=!!(t.constraints&Z.SelectorConstraints.UserHandle)),c&&(l.pathData?(c=l.pathData||l.content,(d=this.getBaseAttributes(a)).id=l.name+"_userhandle",d.fill=l.backgroundColor,d.stroke=l.borderColor,d.strokeWidth=l.borderWidth,d.centerX=p.x,d.centerY=p.y,d.radius=.5*l.size,d.class="e-diagram-userhandle-circle",d.angle=0,d.visible=l.visible,d.opacity=1,this.svgRenderer.drawCircle(e,d,1,{"aria-label":l.name+"user handle"}),d=[],d=$(d=D(c)),c=Hc(c),c=Hc(d=V(d,(l.size-.45*l.size)/c.width,(l.size-.45*l.size)/c.height,!0,c.x,c.y,0,0)),d={x:p.x-c.width/2,y:p.y-c.height/2,angle:0,id:"",class:"e-diagram-userhandle-path",fill:l.pathColor,stroke:l.backgroundColor,strokeWidth:.5,dashArray:"",data:d,width:l.size-5,height:l.size-5,pivotX:0,pivotY:0,opacity:1,visible:l.visible},this.svgRenderer.drawPath(e,d,this.diagramId,void 0,void 0,{"aria-label":l.name+"user handle"})):l.content?((c=new be(l.name,this.diagramId)).content=l.content,c.offsetX=p.x,c.offsetY=p.y,c.id=l.name+"_shape",c.horizontalAlignment="Center",c.verticalAlignment="Center",c.visible=l.visible,c.setOffsetWithRespectToBounds(p.x,p.y,"Fraction"),c.relativeMode="Object",c.description=l.name||"User handle",c.measure(new j(l.size,l.size)),c.arrange(c.desiredSize),this.svgRenderer.drawNativeContent(c,e,l.size,l.size,this.adornerSvgLayer)):l.source?(c=new le,(d=this.getBaseAttributes(c,i)).width=l.size,d.height=l.size,d.x=p.x-l.size/2,d.y=p.y-l.size/2,d.sourceWidth=l.size,d.sourceHeight=l.size,d.alignment=c.imageAlign,d.source=l.source,d.scale=c.imageScale,d.visible=l.visible,d.description=l.name||"User handle",d.id=l.name+"_",this.renderer.drawImage(e,d,this.adornerSvgLayer,!1)):((c=new an(l.name,this.diagramId)).offsetX=p.x,c.offsetY=p.y,c.id=l.name+"_shape",c.visible=l.visible,c.relativeMode="Object",c.template=l.template,c.measure(new j(l.size,l.size)),c.arrange(c.desiredSize),this.svgRenderer.drawHTMLContent(c,n,void 0,!0,void 0)))}},o.prototype.renderRotateThumb=function(t,e,i,n,r){new P;var o=new j,a=(o.width=18,o.height=16,t.offsetY-t.actualSize.height*t.pivot.y),s=t.offsetX-t.actualSize.width*t.pivot.x,n=!!(n&Z.SelectorConstraints.Rotate),r=(r&&(n=!1),(s+t.pivot.x*t.actualSize.width+i.tx)*i.scale),s=(a+i.ty)*i.scale,a={x:r-.5*o.width,y:s-30-.5*o.height},s=(0===t.rotateAngle&&0===t.parentTransform||(at(r=rt(),t.rotateAngle+t.parentTransform,(i.tx+t.offsetX)*i.scale,(i.ty+t.offsetY)*i.scale),a=z(r,a)),{x:a.x,y:a.y,angle:t.rotateAngle+t.parentTransform,fill:"#231f20",stroke:"black",strokeWidth:.5,dashArray:"",data:"M 16.856144362449648 10.238890446662904 L 18.000144362449646 3.437890446662903L 15.811144362449646 4.254890446662903 C 14.837144362449646 2.5608904466629028 13.329144362449647  1.2598904466629026 11.485144362449645 0.5588904466629026 C 9.375144362449646 - 0.24510955333709716 7.071144362449646  - 0.18010955333709716 5.010144362449646 0.7438904466629028 C 2.942144362449646 1.6678904466629028 1.365144362449646 3.341890446662903 0.558144362449646 5.452890446662903 C - 0.244855637550354 7.567890446662903 - 0.17985563755035394 9.866890446662904 0.7431443624496461 11.930890446662904 C 1.6681443624496461 13.994890446662904 3.343144362449646 15.575890446662903 5.457144362449647 16.380890446662903 C 6.426144362449647 16.7518904466629 7.450144362449647 16.9348904466629 8.470144362449647 16.9348904466629 C 9.815144362449647 16.9348904466629 11.155144362449647 16.6178904466629 12.367144362449647 15.986890446662901 L 11.351144362449647 14.024890446662901 C 9.767144362449647 14.8468904466629 7.906144362449647 14.953890446662902 6.237144362449647 14.3178904466629 C 4.677144362449647 13.7218904466629 3.444144362449647 12.5558904466629 2.758144362449647 11.028890446662901 C 2.078144362449646 9.501890446662903 2.031144362449646 7.802890446662903 2.622144362449646 6.243890446662903 C 3.216144362449646 4.6798904466629025 4.387144362449646 3.442890446662903 5.914144362449646 2.760890446662903 C 7.437144362449646 2.078890446662903 9.137144362449646 2.0298904466629026 10.700144362449645 2.6258904466629027 C 11.946144362449646 3.100890446662903 12.971144362449646 3.9538904466629026 13.686144362449646 5.049890446662903 L 11.540144362449645 5.850890446662903 L 16.856144362449648 10.238890446662904 Z",width:20,height:20,pivotX:0,pivotY:0,opacity:1,visible:n,id:t.id,class:"e-diagram-rotate-handle"});s.id="rotateThumb",this.touchMove&&(o=document.getElementById("rotateThumb"))?this.updateSegmentPosition(o,s):this.svgRenderer.drawPath(e,s,this.diagramId,!0,void 0,{"aria-label":"Thumb to rotate the selected object"})},o.prototype.renderPathElement=function(t,e,i,n,r,o,a){var s,i=this.getBaseAttributes(t,i,o),a=(i.data=t.absolutePath,i.data=t.absolutePath,t.isPathPort&&a&&(i.x=a[t.id]?a[t.id].cx:i.x,i.y=a[t.id]?a[t.id].cy:i.y,t.bounds.x=i.x,t.bounds.y=i.y,o=document.getElementById(this.diagramId))&&"PortDrag"!==o.ej2_instances[0].eventHandler.currentAction&&(t.offsetX=i.x+t.width/2,t.offsetY=i.y+t.height/2),t.description||t.id);t.isExport&&(o=t.absoluteBounds,s=D(i.data),s=this.findAndStoreArcValues(s),i.arc=s,i.data=_c(t,o,0,i)),this.renderer.drawPath(e,i,this.diagramId,void 0,n,a,void 0,this,t)},o.prototype.findAndStoreArcValues=function(t){var e=[];return t.forEach(function(t){"A"===t.command&&(t={r1:t.r1/2,r2:t.r2/2},e.push(t))}),e},o.prototype.renderSvgGridlines=function(t,e,i,n,r,o){var a=document.createElementNS("http://www.w3.org/2000/svg","pattern"),s=document.createElementNS("http://www.w3.org/2000/svg","defs"),h=(s.setAttribute("id",this.diagramId+"_grid_pattern_defn"),(t.constraints&Z.SnapConstraints.ShowHorizontalLines||t.constraints&Z.SnapConstraints.ShowVerticalLines)&&a.setAttribute("id",this.diagramId+"_pattern"),0),d=0,l=0,c=0,p=1,g=!1,u="Lines"===t.gridType,m=u?t.verticalGridlines.lineIntervals:t.verticalGridlines.dotIntervals,f=u?t.horizontalGridlines.lineIntervals:t.horizontalGridlines.dotIntervals;if(n.showRulers&&n.dynamicGrid&&r&&o)l=o.updateSegmentWidth(i.scale),c=r.updateSegmentWidth(i.scale),t.horizontalGridlines.scaledIntervals=[l/r.interval],t.verticalGridlines.scaledIntervals=[c/o.interval],g=!0;else{for(var y=0;y<m.length;y+=1)h+=m[parseInt(y.toString(),10)];for(y=0;y<f.length;y+=1)d+=f[parseInt(y.toString(),10)];p=this.scaleSnapInterval(t,i.scale)}h=g?c:h*p,d=g?l:d*p;ap(a,{id:this.diagramId+"_pattern",x:0,y:0,width:h,height:d,patternUnits:"userSpaceOnUse"}),this.horizontalSvgGridlines(a,h,d,p,t,n,o,g,u,f),this.verticalSvgGridlines(a,h,d,p,t,n,r,g,u,m),s.appendChild(a),e.appendChild(s)},o.prototype.horizontalSvgGridlines=function(t,e,i,n,r,o,a,s,h,d){var l=0,c=[];if(r.constraints&Z.SnapConstraints.ShowHorizontalLines){r.horizontalGridlines.lineDashArray&&(c=this.renderer.parseDashArray(r.horizontalGridlines.lineDashArray)),d=th(d=o.showRulers&&o.dynamicGrid&&a?this.updateLineIntervals(d,o,a,i,h):d,h);for(var p=0;p<d.length;p+=2){var l=$s(d,h,p,l),g=document.createElementNS("http://www.w3.org/2000/svg",h?"path":"circle"),u=h?l+d[parseInt(p.toString(),10)]/2:l,u=s?u:u*n;h?(ap(g,""===c.toString()?{"stroke-width":d[parseInt(p.toString(),10)],d:"M0,"+u+" L"+e+","+u+" Z",class:1.25===d[parseInt(p.toString(),10)]?"e-diagram-thick-grid":"e-diagram-thin-grid",stroke:r.horizontalGridlines.lineColor}:{"stroke-width":d[parseInt(p.toString(),10)],stroke:r.horizontalGridlines.lineColor,d:"M0,"+u+" L"+e+","+u+" Z",class:1.25===d[parseInt(p.toString(),10)]?"e-diagram-thick-grid":"e-diagram-thin-grid",dashArray:c.toString()}),t.appendChild(g),l+=d[p+1]+d[parseInt(p.toString(),10)]):(this.renderDotGrid(p,t,r,0,u,n,!0),l+=d[parseInt(p.toString(),10)])}}},o.prototype.renderDotGrid=function(t,e,i,n,r,o,a){for(var s,h,d,l=th((a?i.verticalGridlines:i.horizontalGridlines).dotIntervals,!1),c=1;c<l.length;c+=2)s=c===l.length-1?l[0]:l[c-1],d=n,d*=o,ap(h=document.createElementNS("http://www.w3.org/2000/svg","circle"),{cx:a?d:r,cy:a?r:d,fill:i.horizontalGridlines.lineColor,r:s}),e.appendChild(h),n+=l[parseInt(c.toString(),10)]+l[c-1]},o.prototype.verticalSvgGridlines=function(t,e,i,n,r,o,a,s,h,d){var l=0,c=[];if(r.constraints&Z.SnapConstraints.ShowVerticalLines){r.verticalGridlines.lineDashArray&&(c=this.renderer.parseDashArray(r.verticalGridlines.lineDashArray));d=th(d=o.showRulers&&o.dynamicGrid&&a?this.updateLineIntervals(d,o,a,e,h):d,h);for(var p=0;p<d.length;p+=2){var l=$s(d,h,p,l),g=h?l+d[parseInt(p.toString(),10)]/2:l,g=s?g:g*n,u=document.createElementNS("http://www.w3.org/2000/svg",h?"path":"circle");h?(ap(u,""===c.toString()?{"stroke-width":d[parseInt(p.toString(),10)],d:"M"+g+",0 L"+g+","+i+" Z",class:1.25===d[parseInt(p.toString(),10)]?"e-diagram-thick-grid":"e-diagram-thin-grid",stroke:r.verticalGridlines.lineColor}:{"stroke-width":d[parseInt(p.toString(),10)],class:1.25===d[parseInt(p.toString(),10)]?"e-diagram-thick-grid":"e-diagram-thin-grid",stroke:r.verticalGridlines.lineColor,d:"M"+g+",0 L"+g+","+i+" Z",dashArray:c.toString()}),t.appendChild(u),l+=d[p+1]+d[parseInt(p.toString(),10)]):(this.renderDotGrid(p,t,r,0,g,n,!1),l+=d[parseInt(p.toString(),10)])}}},o.prototype.updateGrid=function(t,e,i,n,r,o){var a=e.getElementById(this.diagramId+"_grid_rect"),s=!1;if(a){for(var h=e.getElementById(this.diagramId+"_pattern"),d=(h&&h.parentNode.removeChild(h),0),l=0,c=1,p="Lines"===t.gridType,g=p?t.verticalGridlines.lineIntervals:t.verticalGridlines.dotIntervals,u=p?t.horizontalGridlines.lineIntervals:t.horizontalGridlines.dotIntervals,m=(n.showRulers&&n.dynamicGrid&&o&&r?(d=o.updateSegmentWidth(i.scale),l=r.updateSegmentWidth(i.scale),s=!0,t.horizontalGridlines.scaledIntervals=[d/r.interval],t.verticalGridlines.scaledIntervals=[l/o.interval]):c=this.scaleSnapInterval(t,i.scale),0),f=0;f<u.length;f+=1)m+=u[parseInt(f.toString(),10)];for(var y=0,f=0;f<g.length;f+=1)y+=g[parseInt(f.toString(),10)];ap(a,{x:-i.tx*i.scale,y:-i.ty*i.scale}),a={id:this.diagramId+"_pattern",x:0,y:0,width:y=s?l:y*c,height:m=s?d:m*c,patternUnits:"userSpaceOnUse"},ap(h=document.createElementNS("http://www.w3.org/2000/svg","pattern"),a),this.horizontalSvgGridlines(h,y,m,c,t,n,o,s,p,u),this.verticalSvgGridlines(h,y,m,c,t,n,r,s,p,g);i=e.getElementById(this.diagramId+"_grid_pattern_defn");i&&i.appendChild(h)}},o.prototype.updateLineIntervals=function(t,e,i,n,r){for(var o=[],a=n/i.interval,s=r?i.interval:i.interval+1,h=0;h<2*s;h++)o[parseInt(h.toString(),10)]=h%2==0?r?0===h?1.25:.25:0:r?a-o[h-1]:a;return o},o.prototype.scaleSnapInterval=function(t,e){if(2<=e)for(;2<=e;)e/=2;else if(e<=.5)for(;e<=.5;)e*=2;var i;if(t.horizontalGridlines.scaledIntervals=t.horizontalGridlines.snapIntervals,t.verticalGridlines.scaledIntervals=t.verticalGridlines.snapIntervals,1!==e){var n=t.horizontalGridlines;for(n.scaledIntervals=[],i=0;i<n.snapIntervals.length;i++)n.scaledIntervals[parseInt(i.toString(),10)]=n.snapIntervals[parseInt(i.toString(),10)]*e;for((n=t.verticalGridlines).scaledIntervals=[],i=0;i<n.snapIntervals.length;i++)n.scaledIntervals[parseInt(i.toString(),10)]=n.snapIntervals[parseInt(i.toString(),10)]*e}return e},o.prototype.renderTextElement=function(t,e,i,n,r,o){i=this.getBaseAttributes(t,i),o&&(i.x=o[t.id]?o[t.id].cx:i.x,i.y=o[t.id]?o[t.id].cy:i.y,t.bounds.x=i.x,t.bounds.y=i.y,t.isExport)&&(i.x=i.x*Math.min(t.exportScaleValue.x||t.exportScaleValue.y),i.y=i.y*Math.min(t.exportScaleValue.x||t.exportScaleValue.y)),i.cornerRadius=0,i.whiteSpace=Cp(t.style.whiteSpace,t.style.textWrapping),i.content=t.content,i.breakWord=Sp(t.style.textWrapping),i.textAlign=bp(t.style.textAlign),i.color=t.style.color,i.italic=t.style.italic,i.bold=t.style.bold,i.fontSize=t.style.fontSize,i.fontFamily=t.style.fontFamily,i.textOverflow=t.style.textOverflow,i.textWrapping=t.style.textWrapping,i.textDecoration=t.style.textDecoration,i.doWrap=t.doWrap,i.wrapBounds=t.wrapBounds,i.childNodes=t.childNodes,i.isHorizontalLane=t.isLaneOrientation,i.id=t.id||q(),t.isLaneOrientation&&(i.parentOffsetX=this.groupElement.offsetX,i.parentOffsetY=this.groupElement.offsetY,i.parentWidth=this.groupElement.actualSize.width,i.parentHeight=this.groupElement.actualSize.height),i.dashArray="",i.strokeWidth=0,i.fill=t.style.fill,o=t.description||t.content||t.id;("Wrap"===t.style.textWrapping||"WrapWithOverflow"===t.style.textWrapping)&&this.groupElement&&i.height>this.groupElement.actualSize.height&&("Clip"===t.style.textOverflow||"Ellipsis"===t.style.textOverflow)&&(i.y=i.y+(i.height-this.groupElement.actualSize.height)/2),this.renderer.drawRectangle(e,i,this.diagramId,void 0,void 0,n),this.renderer.drawText(e,i,n,o,this.diagramId,t.isExport&&Math.min(t.exportScaleValue.x||t.exportScaleValue.y),this,t),this.isSvgMode&&(t.doWrap=!1)},o.prototype.renderNativeElement=function(t,e,i,n,r){var o,a,s=this.getParentSvg(t,void 0,e)||n,h=this.getParentElement(t,e,s).g||e,i=this.getBaseAttributes(t,i);switch(i.fill="transparent",i.cornerRadius=t.cornerRadius,i.stroke="transparent",this.renderer.drawRectangle(e,i,this.diagramId,void 0,void 0,n),t.scale){case"None":o=t.contentSize.width,a=t.contentSize.height;break;case"Stretch":o=t.actualSize.width,a=t.actualSize.height;break;case"Meet":o=a=t.actualSize.width<=t.actualSize.height?t.actualSize.width:t.actualSize.height;break;case"Slice":o=a=t.actualSize.width>=t.actualSize.height?t.actualSize.width:t.actualSize.height}this.svgRenderer&&this.svgRenderer.drawNativeContent(t,h,a,o,s)},o.prototype.renderHTMLElement=function(t,e,i,n,r,o,a){var s=this.getBaseAttributes(t,n);s.fill="transparent",s.cornerRadius=t.cornerRadius,s.stroke="transparent",this.renderer.drawRectangle(e,s,this.diagramId,void 0,void 0,r),this.svgRenderer&&this.svgRenderer.drawHTMLContent(t,i.children[0],n,oh(i),a)},o.prototype.renderImageElement=function(t,e,i,n,r){var o,a,s,h,d,l=this.getBaseAttributes(t,i),c=(l.cornerRadius=0,this.renderer.drawRectangle(e,l,this.diagramId,void 0,void 0,n),t.contentSize.width),p=t.contentSize.height,g=l.width/c,u=l.height/p;if("Stretch"===t.stretch)o=c*(d=Math.min(g,u)),a=p*d;else switch(t.stretch){case"Meet":o=c*(d=Math.min(g,u)),a=p*d,l.x+=Math.abs(l.width-o)/2,l.y+=Math.abs(l.height-a)/2;break;case"Slice":d=Math.max(g,u),s=l.width/(o=c*d)*c,h=l.height/(a=p*d)*p;break;case"None":o=c,a=p}l.width=o,l.height=a,l.sourceWidth=s,l.sourceHeight=h,l.source=t.source,l.alignment=t.imageAlign,l.scale=t.imageScale,l.description=t.description||t.id,this.renderer.drawImage(e,l,n,r,this,t)},o.prototype.renderContainer=function(t,e,i,n,r,o,a,s,h,d,l){var c,p={svg:r,g:e},g=document.getElementById(this.diagramId);if(g&&(c=g.ej2_instances[0]),this.diagramId&&(r=this.getParentSvg(t)||r,this.isSvgMode)&&(g=this.getParentElement(t,e,r,s).g||e,r=this.getParentSvg(this.hasNativeParent(t.children))||r,b=this.getParentElement(this.hasNativeParent(t.children),g,r,s),p.svg=b.svg||r,p.g=b.g||g,e=(o&&r&&!r.getElementById(p.g.id)&&e.appendChild(p.g),p.g)),this.renderRect(t,e,n,r),(this.groupElement=t).hasChildren()){for(var u=void 0,m=0,f=t.children;m<f.length;m++){var y=f[m],v=(this.groupElement=t,r=this.getParentSvg(this.hasNativeParent(t.children)||y)||r,this.isSvgMode&&(u=(v=this.getParentElement(this.hasNativeParent(t.children)||y,e,r)).g||e,v.svg)&&(r=v.svg),this.isSvgMode||"Object"===y.relativeMode&&(y.flip=t.flip,y.id)&&(y.id.includes("_0_compensation")||y.id.includes("_0_adhoc"))&&t.children[0].flip&&(y.flip=t.children[0].flip),u);this.renderElement(y,u||e,i,n,r,!0,a,s,h,d,l),t.children&&t.children[0]instanceof be&&(y instanceof H||y.elementActions&Z.ElementAction.ElementIsPort)&&(v=document.getElementById(y.id+"_groupElement")),y instanceof H&&v&&this.renderFlipTextElement(t,v,y,y.flip,y.flipMode)}var b=void 0,g=(c&&c.selectedItems&&c.selectedItems.nodes&&0<c.selectedItems.nodes.length&&(b=c.selectedItems.nodes[0]),void 0),o=!1,p=t.id.includes("group_container")?t.id.split("group_container")[0]:t.id,S=((b=S=c&&c.selectedItems?c.getObject(p):S)&&b.flipMode&&(o=!0),"");b&&(S=b.children?b.id+"group_container":b.id+"_content_groupElement"),c instanceof ru&&c.nameTable[""+p]&&"connectors"!==c.nameTable[""+p].propName&&o&&b&&(g=t.children&&t.children[0]instanceof be?document.getElementById(b.id+"_content_inner_native_element"):t.children&&t.children[0]instanceof an&&(g=document.getElementById(b.id+"_content_html_element"))||document.getElementById(S),this.renderFlipElement(t,g,t.flip))}},o.prototype.renderFlipTextElement=function(t,e,i,n,r,o){var a,s,h,d={},l=1,c=1,p=0,g=0,u=0,m=0;return n!==Z.FlipDirection.None?(s=t.rotateAngle,0===t.rotateAngle&&t.id.includes("group_container")&&(s=t.parentTransform),(a=(a=i.getAbsolutePosition(i.desiredSize))?a:{x:.5*(h=i.desiredSize).width,y:.5*h.height})&&""!==i.content&&("All"===r||"LabelAndLabelText"===r?(n!==Z.FlipDirection.Horizontal&&n!==Z.FlipDirection.Both||(p=t.bounds.center.x,u=-t.bounds.center.x,l=-1),n!==Z.FlipDirection.Vertical&&n!==Z.FlipDirection.Both||(g=t.bounds.center.y,m=-t.bounds.center.y,c=-1),n!==Z.FlipDirection.Horizontal&&n!==Z.FlipDirection.Vertical||(h=Math.sin(s*Math.PI/180),void 0===a.y||isNaN(a.y)||(s=a.y/i.desiredSize.height,isNaN(s))||(u+=-t.desiredSize.height*h*(-2*s+1)),void 0===a.x)||isNaN(a.x)||(s=a.x/i.desiredSize.width,isNaN(s))||(m+=t.desiredSize.width*h*(-2*s+1)),d={transform:"translate("+p+","+g+") scale("+l+","+c+") translate("+u+","+m+")"}):"LabelText"===r||"PortAndLabelText"===r?(n!==Z.FlipDirection.Horizontal&&n!==Z.FlipDirection.Both||(p=i.offsetX,u=-i.offsetX,l=-1),n!==Z.FlipDirection.Vertical&&n!==Z.FlipDirection.Both||(g=i.offsetY,m=-i.offsetY,c=-1),d={transform:"translate("+p+","+g+") scale("+l+","+c+") translate("+u+","+m+")"}):"PortAndLabel"!==r&&"Label"!==r||(0,d={transform:"translate("+((h=this.flipLabel(t,i,a,n)).x-i.offsetX)+","+(h.y-i.offsetY)+")"}))):d={transform:"translate(0,0)"},o?d:(this.setFlipAttributes(t,e,d,l,c,!1),{})},o.prototype.renderFlipElement=function(t,e,i,n){var r={},o=1,a=1,s=0,h=0,d=0,l=0,r=i!==Z.FlipDirection.None?(i!==Z.FlipDirection.Horizontal&&i!==Z.FlipDirection.Both||(s=t.bounds.center.x,d=-t.bounds.center.x,o=-1),i!==Z.FlipDirection.Vertical&&i!==Z.FlipDirection.Both||(h=t.bounds.center.y,l=-t.bounds.center.y,a=-1),{transform:"translate("+s+","+h+") scale("+o+","+a+") translate("+d+","+l+")"}):{transform:"translate(0,0)"},i=t&&t.children&&t.children.length&&t.children[0]instanceof an;return n?r:(this.setFlipAttributes(t,e,r,o,a,i),{})},o.prototype.setFlipAttributes=function(t,e,i,n,r,o){i&&(o?(o=e.id.split("_preview"),e=(document.getElementById(o[0]+"_html_div")||$c(this.diagramId).children[0]).querySelector("#"+t.id+"_content_html_element"),o=t.flip===Z.FlipDirection.None||t.flip===Z.FlipDirection.Both?1:-1,e&&(e.style.transform="scale("+n+","+r+")rotate("+(o*t.rotateAngle+t.parentTransform)+"deg)")):ap(e,i))},o.prototype.flipLabel=function(t,e,i,n){var r,o,a,s;return n!==Z.FlipDirection.None&&(s=a=void 0,r=t.offsetX-t.desiredSize.width/2,o=t.offsetY-t.desiredSize.height/2,a=r+t.desiredSize.width*(i.x/e.desiredSize.width),s=o+t.desiredSize.height*(i.y/e.desiredSize.height),n!==Z.FlipDirection.Both&&n!==Z.FlipDirection.Horizontal||(a=r+t.desiredSize.width*(1-i.x/e.desiredSize.width)),n!==Z.FlipDirection.Both&&n!==Z.FlipDirection.Vertical||(s=o+t.desiredSize.height*(1-i.y/e.desiredSize.height)),r=Ap(t.rotateAngle+t.parentTransform,t.offsetX,t.offsetY,r={x:a,y:s})),r},o.prototype.hasNativeParent=function(t,e){if(t&&0<t.length){t=t[0];if(t instanceof be)return t;t.children&&t.children.length&&this.hasNativeParent(t.children,e++||0)}},o.prototype.renderRect=function(t,e,i,n,r){i=this.getBaseAttributes(t,i,r),i.cornerRadius=t.cornerRadius||0,t.isExport&&(i.cornerRadius*=t.exportScaleValue.x),r=t.description||t.id;this.renderer.drawRectangle(e,i,this.diagramId,t.isExport,void 0,n,r,void 0,void 0,this,t)},o.prototype.drawRect=function(t,e){e.cornerRadius=0,this.svgRenderer.drawRectangle(t,e,this.diagramId)},o.prototype.getBaseAttributes=function(t,e,i){var n={width:t.actualSize.width,height:t.actualSize.height,x:t.offsetX-t.actualSize.width*t.pivot.x,y:t.offsetY-t.actualSize.height*t.pivot.y,fill:t.style.fill,stroke:t.style.strokeColor,angle:t.rotateAngle+t.parentTransform,pivotX:t.pivot.x,pivotY:t.pivot.y,strokeWidth:t.style.strokeWidth,dashArray:t.style.strokeDashArray||"",opacity:t.style.opacity,shadow:t.shadow,gradient:t.style.gradient,visible:t.visible,id:t.id,description:t.description,canApplyStyle:t.canApplyStyle,shapeType:t.shapeType};return"Page"===t.rotationReference&&(n.angle=t.rotateAngle),i&&(n.x=n.x-.5,n.y=n.y-.5),t.isExport&&(n.width*=t.exportScaleValue.x,n.height*=t.exportScaleValue.y,n.x*=t.exportScaleValue.x,n.y*=t.exportScaleValue.y,n.strokeWidth*=t.exportScaleValue.x),t.flip&&(n.flip=t.flip,t.flip===Z.FlipDirection.Horizontal||t.flip===Z.FlipDirection.Vertical)&&t instanceof le&&!this.isSvgMode&&(n.isImage=!0),t.flipMode&&(n.flipMode=t.flipMode),e&&(n.x+=e.tx,n.y+=e.ty),n},o.renderSvgBackGroundImage=function(t,e,i,n,r,o){var a,s;t.source&&((a=qc(e.id).getElementById(e.id+"_image"))||(s=function(t){t=Y(t).getElementsByClassName("e-background-image-layer");return t[0]}(e.id),(a=document.createElementNS("http://www.w3.org/2000/svg","image")).setAttribute("id",e.id+"_image"),s.appendChild(a)),(s=new Image).src=t.source,a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",s.src.toString()),s="None"!==t.scale?t.scale:"",t=(t=t.align).charAt(0).toLowerCase()+t.slice(1),s&&(t+=" "+s.charAt(0).toLowerCase()+s.slice(1)),ap(a,{id:e.id+"_image",x:i,y:n,width:r,height:o,preserveAspectRatio:t}))},o.prototype.transformLayers=function(t,e){var i=t.tx*t.scale,n=t.ty*t.scale,r="domTable";return(i!==this.transform.x||n!==this.transform.y||0==i||0==n)&&(e&&(window[r][this.diagramId+"_diagramLayer"]||(window[r][this.diagramId+"_diagramLayer"]=this.diagramSvgLayer.getElementById(this.diagramId+"_diagramLayer")),window[r][this.diagramId+"_diagramLayer"].setAttribute("transform","translate("+t.tx*t.scale+","+t.ty*t.scale+"),scale("+t.scale+")")),function(t){var e="domTable",i=null;{var n;window[e][t+"_gridline"]?i=window[e][t+"_gridline"]:(n=Kc(t),i=n.getElementById(t+"_gridline"),window[e][t+"_gridline"]=i)}return i}(this.diagramId).setAttribute("transform","translate("+t.tx*t.scale+","+t.ty*t.scale+")"),window[r][this.diagramId+"_diagramPorts"]||(window[r][this.diagramId+"_diagramPorts"]=this.iconSvgLayer.getElementById(this.diagramId+"_diagramPorts")),window[r][this.diagramId+"_diagramPorts"].setAttribute("transform","translate("+t.tx*t.scale+","+t.ty*t.scale+"),scale("+t.scale+")"),window[r][this.diagramId+"_diagramExpander"]||(window[r][this.diagramId+"_diagramExpander"]=this.iconSvgLayer.getElementById(this.diagramId+"_diagramExpander")),window[r][this.diagramId+"_diagramExpander"].setAttribute("transform","translate("+t.tx*t.scale+","+t.ty*t.scale+"),scale("+t.scale+")"),window[r][this.diagramId+"_nativeLayer"]||(window[r][this.diagramId+"_nativeLayer"]=this.nativeSvgLayer.getElementById(this.diagramId+"_nativeLayer")),window[r][this.diagramId+"_nativeLayer"].setAttribute("transform","translate("+t.tx*t.scale+","+t.ty*t.scale+"),scale("+t.scale+")"),$c(this.diagramId).children[0].style.transform="translate("+t.tx*t.scale+"px,"+t.ty*t.scale+"px)scale("+t.scale+")",this.transform={x:t.tx*t.scale,y:t.ty*t.scale},!0)},o.prototype.updateNode=function(t,e,i,n,r,o,a){this.renderElement(t,e,i,n,this.getParentSvg(t),void 0,void 0,r,null,o,a)};var Fs=o;function o(t,e,i){this.renderer=null,this.isSvgMode=!0,this.touchMove=void 0,this.transform={x:0,y:0},this.diagramId=t,this.element=Y(this.diagramId),this.svgRenderer=e,this.isSvgMode=i,this.renderer=new(i?Xs:Op)}Us=function(t,e){return(Us=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)};var Us,Gs,n=function(t,e){function i(){this.constructor=t}Us(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},a=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;0<=s;s--)(r=t[s])&&(a=(o<3?r(a):3<o?r(e,i,a):r(e,i))||a);return 3<o&&a&&Object.defineProperty(e,i,a),a},Zs=(Gs=N.Component,n(s,Gs),s.prototype.onPropertyChanged=function(t,e){for(var i=0,n=Object.keys(t);i<n.length;i++)switch(n[i]){case"sourceID":this.setParent(t.sourceID);break;case"width":case"height":this.renderCanvas(),this.setParent(this.sourceID)}},s.prototype.getPersistData=function(){return this.addOnPersist(["loaded"])},s.prototype.preRender=function(){var t;""===this.element.id&&(t=document.getElementsByClassName("e-overview").length,this.element.id="overview_"+this.overviewid+"_"+t),this.id=this.element.id||this.id,this.element.style.background="transparent",this.unWireEvents(),this.wireEvents(),this.element.classList.add("e-overview")},s.prototype.render=function(){this.diagramRenderer=new Fs(this.element.id,new Xs,!1),this.renderCanvas(),this.setParent(this.sourceID),this.renderComplete()},s.prototype.getSizeValue=function(t){t=0<t.toString().indexOf("px")||0<t.toString().indexOf("%")?t.toString():t.toString()+"px";return t},s.prototype.renderCanvas=function(t){var e=document.getElementById(this.element.id+"_canvas"),i=(e||(e=A("div",{}),this.element.appendChild(e)),{id:this.element.id+"_canvas",class:"drawing",style:"position:relative; height:"+this.getSizeValue(this.model.height)+"; width:"+this.getSizeValue(this.model.width)+";style:-ms-touch-action: none;touch-action: none;"});hp(e,i),this.element.setAttribute("tabindex",String(-1)),this.element.style.overflow="hidden",this.element.style.height=String(this.model.height),this.element.style.width=String(this.model.width),this.canvas=e},s.prototype.setParent=function(t){var e,t=document.getElementById(t);this.parent&&(e=this.parent,this.parent=null,e.setOverview(null,this.element.id),this.removeDocument(this)),this.parent=this.getDiagram(t,"ej2_instances"),this.parent&&this.parent.setOverview(this)},s.prototype.getDiagram=function(t,e){for(var i,n=t[""+e].length,r=0;r<n;r++)if(ip(t[""+e][parseInt(r.toString(),10)].element,"e-diagram")){i=t[""+e][parseInt(r.toString(),10)];break}return i},s.prototype.unWireEvents=function(){var t=N.Browser.touchStartEvent,e=N.Browser.touchMoveEvent,i=N.Browser.isPointer?"pointerleave":"mouseleave",n=N.Browser.touchEndEvent,t=(N.EventHandler.remove(this.element,t,this.mouseDown),N.EventHandler.remove(this.element,e,this.mouseMove),N.EventHandler.remove(this.element,n,this.mouseUp),N.EventHandler.remove(this.element,i,this.documentMouseUp),N.EventHandler.remove(window,"resize",this.windowResize),document.getElementById(this.sourceID+"content"));t&&N.EventHandler.remove(t,"scroll",this.scrolled)},s.prototype.wireEvents=function(){var t=N.Browser.touchStartEvent,e=N.Browser.touchEndEvent,i=N.Browser.touchMoveEvent,n=N.Browser.isPointer?"pointerleave":"mouseleave",t=(N.EventHandler.add(this.element,t,this.mouseDown,this),N.EventHandler.add(this.element,i,this.mouseMove,this),N.EventHandler.add(this.element,e,this.mouseUp,this),N.EventHandler.add(this.element,n,this.documentMouseUp,this),N.EventHandler.add(window,"resize",this.windowResize,this),document.getElementById(this.sourceID+"content"));t&&N.EventHandler.add(t,"scroll",this.scrolled,this)},s.prototype.renderDocument=function(t){t.canvas=this.canvas;var e=document.getElementById(this.canvas.id+"_svg");e&&e.parentNode.removeChild(e);e=tp("svg",{id:this.canvas.id+"_svg",version:"1.1",class:"overview_svg"});this.svg=e,t.svg=e,t.canvas.appendChild(e);var i=document.getElementById(this.element.id),n=i.clientWidth||i.offsetWidth,r=i.clientHeight||i.offsetHeight,i=i.getBoundingClientRect(),o=window.screenX<0?-1*window.screenX:window.screenX,a=window.screenY<0?-1*window.screenY:window.screenY,a=(0===n&&(n=0<(o=Math.floor(window.innerWidth-o-Math.floor(i.left)))?o:Math.floor(window.innerWidth)),0===r&&(r=0<(o=Math.floor(window.innerHeight-a-Math.floor(i.top)))?o:Math.floor(window.innerHeight)),0<n&&(e.setAttribute("width",String(n)),this.model.height=r),0<r&&(e.setAttribute("height",String(r)),this.model.width=n),t.diagramLayerDiv||(t.diagramLayerDiv=A("div",{}),t.diagramLayer=Op.createCanvas(this.element.id+"_diagramLayer",this.model.width,this.model.height),t.diagramLayer.style.position="absolute",t.diagramLayer.style.left="0px",t.diagramLayer.style.top="0px",t.diagramLayerDiv.appendChild(t.diagramLayer),t.canvas.appendChild(t.diagramLayerDiv)),{id:this.element.id+"_diagramLayer_div",style:"width:"+this.model.width+"px; height:"+this.model.height+"px;position:absolute;top:0px;left:0px"});hp(t.diagramLayerDiv,a),this.renderHtmlLayer(t.canvas),this.renderNativeLayer(t.canvas,t),this.addOverviewRectPanel(t)},s.prototype.removeDocument=function(t){var e=document.getElementById(this.canvas.id+"_svg"),e=(this.canvas.removeChild(e),document.getElementById(this.element.id+"_htmlLayer")),e=(this.canvas.removeChild(e),document.getElementById(this.element.id+"_diagramLayer_div"));this.canvas.removeChild(e),t.diagramLayerDiv=null,t.diagramLayer=null;window.domTable[this.id+"html_layer"]=null},s.prototype.renderHtmlLayer=function(t){var e=A("div",{id:this.element.id+"_htmlLayer",class:"e-html-layer",style:"pointer-events:none;position:absolute;top:0px;left:0px;"}),i=A("div",{id:this.element.id+"_htmlLayer_div",style:"position:absolute;top:0px;left:0px;"});return e.appendChild(i),t.appendChild(e),e},s.prototype.renderNativeLayer=function(t,e){var i,n;document.getElementById(this.element.id+"_nativeLayer_svg")||(i=this.parent.createSvg(this.element.id+"_nativeLayer_svg",this.model.width,this.model.height),n=tp("g",{id:this.element.id+"_nativeLayer"}),i.appendChild(n),e.diagramLayerDiv.appendChild(i),ap(i,{class:"e-native-layer"}))},s.prototype.addOverviewRectPanel=function(t){(e=document.getElementById(this.canvas.id+"_overviewsvg"))&&e.parentNode.removeChild(e);var e=tp("svg",{id:this.canvas.id+"_overviewsvg",class:"overviewsvg",version:"1.1",style:"position:absolute;left:0px;top:0px; aria-label:Specifies overview",width:this.model.width,height:this.model.height}),t=(t.canvas.appendChild(e),tp("g",{id:this.element.id+"_overviewlayer",style:"pointer-events:none"})),e=(e.appendChild(t),tp("rect",{fill:"transparent",width:"100%",height:"100%",class:"overviewbackrect",id:this.canvas.id+"overviewbackrect"})),e=(e.style.pointerEvents="none",t.appendChild(e),tp("g",{id:this.canvas.id+"overviewhandle",style:"pointer-events:all"})),t=(t.appendChild(e),tp("rect",{id:this.canvas.id+"overviewrect",fill:"transparent"}));e.appendChild(t),this.renderOverviewCorner("left",e),this.renderOverviewCorner("right",e),this.renderOverviewCorner("top",e),this.renderOverviewCorner("bottom",e),this.renderOverviewCorner("topleft",e),this.renderOverviewCorner("topright",e),this.renderOverviewCorner("bottomleft",e),this.renderOverviewCorner("bottomright",e)},s.prototype.renderOverviewCorner=function(t,e){this.svg;var i="top"===t||"bottom"===t||"right"===t||"left"===t?"rect":"circle",n=tp(i,{id:this.canvas.id+"visible"+t,class:"overview-resizer"}),n=(e.appendChild(n),tp(i,{id:this.canvas.id+t,class:"overviewresizer",fill:"transparent"}));e.appendChild(n)},s.prototype.updateOverviewRectangle=function(){var t=this.currentPoint.x-this.prevPoint.x,e=this.currentPoint.y-this.prevPoint.y,i=new j,n=(i.width=0,i.height=0),r=0;switch(this.resizeDirection){case"left":i.width-=t,i.height-=t/this.viewPortRatio,r=(n=t)/this.viewPortRatio,r/=2;break;case"right":i.width+=t,i.height+=t/this.viewPortRatio,r=t/this.viewPortRatio,r/=-2;break;case"top":i.height-=e,i.width-=e*this.viewPortRatio,n=(r=e)*this.viewPortRatio,n/=2;break;case"bottom":i.height+=e,i.width+=e*this.viewPortRatio,n=e*this.viewPortRatio,n/=-2;break;case"topleft":Math.abs(e)>Math.abs(t)?t=e*this.viewPortRatio:e=t/this.viewPortRatio,i.width-=t,i.height-=e,n=t,r=e;break;case"topright":Math.abs(e)>Math.abs(t)?t=-e*this.viewPortRatio:e=-(t/this.viewPortRatio),r=e,i.width+=t,i.height-=e;break;case"bottomleft":Math.abs(e)>Math.abs(t)?t=-e*this.viewPortRatio:e=-t/this.viewPortRatio,n=t,i.width-=t,i.height+=e;break;case"bottomright":Math.abs(e)>Math.abs(t)?t=e*this.viewPortRatio:e=t/this.viewPortRatio,i.width+=t,i.height+=e}this.updateHelper(n,r,i,void 0,void 0)},s.prototype.updateHelper=function(t,e,i,n,r){var o,a,s,h=this.element.getElementsByTagName("svg")[2].getElementById("helper");r=i?(o=(s=h.getBBox()).x+t,a=s.y+e,n=s.width+i.width,s.height+i.height):(t=this.currentPoint.x>this.startPoint.x?this.currentPoint.x-this.prevPoint.x:this.prevPoint.x-this.currentPoint.x,e=this.currentPoint.y>this.startPoint.y?this.currentPoint.y-this.prevPoint.y:this.prevPoint.y-this.currentPoint.y,Math.abs(e)>Math.abs(t)?t=this.viewPortRatio*e:e=t/this.viewPortRatio,s=h.getBBox(),o=this.startPoint.x>this.currentPoint.x?s.x-t:s.x,a=this.startPoint.y>this.currentPoint.y?s.y-e:s.y,n=s.width+t,s.height+e),ap(this.helper,{id:this.helper.id,x:o,y:a,width:Math.max(0,n),height:Math.max(0,r)})},s.prototype.updateOverviewrect=function(t,e,i,n){hp(document.getElementById(this.canvas.id+"overviewrect"),{x:t,y:e,width:Math.max(1,i),height:Math.max(1,n)}),this.updateOverviewCorner("top",t+8,e+1,Math.max(0,i-16),2),this.updateOverviewCorner("bottom",t+8,e+n+3,Math.max(0,i-16),2),this.updateOverviewCorner("left",t-2,e+11,2,Math.max(0,n-16)),this.updateOverviewCorner("right",t+i,e+11,2,Math.max(0,n-16)),this.updateOverviewCorner("topleft",t,e+3,5,5),this.updateOverviewCorner("topright",t+i,e+3,5,5),this.updateOverviewCorner("bottomleft",t,e+n+3,5,5),this.updateOverviewCorner("bottomright",t+i,e+n+3,5,5)},s.prototype.updateOverviewCorner=function(t,e,i,n,r){var o,n="top"===t||"bottom"===t||"right"===t||"left"===t?(o={x:e,y:i,width:n,height:r,fill:"#ED1C24"},{x:e-2,y:i-2,width:2===n?4:n,height:2===r?4:r}):(o={cx:e,cy:i,r:4,fill:"#ED1C24"},{cx:e,cy:i,r:6,fill:"transparent"});hp(document.getElementById(this.canvas.id+("visible"+t)),o),hp(document.getElementById(this.canvas.id+t),n)},s.prototype.translateOverviewRectangle=function(){Number(this.model.width),Number(this.model.height);var t=this.currentPoint.x-this.prevPoint.x,e=this.currentPoint.y-this.prevPoint.y,i=this.element.getElementsByClassName("overviewsvg")[0].getElementById(this.canvas.id+"overviewrect").getBBox(),t=i.x+t,e=i.y+e,n=i.width,i=i.height;this.updateOverviewrect(t,e,n,i),this.updateParentView(this.parent.scroller.currentZoom,t,e,n,i,null)},s.prototype.renderOverviewRect=function(t,e,i,n){var r=Number(this.model.width),o=Number(this.model.height),r=i/r*this.contentWidth,o=n/o*this.contentHeight,r=Math.max(this.parent.scroller.viewPortWidth/r,this.parent.scroller.viewPortHeight/o);.25<=r&&r<=30&&(this.updateParentView(r,t,e,i,n,{x:0,y:0}),o=this.scrollOverviewRect(this.parent.scroller.horizontalOffset,this.parent.scroller.verticalOffset,this.parent.scroller.currentZoom,!0),this.helper&&(r=this.element.getElementsByTagName("rect")[10].getBBox(),o.x=r.x,o.y=r.y),"pan"===this.actionName?this.updateOverviewrect(-o.x,-o.y,o.width,o.height):this.updateOverviewrect(o.x,o.y,o.width,o.height))},s.prototype.scrollOverviewRect=function(t,e,i,n){if(!this.actionName||n){var r=Number(this.model.width),o=Number(this.model.height),r=Math.min(this.contentWidth/r,this.contentHeight/o),o=new k,t=o.x=t/i/r,e=o.y=e/i/r,a=0,s=(this.parent.rulerSettings.showRulers&&(a=25),document.getElementById(this.parent.element.id+"content")),h=0,d=0,s=(s&&(h=s.offsetWidth-s.clientWidth,d=s.offsetHeight-s.clientHeight),o.width=(this.parent.scroller.viewPortWidth-a-h)/i/r),h=o.height=(this.parent.scroller.viewPortHeight-a-d)/i/r;if(n)return(o=new k).x=t,o.y=e,o.width=s,o.height=h,o;this.updateOverviewrect(-t,-e,s,h)}return null},s.prototype.updateParentView=function(t,e,i,n,r,o){var a,s,h=Number(this.model.width),d=Number(this.model.height),e=e*(this.contentWidth/h)*t,h=i*(this.contentHeight/d)*t;this.parent.scroller.getPageBounds(),1===t&&"pan"!==this.actionName||(a=-e-this.parent.scroller.horizontalOffset,s=-h-this.parent.scroller.verticalOffset),this.parent.setBlazorDiagramProps(!0),this.parent.realActions|=Z.RealAction.OverViewAction;"scale"===this.actionName||"draw"===this.actionName?this.parent.scroller.zoom(t/this.parent.scroller.currentZoom,a,s,o):N.isBlazor()?this.parent.scroller.zoom(1,a,s,o):this.parent.pan(a,s,o,!0)},s.prototype.updateHtmlLayer=function(t){var t=$c(t.element.id),e=this.parent.scroller.getPageBounds(!0),i=e.width,e=e.height,i=Math.max(i,this.parent.scroller.viewPortWidth),e=Math.max(e,this.parent.scroller.viewPortHeight/this.parent.scroller.currentZoom),i=Math.min(Number(this.model.width)/i,Number(this.model.height)/e);t.style.transform="scale("+i+") translate("+this.parent.scroller.transform.tx+"px,"+this.parent.scroller.transform.ty+"px)"},s.prototype.updateView=function(t){var e=this.parent.scroller.getPageBounds(),i=e.width,n=e.height,r=Number(this.model.width),o=Number(this.model.height),i=Math.max(i,this.parent.scroller.viewPortWidth),n=Math.max(n,this.parent.scroller.viewPortHeight),r=(this.contentWidth=i=Math.max(i,r/o*n),this.contentHeight=n=Math.max(n,o/r*i),Math.min(r/i,o/n)),i=document.getElementById(this.element.id+"_htmlLayer");i.style.webkitTransform="scale("+r+") translate("+-e.x+"px,"+-e.y+"px)",i.style.transform="scale("+r+") translate("+-e.x+"px,"+-e.y+"px)";document.getElementById(this.element.id+"_overviewlayer").setAttribute("transform","translate("+-e.x*r+","+-e.y*r+")"),this.horizontalOffset=e.x*r,this.verticalOffset=e.y*r;var o=document.getElementById(this.element.id+"_diagramLayer"),n=Jc(this.element.id),i=o.getContext("2d"),e=Number(this.model.width)/this.contentWidth,r=Number(this.model.height)/this.contentHeight,e=Math.min(e,r),o=this.parent.scroller.transform,a=o.tx,o=o.ty;n.setAttribute("transform","translate("+a*e+","+o*r+"),scale("+e+")"),i.setTransform(e,0,0,e,0,0),i.fillStyle="red",this.scrollOverviewRect(this.parent.scroller.horizontalOffset,this.parent.scroller.verticalOffset,this.parent.scroller.currentZoom)},s.prototype.scrolled=function(t){var e;this.event&&(e=this.scrollOverviewRect(this.parent.scroller.horizontalOffset,this.parent.scroller.verticalOffset,this.parent.scroller.currentZoom,!0),this.updateOverviewrect(-e.x,-e.y,e.width,e.height),this.updateView(this))},s.prototype.updateCursor=function(t){if(ip(t.target,"overviewresizer"))switch(t.target.id){case this.canvas.id+"left":this.canvas.style.cursor="w-resize";break;case this.canvas.id+"right":this.canvas.style.cursor="e-resize";break;case this.canvas.id+"top":this.canvas.style.cursor="n-resize";break;case this.canvas.id+"bottom":this.canvas.style.cursor="s-resize";break;case this.canvas.id+"topleft":this.canvas.style.cursor="nw-resize";break;case this.canvas.id+"topright":this.canvas.style.cursor="ne-resize";break;case this.canvas.id+"bottomleft":this.canvas.style.cursor="sw-resize";break;case this.canvas.id+"bottomright":this.canvas.style.cursor="se-resize"}else this.canvas.style.cursor="default"},s.prototype.mouseMove=function(t){if(this.event=!1,this.updateCursor(t),this.currentPoint=this.mousePosition(t),this.actionName)switch(this.actionName){case"draw":this.inAction||this.startPoint.x===this.currentPoint.x&&this.startPoint.y===this.currentPoint.y||(this.initHelper(),this.inAction=!0),this.inAction&&this.updateHelper();break;case"scale":this.inAction||(this.initHelper(),this.inAction=!0),this.updateOverviewRectangle();break;case"pan":this.startPoint.x===this.currentPoint.x&&this.startPoint.y!==this.currentPoint.y&&!this.inAction||(this.inAction=!0,this.translateOverviewRectangle())}this.prevPoint=this.currentPoint},s.prototype.documentMouseUp=function(t){this.inAction=!1,this.actionName="",this.helper&&(this.helper.parentNode.removeChild(this.helper),this.helper=null),this.event=!0,document.getElementById(this.canvas.id+"overviewhandle").style.pointerEvents="all"},s.prototype.windowResize=function(t){var e=this;return this.resizeTo&&clearTimeout(this.resizeTo),this.resizeTo=setTimeout(function(){var t=document.getElementById(e.element.id).getBoundingClientRect();e.model.width=(0<t.width?t:e.model).width,e.model.height=(0<t.height?t:e.model).height,e.renderCanvas(),e.setParent(e.sourceID)},10),!1},s.prototype.mouseDown=function(t){if(t.target.id===this.canvas.id+"_overviewsvg"&&(this.actionName="draw"),t.target.id===this.canvas.id+"overviewrect"&&(this.actionName="pan"),ip(t.target,"overviewresizer"))switch(this.actionName="scale",t.target.id){case this.canvas.id+"left":this.resizeDirection="left";break;case this.canvas.id+"right":this.resizeDirection="right";break;case this.canvas.id+"top":this.resizeDirection="top";break;case this.canvas.id+"bottom":this.resizeDirection="bottom";break;case this.canvas.id+"topleft":this.resizeDirection="topleft";break;case this.canvas.id+"topright":this.resizeDirection="topright";break;case this.canvas.id+"bottomleft":this.resizeDirection="bottomleft";break;case this.canvas.id+"bottomright":this.resizeDirection="bottomright"}this.startPoint=this.prevPoint=this.mousePosition(t),this.viewPortRatio=this.parent.scroller.viewPortWidth/this.parent.scroller.viewPortHeight,document.getElementById(this.canvas.id+"overviewhandle").style.pointerEvents="none"},s.prototype.mouseUp=function(t){var e,i,n,r,o;this.currentPoint=this.mousePosition(t),this.actionName&&(this.startPoint.x!==this.currentPoint.x||this.startPoint.y!==this.currentPoint.y?"pan"!==this.actionName&&this.helper&&(n=this.element.getElementsByTagName("rect")[10].getBBox(),this.resizeDirection=this.resizeDirection||"",e=n.x,i=n.y,r=n.width,o=n.height,"topleft"!==this.resizeDirection&&"topright"!==this.resizeDirection&&"bottomleft"!==this.resizeDirection&&this.resizeDirection,this.renderOverviewRect(e,i,r,o)):t.target.id!==this.canvas.id+"_overviewsvg"&&"helper"!==t.target.id||(r=(n=this.element.getElementsByTagName("svg")[2].getElementById(this.canvas.id+"overviewrect").getBBox()).width,o=n.height,this.inAction=!0,this.actionName="pan",this.renderOverviewRect(this.currentPoint.x-r/2,this.currentPoint.y-o/2,r,o),this.inAction=!1)),this.helper&&(this.helper.parentNode.removeChild(this.helper),this.helper=null),this.actionName="",this.startPoint=null,this.currentPoint=null,this.prevPoint=null,this.helper=null,this.viewPortRatio=1,this.resizeDirection="",this.inAction=!1,this.event=!0,document.getElementById(this.canvas.id+"overviewhandle").style.pointerEvents="all"},s.prototype.initHelper=function(){var t=this.element.getElementsByTagName("svg")[2],e=this.startPoint.x,i=this.startPoint.y,n=1,r=1,o=("scale"===this.actionName&&(e=(o=t.getElementById(this.canvas.id+"overviewrect").getBBox()).x,i=o.y,n=o.width,r=o.height),tp("rect",{id:"helper",x:e,y:i,width:n,height:r,fill:"transparent",stroke:"gray","stroke-dasharray":"2 2","shape-rendering":"crispEdges"}));t.getElementById(this.element.id+"_overviewlayer").appendChild(o),this.helper=o},s.prototype.mousePosition=function(t){i=-1!==t.type.indexOf("touch")?(e=t.changedTouches[0].clientX,i=t.changedTouches[0].clientY,e=e-this.element.offsetLeft,i-this.element.offsetTop):(e=t.clientX,t.clientY);var e,i,t=this.element.getBoundingClientRect();return e-=t.left,i-=t.top,{x:e+this.horizontalOffset,y:i+this.verticalOffset}},s.prototype.destroy=function(){var t;this.unWireEvents(),this.notify("destroy",{}),Gs.prototype.destroy.call(this),document.getElementById(this.element.id)&&(this.element.classList.remove("e-overview"),t=document.getElementById(this.element.id+"_canvas"))&&this.element.removeChild(t),this.parent.views.splice(this.parent.views.indexOf(this.element.id),1),this.diagramLayerDiv=null,this.canvas=null,this.parent=null},s.prototype.getModuleName=function(){return"Overview"},a([N.Property("100%")],s.prototype,"width",void 0),a([N.Property("100%")],s.prototype,"height",void 0),a([N.Property("")],s.prototype,"sourceID",void 0),a([N.Event()],s.prototype,"created",void 0),s);function s(t,e){t=Gs.call(this,t,e)||this;return t.mode="Canvas",t.id="overview",t.actionName="",t.startPoint=null,t.currentPoint=null,t.prevPoint=null,t.scale=null,t.inAction=!1,t.viewPortRatio=1,t.horizontalOffset=0,t.verticalOffset=0,t.model={},t.event=!0,t.overviewid=88123,t.model={width:t.width,height:t.height},t}function Ks(t,e){for(var i=[],n=0;n<e.length;n++){var r=e[parseInt(n.toString(),10)];t.containsRect(r.wrapper.bounds)&&i.push(r)}return i}function qs(t,e){for(var i=0;i<t.length;i++)if(t[parseInt(i.toString(),10)].id===e)return!0;return!1}function Qs(t){var e;return t&&(t.type?e="Connector":t.shape&&!t.type&&(e="Node")),e}function Js(t,e){e instanceof _&&(t.shape.header||(e.shape.hasHeader=!1))}function $s(t,e,i,n){return n=e?n:void 0!==t[i-1]?t[i-1]+n:0}function th(t,e){var i=[];if(e)i=t;else{for(var n=0;n<t.length;n++)i.push(t[parseInt(n.toString(),10)]);i.push(t[i.length-2]),i.push(t[i.length-2])}return i}function eh(t){for(var e=0;e<t.ports.length;e++)t.ports[parseInt(e.toString(),10)].inEdges=[],t.ports[parseInt(e.toString(),10)].outEdges=[];return t}function ih(t,e){if(e instanceof _)switch(t.shape.shape){case"JoinNode":t.width||(e.width=20),t.height||(e.height=90),t.style&&t.style.fill||(e.style.fill="black");break;case"ForkNode":t.width||(e.width=90),t.height||(e.height=20),t.style&&t.style.fill||(e.style.fill="black");break;case"InitialNode":case"FinalNode":t.style&&t.style.fill||(e.style.fill="black")}else switch(t.shape.flow){case"Object":t.style&&t.style.strokeDashArray||(e.style.strokeDashArray="8 4"),t.style&&t.style.strokeWidth||(e.style.strokeWidth=2),t.targetDecorator&&t.targetDecorator.shape||(e.targetDecorator.shape="OpenArrow");break;case"Control":t.style&&t.style.strokeWidth||(e.style.strokeWidth=2),t.targetDecorator&&t.targetDecorator.shape||(e.targetDecorator.shape="OpenArrow"),t.sourceDecorator&&t.sourceDecorator.shape||(e.sourceDecorator.shape="None")}}function nh(t,e){switch(t.shape.type){case"Bpmn":switch(t.shape.flow){case"Sequence":("Normal"===t.shape.sequence&&"Bezier"!==t.type||"Default"===t.shape.sequence||"Conditional"===t.shape.sequence)&&(e.targetDecorator&&e.targetDecorator.style&&(e.targetDecorator.style.fill=t.targetDecorator&&t.targetDecorator.style&&t.targetDecorator.style.fill||"black"),"Conditional"===t.shape.sequence)&&e.sourceDecorator&&(e.sourceDecorator.style&&(e.sourceDecorator.style.fill=t.sourceDecorator&&t.sourceDecorator.style&&t.sourceDecorator.style.fill||"white"),e.sourceDecorator.width=t.sourceDecorator&&t.sourceDecorator.width||20,e.sourceDecorator.height=t.sourceDecorator&&t.sourceDecorator.width||10);break;case"Association":"Default"!==t.shape.association&&"Directional"!==t.shape.association&&"BiDirectional"!==t.shape.association||(e.targetDecorator&&e.targetDecorator.style&&(e.targetDecorator.style.fill=t.targetDecorator&&t.targetDecorator.style&&t.targetDecorator.style.fill||"black"),"BiDirectional"===t.shape.association&&e.sourceDecorator&&e.sourceDecorator.style&&(e.sourceDecorator.style.fill=t.sourceDecorator&&t.sourceDecorator.style&&t.sourceDecorator.style.fill||"white",e.sourceDecorator.width=t.sourceDecorator&&t.sourceDecorator.width||5,e.sourceDecorator.height=t.sourceDecorator&&t.sourceDecorator.height||10));break;case"Message":e.style&&!e.style.strokeDashArray&&(e.style.strokeDashArray=t.style&&t.style.strokeDashArray||"4 4")}break;case"UmlActivity":"Exception"!==t.shape.flow||"Directional"!==t.shape.association&&"BiDirectional"!==t.shape.association||(e.style.strokeDashArray=t.style&&t.style.strokeDashArray||"2 2");break;case"UmlClassifier":var i=!1;"Association"===t.shape.relationship?i=!0:"Inheritance"===t.shape.relationship?(e.targetDecorator&&e.targetDecorator.style&&(e.targetDecorator.style.fill=t.targetDecorator&&t.targetDecorator.style&&t.targetDecorator.style.fill||"white"),e.style&&(i=!0,e.style.strokeDashArray=t.style&&t.style.strokeDashArray||"4 4")):"Composition"===t.shape.relationship?(e.sourceDecorator&&e.sourceDecorator.style&&(e.sourceDecorator.style.fill=t.sourceDecorator&&t.sourceDecorator.style&&t.sourceDecorator.style.fill||"black"),i=!0):"Aggregation"===t.shape.relationship||void 0===t.shape.relationship?(e.sourceDecorator&&e.sourceDecorator.style&&(e.sourceDecorator.style.fill=t.sourceDecorator&&t.sourceDecorator.style&&t.sourceDecorator.style.fill||"white"),i=!0):"Dependency"===t.shape.relationship?(e.sourceDecorator&&e.sourceDecorator.style&&(e.sourceDecorator.style.fill=t.sourceDecorator&&t.sourceDecorator.style&&t.sourceDecorator.style.fill||"white"),i=!0,e.style.strokeDashArray="4 4"):"Realization"===t.shape.relationship&&(e.sourceDecorator&&e.sourceDecorator.style&&(e.sourceDecorator.style.fill=t.sourceDecorator&&t.sourceDecorator.style&&t.sourceDecorator.style.fill||"white"),i=!0),i&&(e.style.strokeWidth=t.style&&t.style.strokeWidth||2)}}function rh(t,e,i){var n=K.findLength(e,t),n=K.findLength(i,t)<n?i:e,e=K.findAngle(e,i),i=K.findAngle(n,t),t=K.findLength(n,t),e=i+2*(e-i);return{x:n.x+t*Math.cos(e*Math.PI/180),y:n.y+t*Math.sin(e*Math.PI/180)}}function oh(t){var e=t.parentElement;do{if(ip(e,"e-diagram"))return!0}while(e=e.parentElement);return!1}function ah(t,e,i){if(t&&t.children&&0<t.children.length){var n=0;if(n<t.children.length)return(t=i[t.children[parseInt(n.toString(),10)]]).shape.type===e||ah(t,e,i)}return!1}function sh(t,e,i,n,r){if(i&&(t instanceof W||t&&(t.shape&&"SwimLane"!==t.shape.type||void 0===t.shape)))for(var o=0,a=Object.keys(i);o<a.length;o++){var s=a[o],h=i[""+s];if("shape"===s&&h.type&&(t.shape={type:h.type}),h)if(Array.isArray(h)&&h.length&&0<h.length&&"annotations"!==r&&"ports"!==r)if(0<t[""+s].length)for(var d=0;d<=t[""+s].length;d++)sh(t[""+s],e?e[""+s]:void 0,i[""+s],"annotations"===s||"ports"===s?t:void 0,s);else sh(t[""+s],e?e[""+s]:void 0,i[""+s],"annotations"===s||"ports"===s?t:void 0,s);else h instanceof Object&&e&&"annotations"!==r&&"ports"!==r?sh(t[""+s],e[""+s],i[""+s]):"annotations"!==r&&"ports"!==r&&e&&!e[""+s]||!e&&t&&(t[""+s]||void 0!==t[""+s])?t[""+s]=i[""+s]:(h=void 0,"annotations"!==r&&"ports"!==r||("annotations"===r?(t[""+s]&&sh(t[""+s],e[""+s],i[""+s]),t[""+s]||(h=new(ld(n)===W?Qe:Ze)(n,"annotations",i[""+s]),n.annotations.push(h))):t[""+s]?sh(t[""+s],e[""+s],i[""+s]):(h=new Be(n,"ports",i[""+s]),n.ports.push(h))))}}function hh(t,e,i,n){if(e)for(var r=0,o=Object.keys(e);r<o.length;r++){var a=o[r],s=e[""+a];if("getAssistantDetails"===a){if(n.data.Role===e[""+a].root)for(var h=e[""+a].assistants,d=0;d<h.length;d++)for(var l=0;l<i.length;l++)i[parseInt(l.toString(),10)].data.Role===h[parseInt(d.toString(),10)]&&(t.assistants.push(i[parseInt(l.toString(),10)].id),t.children.splice(0,1))}else s&&(t[""+a]=e[""+a])}!t.hasSubTree&&e.canEnableSubTree&&(t.orientation=n.layoutInfo.orientation,t.type=n.layoutInfo.type,n.layoutInfo.offset!==t.offset)&&void 0!==n.layoutInfo.offset&&(t.offset=n.layoutInfo.offset),n.layoutInfo.hasSubTree=t.hasSubTree}function dh(t,e){for(var i="Bezier"===t.type?function(t){var e=[];if("Bezier"===t.type)for(var i=0,n=0;n<t.segments.length;n++)for(var r=t.segments[parseInt(n.toString(),10)],o=K.isEmptyPoint(r.point1)?r.bezierPoint1:r.point1,a=K.isEmptyPoint(r.point2)?r.bezierPoint2:r.point2,s=Number((t.distance(o,r.points[0])+t.distance(a,o)+t.distance(r.points[1],a))/1.5),h=0;h<s-1;h+=10)e[parseInt(i.toString(),10)]=es(0,r.points[0],K.isEmptyPoint(r.point1)?r.bezierPoint1:r.point1,K.isEmptyPoint(r.point2)?r.bezierPoint2:r.point2,r.points[1],h,s),i++;return e}(t):t.intermediatePoints,n=0;n<i.length-1;n++){var r=i[parseInt(n.toString(),10)],o=i[n+1],a=k.toBounds([r,o]);if(a.Inflate(t.hitPadding),a.containsPoint(e)){var a=rh(e,r,o),s=lh({x1:r.x,x2:o.x,y1:r.y,y2:o.y},{x1:e.x,x2:a.x,y1:e.y,y2:a.y});if(s.enabled){s=K.findLength(e,s.intersectPt);if(Math.abs(s)<t.hitPadding)return!0}else{s=k.toBounds([e,e]);if(s.Inflate(3),s.containsPoint(r)||s.containsPoint(o))return!0}if(K.equals(e,a))return!0}}if(0<t.annotations.length||0<t.ports.length)for(var h=t.wrapper.children,n=3;n<h.length;n++)if(h[parseInt(n.toString(),10)].bounds.containsPoint(e))return!0;return!1}function lh(t,e){var i={x:0,y:0},n=t,r=(e.y2-e.y1)*(n.x2-n.x1)-(e.x2-e.x1)*(n.y2-n.y1),o=(e.x2-e.x1)*(n.y1-e.y1)-(e.y2-e.y1)*(n.x1-e.x1),a=(n.x2-n.x1)*(n.y1-e.y1)-(n.y2-n.y1)*(n.x1-e.x1);return 0!=r&&(t.x1!==e.x1&&t.y1!==e.y1||t.x2!==e.x2&&t.y2!==e.y2||0!=o&&0!=a||!(0<r))&&(t=a/r,0<=(e=o/r))&&e<=1&&0<=t&&t<=1?(i.x=n.x1+e*(n.x2-n.x1),i.y=n.y1+e*(n.y2-n.y1),{enabled:!0,intersectPt:i}):{enabled:!1,intersectPt:i}}function ch(t,e,i,n){t=lh(ph(t.x,t.y,e.x,e.y),ph(i.x,i.y,n.x,n.y));return t.enabled?t.intersectPt:{x:0,y:0}}function ph(t,e,i,n){return{x1:Number(t)||0,y1:Number(e)||0,x2:Number(i)||0,y2:Number(n)||0}}function gh(t,e,i){var n=[],r={x:e.topLeft.x-(i=i||0),y:e.topLeft.y},o={x:e.topRight.x+i,y:e.topRight.y},a={x:e.bottomRight.x,y:e.bottomRight.y-i},e={x:e.bottomLeft.x,y:e.bottomLeft.y+i};return n.push(r),n.push(o),n.push(a),n.push(e),n}function uh(t,e,i,n){var r=i instanceof _?i.constraints&Z.NodeConstraints.InheritTooltip:i instanceof W?i.constraints&Z.ConnectorConstraints.InheritTooltip:i.constraints&Z.PortConstraints.InheritTooltip,o=i instanceof _?i.constraints&Z.NodeConstraints.Tooltip:i instanceof W?i.constraints&Z.ConnectorConstraints.Tooltip:i.constraints&Z.PortConstraints.ToolTip,r="Mouse"===(!r&&o?i:t).tooltip.relativeMode,o=("Mouse"===n?r=!0:"Object"===n&&(r=!1),function(t,e,i,n){var r,o={},a=document.getElementById(i.element.id);r=(t instanceof _||t instanceof W?t.wrapper:(t=i.findObjectsUnderMouse(e),t=i.findObjectUnderMouse(t,"Select",!1),t=i.findElementUnderMouse(t,e,i),t)).bounds;var s=a.getBoundingClientRect();switch(i.tooltipObject.position){case"BottomCenter":o=mh(e,r.bottomCenter,i,n,s.width/2,s.height);break;case"BottomLeft":case"LeftBottom":o=mh(e,r.bottomLeft,i,n,0,s.height);break;case"BottomRight":case"RightBottom":o=mh(e,r.bottomRight,i,n,s.width,s.height);break;case"LeftCenter":o=mh(e,r.middleLeft,i,n,0,s.height/2);break;case"LeftTop":case"TopLeft":o=mh(e,r.topLeft,i,n,0,0);break;case"RightCenter":o=mh(e,r.middleRight,i,n,s.width,s.height/2);break;case"RightTop":case"TopRight":o=mh(e,r.topRight,i,n,s.width,0);break;case"TopCenter":o=mh(e,r.topCenter,i,n,s.width/2,0)}return o}(i,e,t,r)),n=xs(t);return{x:o.x+n.width,y:o.y+n.height}}function mh(t,e,i,n,r,o){var a={},s=i.scroller.transform.scale,h=i.scroller.horizontalOffset,d=i.scroller.verticalOffset,h=i.modifyClientOffset(h,!0),d=i.modifyClientOffset(d,!0);return a.x=(n?t:e).x*s+h-r,a.y=(n?t:e).y*s+d-o,a}function fh(t,e){var i=new P;return i.data=t.pathData,i.height=10<t.height?t.height-(t.padding.bottom+t.padding.top):t.height,i.width=10<t.width?t.width-(t.padding.left+t.padding.right):t.width,i.visible=t.visibility,i.id=e.id+"_shape",i.inversedAlignment=!1,i.horizontalAlignment="Center",i.verticalAlignment="Center",i.style={fill:t.iconStrokeColor,strokeColor:t.iconStrokeColor,strokeWidth:t.iconStrokeWidth},i.setOffsetWithRespectToBounds(.5,.5,"Fraction"),i.relativeMode="Object",i.description=e.description||"",i}function yh(t,e){for(var i,n=0,r=0,n=0;n<t.length;n++)for(var o=up(t[parseInt(n.toString(),10)].wrapper),r=n+1;r<t.length;r++){var a=up(t[parseInt(r.toString(),10)].wrapper);"Top"===e||"Bottom"===e||"BottomToTop"===e||"Middle"===e?o.center.y>a.center.y&&(i=t[parseInt(n.toString(),10)],t[parseInt(n.toString(),10)]=t[parseInt(r.toString(),10)],t[parseInt(r.toString(),10)]=i):o.center.x>a.center.x&&(i=t[parseInt(n.toString(),10)],t[parseInt(n.toString(),10)]=t[parseInt(r.toString(),10)],t[parseInt(r.toString(),10)]=i)}return t}function vh(t,e,i){var n=xh(t,e),t=K.findAngle(t[n.index],t[n.index+1]),e=Ih(e),e=K.transform(n.point,t+45,e);return n.point=e,n.angle=t,n}function bh(t,e,i){var n=Sh(t,e),t=K.findAngle(t[n.index],t[n.index+1]),e=wh(e),e=K.transform(n.point,t+45,e);return n.point=e,n.angle=t,n}function Sh(t,e){for(var i,n,r,o,a=0,e=e.offset,s=[],h=0;h<t.length-1;h++)a+=K.distancePoints(t[parseInt(h.toString(),10)],t[h+1]),s.push(a);for(var d=e*a,l=0;l<s.length;l++){if(s[parseInt(l.toString(),10)]>=d)return n=K.findAngle(t[parseInt(l.toString(),10)],t[l+1]),{point:i=K.transform(t[parseInt(l.toString(),10)],n,d-(r||0)),index:o=l};r=s[parseInt(l.toString(),10)]}return{point:i,index:o}}function wh(t){var e=0;switch(t.alignment){case"Center":e=0;break;case"Before":e=-0;break;case"After":e=0}return e}function xh(t,e){for(var i,n,r,o,a=0,e=e.offset,s=[],h=0;h<t.length-1;h++)a+=K.distancePoints(t[parseInt(h.toString(),10)],t[h+1]),s.push(a);for(var d=e*a,l=0;l<s.length;l++){if(s[parseInt(l.toString(),10)]>=d)return n=K.findAngle(t[parseInt(l.toString(),10)],t[l+1]),{point:i=K.transform(t[parseInt(l.toString(),10)],n,d-(r||0)),index:o=l};r=s[parseInt(l.toString(),10)]}return{point:i,index:o}}function Ih(t){var e=!(t instanceof fn)&&void 0===t.content?10:0,i=0;switch(t.alignment){case"Center":i=0;break;case"Before":i=-(0+e);break;case"After":i=0+e}return i}function Ch(t,e,i){e%=360;var n,r;switch(t.alignment){case"Before":45<=e&&e<=135?(r="right",n=.5===t.offset?"center":"top"):225<=e&&e<=315?(r="left",n=.5===t.offset?"center":"bottom"):r=45<e&&e<225?(n="top",.5===t.offset?"center":"right"):(n="bottom",.5===t.offset?"center":"left");break;case"After":45<=e&&e<=135?(r="left",n=.5===t.offset?"center":"top"):225<=e&&e<=315?(r="right",n=.5===t.offset?"center":"bottom"):r=45<e&&e<225?(n="bottom",.5===t.offset?"center":"right"):(n="top",.5===t.offset?"center":"left");break;case"Center":r=N.isNullOrUndefined(t.horizontalAlignment)?"center":t.horizontalAlignment.toLowerCase(),n=N.isNullOrUndefined(t.verticalAlignment)?"center":t.verticalAlignment.toLowerCase()}if(0===t.offset||1===t.offset)switch(Ph(i[0],i[1])){case"left":r=0===t.offset?"right":"left";break;case"right":r=0===t.offset?"left":"right";break;case"bottom":n=0===t.offset?"top":"bottom";break;case"top":n=0===t.offset?"bottom":"top"}return{hAlign:r,vAlign:n}}function Ph(t,e){return Math.abs(e.x-t.x)>Math.abs(e.y-t.y)?t.x<e.x?"right":"left":t.y<e.y?"bottom":"top"}function Ah(t,e){if(t instanceof _&&t.children)for(var i=0;i<t.children.length;i++)e.nameTable[t.children[parseInt(i.toString(),10)]].children&&Ah(t,e),e.removeFromAQuad(e.nameTable[t.children[parseInt(i.toString(),10)]]),e.removeObjectsFromLayer(e.nameTable[t.children[parseInt(i.toString(),10)]]),delete e.nameTable[t.children[parseInt(i.toString(),10)]]}function Th(t,e){if(t&&t.children&&0<t.children.length)for(var i=0;i<t.children.length;i++){var n=t.children[parseInt(i.toString(),10)];n instanceof F&&Th(n,e)}return-1===e.indexOf(t.id)&&e.push(t.id),e}function Dh(i){var n=function(t){for(var e,i=[],n=0;n<t.length;n++)if("SwimLane"===(e=t[parseInt(n.toString(),10)]).shape.type)for(var r=e.wrapper.children[0].childTable,o=0,a=Object.keys(r);o<a.length;o++)i=Th(r[""+a[o]],i);return i}(i.nodes),r=Q(i,i.getCustomProperty),t=(r.selectedItems.nodes=[],r.selectedItems.connectors=[],r.selectedItems.wrapper=null,i.serializationSettings.preventDefaults&&(r=Oh(r,i)),i.nodes.forEach(function(t){var e;"SwimLane"===t.shape.type&&((e=i.commandHandler.findProcesses(t)).forEach(function(i){r.nodes.forEach(function(t){var e;t.id===i&&(e=t.wrapper,t.offsetX=e.offsetX,t.offsetY=e.offsetY)})}),0<e.length)&&(n=n.filter(function(t){return!e.includes(t)}))}),n),e=r.nodes;if(e)for(var o=0;o<e.length;o++)-1!==t.indexOf(e[parseInt(o.toString(),10)].id)&&(e.splice(o,1),o--);return JSON.stringify(r)}function Oh(t,e,i,n){i=function(t,e){var i,n=[],r="getClassName";if(t[r]){var o=new ru;switch(t[r]()){case"Diagram":i=o;break;case"Node":i=new _(o,"",n);break;case"Path":i=new Ud(o,"",n);break;case"Native":i=new Kd(o,"",n);break;case"Html":i=new Jd(o,"",n);break;case"Image":i=new el(o,"",n);break;case"Text":i=new rl(o,"",n);break;case"BasicShape":i=new sl(o,"",n);break;case"FlowShape":i=new ll(o,"",n);break;case"BpmnShape":i=new Xl(o,"",n);break;case"UmlActivityShape":i=new Ul(o,"",n);break;case"UmlClassifierShape":i=new fc(o,"",n);break;case"SwimLane":i=new Lc(o,"",n),t.header&&(i.header=new Ic(o,"",n),i.header.style.fill="");break;case"ShapeAnnotation":i=new Ze(o,"",n);break;case"PointPort":i=new Be(o,"",n);break;case"BpmnGateway":i=new gl(o,"",n);break;case"BpmnDataObject":i=new fl(o,"",n);break;case"BpmnEvent":i=new xl(o,"",n);break;case"BpmnSubEvent":i=new Pl(o,"",n);break;case"BpmnActivity":i=new kl(o,"",n);break;case"BpmnAnnotation":i=new Nl(o,"",n);break;case"MethodArguments":i=new Kl(o,"",n);break;case"UmlClassAttribute":i=new Jl(o,"",n);break;case"UmlClassMethod":i=new ec(o,"",n);break;case"UmlClass":i=new rc(o,"",n);break;case"UmlInterface":i=new sc(o,"",n);break;case"UmlEnumerationMember":i=new lc(o,"",n);break;case"UmlEnumeration":i=new gc(o,"",n);break;case"Lane":i=new Ac(o,"",n);break;case"Phase":i=new Oc(o,"",n);break;case"ChildContainer":i=new kc;break;case"Connector":i=new W(o,"",n);break;case"StraightSegment":i=new Wa(o,"",n);break;case"BezierSegment":i=new Xa(o,"",n);break;case"OrthogonalSegment":i=new Ua(o,"",n);break;case"PathAnnotation":i=new Qe(o,"",n);break;case"Stop":i=new xt(o,"",n);break;case"Point":i=e||new K(o,"",n);break;case"UserHandle":i=new Ts(o,"",n);break;case"Command":i=new Rs(o,"",n)}}else i=e;return parent=void 0,e=void 0,i}(e,i);for(var r=0,o=[].concat(Object.keys(t));r<o.length;r++){var a=o[r];if(e instanceof _&&(n="shape"===a),t[""+a]instanceof Array){p=c=l=d=h=s=void 0;var s=t,h=i,d=e,l=a;if(0===s[""+l].length)delete s[""+l];else if(s[l].every(function(t){return"number"==typeof t})){var c=void 0,p=!0;for(c=0;c<s[""+l].length;c++)p=!(!p||s[""+l][parseInt(c.toString(),10)]!==h[""+l][parseInt(c.toString(),10)]);p&&delete s[""+l]}else{c=void 0;if(s[""+l]&&"layers"!==l)for(c=s[""+l].length-1;0<=c;c--)"nodes"!==l&&"connectors"!==l||(s[""+l][parseInt(c.toString(),10)].wrapper=null),"dataManager"!==l&&(s[""+l][parseInt(c.toString(),10)]=Oh(s[""+l][parseInt(c.toString(),10)],d[""+l][parseInt(c.toString(),10)],void 0!==h[""+l]?h[""+l][parseInt(c.toString(),10)]:[]),"[]"!==JSON.stringify(s[""+l][parseInt(c.toString(),10)])&&"{}"!==JSON.stringify(s[""+l][parseInt(c.toString(),10)])&&void 0!==s[""+l][parseInt(c.toString(),10)]||s[""+l].splice(c,1))}s=void 0}else t[""+a]instanceof Object&&i&&i[""+a]?"wrapper"!==a&&(t[""+a]=Oh(t[""+a],e[""+a],i[""+a],n)):!(i&&t[""+a]===i[""+a]||void 0===t[""+a])||n&&"type"===a||e instanceof Lc&&"orientation"===a||delete t[""+a];"[]"!==JSON.stringify(t[""+a])&&"{}"!==JSON.stringify(t[""+a])&&void 0!==t[""+a]||delete t[""+a]}return i=void 0,t}function Mh(t,e){e.enableServerDataBinding(!1);for(var i=e.blazorActions,n=(e.blazorActions=e.addConstraints(i,Z.BlazorAction.ClearObject),e.clear(),e.blazorActions=e.removeConstraints(i,Z.BlazorAction.ClearObject),e.protectPropertyChange(!0),e.dataSourceSettings.doBinding),r=e.setNodeTemplate,o=e.getDescription,a=e.getCustomProperty,s={},h=0,d=e.commandManager.commands;h<d.length;h++){var l=d[h];s[l.name]={execute:l.execute,canExecute:l.canExecute}}var c=e.rulerSettings.horizontalRuler.arrangeTick,p=e.rulerSettings.verticalRuler.arrangeTick,g=e.layout.getLayoutInfo,u=e.layout.getBranch,m=e.getNodeDefaults,f=e.getConnectorDefaults,y=t instanceof Object?t:JSON.parse(t);if(y=Lh(y),e.contextMenuSettings=y.contextMenuSettings||{},e.constraints=y.constraints||Z.DiagramConstraints.Default,e.tool=y.tool||Z.DiagramTools.Default,e.bridgeDirection=y.bridgeDirection||"Top",e.pageSettings=y.pageSettings||{},e.drawingObject=y.drawingObject||void 0,e.tooltip=y.tooltip||{},e.addInfo=y.addInfo||void 0,e.getDescription=o,e.scrollSettings=y.scrollSettings||{},e.commandManager=y.commandManager||{},y.layers&&0<y.layers.length){var v,b,S,w=y,x=[];for(v=0;v<w.layers.length;v++){for(b=0;b<w.layers[v].objects.length;b++)if(w.nodes)for(S=0;S<w.nodes.length;S++)w.layers[v].objects[b]===w.nodes[S].id&&x.push(w.layers[v].objects[b]);for(b=0;b<w.layers[v].objects.length;b++)if(w.connectors)for(S=0;S<w.connectors.length;S++)w.layers[v].objects[b]===w.connectors[S].id&&x.push(w.layers[v].objects[b]);w.layers[v].objects=x,x=[]}}e.layers=y.layers||[],e.rulerSettings.horizontalRuler.arrangeTick=c,e.rulerSettings.verticalRuler.arrangeTick=p;for(var I,C=0,P=e.commandManager.commands;C<P.length;C++){var A=P[C];s[A.name]&&(A.execute=s[A.name].execute,A.canExecute=s[A.name].canExecute)}if(e.backgroundColor=y.backgroundColor||"transparent",e.basicElements=y.basicElements||[],y.connectors)for(var T=0;T<y.connectors.length;T++)"Bezier"===y.connectors[T].type&&0<y.connectors[T].segments.length&&y.connectors[T].bezierSettings&&y.connectors[T].bezierSettings.allowSegmentsReset&&(y.connectors[T].segments=[]);if(e.connectors=y.connectors||[],e.dataSourceSettings=y.dataSourceSettings||{},e.dataSourceSettings.doBinding=n,e.height=y.height||"100%",e.setNodeTemplate=r,e.getConnectorDefaults=f,e.getNodeDefaults=m,e.getCustomProperty=a,e.mode=y.mode||"SVG",y.nodes)for(T=0;T<y.nodes.length;T++)y.nodes[T].shape&&"SwimLane"===y.nodes[T].shape.type&&(null==y.nodes[T].wrapper&&(y.nodes[T].wrapper={actualSize:{width:y.nodes[T].width,height:y.nodes[T].height},offsetX:y.nodes[T].offsetX,offsetY:y.nodes[T].offsetY}),Mr(y.nodes[T],void 0,void 0,void 0,void 0,!0));e.nodes=y.nodes||[],Eh(e.nodes),Eh(e.connectors),e.rulerSettings=y.rulerSettings||{},e.snapSettings=y.snapSettings||{},e.width=y.width||"100%",e.layout=y.layout||{},y.layout&&"None"!==y.layout.type&&(e.canLayout=!1),e.layout.getLayoutInfo=Dp(g),e.layout.getBranch=Dp(u),e.diagramActions=0,e.isLoading=!0,e.protectPropertyChange(!1);for(T=0;T<e.views.length;T++)I=e.views[e.views[T]],e.blazorActions=e.addConstraints(i,Z.BlazorAction.ClearObject),I.refresh(),I instanceof Zs&&I.onPropertyChanged({sourceID:I.sourceID},{}),e.blazorActions=e.removeConstraints(i,Z.BlazorAction.ClearObject),I instanceof ru&&e.element.classList.add("e-diagram");return e.triggerEvent(Z.DiagramEvent.loaded,{name:"loaded",diagram:e}),y.selectedItems&&(y.selectedItems.nodes=[],y.selectedItems.connectors=[],y.selectedItems.selectedObjects=[]),e.selectedItems=y.selectedItems,e.enableServerDataBinding(!0),e.canLayout=!0,e.swimlaneChildTable={},e.swimlaneZIndexTable={},e.nodes.forEach(function(t){"SwimLane"===t.shape.type&&e.commandHandler.findProcesses(t).forEach(function(t){t=e.nameTable[t];t&&e.nameTable[t.processId]&&e.nameTable[t.processId].wrapper.children.push(t.wrapper)})}),y}function Eh(t){for(var e=0,i=t.filter(function(t){return"string"==typeof t.flip});e<i.length;e++){var n=i[e];switch(n.flip){case"Horizontal":n.flip=Z.FlipDirection.Horizontal;break;case"Vertical":n.flip=Z.FlipDirection.Vertical;break;case"Both":n.flip=Z.FlipDirection.Both;break;case"None":n.flip=Z.FlipDirection.None}}}function Lh(t){if(t&&(void 0===t.version||t.version<17.1)&&t.nodes)for(var e=0,i=t.nodes;e<i.length;e++){var n=i[e];if(n&&n.ports&&0<n.ports.length)for(var r=0,o=n.ports;r<o.length;r++){var a=o[r];a&&a.constraints&&a.constraints===Z.PortConstraints.None&&(a.constraints=Z.PortConstraints.Default)}}return t}function zh(t,e){var i=e.style,n=e;e.canApplyStyle=!0;for(var r=0,o=Object.keys(t);r<o.length;r++)switch(o[r]){case"fill":i.fill=t.fill,i instanceof Wt&&(i.fill="transparent");break;case"textOverflow":i.textOverflow=t.textOverflow;break;case"opacity":i.opacity=t.opacity;break;case"strokeColor":i.strokeColor=t.strokeColor;break;case"strokeDashArray":i.strokeDashArray=t.strokeDashArray;break;case"strokeWidth":i.strokeWidth=t.strokeWidth;break;case"bold":i.bold=t.bold;break;case"color":i.color=t.color;break;case"textWrapping":i.textWrapping=t.textWrapping;break;case"fontFamily":i.fontFamily=t.fontFamily;break;case"fontSize":i.fontSize=t.fontSize;break;case"italic":i.italic=t.italic;break;case"textAlign":i.textAlign=t.textAlign;break;case"whiteSpace":i.whiteSpace=t.whiteSpace;break;case"textDecoration":i.textDecoration=t.textDecoration;break;case"gradient":if(i.gradient){d=h=s=a=void 0;for(var a=t.gradient,s=i.gradient,h=0,d=Object.keys(a);h<d.length;h++)switch(d[h]){case"type":s.type=a.type;break;case"x1":s.x1=a.x1;break;case"x2":s.x2=a.x2;break;case"y1":s.y1=a.y1;break;case"y2":s.y2=a.y2;break;case"cx":s.cx=a.cx;break;case"cy":s.cy=a.cy;break;case"fx":s.fx=a.fx;break;case"fy":s.fy=a.fy;break;case"r":s.r=a.r;break;case"stops":s.stops=a.stops}}}e instanceof H&&n.refreshTextElement()}function kh(t,e,i){for(var n=e,r=n.hyperlink,o=0,a=Object.keys(t);o<a.length;o++)switch(a[o]){case"color":n.style.color=r.color=t.color;break;case"content":n.content=r.content=t.content||r.link;break;case"link":var s=i.style;n.style.color=(t.link?r:s).color,n.style.textDecoration=(t.link?r:i.style).textDecoration,n.content=t.link?r.content||t.link:i.content,r.link=t.link;break;case"textDecoration":n.style.textDecoration=r.textDecoration=t.textDecoration;break;case"hyperlinkOpenState":r.hyperlinkOpenState=t.hyperlinkOpenState}}function Bh(t,e,i){t.width=e.width,t.height=e.height,t.minHeight=e.minHeight,t.maxHeight=e.maxHeight,t.minWidth=e.minWidth,t.maxWidth=e.maxWidth,t.horizontalAlignment=e.wrapper.children[0].horizontalAlignment,t.verticalAlignment=e.wrapper.children[0].verticalAlignment,t.relativeMode=e.wrapper.children[0].relativeMode,t.visible=e.wrapper.children[0].visible,e.shape instanceof rl&&(t.margin=e.shape.margin),t.id=e.wrapper.children[0].id,t.style=e.style;for(var n=0,r=i.views;n<r.length;n++){var o=r[n];rp(e.id+"_groupElement",o),rp(e.id+"_content_groupElement",o),rp(e.id+"_html_element",o)}e.wrapper.children.splice(0,1),e.wrapper.children.splice(0,0,t)}function Rh(t,e,i,n){var r=new qt;switch(t.shape.type){case"Path":var o=new P;o.data=e.shape.data,Bh(r=o,e,n);break;case"Image":o=new le;o.source=e.shape.source,o.imageAlign=e.shape.align,o.imageScale=e.shape.scale,Bh(r=o,e,n);break;case"Text":Bh(r=new H,e,n);break;case"Basic":o=new("Rectangle"===e.shape.shape?qt:P);N.isBlazor()||"Polygon"!==e.shape.shape?o.data=me(e.shape.shape):o.data=L(e.shape.points),N.isBlazor()||"Rectangle"!==e.shape.shape||(o.cornerRadius=e.shape.cornerRadius),Bh(r=o,e,n);break;case"Flow":var o=new P,a=e.shape.shape;o.data=hi(a),Bh(r=o,e,n);break;case"Native":a=new be(t.id,n.element.id);a.content=e.shape.content,a.scale=e.shape.scale,Bh(r=a,e,n);break;case"HTML":o=new an(e.id,n.element.id);o.content=e.shape.content,Bh(r=o,e,n)}void 0===t.shape.type||t.shape.type===i.shape.type?Nh(t,e,n,i):(r.width=e.wrapper.children[0].width,r.height=e.wrapper.children[0].height,e.shape instanceof rl&&(r.margin=e.shape.margin),r.style=e.style,e.wrapper.children[0]=r)}function Nh(t,e,i,n){if(0<Object.keys(t.shape).length)if("Path"===e.shape.type&&void 0!==t.shape.data)e.wrapper.children[0].data=t.shape.data;else if("Text"===e.shape.type&&void 0!==t.shape.content)e.wrapper.children[0].content=t.shape.content;else if("Image"===e.shape.type&&void 0!==t.shape.source)e.wrapper.children[0].source=t.shape.source;else if("Native"===e.shape.type){for(var r=void 0,o=0;o<i.views.length;o++)r=Y(e.wrapper.children[0].id+"_native_element",i.views[parseInt(o.toString(),10)]),void 0!==t.shape.content&&r&&(r.removeChild(r.children[0]),e.wrapper.children[0].content=t.shape.content,r.appendChild(op(e.wrapper.children[0],!1)));e.wrapper.children[0].scale=t.shape.scale||e.wrapper.children[0].scale}else if("HTML"===e.shape.type)for(var a=void 0,o=0;o<i.views.length;o++)(a=Y(e.wrapper.children[0].id+"_html_element",i.views[parseInt(o.toString(),10)]))&&(a.removeChild(a.children[0]),e.wrapper.children[0].content=t.shape.content,a.appendChild(op(e.wrapper.children[0],!0)));else{var s;"Flow"===e.shape.type&&void 0!==t.shape.shape?(e.shape.shape=t.shape.shape,s=hi(e.shape.shape.toString()),e.wrapper.children[0].data=s):"UmlActivity"!==e.shape.type||N.isBlazor()||void 0===t.shape.shape?void 0!==t.shape.cornerRadius?e.wrapper.children[0].cornerRadius=t.shape.cornerRadius:"Basic"===e.shape.type&&n&&"Rectangle"===n.shape.shape?(s=new P,n=me(e.shape.shape),s.data=n,Bh(s,e,i)):void 0!==t.shape.shape&&(e.shape.shape=t.shape.shape,n=me(e.shape.shape.toString()),e.wrapper.children[0].data=n):jh(e,t)}e.wrapper.children[0].canMeasurePath=!0}function jh(t,e){N.isBlazor()?t.shape.umlActivityShape=e.shape.umlActivityShape:t.shape.shape=e.shape.shape;e=Os((N.isBlazor()?t.shape.umlActivityShape:t.shape.shape).toString());(N.isBlazor()||"InitialNode"!==t.shape.shape)&&(N.isBlazor()||"ForkNode"!==t.shape.shape&&"JoinNode"!==t.shape.shape)?N.isBlazor()||"FinalNode"!==t.shape.shape||t instanceof _&&(t.wrapper=Hh(t)):t.wrapper.children[0].style.fill="black",e&&(t.wrapper.children[0].data=e)}function Hh(t){var e=new F,i=(e.style.fill="transparent","M 25 50 C 11.21 50 0 38.79 0 25 C 0 11.21 11.21 0 25 0 C 38.78 0 50 11.21 50 25 C 50 38.79 38.78 50 25 50"),n=new P,r=(n.data=i,n.id=t.id+"_0_finalNode",n.horizontalAlignment="Center",n.verticalAlignment="Center",n.relativeMode="Object",n.style.strokeColor=t.style.strokeColor,n.style.strokeWidth=t.style.strokeWidth,new P);return r.data=i,r.id=t.id+"_1_finalNode",r.horizontalAlignment="Center",r.verticalAlignment="Center",r.relativeMode="Object",r.style.fill=t.style.fill,r.style.strokeColor=t.style.strokeColor,r.style.strokeWidth=t.style.strokeWidth,e.children=[n,r],e.children[0].width=t.width,e.children[0].height=t.height,e.children[1].height=t.height/1.5,e.children[1].width=t.width/1.5,e.style.strokeWidth=0,e.style.strokeColor="transparent",e}function Wh(t,e,i){var n=i.shape.shape,r=Os(n);switch(t.data=r,e=t,n){case"StructuredNode":if(i.annotations)for(var o=0;o<i.annotations.length;o++)i.annotations[parseInt(o.toString(),10)].content="<<"+i.annotations[parseInt(o.toString(),10)].content+">>";e=t;break;case"FinalNode":e=Hh(i)}return e}function _h(t){rp(t+"_linear"),rp(t+"_radial")}function Yh(t,e){e=t.indexOf(e);0<=e&&t.splice(e,1)}function Xh(t,e,i){t.intermediatePoints=e,t.updateSegmentElement(t,e,t.wrapper.children[0],i);var n,r=t.sourceDecorator;n="Bezier"===t.type?(o=t.segments[0],n=t.segments[t.segments.length-1],[K.isEmptyPoint(n.point2)?n.bezierPoint2:n.point2,K.isEmptyPoint(o.point1)?o.bezierPoint1:o.point1]):t.intermediatePoints,e=t.clipDecorators(t,e,i);(o=t.wrapper.children[0]).canMeasurePath=!0,o=t.wrapper.children[1],t.updateDecoratorElement(o,e[0],n[1],r);var i=t.targetDecorator,o=t.wrapper.children[2];t.updateDecoratorElement(o,e[e.length-1],n[n.length-2],i),t.updateShapeElement(t)}function Vh(t,e,i){var n,r,o,a,s=t.wrapper,h=(s.bounds,e.offset),d=e.size/i.scale,l=e.margin,c=s.offsetX-s.actualSize.width*s.pivot.x,p=s.offsetY-s.actualSize.height*s.pivot.y;if(r={x:0,y:0},0<t.nodes.length){switch(e.side){case"Top":r.x+=c+h*s.actualSize.width,r.y+=p-d;break;case"Bottom":r.x+=c+h*s.actualSize.width,r.y+=p+s.actualSize.height+d;break;case"Left":r.x+=c-d,r.y+=p+h*s.actualSize.height;break;case"Right":r.x+=c+s.actualSize.width+d,r.y+=p+h*s.actualSize.height}r.x+=(l.left-l.right)/i.scale+d/2*("Center"===e.horizontalAlignment?0:"Right"===e.horizontalAlignment?-1:1),r.y+=(l.top-l.bottom)/i.scale+d/2*("Center"===e.verticalAlignment?0:"Top"===e.verticalAlignment?-1:1)}else 0<t.connectors.length&&(n=(o=xh((i=t.connectors[0]).intermediatePoints,t={offset:h})).index,r=o.point,o=vh(i.intermediatePoints,t).angle,at(a=rt(),-o,i.intermediatePoints[parseInt(n.toString(),10)].x,i.intermediatePoints[parseInt(n.toString(),10)].y),(r=z(a,r)).x+=l.left-l.right+d/2*("Center"===e.horizontalAlignment?0:"Right"===e.horizontalAlignment?-1:1),r.y+=l.top-l.bottom+d/2*("Center"===e.verticalAlignment?0:"Top"===e.verticalAlignment?-1:1),at(a=rt(),o,i.intermediatePoints[parseInt(n.toString(),10)].x,i.intermediatePoints[parseInt(n.toString(),10)].y),r=z(a,r));return 0===s.rotateAngle&&0===s.parentTransform||(at(a=rt(),s.rotateAngle+s.parentTransform,s.offsetX,s.offsetY),r=z(a,r)),r}function Fh(t,e,i,n){if(n.annotation){if(Mn(n.annotation))return!0}else if(Z.SelectorConstraints[""+e]&t&&Z.ThumbsConstraints[""+e]&i)return!0;return!1}function Uh(t,e){return!!(Z.SelectorConstraints[""+e]&t)}function Gh(t,e){return!!(Z.ControlPointsVisibility[""+e]&t)}function Zh(t,e){return t.visibility&e}function Kh(t,e){var i;if("Text"===t.shape.type)i=t.shape;else{var n=e.split("_");e=n[n.length-1];for(var r=0;r<t.annotations.length;r++)e===t.annotations[parseInt(r.toString(),10)].id&&(i=t.annotations[parseInt(r.toString(),10)])}return i}function qh(t,e){var i;if(e&&(e=(i=e.split("_"))[i.length-1]),t)for(var n=0;n<t.ports.length;n++)if(e===t.ports[parseInt(n.toString(),10)].id)return t.ports[parseInt(n.toString(),10)]}function Qh(t,e){var i={},n=0;if(t.ports)for(var r=t.ports,n=0;n<r.length;n++)e?r[parseInt(n.toString(),10)].constraints&Z.PortConstraints.InConnect&&(i=r[parseInt(n.toString(),10)]):r[parseInt(n.toString(),10)].constraints&Z.PortConstraints.OutConnect&&(i=r[parseInt(n.toString(),10)]);return i}function Jh(t,e,i){for(var n=i?t.annotations:t.ports,r=0;r<n.length;r++)if(n[parseInt(r.toString(),10)].id===e)return r.toString();return"-1"}function $h(t,e,i){for(var n=t.ports,r=0;r<n.length;r++)if(n[parseInt(r.toString(),10)].id===e)return r.toString();return"-1"}function td(t,e){for(var i=0;i<t.length;i++)if(e===t[parseInt(i.toString(),10)].id)return!0;return!1}function ed(t,e,i,n){if(void 0!==t.width&&void 0!==t.height&&(t.width*=e,t.height*=i),t instanceof te){var r=rt(),o=n.width||n.actualSize.width,a=n.height||n.actualSize.height;if(void 0!==o&&void 0!==a){var s=n.offsetX-o*n.pivot.x,h=n.offsetY-a*n.pivot.y,s={x:s+o*n.pivot.x,y:h+a*n.pivot.y},s=Ap(n.rotateAngle,n.offsetX,n.offsetY,s);at(r,-n.rotateAngle,s.x,s.y),st(r,e,i,s.x,s.y),at(r,n.rotateAngle,s.x,s.y);for(var d=0,l=t.children;d<l.length;d++){var c,p=l[d];void 0!==p.width&&void 0!==p.height&&(c=z(r,{x:p.offsetX,y:p.offsetY}),p.offsetX=c.x,p.offsetY=c.y,ed(p,e,i,n))}}}}function id(t,e,i,n,r,o){for(var a,s,h,d=t.children,l=0;l<d.length;l++)(h=n[d[parseInt(l.toString(),10)]])&&(h.children?id(h,e,i,n,r,o):(h.offsetX-=e,h.offsetY-=i,r||((a=(n[h.id]=h).initContainer()).children||(a.children=[]),s=h.init(o),a.children.push(s),a.measure(new j(h.width,h.height)),a.arrange(a.desiredSize))))}function nd(t,e,i){if(0===i.length)i.push(t);else if(1===i.length)i[0][""+e]>t[""+e]?i.splice(0,0,t):i.push(t);else if(1<i.length){for(var n=0,r=i.length-1,o=Math.floor((n+r)/2);o!==n;){if(i[parseInt(o.toString(),10)][""+e]<t[""+e])n=o;else{if(!(i[parseInt(o.toString(),10)][""+e]>t[""+e]))break;r=o}o=Math.floor((n+r)/2)}i[parseInt(r.toString(),10)][""+e]<t[""+e]?i.push(t):i[parseInt(n.toString(),10)][""+e]>t[""+e]?i.splice(n,0,t):i[parseInt(n.toString(),10)][""+e]<t[""+e]&&i[parseInt(r.toString(),10)][""+e]>t[""+e]&&i.splice(r,0,t)}}function rd(t){for(var e=document.getElementById(t.diagramId),i="ej2_instances",n=e[i][0].nodes,r=(void 0===n&&(n=function(t){for(var e=[],i=0;i<t.palettes.length;i++)for(var n=t.palettes[parseInt(i.toString(),10)].symbols,r=0;r<n.length;r++)n[parseInt(r.toString(),10)]instanceof _&&e.push(n[parseInt(r.toString(),10)]);return e}(e[i][0])),0);n&&r<n.length;r++)if(n[parseInt(r.toString(),10)].id===t.nodeId)return od(n[parseInt(r.toString(),10)],t);for(var o=e[i][0].connectors,r=0;o&&r<o.length;r++)if(o[parseInt(r.toString(),10)].id===t.nodeId)return od(o[parseInt(r.toString(),10)],t);var a=e[i][0].enterObject;return a&&(a.id===t.nodeId||a.children)?a.children&&ah(a,"HTML",e[i][0].enterTable)?e[i][0].enterTable[t.nodeId]:a:null}function od(t,e){for(var i=t.annotations,n=0;i&&n<i.length;n++)if(e.annotationId&&i[parseInt(n.toString(),10)].id===e.annotationId)return i[parseInt(n.toString(),10)];return t}function ad(t,e,i,n,r,o,a,s){var h={x:0,y:0},d=rt();switch(at(d,r,o,a),s.x){case 0:switch(s.y){case 0:h=z(d,{x:t,y:e});break;case.5:h=z(d,{x:t,y:e+n/2});break;case 1:h=z(d,{x:t,y:e+n})}break;case.5:switch(s.y){case 0:h=z(d,{x:t+i/2,y:e});break;case.5:h=z(d,{x:t+i/2,y:e+n/2});break;case 1:h=z(d,{x:t+i/2,y:e+n})}break;case 1:switch(s.y){case 0:h=z(d,{x:t+i,y:e});break;case.5:h=z(d,{x:t+i,y:e+n/2});break;case 1:h=z(d,{x:t+i,y:e+n})}}return{x:h.x,y:h.y}}function sd(t,e,i,n,r,o,a,s){if(t.hasChildren())for(var h=0,d=t.children;h<d.length;h++){var l=d[h],c=void 0,p=(l instanceof F&&(c=n.nameTable[l.id])&&(o&&(c.flip^=Z.FlipDirection.Horizontal),a)&&(c.flip^=Z.FlipDirection.Vertical),e-l.offsetX+e),g=i-l.offsetY+i,p=(l instanceof H||l.elementActions&Z.ElementAction.ElementIsPort||(r!==Z.FlipDirection.Horizontal&&!o||(l.offsetX=p,c&&(c.offsetX=p),l.flipOffset.x=p-l.desiredSize.width/2),r===Z.FlipDirection.Vertical||a?(l.offsetY=g,c&&(c.offsetY=g),l.flipOffset.y=g-l.desiredSize.height/2):r===Z.FlipDirection.Both&&(l.offsetX=p,l.flipOffset.x=p-l.desiredSize.width/2,l.offsetY=g,l.flipOffset.y=g-l.desiredSize.height/2,c)&&(c.offsetX=p,c.offsetY=g)),s||(l instanceof F||l instanceof te)&&(o&&(l.flip^=Z.FlipDirection.Horizontal),a&&(l.flip^=Z.FlipDirection.Vertical),!l.id.includes("group_container")&&l.children&&(o&&(l.children[0].flip^=Z.FlipDirection.Horizontal),a)&&(l.children[0].flip^=Z.FlipDirection.Vertical),sd(l,e,i,n,r,o,a,s)),l.measure(new j(l.bounds.width,l.bounds.height)),l.arrange(l.desiredSize),n.nameTable[l.id]);p&&n.updateConnectorEdges(p)}}function hd(t){for(var e=t.selectedItems.nodes,i=t.selectedItems.connectors,n=t.allowServerDataBinding,r=t.isProtectedOnChange,n=(t.protectPropertyChange(!0),t.allowServerDataBinding=!1,t.selectedItems.nodes=[],t.selectedItems.connectors=[],t.allowServerDataBinding=n,t.protectPropertyChange(r),Q(t.selectedItems)),o=0;o<e.length;o++)t.selectedItems.nodes.push(t.nameTable[e[o].id]);for(o=0;o<i.length;o++)t.selectedItems.connectors.push(t.nameTable[i[o].id]);return n}function dd(t,e){return Math.abs(e.x-t.x)>Math.abs(e.y-t.y)?t.x<e.x?"Right":"Left":t.y<e.y?"Bottom":"Top"}var ld=function(t){return t=t&&(void 0!==t.sourceID||void 0!==t.sourcePoint||void 0!==t.targetID||void 0!==t.targetPoint||void 0!==t.type?W:_)},cd=function(t){var e,i;t.sourceID||t.targetID||(e={x:t.sourcePoint.x,y:t.sourcePoint.y},i={x:t.targetPoint.x,y:t.targetPoint.y},t.flip===Z.FlipDirection.Horizontal?(t.sourcePoint.x=i.x,t.targetPoint.x=e.x):t.flip===Z.FlipDirection.Vertical?(t.sourcePoint.y=i.y,t.targetPoint.y=e.y):t.flip===Z.FlipDirection.Both&&(t.sourcePoint=i,t.targetPoint=e))},pd=function(t,e,i){var n=i.offset.x,r=i.offset.y;return e===Z.FlipDirection.Horizontal?(n=1-i.offset.x,r=i.offset.y):e===Z.FlipDirection.Vertical?(n=i.offset.x,r=1-i.offset.y):e===Z.FlipDirection.Both&&(n=1-i.offset.x,r=1-i.offset.y),t.setOffsetWithRespectToBounds(n,r,"Fraction"),t},gd=function(t,e){for(var i=new P,n=0;n<t.length-1;n++){r=fd(t[n],t[n+1]),i.data=r[0],i.id=e.id+"_"+e.shape.sequence;var r=ud(t);i.offsetX=r.x,i.offsetY=r.y,i.rotateAngle=45,i.transform=Z.Transform.Self;break}return i},ud=function(t,e,i){for(var n=0,r=0;r<t.length-1;r++)n+=yd(t[parseInt(r.toString(),10)],t[r+1]);for(var o=i?n*i:30<n/2?10:n/2,a=0,s=0;s<t.length-1;s++){var h=yd(t[parseInt(s.toString(),10)],t[s+1]);if(o<=a+h){var d=o-a,l=M(t[s],t[s+1]),c=K.transform(t[s],l,d);break}a+=h}return c},md=function(t,e){if(t instanceof _||t instanceof W)for(var i=0;i<t.ports.length;i++)if(t.ports[i].id===e.id.split("_").splice(1).join("_"))return!0;return!1},fd=function(t,e){var i={x:t.x,y:t.y},n=yd(t,e),n=Math.min(10,n/2),t=M(t,e),e=K.transform({x:i.x,y:i.y},t,n),i=K.transform({x:e.x,y:e.y},t,-11),n=K.transform({x:i.x,y:i.y},t,22);return["M"+i.x+" "+i.y+" L"+n.x+" "+n.y,e]},yd=function(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))};function vd(t){return t}function bd(){return(0<=navigator.platform.indexOf("Mac")||0<=navigator.platform.indexOf("iPad")||0<=navigator.platform.indexOf("iPhone")||0<=navigator.platform.indexOf("MacIntel"))&&("safari"===N.Browser.info.name||"webkit"===N.Browser.info.name)}function Sd(t){return-1!==t.indexOf("shape")||-1!==t.indexOf("pathData")||-1!==t.indexOf("width")||-1!==t.indexOf("height")}function wd(t,e,i){var n=xd(t,e,i,"width"),t=xd(t,e,i,"height");return new j(n,t)}function xd(t,e,i,n){return void 0!==e.previewSize[""+n]?e.previewSize[""+n]:void 0!==t.symbolPreview[""+n]?t.symbolPreview[""+n]:e[""+n]||i.actualSize[""+n]}function Id(t,e,i){return i=t&&t.parentId?(t=e.nameTable[t.parentId]).parentId?Id(t,e,i):t.id:i}function Cd(t,e){return 1<t.selectedItems.connectors.length&&0===t.selectedItems.nodes.length&&0!==e.rotateAngle}function Pd(t){if(t.arrowType&&""!==t.arrowType.trim())switch(t.arrowType){case"single-line-arrow":return{targetDecorator:"Arrow",strokeWidth:1};case"double-line-arrow":return{targetDecorator:"Arrow",strokeWidth:2};case"dotted-arrow":return{targetDecorator:"Arrow",strokeDashArray:"2,2"};case"single-line":return{targetDecorator:"None",strokeWidth:1};case"double-line":return{targetDecorator:"None",strokeWidth:2};case"dotted":return{targetDecorator:"None",strokeDashArray:"2,2"};case"wiggly-arrow":return{targetDecorator:"None",strokeWidth:1,opacity:0};default:return{targetDecorator:"Arrow",strokeWidth:1}}return{targetDecorator:"Arrow",strokeWidth:1}}Ad=function(t,e){return(Ad=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)};var Ad,Td,n=function(t,e){function i(){this.constructor=t}Ad(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},a=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;0<=s;s--)(r=t[s])&&(a=(o<3?r(a):3<o?r(e,i,a):r(e,i))||a);return 3<o&&a&&Object.defineProperty(e,i,a),a},n=(Td=N.ChildProperty,n(Dd,Td),a([N.Property("None")],Dd.prototype,"shape",void 0),a([N.Property("white")],Dd.prototype,"fill",void 0),a([N.Property("Auto")],Dd.prototype,"horizontalAlignment",void 0),a([N.Property("Auto")],Dd.prototype,"verticalAlignment",void 0),a([N.Property(10)],Dd.prototype,"width",void 0),a([N.Property(10)],Dd.prototype,"height",void 0),a([N.Complex({x:.5,y:1},K)],Dd.prototype,"offset",void 0),a([N.Property("#1a1a1a")],Dd.prototype,"borderColor",void 0),a([N.Property(1)],Dd.prototype,"borderWidth",void 0),a([N.Complex({},ft)],Dd.prototype,"margin",void 0),a([N.Property("")],Dd.prototype,"pathData",void 0),a([N.Property("")],Dd.prototype,"content",void 0),a([N.Property(0)],Dd.prototype,"cornerRadius",void 0),a([N.Complex({left:2,right:2,top:2,bottom:2},ft)],Dd.prototype,"padding",void 0),a([N.Property("#1a1a1a")],Dd.prototype,"iconColor",void 0),Dd);function Dd(){return null!==Td&&Td.apply(this,arguments)||this}Od=function(t,e){return(Od=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)};(function(t,e){function i(){this.constructor=t}Od(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)})(Ld,Md=te),Ld.prototype.measure=function(t){var e="Horizontal"===this.orientation?this.updateHorizontalStack:this.updateVerticalStack;return this.desiredSize=this.measureStackPanel(t,e),this.desiredSize},Ld.prototype.arrange=function(t){var e="Horizontal"===this.orientation?this.arrangeHorizontalStack:this.arrangeVerticalStack;return this.actualSize=this.arrangeStackPanel(t,e),this.updateBounds(),this.actualSize},Ld.prototype.measureStackPanel=function(t,e){var i=void 0;if(void 0!==this.children&&0<this.children.length)for(var n=0,r=this.children;n<r.length;n++){var o=r[n],a=(o.parentTransform=this.rotateAngle+this.parentTransform,this.measureChildren?o.measure(o.desiredSize):o.measure(t),o.desiredSize.clone());this.applyChildMargin(o,a),0!==o.rotateAngle&&(a=Pp(a,o.rotateAngle)),void 0===i?i=a:o.preventContainer||e(a,i)}return i=Md.prototype.validateDesiredSize.call(this,i,t),this.stretchChildren(i),this.considerPadding&&this.applyPadding(i),i},Ld.prototype.arrangeStackPanel=function(t,e){if(void 0!==this.children&&0<this.children.length)for(var i=void 0,n=void 0,i=this.offsetX-t.width*this.pivot.x+this.padding.left,n=this.offsetY-t.height*this.pivot.y+this.padding.top,r=0,o=this.children;r<o.length;r++){var a=o[r],s=a.desiredSize.clone(),h=s,d=("Vertical"===this.orientation?n+=a.margin.top:i+=a.margin.left,e(i,n,a,this,t,h=0!==a.rotateAngle?Pp(s,a.rotateAngle):h));Md.prototype.findChildOffsetFromCenter.call(this,a,d),a.arrange(s,!0),"Vertical"===this.orientation?n+=h.height+a.margin.bottom:i+=h.width+a.margin.right}return t},Ld.prototype.updateHorizontalStack=function(t,e){e.height=Math.max(t.height,e.height),e.width+=t.width},Ld.prototype.updateVerticalStack=function(t,e){e.width=Math.max(t.width,e.width),e.height+=t.height},Ld.prototype.arrangeHorizontalStack=function(t,e,i,n,r,o){var a=0;return"Top"===i.verticalAlignment?a=e+i.margin.top+o.height/2:"Bottom"===i.verticalAlignment?a=n.offsetY+r.height*(1-n.pivot.y)-n.padding.bottom-i.margin.bottom-o.height/2:(a=n.offsetY-r.height*n.pivot.y+r.height/2,i.margin.top&&(a=e+i.margin.top+o.height/2)),{x:t+o.width/2,y:a}},Ld.prototype.arrangeVerticalStack=function(t,e,i,n,r,o){var a=0;return"Left"===i.horizontalAlignment?a=t+i.margin.left+o.width/2:"Right"===i.horizontalAlignment?a=n.offsetX+r.width*(1-n.pivot.x)-n.padding.right-i.margin.right-o.width/2:(a=n.offsetX-r.width*n.pivot.x+r.width/2,i.margin.left&&(a=t+i.margin.left+o.width/2)),{x:a,y:e+o.height/2}},Ld.prototype.stretchChildren=function(t){if(void 0!==this.children&&0<this.children.length)for(var e=0,i=this.children;e<i.length;e++){var n=i[e];"Vertical"===this.orientation?"Stretch"===n.horizontalAlignment&&(n.desiredSize.width=t.width-(n.margin.left+n.margin.right)):"Stretch"===n.verticalAlignment&&(n.desiredSize.height=t.height-(n.margin.top+n.margin.bottom))}},Ld.prototype.applyChildMargin=function(t,e){e.height+=t.margin.top+t.margin.bottom,e.width+=t.margin.left+t.margin.right};var Od,Md,Ed=Ld;function Ld(){var t=null!==Md&&Md.apply(this,arguments)||this;return t.orientation="Vertical",t.measureChildren=void 0,t.considerPadding=!0,t}function zd(t,e,i){var n,r="NoWrap",o=("Class"===e.shape.classifier?n=e.shape.classShape:"Enumeration"===e.shape.classifier?n=e.shape.enumerationShape:"Interface"===e.shape.classifier&&(n=e.shape.interfaceShape),e.container={type:"Stack",orientation:"Vertical"},e.constraints=(Z.NodeConstraints.Default|Z.NodeConstraints.HideThumbs)&~(Z.NodeConstraints.Rotate|Z.NodeConstraints.Resize),e.style={fill:e.style.fill,strokeColor:e.style.strokeColor,strokeWidth:1.5},e.children=[],e.maxWidth&&(r="Wrap"),new _(i,"nodes",{id:e.id+"_umlClass_header",annotations:[{id:"name",content:n.name,offset:{x:.5,y:.65},margin:{left:10,right:10},style:{bold:!0,fontSize:14,color:n.style.color,fill:n.style.fill,textWrapping:r}},{content:"<<"+e.shape.classifier+">>",margin:{left:10,right:10},id:"class",style:{fontSize:n.style.fontSize,color:n.style.color,fill:n.style.fill,textWrapping:r},offset:{x:.5,y:.3},constraints:Z.AnnotationConstraints.ReadOnly}],constraints:(Z.NodeConstraints.Default|Z.NodeConstraints.HideThumbs)&~(Z.NodeConstraints.Rotate|Z.NodeConstraints.Drag|Z.NodeConstraints.Resize),verticalAlignment:"Stretch",horizontalAlignment:"Stretch",style:{fill:e.style.fill,strokeColor:"black"===e.style.strokeColor?"#ffffff00":e.style.strokeColor}},!0)),a=(i.initObject(o),i.nodes.push(o),i.UpdateBlazorDiagramModel(o,"Node"),e.children.push(o.id),e),s=i,o=n,h=r;if("Enumeration"===a.shape.classifier){var d=o.members;if(d&&d.length){kd(a,s);for(var l="",c=0;c<d.length;c++){var p=d[parseInt(c.toString(),10)];""!==p.name&&(l+=p.name),c!==d.length&&(m=Rd(a,p),f=new _(s,"nodes",{id:q()+"_umlMember",annotations:[{id:"name",content:l,offset:{x:0,y:.5},style:{bold:!0,fontSize:m.fontSize,color:m.color,fill:m.fill,textWrapping:h,italic:m.italic,fontFamily:m.fontFamily,whiteSpace:m.whiteSpace,textAlign:m.textAlign,textDecoration:m.textDecoration,textOverflow:m.textOverflow},margin:{left:14,right:5},horizontalAlignment:"Left"}],verticalAlignment:"Stretch",horizontalAlignment:"Stretch",style:{fill:a.style.fill,strokeColor:"black"===a.style.strokeColor?"#ffffff00":a.style.strokeColor,textWrapping:h},constraints:(Z.NodeConstraints.Default|Z.NodeConstraints.HideThumbs)&~(Z.NodeConstraints.Rotate|Z.NodeConstraints.Drag|Z.NodeConstraints.Resize),minHeight:25},!0),s.initObject(f),s.nodes.push(f),s.UpdateBlazorDiagramModel(f,"Node"),a.children.push(f.id),l="",p.isSeparator&&c!==d.length-1&&kd(a,s,p.separatorStyle),p.isSeparator)&&c===d.length-1&&(p.isSeparator=!1)}}}else{var g=o.attributes;if(g.length){var u="";kd(a,s);for(c=0;c<g.length;c++){var m,f,y=void 0,v=g[parseInt(c.toString(),10)];y=v.scope&&"Public"===v.scope?" +":v.scope&&"Private"===v.scope?"-":v.scope&&"Protected"===v.scope?"#":"~",""!==v.name&&y&&(u+=y+" "+v.name+" : "+v.type),c!==g.length&&(m=Rd(a,v),f=new _(s,"nodes",{id:q()+"_umlProperty",style:{fill:a.style.fill,strokeColor:"black"===a.style.strokeColor?"#ffffff00":a.style.strokeColor},annotations:[{id:"name",content:u,offset:{x:0,y:.5},style:{bold:!0,fontSize:m.fontSize,color:m.color,fill:m.fill,textWrapping:h,italic:m.italic,fontFamily:m.fontFamily,whiteSpace:m.whiteSpace,textAlign:m.textAlign,textDecoration:m.textDecoration,textOverflow:m.textOverflow},margin:{left:14,right:5},horizontalAlignment:"Left"}],verticalAlignment:"Stretch",horizontalAlignment:"Stretch",constraints:(Z.NodeConstraints.Default|Z.NodeConstraints.HideThumbs)&~(Z.NodeConstraints.Rotate|Z.NodeConstraints.Drag|Z.NodeConstraints.Resize),minHeight:25},!0),s.initObject(f),s.nodes.push(f),s.UpdateBlazorDiagramModel(f,"Node"),a.children.push(f.id),u="",v.isSeparator&&c!==g.length-1&&kd(a,s,v.separatorStyle),v.isSeparator)&&c===g.length-1&&(v.isSeparator=!1)}}}var b=e,S=i,o=n,w=r;if(o.methods&&o.methods.length)for(var x=o.methods,I=(kd(b,S),""),C="",P=void 0,A=0;A<x.length;A++){var T,D=x[parseInt(A.toString(),10)];if(P=D.scope&&"Public"===D.scope?" +":D.scope&&"Private"===D.scope?"-":D.scope&&"Protected"===D.scope?"#":"~",D.parameters)for(var O=0;O<D.parameters.length;O++)D.parameters[parseInt(O.toString(),10)].type?I+=D.parameters[parseInt(O.toString(),10)].name+":"+D.parameters[parseInt(O.toString(),10)].type:I+=D.parameters[parseInt(O.toString(),10)].name,O!==D.parameters.length-1&&(I+=",");""!==D.name&&(P&&(C+=P+" "+D.name+"("+I+") : "+D.type),I=""),A!==x.length&&(T=Rd(b,D),T=new _(S,"nodes",{id:q()+"_umlMethods",verticalAlignment:"Stretch",horizontalAlignment:"Stretch",annotations:[{id:"name",content:C,offset:{x:0,y:.5},style:{bold:!0,fontSize:T.fontSize,color:T.color,fill:T.fill,textWrapping:w,italic:T.italic,fontFamily:T.fontFamily,whiteSpace:T.whiteSpace,textAlign:T.textAlign,textDecoration:T.textDecoration,textOverflow:T.textOverflow},margin:{left:14,right:5},horizontalAlignment:"Left"}],style:{fill:b.style.fill,strokeColor:"black"===b.style.strokeColor?"#ffffff00":b.style.strokeColor},minHeight:25,constraints:(Z.NodeConstraints.Default|Z.NodeConstraints.HideThumbs)&~(Z.NodeConstraints.Rotate|Z.NodeConstraints.Drag|Z.NodeConstraints.Resize)},!0),S.initObject(T),S.nodes.push(T),S.UpdateBlazorDiagramModel(T,"Node"),b.children.push(T.id),C="",D.isSeparator&&A!==x.length-1&&kd(b,S,D.separatorStyle),D.isSeparator)&&A===x.length-1&&(D.isSeparator=!1)}return e.offsetX=e.offsetX,e.offsetY=e.offsetY,e.style.fill=e.style.fill,e.borderColor=e.borderColor,i.initObject(e),t}function kd(t,e,i){i=new _(e,"nodes",{id:q()+"_path",height:1,constraints:Z.NodeConstraints.Default&~Z.NodeConstraints.Select,verticalAlignment:"Stretch",horizontalAlignment:"Stretch",style:{strokeColor:"black"===t.style.strokeColor?"#ffffff00":t.style.strokeColor,fill:i?i.fill:"white"}},!0);e.initObject(i),e.nodes.push(i),t.children.push(i.id)}function Bd(t,e,i){var n=new _(e,"nodes",{id:q()+"_path",height:1,constraints:Z.NodeConstraints.Default&~Z.NodeConstraints.Select,verticalAlignment:"Stretch",horizontalAlignment:"Stretch",style:{strokeColor:"black"===t.style.strokeColor?"#ffffff00":t.style.strokeColor,fill:"white"}},!0);n.parentId=t.id,n.umlIndex=i,e.add(n)}function Rd(t,e){var i={},e=e.style;return i.fill=("transparent"!==e.fill?e:t.style).fill,i.color=e.color,i.fontFamily=("Arial"!==e.fontFamily?e:t.style).fontFamily,i.italic=e.italic,i.bold=e.bold,i.whiteSpace=e.whiteSpace,i.textAlign=e.textAlign,i.textWrapping=e.textWrapping,i.textDecoration=e.textDecoration,i.textOverflow=e.textOverflow,i.fontSize=(12!==e.fontSize?e:t.style).fontSize,i.strokeColor=("black"!==e.strokeColor?e:t.style).strokeColor,i.strokeWidth=(1!==e.strokeWidth?e:t.style).strokeWidth,i}Nd=function(t,e){return(Nd=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)};var Nd,jd,a=function(t,e){function i(){this.constructor=t}Nd(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},h=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;0<=s;s--)(r=t[s])&&(a=(o<3?r(a):3<o?r(e,i,a):r(e,i))||a);return 3<o&&a&&Object.defineProperty(e,i,a),a},a=(jd=N.ChildProperty,a(Hd,jd),h([N.Property("Horizontal")],Hd.prototype,"orientation",void 0),h([N.Property("Center")],Hd.prototype,"type",void 0),h([N.Property(void 0)],Hd.prototype,"offset",void 0),h([N.Property(!1)],Hd.prototype,"enableRouting",void 0),h([N.Property([])],Hd.prototype,"children",void 0),h([N.Property("")],Hd.prototype,"assistants",void 0),h([N.Property("")],Hd.prototype,"level",void 0),h([N.Property("")],Hd.prototype,"hasSubTree",void 0),h([N.Property("")],Hd.prototype,"rows",void 0),Hd);function Hd(){return null!==jd&&jd.apply(this,arguments)||this}function Wd(t){if(t)switch(t.type){case"Basic":return sl;case"Flow":return ll;case"Path":return Ud;case"Image":return el;case"Text":return rl;case"Bpmn":return Xl;case"Native":return Kd;case"HTML":return Jd;case"UmlActivity":return Ul;case"UmlClassifier":return fc;case"SwimLane":return Lc;default:return sl}return sl}_d=function(t,e){return(_d=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)};var _d,Yd,h=function(t,e){function i(){this.constructor=t}_d(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},d=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;0<=s;s--)(r=t[s])&&(a=(o<3?r(a):3<o?r(e,i,a):r(e,i))||a);return 3<o&&a&&Object.defineProperty(e,i,a),a},Xd=(Yd=N.ChildProperty,h(Vd,Yd),d([N.Property("Basic")],Vd.prototype,"type",void 0),Vd);function Vd(){return null!==Yd&&Yd.apply(this,arguments)||this}h(Gd,Fd=Xd),Gd.prototype.getClassName=function(){return"Path"},d([N.Property("Path")],Gd.prototype,"type",void 0),d([N.Property("")],Gd.prototype,"data",void 0);var Fd,Ud=Gd;function Gd(){return null!==Fd&&Fd.apply(this,arguments)||this}h(qd,Zd=Xd),qd.prototype.getClassName=function(){return"Native"},d([N.Property("Native")],qd.prototype,"type",void 0),d([N.Property("")],qd.prototype,"content",void 0),d([N.Property("Stretch")],qd.prototype,"scale",void 0);var Zd,Kd=qd;function qd(){return null!==Zd&&Zd.apply(this,arguments)||this}h($d,Qd=Xd),$d.prototype.getClassName=function(){return"Html"},d([N.Property("HTML")],$d.prototype,"type",void 0),d([N.Property("")],$d.prototype,"content",void 0);var Qd,Jd=$d;function $d(){return null!==Qd&&Qd.apply(this,arguments)||this}h(il,tl=Xd),il.prototype.getClassName=function(){return"Image"},d([N.Property("Image")],il.prototype,"type",void 0),d([N.Property("")],il.prototype,"source",void 0),d([N.Property("None")],il.prototype,"scale",void 0),d([N.Property("None")],il.prototype,"align",void 0);var tl,el=il;function il(){return null!==tl&&tl.apply(this,arguments)||this}h(ol,nl=Xd),ol.prototype.getClassName=function(){return"Text"},d([N.Property("Text")],ol.prototype,"type",void 0),d([N.Property("")],ol.prototype,"content",void 0),d([N.Complex({},ft)],ol.prototype,"margin",void 0);var nl,rl=ol;function ol(){return null!==nl&&nl.apply(this,arguments)||this}h(hl,al=Xd),hl.prototype.getClassName=function(){return"BasicShape"},d([N.Property("Basic")],hl.prototype,"type",void 0),d([N.Property("Rectangle")],hl.prototype,"shape",void 0),d([N.Property(0)],hl.prototype,"cornerRadius",void 0),d([N.Collection([],K)],hl.prototype,"points",void 0);var al,sl=hl;function hl(){return null!==al&&al.apply(this,arguments)||this}h(cl,dl=Xd),cl.prototype.getClassName=function(){return"FlowShape"},d([N.Property("Flow")],cl.prototype,"type",void 0),d([N.Property("Terminator")],cl.prototype,"shape",void 0);var dl,ll=cl;function cl(){return null!==dl&&dl.apply(this,arguments)||this}pl=N.ChildProperty,h(ul,pl),ul.prototype.getClassName=function(){return"BpmnGateway"},d([N.Property("None")],ul.prototype,"type",void 0);var pl,gl=ul;function ul(){return null!==pl&&pl.apply(this,arguments)||this}ml=N.ChildProperty,h(yl,ml),yl.prototype.getClassName=function(){return"BpmnDataObject"},d([N.Property("None")],yl.prototype,"type",void 0),d([N.Property(!1)],yl.prototype,"collection",void 0);var ml,fl=yl;function yl(){return null!==ml&&ml.apply(this,arguments)||this}vl=N.ChildProperty,h(Sl,vl),d([N.Property("None")],Sl.prototype,"type",void 0),d([N.Property("None")],Sl.prototype,"loop",void 0),d([N.Property(!1)],Sl.prototype,"call",void 0),d([N.Property(!1)],Sl.prototype,"compensation",void 0);var vl,bl=Sl;function Sl(){return null!==vl&&vl.apply(this,arguments)||this}wl=N.ChildProperty,h(Il,wl),Il.prototype.getClassName=function(){return"BpmnEvent"},d([N.Property("Start")],Il.prototype,"event",void 0),d([N.Property("None")],Il.prototype,"trigger",void 0);var wl,xl=Il;function Il(){return null!==wl&&wl.apply(this,arguments)||this}Cl=N.ChildProperty,h(Al,Cl),Al.prototype.getClassName=function(){return"BpmnSubEvent"},d([N.Property("None")],Al.prototype,"trigger",void 0),d([N.Property("Start")],Al.prototype,"event",void 0),d([N.Property("")],Al.prototype,"id",void 0),d([N.Complex({},K)],Al.prototype,"offset",void 0),d([N.Collection([],Ze)],Al.prototype,"annotations",void 0),d([N.Collection([],Be)],Al.prototype,"ports",void 0),d([N.Property()],Al.prototype,"width",void 0),d([N.Property()],Al.prototype,"height",void 0),d([N.Complex({},ft)],Al.prototype,"margin",void 0),d([N.Property("Center")],Al.prototype,"horizontalAlignment",void 0),d([N.Property("Center")],Al.prototype,"verticalAlignment",void 0),d([N.Property(!0)],Al.prototype,"visible",void 0);var Cl,Pl=Al;function Al(){return null!==Cl&&Cl.apply(this,arguments)||this}Tl=N.ChildProperty,h(Ol,Tl),d([N.Complex({id:"success",event:"End",offset:{x:1,y:.5}},Pl)],Ol.prototype,"success",void 0),d([N.Complex({id:"failure",event:"Intermediate",trigger:"Error",offset:{x:.25,y:1}},Pl)],Ol.prototype,"failure",void 0),d([N.Complex({id:"cancel",event:"Intermediate",trigger:"Cancel",offset:{x:.75,y:1}},Pl)],Ol.prototype,"cancel",void 0);var Tl,Dl=Ol;function Ol(){return null!==Tl&&Tl.apply(this,arguments)||this}Ml=N.ChildProperty,h(Ll,Ml),d([N.Property("None")],Ll.prototype,"type",void 0),d([N.Property(!1)],Ll.prototype,"adhoc",void 0),d([N.Property("Default")],Ll.prototype,"boundary",void 0),d([N.Property(!1)],Ll.prototype,"compensation",void 0),d([N.Property("None")],Ll.prototype,"loop",void 0),d([N.Property(!0)],Ll.prototype,"collapsed",void 0),d([N.Collection([],Pl)],Ll.prototype,"events",void 0),d([N.Complex({},Dl)],Ll.prototype,"transaction",void 0),d([N.Property(void 0)],Ll.prototype,"processes",void 0);var Ml,El=Ll;function Ll(){return null!==Ml&&Ml.apply(this,arguments)||this}zl=N.ChildProperty,h(Bl,zl),Bl.prototype.getClassName=function(){return"BpmnActivity"},d([N.Property("Task")],Bl.prototype,"activity",void 0),d([N.Complex({},bl)],Bl.prototype,"task",void 0),d([N.Complex({},El)],Bl.prototype,"subProcess",void 0);var zl,kl=Bl;function Bl(){return null!==zl&&zl.apply(this,arguments)||this}Rl=N.ChildProperty,h(jl,Rl),jl.prototype.getClassName=function(){return"BpmnAnnotation"},d([N.Property("")],jl.prototype,"text",void 0),d([N.Property("")],jl.prototype,"id",void 0),d([N.Property(0)],jl.prototype,"angle",void 0),d([N.Property()],jl.prototype,"height",void 0),d([N.Property()],jl.prototype,"width",void 0),d([N.Property(0)],jl.prototype,"length",void 0);var Rl,Nl=jl;function jl(t,e,i,n){return Rl.call(this,t,e,i,n)||this}Hl=N.ChildProperty,h(_l,Hl),d([N.Property("")],_l.prototype,"textAnnotationTarget",void 0),d([N.Property("Auto")],_l.prototype,"textAnnotationDirection",void 0);var Hl,Wl=_l;function _l(){return null!==Hl&&Hl.apply(this,arguments)||this}h(Vl,Yl=Xd),Vl.prototype.getClassName=function(){return"BpmnShape"},d([N.Property("Bpmn")],Vl.prototype,"type",void 0),d([N.Property("Event")],Vl.prototype,"shape",void 0),d([N.Complex({},xl)],Vl.prototype,"event",void 0),d([N.Complex({},gl)],Vl.prototype,"gateway",void 0),d([N.Complex({},fl)],Vl.prototype,"dataObject",void 0),d([N.Complex({},kl)],Vl.prototype,"activity",void 0),d([N.Complex({},Nl)],Vl.prototype,"annotation",void 0),d([N.Collection([],Nl)],Vl.prototype,"annotations",void 0),d([N.Complex({},Wl)],Vl.prototype,"textAnnotation",void 0);var Yl,Xl=Vl;function Vl(){return null!==Yl&&Yl.apply(this,arguments)||this}h(Gl,Fl=Xd),Gl.prototype.getClassName=function(){return"UmlActivityShape"},d([N.Property("UmlActivity")],Gl.prototype,"type",void 0),d([N.Property("Action")],Gl.prototype,"shape",void 0);var Fl,Ul=Gl;function Gl(){return null!==Fl&&Fl.apply(this,arguments)||this}Zl=N.ChildProperty,h(ql,Zl),ql.prototype.getClassName=function(){return"MethodArguments"},d([N.Property("")],ql.prototype,"name",void 0),d([N.Property("")],ql.prototype,"type",void 0),d([N.Complex({},Xt)],ql.prototype,"style",void 0);var Zl,Kl=ql;function ql(){return null!==Zl&&Zl.apply(this,arguments)||this}h($l,Ql=Kl),$l.prototype.getClassName=function(){return"UmlClassAttribute"},d([N.Property("Public")],$l.prototype,"scope",void 0),d([N.Property(!1)],$l.prototype,"isSeparator",void 0),d([N.Complex({fill:"#F9F9F9",strokeColor:"#CCCCCC"},Nt)],$l.prototype,"separatorStyle",void 0);var Ql,Jl=$l;function $l(){return null!==Ql&&Ql.apply(this,arguments)||this}h(ic,tc=Jl),ic.prototype.getClassName=function(){return"UmlClassMethod"},d([N.Collection([],Kl)],ic.prototype,"parameters",void 0);var tc,ec=ic;function ic(){return null!==tc&&tc.apply(this,arguments)||this}nc=N.ChildProperty,h(oc,nc),oc.prototype.getClassName=function(){return"UmlClass"},d([N.Property("")],oc.prototype,"name",void 0),d([N.Collection([],Jl)],oc.prototype,"attributes",void 0),d([N.Collection([],ec)],oc.prototype,"methods",void 0),d([N.Complex({},Xt)],oc.prototype,"style",void 0);var nc,rc=oc;function oc(){return null!==nc&&nc.apply(this,arguments)||this}h(hc,ac=rc),d([N.Property(!(hc.prototype.getClassName=function(){return"UmlInterface"}))],hc.prototype,"isSeparator",void 0),d([N.Complex({fill:"#F9F9F9",strokeColor:"#CCCCCC"},Nt)],hc.prototype,"separatorStyle",void 0);var ac,sc=hc;function hc(){return null!==ac&&ac.apply(this,arguments)||this}dc=N.ChildProperty,h(cc,dc),cc.prototype.getClassName=function(){return"UmlEnumerationMember"},d([N.Property("")],cc.prototype,"name",void 0),d([N.Property("")],cc.prototype,"value",void 0),d([N.Property(!1)],cc.prototype,"isSeparator",void 0),d([N.Complex({fill:"#F9F9F9",strokeColor:"#CCCCCC"},Nt)],cc.prototype,"separatorStyle",void 0),d([N.Complex({},Xt)],cc.prototype,"style",void 0);var dc,lc=cc;function cc(){return null!==dc&&dc.apply(this,arguments)||this}pc=N.ChildProperty,h(uc,pc),uc.prototype.getClassName=function(){return"UmlEnumeration"},d([N.Property("")],uc.prototype,"name",void 0),d([N.Collection([],lc)],uc.prototype,"members",void 0),d([N.Complex({},Xt)],uc.prototype,"style",void 0);var pc,gc=uc;function uc(){return null!==pc&&pc.apply(this,arguments)||this}h(yc,mc=Xd),yc.prototype.getClassName=function(){return"UmlClassifierShape"},d([N.Property("UmlClassifier")],yc.prototype,"type",void 0),d([N.Complex({},rc)],yc.prototype,"classShape",void 0),d([N.Complex({},sc)],yc.prototype,"interfaceShape",void 0),d([N.Complex({},gc)],yc.prototype,"enumerationShape",void 0),d([N.Property("Class")],yc.prototype,"classifier",void 0);var mc,fc=yc;function yc(){return null!==mc&&mc.apply(this,arguments)||this}vc=N.ChildProperty,h(Sc,vc),Sc.prototype.getClassName=function(){return"DiagramShape"},d([N.Property("Basic")],Sc.prototype,"type",void 0),d([N.Property("Rectangle")],Sc.prototype,"basicShape",void 0),d([N.Property("Terminator")],Sc.prototype,"flowShape",void 0),d([N.Property("Event")],Sc.prototype,"bpmnShape",void 0),d([N.Property("Action")],Sc.prototype,"umlActivityShape",void 0),d([N.Property("")],Sc.prototype,"data",void 0),d([N.Property("")],Sc.prototype,"content",void 0),d([N.Property("")],Sc.prototype,"textContent",void 0),d([N.Property("Stretch")],Sc.prototype,"scale",void 0),d([N.Property("")],Sc.prototype,"source",void 0),d([N.Property("None")],Sc.prototype,"align",void 0),d([N.Complex({},ft)],Sc.prototype,"margin",void 0),d([N.Property(0)],Sc.prototype,"cornerRadius",void 0),d([N.Collection([],K)],Sc.prototype,"points",void 0),d([N.Complex({},fl)],Sc.prototype,"dataObject",void 0),d([N.Complex({},xl)],Sc.prototype,"event",void 0),d([N.Complex({},gl)],Sc.prototype,"gateway",void 0),d([N.Collection([],Nl)],Sc.prototype,"annotations",void 0),d([N.Complex({},kl)],Sc.prototype,"activity",void 0),d([N.Complex({},Nl)],Sc.prototype,"annotation",void 0),d([N.Complex({},gc)],Sc.prototype,"enumerationShape",void 0),d([N.Property("Class")],Sc.prototype,"classifier",void 0),d([N.Complex({},rc)],Sc.prototype,"classShape",void 0),d([N.Complex({},sc)],Sc.prototype,"interfaceShape",void 0);var vc,bc=Sc;function Sc(){return null!==vc&&vc.apply(this,arguments)||this}h(l,wc=e),Object.defineProperty(l.prototype,"actualSize",{get:function(){return null!==this.wrapper?this.wrapper.actualSize:new j(this.width||0,this.height||0)},enumerable:!0,configurable:!0}),l.prototype.init=function(t){e=new("SwimLane"!==this.shape.type?qt:Zn);switch(this.shape.changedProperties={},this.shape.oldProperties={},this.shape.type){case"Path":var e=N.isBlazor()||"Freehand"!==this.type?((i=new P).data=this.shape.data,i):((h=new P).data=R(this.shape.points),h);break;case"Image":var i=new le;i.source=this.shape.source,i.imageAlign=this.shape.align,i.imageScale=this.shape.scale,e=i;break;case"Text":var i=new H;i.content=this.shape.content,n=this.style,(e=i).style=n;break;case"Basic":N.isBlazor()||"Rectangle"!==this.shape.shape?e=N.isBlazor()||"Polygon"!==this.shape.shape?(d=new P,i=me(this.shape.shape),d.data=i,d):((h=new P).data=L(this.shape.points),h):(e=d=new qt).cornerRadius=this.shape.cornerRadius;break;case"Flow":var n=new P,i=hi(this.shape.shape);n.data=i,e=n;break;case"UmlActivity":e=Wh(new P,e,this);break;case"Bpmn":if(t.bpmnModule){e=t.bpmnModule.initBPMNContent(e,this,t),this.wrapper.elementActions=this.wrapper.elementActions|Z.ElementAction.ElementIsGroup;var r=this.shape.activity.subProcess;if(r.processes&&r.processes.length)for(var o=0,a=this.shape.activity.subProcess.processes;o<a.length;o++){var s=a[o];!t.nameTable[""+s]||t.nameTable[""+s].processId&&t.nameTable[""+s].processId!==this.id||(t.nameTable[""+s].processId=this.id,r.collapsed&&t.updateElementVisibility(t.nameTable[""+s].wrapper,t.nameTable[""+s],!r.collapsed),e.children.push(t.nameTable[""+s].wrapper))}}else console.warn('[WARNING] :: Module "BpmnDiagrams" is not available in Diagram component! You either misspelled the module name or forgot to load it.');break;case"Native":var h=new be(this.id,t.element.id);h.content=this.shape.content,h.scale=this.shape.scale,e=h;break;case"HTML":var d=new an(this.id,t.element.id,void 0,t.nodeTemplate);!this.shape.content||"string"!=typeof this.shape.content&&t.isReact?t.nodeTemplate&&(d.isTemplate=!0,d.template=d.content=op(d,!0,this)):d.content=this.shape.content,this.shape.content&&"function"==typeof this.shape.content&&t.isReact&&(d.isTemplate=!0,d.templateFn=N.compile(this.shape.content),d.template=d.content=op(d,!0,this)),e=d;break;case"UmlClassifier":e=zd(e,this,t);break;case"SwimLane":this.annotations=[],this.ports=[],e.cellStyle.fill="none",e.cellStyle.strokeColor="none",this.container={type:"Grid",orientation:this.shape.orientation},e.id=this.id,this.container.orientation=this.shape.orientation,this.constraints|=Z.NodeConstraints.HideThumbs,or(e,t,this)}return e.id=this.id+"_content",e.relativeMode="Object","Basic"===this.shape.type&&"Rectangle"===this.shape.shape?e.shapeType="Rectangle":e.shapeType="Others",void 0!==this.width&&(e.width=this.width),e.horizontalAlignment="Stretch",void 0!==this.height&&(e.height=this.height),void 0!==this.minHeight&&(e.minHeight=this.minHeight),void 0!==this.maxHeight&&(e.maxHeight=this.maxHeight),void 0!==this.minWidth&&(e.minWidth=this.minWidth),void 0!==this.maxWidth&&(e.maxWidth=this.maxWidth),N.isBlazor()||"Rectangle"!==this.shape.shape||this.shape.cornerRadius||(e.isRectElement=!0),e.verticalAlignment="Stretch",this.shape instanceof rl&&(e.margin=this.shape.margin),!Pn(this)||"Freehand"===this.type||"Bpmn"===this.shape.type&&"TextAnnotation"!==this.shape.shape||0!=(this.constraints&Z.NodeConstraints.Shadow)&&this.visible&&(e.shadow=this.shadow),"Bpmn"===this.shape.type&&(N.isBlazor()||"Message"!==this.shape.shape)&&(N.isBlazor()||"DataSource"!==this.shape.shape)||"UmlActivity"===this.shape.type&&(N.isBlazor()||"FinalNode"===this.shape.shape)||"Text"!==this.shape.type&&(e.style=this.style,this.oldGradientValue=this.style.gradient?Q(this.style.gradient):null),(this.wrapper.elementActions&Z.ElementAction.ElementIsGroup||this.flip!==Z.FlipDirection.Horizontal)&&this.flip!==Z.FlipDirection.Vertical||(e.flip=this.flip,e.flipMode=this.flipMode),e},l.prototype.initContainer=function(){var t;if(this.id||(this.id=q()),!this.container||this.shape instanceof Lc)t=new(this.children?te:F);else switch(this.container.type){case"Canvas":t=new F;break;case"Stack":t=new Ed;break;case"Grid":(t=new Zn).setDefinitions(this.rows,this.columns)}return t.id=this.id,t.offsetX=this.offsetX,t.offsetY=this.offsetY,t.visible=this.visible,t.horizontalAlignment=this.horizontalAlignment,t.verticalAlignment=this.verticalAlignment,this.container&&"SwimLane"!==this.shape.type&&(t.width=this.width,t.height=this.height,"Stack"===this.container.type)&&(t.orientation=this.container.orientation),t.style.fill=this.backgroundColor,t.style.strokeColor=this.borderColor,t.style.strokeWidth=this.borderWidth,t.rotateAngle=this.rotateAngle,t.minHeight=this.minHeight,t.minWidth=this.minWidth,t.maxHeight=this.maxHeight,t.maxWidth=this.maxWidth,t.pivot=this.pivot,t.margin=this.margin,t.flip=this.flip,t.flipMode=this.flipMode,this.wrapper=t},l.prototype.initPorts=function(t,e){for(var i=0;this.ports,i<this.ports.length;i++)this.initPort(t,e,this.ports[parseInt(i.toString(),10)])},l.prototype.initPort=function(t,e,i){var n,r=this.wrapper,i=this.initPortWrapper(i,this),t=Dp(t);t&&(n=t(i,this)),i.description=n||i.id,i.inversedAlignment=r.inversedAlignment,i.elementActions=i.elementActions|Z.ElementAction.ElementIsPort,e.children.push(i)},l.prototype.getIconOffet=function(t,e){var i,t="BottomToTop"===t.orientation?(i=e.offset.x,1-e.offset.y):"LeftToRight"===t.orientation?(i=e.offset.y,e.offset.x):"RightToLeft"===t.orientation?(i=1-e.offset.y,e.offset.x):(i=e.offset.x,e.offset.y);return{x:i,y:t}},l.prototype.initIcons=function(t,e,i,n){var r,o=this.wrapper,a=this.isExpanded?this.expandIcon:this.collapseIcon;"None"!==a.shape&&((r=new F).float=!0,r.id=this.id+"_icon_content",r.children=[],r.height=a.height,r.width=a.width,r.style.strokeColor="transparent",r.margin=a.margin,r.horizontalAlignment="Center",r.verticalAlignment="Center",r.visible=this.visible,r.cornerRadius=a.cornerRadius,e=this.getIconOffet(e,a),r.setOffsetWithRespectToBounds(e.x,e.y,"Fraction"),r.relativeMode="Point",e=void this.initIconSymbol(a,r,t,n),(n=Dp(t))&&(e=n(a,this)),r.description=e||r.id,r.inversedAlignment=o.inversedAlignment,i.children.push(r))},l.prototype.initFixedUserHandles=function(t,e,i){""===t.pathData&&e?((n=new an(this.id,i,void 0,e)).isTemplate=!0,n.template=op(n,!0,t),t.id=t.id||q(),n.id=this.id+"_"+t.id):(i=this.wrapper,(n=new F).children=[],t.id=t.id||q(),n.id=this.id+"_"+t.id,e=fh(t,n),n.children.push(e),n.inversedAlignment=i.inversedAlignment),n.float=!0,n.height=t.height,n.width=t.width,n.style.strokeColor=t.handleStrokeColor,n.style.fill=t.fill,n.style.strokeWidth=t.handleStrokeWidth,n.margin=t.margin,n.visible=t.visibility,n.cornerRadius=t.cornerRadius,n.horizontalAlignment="Center",n.verticalAlignment="Center";var n,e=this.getfixedUserHandleOffet(t);return n.setOffsetWithRespectToBounds(e.x,e.y,"Fraction"),n.relativeMode="Point",n.description=n.id,n},l.prototype.getfixedUserHandleOffet=function(t){return{x:t.offset.x,y:t.offset.y}},l.prototype.initAnnotations=function(t,e,i,n,r){for(var o=0;this.annotations,o<this.annotations.length;o++){var a=this.initAnnotationWrapper(this.annotations[parseInt(o.toString(),10)],i,n,o,r),s=void 0,h=Dp(t);h&&(s=h(a,this)),a.description=s||a.id,a.inversedAlignment=e.inversedAlignment,e.children.push(a)}},l.prototype.initPortWrapper=function(t,e){t.id=t.id||q();var i=new P,n=(i.height=t.height,i.width=t.width,i.connectionDirection=t.connectionDirection,t.shape=t.shape||"Square","Custom"===t.shape?t.pathData:$e(t.shape)),n=(i.id=this.id+"_"+t.id,i.margin=t.margin,i.data=n,e&&"Bpmn"===e.shape.type&&(i.flip=this.flip),t.style);return i.style={fill:n.fill,strokeColor:n.strokeColor,gradient:null,opacity:n.opacity,strokeDashArray:n.strokeDashArray,strokeWidth:n.strokeWidth},i.horizontalAlignment=t.horizontalAlignment,i.verticalAlignment=t.verticalAlignment,i="None"!==this.flipMode&&"Label"!==this.flipMode&&"LabelText"!==this.flipMode&&"LabelAndLabelText"!==this.flipMode?pd(i,this.flip,t):pd(i,Z.FlipDirection.None,t),void 0===this.width&&void 0===this.height||(i.float=!0),i.relativeMode="Point",i.visible=!(!Zh(t,Z.PortVisibility.Visible)||Zh(t,Z.PortVisibility.Hover)||Zh(t,Z.PortVisibility.Connect)),i.elementActions=i.elementActions|Z.ElementAction.ElementIsPort,i},l.prototype.initAnnotationWrapper=function(t,e,i,n,r){t.content=t.content||"",t.id=t.id||n+"annotation"||q();var o,n=t;return e&&(t.template||"Template"===t.annotationType||r&&""===t.content)?(o=new an(this.id,e,t.id,r),e=document.getElementById(e).ej2_instances[0],t.template&&"function"==typeof t.template&&e.isReact&&(o.templateFn=N.compile(t.template),o.isTemplate=!0),o=cp(o,t,r,e)):((o=new H).canMeasure=!i,r=t.style,e=t.hyperlink.link?t.hyperlink:void 0,o.style={fill:r.fill,strokeColor:r.strokeColor,strokeWidth:r.strokeWidth,bold:r.bold,textWrapping:r.textWrapping,color:e?e.color||o.hyperlink.color:r.color,whiteSpace:r.whiteSpace,fontFamily:r.fontFamily,fontSize:r.fontSize,italic:r.italic,gradient:null,opacity:r.opacity,strokeDashArray:r.strokeDashArray,textAlign:r.textAlign,textOverflow:t.style.textOverflow,textDecoration:e?e.textDecoration||o.hyperlink.textDecoration:r.textDecoration},o.hyperlink.link=t.hyperlink.link||void 0,o.hyperlink.hyperlinkOpenState=t.hyperlink.hyperlinkOpenState||void 0,o.hyperlink.content=t.hyperlink.content||void 0,o.hyperlink.textDecoration=t.hyperlink.textDecoration||void 0,o.content=e?e.content||o.hyperlink.link:t.content),o.constraints=t.constraints,o.height=t.height,o.width=t.width,o.visible=t.visibility,o.annotationVisibility=o.visible?"Visible":"Collapsed",o.rotateAngle=t.rotateAngle,o.rotationReference=t.rotationReference,o.id=this.id+"_"+t.id,void 0===this.width||t.template||void 0!==t.width||"Wrap"!==t.style.textWrapping&&"WrapWithOverflow"!==t.style.textWrapping||(o.width=this.width),o.margin=t.margin,o.horizontalAlignment=t.horizontalAlignment,o.verticalAlignment=t.verticalAlignment,o.setOffsetWithRespectToBounds(n.offset.x,n.offset.y,"Fraction"),void 0===this.width&&void 0===this.height||(o.float=!0),o.relativeMode="Point",o},l.prototype.initIconContainer=function(t,e){var i=new qt;return i.id=e.id+"_rect",i.height=t.height,i.width=t.width,i.visible=e.visible,i.margin=t.margin,i.cornerRadius=t.cornerRadius,i.style={fill:t.fill,strokeColor:t.borderColor,strokeWidth:t.borderWidth},i.setOffsetWithRespectToBounds(.5,.5,"Fraction"),i.horizontalAlignment="Center",i.verticalAlignment="Center",i.relativeMode="Object",i.description=i.description||"Click here to expand or collapse",i},l.prototype.initIconSymbol=function(t,e,i,n){var r;e.children.push(this.initIconContainer(t,e)),"Template"===t.shape?((r=new be(this.id,n)).content=t.content,r.height=10,r.width=10):((r=new P).data=ni(t),n=Hc(r.data),r.height=n.height<10?n.height:10-(t.padding.bottom+t.padding.top),r.width=n.width<10?n.width:10-(t.padding.left+t.padding.right)),r.id=e.id+"_shape",r.horizontalAlignment="Center",r.verticalAlignment="Center",r.visible=e.visible,r.visible=e.visible,r.style={fill:"black",strokeColor:t.iconColor,strokeWidth:t.borderWidth},r.setOffsetWithRespectToBounds(.5,.5,"Fraction"),r.relativeMode="Object",r.description=e.description||"Click here to expand or collapse",e.children.push(r)},l.prototype.getClassName=function(){return"Node"},d([N.Collection([],Ze)],l.prototype,"annotations",void 0),d([N.Property(0)],l.prototype,"offsetX",void 0),d([N.Complex({},a)],l.prototype,"layoutInfo",void 0),d([N.Property(0)],l.prototype,"offsetY",void 0),d([N.Collection([],Be)],l.prototype,"ports",void 0),d([N.Property(!0)],l.prototype,"isExpanded",void 0),d([N.Collection([],gn)],l.prototype,"fixedUserHandles",void 0),d([N.Complex({},n)],l.prototype,"expandIcon",void 0),d([N.Complex({},n)],l.prototype,"collapseIcon",void 0),d([N.Complex({x:.5,y:.5},K)],l.prototype,"pivot",void 0),d([N.Property()],l.prototype,"width",void 0),d([N.Property()],l.prototype,"height",void 0),d([N.Property()],l.prototype,"minWidth",void 0),d([N.Property()],l.prototype,"minHeight",void 0),d([N.Property()],l.prototype,"maxWidth",void 0),d([N.Property()],l.prototype,"maxHeight",void 0),d([N.Property(0)],l.prototype,"rotateAngle",void 0),d([N.Complex({fill:"white"},Xt)],l.prototype,"style",void 0),d([N.Property("transparent")],l.prototype,"backgroundColor",void 0),d([N.Property("none")],l.prototype,"borderColor",void 0),d([N.Property(0)],l.prototype,"borderWidth",void 0),d([N.Property()],l.prototype,"data",void 0),d([N.ComplexFactory(Wd)],l.prototype,"shape",void 0),d([N.Complex({},Ki)],l.prototype,"previewSize",void 0),d([N.Complex({},Ki)],l.prototype,"dragSize",void 0),d([N.Property(null)],l.prototype,"wrapper",void 0),d([N.Property(Z.NodeConstraints.Default)],l.prototype,"constraints",void 0),d([N.Complex({},bt)],l.prototype,"shadow",void 0),d([N.Property()],l.prototype,"children",void 0),d([N.Complex({left:0,right:0,top:0,bottom:0},ft)],l.prototype,"padding",void 0),d([N.Property(null)],l.prototype,"container",void 0),d([N.Property("Left")],l.prototype,"horizontalAlignment",void 0),d([N.Property("Top")],l.prototype,"verticalAlignment",void 0),d([N.Property()],l.prototype,"rows",void 0),d([N.Property()],l.prototype,"columns",void 0),d([N.Property()],l.prototype,"rowIndex",void 0),d([N.Property()],l.prototype,"columnIndex",void 0),d([N.Property()],l.prototype,"rowSpan",void 0),d([N.Property()],l.prototype,"columnSpan",void 0),d([N.Property("")],l.prototype,"branch",void 0);var wc,_=l;function l(t,e,i,n){t=wc.call(this,t,e,i,n)||this;return t.isCanvasUpdate=!1,t.status="None",t.parentId="",t.processId="",t.umlIndex=-1,t.outEdges=[],t.inEdges=[],t.isHeader=!1,t.isLane=!1,t.isPhase=!1,t.laneGrids=[],t.children&&0<t.children.length&&((e=i).style&&e.style.fill||(t.style.fill="transparent"),e.style&&e.style.strokeColor||(t.style.strokeColor="transparent")),t.shape&&"UmlActivity"===t.shape.type&&ih(i,t),t.shape&&"SwimLane"===t.shape.type&&Js(i,t),t.ports&&t.ports.length&&eh(t),t}xc=N.ChildProperty,h(Cc,xc),d([N.Property("")],Cc.prototype,"id",void 0),d([N.Complex({},Fe)],Cc.prototype,"annotation",void 0),d([N.Complex({fill:"#FFFFFF",strokeColor:"#CCCCCC"},Nt)],Cc.prototype,"style",void 0),d([N.Property(50)],Cc.prototype,"height",void 0),d([N.Property(50)],Cc.prototype,"width",void 0);var xc,Ic=Cc;function Cc(){return null!==xc&&xc.apply(this,arguments)||this}Pc=N.ChildProperty,h(Tc,Pc),Tc.prototype.getClassName=function(){return"Lane"},d([N.Property("")],Tc.prototype,"id",void 0),d([N.Complex({fill:"#F9F9F9",strokeColor:"#CCCCCC"},Nt)],Tc.prototype,"style",void 0),d([N.Collection([],_)],Tc.prototype,"children",void 0),d([N.Property(100)],Tc.prototype,"height",void 0),d([N.Property(100)],Tc.prototype,"width",void 0),d([N.Complex({style:{fill:"#E7F4FF",strokeColor:"#CCCCCC"},annotation:{content:"Function"}},Ic)],Tc.prototype,"header",void 0),d([N.Property(!0)],Tc.prototype,"canMove",void 0),d([N.Property()],Tc.prototype,"addInfo",void 0);var Pc,Ac=Tc;function Tc(){return null!==Pc&&Pc.apply(this,arguments)||this}Dc=N.ChildProperty,h(Mc,Dc),Mc.prototype.getClassName=function(){return"Phase"},d([N.Property("")],Mc.prototype,"id",void 0),d([N.Complex({fill:"#FFFFFF",strokeColor:"#CCCCCC"},Nt)],Mc.prototype,"style",void 0),d([N.Complex({annotation:{content:"Phase"}},Ic)],Mc.prototype,"header",void 0),d([N.Property(100)],Mc.prototype,"offset",void 0),d([N.Property()],Mc.prototype,"addInfo",void 0);var Dc,Oc=Mc;function Mc(){return null!==Dc&&Dc.apply(this,arguments)||this}h(zc,Ec=Xd),zc.prototype.getClassName=function(){return"SwimLane"},d([N.Property("SwimLane")],zc.prototype,"type",void 0),d([N.Property(20)],zc.prototype,"phaseSize",void 0),d([N.Collection([],Oc)],zc.prototype,"phases",void 0),d([N.Property("Horizontal")],zc.prototype,"orientation",void 0),d([N.Collection([],Ac)],zc.prototype,"lanes",void 0),d([N.Complex({style:{fill:"#E7F4FF",strokeColor:"#CCCCCC"},annotation:{content:"Function"}},Ic)],zc.prototype,"header",void 0),d([N.Property(!1)],zc.prototype,"isLane",void 0),d([N.Property(!1)],zc.prototype,"isPhase",void 0);var Ec,Lc=zc;function zc(){var t=null!==Ec&&Ec.apply(this,arguments)||this;return t.padding=20,t.hasHeader=!0,t}Bc.prototype.getClassName=function(){return"ChildContainer"},d([N.Property("Canvas")],Bc.prototype,"type",void 0),d([N.Property("Vertical")],Bc.prototype,"orientation",void 0);var kc=Bc;function Bc(){}Rc=N.ChildProperty,h(Nc,Rc),Nc.prototype.init=function(t){var e=new te;if(e.measureChildren=!1,e.children=[],this.annotation){var i=(0<this.nodes.length?t.nameTable[this.nodes[0].id]:t.nameTable[this.connectors[0].id]).wrapper,n=t.getWrapper(i,this.annotation.id);e.children.push(n)}else if(this.nodes||this.connectors){for(var r=0;r<this.nodes.length;r++){n=t.nameTable[this.nodes[parseInt(r.toString(),10)].id].wrapper;e.children.push(n)}for(var o=0;o<this.connectors.length;o++){n=t.nameTable[this.connectors[parseInt(o.toString(),10)].id].wrapper;e.children.push(n)}}i=t.isProtectedOnChange;return t.protectPropertyChange(!1),this.wrapper=e,t.protectPropertyChange(i),e},d([N.Property(null)],Nc.prototype,"wrapper",void 0),d([N.Property(14)],Nc.prototype,"handleSize",void 0),d([N.Collection([],_)],Nc.prototype,"nodes",void 0),d([N.Collection([],W)],Nc.prototype,"connectors",void 0),d([N.Property()],Nc.prototype,"width",void 0),d([N.Property()],Nc.prototype,"height",void 0),d([N.Property(0)],Nc.prototype,"rotateAngle",void 0),d([N.Property(0)],Nc.prototype,"offsetX",void 0),d([N.Property(0)],Nc.prototype,"offsetY",void 0),d([N.Complex({x:.5,y:.5},K)],Nc.prototype,"pivot",void 0),d([N.Property("CompleteIntersect")],Nc.prototype,"rubberBandSelectionMode",void 0),d([N.Collection([],Ts)],Nc.prototype,"userHandles",void 0),d([N.Property(Z.SelectorConstraints.All)],Nc.prototype,"constraints",void 0),d([N.Property()],Nc.prototype,"setTooltipTemplate",void 0),d([N.Collection([],_)],Nc.prototype,"selectedObjects",void 0),d([N.Property(!1)],Nc.prototype,"canToggleSelection",void 0);var Rc,B=Nc;function Nc(){return null!==Rc&&Rc.apply(this,arguments)||this}function jc(t){var e,i=[];if("msie"===N.Browser.info.name||"edge"===N.Browser.info.name)for(var n=0;n<t.childNodes.length;n++)1===(e=t.childNodes[parseInt(n.toString(),10)]).nodeType&&i.push(e);else i=t.children;return i}function Hc(t){var e,i;return t?(e="measureElement",window[e].style.visibility="visible",(i=jc(window[e].children[2])[0]).setAttribute("d",t),t=i.getBBox(),i=new k(t.x,t.y,t.width,t.height),window[e].style.visibility="hidden",i):new k(0,0,0,0)}function Wc(t,e,i,n,r){var o=new j,a=A("span",{style:"display:inline-block; line-height: normal"});return t.bold&&(a.style.fontWeight="bold"),t.italic&&(a.style.fontStyle="italic"),void 0!==i&&(a.style.width=i.toString()+"px"),void 0!==n&&(a.style.height=n.toString()+"px"),void 0!==r&&(a.style.maxWidth=r.toString()+"px"),a.style.fontFamily=t.fontFamily,a.style.fontSize=t.fontSize+"px",a.style.color=t.color,a.textContent=e,a.style.whiteSpace=Cp(t.whiteSpace,t.textWrapping),a.style.wordBreak=void 0!==r?"break-word":Sp(t.textWrapping),document.body.appendChild(a),o.width=a.offsetWidth,o.height=a.offsetHeight,document.body.removeChild(a),o}function _c(t,e,i,n){var r=0,o=0,a=!1;return 0===e.x&&0===e.y||(r=0-Number(e.x),o=0-Number(e.y)),t.actualSize.width===e.width&&t.actualSize.height===e.height&&!n||(r=(n&&n.width||t.actualSize.width)/Number(e.width||1),o=(n&&n.height||t.actualSize.height)/Number(e.height||1),a=!0),n=V($(D(t.data)),r,o,a,e.x,e.y,0,0),a=!1,n}function Yc(t){return Y(t).getElementsByClassName("e-diagram-layer")[0]}function Y(t,e){var i;return e&&(i=document.getElementById(e)),"msie"===N.Browser.info.name||"edge"===N.Browser.info.name?i?i.querySelector("#"+t):document.getElementById(t):i?i.querySelector("#"+CSS.escape(t)):document.getElementById(t)}function Xc(t,e,i){for(var n,r,o=void 0,a="",a="native"===i?(n=Jc(t),"_content_groupElement"):"html"===i?(n=$c(t).childNodes[0],"_html_element"):(n=Yc(i=t).getElementById(i+"_diagramLayer"),"_groupElement"),s=0;n.childNodes&&s<n.childNodes.length;s++)if((r=n.childNodes[s])&&r.id===e+a){o=s;break}return o}function Vc(t){return Y(t).getElementsByClassName("e-adorner-layer")[0]}function Fc(t){return Vc(t).getElementById(t+"_SelectorElement")}function Uc(t){return Vc(t).getElementById(t+"_diagramAdorner")}function Gc(t){return Y(t).getElementsByClassName("e-userHandle-layer")[0]}function Zc(t){return Y(t).getElementsByClassName("e-native-layer")[0]}function Kc(t){return Y(t).getElementsByClassName("e-grid-layer")[0]}function qc(t){return Y(t).getElementsByClassName("e-background-layer")[0].parentNode}function Qc(t){return Y(t).getElementsByClassName("e-background-layer")[0]}function Jc(t){return Zc(t).getElementById(t+"_nativeLayer")}function $c(t){var e=null,i="domTable";return window[i][t+"html_layer"]?e=window[i][t+"html_layer"]:(e=Y(t).getElementsByClassName("e-html-layer")[0],window[i][t+"html_layer"]=e),e}function A(t,e){t=N.createElement(t);return hp(t,e),t}function tp(t,e){t=document.createElementNS("http://www.w3.org/2000/svg",t);return ap(t,e),t}function ep(t,e,i){for(var n=t;n&&(i?n.id!==e:!ip(n,e));)n=n.parentNode;return n}function ip(t,e){return-1<(" "+("object"==typeof t.className?t.className.animVal:t.className)+" ").indexOf(" "+e+" ")}function np(t,e,i){t=[];for(var n=0,r=i.length;n<r;n++)t.push({pageX:i[parseInt(n.toString(),10)].clientX,pageY:i[parseInt(n.toString(),10)].clientY,pointerId:null});return t}function rp(t,e){t=Y(t,e);t&&t.parentNode.removeChild(t)}function op(t,e,i){n=e?A("div",{style:"height: 100%; width: 100%"}):document.createElementNS("http://www.w3.org/2000/svg","g");var n,r,e=rd(t),o={},a=e instanceof _?("Native"===(o=e).shape.type&&(a=void 0,s=document.createElementNS("http://www.w3.org/2000/svg","svg"),document.body.appendChild(s),s.innerHTML=e.shape.content,a=0<s.getElementsByTagName("svg").length?s.getElementsByTagName("svg")[0].outerHTML:0<s.getElementsByTagName("g").length?s.getElementsByTagName("g")[0].outerHTML:"",e.shape.content=a,t.content=a,s.parentElement.removeChild(s)),"nodeTemplate"):(o=e,"annotationTemplate"),s=document.getElementById(t.diagramId).ej2_instances[0];if("string"!=typeof t.content&&"function"!=typeof t.content||t.isTemplate)if(t.isTemplate){d=void 0;if(d=s.isReact?t.getNodeTemplate()(Q(i),s,a+"_"+("nodeTemplate"===a?i.id:t.nodeId+i.id),void 0,void 0,!1,n):s.isVue||s.isVue3?(t.getNodeTemplate()?t.getNodeTemplate():d="nodeTemplate"===a?N.compile(s.nodeTemplate):N.compile(s.annotationTemplate))(Q(i),s,a+"_"+("nodeTemplate"===a?i.id:t.nodeId+i.id),void 0,void 0,!1,n):t.getNodeTemplate()(Q(i),s,a+"_"+("nodeTemplate"===a?i.id:t.nodeId+i.id),void 0,void 0,!1))for(var h=0;h<d.length;h++)n.appendChild(d[parseInt(h.toString(),10)])}else t.content&&t.content.outerHTML&&n.appendChild(t.content);else{e=document.getElementById(t.content);if(e)n.appendChild(e);else for(var d=void 0,l=0,c=(d=N.compile(t.content))(o,s,a,"");l<c.length;l++)r=c[l],n.appendChild(r)}return t.isTemplate?n:n.cloneNode(!0)}function ap(t,e){for(var i=Object.keys(e),n=0;n<i.length;n++)t&&"style"!==i[parseInt(n.toString(),10)]?t.setAttribute(i[parseInt(n.toString(),10)],e[i[parseInt(n.toString(),10)]]):sp(t,e[i[parseInt(n.toString(),10)]])}function sp(t,e){for(var i=e.split(";"),n=0;n<i.length;n++){var r=i[parseInt(n.toString(),10)].split(":");2===r.length&&(t.style[r[0].trim()]=r[1].trim())}}function hp(t,e){for(var i=Object.keys(e),n=0;n<i.length;n++)"style"!==i[parseInt(n.toString(),10)]?t.setAttribute(i[parseInt(n.toString(),10)],e[i[parseInt(n.toString(),10)]]):sp(t,e[i[parseInt(n.toString(),10)]])}function dp(){var t,e,i,n="measureElement";window[n]?window[n].usageCount+=1:(t=A("div",{id:"measureElement",style:"visibility:hidden ; height: 0px ; width: 0px; overflow: hidden;"}),i=A("span",{style:"display:inline-block ; line-height: normal"}),t.appendChild(i),i=A("img",{alt:"measureElementImage",src:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"}),t.appendChild(i),(i=document.createElementNS("http://www.w3.org/2000/svg","svg")).setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),t.appendChild(i),(e=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("d",""),i.appendChild(e),document.createTextNode(""),(e=document.createElementNS("http://www.w3.org/2000/svg","text")).setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),i.appendChild(e),window[n]=t,window[n].usageCount=1,document.body.appendChild(t),i="measureElementCount",window[i]?window[i]++:window[i]=1)}function lp(t,e,i,n){return!(1<=e.length&&0===t.x)||"Clip"!==n.textOverflow&&"Ellipsis"!==n.textOverflow||"Wrap"!==n.textWrapping&&"WrapWithOverflow"!==n.textWrapping||(t.x=e[i-1]?e[i-1].x:-t.width/2),t.x}function cp(t,e,i,n){return i&&!e.template||e.template&&"function"==typeof e.template&&n.isReact?(t.isTemplate=!0,t.template=t.content=op(t,!0,e)):t.content=e.template,t}function q(){for(var t,e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",i="",n=0;n<5;n++)t="undefined"!=typeof window&&"crypto"in window&&"getRandomValues"in crypto?(t=new Uint16Array(1),(window.msCrypto||window.crypto).getRandomValues(t)[0]%(e.length-1)):Math.floor(Math.random()*e.length),0===n&&t<10?n--:i+=e.substring(t,t+1);return i}function pp(e){if(e)try{return"function"!=typeof e&&document.querySelectorAll(e).length?N.compile(document.querySelector(e).innerHTML.trim()):N.compile(e)}catch(t){return N.compile(e)}}function gp(t){new k;var e=t.offsetY-t.actualSize.height*t.pivot.y,i=t.offsetY+t.actualSize.height*(1-t.pivot.y),n=t.offsetX-t.actualSize.width*t.pivot.x,t=t.offsetX+t.actualSize.width*(1-t.pivot.x);return k.toBounds([{x:n,y:e},{x:t,y:e},{x:n,y:i},{x:t,y:i}])}function up(t){new k;var e,i=gp(t),n=i.middleLeft,r=i.topCenter,o=i.bottomCenter,a=i.middleRight,s=i.topLeft,h=i.topRight,d=i.bottomLeft,i=i.bottomRight;return t.corners={topLeft:s,topCenter:r,topRight:h,middleLeft:n,middleRight:a,bottomLeft:d,bottomCenter:o,bottomRight:i},0===t.rotateAngle&&0===t.parentTransform||(at(e=rt(),t.rotateAngle+t.parentTransform,t.offsetX,t.offsetY),t.corners.topLeft=s=z(e,s),t.corners.topCenter=z(e,r),t.corners.topRight=h=z(e,h),t.corners.middleLeft=z(e,n),t.corners.middleRight=z(e,a),t.corners.bottomLeft=d=z(e,d),t.corners.bottomCenter=z(e,o),t.corners.bottomRight=i=z(e,i)),r=k.toBounds([s,h,d,i]),t.corners.left=r.left,t.corners.right=r.right,t.corners.top=r.top,t.corners.bottom=r.bottom,t.corners.center=r.center,t.corners.width=r.width,t.corners.height=r.height,r}function Q(t,e,i,n){var r={},o="properties";if(t){i=t.propName;for(var a=t[o]||t,s=[],h=[],d=((s=s.concat(Object.keys(a))).push("version"),i&&(h=(a=Dp(e))?a(i):[],s=s.concat(h)),mp(i)),l=0,c=s=s.concat(d);l<c.length;l++){var p=c[l];"historyManager"!==p&&("wrapper"!==p?t[""+p]&&t.hasOwnProperty("observers")||(t[""+p]instanceof Array?r[""+p]=fp((-1===d.indexOf(p)&&t[o]?t[o]:t)[""+p],e):t[""+p]instanceof Array==!1&&t[""+p]instanceof HTMLElement?r[""+p]=t[""+p].cloneNode(!0).innerHTML:t[""+p]instanceof Array==!1&&t[""+p]instanceof Object?r[""+p]=Q((-1===d.indexOf(p)&&t[o]?t[o]:t)[""+p],void 0):r[""+p]=t[""+p]):t[""+p]&&(r[""+p]={actualSize:{width:t[""+p].actualSize.width,height:t[""+p].actualSize.height},offsetX:t[""+p].offsetX,offsetY:t[""+p].offsetY}))}}return r}function mp(t){switch(t){case"nodes":case"children":return["inEdges","outEdges","parentId","processId","nodeId","umlIndex","isPhase","isLane"];case"connectors":return["parentId"];case"annotation":case"annotations":return["nodeId"];case"shape":return["hasHeader"];case"layers":return["objectZIndex"]}return[]}function fp(t,e,i,n){if(t)for(var r=[],o=0;o<t.length;o++)!(t[parseInt(o.toString(),10)]instanceof Array)&&t[parseInt(o.toString(),10)]instanceof Object?r.push(Q(t[parseInt(o.toString(),10)],e)):r.push(t[parseInt(o.toString(),10)]);return r}function yp(t,e){var i="properties";if(t){e=e||{properties:{}};for(var n=0,r=Object.keys(t);n<r.length;n++){var o,a=r[n];t[""+a]instanceof Array?(o=vp(t[""+a],e[i][""+a]),e[i][""+a]&&e[i][""+a].length||(e[""+a]=o)):t[""+a]instanceof Array==!1&&t[""+a]instanceof HTMLElement?e[""+a]=t[""+a].cloneNode(!0).innerHtml:t[""+a]instanceof Array==!1&&t[""+a]instanceof Object?((o=yp(t[""+a],e[i][""+a]))[i]&&!Object.keys(o[i]).length&&delete o[i],e[""+a]=o):e[""+a]=(void 0!==e[i][""+a]?e:t)[""+a]}}return e}function vp(t,e){var i=[],n=!1;(e=e||[]).length||(n=!0);for(var r,o=0;o<t.length;o++)t[parseInt(o.toString(),10)]instanceof Array?(vp(t[parseInt(o.toString(),10)],e[parseInt(o.toString(),10)]),n&&i.push(vp)):t[parseInt(o.toString(),10)]instanceof Object?(r=yp(t[parseInt(o.toString(),10)],e[parseInt(o.toString(),10)]),n&&i.push(r)):i.push(t[parseInt(o.toString(),10)]);return i}function bp(t){var e="";switch(t){case"Center":e="center";break;case"Left":e="left";break;case"Right":e="right";break;case"Justify":e="justify"}return e}function Sp(t){var e="";switch(t){case"Wrap":e="breakall";break;case"NoWrap":e="keepall";break;case"WrapWithOverflow":e="normal";break;case"LineThrough":e="line-through"}return e}function wp(t,e){var i="measureElement";window[i].style.visibility="visible";var n=jc(window[i].children[2])[1],t=(n.textContent=t,sp(n,"font-size:"+e.fontSize+"px; font-family:"+e.fontFamily+";font-weight:"+(e.bold?"bold":"normal")),n.getBBox().width);return window[i].style.visibility="hidden",t}function xp(t,e){return(t+e)/2}function Ip(t,e){for(var i=0,n=0,r=0,o="",a=t.length,s=0;0<r&&(i=n),n=Math.floor(xp(i,a)),(r=wp(o+=t.substr(i,n),e))<=e.width;);for(o=o.substr(0,i),s=i;s<a;s++)if((r=wp(o+=t[parseInt(s.toString(),10)],e))>=e.width){t=t.substr(0,o.length-1);break}return"Ellipsis"===e.textOverflow?(t=t.substr(0,t.length-3),t+="..."):t=t.substr(0,t.length),t}function Cp(t,e){if("NoWrap"===e&&"PreserveAll"===t)return"pre";var i="";switch(t){case"CollapseAll":i="nowrap";break;case"CollapseSpace":i="pre-line";break;case"PreserveAll":i="pre-wrap"}return i}function Pp(t,e){var i=rt(),e=(at(i,e,0,0),z(i,{x:0,y:0})),n=z(i,{x:t.width,y:0}),r=z(i,{x:0,y:t.height}),i=z(i,{x:t.width,y:t.height}),t=Math.min(e.x,n.x,r.x,i.x),o=Math.min(e.y,n.y,r.y,i.y),a=Math.max(e.x,n.x,r.x,i.x),e=Math.max(e.y,n.y,r.y,i.y);return new j(a-t,e-o)}function Ap(t,e,i,n){var r;return 0!==t?(at(r=rt(),t,e,i),z(r,n)):n}function Tp(t,e){return{x:t.x+e.desiredSize.width*e.pivot.x,y:t.y+e.desiredSize.height*e.pivot.y}}function Dp(t){return t=void 0!==t&&"string"==typeof t?N.getValue(t,window):t}Mp.getContext=function(t){return t.getContext("2d")},Mp.setCanvasSize=function(t,e,i){t&&(t.setAttribute("width",e.toString()),t.setAttribute("height",i.toString()))},Mp.prototype.renderGradient=function(t,e,i,n){var r,o;if("None"!==t.gradient.type){for(var a,s,h=0;h<t.gradient.stops.length;h++)r=void 0!==r?t.gradient.stops[parseInt(h.toString(),10)].offset:Math.max(r,t.gradient.stops[parseInt(h.toString(),10)].offset),o=void 0!==o?t.gradient.stops[parseInt(h.toString(),10)].offset:Math.min(o,t.gradient.stops[parseInt(h.toString(),10)].offset);a="Linear"===t.gradient.type?(s=t.gradient,e.createLinearGradient(i+s.x1,n+s.y1,i+s.x2,n+s.y2)):(s=t.gradient,e.createRadialGradient(i+s.fx,n+s.fy,0,i+s.cx,n+s.cy,s.r));for(h=0;h<t.gradient.stops.length;h++){var d=t.gradient.stops[parseInt(h.toString(),10)],l=o<0?(r+d.offset)/(2*r):d.offset/r;a.addColorStop(l,d.color)}e.fillStyle=a}return e},Mp.prototype.renderShadow=function(t,e,i){void 0===i&&(i=null);var n=Mp.getContext(e),r=(n.save(),n.beginPath(),n.strokeStyle=n.fillStyle=t.shadow.color,n.globalAlpha=t.shadow.opacity,K.transform({x:0,y:0},t.shadow.angle,t.shadow.distance)),o=t.x+r.x,r=t.y+r.y,a=o+t.width*t.pivotX,s=r+t.height*t.pivotY;this.rotateContext(e,t.angle,a,s),i?(n.translate(o,r),this.renderPath(e,t,i),n.translate(-o,-r)):(n.rect(o,r,t.width,t.height),n.fillRect(o,r,t.width,t.height)),n.fill(),n.stroke(),n.closePath(),n.restore()},Mp.createCanvas=function(t,e,i){t=A("canvas",{id:t});return this.setCanvasSize(t,e,i),t},Mp.prototype.setStyle=function(t,e){var t=Mp.getContext(t),i=("none"===e.fill&&(e.fill="transparent"),"none"===e.stroke&&(e.stroke="transparent"),t.strokeStyle=e.stroke,t.lineWidth=e.strokeWidth,0===e.strokeWidth&&(t.strokeStyle="transparent"),t.globalAlpha=e.opacity,[]);e.dashArray&&(i=this.parseDashArray(e.dashArray)),t.setLineDash(i),e.gradient&&"None"!==e.gradient.type?"Rectangle"===e.shapeType?this.renderGradient(e,t,e.x,e.y):this.renderGradient(e,t,0,0):t.fillStyle=e.fill},Mp.prototype.rotateContext=function(t,e,i,n){t=Mp.getContext(t);t.translate(i,n),t.rotate(e*Math.PI/180),t.translate(-i,-n)},Mp.prototype.setFontStyle=function(t,e){var t=Mp.getContext(t),i="";e.italic&&(i+="italic "),e.bold&&(i+="bold "),i=(i+=e.fontSize+"px ")+e.fontFamily,t.font=i},Mp.prototype.parseDashArray=function(t){for(var e=[],i=-1!==t.indexOf(" ")?" ":",",n=0,r=t.split(i);n<r.length;n++){var o=r[n];e.push(Number(o))}return e},Mp.prototype.drawRoundedRect=function(t,e){var i=Mp.getContext(t),n=(i.beginPath(),e.x),r=e.y,o=e.width,a=e.height,s=n+o/2,h=r+a/2;i.beginPath(),this.setStyle(t,e),i.moveTo(n,h),i.quadraticCurveTo(n,r,s,r),i.quadraticCurveTo(n+o,r,n+o,h),i.quadraticCurveTo(n+o,r+a,s,r+a),i.quadraticCurveTo(n,r+a,n,h),i.fill(),i.stroke()},Mp.prototype.drawRectangle=function(t,e,i,n,r,o,a,s,h,d,l){!0===e.visible&&(e.cornerRadius?!n&&(e.width<30||e.height<30)?this.drawRoundedRect(t,e):(e.data=E(e.cornerRadius,e.height,e.width),this.drawPath(t,e,i,r,o,a,void 0,d,l)):(n=Mp.getContext(t),e.shadow&&this.renderShadow(e,t),n.save(),n.beginPath(),e.cornerRadius,i=e.x+e.width*e.pivotX,r=e.y+e.height*e.pivotY,o=e.isImage?-e.angle:e.angle,this.rotateContext(t,o,i,r),this.setStyle(t,e),n.rect(e.x,e.y,e.width,e.height),n.fillRect(e.x,e.y,e.width,e.height),n.fill(),n.stroke(),n.closePath(),n.restore()))},Mp.prototype.drawPath=function(t,e,i,n,r,o,a,s,h){d=X(D(e.data)),e.shadow&&this.renderShadow(e,t,d);var d,l=Mp.getContext(t),c=(l.save(),l.beginPath(),e.y+e.height*e.pivotY),p=e.x+e.width*e.pivotX;this.applyFlipAndRotate(l,e,t,p,c,s,h),this.setStyle(t,e),l.translate(e.x,e.y),this.renderPath(t,e,d),l.fill(),l.translate(-e.x,-e.y),l.stroke(),l.restore()},Mp.prototype.renderPath=function(t,e,i){if(!0===e.visible)for(var n=0,r=Mp.getContext(t),o=void 0,a=void 0,s=void 0,h=void 0,d=void 0,l=void 0,c=void 0,p=void 0,g=void 0,u=i,c=0,p=0,g=0,m=u.length;g<m;++g){var f=u[parseInt(g.toString(),10)],y=f.command;switch("x1"in f&&(s=f.x1),"x2"in f&&(d=f.x2),"y1"in f&&(h=f.y1),"y2"in f&&(l=f.y2),"x"in f&&(c=f.x),"y"in f&&(p=f.y),y){case"M":r.moveTo(c,p),f.x=c,f.y=p;break;case"L":r.lineTo(c,p),f.x=c,f.y=p;break;case"C":r.bezierCurveTo(s,h,d,l,c,p),f.x=c,f.y=p,f.x1=s,f.y1=h,f.x2=d,f.y2=l;break;case"Q":r.quadraticCurveTo(s,h,c,p),f.x=c,f.y=p,f.x1=s,f.y1=h;break;case"A":var v=o,b=a,S=void 0,w=void 0,x=(e.arc&&0<e.arc.length?(S=(0===f.r1?e.arc[parseInt(n.toString(),10)]:f).r1,w=(0===f.r2?e.arc[parseInt(n.toString(),10)]:f).r2,n++):(S=f.r1,w=f.r2),f.angle*(Math.PI/180)),I=f.largeArc,C=f.sweep,P=c,A=p,T={x:Math.cos(x)*(v-P)/2+Math.sin(x)*(b-A)/2,y:-Math.sin(x)*(v-P)/2+Math.cos(x)*(b-A)/2},D=Math.pow(T.x,2)/Math.pow(S,2)+Math.pow(T.y,2)/Math.pow(w,2),D=(1<D&&(S*=Math.sqrt(D),w*=Math.sqrt(D)),Math.pow(w,2)*Math.pow(T.x,2)),I=(I===C?-1:1)*Math.sqrt((Math.pow(S,2)*Math.pow(w,2)-Math.pow(S,2)*Math.pow(T.y,2)-D)/(Math.pow(S,2)*Math.pow(T.y,2)+Math.pow(w,2)*Math.pow(T.x,2))),D=(I=isNaN(I)?0:I)*S*T.y/w,I=I*-w*T.x/S,v={x:(v+P)/2+Math.cos(x)*D-Math.sin(x)*I,y:(b+A)/2+Math.sin(x)*D+Math.cos(x)*I},P=this.a([1,0],[(T.x-D)/S,(T.y-I)/w]),b=[(T.x-D)/S,(T.y-I)/w],A=[(-T.x-D)/S,(-T.y-I)/w],D=this.a(b,A),T=(this.r(b,A)<=-1&&(D=Math.PI),C?1:-1),I=P+(D=1<=this.r(b,A)?0:D)/2*T;Math.cos(I),Math.sin(I);f.centp=v,f.xAxisRotation=x,f.rx=S,f.ry=w,f.a1=P,f.ad=D,f.sweep=C,null!=r&&(b=w<S?S:w,A=w<S?1:S/w,T=w<S?w/S:1,r.save(),r.translate(v.x,v.y),r.rotate(x),r.scale(A,T),r.arc(0,0,b,P,P+D,!C),r.scale(1/A,1/T),r.rotate(-x),r.translate(-v.x,-v.y),r.restore());break;case"Z":case"z":r.closePath(),c=o,p=a}o=c,a=p}},Mp.prototype.drawText=function(t,e,i,n,r,o,a,s){if(e.content&&!0===e.visible){var h=a.groupElement,d=Mp.getContext(t),l=(d.save(),this.setStyle(t,e),o&&(e.fontSize*=o),e.x+e.width*e.pivotX),c=e.y+e.height*e.pivotY,p=(this.applyFlipAndRotate(d,e,t,l,c,a,s),this.setFontStyle(t,e),0),g=e.childNodes,u=e.wrapBounds;if(d.fillStyle=e.color,u)for(var m=this.labelAlign(e,u,g),p=0;p<g.length;p++){var f=g[parseInt(p.toString(),10)],y=(f.x=lp(f,g,p,e),m.x+(o?f.x*o:f.x)-u.x),v=m.y+(o?f.dy*o:f.dy)*p+.8*e.fontSize;if(u.width>e.width&&"Wrap"!==e.textOverflow&&"NoWrap"===e.textWrapping&&(f.text=Ip(f.text,e)),"Clip"!==e.textOverflow&&"Ellipsis"!==e.textOverflow||"Wrap"!==e.textWrapping?d.fillText(f.text,y,v):v<h.actualSize.height+h.bounds.y&&("Ellipsis"===e.textOverflow&&g[p+1]&&(b=g[p+1],m.y+b.dy*(p+1)+.8*e.fontSize>h.actualSize.height+h.bounds.y)&&(f.text=f.text.slice(0,f.text.length-3),f.text=f.text.concat("...")),d.fillText(f.text,y,v)),"Underline"===e.textDecoration||"Overline"===e.textDecoration||"LineThrough"===e.textDecoration){var b=y,S=void 0,y=y+d.measureText(f.text).width,w=void 0;switch(e.textDecoration){case"Underline":w=S=v+2;break;case"Overline":S=m.y+f.dy*p,w=m.y+f.dy*p;break;case"LineThrough":S=(v+m.y+f.dy*p)/2+2,w=(v+m.y+f.dy*p)/2+2}d.beginPath(),d.moveTo(b,S),d.lineTo(y,w),d.strokeStyle=e.color,d.lineWidth=.08*e.fontSize,d.globalAlpha=e.opacity,d.stroke()}}d.restore()}},Mp.prototype.applyFlipAndRotate=function(t,e,i,n,r,o,a){if(e.flip!==Z.FlipDirection.None&&o&&a&&!(a.elementActions&Z.ElementAction.ElementIsPort)){var s=o.groupElement,h=a,d=void 0;if(a instanceof H&&a.position?d=o.renderFlipTextElement(s,i,h,e.flip,e.flipMode,!0):(a instanceof P||a instanceof le||a instanceof H&&!a.position||a instanceof qt)&&(d=o.renderFlipElement(s,i,e.flip,!0)),d&&d.transform)for(var l=/(translate|scale|rotate)\(([^)]+)\)/g,c=void 0;null!==(c=l.exec(d.transform));){var p=c[1],g=c[2].split(",").map(function(t){return parseFloat(t.trim())});switch(p){case"translate":var u=g[0]||0,m=g[1]||0;t.translate(u,m);break;case"scale":u=g[0]||1,m=g[1]||u;t.scale(u,m)}}}this.rotateContext(i,e.angle,n,r)},Mp.prototype.loadImage=function(t,e,i,n,r){var o=new Image;o.src=e.source,this.image(t,o,e.x,e.y,e.width,e.height,e)},Mp.prototype.drawImage=function(t,e,i,n,r,o){var a,s,h,d,l,c=this;e.visible&&((a=Mp.getContext(t)).save(),s=e.x+e.width*e.pivotX,h=e.y+e.height*e.pivotY,(d=new Image).src=e.source,this.setStyle(t,e),(l=a.canvas.id.split("_"))[l.length-1],this.applyFlipAndRotate(a,e,t,s,h,r,o),n?d.onload=function(){c.loadImage(a,e,t,s,h)}:this.loadImage(a,e,t,s,h),a.restore())},Mp.prototype.image=function(t,e,i,n,r,o,a){t.beginPath();var s,h,d,l,c,p,g,u,m,f=e.width,y=e.height,v=r,b=o,S=0,w=0;a&&"None"!==a.alignment?(s=a.alignment.toLowerCase().substr(1,3),h=a.alignment.toLowerCase().substr(5,3),"Slice"===a.scale?(m=function(){w=y*(S=v)/f},u=function(){S=f*b/y,w=b},b<v?(m(),w<b&&u()):v===b?(y<f?u:m)():(u(),S<v&&m()),u=this.getSliceOffset(s,S,v,f),m=this.getSliceOffset(h,w,b,y),d=f-u,l=y-m,c=S-u*(S/f),p=w-m*(w/y),(g=A("canvas",{width:r.toString(),height:o.toString()})).getContext("2d").drawImage(e,u,m,d,l,0,0,c,p),t.drawImage(g,i,n,r,o)):"Meet"===a.scale?(S=(u=y/f)<(m=b/v)?v:b/u,w=u<m?v*u:b,i+=this.getMeetOffset(s,S,v),n+=this.getMeetOffset(h,w,b),t.drawImage(e,0,0,f,y,i,n,S,w)):t.drawImage(e,i,n,r,o)):t.drawImage(e,i,n,r,o),t.closePath()},Mp.prototype.getSliceOffset=function(t,e,i,n){switch(t){case"min":return 0;case"mid":return(e-i)/2*n/e;case"max":return(e-i)*n/e;default:return 0}},Mp.prototype.getMeetOffset=function(t,e,i){var n=Math.max(e,i),r=Math.min(e,i);switch(t){case"min":return 0;case"mid":return(n-r)/2;case"max":return n-r;default:return 0}},Mp.prototype.m=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2))},Mp.prototype.r=function(t,e){return(t[0]*e[0]+t[1]*e[1])/(this.m(t)*this.m(e))},Mp.prototype.a=function(t,e){return(t[0]*e[1]<t[1]*e[0]?-1:1)*Math.acos(this.r(t,e))},Mp.prototype.labelAlign=function(t,e,i){var i=new j(e.width,i.length*(1.2*t.fontSize)),n={x:0,y:0},r=t.x,o=t.y,a=.5*t.width,s=.5*t.height;return"left"===t.textAlign?a=0:"center"===t.textAlign?a=e.width>t.width&&("Ellipsis"===t.textOverflow||"Clip"===t.textOverflow)&&"NoWrap"===t.textWrapping?0:.5*t.width:"right"===t.textAlign&&(a=+t.width),n.x=r+a+(e?e.x:0),n.y=o+s-i.height/2,n};var Op=Mp;function Mp(){}Ep=function(t,e){return(Ep=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)};var Ep,Lp,e=function(t,e){function i(){this.constructor=t}Ep(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},a=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;0<=s;s--)(r=t[s])&&(a=(o<3?r(a):3<o?r(e,i,a):r(e,i))||a);return 3<o&&a&&Object.defineProperty(e,i,a),a},n=(Lp=N.ChildProperty,e(zp,Lp),a([N.Property("")],zp.prototype,"source",void 0),a([N.Property("transparent")],zp.prototype,"color",void 0),a([N.Property("None")],zp.prototype,"scale",void 0),a([N.Property("None")],zp.prototype,"align",void 0),zp);function zp(){return null!==Lp&&Lp.apply(this,arguments)||this}kp=N.ChildProperty,e(Bp,kp),a([N.Property("Page")],Bp.prototype,"mode",void 0),a([N.Property("PageSettings")],Bp.prototype,"region",void 0),a([N.Complex({top:25,bottom:25,left:25,right:25},ft)],Bp.prototype,"margin",void 0),a([N.Property(!1)],Bp.prototype,"canZoomIn",void 0),a([N.Property(void 0)],Bp.prototype,"customBounds",void 0),a([N.Property(!1)],Bp.prototype,"canFit",void 0);var kp,h=Bp;function Bp(){return null!==kp&&kp.apply(this,arguments)||this}Rp=N.ChildProperty,e(Np,Rp),a([N.Property(null)],Np.prototype,"width",void 0),a([N.Property(null)],Np.prototype,"height",void 0),a([N.Complex({},ft)],Np.prototype,"margin",void 0),a([N.Property("Landscape")],Np.prototype,"orientation",void 0),a([N.Property("Infinity")],Np.prototype,"boundaryConstraints",void 0),a([N.Complex({},n)],Np.prototype,"background",void 0),a([N.Property(!1)],Np.prototype,"multiplePage",void 0),a([N.Property(!1)],Np.prototype,"showPageBreaks",void 0),a([N.Complex({},h)],Np.prototype,"fitOptions",void 0);var Rp,d=Np;function Np(){return null!==Rp&&Rp.apply(this,arguments)||this}jp=N.ChildProperty,e(Hp,jp),a([N.Property(0)],Hp.prototype,"horizontalOffset",void 0),a([N.Property(0)],Hp.prototype,"verticalOffset",void 0),a([N.Property(1)],Hp.prototype,"currentZoom",void 0),a([N.Property(0)],Hp.prototype,"viewPortWidth",void 0),a([N.Property(0)],Hp.prototype,"viewPortHeight",void 0),a([N.Property(.2)],Hp.prototype,"minZoom",void 0),a([N.Property(30)],Hp.prototype,"maxZoom",void 0),a([N.Property("Diagram")],Hp.prototype,"scrollLimit",void 0),a([N.Property()],Hp.prototype,"scrollableArea",void 0),a([N.Property(!1)],Hp.prototype,"canAutoScroll",void 0),a([N.Property(100)],Hp.prototype,"autoScrollFrequency",void 0),a([N.Complex({left:15,right:15,top:15,bottom:15},ft)],Hp.prototype,"autoScrollBorder",void 0),a([N.Complex({left:0,right:0,top:0,bottom:0},ft)],Hp.prototype,"padding",void 0),a([N.Property(.2)],Hp.prototype,"zoomFactor",void 0);var jp,n=Hp;function Hp(){return null!==jp&&jp.apply(this,arguments)||this}_p.prototype.register=function(t,e){this.services[""+t]=e},_p.prototype.getService=function(t){return this.services[""+t]};var Wp=_p;function _p(){this.services={}}Yp=function(t,e){return(Yp=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)};var Yp,Xp,h=function(t,e){function i(){this.constructor=t}Yp(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},e=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;0<=s;s--)(r=t[s])&&(a=(o<3?r(a):3<o?r(e,i,a):r(e,i))||a);return 3<o&&a&&Object.defineProperty(e,i,a),a},a=(Xp=N.ChildProperty,h(Vp,Xp),e([N.Property("lightgray")],Vp.prototype,"lineColor",void 0),e([N.Property("")],Vp.prototype,"lineDashArray",void 0),e([N.Property([1.25,18.75,.25,19.75,.25,19.75,.25,19.75,.25,19.75])],Vp.prototype,"lineIntervals",void 0),e([N.Property([1,19,.5,19.5,.5,19.5,.5,19.5,.5,19.5])],Vp.prototype,"dotIntervals",void 0),e([N.Property([20])],Vp.prototype,"snapIntervals",void 0),Vp);function Vp(){return null!==Xp&&Xp.apply(this,arguments)||this}Fp=N.ChildProperty,h(Up,Fp),e([N.Complex({},a)],Up.prototype,"horizontalGridlines",void 0),e([N.Complex({},a)],Up.prototype,"verticalGridlines",void 0),e([N.Property(Z.SnapConstraints.All)],Up.prototype,"constraints",void 0),e([N.Property(5)],Up.prototype,"snapAngle",void 0),e([N.Property("Lines")],Up.prototype,"gridType",void 0),e([N.Property(5)],Up.prototype,"snapObjectDistance",void 0),e([N.Property("#07EDE1")],Up.prototype,"snapLineColor",void 0);var Fp,h=Up;function Up(){return null!==Fp&&Fp.apply(this,arguments)||this}Gp=function(t,e){return(Gp=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)};var Gp,Zp,e=function(t,e){function i(){this.constructor=t}Gp(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Kp=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;0<=s;s--)(r=t[s])&&(a=(o<3?r(a):3<o?r(e,i,a):r(e,i))||a);return 3<o&&a&&Object.defineProperty(e,i,a),a},qp=(Zp=N.ChildProperty,e(Qp,Zp),Kp([N.Property(5)],Qp.prototype,"interval",void 0),Kp([N.Property(100)],Qp.prototype,"segmentWidth",void 0),Kp([N.Property("Horizontal")],Qp.prototype,"orientation",void 0),Kp([N.Property("RightOrBottom")],Qp.prototype,"tickAlignment",void 0),Kp([N.Property("red")],Qp.prototype,"markerColor",void 0),Kp([N.Property(25)],Qp.prototype,"thickness",void 0),Kp([N.Property(null)],Qp.prototype,"arrangeTick",void 0),Qp);function Qp(){return null!==Zp&&Zp.apply(this,arguments)||this}Jp=N.ChildProperty,e($p,Jp),Kp([N.Property(!1)],$p.prototype,"showRulers",void 0),Kp([N.Property(!0)],$p.prototype,"dynamicGrid",void 0),Kp([N.Complex({orientation:"Horizontal"},qp)],$p.prototype,"horizontalRuler",void 0),Kp([N.Complex({orientation:"Vertical"},qp)],$p.prototype,"verticalRuler",void 0);var Jp,e=$p;function $p(){return null!==Jp&&Jp.apply(this,arguments)||this}tg=function(t,e){return(tg=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)};var tg,eg,Kp=function(t,e){function i(){this.constructor=t}tg(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},qp=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;0<=s;s--)(r=t[s])&&(a=(o<3?r(a):3<o?r(e,i,a):r(e,i))||a);return 3<o&&a&&Object.defineProperty(e,i,a),a},Kp=(eg=N.ChildProperty,Kp(ig,eg),qp([N.Property("")],ig.prototype,"property",void 0),qp([N.Property("")],ig.prototype,"field",void 0),ig);function ig(){return null!==eg&&eg.apply(this,arguments)||this}ng=function(t,e){return(ng=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)};var ng,rg,qp=function(t,e){function i(){this.constructor=t}ng(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},og=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;0<=s;s--)(r=t[s])&&(a=(o<3?r(a):3<o?r(e,i,a):r(e,i))||a);return 3<o&&a&&Object.defineProperty(e,i,a),a},ag=(rg=N.ChildProperty,qp(sg,rg),og([N.Property("")],sg.prototype,"read",void 0),og([N.Property("")],sg.prototype,"create",void 0),og([N.Property("")],sg.prototype,"update",void 0),og([N.Property("")],sg.prototype,"destroy",void 0),og([N.Property()],sg.prototype,"customFields",void 0),sg);function sg(){return null!==rg&&rg.apply(this,arguments)||this}hg=N.ChildProperty,qp(lg,hg),og([N.Property("")],lg.prototype,"id",void 0),og([N.Property("")],lg.prototype,"sourceID",void 0),og([N.Property("")],lg.prototype,"targetID",void 0),og([N.Property(null)],lg.prototype,"sourcePointX",void 0),og([N.Property(null)],lg.prototype,"sourcePointY",void 0),og([N.Property(null)],lg.prototype,"targetPointX",void 0),og([N.Property(null)],lg.prototype,"targetPointY",void 0),og([N.Property(null)],lg.prototype,"dataManager",void 0),og([N.Complex({},ag)],lg.prototype,"crudAction",void 0);var hg,dg=lg;function lg(){return null!==hg&&hg.apply(this,arguments)||this}cg=N.ChildProperty,qp(pg,cg),og([N.Property("")],pg.prototype,"id",void 0),og([N.Property(null)],pg.prototype,"dataManager",void 0),og([N.Property(null)],pg.prototype,"dataSource",void 0),og([N.Property("")],pg.prototype,"root",void 0),og([N.Property("")],pg.prototype,"parentId",void 0),og([N.Property()],pg.prototype,"doBinding",void 0),og([N.Collection([],Kp)],pg.prototype,"dataMapSettings",void 0),og([N.Complex({},ag)],pg.prototype,"crudAction",void 0),og([N.Complex({},dg)],pg.prototype,"connectionDataSource",void 0);var cg,qp=pg;function pg(){return null!==cg&&cg.apply(this,arguments)||this}gg=function(t,e){return(gg=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)};var gg,ug,og=function(t,e){function i(){this.constructor=t}gg(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},mg=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;0<=s;s--)(r=t[s])&&(a=(o<3?r(a):3<o?r(e,i,a):r(e,i))||a);return 3<o&&a&&Object.defineProperty(e,i,a),a},fg=(ug=N.ChildProperty,og(yg,ug),mg([N.Property("LeftInFlow")],yg.prototype,"yesBranchDirection",void 0),mg([N.Property("RightInFlow")],yg.prototype,"noBranchDirection",void 0),mg([N.Property(["Yes","True"])],yg.prototype,"yesBranchValues",void 0),mg([N.Property(["No","False"])],yg.prototype,"noBranchValues",void 0),yg);function yg(){return null!==ug&&ug.apply(this,arguments)||this}vg=N.ChildProperty,og(bg,vg),mg([N.Property("")],bg.prototype,"fixedNode",void 0),mg([N.Property(30)],bg.prototype,"horizontalSpacing",void 0),mg([N.Property("SamePoint")],bg.prototype,"connectionPointOrigin",void 0),mg([N.Property("Nonlinear")],bg.prototype,"arrangement",void 0),mg([N.Property(30)],bg.prototype,"verticalSpacing",void 0),mg([N.Property(30)],bg.prototype,"maxIteration",void 0),mg([N.Property(40)],bg.prototype,"springFactor",void 0),mg([N.Property(50)],bg.prototype,"springLength",void 0),mg([N.Complex({left:50,top:50,right:0,bottom:0},ft)],bg.prototype,"margin",void 0),mg([N.Property("Auto")],bg.prototype,"horizontalAlignment",void 0),mg([N.Property("Auto")],bg.prototype,"verticalAlignment",void 0),mg([N.Property("TopToBottom")],bg.prototype,"orientation",void 0),mg([N.Property("Auto")],bg.prototype,"connectionDirection",void 0),mg([N.Property("Default")],bg.prototype,"connectorSegments",void 0),mg([N.Property("None")],bg.prototype,"type",void 0),mg([N.Property()],bg.prototype,"getLayoutInfo",void 0),mg([N.Property()],bg.prototype,"layoutInfo",void 0),mg([N.Property()],bg.prototype,"getBranch",void 0),mg([N.Property()],bg.prototype,"bounds",void 0),mg([N.Property(!0)],bg.prototype,"enableAnimation",void 0),mg([N.Property(!1)],bg.prototype,"enableRouting",void 0),mg([N.Property("")],bg.prototype,"root",void 0),mg([N.Complex({},fg)],bg.prototype,"flowchartLayoutSettings",void 0);var vg,og=bg;function bg(){return null!==vg&&vg.apply(this,arguments)||this}Sg=function(t,e){return(Sg=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)};(function(t,e){function i(){this.constructor=t}Sg(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)})(Ig,wg=en),Ig.prototype.mouseDown=function(t){var e,i=!0;if(t.source&&t.source.connectors&&(e=t.source.connectors[0]),t.info&&t.actualObject&&(i=t.info.ctrlKey&&"Orthogonal"!==t.actualObject.type),e&&i){this.inAction=!0,this.undoElement=Q(t.source),wg.prototype.mouseDown.call(this,t);var i=(e.constraints&Z.ConnectorConstraints.InheritSegmentThumbSize?this.commandHandler.diagram:e).segmentThumbSize,n=20<i&&"Straight"!==e.type?i/2:10;n/=this.commandHandler.diagram.scrollSettings.currentZoom;for(var r=0;r<e.segments.length;r++){var o=e.segments[parseInt(r.toString(),10)];if("OrthoThumb"===this.endPoint)for(var a=0;a<o.points.length-1;a++){var s={x:0,y:0};s.x=(o.points[parseInt(a.toString(),10)].x+o.points[a+1].x)/2,s.y=(o.points[parseInt(a.toString(),10)].y+o.points[a+1].y)/2,ro(this.currentPosition,s,n)&&(this.selectedSegment=o,this.segmentIndex=a)}else ro(this.currentPosition,o.point,n)&&(this.selectedSegment=o)}}},Ig.prototype.mouseMove=function(t){var e,i,n,r,o,a;return wg.prototype.mouseMove.call(this,t),this.currentPosition=t.position,this.currentPosition&&this.prevPosition&&(r=this.currentPosition.y-this.prevPosition.y,n=this.currentPosition.x-this.prevPosition.x,e=void(this.currentPosition=this.commandHandler.snapConnectorEnd(this.currentPosition)),o=void 0,i=!1,t.source&&t.source.connectors&&(e=t.source.connectors[0]),K.equals(this.startPosition,this.prevPosition)&&(i=!0),null===this.oldValue&&(this.oldValue=Q(this.selectedSegment)),a={source:e,state:"Start",oldValue:this.oldValue,newValue:this.oldValue,segment:this.selectedSegment,cancel:!1},a={source:e,state:"Start",oldValue:this.oldValue,newValue:this.oldValue,segment:this.selectedSegment,cancel:!1},i&&!N.isBlazor()&&this.commandHandler.triggerEvent(Z.DiagramEvent.segmentChange,a),a.cancel&&this.commandHandler.diagram.resetTool(),!this.inAction||void 0===this.selectedSegment||void 0===this.endPoint||0==n&&0==r||a.cancel||("OrthoThumb"===this.endPoint?(this.blocked=!this.dragOrthogonalSegment(e,this.selectedSegment,this.currentPosition,this.segmentIndex),null===this.oldValue.length&&null===this.oldValue.direction&&(this.oldValue=Q(this.selectedSegment))):(i=this.currentPosition.x-this.selectedSegment.point.x,n=this.currentPosition.y-this.selectedSegment.point.y,r=e.segments.indexOf(this.selectedSegment),this.blocked=!this.commandHandler.dragControlPoint(e,i,n,!1,r)),o=Q(this.selectedSegment),this.commandHandler.updateSelector(),this.currentPosition=t.position,a={source:e,state:"Progress",oldValue:this.oldValue,newValue:o,segment:this.selectedSegment,cancel:!1},this.commandHandler.triggerEvent(Z.DiagramEvent.segmentChange,a))),this.prevPosition=this.currentPosition,!this.blocked},Ig.prototype.mouseUp=function(t){var e,i,n,r,o;t.source&&t.source.connectors&&(i={segments:(e=t.source.connectors[0]).segments}),t&&t.source&&t.info&&t.info.ctrlKey&&t.info.shiftKey&&"Straight"===e.type?this.addOrRemoveSegment(e,this.currentPosition):"OrthoThumb"===this.endPoint&&this.selectedSegment&&(n=e.segments.indexOf(this.selectedSegment),r=e.segments[n-1],o=e.segments[n+1],n===e.segments.length-2&&this.updateLastSegment(e,this.selectedSegment)?e.segments.splice(e.segments.length-2,1):r&&Math.abs(r.length)<5&&0<r.length?1!==n&&this.removePrevSegment(e,n):o&&(r=K.distancePoints(o.points[0],o.points[1]),o=o.length||0===o.length?o.length:r,Math.abs(o)<=5)&&this.removeNextSegment(e,n),this.commandHandler.updateEndPoint(e,i),e.selectedSegmentIndex=0),this.undoElement&&(r={type:"SegmentChanged",redoObject:Q(t.source),undoObject:this.undoElement,category:"Internal"},this.commandHandler.addHistoryEntry(r)),e.isBezierEditing&&(e.isBezierEditing=!1),this.prevPosition!==this.startPosition&&(o={source:e,state:"Completed",oldValue:this.oldValue,newValue:Q(this.selectedSegment),cancel:!1,segment:this.selectedSegment},this.commandHandler.triggerEvent(Z.DiagramEvent.segmentChange,o)),wg.prototype.mouseUp.call(this,t)},Ig.prototype.removePrevSegment=function(t,e){var i=t.segments[e-2],n=t.segments[e+1];!n||(n.length||0===n.length?n.length:K.distancePoints(n.points[0],n.points[1]))<=5||(n=t.segments.slice(e-1,e+1),this.commandHandler.triggerEvent(Z.DiagramEvent.segmentCollectionChange,n={element:t,removeSegments:n,type:"Removal",cancel:!1}),n.cancel)||(n=t.segments[e+1],t.segments.splice(e-1,2),"Left"===(t=this.selectedSegment).direction||"Right"===t.direction?(i.points[i.points.length-1].x=n.points[0].x,n.points[0].y=i.points[i.points.length-1].y):(i.points[i.points.length-1].y=n.points[0].y,n.points[0].x=i.points[i.points.length-1].x),!t.length&&0!==t.length||this.findSegmentDirection(i),this.findSegmentDirection(n))},Ig.prototype.findSegmentDirection=function(t){t.direction&&(t.length||0===t.length)&&(t.length=K.distancePoints(t.points[0],t.points[t.points.length-1]),t.direction=K.direction(t.points[0],t.points[t.points.length-1]))},Ig.prototype.removeNextSegment=function(t,e){var i,n,r=this.selectedSegment,o=t.segments[e-1],a=t.segments[e+2],s=t.segments[e+1];s.length||0===s.length?(n=t.segments.slice(e,2),this.commandHandler.triggerEvent(Z.DiagramEvent.segmentCollectionChange,i={element:t,removeSegments:n,type:"Removal",cancel:!(i={element:t,removeSegments:n,type:"Removal",cancel:!1})}),i.cancel||(t.segments.splice(e,2),"Top"===r.direction||"Bottom"===r.direction?(a.points[0].y=r.points[0].y,o.points[o.points.length-1].x=a.points[0].x):(a.points[0].x=r.points[0].x,o.points[o.points.length-1].y=a.points[0].y))):(n=t.segments.slice(e+1,1),this.commandHandler.triggerEvent(Z.DiagramEvent.segmentCollectionChange,i={element:t,removeSegments:n,type:"Removal",cancel:!1}),i.cancel||(t.segments.splice(e+1,1),"Top"===r.direction||"Bottom"===r.direction?o.points[o.points.length-1].x=s.points[s.points.length-1].x:o.points[o.points.length-1].y=s.points[s.points.length-1].y,this.findSegmentDirection(o),r.length=r.direction=null)),o&&a&&!i.cancel&&(o.length=K.distancePoints(o.points[0],a.points[0]),o.direction=K.direction(o.points[0],a.points[0]),!a.length&&0!==a.length||(a.length=K.distancePoints(o.points[o.points.length-1],a.points[a.points.length-1]),n=o.points,t=a.points,a.direction=K.direction(n[n.length-1],t[t.length-1])))},Ig.prototype.addOrRemoveSegment=function(t,e,i){for(var n,r,o,a,s,h,d=[],l={segments:t.segments},c=0;c<t.segments.length;c++)ro(e,(a=t.segments[parseInt(c.toString(),10)]).point,t.hitPadding)&&(r=c,n=!0,d.push(a),h={element:t,removeSegments:d,type:"Removal",cancel:!1},i)&&i.triggerEvent(Z.DiagramEvent.segmentCollectionChange,h);this.commandHandler||(this.commandHandler=i),n&&void 0!==r?t.segments&&t.segments[parseInt(r.toString(),10)]&&"Straight"===t.segments[parseInt(r.toString(),10)].type&&(a=t.segments[parseInt(r.toString(),10)],o=t.segments[r+1])&&(t.segments.splice(r,1),o.points[0]=a.points[0]):(this.commandHandler.enableServerDataBinding(!1),o=this.findIndex(t,e),t.segments&&t.segments[parseInt(o.toString(),10)]&&"Straight"===t.segments[parseInt(o.toString(),10)].type&&(a=t.segments[parseInt(o.toString(),10)],(s=new Wa(t,"segments",{type:"Straight",point:e},!0)).points[0]=a.points[0],s.points[1]=e,a.points[0]=e,t.segments.splice(o,0,s),n=!0,d.push(a),this.commandHandler.triggerEvent(Z.DiagramEvent.segmentCollectionChange,h={element:t,addSegments:d,type:"Addition",cancel:!1})),this.commandHandler.enableServerDataBinding(!0)),n&&this.commandHandler.updateEndPoint(t,l)},Ig.prototype.findIndex=function(t,e){for(var i=[],n=0;n<t.segments.length;n++){var r=t.segments[parseInt(n.toString(),10)],o=k.toBounds([r.points[0],r.points[1]]);o.Inflate(t.hitPadding),o.containsPoint(e)&&i.push(r)}if(1===i.length)return t.segments.indexOf(i[0]);for(var a,s,h=void 0,d=void 0,n=0;n<i.length;n++)s=i[parseInt(n.toString(),10)],a=(e.y-s.points[0].y)/(s.points[1].y-e.y),s=(e.x-s.points[0].x)/(s.points[1].x-e.x),a=Math.abs(a-s),0===n&&(h=a,d=0),a<h&&(h=a,d=n);return t.segments.indexOf(i[parseInt(d.toString(),10)])},Ig.prototype.dragOrthogonalSegment=function(t,e,i,n){var r={x:0,y:0},o={segments:t.segments},a=(r.x=(e.points[parseInt(n.toString(),10)].x+e.points[n+1].x)/2,r.y=(e.points[parseInt(n.toString(),10)].y+e.points[n+1].y)/2,i.y-r.y),i=i.x-r.x,r=t.segments.indexOf(e),s=!1;return t.allowNodeOverlap&&(t.selectedSegmentIndex=r||n),-1!==r&&(0===r&&1===t.segments.length&&2===e.points.length?(r=this.addSegments(t,e,i,a,r),s=!0):r!==t.segments.length-1||null!==e.direction&&null!==e.length?0===r&&(r=this.insertFirstSegment(t,e,i,a,r),s=!0):(r=this.addTerminalSegment(t,e,i,a,n),s=!0),r)&&(s&&(this.selectedSegment=e=t.segments[parseInt(r.toString(),10)],this.segmentIndex=0),this.updateAdjacentSegments(t,r,i,a),this.commandHandler.updateEndPoint(t,o)),!0},Ig.prototype.addSegments=function(t,e,i,n,r){var o,a=[],s=K.distancePoints(e.points[0],e.points[1]),h=K.direction(e.points[0],e.points[1]),d=(a.push(new Ua(t,"segments",{type:"Orthogonal",direction:h,length:s/4},!0)),e.points[0].y===e.points[1].y?0<n?"Bottom":"Top":0<i?"Right":"Left"),e=e.points[0].x===e.points[1].x?n:i,n=(a.push(new Ua(t,"segments",{type:"Orthogonal",direction:d,length:e},!0)),a.push(new Ua(t,"segments",{type:"Orthogonal",direction:h,length:s/2},!0)),{element:t,addSegments:a,type:"Addition",cancel:!1});return this.commandHandler.triggerEvent(Z.DiagramEvent.segmentCollectionChange,n),n.cancel||(t.segments=a.concat(t.segments),o=r+2),o},Ig.prototype.insertFirstSegment=function(t,e,i,n,r){var o,a,s,h=[];if(t.sourcePortID&&e.length&&2<t.segments[0].points.length)for(var d=void 0,l=0;l<e.points.length-1;l++){var c,p=K.distancePoints(e.points[parseInt(l.toString(),10)],e.points[l+1]),g=K.direction(e.points[parseInt(l.toString(),10)],e.points[l+1]);0===(c=new Ua(t,"segments",{type:"Orthogonal",direction:g,length:p},!0)).length&&(!d||"Top"!==d.direction&&"Bottom"!==d.direction?c.direction=0<n?"Bottom":"Top":c.direction=0<i?"Right":"Left"),d=c,h.push(c)}else a={type:"Orthogonal",direction:e.direction,length:e.length/3},h.push(new Ua(t,"segments",a,!0)),a="Bottom"===e.direction||"Top"===e.direction?(o=Math.abs(i),0<i?"Right":"Left"):(o=Math.abs(n),0<n?"Bottom":"Top"),c=new Ua(t,"segments",{type:"Orthogonal",direction:a,length:o},!0),h.push(c);var u={element:t,addSegments:h,type:"Addition",cancel:!1};return this.commandHandler.triggerEvent(Z.DiagramEvent.segmentCollectionChange,u),u.cancel||(t.sourcePortID&&e.length&&2<t.segments[0].points.length?(t.segments.splice(0,1),s=1):((u=t.segments[1])&&u.length&&(u.length=a!==u.direction?u.length+o:u.length-o),e.length=(s=2)*e.length/3),t.segments=h.concat(t.segments)),s},Ig.prototype.updateAdjacentSegments=function(t,e,i,n){var r=t.segments[parseInt(e.toString(),10)],o=r.points[r.points.length-1],a=r.points[0],s=!0;"Orthogonal"===r.type&&(r.points[0]=a,r.points[r.points.length-1]=o,t.segments[e-1]&&(s=this.updatePreviousSegment(i,n,t,e)),t.segments.length-1>e)&&s&&(a=t.segments[e+1],this.updateNextSegment(t,r,a,i,n))},Ig.prototype.addTerminalSegment=function(t,e,i,n,r){for(var o,a=t.segments.indexOf(e),s=[],h=t.segments.pop(),d=t.segments[t.segments.length-1],l=d&&"Orthogonal"===d.type?d:null,c=0;c<e.points.length-2;c++)p=K.distancePoints(e.points[parseInt(c.toString(),10)],e.points[c+1]),g=K.direction(e.points[parseInt(c.toString(),10)],e.points[c+1]),o=new Ua(t,"segments",{type:"Orthogonal",length:p,direction:g},!0),s.push(o),l=o;var p,g,d=r,d=(2!==e.points.length&&d!==e.points.length-2||(l&&(l.length+=5),void 0!==d&&(p=2*K.distancePoints(e.points[e.points.length-2],e.points[e.points.length-1])/3,g=K.direction(e.points[e.points.length-2],e.points[e.points.length-1]),d=new Ua(t,"segments",{type:"Orthogonal",length:p,direction:g}),s.push(d))),new Ua(t,"segments",{type:"Orthogonal"},!0));s.push(d);d={element:t,addSegments:s,type:"Addition",cancel:!1};return this.commandHandler.triggerEvent(Z.DiagramEvent.segmentCollectionChange,d),d.cancel?t.segments.push(h):(t.segments=t.segments.concat(s),a+=r),this.commandHandler.updateEndPoint(t),a},Ig.prototype.updatePortSegment=function(t,e,i,n,r){var o,a,s,h,d;1===i&&2===t.points.length&&t.length<0&&(o=e.sourceWrapper.corners,a=e.segments[parseInt(i.toString(),10)],i=e.segments[i+1],h=void 0,s=[],h=new Ua(e,"segments",{type:"Orthogonal",length:13,direction:t.direction}),d=void s.push(h),d="Left"===a.direction?a.points[0].x-(o.middleLeft.x-20):"Right"===a.direction?o.middleRight.x+20-a.points[0].x:"Bottom"===a.direction?o.bottomCenter.y+20-a.points[0].y:a.points[0].y-(o.topCenter.y-20),h=new Ua(e,"segments",{type:"Orthogonal",length:d,direction:a.direction}),s.push(h),a.length=a.length-d,i&&i.length&&i.direction&&(i.direction===t.direction?i.length-=13:i.direction===Ui(t.direction)&&(i.length+=13)),e.segments=s.concat(e.segments),this.selectedSegment=e.segments[3])},Ig.prototype.updatePreviousSegment=function(t,e,i,n){var r=i.segments[parseInt(n.toString(),10)],o=i.segments[n-1],a=(o.points[o.points.length-1]=r.points[0],!i.sourceID||""!==i.sourcePortID),s=!0;return"Orthogonal"===o.type&&("Bottom"===o.direction?o.length+=e:"Top"===o.direction?o.length-=e:"Right"===o.direction?o.length+=t:o.length-=t,""!==i.sourcePortID&&o.length<0&&!i.allowNodeOverlap?this.updatePortSegment(o,i,n,t,e):i.sourceID&&""===i.sourcePortID&&o.length<0&&1===n&&(s=!1,this.updateFirstSegment(i,r)),a)&&this.changeSegmentDirection(o,i),s},Ig.prototype.changeSegmentDirection=function(t,e){e.maxSegmentThumb||t.length<0&&(t.direction=Ui(t.direction),t.length*=-1)},Ig.prototype.updateNextSegment=function(t,e,i,n,r){i.points[0]=e.points[e.points.length-1],i&&"Orthogonal"===i.type&&(i.length||0===i.length)&&("Left"===i.direction||"Right"===i.direction?0!==n&&(i.length="Right"===i.direction?i.length-n:i.length+n,!i.length&&0!==i.length||this.changeSegmentDirection(i,t)):0!==r&&(i.length="Bottom"===i.direction?i.length-r:i.length+r,!i.length&&0!==i.length||this.changeSegmentDirection(i,t)))},Ig.prototype.updateFirstSegment=function(t,e){var i,e=t.segments.indexOf(e),n=!1,r=t.segments[parseInt(e.toString(),10)],o=t.segments[e-1],a={segments:t.segments};if(o.length<0&&t.sourceID){var s,h=t.sourceWrapper.corners,d=[],l=!1,c=(this.changeSegmentDirection(r,t),t.segments[e+1]),p=t.segments[e+2];switch(c&&this.changeSegmentDirection(c,t),p&&this.changeSegmentDirection(p,t),o.direction){case"Top":case"Bottom":i=0<r.length&&"Left"===r.direction?h.middleLeft:h.middleRight,r.length>h.width/2?Math.abs(o.length)<h.height/2&&(o.length=K.distancePoints(h.center,o.points[o.points.length-1]),r.points[0].x=i.x,r.length=K.distancePoints(r.points[0],r.points[r.points.length-1]),r.length-=20,n=!0):(c&&c.direction&&c.length&&(c.points[0].y=i.y,c.points[0].x=c.points[c.points.length-1].x="Right"===r.direction?i.x+20:i.x-20),l=n=!0);break;case"Left":case"Right":i=0<r.length&&"Top"===r.direction?h.topCenter:h.bottomCenter,r.length>h.height/2?Math.abs(o.length)<h.width/2&&(o.length=K.distancePoints(h.center,o.points[o.points.length-1]),r.points[0].y=i.y,r.length=K.distancePoints(r.points[0],r.points[r.points.length-1]),r.length-=20,n=!0):(c&&c.direction&&c.length&&(c.points[0].x=i.x,c.points[0].y=c.points[c.points.length-1].y="Bottom"===r.direction?i.y+20:i.y-20),l=n=!0)}this.changeSegmentDirection(o,t),this.changeSegmentDirection(r,t),n&&(s={type:"Orthogonal",direction:r.direction,length:20},d.push(new Ua(t,"segments",s,!0)),l&&(c&&c.direction&&c.length&&(c.length=K.distancePoints(c.points[0],c.points[c.points.length-1])),p&&p.direction&&p.length&&(p.length=K.distancePoints(c.points[c.points.length-1],p.points[p.points.length-1])),t.segments.splice(e-1,2)),t.segments=d.concat(t.segments)),this.selectedSegment=l?t.segments[e-1]:t.segments[e+1],this.commandHandler.updateEndPoint(t,a)}},Ig.prototype.updateLastSegment=function(t,e){var i,n,r,o,a,s;return!(!t.targetID||""!==t.targetPortID)&&(s=r=n=i=void 0,t=t.targetWrapper.corners,o=e.points[0],a=e.points[e.points.length-1],s="Right"===e.direction||"Left"===e.direction?(i={x:o.x,y:o.y},n={x:"Left"===e.direction?a.x-t.width/2:a.x+t.width/2,y:a.y},r={x:t.center.x,y:t.center.y-t.height},{x:t.center.x,y:t.center.y+t.height}):(i={x:o.x,y:o.y},n={x:a.x,y:"Bottom"===e.direction?a.y+t.height/2:a.y-t.height/2},r={x:t.center.x-t.width,y:t.center.y},{x:t.center.x+t.width,y:t.center.y}),lh({x1:i.x,y1:i.y,x2:n.x,y2:n.y},{x1:r.x,y1:r.y,x2:s.x,y2:s.y}).enabled)},Ig.prototype.destroy=function(){},Ig.prototype.getModuleName=function(){return"ConnectorEditingTool"};var Sg,wg,xg=Ig;function Ig(t,e){t=wg.call(this,t,!0)||this;return t.oldValue=null,t.endPoint=e,t}Object.defineProperty(c.prototype,"action",{get:function(){return this.currentAction},set:function(t){t!==this.currentAction&&("PortDraw"===this.currentAction&&(this.diagram.tool&=~Z.DiagramTools.DrawOnce,this.diagram.currentDrawingObject&&(this.diagram.currentDrawingObject=null),this.tool&&this.tool.mouseUp({position:this.currentPosition}),this.tool=null),"Rotate"===t||"LabelRotate"===t?this.diagram.diagramCanvas.classList.add("e-diagram-rotate"):"Rotate"!==this.currentAction&&"LabelRotate"!==this.currentAction||this.diagram.diagramCanvas.classList.remove("e-diagram-rotate"),this.currentAction=t,"None"===this.currentAction||"Select"===this.currentAction||this.diagram.diagramActions&Z.DiagramAction.TextEdit||this.currentPosition&&this.commandHandler.isUserHandle(this.currentPosition)||"FixedUserHandle"===this.currentAction?this.diagram.diagramActions=this.diagram.diagramActions&~Z.DiagramAction.ToolAction:this.diagram.diagramActions=this.diagram.diagramActions|Z.DiagramAction.ToolAction,this.diagram.setCursor(this.diagram.getCursor(t,this.inAction)))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"blocked",{get:function(){return this.isBlocked},set:function(t){this.isBlocked=t,this.blocked?this.diagram.setCursor("not-allowed"):this.diagram.setCursor(this.diagram.getCursor(this.action,this.inAction))},enumerable:!0,configurable:!0}),c.prototype.getMousePosition=function(t){var t=(-1!==t.type.indexOf("touch")?(e=t.changedTouches[0].clientX,t.changedTouches[0]):(e=t.clientX,t)).clientY,e=this.diagram.modifyClientOffset(e),i=(t=this.diagram.modifyClientOffset(t),new j,xs(this.diagram)),n=this.diagram.element.getBoundingClientRect();return this.diagram.modifyBounds(n),e=e+this.diagram.diagramCanvas.scrollLeft-n.left-i.width,t=t+this.diagram.diagramCanvas.scrollTop-n.top-i.height,e/=this.diagram.scroller.transform.scale,t/=this.diagram.scroller.transform.scale,{x:e-=this.diagram.scroller.transform.tx,y:t-=this.diagram.scroller.transform.ty}},c.prototype.windowResize=function(t){var e=this;return this.resizeTo&&clearTimeout(this.resizeTo),this.resizeTo=setTimeout(function(){e.updateViewPortSize(e.diagram.element)},300),!1},c.prototype.updateViewPortSize=function(t){t=document.getElementById(t.id);if(t){var t=t.getBoundingClientRect(),t=(this.diagram.modifyBounds(t),this.diagram.scroller.setViewPortSize(t.width,t.height),new j,xs(this.diagram)),e=this.diagram.getSizeValue(this.diagram.width,t.width),t=this.diagram.getSizeValue(this.diagram.height,t.height);if(this.diagram.diagramCanvas.style.width=e,this.diagram.diagramCanvas.style.height=t,this.diagram.scroller.setSize(),this.diagram.transformLayers(),this.diagram.rulerSettings.showRulers&&Ss(this.diagram),1<this.diagram.views.length)for(var i=0,n=this.diagram.views;i<n.length;i++){var r=n[i],r=this.diagram.views[""+r];r instanceof Zs&&r.onPropertyChanged({sourceID:r.sourceID},{})}}},c.prototype.canHideResizers=function(){return(this.tool instanceof Po||this.tool instanceof Do)&&this.isMouseDown},c.prototype.updateCursor=function(){var t;1!==this.diagram.selectedItems.nodes.length&&1!==this.diagram.selectedItems.connectors.length||(t=(t=[]).concat(this.diagram.selectedItems.nodes,this.diagram.selectedItems.connectors),this.blocked=!(this.eventArgs&&this.eventArgs.source&&!bn(this.eventArgs.source))&&this.isMouseDown&&1===t.length&&this.tool instanceof fo&&!bn(t[0]))},c.prototype.isForeignObject=function(t,e){var i=t;if(i)for(;null!==i.parentNode;){if("string"==typeof i.className&&(!e&&-1!==i.className.indexOf("foreign-object")||e&&-1!==i.className.indexOf("e-diagram-text-edit")))return i;i=i.parentNode}return null},c.prototype.isMetaKey=function(t){return"mousewheel"!==t.type&&navigator.platform.match("Mac")?t.metaKey:t.ctrlKey},c.prototype.renderUmlHighLighter=function(t){this.diagram.commandHandler.removeStackHighlighter();var e,i=this.diagram.selectedItems.nodes[0];i&&i.container&&"Stack"===i.container.type&&"UmlClassifier"===i.shape.type&&(i.wrapper.bounds.containsPoint(this.currentPosition)||(e=this.diagram.findObjectsUnderMouse({x:this.currentPosition.x-20,y:this.currentPosition.y}),(e=this.diagram.findObjectUnderMouse(e,this.action,this.inAction))&&e.parentId&&e.parentId===i.id&&(i="Vertical"===this.diagram.nameTable[e.parentId].container.orientation,to(e.wrapper,i,t.position,this.diagram,!0))))},c.prototype.isDeleteKey=function(t,e){return navigator.platform.match("Mac")&&"Backspace"===t&&"delete"===e},c.prototype.isMouseOnScrollBar=function(t){var e,i=t.offsetX,t=t.offsetY,n=this.diagram.diagramCanvas,r=n.offsetHeight,o=n.offsetWidth;return!!(r<n.scrollHeight&&(e=k.toBounds([{x:o-17,y:0},{x:o,y:0},{x:o-17,y:r},{x:o,y:r}]),0!==this.diagram.scroller.verticalOffset&&(e.x=e.x-this.diagram.scroller.horizontalOffset,e.y=e.y-this.diagram.scroller.verticalOffset),e.containsPoint({x:i,y:t})))||!!(o<n.scrollWidth&&(e=k.toBounds([{x:0,y:r-17},{x:o,y:r-17},{x:0,y:r},{x:o,y:r}]),0!==this.diagram.scroller.horizontalOffset&&(e.x=e.x-this.diagram.scroller.horizontalOffset,e.y=e.y-this.diagram.scroller.verticalOffset),e.containsPoint({x:i,y:t})))},c.prototype.updateVirtualization=function(){var e=this,i=setInterval(function(t){e.diagram.removeVirtualObjects(i)},50);setTimeout(function(){e.diagram.deleteVirtualObject=!0},50)},c.prototype.checkPreviousAction=function(){if(this.action!==this.previousAction&&this.diagram.selectedItems.userHandles.length)for(var t=0;t<this.diagram.selectedItems.userHandles.length;t++)this.previousAction&&this.diagram.selectedItems.userHandles[parseInt(t.toString(),10)]&&(this.checkUserHandleEvent(Z.DiagramEvent.onUserHandleMouseLeave),this.previousAction="None");this.action!==this.previousAction&&(this.checkFixedUserHandleEvent(Z.DiagramEvent.onFixedUserHandleMouseLeave,this.targetItem,this.previousTarget),this.previousTarget=null,this.targetItem=null)},c.prototype.checkUserHandleEvent=function(t){if(this.diagram.selectedItems&&0<this.diagram.selectedItems.userHandles.length)for(var e=t===Z.DiagramEvent.onUserHandleMouseLeave?this.previousAction:this.action,i={element:void 0},n=0;n<this.diagram.selectedItems.userHandles.length;n++)(e===this.diagram.selectedItems.userHandles[parseInt(n.toString(),10)].name||t===Z.DiagramEvent.onUserHandleMouseUp&&"Select"===e)&&(i.element=this.diagram.selectedItems.userHandles[parseInt(n.toString(),10)],this.userHandle(t,n,i,null))},c.prototype.userHandle=function(t,e,i,n){var r;t!==Z.DiagramEvent.onUserHandleMouseEnter&&t!==Z.DiagramEvent.onFixedUserHandleMouseEnter||(this.previousAction=this.action,i.element.tooltip&&"Auto"===i.element.tooltip.openOn&&""!==i.element.tooltip.content&&(De(this.diagram,i.element),r=void 0,i.element.pathData?t===Z.DiagramEvent.onUserHandleMouseEnter?r=document.getElementById(this.diagram.selectedItems.userHandles[parseInt(e.toString(),10)].name+"_userhandle"):t===Z.DiagramEvent.onFixedUserHandleMouseEnter&&(r=document.getElementById(n.id+"_"+n.fixedUserHandles[parseInt(e.toString(),10)].id+"_groupElement")):r=i.element.source?document.getElementById(this.diagram.selectedItems.userHandles[parseInt(e.toString(),10)].name+"_image"):i.element.content?document.getElementById(this.diagram.selectedItems.userHandles[parseInt(e.toString(),10)].name+"_shape_native_element"):document.getElementById(this.diagram.selectedItems.userHandles[parseInt(e.toString(),10)].name+"_shape_html_element"),"Auto"===i.element.tooltip.openOn)&&i.element!==this.isUserHandleHover&&(this.isUserHandleHover=i.element,this.diagram.tooltipObject.open(r)),this.diagram.triggerEvent(t,i)),t===Z.DiagramEvent.onUserHandleMouseDown?(this.userHandleObject=this.diagram.selectedItems.userHandles[parseInt(e.toString(),10)].name,this.diagram.triggerEvent(t,i)):t===Z.DiagramEvent.onFixedUserHandleMouseDown&&this.diagram.triggerEvent(t,i),t===Z.DiagramEvent.onUserHandleMouseUp?(n=document.getElementById(this.diagram.selectedItems.userHandles[parseInt(e.toString(),10)].name+"_userhandle"),this.commandHandler.isUserHandle(this.currentPosition)&&n&&n.id===this.userHandleObject+"_userhandle"&&this.diagram.triggerEvent(t,i)):t===Z.DiagramEvent.onFixedUserHandleMouseUp&&this.diagram.triggerEvent(t,i),t!==Z.DiagramEvent.onUserHandleMouseLeave&&t!==Z.DiagramEvent.onFixedUserHandleMouseLeave||(this.diagram.tooltipObject&&"Custom"!==this.diagram.tooltipObject.openOn&&(this.isUserHandleHover=null,this.diagram.tooltipObject.close()),this.diagram.triggerEvent(t,i))},c.prototype.checkFixedUserHandleEvent=function(t,e,i){if(e&&0<e.fixedUserHandles.length)for(var n,r={element:void 0},o=void 0,a=0;a<e.fixedUserHandles.length;a++)n=e.fixedUserHandles[parseInt(a.toString(),10)].id,i&&i.id&&-1<i.id.indexOf(n)&&(o=n,this.previousTarget=i,this.targetItem=e),o===e.fixedUserHandles[parseInt(a.toString(),10)].id&&(r.element=e.fixedUserHandles[parseInt(a.toString(),10)],this.userHandle(t,a,r,e))},c.prototype.mouseDown=function(t){var e=this;if("touchstart"===t.type&&(this.timeOutTapHold=setTimeout(function(){"Select"!==e.action&&"Drag"!==e.action||e.mouseMove(t,void 0)},500)),!(!0===this.inAction&&(this.tool instanceof ko||this.tool instanceof No)||!0===this.inAction&&t.buttons&&0!=(t.buttons&t.buttons-1))){this.focus=!0;var i=t.touches,n=!!document.getElementsByClassName("e-dragclone")[0];if(this.isMouseOnScrollBar(t)&&!n)this.isScrolling=!0,t.preventDefault();else{if(this.checkFixedUserHandleEvent(Z.DiagramEvent.onFixedUserHandleMouseDown,this.targetItem,this.previousTarget),this.checkUserHandleEvent(Z.DiagramEvent.onUserHandleMouseDown),!this.checkEditBoxAsTarget(t)&&Hn(this.diagram)||Bn(this.diagram)&&!jn(this.diagram))if("Select"!==this.action&&"Drag"!==this.action||this.diagram.updatePortVisibility(this.hoverElement,Z.PortVisibility.Hover,!0),!(this.tool instanceof Jo||this.tool instanceof ea)||2!==t.button&&2!==t.buttons)if(!0===this.inAction&&!0===this.isMouseDown&&(this.tool instanceof Jo||this.tool instanceof ea))this.isMouseDown=!0,this.eventArgs={},this.getMouseEventArgs(this.currentPosition,this.eventArgs),this.eventArgs.position=this.currentPosition,this.tool.mouseDown(this.eventArgs);else{this.isMouseDown=!0,this.currentPosition=this.prevPosition=this.getMousePosition(t),this.eventArgs={},this.diagram.textEditing&&!this.isMouseOnScrollBar(t)&&(this.diagram.endEdit(),this.diagram.textEditing=!1,"Canvas"===this.diagram.mode)&&1!==this.diagram.scroller.currentZoom&&this.diagram.refreshDiagramLayer();var n=this.getTargetElement(),n=(this.action=this.diagram.findActionToBeDone(n.obj,n.sourceElement,this.currentPosition,n.target),this.isMetaKey(t)),r=(n&&t.shiftKey&&this.diagram.connectorEditingToolModule?this.action="SegmentEnd":(n||t.shiftKey)&&(zn(this.diagram)||kn(this.diagram))&&(this.action="Select"),this.tool=this.diagram.getTool(this.action),this.tool||(this.action="Select",this.tool=this.diagram.getTool(this.action)),this.getMouseEventArgs(this.currentPosition,this.eventArgs),(n||t.shiftKey)&&(n=n&&t.shiftKey?{ctrlKey:n,shiftKey:t.shiftKey}:{ctrlKey:!0},this.eventArgs.info=n),this.eventArgs.position=this.currentPosition,this.diagram.selectedItems.nodes);if(this.tool.mouseDown(this.eventArgs),this.diagram.selectedItems.canToggleSelection&&r&&this.diagram.selectedItems.nodes&&this.tool instanceof Po)for(var o=0;o<r.length;o++)r[parseInt(o.toString(),10)].id!==this.diagram.selectedItems.nodes[parseInt(o.toString(),10)].id&&(this.isSwimlaneSelected=!0);this.initialEventArgs={source:this.eventArgs.source,sourceWrapper:this.eventArgs.sourceWrapper},this.initialEventArgs.position=this.currentPosition,this.initialEventArgs.info=this.eventArgs.info,this.inAction=!1,"touchstart"===t.type&&(i&&2<=i.length&&(this.touchStartList=np(this.touchStartList,0,i)),i||t.preventDefault())}else{this.diagram,this.currentPosition,t.buttons,this.eventArgs.actualObject,0===t.button||t.button;this.inAction=!1,this.tool.mouseUp(this.eventArgs)}this.isForeignObject(t.target)||this.isForeignObject(t.target,!0)||i||t.preventDefault()}}},c.prototype.mouseMoveExtend=function(t,e){(this.tool instanceof Jo||this.tool instanceof ea)&&this.tool.mouseMove(this.eventArgs),this.diagram.scrollSettings.canAutoScroll?this.checkAutoScroll(t):this.blocked||this.tool.mouseMove(this.eventArgs),this.eventArgs.target&&(this.hoverElement=this.eventArgs.target);t=!(this.eventArgs.target instanceof _||this.eventArgs.target instanceof W)||!(e instanceof _||e instanceof W);this.tool instanceof xo&&this.diagram.updatePortVisibility(this.hoverElement instanceof _||this.hoverElement instanceof W?this.hoverElement:this.hoverNode,Z.PortVisibility.Connect|Z.PortVisibility.Hover,t),this.hoverElement instanceof _&&this.hoverNode instanceof _&&this.hoverNode&&this.hoverNode.id!==this.hoverElement.id&&this.diagram.updatePortVisibility(this.hoverNode,Z.PortVisibility.Connect|Z.PortVisibility.Hover,!0),this.hoverElement instanceof W&&0<this.hoverElement.ports.length&&this.diagram.updatePortVisibility(this.hoverElement,Z.PortVisibility.Connect|Z.PortVisibility.Hover,!0),this.previousElement instanceof _&&this.hoverElement&&this.previousElement.id!==this.hoverElement.id&&this.diagram.updatePortVisibility(this.previousElement,Z.PortVisibility.Connect|Z.PortVisibility.Hover,!0),this.previousElement=this.hoverElement,""!==this.diagram.tooltip.content&&(this.hoverElement=null),this.hoverNode=t?null:e},c.prototype.checkAction=function(t){var e;"LabelSelect"===this.action&&this.eventArgs.sourceWrapper&&(this.eventArgs.sourceWrapper instanceof H||this.eventArgs.sourceWrapper instanceof an)?(e=this.commandHandler.findTarget(this.eventArgs.sourceWrapper,this.eventArgs.source),!so(this.diagram,e,!1,this.eventArgs.sourceWrapper)&&bn(e)&&(this.action="LabelDrag",this.tool=this.getTool(this.action),this.tool.mouseDown(this.initialEventArgs))):bn(t)&&vn(t)&&this.initialEventArgs&&this.initialEventArgs.source&&"Select"===this.action&&(!so(this.diagram,this.eventArgs.source,!1)&&this.eventArgs.source instanceof B&&this.getMouseEventArgs(this.currentPosition,this.eventArgs),t instanceof W&&(!(t instanceof W)||ro(this.currentPosition,t.sourcePoint,t.hitPadding)||ro(this.currentPosition,t.targetPoint,t.hitPadding))||(this.action="Drag"),this.tool=this.getTool(this.action),this.tool.mouseDown(this.initialEventArgs))},c.prototype.isSwimlaneElements=function(t){return!t||!(t.isLane||t.isPhase||t.isHeader)},c.prototype.canShowTouchTooltip=function(t){return!!("touchstart"===t.type&&this.diagram.tool&Z.DiagramTools.SingleSelect&&this.diagram.tool&Z.DiagramTools.ZoomPan)&&!(this.isMouseDown=!1)},c.prototype.mouseMove=function(t,e){var i,n,r,o,a,s,h,d;this.focus=!0,"touchmove"===t.type&&(this.touchArgs={target:t.target,type:"touchmove"}),this.isScrolling?t.preventDefault():(Hn(this.diagram)||Bn(this.diagram)&&!jn(this.diagram))&&(this.currentPosition=this.getMousePosition(t),i=this.diagram.findObjectsUnderMouse(this.currentPosition),i=this.diagram.findObjectUnderMouse(i,this.action,this.inAction),h=this.diagram,d=this.currentPosition,h.rulerSettings.showRulers&&(h.hRuler.drawRulerMarker(h.hRuler.element,d,h.scroller.horizontalOffset),h.vRuler.drawRulerMarker(h.vRuler.element,d,h.scroller.verticalOffset)),d=!1,h=void 0,"touchmove"===t.type&&(e=t.touches)&&1<e.length&&(this.touchMoveList=np(this.touchMoveList,0,e),"PinchZoom"!==this.action)&&(d=!0),!1===K.equals(this.currentPosition,this.prevPosition)||this.inAction||this.canShowTouchTooltip(t))&&(!1===this.isMouseDown||d?(this.eventArgs={},a=void 0,(s=null)!==i&&((a=!((a=(s=this.diagram.findElementUnderMouse(i,this.currentPosition,this.diagram))?this.commandHandler.findTarget(s,i):a)instanceof Ze||a instanceof Qe)||a.tooltip&&""!==a.tooltip.content?a:i)!==this.hoverElement?(o=this.getContent(),this.hoverElement&&"Auto"===this.hoverElement.tooltip.openOn&&""!==o&&this.elementLeave(),this.diagram.updatePortVisibility(this.hoverElement,Z.PortVisibility.Hover,!0),i instanceof _&&(this.hoverNode=i),o=!0,!this.isSwimlaneElements(i)&&this.hoverElement&&this.isSwimlaneElements(this.hoverElement)&&(o=!1),this.hoverElement=o?i:this.hoverElement,n=null,r=void 0,r=void((n=this.diagram.findElementUnderMouse(i,this.currentPosition,this.diagram))instanceof P&&((r=this.commandHandler.findTarget(n,i))instanceof Be||r instanceof je)&&this.hoverElement.constraints&Z.PortConstraints.ToolTip&&(this.hoverElement=r)),n instanceof H&&((r=this.commandHandler.findTarget(n,i))instanceof Ze||r instanceof Qe)&&r.constraints&Z.AnnotationConstraints.Tooltip&&(this.hoverElement=r),o?this.elementEnter(this.currentPosition,!1):this.hoverElement=i):this.hoverElement&&this.hoverElement===a&&this.hoverElement.tooltip.content&&void 0!==this.diagram.tooltipObject&&"Mouse"===this.hoverElement.tooltip.relativeMode&&this.setTooltipOffset(this.currentPosition),s)&&(h=this.commandHandler.findTarget(s,i)),this.action=this.diagram.findActionToBeDone(i,s,this.currentPosition,h),this.checkFixedUserHandleEvent(Z.DiagramEvent.onFixedUserHandleMouseEnter,i,s),this.checkUserHandleEvent(Z.DiagramEvent.onUserHandleMouseEnter),this.checkPreviousAction(),this.getMouseEventArgs(this.currentPosition,this.eventArgs),this.tool=this.getTool(this.action),this.mouseEvents(),this.tool instanceof No||this.tool instanceof ea||this.tool instanceof Jo?this.tool.mouseMove(this.eventArgs):e&&this.tool instanceof Xo&&this.tool.mouseDown(this.eventArgs),this.updateCursor(),this.renderUmlHighLighter(this.eventArgs),n=!1,this.hoverElement&&!(this.tool instanceof Xo)&&i instanceof _&&this.isSwimlaneElements(i)&&(0===this.diagram.selectedItems.nodes.length||!so(this.diagram,this.hoverElement))||this.hoverElement instanceof W||(n=!0),this.hoverElement&&!(this.tool instanceof Xo)&&i instanceof W&&(0===this.diagram.selectedItems.connectors.length||!so(this.diagram,this.hoverElement))||this.hoverElement instanceof _||(n=!0),this.diagram.updatePortVisibility(this.hoverElement,Z.PortVisibility.Hover,n),r=this.getContent(),null===i&&this.hoverElement&&"Auto"===this.hoverElement.tooltip.openOn&&r&&(this.hoverElement=null,this.elementLeave()),d=!1):(this.eventArgs.position=this.currentPosition,"Drag"===this.action&&!so(this.diagram,this.eventArgs.source,!1)&&this.eventArgs.source instanceof B&&this.getMouseEventArgs(this.currentPosition,this.eventArgs),this.mouseEvents(),(t.ctrlKey||t.shiftKey)&&(o=t.ctrlKey&&t.shiftKey?{ctrlKey:t.ctrlKey,shiftKey:t.shiftKey}:{ctrlKey:!0},this.eventArgs.info=o),this.checkAction(i),a=this.getConnectorPadding(this.eventArgs),this.getMouseEventArgs(this.currentPosition,this.eventArgs,this.eventArgs.source,a),this.updateCursor(),this.inAction=!0,this.initialEventArgs=null,"Drag"!==this.action&&"Rotate"!==this.action||(this.diagram.diagramActions=this.diagram.diagramActions|Z.DiagramAction.Interactions),h=this.diagram.scroller.getPageBounds(),this.mouseMoveExtend(t,i),s=this.diagram.scroller.getPageBounds(),!i||h.width===s.width&&h.height===s.height&&h.x===s.x&&h.y===s.y||this.diagram.views&&this.diagram.views.overview&&(e=this.diagram.views.overview).updateView(e)),this.prevPosition=this.currentPosition,this.isForeignObject(t.target,!0)||t.preventDefault())},c.prototype.getContent=function(){var t,e=this.hoverElement instanceof _&&this.hoverElement.constraints&Z.NodeConstraints.Tooltip||this.hoverElement instanceof W&&this.hoverElement.constraints&Z.ConnectorConstraints.Tooltip||(this.hoverElement instanceof Be||this.hoverElement instanceof je)&&this.hoverElement.constraints&Z.PortConstraints.ToolTip||(this.hoverElement instanceof Ze||this.hoverElement instanceof Qe)&&this.hoverElement.constraints&Z.AnnotationConstraints.Tooltip,i=this.hoverElement,i=(i instanceof _&&i.children&&0<i.children.length&&(t=this.findIntersectChild(i)),(e?this.hoverElement:this.diagram).tooltip.content);return t?t.tooltip.content:i},c.prototype.findIntersectChild=function(t){for(var e,i=new k(this.currentPosition.x,this.currentPosition.y,8,8),n=0;n<t.children.length;n++)if((e=this.diagram.getObject(t.children[parseInt(n.toString(),10)])).wrapper.outerBounds.intersects(i))return e;return null},c.prototype.checkAutoScroll=function(e){var i,n,r=this.startAutoScroll(e);!r&&this.doingAutoScroll?(this.doingAutoScroll=!1,clearInterval(this.timeOutValue)):r?(this.tool instanceof ko||this.tool instanceof No||this.tool instanceof Po||this.tool instanceof Eo||this.tool instanceof fo||this.tool instanceof xo)&&this.inAction&&(((n=(i=this).diagram.scrollSettings.autoScrollFrequency)<10||isNaN(n))&&(n=100),this.diagram.scrollSettings.canAutoScroll)&&r&&!this.doingAutoScroll&&(this.doingAutoScroll=!0,this.timeOutValue=setInterval(function(t){i.doAutoScroll(r,e,n)},n)):this.blocked=!this.tool.mouseMove(this.eventArgs)},c.prototype.mouseUp=function(t){clearTimeout(this.timeOutTapHold),this.touchArgs=void 0,this.diagram.diagramRenderer.touchMove=void 0,this.eventArgs&&this.eventArgs.target&&this.eventArgs.target!==this.hoverNode&&this.eventArgs.target!==this.lastObjectUnderMouse&&(this.hoverNode=this.eventArgs.target,this.lastObjectUnderMouse=this.eventArgs.target);var e=!1,i=((this.tool instanceof Po||this.tool instanceof Do)&&(e=!0),this.checkFixedUserHandleEvent(Z.DiagramEvent.onFixedUserHandleMouseUp,this.targetItem,this.previousTarget),this.checkUserHandleEvent(Z.DiagramEvent.onUserHandleMouseUp),"SVG"===this.diagram.mode&&Ln(this.diagram)&&this.updateVirtualization(),this.diagram.selectedItems.nodes),n=this.diagram.selectedItems.connectors,r=(this.diagram.previousSelectedObject=null,this.diagram.diagramRenderer.rendererActions=this.diagram.removeConstraints(this.diagram.diagramRenderer.rendererActions,Z.RendererAction.DrawSelectorBorder),t.touches);if(this.isScrolling)this.isScrolling=!1,t.preventDefault();else{if(!this.checkEditBoxAsTarget(t)&&Hn(this.diagram)||Bn(this.diagram)&&!jn(this.diagram)){if(this.tool&&(!(this.tool instanceof Jo||this.tool instanceof ea)||(this.tool instanceof Jo||this.tool instanceof ea)&&2===t.detail)){!this.isForeignObject(t.target)&&this.isMouseDown&&document.getElementById(this.diagram.element.id+"content").focus(),this.inAction||3===t.which||"Drag"===this.action&&(this.action="Select",a=this.diagram.selectedItems.nodes.concat(this.diagram.selectedItems.connectors),o=this.diagram.findObjectsUnderMouse(this.currentPosition),o=this.diagram.findObjectUnderMouse(o,this.action,this.inAction),s=!0,!t.ctrlKey&&this.isMouseDown&&1<this.diagram.selectedItems.nodes.length+this.diagram.selectedItems.connectors.length&&1===t.which&&!(this.diagram.diagramActions&Z.DiagramAction.PreventClearSelection)&&(s=!1,this.commandHandler.clearSelection()),so(this.diagram,o)&&s||(this.commandHandler.selectObjects([o],void 0,a),this.diagram.selectedItems.canToggleSelection&&((s=this.diagram.selectedItems.nodes)?s[0].parentObj instanceof Ac&&(u=!0):0<this.diagram.selectedItems.connectors.length&&(u=!0))));var o=!1,a=this.updateContainerProperties(),s=void 0;if(this.addUmlNode(),this.inAction=!1,this.isMouseDown=!1,this.diagram.selectedObject.helperObject&&(s=this.updateContainerBounds()),this.tool&&(this.tool.prevPosition||this.tool instanceof Ko)){this.eventArgs.position=this.currentPosition;var h=this.getConnectorPadding(this.eventArgs),h=(this.getMouseEventArgs(this.currentPosition,this.eventArgs,this.eventArgs.source,h),this.isMetaKey(t));if((h||t.shiftKey)&&(h=h&&t.shiftKey?{ctrlKey:h,shiftKey:t.shiftKey}:{ctrlKey:!0},this.eventArgs.info=h),this.diagram.diagramActions&Z.DiagramAction.Interactions&&(this.diagram.diagramActions=this.diagram.diagramActions&~Z.DiagramAction.Interactions),this.eventArgs.clickCount=t.detail,this.diagram.selectedObject.helperObject&&(this.tool instanceof Po||this.tool instanceof Eo))this.diagram.selectedObject.actualObject&&""!==this.diagram.selectedObject.actualObject.parentId&&(h=this.diagram.getObject(this.diagram.selectedObject.actualObject.parentId))&&h.isLane&&(this.commandHandler.isContainer=!0),(o=this.diagram.lineRoutingModule&&this.diagram.nameTable.helper&&this.eventArgs.target&&this.eventArgs.target.isLane&&(this.eventArgs.source instanceof B&&0<this.eventArgs.source.nodes.length&&""===this.eventArgs.source.nodes[0].parentId||""===this.eventArgs.source.parentId))&&(this.diagram.diagramActions=this.diagram.diagramActions|Z.DiagramAction.PreventLaneContainerUpdate),this.tool.mouseUp(this.eventArgs,a.isPreventHistory);else{if(this.diagram.selectedItems.canToggleSelection){var d=void 0,l=void 0;if(0<this.diagram.selectedItems.nodes.length)for(var c=0;c<this.diagram.selectedItems.nodes.length;c++)this.diagram.selectedItems.nodes[parseInt(c.toString(),10)].isLane||this.diagram.selectedItems.nodes[parseInt(c.toString(),10)].isPhase||this.diagram.selectedItems.nodes[parseInt(c.toString(),10)].parentObj instanceof Ac||this.diagram.selectedItems.nodes[parseInt(c.toString(),10)].parentObj instanceof Oc||(d=""!==this.diagram.selectedItems.nodes[parseInt(c.toString(),10)].parentId);for(var p=this.diagram.selectedItems.nodes,c=0;c<i.length;c++)(1<i.length&&p[0].id===i[parseInt(c.toString(),10)].id||0<n.length)&&(l=!0);!this.isSwimlaneSelected&&!u&&!l&&this.tool instanceof Po&&"Select"===this.currentAction&&(!d||0<this.diagram.selectedItems.connectors.length)&&this.commandHandler.clearSelection(!0)}this.isSwimlaneSelected=!1,this.tool.mouseUp(this.eventArgs),!this.diagram.checkMenu||-1===window.navigator.userAgent.indexOf("Linux")&&-1===window.navigator.userAgent.indexOf("X11")||(!t.pageY&&t instanceof TouchEvent&&t.changedTouches?(window.getSelection().removeAllRanges(),this.diagram.contextMenuModule.contextMenu.open(t.changedTouches[0].pageY,t.changedTouches[0].pageX,this.diagram.element),t.preventDefault()):this.diagram.contextMenuModule.contextMenu.open(t.pageY,t.pageX,this.diagram.element),this.diagram.checkMenu=!1)}a.hasStack&&this.diagram.endGroupAction()}if(s&&this.diagram.endGroupAction(),this.updateContainerBounds(!0),2!==this.eventArgs.clickCount&&(this.commandHandler.updateSelectedNodeProperties(this.eventArgs.source),o)){this.diagram.diagramActions=this.diagram.diagramActions&~Z.DiagramAction.PreventLaneContainerUpdate;var g=this.eventArgs.source instanceof B?this.eventArgs.source.nodes:[this.eventArgs.source];if(g)for(c=0;c<g.length;c++)g[parseInt(c.toString(),10)].container||(this.commandHandler.dropChildToContainer(this.eventArgs.target,g[parseInt(c.toString(),10)]),this.commandHandler.renderContainerHelper(g[parseInt(c.toString(),10)]))}this.diagram.selectedObject&&this.diagram.selectedObject.helperObject&&(h=this.isSwimlaneChild(this.diagram.selectedObject.actualObject),u=this.diagram.selectedObject.actualObject&&this.diagram.selectedObject.actualObject.width===this.diagram.selectedObject.helperObject.width&&this.diagram.selectedObject.actualObject.height===this.diagram.selectedObject.helperObject.height,this.diagram.remove(this.diagram.selectedObject.helperObject),this.commandHandler.isTargetSubProcess(this.diagram.selectedObject.actualObject)&&""===this.diagram.selectedObject.actualObject.parentId&&this.swapProcessChildInDom(this.diagram.element.id+"_diagramLayer",this.diagram.selectedObject.actualObject),this.diagram.selectedObject={helperObject:void 0,actualObject:void 0},this.diagram.diagramActions&Z.DiagramAction.PublicMethod&&this.diagram.constraints&Z.DiagramConstraints.LineRouting||h&&u)&&(this.diagram.diagramActions=this.diagram.diagramActions&~Z.DiagramAction.PublicMethod),this.blocked=!1,this.hoverElement&&(a=Z.PortVisibility.Connect,so(this.diagram,this.hoverElement)&&(a|=Z.PortVisibility.Hover),this.diagram.updatePortVisibility(this.hoverElement,a,!0),this.hoverElement=null),this.touchStartList=null,this.touchMoveList=null,this.tool instanceof Wo||(this.tool=null)}r||t.preventDefault(),this.diagram.currentDrawingObject=void 0;var u,s=this.diagram.selectedItems,o=!1;this.commandHandler.isUserHandle(this.currentPosition)&&this.isForeignObject(t.target)&&(o=!0),!this.inAction&&s.wrapper&&0<s.userHandles.length&&!o&&this.diagram.renderSelector(!0),this.inAction||this.diagram.currentSymbol||!this.eventArgs||(u={element:(h=this.getTargetElement()).target instanceof Be||h.target instanceof je||h.target instanceof Ts||h.target instanceof gn||h.target instanceof fn?h.target:this.eventArgs.source||this.diagram,position:this.eventArgs.position,count:t.detail,actualObject:this.eventArgs.actualObject,button:0===t.button?"Left":1===t.button?"Middle":"Right"},this.diagram.tool!==Z.DiagramTools.ZoomPan&&this.diagram.triggerEvent(Z.DiagramEvent.click,u)),this.eventArgs={}}this.diagram.diagramActions=this.diagram.diagramActions&~Z.DiagramAction.PreventLaneContainerUpdate,e&&this.updateAnnotation(this.diagram.selectedItems),this.previousElement=null,this.eventArgs={},this.diagram.commandHandler.removeStackHighlighter()}},c.prototype.isSwimlaneChild=function(t){return!(!t.shape||"SwimLane"===t.shape.type)&&!!(t=this.diagram.nameTable[t.parentId])&&(t=t.parentId?this.diagram.nameTable[t.parentId]:t)&&t.shape&&"SwimLane"===t.shape.type},c.prototype.updateAnnotation=function(t){var e=t.nodes;if(0<e.length)for(var i=0;i<e.length;i++){var n=e[parseInt(i.toString(),10)];this.diagram.updateConnectorEdges(n)}},c.prototype.swapProcessChildInDom=function(t,e){var i=document.getElementById(t);if(e.shape.activity.subProcess.processes)for(var n=0;n<e.shape.activity.subProcess.processes.length;n++){var r=document.getElementById(e.shape.activity.subProcess.processes[parseInt(n.toString(),10)]+"_groupElement");r&&i.appendChild(r)}},c.prototype.getTargetElement=function(){var t,e=this.objectFinder.findObjectsUnderMouse(this.currentPosition,this.diagram,this.eventArgs,null,this.action),e=this.objectFinder.findObjectUnderMouse(this.diagram,e,this.action,this.inAction,this.eventArgs,this.currentPosition);if("None"!==this.previousAction&&this.diagram.selectedItems.userHandles)for(var i=0;i<this.diagram.selectedItems.userHandles.length;i++){var n=this.diagram.selectedItems.userHandles[parseInt(i.toString(),10)];this.previousAction===n.name&&(t=n)}var r=null;return null!==e&&(r=this.diagram.findElementUnderMouse(e,this.currentPosition,this.diagram))&&(t=this.commandHandler.findTarget(r,e)),{obj:e,sourceElement:r,target:t}},c.prototype.getConnectorPadding=function(t){var e,t=t.source;return t&&t instanceof B&&t.connectors.length?e=(e=t.connectors[0]).constraints&Z.ConnectorConstraints.ConnectToNearByPort?e.connectionPadding:0:t&&t instanceof W&&"PortDraw"===this.action&&this.tool instanceof No&&t.constraints&Z.ConnectorConstraints.ConnectToNearByPort&&(e=t.connectionPadding),e||0},c.prototype.addSwimLaneObject=function(t){var e,i,n,r=0,o=t.shape,a=this.objectFinder.findObjectsUnderMouse(this.currentPosition,this.diagram,this.eventArgs,null,this.action),s=s||this.diagram.findObjectUnderMouse(a,this.action,this.inAction);if(this.diagram.clearSelectorLayer(),s&&!(s.isLane||s.isPhase||s.isHeader))for(var h=0;h<a.length;h++){var d=this.diagram.nameTable[a[parseInt(h.toString(),10)].id];(d.isLane||d.isPhase||d.isHeader)&&(s=d)}s&&(o.isPhase||o.isLane&&s.isLane)&&(n=s.parentId,n=this.diagram.nameTable[""+n]);var l,c,p=null;n&&(e=n.shape,l=o.isLane?o.orientation===e.orientation:o.orientation!==e.orientation,o.isLane)&&o.orientation!==e.orientation&&(l=!0,p="Horizontal"===o.orientation?"height":"width"),l&&s?(e&&e.header&&e.hasHeader&&"Horizontal"===e.orientation&&(r=1),0<e.phases.length&&(r+=1),o.isPhase?(l="Horizontal"===e.orientation?this.currentPosition.x-n.wrapper.bounds.x:this.currentPosition.y-(n.wrapper.bounds.y+(e.hasHeader?e.header.height:0)),l={id:q(),offset:l,header:{annotation:{content:void 0===o.phases[0].header?"Phase":o.phases[0].header.annotation.content,style:void 0===o.phases[0].header?{}:o.phases[0].header.annotation.style}},style:void 0===o.phases[0]?{}:o.phases[0].style},this.diagram.addPhases(n,[l])):(l={id:q(),style:o.lanes[0].style,canMove:o.lanes[0].canMove,header:{annotation:{content:o.lanes[0].header.annotation.content,style:o.lanes[0].header.annotation.style},style:o.lanes[0].header.style}},"Horizontal"===o.orientation?l.height=o.lanes[0].height:l.width=o.lanes[0].width,"Horizontal"===e.orientation?(i=s.rowIndex||this.diagram.nameTable[s.parentId].rowIndex,s.wrapper.offsetY<this.currentPosition.y&&(i+=1)):(i=s.columnIndex||this.diagram.nameTable[s.parentId].columnIndex,this.currentPosition.x<s.wrapper.bounds.center.x&&--i),e.lanes.length>i?(l.header.width=e.lanes[parseInt(i.toString(),10)].header.width,l.header.height=e.lanes[parseInt(i.toString(),10)].header.height):(c=void 0,c="Horizontal"===e.orientation?s.rowIndex<3?0:i-r-1:i-1,l.header.width=e.lanes[parseInt(c.toString(),10)].header.width,l.header.height=e.lanes[parseInt(c.toString(),10)].header.height),p&&("height"===p?(l.width=l.height,delete l.height):(l.height=l.width,delete l.width)),this.diagram.addLanes(n,[l],"Horizontal"===e.orientation?i-r:i)),this.commandHandler.select(n)):o.isLane&&(c={id:q(),width:t.width,height:t.height,addInfo:t.addInfo,shape:{type:"SwimLane",header:{annotation:{content:void 0===o.header?"Header":o.header.annotation.content,style:void 0===o.header?{}:o.header.annotation.style},height:50,style:(o.header?o:o.lanes[0]).header.style},phases:[{id:q(),header:{annotation:{content:void 0===o.phases||void 0===o.phases[0].header?"Phase":o.phases[0].header.annotation.content,style:void 0===o.phases||void 0===o.phases[0].header?{}:o.phases[0].header.annotation.style},style:void 0===o.phases||void 0===o.phases[0].header?{}:o.phases[0].header.style},style:void 0===o.phases?{}:o.phases[0].style}],lanes:[{id:q(),height:t.height,width:t.width,style:o.lanes[0].style,canMove:o.lanes[0].canMove,header:{annotation:{content:o.lanes[0].header.annotation.content,style:o.lanes[0].header.annotation.style},style:o.lanes[0].header.style}}],orientation:o.orientation}},"Vertical"===o.orientation&&(c.width+=20),c.offsetX=this.currentPosition.x+c.width/2,c.offsetY=this.currentPosition.y+c.height/2,c.style=t.style,this.diagram.add(c))},c.prototype.mouseLeave=function(t){this.tool&&this.inAction&&this.tool.mouseLeave(this.eventArgs),this.diagram.selectedObject.helperObject&&(this.updateContainerProperties(),this.updateContainerBounds())&&this.diagram.endGroupAction(),this.eventArgs&&this.eventArgs.source&&(this.diagram.updatePortVisibility(this.eventArgs.source,Z.PortVisibility.Hover,!0),this.hoverElement=null),this.eventArgs&&!this.eventArgs.source&&this.hoverElement&&(this.hoverElement=null),this.tool instanceof xo&&this.eventArgs&&this.eventArgs.target&&this.eventArgs.target instanceof _&&(this.diagram.updatePortVisibility(this.eventArgs.target,Z.PortVisibility.Hover|Z.PortVisibility.Connect,!0),this.hoverElement=null);var e=this.diagram.selectedItems;e&&e.wrapper&&(Cd(this.diagram,e)||this.diagram.renderSelector(!0)),(this.diagram.diagramActions&Z.DiagramAction.Interactions||this.diagram.diagramActions&Z.DiagramAction.ToolAction)&&(this.diagram.diagramActions=this.diagram.diagramActions&~Z.DiagramAction.ToolAction),this.isMouseDown=!1,this.focus=!1,this.touchStartList=null,this.touchMoveList=null,this.elementLeave(),this.commandHandler.removeSnap(),this.inAction=!1,this.eventArgs={},this.diagram.selectedObject&&this.diagram.selectedObject.helperObject&&(this.diagram.remove(this.diagram.selectedObject.helperObject),this.diagram.selectedObject={helperObject:void 0,actualObject:void 0}),this.tool=null;var i,n,r=document.getElementsByClassName("e-d-ruler-marker");if(r&&0<r.length)for(n=r.length-1;0<=n;n--)(i=r[parseInt(n.toString(),10)])&&i.parentNode.removeChild(i);"Rotate"===this.action&&this.diagram.diagramCanvas.classList.remove("e-diagram-rotate"),t.preventDefault()},c.prototype.mouseWheel=function(t){this.diagram.blazorActions|=Z.BlazorAction.interaction;var e,i,n,r,o,a={event:t,cancel:!1};this.diagram.triggerEvent(Z.DiagramEvent.mouseWheel,a),a.cancel||(a=0<t.wheelDelta||0<-40*t.detail,e=this.getMousePosition(t),this.diagram.tooltipObject.close(),this.isMetaKey(t)?(i=this.diagram.scrollSettings.zoomFactor,a?this.diagram.zoomTo({type:"ZoomIn",zoomFactor:i,focusPoint:e}):this.diagram.zoomTo({type:"ZoomOut",zoomFactor:i,focusPoint:e}),t.preventDefault()):(i=this.diagram.scroller.horizontalOffset,n=this.diagram.scroller.verticalOffset,a=a?10:-10,this.tool&&(this.tool instanceof Jo||this.tool instanceof ea)&&(this.eventArgs={},this.getMouseEventArgs(e,this.eventArgs),this.eventArgs.position=e,this.tool.mouseWheel(this.eventArgs)),this.diagram.scrollActions|=Z.ScrollActions.Interaction,t.isTrusted?(r=!1,(Math.abs(t.deltaY)<100&&-0===Math.abs(t.deltaX)||Math.abs(t.deltaX)<100&&-0===Math.abs(t.deltaY))&&(r=!0),o=!1,(o=0===t.deltaX&&0===t.deltaY?o:navigator.userAgent.includes("Macintosh"))?Math.abs(t.deltaX)>Math.abs(t.deltaY)?(t.shiftKey||t.deltaX&&-0!==t.deltaX&&(r||!o))&&this.diagram.scroller.zoom(1,a,0,e,!0,void 0,r):!t.deltaY||-0===t.deltaY||!r&&o||this.diagram.scroller.zoom(1,0,a,e,!0,void 0,r):t.shiftKey||t.deltaX&&-0!==t.deltaX&&(r||!o)?this.diagram.scroller.zoom(1,a,0,e,!0,void 0,r):!t.deltaY||-0===t.deltaY||!r&&o||this.diagram.scroller.zoom(1,0,a,e,!0,void 0,r)):t.shiftKey||t.deltaX&&-0!==t.deltaX?this.diagram.scroller.zoom(1,a,0,e,!0):this.diagram.scroller.zoom(1,0,a,e,!0),this.diagram.scrollActions&=~Z.ScrollActions.Interaction,i===this.diagram.scroller.horizontalOffset&&n===this.diagram.scroller.verticalOffset||t.preventDefault()),this.diagram.textEditing&&(this.diagram.isTriggerEvent=!0,this.diagram.activeLabel.parentId&&(o=this.diagram.getObject(this.diagram.activeLabel.parentId),this.diagram.startTextEdit(o,this.diagram.activeLabel.id)),this.diagram.isTriggerEvent=!1),this.diagram.blazorActions=this.diagram.blazorActions&~Z.BlazorAction.interaction)},c.prototype.keyDown=function(t){if(t.fromMouseEvents&&(t.ctrlKey&&(this.keyArgs.keyModifiers=1),t.shiftKey&&(this.keyArgs.keyModifiers=4),t.shiftKey)&&t.ctrlKey&&(this.keyArgs.keyModifiers=5),!(this.diagram.diagramActions&Z.DiagramAction.TextEdit)&&!this.checkEditBoxAsTarget(t)||"Escape"===t.key||27===t.keyCode){var e=t.keyCode||t.which,i=t.key,n=("ArrowDown"!==i&&"ArrowUp"!==i&&"ArrowLeft"!==i&&"ArrowRight"!==i||(this.isNudgeKey=!0),this.isMetaKey(t));if(this.diagram.commandManager&&this.diagram.commands)for(var r=this.diagram.commands,o=0,a=Object.keys(r);o<a.length;o++){var s=a[o],h=this.diagram.commands[""+s];if(h&&(h.gesture.keyModifiers||h.gesture.key)&&(e===h.gesture.key||Z.Keys[h.gesture.key]&&i===Z.Keys[h.gesture.key]||i===Z.Keys[h.gesture.key].split("Number")[1]||this.isDeleteKey(i,s))&&(!h.gesture.keyModifiers&&!t.altKey&&!t.shiftKey&&!n||h.gesture.keyModifiers&&(n||t.altKey||t.shiftKey)&&this.altKeyPressed(h.gesture.keyModifiers)&&t.altKey||this.shiftKeyPressed(h.gesture.keyModifiers)&&t.shiftKey||this.ctrlKeyPressed(h.gesture.keyModifiers)&&n&&this.keyArgs.keyModifiers===h.gesture.keyModifiers)){var s=Dp(h.canExecute);if(N.isBlazor()||s&&s({keyDownEventArgs:KeyboardEvent,parameter:h.parameter})){t.preventDefault(),"Escape"===t.key&&(this.checkEditBoxAsTarget(t)?document.getElementById(this.diagram.diagramCanvas.id).focus():this.diagram.currentSymbol?(this.diagram.removeFromAQuad(this.diagram.currentSymbol),this.diagram.removeObjectsFromLayer(this.diagram.nameTable[this.diagram.currentSymbol.id]),this.diagram.removeElements(this.diagram.currentSymbol),(s=this.diagram.currentSymbol)instanceof _&&"Bpmn"===s.shape.type&&"TextAnnotation"===s.shape.shape&&this.diagram.removeDependentConnector(s),Ah(this.diagram.currentSymbol,this.diagram),delete this.diagram.nameTable[this.diagram.currentSymbol.id],this.diagram.droppable.sourceElement.draggable.intDestroy(),(s=this.diagram.droppable.selectedSymbols).parentNode.removeChild(s),s=this.diagram.diagramActions,this.diagram.diagramActions=this.diagram.addConstraints(s,Z.DiagramAction.PreventClearSelection),this.tool.mouseUp(this.eventArgs),this.diagram.diagramRenderer.rendererActions=this.diagram.removeConstraints(this.diagram.diagramRenderer.rendererActions,Z.RendererAction.DrawSelectorBorder),this.diagram.previousSelectedObject&&this.diagram.select(this.diagram.previousSelectedObject),this.action="Select",this.diagram.previousSelectedObject=null,this.diagram.currentSymbol=null,this.diagram.diagramActions=this.diagram.removeConstraints(s,Z.DiagramAction.PreventClearSelection),this.isMouseDown=!1):this.inAction&&this.diagram.drawingObject&&this.tool&&this.tool.inAction&&(this.tool.mouseUp(this.eventArgs),this.tool=null,this.isMouseDown=!1)),h.execute&&(this.commandObj=h,this.diagram.tool!==Z.DiagramTools.ZoomPan)&&(s=Dp(h.execute),this.isNudgeKey?(this.isKeyUp||(this.keyArgs.oldValue={offsetX:this.diagram.selectedItems.offsetX,offsetY:this.diagram.selectedItems.offsetY},this.keyCount++,4<this.keyCount&&(s({keyDownEventArgs:KeyboardEvent,parameter:h.parameter,type:"KEYDOWN"}),this.keyCount=0,this.keyArgs.newValue={offsetX:this.diagram.selectedItems.offsetX,offsetY:this.diagram.selectedItems.offsetY},this.diagram.triggerEvent(Z.DiagramEvent.positionChange,this.keyArgs))),this.isKeyUp=!1):s({keyDownEventArgs:KeyboardEvent,parameter:h.parameter}));break}}}}this.diagram.selectedItems.nodes.length?this.diagram.selectedItems.nodes:this.diagram.selectedItems.connectors;r=this.diagram.selectedItems;this.keyArgs={element:r,key:t.key,keyCode:t.keyCode||t.which},this.getKeyModifier(this.keyArgs,t),this.diagram.diagramActions&Z.DiagramAction.TextEdit&&this.getlabel(this.keyArgs,t),this.diagram.triggerEvent(Z.DiagramEvent.keyDown,this.keyArgs)},c.prototype.getlabel=function(t,e){var i=this.diagram.activeLabel,n=(t.target=this.diagram.element.id+"_editBox",this.diagram.nameTable[i.parentId]);if(document.getElementById(this.diagram.element.id+"_editBox")){t.text=document.getElementById(this.diagram.element.id+"_editBox").value;for(var r=0;r<n.annotations.length;r++)if(n.annotations[parseInt(r.toString(),10)].id===i.id){t.label=n.annotations[parseInt(r.toString(),10)];break}}},c.prototype.getKeyModifier=function(t,e){t.keyModifiers=Z.KeyModifiers.None,e.ctrlKey&&(t.keyModifiers|=Z.KeyModifiers.Control),e.shiftKey&&(t.keyModifiers|=Z.KeyModifiers.Shift),e.altKey&&(t.keyModifiers|=Z.KeyModifiers.Alt),this.isMetaKey(e)&&(t.keyModifiers|=Z.KeyModifiers.Meta)},c.prototype.keyUp=function(t){var e=this.diagram.selectedItems;this.keyArgs={element:e,key:t.key,keyCode:t.keyCode||t.which,oldValue:{offsetX:e.offsetX,offsetY:e.offsetY},newValue:{offsetX:e.offsetX,offsetY:e.offsetY}},this.diagram.selectedItems.nodes.length?this.diagram.selectedItems.nodes:this.diagram.selectedItems.connectors;this.getKeyModifier(this.keyArgs,t),this.diagram.diagramActions&Z.DiagramAction.TextEdit&&this.getlabel(this.keyArgs,t),this.diagram.triggerEvent(Z.DiagramEvent.keyUp,this.keyArgs),!this.isKeyUp&&this.isNudgeKey&&(Dp(this.commandObj.execute)({keyDownEventArgs:KeyboardEvent,parameter:this.commandObj.parameter,type:"KEYUP"}),this.keyArgs.newValue={offsetX:this.diagram.selectedItems.offsetX,offsetY:this.diagram.selectedItems.offsetY},this.diagram.triggerEvent(Z.DiagramEvent.positionChange,this.keyArgs),this.isNudgeKey=!1,this.keyCount=0)},c.prototype.startAutoScroll=function(t){var e,i,t=this.getMousePosition(t),n=(t.x*=this.diagram.scroller.currentZoom,t.y*=this.diagram.scroller.currentZoom,xs(this.diagram)),r=this.diagram.scrollSettings.autoScrollBorder;return"mozilla"===N.Browser.info.name&&0===this.diagram.scroller.viewPortWidth&&(i=document.getElementById(this.diagram.element.id).getBoundingClientRect()).width!==this.diagram.scroller.viewPortWidth&&this.diagram.scroller.setViewPortSize(i.width,i.height),this.diagram.scrollSettings.canAutoScroll&&(t.x+this.diagram.scroller.horizontalOffset+r.right+n.width>=this.diagram.scroller.viewPortWidth-18?e="right":t.x+this.diagram.scroller.horizontalOffset<r.left?e="left":t.y+this.diagram.scroller.verticalOffset+r.bottom+n.height>this.diagram.scroller.viewPortHeight-18?e="bottom":t.y+this.diagram.scroller.verticalOffset<r.top&&(e="top")),e},c.prototype.doAutoScroll=function(t,e,i,n){if((this.tool instanceof ko||this.tool instanceof No||this.tool instanceof Po||this.tool instanceof Eo||this.tool instanceof fo||this.tool instanceof xo)&&this.inAction){var r=this.getMousePosition(e),o=(this.diagram.scrollSettings.autoScrollBorder,0),a=0,s=!1,h="",d={x:r.x,y:r.y};switch(this.tool instanceof Eo&&("ResizeSouthEast"===this.tool.corner||"ResizeSouthWest"===this.tool.corner||"ResizeNorthWest"===this.tool.corner||"ResizeNorthEast"===this.tool.corner)&&(s=!0,h=this.tool.corner),t){case"right":d.x=r.x+10,o=10,s&&(a="ResizeSouthEast"===h?(d.y=r.y+10,10):(d.y=r.y-10,-10));break;case"left":d.x=r.x-10,o=-10,s&&(a="ResizeNorthWest"===h?(d.y=r.y-10,-10):(d.y=r.y+10,10));break;case"bottom":d.y=r.y+10,a=10,s&&(o="ResizeSouthEast"===h?(d.x=r.x+10,10):(d.x=r.x-10,-10));break;case"top":d.y=r.y-10,a=-10,s&&(o="ResizeNorthEast"===h?(d.x=r.x+10,10):(d.x=r.x-10,-10))}this.eventArgs.position={x:d.x,y:d.y},this.currentPosition=this.eventArgs.position;e=this.objectFinder.findObjectsUnderMouse(this.currentPosition,this.diagram,this.eventArgs,null,this.action);this.eventArgs.target=this.diagram.findObjectUnderMouse(e,this.action,this.inAction),this.tool.mouseMove(this.eventArgs),this.diagram.scrollActions|=Z.ScrollActions.Interaction,this.diagram.scroller.zoom(1,-o,-a,r,!0),this.diagram.scrollActions&=~Z.ScrollActions.Interaction}},c.prototype.mouseEvents=function(){for(var t=this.diagram.findObjectsUnderMouse(this.currentPosition),e=0;e<t.length;e++)this.eventArgs.actualObject===t[parseInt(e.toString(),10)]&&t.splice(e,1);var i,n={targets:{}};N.isBlazor()||(n={targets:t,element:this.eventArgs.source===this.eventArgs.actualObject?void 0:this.eventArgs.source,actualObject:this.eventArgs.actualObject}),!this.lastObjectUnderMouse||!this.diagram.mouseLeave||this.eventArgs.actualObject&&this.lastObjectUnderMouse===this.eventArgs.actualObject||(i={targets:void 0,element:this.lastObjectUnderMouse,actualObject:void 0},this.diagram.triggerEvent(Z.DiagramEvent.mouseLeave,i),this.lastObjectUnderMouse=null),(!this.lastObjectUnderMouse&&this.eventArgs.source||this.lastObjectUnderMouse!==this.eventArgs.actualObject)&&(this.lastObjectUnderMouse=this.eventArgs.actualObject,void 0!==this.eventArgs.actualObject)&&this.diagram.triggerEvent(Z.DiagramEvent.mouseEnter,n),this.eventArgs.actualObject&&this.diagram.triggerEvent(Z.DiagramEvent.mouseOver,n)},c.prototype.elementEnter=function(t,e){var i,n;e||(e=this.hoverElement instanceof _&&this.hoverElement.constraints&Z.NodeConstraints.Tooltip||this.hoverElement instanceof W&&this.hoverElement.constraints&Z.ConnectorConstraints.Tooltip||(this.hoverElement instanceof Be||this.hoverElement instanceof je)&&this.hoverElement.constraints&Z.PortConstraints.ToolTip||(this.hoverElement instanceof Ze||this.hoverElement instanceof Qe)&&this.hoverElement.constraints&Z.AnnotationConstraints.Tooltip,n=this.getContent(),i=void 0,this.hoverElement&&this.hoverElement.children&&0<this.hoverElement.children.length&&(i=this.findIntersectChild(this.hoverElement)),"Auto"===this.hoverElement.tooltip.openOn&&""!==n&&De(this.diagram,i||(e?this.hoverElement:void 0)),this.hoverElement.tooltip.content&&("Mouse"===this.hoverElement.tooltip.relativeMode?this.setTooltipOffset(t):(this.diagram.tooltipObject.offsetX=0,this.diagram.tooltipObject.offsetY=0)),e=this.diagram.findObjectsUnderMouse(this.currentPosition),null!==(t=this.diagram.findObjectUnderMouse(e,this.action,this.inAction))&&(e=void 0,this.hoverElement.tooltip.isSticky&&(this.diagram.tooltipObject.isSticky=!0),e=(t=t instanceof _&&t.children&&0<t.children.length?i||t:t).ports&&(this.hoverElement instanceof Be||this.hoverElement instanceof je)||t.annotations&&(this.hoverElement instanceof Ze||this.hoverElement instanceof Qe)?document.getElementById(t.id+"_"+this.hoverElement.id):(i=t.shape&&t.shape instanceof Kd?"_content_native_element":"_groupElement",document.getElementById(t.id+i)),"Auto"===this.hoverElement.tooltip.openOn&&""!==n&&(this.diagram.tooltipObject.close(),this.diagram.tooltipObject.openOn=this.hoverElement.tooltip.openOn,this.diagram.tooltipObject.dataBind()),t=this.hoverElement,i=this.diagram,n=0,t instanceof W?t.constraints&Z.ConnectorConstraints.Tooltip?n=t.constraints&Z.ConnectorConstraints.Tooltip:t.constraints&Z.ConnectorConstraints.InheritTooltip&&(n=i.constraints&Z.DiagramConstraints.Tooltip):t instanceof Be||t instanceof je?t.constraints&Z.PortConstraints.ToolTip?n=t.constraints&Z.PortConstraints.ToolTip:t.constraints&Z.PortConstraints.InheritTooltip&&(n=i.constraints&Z.DiagramConstraints.Tooltip):t instanceof Ze||t instanceof Qe?t.constraints&Z.AnnotationConstraints.Tooltip&&(n=t.constraints&Z.AnnotationConstraints.Tooltip):t.constraints&Z.NodeConstraints.Tooltip?n=t.constraints&Z.NodeConstraints.Tooltip:t.constraints&Z.NodeConstraints.InheritTooltip&&(n=i.constraints&Z.DiagramConstraints.Tooltip),n)&&"Auto"===this.hoverElement.tooltip.openOn&&(this.diagram.tooltipObject.target=this.hoverElement.id,"Mouse"===this.hoverElement.tooltip.relativeMode?this.diagram.tooltipObject.open(this.diagram.element):this.diagram.tooltipObject.open(e)))},c.prototype.elementLeave=function(){this.diagram.tooltipObject&&!this.diagram.tooltipObject.isSticky&&"Custom"!==this.diagram.tooltipObject.openOn&&this.diagram.tooltipObject.close()},c.prototype.setTooltipOffset=function(t){t=this.updatePointBasedOnScale(t),t=uh(this.diagram,t,this.hoverElement);this.diagram.tooltipObject.offsetX=t.x,this.diagram.tooltipObject.offsetY=t.y},c.prototype.updatePointBasedOnScale=function(t){var e=this.diagram.scaleValue;return{x:t.x*e,y:t.y*e}},c.prototype.altKeyPressed=function(t){return!!(t&Z.KeyModifiers.Alt)},c.prototype.ctrlKeyPressed=function(t){return!!(t&Z.KeyModifiers.Control)},c.prototype.shiftKeyPressed=function(t){return!!(t&Z.KeyModifiers.Shift)},c.prototype.scrolled=function(t){this.diagram.updateScrollOffset()},c.prototype.isMobileOrIPadDevice=function(){var t=navigator.userAgent||navigator.vendor||window.opera;return"MacIntel"===navigator.platform&&1<navigator.maxTouchPoints?"iOS (iPad)":/iPhone|iPad|iPod/.test(t)&&!window.MSStream?"iOS":/android/i.test(t)?"Android":/Mobile|Tablet/.test(t)?"Mobile":"Desktop"},c.prototype.doubleClick=function(t){var e,i,n;Hn(this.diagram)&&(i=this.isMobileOrIPadDevice(),n=this.diagram.tool,i=void("Desktop"!==i&&this.tool&&(this.tool instanceof Jo||this.tool instanceof ea)&&(this.diagram.tool=0)),e=this.diagram.findObjectsUnderMouse(this.currentPosition),null!==(e=this.diagram.findObjectUnderMouse(e,this.action,this.inAction))&&Hn(this.diagram)&&(i=this.diagram.findElementUnderMouse(e,this.currentPosition,this.diagram),this.tool&&(this.tool instanceof Jo||this.tool instanceof ea)?(this.currentPosition,t.detail,this.diagram.tool=n,this.tool.mouseUp(this.eventArgs),this.isMouseDown=!1,this.eventArgs={},this.tool=null,t.preventDefault()):!(n=this.diagram.commandHandler.getObjectLayer(e.id))||n.lock||!n.visible||this.diagram.diagramActions&Z.DiagramAction.TextEdit||this.diagram.startTextEdit(e,i instanceof H?i.id.split(e.id+"_")[1]:void 0)),n={source:e||this.diagram,position:this.currentPosition,count:t.detail},this.diagram.triggerEvent(Z.DiagramEvent.doubleClick,n))},c.prototype.itemClick=function(t,e){return Ur(this.diagram,t,!0)?t:null},c.prototype.inputChange=function(t){var e,i,n=document.getElementById(this.diagram.element.id+"_editBox"),r=document.getElementById(this.diagram.element.id+"_editTextBoxDiv"),o=n.value,a=o.split("\n"),s=this.diagram.selectedItems.nodes[0]||this.diagram.selectedItems.connectors[0];(s=!s&&this.tool instanceof Wo||s&&"SwimLane"===s.shape.type?this.diagram.nameTable[this.diagram.activeLabel.parentId]:s)&&("Text"!==s.shape.type&&0<s.annotations.length||"Text"===s.shape.type)&&(e=this.diagram.getWrapper(s.wrapper,this.diagram.activeLabel.id),s=(s.wrapper.bounds.width<e.bounds.width?s.wrapper:e).bounds.width,o=Wc(e.style,o,void 0,void 0,90<s?s:90),s=Number(n.style.fontSize.split("px")[0]),1<a.length&&""===a[a.length-1]&&(o.height=o.height+s),a=this.diagram.scroller.transform,s=Wn(this.diagram)?a.scale:1,i=o.width,o=(o.height<12?12:o.height)*s,r.style.left=(e.bounds.center.x+a.tx)*a.scale-(i=(i<90?90:i)*s)/2-2.5+"px",r.style.top=(e.bounds.center.y+a.ty)*a.scale-o/2-3+"px",r.style.width=i+"px",r.style.height=o+"px",n.style.minHeight="12px",n.style.minWidth="90px",n.style.width=i+"px",n.style.height=o+"px")},c.prototype.isAddTextNode=function(t,e){return!!(this.tool instanceof Wo||e)&&(this.tool=null,t&&!Rn(this.diagram)&&(this.diagram.drawingObject=void 0,this.diagram.currentDrawingObject=void 0),!td(this.diagram.nodes,t.id))&&!td(this.diagram.connectors,t.id)},c.prototype.checkEditBoxAsTarget=function(t){return!(!t.target||t.target.id!==this.diagram.element.id+"_editBox")},c.prototype.getMouseEventArgs=function(t,e,i,n){var r,o;if(e.position=t,i?(o=this.diagram.findObjectsUnderMouse(this.currentPosition,i),r=this.diagram.findTargetObjectUnderMouse(o,this.action,this.inAction,e.position,i)):("Drag"!==this.action&&"ConnectorSourceEnd"!==this.action&&"SegmentEnd"!==this.action&&"OrthoThumb"!==this.action&&"BezierSourceThumb"!==this.action&&"BezierTargetThumb"!==this.action&&"ConnectorTargetEnd"!==this.action&&-1===this.action.indexOf("Rotate")&&-1===this.action.indexOf("Resize")||(r=this.diagram.selectedItems,!this.diagram.currentSymbol&&"Drag"===this.action&&r&&0<this.diagram.selectedItems.nodes.length&&"SwimLane"===this.diagram.selectedItems.nodes[0].shape.type))&&(o=this.diagram.findObjectsUnderMouse(this.currentPosition),r=this.diagram.findObjectUnderMouse(o,this.action,this.inAction)),r&&r.isHeader&&(r=this.diagram.nameTable[r.parentId],this.eventArgs.actualObject=r),r){var a,s,h=void 0,d=void 0;if(((a=this.diagram.findElementUnderMouse(r,this.currentPosition,this.diagram,n))&&r.ports&&r.ports.length&&!md(r,a)||!a||!r)&&o&&o.length&&i instanceof B)for(s=i.connectors[0],d=o.length-1;0<=d;d--)if(((h=o[parseInt(d.toString(),10)])instanceof _||h instanceof W)&&s&&s.connectionPadding){if(r=h,a=this.diagram.findElementUnderMouse(r,this.currentPosition,this.diagram,n),s.constraints&Z.ConnectorConstraints.ConnectToNearByPort&&r&&r.ports&&r.ports.length&&md(r,a))break;if((h instanceof _||h instanceof W)&&s&&s.connectionPadding&&h.wrapper.outerBounds.containsPoint(this.currentPosition)&&s.constraints&Z.ConnectorConstraints.ConnectToNearByNode&&!(s.constraints&Z.ConnectorConstraints.ConnectToNearByPort)){r=h,a=this.diagram.findElementUnderMouse(r,this.currentPosition,this.diagram,0);break}}}return i?(e.target=r,e.targetWrapper=a):(e.source=r,e.sourceWrapper=a),e.actualObject=this.eventArgs.actualObject,e.source instanceof B&&void 0===e.actualObject&&(0<e.source.nodes.length||0<e.source.connectors.length)&&(e.actualObject=0<e.source.nodes.length?this.diagram.nameTable[e.source.nodes[0].id]:this.diagram.nameTable[e.source.connectors[0].id]),e.startTouches=this.touchStartList,e.moveTouches=this.touchMoveList,e},c.prototype.resetTool=function(){this.action="Select",this.hoverElement=null,this.hoverNode=null,this.tool=this.diagram.getTool(this.action),this.updateCursor()},c.prototype.updateTool=function(){var t,e,i;this.currentPosition?(t=this.diagram.findObjectsUnderMouse(this.currentPosition),i=void 0,(e=(e=null)!==(t=this.diagram.findObjectUnderMouse(t,this.action,this.inAction))?this.diagram.findElementUnderMouse(t,this.currentPosition,this.diagram):e)&&(i=this.commandHandler.findTarget(e,t)),this.action=this.diagram.findActionToBeDone(t,e,this.currentPosition,i)):this.action="Select"},c.prototype.getTool=function(t){switch(t){case"Select":return new fo(this.commandHandler,!0);case"Drag":return new Po(this.commandHandler);case"Rotate":return new Do(this.commandHandler);case"LayoutAnimation":return new Uo(this.commandHandler);case"FixedUserHandle":return new bo(this.commandHandler,!0);case"Hyperlink":return new Ko(this.commandHandler);case"ResizeSouthEast":case"ResizeSouthWest":case"ResizeNorthEast":case"ResizeNorthWest":case"ResizeSouth":case"ResizeNorth":case"ResizeWest":case"ResizeEast":return new Eo(this.commandHandler,t);case"ConnectorSourceEnd":case"ConnectorTargetEnd":case"BezierSourceThumb":case"BezierTargetThumb":return new xo(this.commandHandler,t);case"SegmentEnd":case"OrthoThumb":return new xg(this.commandHandler,t);case"Draw":var e=Qs(this.diagram.drawingObject);if("Node"===e&&"Text"===this.diagram.drawingObject.shape.type)return new Wo(this.commandHandler);if("Connector"===e&&"Freehand"===this.diagram.drawingObject.type)return new ga(this.commandHandler);if("Node"===e&&"Polygon"===this.diagram.drawingObject.shape.shape&&!this.diagram.drawingObject.shape.points)return new Jo(this.commandHandler);if("Node"===e)return new ko(this.commandHandler,this.diagram.drawingObject);if("Connector"===e&&"Polyline"===this.diagram.drawingObject.type)return new ea(this.commandHandler);if("Connector"===e)return new No(this.commandHandler,"ConnectorSourceEnd",this.diagram.drawingObject);break;case"Pan":return new Xo(this.commandHandler,!1);case"PinchZoom":return new Xo(this.commandHandler,!0);case"PortDrag":return new Po(this.commandHandler,"Port");case"PortDraw":return new No(this.commandHandler,"ConnectorSourceEnd",this.diagram.drawingObject);case"LabelSelect":return new fo(this.commandHandler,!0,"LabelSelect");case"LabelDrag":return new ra(this.commandHandler);case"LabelResizeSouthEast":case"LabelResizeSouthWest":case"LabelResizeNorthEast":case"LabelResizeNorthWest":case"LabelResizeSouth":case"LabelResizeNorth":case"LabelResizeWest":case"LabelResizeEast":return new sa(this.commandHandler,t);case"LabelRotate":return new la(this.commandHandler)}return null},c.prototype.getCursor=function(t){var e=this.diagram.selectedItems.annotation?this.diagram.selectedItems.wrapper.children[0]:this.diagram.selectedItems;return ho(t,this.diagram.selectedItems.annotation?e.rotateAngle+e.parentTransform:e.rotateAngle)},c.prototype.findElementUnderMouse=function(t,e,i,n){return this.objectFinder.findElementUnderSelectedItem(t,e,i,n)},c.prototype.findObjectsUnderMouse=function(t,e){return this.objectFinder.findObjectsUnderMouse(t,this.diagram,this.eventArgs,e)},c.prototype.findObjectUnderMouse=function(t,e,i){return this.objectFinder.findObjectUnderMouse(this.diagram,t,e,i,this.eventArgs,this.currentPosition)},c.prototype.findTargetUnderMouse=function(t,e,i,n,r){return this.objectFinder.findObjectUnderMouse(this.diagram,t,e,i,this.eventArgs,n,r)},c.prototype.findActionToBeDone=function(t,e,i,n){return io(t,e,this.currentPosition,this.diagram,this.touchStartList,this.touchMoveList,n)},c.prototype.updateContainerBounds=function(t){var e=!1;if(this.diagram.selectedObject.helperObject&&this.diagram.selectedObject.actualObject)for(var i=this.diagram.selectedObject.actualObject,n=this.diagram.selectedObject.actualObject instanceof B?i.nodes:[i],r=0;r<n.length;r++){var o=n[parseInt(r.toString(),10)],a=this.tool instanceof Eo,s=this.diagram.nameTable[o.parentId];t?Yr(this.diagram,o,this.currentPosition,a):(s&&"SwimLane"===s.shape.type||this.diagram.updateDiagramObject(o),e=_r(this.diagram,o,this.currentPosition,a),this.diagram.updateSelector(),(o.isLane||o.isPhase)&&(this.diagram.clearSelection(),this.commandHandler.selectObjects([o])))}return e},c.prototype.updateContainerProperties=function(){var t,e=!1,i=!1,n={hasStack:!1,isPreventHistory:!1};if(this.diagram.selectedObject.helperObject){var r,o=this.diagram.findObjectsUnderMouse(this.currentPosition),o=this.diagram.findObjectUnderMouse(o,this.action,this.inAction),a=this.diagram.selectedObject.helperObject;if((r=this.diagram.selectedObject.actualObject)instanceof _){if("SwimLane"===r.shape.type&&(t=cr(this.diagram,r.wrapper.children[0])),"SwimLane"!==r.shape.type&&r.parentId&&"SwimLane"===this.diagram.getObject(r.parentId).shape.type&&o instanceof _&&this.diagram.getObject(o.parentId)&&"SwimLane"!==this.diagram.getObject(o.parentId).shape.type&&(o=this.diagram.getObject(o.parentId)),"Drag"===this.currentAction&&r.container&&"Canvas"===r.container.type&&r.parentId&&"SwimLane"===this.diagram.getObject(r.parentId).shape.type&&o&&o.container&&"Canvas"===o.container.type&&o.isLane&&r.isLane&&o.parentId===r.parentId)o!==r&&br(this.diagram,r,o,this.currentPosition),n.isPreventHistory=!0;else{if(!(I=this.diagram.nameTable[r.parentId])||"SwimLane"!==I.shape.type)if(I&&I.isLane&&r.constraints&Z.NodeConstraints.AllowMovingOutsideLane){var s=this.diagram.getObject(I.parentId),h=void 0,d=void 0,l=(d="Vertical"===s.shape.orientation?(h=s.wrapper.bounds.x+s.shape.phaseSize,s.wrapper.bounds.y+s.shape.header.height):(y=s.shape.header.height+s.shape.phaseSize,h=s.wrapper.bounds.x,s.wrapper.bounds.y+y),s.wrapper.bounds.bottomRight.x-h),c=s.wrapper.bounds.bottomRight.y-d;new k(h,d,l,c).containsPoint(this.currentPosition)&&(r.offsetX=a.offsetX,r.offsetY=a.offsetY,r.width=a.width,r.height=a.height,r.rotateAngle=a.rotateAngle)}else if(1===this.diagram.selectedItems.nodes.length)r.offsetX=a.offsetX,r.offsetY=a.offsetY,r&&r.shape&&"UmlClassifier"!==r.shape.type&&(r.width=a.width,r.height=a.height),r.rotateAngle=a.rotateAngle;else if(1<this.diagram.selectedItems.nodes.length)for(var p=a.offsetX-this.diagram.selectedItems.offsetX,g=a.offsetY-this.diagram.selectedItems.offsetY,u=a.rotateAngle-this.diagram.selectedItems.rotateAngle,m=0;m<this.diagram.selectedItems.nodes.length;m++)this.diagram.selectedItems.nodes[parseInt(m.toString(),10)].offsetX+=p,this.diagram.selectedItems.nodes[parseInt(m.toString(),10)].offsetY+=g,this.diagram.selectedItems.nodes[parseInt(m.toString(),10)].rotateAngle+=u;var f,y=void 0;if(I&&I.container&&"Stack"===I.container.type&&(this.diagram.startGroupAction(),i=!0),!o&&I&&I.container&&"Stack"===I.container.type&&"Drag"===this.action&&(y={targetIndex:void 0,target:void 0,sourceIndex:s=I.wrapper.children.indexOf(r.wrapper),source:Q(r)},-1<s)&&((f=I.children).splice(f.indexOf(r.id),1),f=!(this.diagram.nameTable[r.id].parentId=""),I.wrapper.children.splice(s,1)),eo(r,o,this.diagram,this.action),(I=Ur(this.diagram,r)?this.diagram.nameTable[r.parentId]:this.diagram.nameTable[r.parentId]||r)&&I.container&&"Canvas"===I.container.type&&(I.wrapper.maxWidth=I.maxWidth=I.wrapper.actualSize.width,I.wrapper.maxHeight=I.maxHeight=I.wrapper.actualSize.height,e=!0),Ur(this.diagram,r,!0)&&I&&"Canvas"===I.container.type)if(1<this.diagram.selectedItems.nodes.length)for(m=0;m<this.diagram.selectedItems.nodes.length;m++)Gr(this.diagram,this.diagram.selectedItems.nodes[parseInt(m.toString(),10)]);else Gr(this.diagram,r);else n=this.updateContainerPropertiesExtend(I,r,t,a,n);this.diagram.lineRoutingModule&&this.diagram.constraints&Z.DiagramConstraints.LineRouting&&!Ur(this.diagram,r,!0)&&(r.children&&(this.diagram.realActions|=Z.RealAction.EnableGroupAction),this.diagram.nodePropertyChange(r,{},{width:r.width,height:r.height,offsetX:r.offsetX,offsetY:r.offsetY}),r.children)&&(this.diagram.realActions&=~Z.RealAction.EnableGroupAction),r.shape.lanes&&this.updateLaneChildNode(r),e&&(I.maxWidth=I.wrapper.maxWidth=void 0,I.maxHeight=I.wrapper.maxHeight=void 0),f&&(this.diagram.nodePropertyChange(I,{},{offsetX:I.offsetX,offsetY:I.offsetY,width:I.width,height:I.height,rotateAngle:I.rotateAngle}),s={redoObject:{sourceIndex:void 0,source:y.source},type:"StackChildPositionChanged",undoObject:y,category:"Internal"},this.diagram.diagramActions&Z.DiagramAction.UndoRedo||this.diagram.addHistoryEntry(s)),r&&r.container&&("Stack"===r.container.type||"Canvas"===r.container.type&&""===r.parentId)&&(r&&r.shape&&"UmlClassifier"===r.shape.type&&(r.wrapper.measureChildren=!0),this.diagram.nodePropertyChange(r,{},{offsetX:r.offsetX,offsetY:r.offsetY,width:r.width,height:r.height,rotateAngle:r.rotateAngle}),r)&&r.shape&&"UmlClassifier"===r.shape.type&&(r.wrapper.measureChildren=!1)}vr(t,this.diagram),n.hasStack=i}else if(r instanceof B){var p=a.offsetX-r.offsetX,g=a.offsetY-r.offsetY,u=a.rotateAngle-r.rotateAngle,l=a.width-r.width,c=a.height-r.height,v=a.width/r.width,b=a.height/r.height;if(this.tool.corner)for(var S=this.tool.getPivot(this.tool.corner),m=0;m<r.nodes.length;m++){var w=(C=r.nodes[parseInt(m.toString(),10)]).wrapper,x=r.wrapper,x=ad(h=x.offsetX-x.actualSize.width*x.pivot.x,d=x.offsetY-x.actualSize.height*x.pivot.y,x.actualSize.width,x.actualSize.height,x.rotateAngle,x.offsetX,x.offsetY,S);this.diagram.commandHandler.scaleObject(v,b,x,C,w,r)}else for(m=0;m<r.nodes.length;m++){var I,C=r.nodes[parseInt(m.toString(),10)];(I=this.diagram.nameTable[C.parentId])&&"SwimLane"!==I.shape.type&&Ur(this.diagram,C,!0)&&"Canvas"===I.container.type&&(C.offsetX+=p,C.offsetY+=g,C&&C.shape&&"UmlClassifier"!==C.shape.type&&(C.width+=l,C.height+=c),C.rotateAngle+=u,Gr(this.diagram,C))}}}return r&&(r.isPhase||r.isLane||r.shape&&"SwimLane"===r.shape.type)&&this.diagram.updateDiagramElementQuad(),n},c.prototype.updateLaneChildNode=function(t){for(var e=0;e<t.shape.lanes.length;e++)if(t.shape.lanes[parseInt(e.toString(),10)].children&&0<t.shape.lanes[parseInt(e.toString(),10)].children.length)for(var i=0;i<t.shape.lanes[parseInt(e.toString(),10)].children.length;i++){var n=t.shape.lanes[parseInt(e.toString(),10)].children[parseInt(i.toString(),10)].id,n=this.diagram.nameTable[""+n];n&&(n.offsetX=n.wrapper.offsetX,n.offsetY=n.wrapper.offsetY)}},c.prototype.updateContainerPropertiesExtend=function(t,e,i,n,r){var o,a,s,h,d,l,c;return"ResizeEast"!==this.currentAction&&"ResizeSouth"!==this.currentAction&&"SwimLane"!==e.shape.type||(o=Q(e),d=!1,t&&t.container&&"Grid"===t.container.type?(a=(l="SwimLane"===t.shape.type)?t.wrapper.children[0]:t.wrapper,c=l?t.shape.padding:void 0,s=t.wrapper.bounds.x,h=t.wrapper.bounds.y,void 0!==e.columnIndex&&"Horizontal"===t.container.orientation&&(l&&e.isPhase||!l&&1===e.rowIndex)||"Vertical"===t.container.orientation&&(!l&&0<e.rowIndex&&0<e.columnIndex||l&&e.isLane)?("Horizontal"===t.container.orientation&&e.isPhase&&e.wrapper.width>e.maxWidth&&(e.maxWidth=e.wrapper.width,e.wrapper.maxWidth=e.wrapper.width),l=n.wrapper.actualSize.width-e.wrapper.actualSize.width,a.updateColumnWidth(e.columnIndex,n.width,!0,c),wr(this.diagram,e,t,n,l),e.isPhase&&(l=t.shape.phases[e.columnIndex].header.id,(l=this.diagram.nameTable[""+l]).maxWidth<n.width)&&(l.maxWidth=n.width,l.wrapper.maxWidth=n.width),"SwimLane"===t.shape.type&&(t.width=t.width&&a.width,Pr(this.diagram,t),t.wrapper.width=t.width,i=cr(this.diagram,a,e.rowIndex))):void 0!==e.rowIndex&&(l=n.wrapper.actualSize.height-e.wrapper.actualSize.height,a.updateRowHeight(e.rowIndex,n.height,d=!0,c),wr(this.diagram,e,t,n,void 0,l),"SwimLane"===t.shape.type)&&(t.height=t.height&&a.height,t.wrapper.height=t.height,i=cr(this.diagram,a,e.rowIndex)),"SwimLane"===t.shape.type&&(r.isPreventHistory=!0),this.diagram.nodePropertyChange(t,{},{offsetX:t.offsetX,offsetY:t.offsetY,rotateAngle:t.rotateAngle}),this.diagram.drag(t,s-t.wrapper.bounds.x,h-t.wrapper.bounds.y)):(e&&e.shape&&"UmlClassifier"===e.shape.type&&(e.wrapper.measureChildren=!0),this.diagram.nodePropertyChange(e,{},{offsetX:e.offsetX,offsetY:e.offsetY,width:e.width,height:e.height,rotateAngle:e.rotateAngle}),e.wrapper.measureChildren=!1),e.wrapper.measure(new j(e.wrapper.width,e.wrapper.height)),e.wrapper.arrange(e.wrapper.desiredSize),"ResizeEast"!==this.currentAction&&"ResizeSouth"!==this.currentAction)||(c=Q(e),this.diagram.addHistoryEntry({category:"Internal",type:d?"RowHeightChanged":"ColumnWidthChanged",undoObject:o,redoObject:c})),vr(i,this.diagram),r},c.prototype.addUmlNode=function(){var t,e,i,n,r=this.diagram.selectedItems.nodes[0],o=this.diagram.findObjectsUnderMouse({x:this.currentPosition.x+20,y:this.currentPosition.y}),a=this.diagram.findObjectUnderMouse(o,this.action,this.inAction);a||(o=this.diagram.findObjectsUnderMouse({x:this.currentPosition.x-20,y:this.currentPosition.y}),a=this.diagram.findObjectUnderMouse(o,this.action,this.inAction)),r&&r.container&&"Stack"===r.container.type&&a&&a.parentId&&a.parentId===r.id&&(o=a,(n=Vc(this.diagram.element.id)).getElementById(n.id+"_stack_highlighter"))&&(n=r.wrapper.children.indexOf(a.wrapper)+1,this.diagram.enableServerDataBinding(!1),(i=new _(this.diagram,"nodes",{style:{fill:r.style.fill,strokeColor:"black"===r.style.strokeColor?"#ffffff00":r.style.strokeColor},annotations:a.annotations,verticalAlignment:"Stretch",horizontalAlignment:"Stretch",constraints:(Z.NodeConstraints.Default|Z.NodeConstraints.HideThumbs)&~(Z.NodeConstraints.Rotate|Z.NodeConstraints.Drag|Z.NodeConstraints.Resize),minHeight:25},!0)).annotations[0].content=" + Name : Type",o.id.split("_"),i.id=q()+i.id,i.parentId=r.id,i.zIndex=-1,i.umlIndex=n,this.diagram.startGroupAction(),o={name:"Name",type:"Type"},"Class"===r.shape.classifier&&(a.id.includes("_umlProperty")&&0<r.shape.classShape.attributes.length?(t=new Jl(r,"",o),r.shape.classShape.attributes.push(t)):a.id.includes("_umlMethods")&&0<r.shape.classShape.methods.length&&(e=new ec(r,"",o),r.shape.classShape.methods.push(e))),"Interface"===r.shape.classifier&&(a.id.includes("_umlProperty")&&0<r.shape.interfaceShape.attributes.length?(t=new Jl(r,"",o),r.shape.classShape.attributes.push(t)):a.id.includes("_umlMethods")&&0<r.shape.interfaceShape.methods.length&&(e=new ec(r,"",o),r.shape.interfaceShape.methods.push(e))),"Enumeration"===r.shape.classifier&&a.id.includes("_umlMember")&&0<r.shape.enumerationShape.members.length&&(n=new lc(r,"",o),r.shape.enumerationShape.members.push(n)),r.wrapper.children.indexOf(i.wrapper),this.diagram.enableServerDataBinding(!0),this.diagram.add(i),this.diagram.updateConnectorEdges(r),this.diagram.clearSelection(),this.diagram.select([this.diagram.nameTable[i.id]]),this.diagram.endGroupAction(),this.diagram.startTextEdit())};var Cg=c;function c(t,e){this.currentAction="None",this.previousAction="None",this.previousTarget=null,this.touchArgs=void 0,this.focus=!1,this.isBlocked=!1,this.isMouseDown=!1,this.inAction=!1,this.doingAutoScroll=!1,this.diagram=null,this.objectFinder=null,this.tool=null,this.eventArgs=null,this.previousElement=null,this.isKeyUp=!0,this.keyCount=0,this.isNudgeKey=!1,this.commandObj={},this.keyArgs={},this.diagram=t,this.objectFinder=new Pg,this.commandHandler=e}Ag.prototype.findObjectsUnderMouse=function(t,e,i,n,r){for(var o,a,s,h=[],d=(n&&n instanceof B&&n.nodes.length+n.connectors.length===1&&(n=n.nodes[0]||n.connectors[0]).children&&0===n.children.length&&(i.actualObject=n),n&&n instanceof W&&(n.constraints&Z.ConnectorConstraints.ConnectToNearByNode||n.constraints&Z.ConnectorConstraints.ConnectToNearByPort)&&n.connectionPadding||0),l={},c=0,p=e.spatialSearch.findObjects(new k(t.x-50-d,t.y-50-d,100+d,100+d));c<p.length;c++){var g=t,u=(f=(C=p[c]).wrapper.outerBounds,!C.rotateAngle&&f.containsPoint(g,d));if((C!==n||e.currentDrawingObject instanceof W)&&C instanceof W?C!==e.currentDrawingObject:C.wrapper.visible)if((w=e.commandHandler.getObjectLayer(C.id))&&!w.lock&&w.visible){if(s=l[w.zIndex]=l[w.zIndex]||[],C.rotateAngle)for(var m,f=gp(m=C.wrapper),y=0,v=m.children;y<v.length;y++)o=v[y],at(a=rt(),-(o.rotateAngle+o.parentTransform),o.offsetX,o.offsetY),g=z(a,t),gp(o).containsPoint(g,d)&&(u=!0);n&&!1!==so(e,C)||((f=C)instanceof W?f.constraints&Z.ConnectorConstraints.PointerEvents:f.constraints&Z.NodeConstraints.PointerEvents)&&(C instanceof W?dh(C,t):u)&&(m=C instanceof W&&C.hitPadding||0,this.findElementUnderMouse(C,t,e,d||m))&&"helper"!==C.id&&nd(C,"zIndex",s)}}for(var b=0,S=e.layers;b<S.length;b++)for(var w=S[b],x=0,I=h=h.concat(l[w.zIndex]||[]);x<I.length;x++){var C,P="eventHandler";"Bpmn"!==(C=I[x]).shape.type||!C.processId||e[P].tool instanceof Po&&!(e[P].tool instanceof Po&&En(C))||-1<(T=h.indexOf(e.nameTable[C.processId]))&&h.splice(T,1),"UmlClassifier"===C.shape.type&&C.container&&"Stack"===C.container.type&&-1<(T=h.indexOf(e.nameTable[e.nameTable[C.id].wrapper.children[0].id]))&&h.splice(T,1)}for(var A=0;A<h.length;A++){var T,D=e.nameTable[h[parseInt(A.toString(),10)].parentId];if(D)for(var O=this.findElementUnderMouse(D,t,e),M=0;M<D.ports.length;M++)if(O&&O.id.match("_"+D.ports[parseInt(M.toString(),10)].id+"$")){var E=D.ports[parseInt(M.toString(),10)];if(Xn(E)||Yn(E))return h}for(;D;){if(-1===(T=h.indexOf(D)))break;h.splice(T,1),D=e.nameTable[D.parentId]}}if(this.checkSwimlane(h,e),i&&!i.source)for(A=0;A<h.length;A++){var L=e.nameTable[h[parseInt(A.toString(),10)].parentId];if(L&&"SwimLane"===L.shape.type)for(M=0;M<h.length;M++)h[parseInt(M.toString(),10)]instanceof W&&h.splice(A,1)}return h},Ag.prototype.checkSwimlane=function(t,e){for(var i,n=0;n<t.length;n++){var r=t[parseInt(n.toString(),10)],o=void 0,a=void 0,o=(r instanceof _&&(o=t[parseInt(n.toString(),10)].parentId,a=r),""===o&&(i="SwimLane"!==a.shape.type),e.nameTable[""+o]);o&&o.isLane&&e.nameTable[o.parentId].zIndex>r.zIndex&&(t[parseInt(n.toString(),10)]=o),0<n&&i&&a&&(a.isLane||a.isPhase||a.isHeader)&&t[parseInt(n.toString(),10)].zIndex<t[n-1].zIndex&&(r=t[parseInt(n.toString(),10)],t[parseInt(n.toString(),10)]=t[n-1],t[n-1]=r)}if(2<=t.length)for(var s,h,d,l,c=t.length-1;0<=c;c--)t[parseInt(c.toString(),10)].parentId&&(s=Id(t[parseInt(c.toString(),10)],e,""),h=Id(t[c-1],e,""),d=e.nameTable[""+s],l=e.nameTable[""+h])&&s!==h&&d.zIndex<l.zIndex&&t.splice(c,1)},Ag.prototype.isTarget=function(t,e,i){var n,r,o=e.selectedItems.connectors[0],a="ConnectorSourceEnd"===i?e.nameTable[o.targetID]:e.nameTable[o.sourceID];return!a||a.processId&&!t.processId||a.processId!==t.processId||(t=a.processId!==t.processId?null:t)&&t.parentId&&"UmlClassifier"===e.nameTable[t.parentId].shape.type&&(t=e.nameTable[t.parentId]),t=(t="ConnectorSourceEnd"===i&&o.targetID&&(n=e.nameTable[o.targetID])&&n.shape&&"TextAnnotation"===n.shape.shape&&(r=o.id.split("_"),t="Bpmn"===n.shape.type&&"Bpmn"!==t.shape.type||r[0]===t.id||"TextAnnotation"===t.shape.shape?null:t)&&t.parentId&&"UmlClassifier"===e.nameTable[t.parentId].shape.type?e.nameTable[t.parentId]:t)&&(a&&t.id===a.processId||("ConnectorSourceEnd"===i||"ConnectorTargetEnd"===i)&&t.id===o.parentId)?null:t},Ag.prototype.findObjectUnderMouse=function(t,e,i,n,r,o,a){var s="eventHandler",h="endPoint",d=null;if(0!==e.length)if(a&&a instanceof B&&a.nodes.length+a.connectors.length===1&&(a=a.nodes[0]||a.connectors[0]),"ConnectorSourceEnd"===i&&a||"PortDraw"===i||(Nn(t)||Rn(t))&&ld(t.drawingObject)===W)for(var l=t.selectedItems.connectors[0],c=e.length-1;0<=c;c--){var p=Qh(e[parseInt(c.toString(),10)],!1),g=Qh(e[parseInt(c.toString(),10)],!0),u=t[s].tool,m=this.findTargetElement(e[parseInt(c.toString(),10)].wrapper,o,t,void 0);if("Draw"===i&&m&&(e[parseInt(c.toString(),10)]instanceof _||e[parseInt(c.toString(),10)]instanceof W)&&!md(e[parseInt(c.toString(),10)],m)&&(u&&"ConnectorSourceEnd"===u[h]&&!Dn(e[parseInt(c.toString(),10)])||u&&"ConnectorTargetEnd"===u[h]&&!An(e[parseInt(c.toString(),10)])))return d;if(e[parseInt(c.toString(),10)]instanceof _||e[parseInt(c.toString(),10)]instanceof W&&(Dn(e[parseInt(c.toString(),10)])||On(p)||An(e[parseInt(c.toString(),10)])||Tn(g)||"PortDraw"===i&&u instanceof xo&&"ConnectorTargetEnd"===u[h]&&(An(e[parseInt(c.toString(),10)])||Tn(g))))return d=e[parseInt(c.toString(),10)],l&&(d=this.isTarget(d,t,i)),r.actualObject=d}else if("ConnectorTargetEnd"===i&&a){for(c=e.length-1;0<=c;c--)if(g=Qh(e[parseInt(c.toString(),10)],!0),(e[parseInt(c.toString(),10)]instanceof _||e[parseInt(c.toString(),10)]instanceof W)&&(An(e[parseInt(c.toString(),10)])||Tn(g)))return d=e[parseInt(c.toString(),10)],d=this.isTarget(d,t,i),r.actualObject=d}else{if(a&&("Drag"===i||t[s].tool instanceof Po)){for(var f=0,c=0;c<e.length;c++){var y=e[parseInt(c.toString(),10)];a!==y&&(y instanceof W||!o||y.wrapper.bounds.containsPoint(o))&&En(y)&&(f=d?(d=f>=y.zIndex?d:y,Math.max(f,y.zIndex)):(d=y).zIndex)}return(d=!d||"Bpmn"!==d.shape.type||0<t.selectedItems.nodes.length&&"Bpmn"===t.selectedItems.nodes[0].shape.type?d:null)&&(r.actualObject=d),d}if("Select"!==i&&"Pan"!==i||!t[s].tool)if("Pan"===i||"LayoutAnimation"===i){for(c=e.length-1;0<=c;c--)if(e[parseInt(c.toString(),10)]instanceof _||e[parseInt(c.toString(),10)]instanceof W){m=this.findTargetElement(e[parseInt(c.toString(),10)].wrapper,o,t,void 0);if("Pan"===i||m&&(m.id.match("_icon_content_shape$")||m.id.match("_icon_content_rect$")))return e[parseInt(c.toString(),10)]}}else d=e[e.length-1],r&&d&&(r.actualObject=d);else{for(c=e.length-1;0<=c;c--)if(e[parseInt(c.toString(),10)]instanceof W){var v=e[c-1];if(e[c-1]instanceof _&&v.ports){if((m=this.findTargetElement(v.wrapper,o,t,void 0))&&(m.id.match("_icon_content_shape$")||m.id.match("_icon_content_rect$")))return v;for(var b=0;b<v.ports.length;b++)if(m&&m.id.match("_"+v.ports[parseInt(b.toString(),10)].id+"$")&&Yn(v.ports[parseInt(b.toString(),10)]))return v}}if(d=e[e.length-1],r.actualObject=d,!t[s].itemClick(d,!0)&&d.parentId)for(var S=d,w=so(t,S);S&&(!so(t,S)||w)&&""===(d=S).tooltip.content;)S=t.nameTable[S.parentId]}}return d},Ag.prototype.findElementUnderSelectedItem=function(t,e,i,n){return t instanceof B?1!==t.nodes.length||t.connectors&&t.connectors.length?t.nodes&&!t.nodes.length||1!==t.connectors.length?null:this.findElementUnderMouse(t.connectors[0],e,i):this.findElementUnderMouse(t.nodes[0],e,i):this.findElementUnderMouse(t,e,i,n)},Ag.prototype.findElementUnderMouse=function(t,e,i,n){return this.findTargetElement(t.wrapper,e,i,n)},Ag.prototype.findTargetElement=function(t,e,i,n){for(var r=t.children.length-1;0<=r;r--){var o=t.children[parseInt(r.toString(),10)];if(o&&o.outerBounds.containsPoint(e,n||0))if(o.visible){if(o instanceof te){var a=this.findTargetElement(o,e,i);if(a)return a}a="Clip"===o.style.textOverflow||"Ellipsis"===o.style.textOverflow;if(o.bounds.containsPoint(e,n||0)&&!a)return o;if(t.bounds.containsPoint(e,n||0)&&a)return o}else if(o instanceof P&&t&&t.id){var s;if(qh(t.id.includes("group_container")?(s=t.id.slice(0,-15),i.getObject(s)):i.getObject(t.id),o.id))return o}}return t.bounds.containsPoint(e,n)&&"none"!==t.style.fill?t:null};var Pg=Ag;function Ag(){}Tg=function(t,e){return(Tg=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)};var Tg,Dg,mg=function(t,e){function i(){this.constructor=t}Tg(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Og=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;0<=s;s--)(r=t[s])&&(a=(o<3?r(a):3<o?r(e,i,a):r(e,i))||a);return 3<o&&a&&Object.defineProperty(e,i,a),a},Mg=(Dg=N.ChildProperty,mg(Eg,Dg),Og([N.Property("")],Eg.prototype,"id",void 0),Og([N.Property(!0)],Eg.prototype,"visible",void 0),Og([N.Property(!1)],Eg.prototype,"lock",void 0),Og([N.Property()],Eg.prototype,"objects",void 0),Og([N.Property()],Eg.prototype,"addInfo",void 0),Og([N.Property(-1)],Eg.prototype,"zIndex",void 0),Eg);function Eg(t,e,i,n){t=Dg.call(this,t,e,i,n)||this;return t.objectZIndex=-1,t.zIndexTable={},t.objects=[],t}var Lg=function(o,a,s,h){return new(s=s||Promise)(function(t,e){function i(t){try{r(h.next(t))}catch(t){e(t)}}function n(t){try{r(h.throw(t))}catch(t){e(t)}}function r(e){e.done?t(e.value):new s(function(t){t(e.value)}).then(i,n)}r((h=h.apply(o,a||[])).next())})},zg=function(n,r){var o,a,s,h={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(i){return function(t){var e=[i,t];if(o)throw new TypeError("Generator is already executing.");for(;h;)try{if(o=1,a&&(s=2&e[0]?a.return:e[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,e[1])).done)return s;switch(a=0,(e=s?[2&e[0],s.value]:e)[0]){case 0:case 1:s=e;break;case 4:return h.label++,{value:e[1],done:!1};case 5:h.label++,a=e[1],e=[0];continue;case 7:e=h.ops.pop(),h.trys.pop();continue;default:if(!(s=0<(s=h.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){h=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3]))h.label=e[1];else if(6===e[0]&&h.label<s[1])h.label=s[1],s=e;else{if(!(s&&h.label<s[2])){s[2]&&h.ops.pop(),h.trys.pop();continue}h.label=s[2],h.ops.push(e)}}e=r.call(n,h)}catch(t){e=[6,t],a=0}finally{o=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}}},kg=(Object.defineProperty(p.prototype,"snappingModule",{get:function(){return this.diagram.snappingModule},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"layoutAnimateModule",{get:function(){return this.diagram.layoutAnimateModule},enumerable:!0,configurable:!0}),p.prototype.startTransaction=function(t){this.state={element:this.diagram.selectedItems,backup:null},t&&this.diagram.protectPropertyChange(!0),Uc(this.diagram.element.id).style.pointerEvents="none"},p.prototype.endTransaction=function(t){this.state=null,t&&this.diagram.protectPropertyChange(!1),Uc(this.diagram.element.id).style.pointerEvents="all"},p.prototype.setFocus=function(){document.getElementById(this.diagram.element.id).focus()},p.prototype.showTooltip=function(t,e,i,n,r){var o,a,s=this,h=!1;t instanceof B?1===t.nodes.length&&0===t.connectors.length?(a=t.nodes[0].id,t.nodes[0].shape&&t.nodes[0].shape instanceof Kd&&(h=!0)):0===t.nodes.length&&1===t.connectors.length?a=t.connectors[0].id:o=document.getElementById(this.diagram.element.id+"_SelectorElement"):t instanceof _?(a=t.id,t.shape&&t.shape instanceof Kd&&(h=!0)):a=t.id,N.isNullOrUndefined(o)&&!N.isNullOrUndefined(a)&&(o=document.getElementById(a+(h?"_content_native_element":"_groupElement"))),r&&(this.diagram.tooltipObject.position="BottomCenter",this.diagram.tooltipObject.animation={open:{delay:0,duration:0}},this.diagram.tooltipObject.openDelay=0,this.diagram.tooltipObject.closeDelay=0),this.diagram.selectedItems.setTooltipTemplate&&(a=void 0,(h=Dp(this.diagram.selectedItems.setTooltipTemplate))&&(a=h(t,this.diagram)),i=a instanceof HTMLElement?a.cloneNode(!0):a||i),this.diagram.tooltipObject.isSticky=!1,t.tooltip&&(this.diagram.tooltipObject.openOn=t.tooltip.openOn),this.diagram.tooltipObject.content="string"==typeof i?N.initializeCSPTemplate(function(){return i}):i,this.diagram.tooltipObject.offsetX=0,this.diagram.tooltipObject.offsetY=0,this.diagram.tooltipObject.refresh(o),r&&setTimeout(function(){s.diagram.tooltipObject.open(o)},1)},p.prototype.connectorSplit=function(t,e){var i=t.id,n=Q(e),r=this.diagram.connectors.indexOf(e),o=this.diagram.nodes.indexOf(t),a=Q(t),s={},h={},d={offsetX:a.offsetX,offsetY:a.offsetY},l={sourceID:n.sourceID,sourcePoint:n.sourcePoint,sourcePortID:n.sourcePortID,targetID:n.targetID,targetPoint:n.targetPoint,targetPortID:n.targetPortID},c=(s[parseInt(r.toString(),10)]=l,h[parseInt(o.toString(),10)]=d,{}),p={},g={},u={},r=(""!==n.sourceID&&""!==n.targetID?u.targetID=this.ConnectorTargetChange(e,i):""!==n.sourceID&&""===n.targetID?(this.nodeOffsetChange(g,a,e.targetPoint),u.targetID=this.ConnectorTargetChange(e,i)):(""===n.sourceID&&""===n.targetID||""===n.sourceID&&""!==n.targetID)&&(this.nodeOffsetChange(g,a,e.sourcePoint),u.sourceID=this.ConnectorSourceChange(e,i)),c[parseInt(r.toString(),10)]=u,p[parseInt(o.toString(),10)]=g,this.diagram.nodePropertyChange(t,d,g),this.diagram.updateSelector(),this.diagram.connectorPropertyChange(e,l,u),""!==n.sourceID&&""!==n.targetID&&((a={id:"connector "+i,constraints:Z.ConnectorConstraints.Default|Z.ConnectorConstraints.AllowDrop,sourceID:i}).type=n.type,a.style=n.style,a.sourceDecorator=n.sourceDecorator,a.targetDecorator=n.targetDecorator,a.targetID=n.targetID,""!==n.targetPortID&&(a.targetPortID=n.targetPortID),this.diagram.add(a)),{type:"PropertyChanged",redoObject:{nodes:p},undoObject:{nodes:h},category:"Internal"}),o=(this.diagram.addHistoryEntry(r),{type:"PropertyChanged",redoObject:{connectors:c},undoObject:{connectors:s},category:"Internal"});this.diagram.addHistoryEntry(o)},p.prototype.nodeOffsetChange=function(t,e,i){t.offsetX=e.offsetX=i.x,t.offsetY=e.offsetY=i.y},p.prototype.ConnectorTargetChange=function(t,e){return t.targetID=e},p.prototype.ConnectorSourceChange=function(t,e){return t.sourceID=e},p.prototype.closeTooltip=function(){this.diagram.tooltipObject.close()},p.prototype.canEnableDefaultTooltip=function(){return!!(this.diagram.selectedItems.constraints&Z.SelectorConstraints.ToolTip)},p.prototype.updateSelector=function(){this.diagram.updateSelector()},p.prototype.triggerEvent=function(e,i){return Lg(this,void 0,void 0,function(){return zg(this,function(t){switch(t.label){case 0:return e!==Z.DiagramEvent.drop&&e!==Z.DiagramEvent.positionChange&&e!==Z.DiagramEvent.connectionChange?[3,3]:this.diagram.currentSymbol?[2]:(e===Z.DiagramEvent.drop&&(i.source=this.diagram),this.diagram.currentDrawingObject instanceof W&&e!==Z.DiagramEvent.positionChange?[4,this.diagram.triggerEvent(e,i)]:[3,2]);case 1:return[2,t.sent()];case 2:if(this.diagram.currentDrawingObject&&e!==Z.DiagramEvent.positionChange)return[2];t.label=3;case 3:return[4,this.diagram.triggerEvent(e,i)];case 4:return[2,t.sent()]}})})},p.prototype.dragOverElement=function(t,e){this.diagram.currentSymbol&&(t={element:t.source,target:t.target,mousePosition:e,diagram:this.diagram},this.triggerEvent(Z.DiagramEvent.dragOver,t))},p.prototype.disConnect=function(t,e,i){var n,r,o,a={},s={};return t instanceof B?r=t.connectors[0]:t instanceof W&&this.diagram.currentDrawingObject&&(r=this.diagram.currentDrawingObject),t&&r&&(ao(this.diagram)||this.diagram.currentDrawingObject)&&(!e||"ConnectorSourceEnd"!==e&&"ConnectorTargetEnd"!==e?"OrthoThumb"!==e&&"SegmentEnd"!==e&&(r.sourceID||r.targetID)&&(a={sourceID:r.sourceID,sourcePortID:r.sourcePortID,targetID:r.targetID,targetPortID:r.targetPortID},r.sourceID="",r.sourcePortID="",r.targetID="",r.targetPortID="",t={connector:r,oldValue:a,newValue:s={sourceID:r.sourceID,sourcePortID:r.sourcePortID,targetID:r.targetID,targetPortID:r.targetPortID},cancel:!1,state:"Changing",connectorEnd:e},this.triggerEvent(Z.DiagramEvent.connectionChange,t),t.cancel?(r.sourceID=a.sourceID,r.sourcePortID=a.sourcePortID,r.targetID=a.targetID,r.targetPortID=a.targetPortID):(this.diagram.connectorPropertyChange(r,a,s),this.diagram.updateDiagramObject(r),this.triggerEvent(Z.DiagramEvent.connectionChange,t={connector:r,oldValue:a,newValue:s,cancel:!1,state:"Changed",connectorEnd:e}))):(t="ConnectorSourceEnd"===e?"sourcePortID":"targetPortID",r[o="ConnectorSourceEnd"===e?"sourceID":"targetID"]&&(a[o]=r[o],r[o]="",s[o]=r[o],(r.sourcePortID||r.targetPortID)&&(a[t]=r[t],r[t]="",s[t]=r[t]),n=this.connectionEventChange(r,a,s,e,i)))),n},p.prototype.connectionEventChange=function(t,e,i,n,r){var o,a,s="ConnectorSourceEnd"===n?"sourceID":"targetID",h="ConnectorSourceEnd"===n?"sourcePortID":"targetPortID",n=(this.enableCloneObject&&(a=Q(o=this.diagram.nameTable[i[s]]),this.diagram.insertValue(a,!0)),{cancel:!1,state:"Changing",connectorEnd:n,connector:t,oldValue:{nodeId:e[s],portId:e[h]},newValue:{nodeId:i[s],portId:i[h]}});this.triggerEvent(Z.DiagramEvent.connectionChange,n),n.cancel&&(t[s]=e[s],t[h]=e[h],i=e),this.diagram.connectorPropertyChange(t,e,i),this.diagram.updateDiagramObject(t),e[s],e[h],i[s],i[h],this.enableCloneObject&&void 0===o&&(a=Q(o=this.diagram.nameTable[e[s]]),this.diagram.insertValue(a,!0)),this.diagram.bpmnModule&&t.isBpmnAnnotationConnector&&(this.diagram.nameTable[t.targetID].shape.textAnnotation.textAnnotationTarget=t.sourceID)},p.prototype.findTarget=function(t,e,i,n){if(e instanceof _){if(t&&t.id===e.id+"_content")return e;if(i&&"Bpmn"===e.shape.type&&!N.isBlazor()&&"Activity"===e.shape.shape&&"Transaction"===e.shape.activity.subProcess.type){i=e.shape.activity.subProcess.transaction;if(i.success.visible&&0===t.id.indexOf(e.id+"_success"))return i.success;if(i.cancel.visible&&0===t.id.indexOf(e.id+"_cancel"))return i.cancel;if(i.failure.visible&&0===t.id.indexOf(e.id+"_failure"))return i.failure}if(t instanceof P||t instanceof an){i=this.findMatch(e.ports,e.id,t.id);if(i)return i;i=this.findMatch(e.fixedUserHandles,e.id,t.id);if(i)return i}}if(e instanceof W){if(t&&t.id===e.id+"_path")return e;if(t instanceof P||t instanceof an){i=this.findMatch(e.ports,e.id,t.id);if(i)return i;i=this.findMatch(e.fixedUserHandles,e.id,t.id);if(i)return i}}if(!n)for(var r,o=0;o<e.annotations.length;o++)if(r=e.annotations[parseInt(o.toString(),10)],t.id===e.id+"_"+r.id)return r;return e},p.prototype.findMatch=function(t,e,i){for(var n=0;n<t.length;n++){var r=t[parseInt(n.toString(),10)];if(i===e+"_"+r.id||i===e+"_"+r.id+"_shape")return r}},p.prototype.canDisconnect=function(t,e,i,n){var r;e.source instanceof B?r=e.source.connectors[0]:e.source instanceof W&&this.diagram.currentDrawingObject&&(r=this.diagram.currentDrawingObject),this.findTarget(e.targetWrapper,e.target,"ConnectorSourceEnd"===t,!0);return r["ConnectorSourceEnd"===t?"sourceID":"targetID"]!==n||r["ConnectorSourceEnd"===t?"sourcePortID":"targetPortID"]!==i},p.prototype.connect=function(t,e,i){var n,r,o,a={},s={},h=(e.source instanceof B?r=e.source.connectors[0]:e.source instanceof W&&this.diagram.currentDrawingObject&&(r=this.diagram.currentDrawingObject),this.findTarget(e.targetWrapper||e.sourceWrapper,e.target||e.actualObject,"ConnectorSourceEnd"===t,!0)),d="ConnectorSourceEnd"===t?"sourceID":"targetID",l="ConnectorSourceEnd"===t?"sourcePortID":"targetPortID";return h instanceof _?(s[d]=r[d],r[d]=h.id,a[d]=r[d],s[l]=r[l],o=this.connectionEventChange(r,s,a,t,i)):(h instanceof Le||h instanceof Pl)&&(i=r[d],n=r[l],r[l]=h.id,r[d]=e.target&&e.target.id||e.actualObject.id,a[d]=r[d],a[l]=r[l],this.triggerEvent(Z.DiagramEvent.connectionChange,h={connector:r,oldValue:{nodeId:i,portId:n},newValue:{nodeId:a[d],portId:a[l]},cancel:!1,state:"Changing",connectorEnd:t}),h.cancel?(r[d]=i,r[l]=n,a[d]=i,a[l]=n):(this.diagram.connectorPropertyChange(r,s,a),this.diagram.updateDiagramObject(r),h={connector:r,oldValue:{nodeId:i,portId:n},newValue:{nodeId:a[d],portId:a[l]},cancel:!1,state:"Changing",connectorEnd:t})),this.renderHighlighter(e,void 0,"ConnectorSourceEnd"===t),o},p.prototype.cut=function(){this.clipboardData.pasteIndex=0,this.diagram.undoRedoModule&&this.diagram.historyManager.startGroupAction(),this.clipboardData.clipObject=this.copyObjects(),this.diagram.undoRedoModule&&this.diagram.historyManager.endGroupAction(),"SVG"!==this.diagram.mode&&this.diagram.refreshDiagramLayer()},p.prototype.addLayer=function(t,e,i){t.id=t.id||q(),t.zIndex=this.diagram.layers.length;var n=this.diagram.allowServerDataBinding;this.diagram.enableServerDataBinding(!1),t=new Mg(this.diagram,"layers",t,!0),this.diagram.enableServerDataBinding(n),t.objectZIndex=-1,t.zIndexTable={},this.diagram.layers.push(t),this.diagram.layerZIndexTable[t.zIndex]=t.id,(this.diagram.activeLayer=t).objects;if(e)for(var r=0;r<e.length;r++)this.diagram.add(e[parseInt(r.toString(),10)])},p.prototype.getObjectLayer=function(t){var e=this.diagram.layers;if(1<e.length)for(var i=0;i<e.length;i++)if(-1<e[parseInt(i.toString(),10)].objects.indexOf(t))return e[parseInt(i.toString(),10)];return this.diagram.activeLayer},p.prototype.getLayer=function(t){for(var e=this.diagram.layers,i=0;i<e.length;i++)if(e[parseInt(i.toString(),10)].id===t)return e[parseInt(i.toString(),10)]},p.prototype.removeLayer=function(t,e){var i=this.getLayer(t);if(i){for(var n=this.diagram.layers.indexOf(i),r=i.objects,o=r.length-1;0<=o;o--)this.diagram.unSelect(this.diagram.nameTable[r[parseInt(o.toString(),10)]]),this.diagram.remove(this.diagram.nameTable[r[parseInt(o.toString(),10)]]),"default_layer"!==i.id&&this.diagram.activeLayer.id===t&&(this.diagram.activeLayer=this.diagram.layers[this.diagram.layers.length-1]);delete this.diagram.layerZIndexTable[i.zIndex],this.diagram.layers.splice(n,1),"SVG"!==this.diagram.mode&&this.diagram.refreshDiagramLayer()}},p.prototype.moveObjects=function(t,e){this.diagram.startGroupAction();for(var i={},n=[],r=0;r<t.length;r++){var o,a=this.diagram.nameTable[t[parseInt(r.toString(),10)]];a instanceof _?(o={inEdges:a.inEdges,outEdges:a.outEdges},i[""+a.id]=Q(o)):a instanceof W&&(o={sourceID:a.sourceID,targetID:a.targetID,sourcePortID:a.sourcePortID,targetPortID:a.targetPortID},i[""+a.id]=Q(o))}var s,e=this.getLayer(e)||this.diagram.activeLayer;this.diagram.setActiveLayer(e.id);for(var h=0,d=t;h<d.length;h++){var l,r=d[h];if(-1<this.getObjectLayer(r).objects.indexOf(r)){if(n=[],(s=this.diagram.nameTable[""+r]).children)for(var c=0,p=s.children;c<p.length;c++){var g=p[c];n.push(this.diagram.nameTable[""+g])}if(this.diagram.unSelect(s),this.diagram.deleteDependentConnector=!1,this.diagram.remove(this.diagram.nameTable[""+r]),this.diagram.deleteDependentConnector=!0,0<n.length){for(var u=void 0,m=0,f=n;m<f.length;m++){g=f[m];u=this.diagram.add(g),this.setConnectorDetails(u||g,i),s.children.push(u.id)}u=this.diagram.add(s)}else u=this.diagram.add(s);this.setConnectorDetails(u||s,i),s.parentId&&(l=s.parentId,l=this.diagram.nameTable[""+l],this.diagram.addChildToGroup(l,s.id))}}this.diagram.endGroupAction()},p.prototype.setConnectorDetails=function(t,e){var i=e[t.id];if(t instanceof _){if(i){if(i.inEdges&&0<i.inEdges.length)for(var n=0;n<i.inEdges.length;n++)this.diagram.nameTable[i.inEdges[parseInt(n.toString(),10)]].targetID=t.id;if(i.outEdges&&0<i.outEdges.length)for(n=0;n<i.outEdges.length;n++)this.diagram.nameTable[i.outEdges[parseInt(n.toString(),10)]].sourceID=t.id}}else t instanceof W&&i&&(t.sourceID=i.sourceID,t.targetID=i.targetID,t.sourcePortID=i.sourcePortID,t.targetPortID=i.targetPortID)},p.prototype.cloneLayer=function(t){this.diagram.layers;var e=this.getLayer(t);if(e){for(var i=[],t={id:t+"_"+q(),objects:[],visible:!0,lock:!1},n=(this.addLayer(t,null,!0),t.zIndex=this.diagram.layers.length-1,0),r=e.objects;n<r.length;n++){var o=r[n];i.push(this.diagram.nameTable[""+o])}this.paste(i)}},p.prototype.copy=function(){return this.clipboardData.pasteIndex=1,this.clipboardData.clipObject=this.copyObjects(),this.clipboardData.clipObject},p.prototype.copyObjects=function(){var t,e,i=[],n=[];if(this.clipboardData.childTable={},0<this.diagram.selectedItems.connectors.length)for(var i=i.concat(this.diagram.selectedItems.connectors),r=0;r<i.length;r++){var o=void 0,o=this.diagram.bpmnModule&&i[parseInt(r.toString(),10)].isBpmnAnnotationConnector?Q(this.diagram.nameTable[i[parseInt(r.toString(),10)].targetID]):Q(i[parseInt(r.toString(),10)]);n.push(o)}if(0<this.diagram.selectedItems.nodes.length){i=i.concat(this.diagram.selectedItems.nodes);for(r=0;r<this.diagram.selectedItems.nodes.length;r++)if(!this.diagram.selectedItems.nodes[parseInt(r.toString(),10)].isPhase){var a=Q(this.diagram.selectedItems.nodes[parseInt(r.toString(),10)]),s=n.filter(function(t){return t.isLane}),h=!1;if(a.isLane)for(var d=0,l=s;d<l.length;d++){var c=l[d];if(c=c,t=a,e=this.diagram,!(!c.isLane||!t.isLane||c.id===t.id||c.parentId!==t.parentId||Hr(c,e)!==Hr(t,e))){h=!0;break}}if(!((a.isLane||a.isHeader)&&this.checkSwimlaneInSelection(a,n)||(s=a,p=this.diagram,s.parentId&&-1!==p.selectedItems.nodes.indexOf(p.nameTable[s.parentId]))||h)){a.wrapper&&a.offsetX!==a.wrapper.offsetX&&(a.offsetX=a.wrapper.offsetX),a.wrapper&&a.offsetY!==a.wrapper.offsetY&&(a.offsetY=a.wrapper.offsetY),this.copyProcesses(a),n.push(Q(a));var p,g=rt();if(at(g,-a.rotateAngle,a.offsetX,a.offsetY),a.children){for(var u=this.clipboardData.childTable,m=this.getAllDescendants(a,[],!0),f=0;f<m.length;f++){var y,v=u[(y=this.diagram.nameTable[m[parseInt(f.toString(),10)].id]).id]=Q(y),b=z(g,{x:v.wrapper.offsetX,y:v.wrapper.offsetY});y instanceof _&&(v.offsetX=b.x,v.offsetY=b.y,v.rotateAngle-=a.rotateAngle)}this.clipboardData.childTable=u}if("SwimLane"===a.shape.type)for(var S=this.diagram.getObject(this.diagram.selectedItems.nodes[parseInt(r.toString(),10)].id),u=this.clipboardData.childTable,w=cr(this.diagram,S.wrapper.children[0]),f=0;f<w.length;f++){var x=this.diagram.getObject(w[parseInt(f.toString(),10)]);u[x.id]=Q(x),u[x.id].parentSwimlaneId=a.id}a&&a.isLane&&(u=this.clipboardData.childTable,S=this.diagram.getObject(a.parentId),p=Hr(a,this.diagram),u[a.id]=Q(p),u[a.id].width=S.wrapper.actualSize.width)}}}if(this.sortByZIndex(n,"zIndex"),this.diagram.selectedItems.nodes.some(function(t){return"SwimLane"===t.shape.type})&&(n=this.removeDuplicateObjects(n)),0===this.clipboardData.pasteIndex){this.startGroupAction();for(var I=0,C=i;I<C.length;I++){var P=C[I];this.diagram.nameTable[P.id]&&this.diagram.remove(P)}this.endGroupAction()}return n},p.prototype.findProcesses=function(t){var e=[];return t.shape.lanes.forEach(function(t){t.children.forEach(function(t){t=t.shape.activity;t&&t.subProcess.processes&&t.subProcess.processes.forEach(function(t){e.push(t)})})}),e},p.prototype.removeDuplicateObjects=function(t){for(var e={},i=0;i<t.length;i++)e[t[parseInt(i.toString(),10)].id]=t[parseInt(i.toString(),10)];var n,r=[];for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.push(e[""+n]);for(var o,a=this,i=0;i<r.length;i++)!function(t){var e;r[parseInt(t.toString(),10)].parentId&&(e=a.diagram.getObject(r[parseInt(t.toString(),10)].parentId))&&e.isLane&&e.parentId&&r.some(function(t){return t.id===e.parentId})&&(r.splice(t,1),t--),o=t}(i),i=o;var s=Object.keys(this.clipboardData.childTable);return r.filter(function(t){return-1===s.indexOf(t.id)||t.isLane})},p.prototype.checkSwimlaneInSelection=function(e,t){return this.diagram.selectedItems.nodes.some(function(t){return t.id===e.parentId})},p.prototype.copyProcesses=function(t){if("Bpmn"===t.shape.type&&t.shape.activity&&t.shape.activity.subProcess.processes&&0<t.shape.activity.subProcess.processes.length){for(var e=0,i=t.shape.activity.subProcess.processes;e<i.length;e++){var n=i[e];this.processTable[""+n]=Q(this.diagram.nameTable[""+n]),this.processTable[""+n].shape.activity.subProcess.processes&&0<this.processTable[""+n].shape.activity.subProcess.processes.length&&this.copyProcesses(this.processTable[""+n])}this.clipboardData.processTable=this.processTable}},p.prototype.group=function(){var n=this,t=(this.oldSelectedObjects=hd(this.diagram),this.diagram.isProtectedOnChange),r=(this.diagram.protectPropertyChange(!0),this.diagram.diagramActions=this.diagram.diagramActions|Z.DiagramAction.Group,[]),e={};e.id="group"+q(),(e=new _(this.diagram,"nodes",e,!0)).children=[];for(var i,r=(r=this.diagram.selectedItems.nodes).concat(this.diagram.selectedItems.connectors),o=(this.diagram.connectors.forEach(function(e){var t=n.diagram.nameTable[e.sourceID],i=n.diagram.nameTable[e.targetID],t=t&&t.processId&&so(n.diagram,n.diagram.nameTable[t.processId]),i=i&&i.processId&&so(n.diagram,n.diagram.nameTable[i.processId]);r.some(function(t){return t.id===e.id})||!t&&!i||r.push(e)}),r.sort(function(t,e){return t.zIndex-e.zIndex})),a=0;a<o.length;a++)o[parseInt(a.toString(),10)].parentId||e.children.push(o[parseInt(a.toString(),10)].id);0<e.children.length&&((i=this.diagram.add(e))&&this.select(i),e.annotations=i.annotations,e.ports=i.ports,e.style=i.style,this.addHistoryEntry({type:"Group",undoObject:e,redoObject:e,category:"Internal"}),this.diagram.diagramActions=this.diagram.diagramActions&~Z.DiagramAction.Group,this.diagram.protectPropertyChange(t))},p.prototype.unGroup=function(t){var e=this.diagram.isProtectedOnChange,i=(this.diagram.protectPropertyChange(!0),this.diagram.diagramActions=this.diagram.diagramActions|Z.DiagramAction.Group,[]);t?i.push(t):i=this.diagram.selectedItems.nodes,this.diagram.startGroupAction();for(var n=0;n<i.length;n++){for(var r=i[parseInt(n.toString(),10)],o=Q(r),a=[],s=0;s<r.children.length;s++)a.push(r.children[parseInt(s.toString(),10)]);if(r.children){r.ports&&0<r.ports.length&&this.diagram.removePorts(r,r.ports),r.annotations&&0<r.annotations.length&&!N.isBlazor()&&this.diagram.removeLabels(r,r.annotations);for(var h=this.diagram.nameTable[r.parentId],d=r.children.length-1;0<=d;d--){this.diagram.nameTable[r.children[parseInt(d.toString(),10)]].parentId="";var l=r.children[parseInt(d.toString(),10)];this.diagram.deleteChild(this.diagram.nameTable[r.children[parseInt(d.toString(),10)]],r),r.parentId&&l&&this.diagram.addChild(h,l)}this.resetDependentConnectors(r.inEdges,!0),this.resetDependentConnectors(r.outEdges,!1),this.diagram.diagramActions&Z.DiagramAction.UndoRedo||this.addHistoryEntry({type:"UnGroup",undoObject:o,redoObject:o,category:"Internal"}),r.parentId&&this.diagram.deleteChild(r,h)}this.diagram.removeNode(r,a),this.clearSelection()}this.diagram.endGroupAction(),this.diagram.diagramActions=this.diagram.diagramActions&~Z.DiagramAction.Group,this.diagram.protectPropertyChange(e)},p.prototype.resetDependentConnectors=function(t,e){for(var i=0;i<t.length;i++){var n=this.diagram.nameTable[t[parseInt(i.toString(),10)]],r=Q(n),o=void 0,o=e?(n.targetID="",n.targetPortID="",{targetID:n.targetID,targetPortID:n.targetPortID}):(n.sourceID="",n.sourcePortID="",{sourceID:n.sourceID,sourcePortID:n.sourcePortID}),o=(this.diagram.connectorPropertyChange(n,{},o),{type:"ConnectionChanged",undoObject:{connectors:[r],nodes:[]},redoObject:{connectors:[Q(n)],nodes:[]},category:"Internal"});this.diagram.diagramActions&Z.DiagramAction.UndoRedo||this.addHistoryEntry(o)}},p.prototype.paste=function(t){if(t||this.clipboardData.clipObject){this.diagram.protectPropertyChange(!0);var e=t?this.getNewObject(t):this.clipboardData.clipObject;if(e){var i=1!==e.length,t=!1,n={},r={};0!==this.clipboardData.pasteIndex&&this.clearSelection(),this.diagram.undoRedoModule&&(t=!0,this.diagram.historyManager.startGroupAction());for(var o=0,a=e;o<a.length;o++)n[(h=a[o]).id]=h;var s=[];i&&(this.diagram.isServerUpdate=!0);for(var h,d=0;d<e.length;d++)if((h=e[parseInt(d.toString(),10)]).parentId&&"SwimLane"!==this.diagram.getObject(h.parentId).shape.type&&h.parentId&&(h.parentId=""),ld(h)===W){var l,c=Q(h),p=c.sourceID,p=(n[(c.sourceID="")+p]&&r[""+p]&&(c.sourceID=r[""+p]),p=c.targetID,n[(c.targetID="")+p]&&r[""+p]&&(c.targetID=r[""+p]),!0);(p=c.targetID&&"TextAnnotation"===(l=this.diagram.nameTable[c.targetID]).shape.shape&&l.inEdges&&0<l.inEdges.length?!1:p)&&(l=this.cloneConnector(c,i),s.push(l),r[h.id]=l.id)}else{h.shape&&"Bpmn"===h.shape.type&&(h.processId=""),this.cloningInProgress=!0;p=this.cloneNode(h,i);if(this.cloningInProgress=!1,s.push(p),p){r[h.id]=p.id;c=h.inEdges;if(c)for(var g=0,u=c;g<u.length;g++)n[""+(m=u[g])]&&r[""+m]&&((f=this.diagram.nameTable[r[""+m]]).targetID=r[h.id],this.diagram.connectorPropertyChange(f,{targetID:"",targetPortID:""},{targetID:f.targetID,targetPortID:f.targetPortID}));if(c=h.outEdges)for(var m,f,y=0,v=c;y<v.length;y++)n[""+(m=v[y])]&&r[""+m]&&((f=this.diagram.nameTable[r[""+m]]).sourceID=r[h.id],this.diagram.connectorPropertyChange(f,{sourceID:"",sourcePortID:""},{sourceID:f.sourceID,sourcePortID:f.sourcePortID}))}}i&&(this.diagram.isServerUpdate=!1,this.diagram.select(s,!0)),!0===t&&(this.diagram.historyManager.endGroupAction(),t=!1),"SVG"!==this.diagram.mode&&this.diagram.refreshDiagramLayer(),this.clipboardData.pasteIndex++,this.diagram.protectPropertyChange(!1)}}},p.prototype.getNewObject=function(t){var e,i=[];this.clipboardData.pasteIndex=1;for(var n=0;n<t.length;n++)e=Q(t[parseInt(n.toString(),10)]),i.push(e);return i},p.prototype.cloneConnector=function(t,e){t=Q(t),this.translateObject(t),t.zIndex=Number.MIN_VALUE,t=this.diagram.add(t);return this.diagram.isServerUpdate||this.selectObjects([t],e),t},p.prototype.cloneNode=function(t,e,i,n){var r,o,a={},s=Q(t),h=this.diagram.nameTable[t.parentId];t.shape&&"Bpmn"===t.shape.type&&t.shape.activity&&t.shape.activity.subProcess.processes&&t.shape.activity.subProcess.processes.length&&(o=s.shape.activity.subProcess.processes,s.zIndex=Number.MIN_VALUE,s.shape.activity.subProcess.processes=void 0),t.shape&&"SwimLane"===t.shape.type?Mr(t,this.diagram,this.clipboardData):h&&"SwimLane"===h.shape.type?Mr(Q(h),this.diagram,this.clipboardData,t,!0):r=!t.children||!t.children.length||i&&i.length?(this.translateObject(s,n),s.zIndex=Number.MIN_VALUE,i&&(s.children=i),s.shape&&"TextAnnotation"===s.shape.shape&&(s.isTextAnnotationCopied=!0),this.diagram.add(s)):this.cloneGroup(t,e);for(var d=0,l=Object.keys(a);d<l.length;d++){var c=l[d];this.diagram.add(a[""+c])}return o&&o.length&&(r.shape.activity.subProcess.processes=o,this.cloneSubProcesses(r)),r&&!this.diagram.isServerUpdate&&this.selectObjects([r],e),r},p.prototype.cloneSubProcesses=function(t){var e=[],i={};if("Bpmn"===t.shape.type&&t.shape.activity&&t.shape.activity.subProcess.processes&&t.shape.activity.subProcess.processes.length)for(var n=t.shape.activity.subProcess.processes,r=0;r<n.length;r++){for(var o=this.diagram.nameTable[n[parseInt(r.toString(),10)]]||this.clipboardData.processTable[n[parseInt(r.toString(),10)]],a=0,s=o.outEdges;a<s.length;a++){var h=s[a];e.indexOf(h)<0&&e.push(h)}for(var d=0,l=o.inEdges;d<l.length;d++){h=l[d];e.indexOf(h)<0&&e.push(h)}o=Q(this.clipboardData.processTable[n[parseInt(r.toString(),10)]]),o=(o.processId=t.id,this.cloneNode(o,!1));i[n[parseInt(r.toString(),10)]]=o.id,n[parseInt(r.toString(),10)]=o.id,this.diagram.addProcess(o,t.id);for(var c=0,p=e;c<p.length;c++){var g=p[c],u=Q(this.diagram.nameTable[""+g]||this.diagram.connectorTable[""+g]);i[u.sourceID]&&i[u.targetID]&&(u.zIndex=-1,u.id+=q(),u.sourceID=i[u.sourceID],u.targetID=i[u.targetID],e.splice(e.indexOf(g),1),u.zIndex=Number.MIN_VALUE,this.diagram.add(u))}}},p.prototype.cloneGroup=function(t,e){var i,n,r,o=[],a=[],s=[],h=(h=[]).concat(t.children),d=q(),l=[];if(this.diagram.blazorActions|=Z.BlazorAction.GroupClipboardInProcess,this.clipboardData.childTable||0<t.children.length)for(var c=0;c<h.length;c++){var p=void 0;(p=this.clipboardData.childTable&&(p=this.clipboardData.childTable[h[parseInt(c.toString(),10)]])||this.diagram.nameTable[h[parseInt(c.toString(),10)]]).parentId="",p&&(ld(p)===W?a.push(p):(r=this.cloneNode(p,e,void 0,d),s.push(p.id),o.push(r.id),l.push(r)))}for(var g=0;g<a.length;g++){if(a[parseInt(g.toString(),10)].sourceID||a[parseInt(g.toString(),10)].targetID)for(var u=0;u<s.length;u++)a[parseInt(g.toString(),10)].sourceID===s[parseInt(u.toString(),10)]&&(i=a[parseInt(g.toString(),10)].sourceID,a[parseInt(g.toString(),10)].sourceID+=d),a[parseInt(g.toString(),10)].targetID===s[parseInt(u.toString(),10)]&&(n=a[parseInt(g.toString(),10)].targetID,a[parseInt(g.toString(),10)].targetID+=d);r=this.cloneConnector(a[parseInt(g.toString(),10)],e),a[parseInt(g.toString(),10)].sourceID=i,a[parseInt(g.toString(),10)].targetID=n,o.push(r.id),l.push(r)}t=this.cloneNode(t,e,o);return l.push(t),t&&t.container&&t.shape&&"UmlClassifier"===t.shape.type&&(this.diagram.updateDiagramObject(t),t.wrapper.measure(new j)),this.diagram.blazorActions&=~Z.BlazorAction.GroupClipboardInProcess,this.diagram.isServerUpdate?this.cloneGroupChildCollection=l:this.diagram.UpdateBlazorDiagramModelCollection(void 0,l,void 0,!0),t},p.prototype.translateObject=function(t,e){t.id+=e||q();var i=10*this.clipboardData.pasteIndex;if(ld(t)===W){if(t.sourcePoint={x:t.sourcePoint.x+i,y:t.sourcePoint.y+i},t.targetPoint={x:t.targetPoint.x+i,y:t.targetPoint.y+i},"Bezier"===t.type)for(var n=t.segments,r=0;r<n.length;r++)K.isEmptyPoint(n[parseInt(r.toString(),10)].point1)||(n[parseInt(r.toString(),10)].point1={x:n[parseInt(r.toString(),10)].point1.x+i,y:n[parseInt(r.toString(),10)].point1.y+i}),K.isEmptyPoint(n[parseInt(r.toString(),10)].point2)||(n[parseInt(r.toString(),10)].point2={x:n[parseInt(r.toString(),10)].point2.x+i,y:n[parseInt(r.toString(),10)].point2.y+i});if(("Straight"===t.type||"Bezier"===t.type)&&t.segments&&0<t.segments.length)for(n=t.segments,r=0;r<n.length-1;r++)n[parseInt(r.toString(),10)].point.x+=i,n[parseInt(r.toString(),10)].point.y+=i}else t.offsetX+=i,t.offsetY+=i},p.prototype.drawObject=function(t){t&&t.shape&&"Text"===t.shape.type&&(t.width=this.diagram.drawingObject.width||50,t.height=this.diagram.drawingObject.height||20);for(var e,i=Q(this.diagram.drawingObject),n=0,r=Object.keys(t);n<r.length;n++){var o=r[n];i[""+o]=t[""+o]}return ld(this.diagram.drawingObject)===_||ld(this.diagram.drawingObject)===W&&"Freehand"===this.diagram.drawingObject.type&&"Bezier"!==t.type?(e=new _(this.diagram,"nodes",i,!0)).id=(this.diagram.drawingObject.id||"node")+q():(e=new W(this.diagram,"connectors",i,!0)).id=(this.diagram.drawingObject&&this.diagram.drawingObject.id||"connector")+q(),this.diagram.initObject(e),this.diagram.updateDiagramObject(e),this.diagram.currentDrawingObject=e},p.prototype.addObjectToDiagram=function(t){this.diagram.removeFromAQuad(t),this.diagram.removeObjectsFromLayer(this.diagram.nameTable[t.id]),delete this.diagram.nameTable[t.id],t instanceof W&&"Bezier"===t.type&&0<t.segments.length&&this.diagram.drawingObject&&"Bezier"===this.diagram.drawingObject.type&&(t.segments=[]);var e=this.diagram.add(t);"SVG"!==this.diagram.mode&&this.diagram.refreshDiagramLayer(),this.selectObjects([e]),t&&!Rn(this.diagram)&&(this.diagram.tool&=~Z.DiagramTools.DrawOnce,this.diagram.currentDrawingObject=void 0)},p.prototype.enableServerDataBinding=function(t){this.diagram.enableServerDataBinding(t)},p.prototype.addText=function(t,e){e=this.diagram.findElementUnderMouse(t,e,this.diagram);this.diagram.startTextEdit(t,e instanceof H?e.id.split("_")[1]:void 0)},p.prototype.isUserHandle=function(t){var e=this.diagram.selectedItems;if(e.wrapper&&Uh(e.constraints,"UserHandle"))for(var i=0,n=e.userHandles;i<n.length;i++){var r=n[i];if(r.visible)if(ro(t,Vh(e,r,this.diagram.scroller.transform),r.size/(2*this.diagram.scroller.transform.scale)))return!0}return!1},p.prototype.selectObjects=function(p,g,u){return Lg(this,void 0,void 0,function(){var e,i,n,r,o,a,s,h,d,l,c;return zg(this,function(t){if(e={oldValue:u||this.getSelectedObject(),newValue:p,cause:this.diagram.diagramActions,state:"Changing",type:"Addition",cancel:!1},0<p.length&&p[0]&&p[0].isLane)for(i=this.diagram.getObject(p[0].parentId),p[0].shape.header=[],n=0;n<p.length;n++)for(h=0;h<i.shape.lanes.length;h++)r=p[0].id.split(p[0].parentId),r[1].slice(0,-1)===i.shape.lanes[parseInt(h.toString(),10)].id&&p[0].shape.header.push(i.shape.lanes[parseInt(h.toString(),10)].header);if(this.diagram.enableServerDataBinding(!1),N.isBlazor()?this.oldSelectedObjects=hd(this.diagram):this.diagram.triggerEvent(Z.DiagramEvent.selectionChange,e),o=this.diagram.selectedItems.annotation?[this.diagram.selectedItems.annotation]:this.diagram.selectedItems.nodes.concat(this.diagram.selectedItems.connectors),a=kn(this.diagram),(s=zn(this.diagram))||a){if(!a&&(1<p.length||g&&1===p.length)){if(1!==p.length)return[2];this.clearSelection()}if(!(s||a||1!==p.length||g&&oo(this.diagram)))return this.clearSelection(),[2]}if(!e.cancel){for(h=0;h<p.length;h++)if(d=p[parseInt(h.toString(),10)])if(oo(this.diagram)){if((0<h||g)&&d.children&&!d.parentId)for(l=0;l<this.diagram.selectedItems.nodes.length;l++)(c=(c=this.diagram.nameTable[this.diagram.selectedItems.nodes[parseInt(l.toString(),10)].parentId])&&this.findParent(c))&&d.id===c.id&&this.selectGroup(d);this.selectProcesses(d),this.selectBpmnSubProcesses(d)&&this.select(d,0<h||g,!0)}else this.select(d,0<h||g,!0);e={oldValue:(u=void 0===u?o:u)||[],newValue:this.getSelectedObject(),cause:this.diagram.diagramActions,state:"Changed",type:"Addition",cancel:!1},this.diagram.renderSelector(g||p&&1<p.length),N.isBlazor()||this.diagram.triggerEvent(Z.DiagramEvent.selectionChange,e),this.diagram.enableServerDataBinding(!0)}return[2]})})},p.prototype.findParent=function(t){return t.parentId&&(t=this.diagram.nameTable[t.parentId],this.findParent(t)),t},p.prototype.selectProcesses=function(t){if(this.hasProcesses(t))for(var e=t.shape.activity.subProcess.processes,i=0;i<e.length;i++){var n=this.diagram.nameTable[e[parseInt(i.toString(),10)]];this.hasProcesses(n)&&this.selectObjects([n],!0),this.unSelect(n)}},p.prototype.selectGroup=function(t){for(var e=0;e<t.children.length;e++){var i=this.diagram.nameTable[t.children[parseInt(e.toString(),10)]];i.children&&this.selectGroup(i),this.unSelect(this.diagram.nameTable[t.children[parseInt(e.toString(),10)]])}},p.prototype.selectBpmnSubProcesses=function(t){var e,i=!0;if(t.processId)i=!so(this.diagram,this.diagram.nameTable[t.processId])&&this.selectBpmnSubProcesses(this.diagram.nameTable[t.processId]);else if(t instanceof W){if(t.sourceID&&this.diagram.nameTable[t.sourceID]&&this.diagram.nameTable[t.sourceID].processId&&(e=this.diagram.nameTable[t.sourceID].processId),e=t.targetID&&this.diagram.nameTable[t.targetID]&&this.diagram.nameTable[t.targetID].processId?this.diagram.nameTable[t.targetID].processId:e){if(so(this.diagram,this.diagram.nameTable[""+e]))return!1;i=this.selectBpmnSubProcesses(this.diagram.nameTable[""+e])}}else t.parentId&&this.diagram.nameTable[t.parentId]&&"UmlClassifier"===this.diagram.nameTable[t.parentId].shape.type&&so(this.diagram,this.diagram.nameTable[t.parentId])&&(i=!1);return i},p.prototype.hasProcesses=function(t){return!!(t&&"Bpmn"===t.shape.type&&t.shape.activity&&t.shape.activity.subProcess.processes&&0<t.shape.activity.subProcess.processes.length)},p.prototype.select=function(t,e,i){var n,r=this.getObjectLayer(t.id);!vn(t)||t instanceof B||so(this.diagram,t)||!r||r.lock||!r.visible||!t.wrapper.visible||((e=!!oo(this.diagram)&&e)||this.clearSelection(),this.diagram.enableServerDataBinding(!1),r=this.diagram.selectedItems,t instanceof _?t.isHeader?(n=this.diagram.nameTable[t.parentId],r.nodes.push(n)):r.nodes.push(t):r.connectors.push(t),r.selectedObjects.push(t),e?(r.wrapper.rotateAngle=r.rotateAngle=0,r.wrapper.children.push(t.wrapper)):(r.init(this.diagram),1===r.nodes.length&&0===r.connectors.length&&((n=Er(this.diagram,r))&&(r.wrapper.children[0]=n),r.rotateAngle=r.nodes[0].rotateAngle,r.wrapper.rotateAngle=r.nodes[0].rotateAngle,r.wrapper.pivot=r.nodes[0].pivot)),i||this.diagram.renderSelector(e),this.diagram.enableServerDataBinding(!0))},p.prototype.labelSelect=function(t,e,i){this.oldSelectedObjects=hd(this.diagram);var n,r,e=this.findTarget(e,t),o={oldValue:i||this.getSelectedObject(),newValue:[e],cause:this.diagram.diagramActions,state:"Changing",type:"Addition",cancel:!1};N.isBlazor()?this.oldSelectedObjects=hd(this.diagram):this.diagram.triggerEvent(Z.DiagramEvent.selectionChange,o),o.cancel||(n=this.diagram.selectedItems,r=this.diagram.allowServerDataBinding,this.diagram.allowServerDataBinding=!1,n.nodes=n.connectors=[],this.diagram.allowServerDataBinding=r,t instanceof _?n.nodes[0]=t:n.connectors[0]=t,n.annotation=e,n.init(this.diagram),this.diagram.renderSelector(!1),o={oldValue:i||[],newValue:[n.annotation],cause:this.diagram.diagramActions,state:"Changed",type:"Addition",cancel:!1},N.isBlazor())||this.diagram.triggerEvent(Z.DiagramEvent.selectionChange,o)},p.prototype.unSelect=function(e){var t,i,n=this.diagram.selectedItems.nodes.concat(this.diagram.selectedItems.connectors),r=n.filter(function(t){return t.id!==e.id}),o={oldValue:n,newValue:r,cause:this.diagram.diagramActions,state:"Changing",type:"Removal",cancel:!1};this.diagram.currentSymbol||N.isBlazor()||this.diagram.triggerEvent(Z.DiagramEvent.selectionChange,o),so(this.diagram,e)&&(t=this.diagram.selectedItems,i=void 0,(e instanceof _?(i=t.nodes.indexOf(e,0),t.nodes):(i=t.connectors.indexOf(e,0),t.connectors)).splice(i,1),i=t.selectedObjects.indexOf(e,0),t.selectedObjects.splice(i,1),o={oldValue:n,newValue:r,cause:this.diagram.diagramActions,state:"Changed",type:"Removal",cancel:!1},(o={oldValue:n,newValue:r,cause:this.diagram.diagramActions,state:"Changed",type:"Removal",cancel:o.cancel}).cancel||(i=t.wrapper.children.indexOf(e.wrapper,0),t.wrapper.children.splice(i,1),this.diagram.updateSelector(),this.diagram.currentSymbol)||this.diagram.triggerEvent(Z.DiagramEvent.selectionChange,o))},p.prototype.moveSvgNode=function(t,e){var i=this.diagram.nameTable[""+e];"Native"===i.shape.type||"HTML"===i.shape.type?this.updateNativeNodeIndex(t,e):(i=Y(e+"_groupElement",this.diagram.element.id),e=Y(t+"_groupElement",this.diagram.element.id),i.parentNode.insertBefore(e,i))},p.prototype.moveAfterSvgNode=function(t,e){var i=this.diagram.nameTable[""+e];if(!i||"HTML"!==i.shape.type&&"Native"!==i.shape.type){a=Y(e+"_groupElement",this.diagram.element.id),o=Y(t+"_groupElement",this.diagram.element.id);a.insertAdjacentElement("afterend",o)}else for(var n=0;n<this.diagram.views.length;n++){var r="HTML"===i.shape.type?"_html_element":"_content_groupElement",o=Y(t+r,this.diagram.views[parseInt(n.toString(),10)]),a=e?Y(e+r,this.diagram.views[parseInt(n.toString(),10)]):o.parentElement.firstChild;o&&a&&o.parentNode.id===a.parentNode.id&&a.insertAdjacentElement("afterend",o)}},p.prototype.sendLayerBackward=function(t){t=this.getLayer(t);if(t&&0!==t.zIndex){var e=t.zIndex;if("SVG"===this.diagram.mode){var i=t.objects,n=this.getLayer(this.diagram.layerZIndexTable[e-1]).objects[0];if(n)for(var r=0,o=i;r<o.length;r++){var a=o[r];this.moveSvgNode(a,n)}}i=this.getLayer(this.diagram.layerZIndexTable[e-1]),i=(i.zIndex=i.zIndex+1,t.zIndex=t.zIndex-1,this.diagram.layerZIndexTable[parseInt(e.toString(),10)]);this.diagram.layerZIndexTable[parseInt(e.toString(),10)]=this.diagram.layerZIndexTable[e-1],this.diagram.layerZIndexTable[e-1]=i,"Canvas"===this.diagram.mode&&this.diagram.refreshDiagramLayer()}},p.prototype.bringLayerForward=function(t){t=this.getLayer(t);if(t&&t.zIndex<this.diagram.layers.length-1){var e=t.zIndex,i=this.getLayer(this.diagram.layerZIndexTable[e+1]);if("SVG"===this.diagram.mode)for(var n=t.objects[0],r=0,o=i.objects;r<o.length;r++){var a=o[r];a&&this.moveSvgNode(a,n)}i.zIndex=i.zIndex-1,t.zIndex=t.zIndex+1;i=this.diagram.layerZIndexTable[parseInt(e.toString(),10)];this.diagram.layerZIndexTable[parseInt(e.toString(),10)]=this.diagram.layerZIndexTable[e+1],this.diagram.layerZIndexTable[e+1]=i,"Canvas"===this.diagram.mode&&this.diagram.refreshDiagramLayer()}},p.prototype.sendToBack=function(t){if(this.diagram.protectPropertyChange(!0),oo(this.diagram)||t){for(var e=this.diagram.selectedItems,i=[],e=(t&&t.id?i.push(t):i=(i=i.concat(e.nodes)).concat(e.connectors),t&&t.id,Q(this.diagram.selectedItems)),n=(i=i.slice().sort(function(t,e){return t.zIndex-e.zIndex})).length-1;0<=n;n--){Q(i[parseInt(n.toString(),10)]);for(var r=i[parseInt(n.toString(),10)].id,o=this.diagram.nameTable[""+r].zIndex,a=this.diagram.layers.indexOf(this.getObjectLayer(r)),s=(this.updateLayerZindexTable(a),this.diagram.layers[parseInt(a.toString(),10)].zIndexTable),h=this.diagram.layers[parseInt(a.toString(),10)].objects,d=null,l=0;l<h.length;l++){var c=this.diagram.nameTable[h[parseInt(l.toString(),10)]];(null===d||c.zIndex<d)&&(d=c.zIndex,c.id)}var p,g,u=JSON.parse(JSON.stringify(s)),m=0;if(1!==this.diagram.nodes.length&&(void 0===this.diagram.nameTable[""+r].children||this.checkObjectBehind(r,s,o))){if((c=this.diagram.nameTable[""+r]).zIndex>d&&"SwimLane"!==c.shape.type?(p=Q(c),g=null,c.children?(g=this.findMaxZIndex(c)-c.zIndex,c.zIndex=d-1-g,this.updateGroupZindex(c,"SendToBack",d)):c.zIndex=d-1,this.triggerOrderCommand(p,c,c)):"SwimLane"===c.shape.type&&(m=this.swapZIndexObjects(o,s,r,u)),"SVG"===this.diagram.mode){for(var f="SwimLane"!==this.diagram.nameTable[""+r].shape.type?d:m,y=s[parseInt(f.toString(),10)];!y&&f<o;)y=s[++f];(y=this.resetTargetNode(r,y,f,s))&&(y=this.diagram.nameTable[""+y].parentId?this.checkParentExist(y):y,this.moveSvgNode(r,y)),this.updateNativeNodeIndex(r)}else this.diagram.refreshCanvasLayers();this.updateLayerZindexTable(a)}}t=Q(this.diagram.selectedItems);this.diagram.diagramActions&Z.DiagramAction.UndoRedo||this.addHistoryEntry({type:"SendToBack",category:"Internal",undoObject:e,redoObject:t})}this.diagram.protectPropertyChange(!1)},p.prototype.findMaxZIndex=function(t){function n(t){for(var e=0;e<t.children.length;e++){var i=r.diagram.nameTable[t.children[parseInt(e.toString(),10)]];(null===o||i.zIndex>o)&&(o=i.zIndex),i.children&&n(i)}}var r=this,o=null;return n(t),o},p.prototype.updateGroupZindex=function(t,e,i){function n(t){for(var e=0;e<t.children.length;e++){var i=o.diagram.nameTable[t.children[parseInt(e.toString(),10)]];i.children?(i.zIndex=r++,n(i)):i.zIndex=r++}}var r,o=this;void 0===r&&(r=t.zIndex+1);n(t)},p.prototype.updateLayersZindexTable=function(t){this.updateLayerZindexTable(t)},p.prototype.updateLayerZindexTable=function(t){var e=this.diagram.layers[parseInt(t.toString(),10)];e.zIndexTable={};for(var i=0;i<e.objects.length;i++){var n=this.diagram.nameTable[e.objects[parseInt(i.toString(),10)]];e.zIndexTable[n.zIndex]=n.id}},p.prototype.swapZIndexObjects=function(t,e,i,n){for(var r=0,o=0,a=-1,s=1,h=0;h<=t;h++)e[parseInt(h.toString(),10)]&&this.diagram.nameTable[e[parseInt(h.toString(),10)]].parentId===i&&(-1===a&&(a=h),o++);for(h=0;h<=t;h++)if(e[parseInt(h.toString(),10)]&&s<=o){for(;!e[parseInt(a.toString(),10)];)a++;e[parseInt(h.toString(),10)]=e[parseInt(a.toString(),10)],this.diagram.nameTable[e[parseInt(h.toString(),10)]].zIndex=h,a++,s++}for(var d=0,h=0;h<o;h++){for(;!e[parseInt(d.toString(),10)];)d++;r=this.diagram.nameTable[e[parseInt(d.toString(),10)]].zIndex,d++}for(r+=1;!e[parseInt(r.toString(),10)];)++r;d=0,e[parseInt(r.toString(),10)]=this.diagram.nameTable[""+i].id,this.diagram.nameTable[""+i].zIndex=r;for(h=r+=1;h<=t;h++)if(e[parseInt(h.toString(),10)]){for(;!n[parseInt(d.toString(),10)];)d++;e[parseInt(h.toString(),10)]=n[parseInt(d.toString(),10)],this.diagram.nameTable[e[parseInt(h.toString(),10)]].zIndex=h,d++}return r},p.prototype.resetTargetNode=function(t,e,i,n){return"SwimLane"===this.diagram.nameTable[""+t].shape.type&&void 0!==this.diagram.nameTable[""+e].parentId&&""!==this.diagram.nameTable[""+e].parentId&&this.diagram.nameTable[this.diagram.nameTable[""+e].parentId].isLane&&(i+=1,n[parseInt(i.toString(),10)])?(e=n[parseInt(i.toString(),10)],this.resetTargetNode(t,e,i,n)):e},p.prototype.checkParentExist=function(t){for(var e=t;this.diagram.nameTable[""+e].parentId;)e=this.diagram.nameTable[""+e].parentId;return e},p.prototype.checkObjectBehind=function(t,e,i){return!0},p.prototype.bringToFront=function(t){if(this.diagram.protectPropertyChange(!0),oo(this.diagram)||t){t&&t.id;for(var e=this.diagram.selectedItems,i=[],t=(t&&t.id?i.push(t):i=(i=i.concat(e.nodes)).concat(e.connectors),Q(this.diagram.selectedItems)),i=i.slice().sort(function(t,e){return t.zIndex-e.zIndex}),n=0;n<i.length;n++){Q(i[parseInt(n.toString(),10)]);for(var r=i[parseInt(n.toString(),10)].id,o=this.diagram.layers.indexOf(this.getObjectLayer(r)),a=(this.updateLayerZindexTable(o),this.diagram.layers[parseInt(o.toString(),10)].zIndexTable),s=this.diagram.layers[parseInt(o.toString(),10)].objects,h=null,d=0;d<s.length;d++){var l=this.diagram.nameTable[s[parseInt(d.toString(),10)]];(null===h||l.zIndex>h)&&(h=l.zIndex)}for(var c=JSON.parse(JSON.stringify(a)),p=Number(Object.keys(a).sort(function(t,e){return Number(t)-Number(e)}).reverse()[0]),g=this.diagram.nameTable[""+r].zIndex,u=[],m=0;m<=p;m++)u.push(a[parseInt(m.toString(),10)]);if("SwimLane"===this.diagram.nameTable[""+r].shape.type)for(var f=p;g<=f;f--)if(a[parseInt(f.toString(),10)]&&this.diagram.nameTable[a[parseInt(f.toString(),10)]].parentId!==r){p=f;break}var y=this.diagram.nameTable[""+r];if(y.zIndex<h&&"SwimLane"!==y.shape.type){var v=Q(y);y.children?this.findMaxZIndex(y)<h&&(y.zIndex=h+1,this.updateGroupZindex(y,"BringToFront",h)):y.zIndex=h+1,this.triggerOrderCommand(v,y,y)}else if("SwimLane"===y.shape.type){for(var b=0,S=-1,w=0,x=0,I=JSON.parse(JSON.stringify(a)),C=0;C<=g;C++)if(a[parseInt(C.toString(),10)]&&this.diagram.nameTable[a[parseInt(C.toString(),10)]].parentId===r&&-1===S){w=S=C;break}for(var P,A,T=0;T<=p;T++)c[parseInt(T.toString(),10)]&&c[parseInt(T.toString(),10)]!==r&&this.diagram.nameTable[c[parseInt(T.toString(),10)]].parentId!==r&&(P=this.diagram.nameTable[c[parseInt(T.toString(),10)]],A=this.diagram.nameTable[""+r],P.zIndex>=A.zIndex)&&b++;for(var D=S,O=0;O<=b;O++){for(;!a[parseInt(D.toString(),10)];)D++;x=this.diagram.nameTable[a[parseInt(D.toString(),10)]].zIndex,D++}for(var M=x;M<=p;M++){for(;!I[parseInt(S.toString(),10)];)S++;for(;!a[parseInt(M.toString(),10)];)M++;a[parseInt(M.toString(),10)]=I[parseInt(S.toString(),10)],this.diagram.nameTable[a[parseInt(M.toString(),10)]].zIndex=M,S++}a[parseInt(p.toString(),10)]=this.diagram.nameTable[""+r].id,this.diagram.nameTable[""+r].zIndex=p;for(var D=g+1,E=w,L=0;L<b;L++){for(;!c[parseInt(D.toString(),10)];)D++;for(;this.diagram.nameTable[c[parseInt(D.toString(),10)]].parentId===r;)D++;for(;!a[parseInt(E.toString(),10)];)E++;a[parseInt(E.toString(),10)]=c[parseInt(D.toString(),10)],this.diagram.nameTable[a[parseInt(E.toString(),10)]].zIndex=E,D++,E++}}if("SVG"===this.diagram.mode){var v="SwimLane"!==this.diagram.nameTable[""+r].shape.type?h:0,y=a[parseInt(v.toString(),10)],y=((y=this.resetTargetNode(r,y,v,a))&&(y=this.diagram.nameTable[""+y].parentId?this.checkParentExist(y):y,this.moveAfterSvgNode(r,y)),this.diagram.diagramLayer),z=Y(r+"_groupElement",this.diagram.element.id),k=this.diagram.selectedItems.nodes;if(0<k.length&&("Native"===k[0].shape.type||"HTML"===k[0].shape.type)){z.parentNode.removeChild(z);for(E=0;E<this.diagram.views.length;E++){var B=(z=Y(r+("HTML"===k[0].shape.type?"_html_element":"_content_groupElement"),this.diagram.views[parseInt(E.toString(),10)])).parentNode.lastChild;B.parentNode.insertBefore(z,B.nextSibling)}var R=$c(this.diagram.element.id);this.diagram.diagramRenderer.renderElement(this.diagram.nameTable[""+r].wrapper,y,R)}}else this.diagram.refreshCanvasLayers();this.updateLayerZindexTable(o)}e=Q(this.diagram.selectedItems);this.diagram.diagramActions&Z.DiagramAction.UndoRedo||this.addHistoryEntry({type:"BringToFront",category:"Internal",undoObject:t,redoObject:e})}this.diagram.protectPropertyChange(!1)},p.prototype.triggerOrderCommand=function(t,e,i){t={zIndex:Q(t).zIndex},e={zIndex:e.zIndex},i={element:i,cause:this.diagram.diagramActions,diagramAction:this.diagram.getDiagramAction(this.diagram.diagramActions),oldValue:t,newValue:e};this.diagram.triggerEvent(Z.DiagramEvent.propertyChange,i)},p.prototype.checkGroupNode=function(t,e,i){return i[""+e].parentId===i[""+t].parentId},p.prototype.sortByZIndex=function(t,e,i){var n,r;return t="BringForward"===i?(n=e||"zIndex",t.sort(function(t,e){return e[""+n]-t[""+n]})):(r=e||"zIndex",t.sort(function(t,e){return t[""+r]-e[""+r]}))},p.prototype.orderCommands=function(t,n,e){var r=this;if(l=(l=n.nodes).concat(n.connectors),t){var i=(i=n.selectedObjects).slice().sort(function(t,e){return t.zIndex-e.zIndex});if("SendBackward"===e)for(var o=0;o<i.length;o++)this.sendBackward(i[parseInt(o.toString(),10)]);else if("SendForward"===e)for(o=i.length-1;0<=o;o--)this.sendForward(i[parseInt(o.toString(),10)]);else if("BringToFront"===e)for(o=0;o<i.length;o++)this.bringToFront(i[parseInt(o.toString(),10)]);else if("SendToBack"===e)for(o=i.length-1;0<=o;o--)this.sendToBack(i[parseInt(o.toString(),10)])}else{var t=l[0],a=this.getObjectLayer(t.id),s=a.zIndex,h=a.zIndexTable,d=void 0;if("SendBackward"===e||"SendToBack"===e)for(var l=l.slice().sort(function(t,e){return t.zIndex-e.zIndex}),o=0;o<l.length;o++){var c=l[parseInt(o.toString(),10)];if((w=this.diagram.nameTable[l[parseInt(o.toString(),10)].id]).zIndex=c.zIndex,this.diagram.layers[parseInt(s.toString(),10)].zIndexTable[c.zIndex]=c.id,d=c.id,"SendToBack"===e&&("SwimLane"===l[0].shape.type&&this.bringToFront(l[0]),w.children&&this.updateGroupZindex(w,"",null),this.updateLayerZindexTable(a.zIndex)),"SVG"===this.diagram.mode){for(var p=(x=this.diagram.nameTable[""+d]).zIndex,g=this.diagram.layers.indexOf(this.getObjectLayer(d)),u=this.diagram.layers[parseInt(g.toString(),10)].objects,m=null,f=this,y=0;y<u.length;y++)!function(t){var e=f.diagram.nameTable[u[parseInt(t.toString(),10)]],i=!0;n.selectedObjects.forEach(function(t){i=r.notChildOfSelectedNode(e,t)}),i&&e.zIndex<p&&(null===m||e.zIndex>m)&&(m=e.zIndex)}(y);var v=0,b="SwimLane"!==this.diagram.nameTable[""+d].shape.type?m:v,S=void 0;(S=N.isNullOrUndefined(b)?S:h[parseInt(b.toString(),10)])&&(S=this.diagram.nameTable[""+S].parentId?this.checkParentExist(S):S,"SendBackward"===e?(x.parentId&&this.notChildOfSelectedNode(x,this.diagram.nameTable[""+S])||""===x.parentId)&&this.moveAfterSvgNode(d,S):"SendToBack"===e&&"SwimLane"!==l[0].shape.type&&this.moveAfterSvgNode(d,S))}else this.diagram.refreshCanvasLayers()}else if("SendForward"===e||"BringToFront"===e){l=l.slice().sort(function(t,e){return t.zIndex-e.zIndex});for(o=0;o<l.length;o++){var w,c=l[parseInt(o.toString(),10)];if((w=this.diagram.nameTable[l[parseInt(o.toString(),10)].id]).zIndex=c.zIndex,this.diagram.layers[parseInt(s.toString(),10)].zIndexTable[c.zIndex]=c.id,d=c.id,"BringToFront"===e&&("SwimLane"===l[0].shape.type&&this.sendToBack(l[0]),w.children&&this.updateGroupZindex(w,"",null),this.updateLayerZindexTable(a.zIndex)),"SVG"===this.diagram.mode){for(var x,p=(x=this.diagram.nameTable[""+d]).zIndex,g=this.diagram.layers.indexOf(this.getObjectLayer(d)),u=this.diagram.layers[parseInt(g.toString(),10)].objects,I=null,C=this,P=u.length-1;0<=P;P--)!function(t){var e=C.diagram.nameTable[u[parseInt(t.toString(),10)]],i=!0;n.selectedObjects.forEach(function(t){i=r.notChildOfSelectedNode(e,t)}),!n.selectedObjects.some(function(t){return t.id===e.id})&&i&&e.zIndex>p&&(null===I||e.zIndex<I)&&(I=e.zIndex)}(P);v=0,b="SwimLane"!==this.diagram.nameTable[""+d].shape.type?I:v,S=void 0;(S=N.isNullOrUndefined(b)?S:h[parseInt(b.toString(),10)])&&(S=this.diagram.nameTable[""+S].parentId?this.checkParentExist(S):S,"SendForward"===e?""===x.parentId&&this.moveSvgNode(d,S):"BringToFront"===e&&"SwimLane"!==l[0].shape.type&&this.moveSvgNode(d,S))}else this.diagram.refreshCanvasLayers()}}}},p.prototype.sendForward=function(t){var f=this;if(this.diagram.protectPropertyChange(!0),oo(this.diagram)||t){for(var e=this.diagram.selectedItems,y=[],v=(t&&t.id?y.push(t):y=(y=y.concat(e.nodes)).concat(e.connectors),this.sortByZIndex(y),t&&t.id),b=Q(this.diagram.selectedItems),S=(this.diagram.startGroupAction(),[]),i=function(t){Q(y[parseInt(t.toString(),10)]);v=y[parseInt(t.toString(),10)].id;for(var n=w.diagram.layers.indexOf(w.getObjectLayer(v)),e=Q(w.diagram.nameTable),t=w.diagram.layers[parseInt(n.toString(),10)].zIndexTable,r=w.diagram.nameTable[""+v],o=[],i=w.diagram.spatialSearch.findObjects(r.wrapper.bounds),a=0,s=i=2<i.length?w.sortByZIndex(i,void 0,"BringForward"):i;a<s.length;a++)!function(e){var t,i;r.id!==e.id&&(t=w.getObjectLayer(e.id).zIndex,i=w.diagram.selectedItems.selectedObjects.some(function(t){return t.id===e.id}),w.diagram.selectedItems.selectedObjects||!i)&&n===t&&Number(w.diagram.nameTable[""+v].zIndex)<Number(e.zIndex)&&""===e.parentId&&r.wrapper.bounds.intersects(e.wrapper.bounds)&&o.push(e)}(h=s[a]);for(var h=o.length-1;0<=h;h--)w.diagram.nameTable[o[parseInt(h.toString(),10)].id].parentId===v&&o.splice(h,1);if(0<o.length){for(var i=w.diagram.nameTable[o[o.length-1].id],h=(i.parentId&&(i=Id(i,w.diagram,""),(i=w.diagram.nameTable[""+i]).id!==v)&&(o[0]=i),0);h<w.diagram.nodes.length;h++){var d=w.diagram.nodes[parseInt(h.toString(),10)];d.id,d.zIndex}for(var l=0;l<w.diagram.connectors.length;l++){var c=w.diagram.connectors[parseInt(l.toString(),10)];c.id,c.zIndex}var p,i=o[0].zIndex,g=(t[parseInt(i.toString(),10)],{}),u=(o.forEach(function(t){g[t.id]=t.zIndex}),[]),m=(r&&(p=r.zIndex,0<Object.keys(g).length)&&(Object.values(g).forEach(function(t){p<=t&&u.push(t)}),0!==u.length)&&w.updateZIndexBySendForward(r,u,n),[]);Object.keys(w.changedNodeZIndexes).forEach(function(t){(e[""+t]?e[""+t].zIndex:null)!==f.changedNodeZIndexes[""+t]&&(t=Q(e[""+t]),m.push(t))}),w.updateLayerZindexTable(n),m.forEach(function(e){var t;b.nodes.some(function(t){return t.id===e.id})||(t=Q(e),b.nodes.push(t))}),"SVG"===w.diagram.mode?(t=o[o.length-1].id,w.moveAfterSvgNode(v,t),w.updateNativeNodeIndex(t,v)):w.diagram.refreshCanvasLayers(),Object.keys(w.changedNodeZIndexes).forEach(function(t){(e[""+t]?e[""+t].zIndex:null)!==f.changedNodeZIndexes[""+t]&&(t=Q(f.diagram.nameTable[""+t]),S.push(t))})}},w=this,n=y.length-1;0<=n;n--)i(n);var r=Q(this.diagram.selectedItems);S.forEach(function(e){var t;r.nodes.some(function(t){return t.id===e.id})||(t=Q(e),r.nodes.push(t))}),this.diagram.diagramActions&Z.DiagramAction.UndoRedo||this.addHistoryEntry({type:"SendForward",category:"Internal",undoObject:b,redoObject:r}),this.diagram.endGroupAction()}this.diagram.protectPropertyChange(!1)},p.prototype.updateZIndexBySendForward=function(e,t,i){var n=Q(e),r=Math.min.apply(Math,t),t=this.diagram.layers[parseInt(i.toString(),10)].zIndexTable[parseInt(r.toString(),10)],o=(this.diagram.nameTable[""+t].children&&(r=this.findGreatestChildZIndex(this.diagram.nameTable[""+t])),this.diagram.layers[parseInt(i.toString(),10)].objects),a=this.diagram.nodes.filter(function(t){return-1!==o.indexOf(t.id)}),s=(this.diagram.connectors.filter(function(t){return-1!==o.indexOf(t.id)}).forEach(function(t){a.push(t)}),a.filter(function(t){return t.zIndex===r&&t.id!==e.id})),h=e.children?(e.zIndex=r+1,this.updateGroupZindex(e,"BringForward",e.zIndex),this.findGreatestChildZIndex(e)):(e.zIndex=r+1,e.zIndex);this.triggerOrderCommand(n,e,e);for(var d=a.slice().sort(function(t,e){return t.zIndex-e.zIndex}),l=!0,c=0;c<d.length;c++){var p=d[parseInt(c.toString(),10)];if(e.children&&(l=this.notChildOfSelectedNode(p,e)),p.zIndex>r&&p!==e&&p.parentId!==e.id&&l&&s&&0<s.length&&p.parentId!==s[0].id){var g=Q(p);if(!(p.zIndex<=h+1))break;p.zIndex=h+1,h++,this.triggerOrderCommand(g,p,p)}g=p.zIndex;this.changedNodeZIndexes.hasOwnProperty(p.id),this.changedNodeZIndexes[p.id]=g}},p.prototype.findGreatestChildZIndex=function(t){function n(t){for(var e=0;e<t.children.length;e++){var i=r.diagram.nameTable[t.children[parseInt(e.toString(),10)]];i.children?n(i):i.zIndex>o&&(o=i.zIndex)}}var r=this,o=t.zIndex;return n(t),o},p.prototype.notChildOfSelectedNode=function(t,e){function r(t,e){for(var i=0;i<e.children.length;i++){var n=o.diagram.nameTable[e.children[parseInt(i.toString(),10)]];if(n.id===t.id)return a=!1;n.children&&r(t,n)}}var o=this,a=!0;return e.children&&r(t,e),a},p.prototype.sendBackward=function(t){var y=this;if(this.diagram.protectPropertyChange(!0),oo(this.diagram)||t){for(var e=this.diagram.selectedItems,v=[],b=(t&&t.id?v.push(t):v=(v=v.concat(e.nodes)).concat(e.connectors),this.sortByZIndex(v),t&&t.id),S=Q(this.diagram.selectedItems),w=(this.diagram.startGroupAction(),[]),i=function(t){Q(v[parseInt(t.toString(),10)]);b=v[parseInt(t.toString(),10)].id;for(var n=x.diagram.layers.indexOf(x.getObjectLayer(b)),e=Q(x.diagram.nameTable),t=x.diagram.layers[parseInt(n.toString(),10)].zIndexTable,r=x.diagram.nameTable[""+b],o=[],i=x.diagram.spatialSearch.findObjects(r.wrapper.bounds),a=0,s=i=2<i.length?x.sortByZIndex(i):i;a<s.length;a++)!function(e){var t,i;r.id!==e.id&&(t=x.getObjectLayer(e.id).zIndex,i=x.diagram.selectedItems.selectedObjects.some(function(t){return t.id===e.id}),x.diagram.selectedItems.selectedObjects||!i)&&n===t&&Number(x.diagram.nameTable[""+b].zIndex)>Number(e.zIndex)&&""===e.parentId&&r.wrapper.bounds.intersects(e.wrapper.bounds)&&o.push(e)}(h=s[a]);for(var h=o.length-1;0<=h;h--)(d=x.diagram.nameTable[o[parseInt(h.toString(),10)].id]).parentId===b&&o.splice(h,1);if(0<o.length){(d=x.diagram.nameTable[o[o.length-1].id]).parentId&&(i=Id(d,x.diagram,""),i=x.diagram.nameTable[""+i],b!==i.id)&&(o[o.length-1]=i);for(var d,h=0;h<x.diagram.nodes.length;h++){var l=x.diagram.nodes[parseInt(h.toString(),10)];l.id,l.zIndex}for(var c=0;c<x.diagram.connectors.length;c++){var p=x.diagram.connectors[parseInt(c.toString(),10)];p.id,p.zIndex}var g,i=o[o.length-1].zIndex,u=(t[parseInt(i.toString(),10)],{}),m=(o.forEach(function(t){u[t.id]=t.zIndex}),[]),f=(r&&(g=r.zIndex,0<Object.keys(u).length)&&(Object.values(u).forEach(function(t){t<=g&&m.push(t)}),0!==m.length)&&x.updateZIndexBySendBackward(r,m,n),[]);Object.keys(x.changedNodeZIndexes).forEach(function(t){(e[""+t]?e[""+t].zIndex:null)!==y.changedNodeZIndexes[""+t]&&(t=Q(e[""+t]),f.push(t))}),x.updateLayerZindexTable(n),f.forEach(function(e){var t;S.nodes.some(function(t){return t.id===e.id})||(t=Q(e),S.nodes.push(t))}),"SVG"===x.diagram.mode?(t=o[o.length-1].id,(i=o[o.length-1])&&"HTML"!==i.shape.type&&"Native"!==i.shape.type&&x.moveSvgNode(b,t),(i=x.diagram.nameTable[""+t]).children&&0<i.children.length?x.updateNativeNodeIndex(b):x.updateNativeNodeIndex(b,t)):x.diagram.refreshCanvasLayers(),Object.keys(x.changedNodeZIndexes).forEach(function(t){(e[""+t]?e[""+t].zIndex:null)!==y.changedNodeZIndexes[""+t]&&(t=Q(y.diagram.nameTable[""+t]),w.push(t))})}},x=this,n=0;n<v.length;n++)i(n);var r=Q(this.diagram.selectedItems);w.forEach(function(e){var t;r.nodes.some(function(t){return t.id===e.id})||(t=Q(e),r.nodes.push(t))}),this.diagram.diagramActions&Z.DiagramAction.UndoRedo||this.addHistoryEntry({type:"SendBackward",category:"Internal",undoObject:S,redoObject:r}),this.diagram.endGroupAction()}this.diagram.protectPropertyChange(!1)},p.prototype.updateZIndexBySendBackward=function(e,t,i){var n=Q(e),r=Math.max.apply(Math,t),o=this.diagram.layers[parseInt(i.toString(),10)].objects,a=this.diagram.nodes.filter(function(t){return-1!==o.indexOf(t.id)}),s=(this.diagram.connectors.filter(function(t){return-1!==o.indexOf(t.id)}).forEach(function(t){a.push(t)}),a.filter(function(t){return t.zIndex===r&&t.id!==e.id})),h=e.children?(t=this.findMaxZIndex(e)-e.zIndex,e.zIndex=r-1-t,this.updateGroupZindex(e,"SendBackward",e.zIndex),this.findLowestChildZIndex(e)):(e.zIndex=r-1,e.zIndex);this.triggerOrderCommand(n,e,e);for(var d=a.slice().sort(function(t,e){return e.zIndex-t.zIndex}),l=!0,c=0;c<d.length;c++){var p=d[parseInt(c.toString(),10)];if(e.children&&(l=this.notChildOfSelectedNode(p,e)),p.zIndex<r&&p!==e&&p.parentId!==e.id&&l&&s&&0<s.length&&p.parentId!==s[0].id){var g=Q(p);if(!(p.zIndex>=h-1))break;p.zIndex=h-1,h--,this.triggerOrderCommand(g,p,p)}g=p.zIndex;this.changedNodeZIndexes.hasOwnProperty(p.id),this.changedNodeZIndexes[""+p.id]=g}},p.prototype.findLowestChildZIndex=function(t){for(var e=t.zIndex,i=0;i<t.children.length;i++){var n=this.diagram.nameTable[t.children[parseInt(i.toString(),10)]];n.zIndex<e&&(e=n.zIndex)}return e},p.prototype.updateNativeNodeIndex=function(t,e){for(var i,n,r=this.diagram.selectedItems.nodes[0]||this.diagram.getObject(e),o=0;o<this.diagram.views.length;o++)!r||"HTML"!==r.shape.type&&"Native"!==r.shape.type||(i=Y(t+(n="HTML"===r.shape.type?"_html_element":"_content_groupElement"),this.diagram.views[parseInt(o.toString(),10)]),n=e?Y(e+n,this.diagram.views[parseInt(o.toString(),10)]):i.parentElement.firstChild,i&&n&&i.parentNode.id===n.parentNode.id&&n.parentNode.insertBefore(i,n))},p.prototype.initSelectorWrapper=function(){var t=this.diagram.selectedItems;t.init(this.diagram),1===t.nodes.length&&0===t.connectors.length&&(t.rotateAngle=t.nodes[0].rotateAngle,t.wrapper.rotateAngle=t.nodes[0].rotateAngle,t.wrapper.pivot=t.nodes[0].pivot)},p.prototype.doRubberBandSelection=function(t){this.clearSelectionRectangle();var e=[],i=this.diagram.getNodesConnectors([]);(e="CompleteIntersect"===this.diagram.selectedItems.rubberBandSelectionMode?Ks(t,i):this.diagram.spatialSearch.findObjects(t)).length&&this.selectObjects(e,!0)},p.prototype.clearSelectionRectangle=function(){var t=Vc(this.diagram.element.id).getElementById(this.diagram.element.id+"_diagramAdorner_selected_region");t&&N.remove(t)},p.prototype.dragConnectorEnds=function(t,e,i,n,r,o){var a,s,h,d=!1;return e instanceof B?a=e.connectors[0]:e instanceof W&&this.diagram.currentDrawingObject&&(this.clearSelection(),a=this.diagram.currentDrawingObject),"BezierSourceThumb"!==t&&"BezierTargetThumb"!==t||(a.isBezierEditing=d=!0),"ConnectorSourceEnd"===t||"BezierSourceThumb"===t?(s=i.x-(d?n.bezierPoint1:a.sourcePoint).x,h=i.y-(d?n.bezierPoint1:a.sourcePoint).y,this.dragSourceEnd(a,s,h,null,i,t,void 0,r,o,void 0,n)):(s=i.x-(d?n.bezierPoint2:a.targetPoint).x,h=i.y-(d?n.bezierPoint2:a.targetPoint).y,this.dragTargetEnd(a,s,h,null,i,t,void 0,n))},p.prototype.getSelectedObject=function(){var t=this.diagram.selectedItems;return t.annotation?[t.annotation]:t.nodes.concat(t.connectors)},p.prototype.enableCloneObject=function(t){},p.prototype.getBlazorOldValues=function(t,e){},p.prototype.clearObjectSelection=function(t){var e=this.diagram.selectedItems,i=[];-1===(i=i.concat(e.nodes,e.connectors)).indexOf(t)&&(this.clearSelection(0<i.length),this.selectObjects([t],!0))},p.prototype.clearSelection=function(o,t){return Lg(this,void 0,void 0,function(){var e,i,n,r;return zg(this,function(t){return e=this.diagram.allowServerDataBinding,this.diagram.enableServerDataBinding(!1),oo(this.diagram)&&(i=this.diagram.selectedItems,n=this.getSelectedObject(),this.diagram.currentSymbol&&(this.diagram.previousSelectedObject=n),r={oldValue:n,newValue:[],cause:this.diagram.diagramActions,state:"Changing",type:"Removal",cancel:!1},o&&!N.isBlazor()&&this.diagram.triggerEvent(Z.DiagramEvent.selectionChange,r),r.cancel||(i.offsetX=0,i.offsetY=0,i.width=0,i.height=0,i.rotateAngle=0,i.nodes=[],i.connectors=[],i.wrapper=null,i.annotation=void 0,i.selectedObjects=[],this.diagram.clearSelectorLayer(),o&&(r={oldValue:n,newValue:[],cause:this.diagram.diagramActions,state:"Changed",type:"Removal",cancel:!1},N.isBlazor()||this.diagram.triggerEvent(Z.DiagramEvent.selectionChange,r))),this.diagram.enableServerDataBinding(e)),[2]})})},p.prototype.clearSelectedItems=function(){var t=this.diagram.selectedItems.nodes?this.diagram.selectedItems.nodes.length:0,e=this.diagram.selectedItems.connectors?this.diagram.selectedItems.connectors.length:0;this.clearSelection(0<t+e)},p.prototype.removeStackHighlighter=function(){var t=Vc(this.diagram.element.id),t=t.getElementById(t.id+"_stack_highlighter");t&&t.parentNode.removeChild(t)},p.prototype.renderStackHighlighter=function(t,e){var i,n,r,o,a,s=this.diagram.selectedItems.nodes[0];if(!e){var h=this.diagram.findObjectsUnderMouse(t.position);if((e=this.diagram.findObjectUnderMouse(h,"Drag",!0))&&!(e.isLane||e.isPhase||e.isHeader))for(var d=0;d<h.length;d++){var l=this.diagram.nameTable[h[parseInt(d.toString(),10)].id];l.isLane&&!l.isPhase&&!l.isHeader||(this.diagram.parentObject=e=l)}}s&&e&&e.isLane&&s.shape&&!s.shape.isPhase&&(r=this.diagram.nameTable[e.parentId],this.diagram.currentSymbol&&"SwimLane"===r.shape.type&&(i=!0),s&&!s.parentId&&"SwimLane"!==s.shape.type||s&&s.parentId&&this.diagram.nameTable[s.parentId]&&this.diagram.nameTable[s.parentId].isLane&&s.parentId!==e.parentId&&s.parentId!==e.id)&&(n=this.diagram.selectedItems,o=Er(this.diagram,n,e.id,!0),this.diagram.renderSelector(!1,!0,o),n.wrapper.children[0]=n.nodes[0].wrapper),s&&e&&e.parentId&&s.shape&&s.shape.isPhase&&"SwimLane"===this.diagram.nameTable[e.parentId].shape.type&&(o=this.diagram.nameTable[e.parentId].wrapper,this.diagram.renderSelector(!1,!0,o)),(i&&this.diagram.currentSymbol.shape.isLane||s&&e&&s.parentId&&e.parentId&&!s.isPhase&&s.parentId===e.parentId&&s.id!==e.id&&r&&r.container&&("Stack"===r.container.type||"Grid"===r.container.type))&&(o=void 0,a="Vertical"===r.container.orientation,a="Stack"===r.container?a:!a,"Grid"===r.container.type&&e.isLane&&("Horizontal"===r.shape.orientation&&e.rowIndex!==s.rowIndex||"Vertical"===r.shape.orientation&&e.columnIndex!==s.columnIndex||this.diagram.currentSymbol&&this.diagram.currentSymbol.shape.orientation===r.container.orientation)&&(n=this.diagram.selectedItems,s.isLane&&Wr(s,this.diagram)||!s.isLane)&&(o=Er(this.diagram,n,e.id,i)),s="Stack"===r.container.type?e.wrapper:o)&&to(s,a,t.position,this.diagram,!1,!0)},p.prototype.insertBlazorConnector=function(t){if(t instanceof B)for(var e=0;e<t.connectors.length;e++)this.diagram.insertBlazorConnector(t.connectors[parseInt(e.toString(),10)]);else this.diagram.insertBlazorConnector(t)},p.prototype.drag=function(t,e,i){var n;if(!this.diagram.rotateUsingButton&&t.shape&&"SwimLane"!==t.shape.type&&(this.diagram.eventHandler.currentAction="Drag"),bn(t)&&this.checkBoundaryConstraints(e,i,t.wrapper.bounds)&&_n(this.diagram))if(t instanceof _){var r={offsetX:t.offsetX,offsetY:t.offsetY};if(t.offsetX+=e,t.offsetY+=i,t.children&&!t.container){Ur(this.diagram,t,!0)||(this.diagram.diagramActions=this.diagram.diagramActions|Z.DiagramAction.isGroupDragging);for(var o=this.getAllDescendants(t,[]),a=0;a<o.length;a++)n=this.diagram.nameTable[o[parseInt(a.toString(),10)].id],this.drag(n,e,i);this.updateInnerParentProperties(t),this.diagram.diagramActions=this.diagram.diagramActions&~Z.DiagramAction.isGroupDragging}Ur(this.diagram,t,!0)?Gr(this.diagram,t):(t&&t.shape&&"UmlClassifier"===t.shape.type&&(t.wrapper.measureChildren=!0),this.diagram.nodePropertyChange(t,r,{offsetX:t.offsetX,offsetY:t.offsetY},void 0,void 0,!1),t.wrapper.measureChildren=!1),"SwimLane"!==t.shape.type||this.diagram.currentSymbol||(s=t.wrapper.children[0],vr(cr(this.diagram,s),this.diagram))}else{var s=t,h=Q(t),r={sourcePoint:h.sourcePoint,targetPoint:h.targetPoint},h="Bezier"===s.type,d=!1,h=(s.sourceWrapper?d=!0:this.dragSourceEnd(s,e,i,!0,null,"",h),s.targetWrapper?d=!0:this.dragTargetEnd(s,e,i,!0,null,"",h),!1);t instanceof W&&(h=!0),d&&!h||(this.dragControlPoint(s,e,i,!0),t={sourcePoint:s.sourcePoint,targetPoint:s.targetPoint},this.diagram.connectorPropertyChange(s,r,t))}for(var l=0,c=this.diagram.views;l<c.length;l++){var p=c[l],p=this.diagram.views[p];p instanceof Zs&&this.diagram.refreshCanvasDiagramLayer(p)}},p.prototype.connectorSegmentChange=function(t,e,i){var n,r,o=!0;if(!1===e.equals(e,t.wrapper.bounds)&&0<t.outEdges.length)for(var a=0;a<t.outEdges.length;a++){var s=this.diagram.nameTable[t.outEdges[parseInt(a.toString(),10)]],o=""!==s.targetID?!this.isSelected(this.diagram.nameTable[s.targetID]):!this.isSelected(this.diagram.nameTable[s.id]);if("Orthogonal"===s.type&&s.segments&&1<s.segments.length)if(i){var h=s.segments[0],d=s.segments[1],l=Di(vi(t.wrapper,t.wrapper.corners,t.wrapper.bounds),h.direction),l=Bi({corners:void 0,point:Mi(s,s.sourceWrapper,l,{x:s.sourceWrapper.offsetX,y:s.sourceWrapper.offsetY},!1),margin:void 0,direction:h.direction},{corners:void 0,point:d.points[1],margin:void 0,direction:void 0});h.length=K.distancePoints(l[0],l[1]),d.direction&&d.length&&(d.length=K.distancePoints(l[1],l[2]))}else if(o){switch(s.segments[0].direction){case"Bottom":n=t.wrapper.bounds.bottomCenter.x-e.bottomCenter.x,r=t.wrapper.bounds.bottomCenter.y-e.bottomCenter.y;break;case"Top":n=t.wrapper.bounds.topCenter.x-e.topCenter.x,r=t.wrapper.bounds.topCenter.y-e.topCenter.y;break;case"Left":n=t.wrapper.bounds.middleLeft.x-e.middleLeft.x,r=t.wrapper.bounds.middleLeft.y-e.middleLeft.y;break;case"Right":n=t.wrapper.bounds.middleRight.x-e.middleRight.x,r=t.wrapper.bounds.middleRight.y-e.middleRight.y}this.dragSourceEnd(s,n,r,!0,null,"ConnectorSourceEnd",void 0,void 0,void 0,!(t.parentId&&this.diagram.diagramActions&Z.DiagramAction.isGroupDragging))}}},p.prototype.updateEndPoint=function(t,e){t.sourcePoint,t.targetPoint,t.sourceID,t.targetID,t.sourcePortID,t.targetPortID,t.segments;var i={sourcePoint:t.sourcePoint,targetPoint:t.targetPoint};t.sourceID&&(i.sourceID=t.sourceID),t.targetID&&(i.targetID=t.targetID),t.sourcePortID&&(i.sourcePortID=t.sourcePortID),t.targetPortID&&(i.targetPortID=t.targetPortID),t.segments&&(i.segments=t.segments),this.diagram.connectorPropertyChange(t,e||{},i),this.diagram.updateSelector()},p.prototype.dragSourceEnd=function(t,e,i,n,r,o,a,s,h,d,l){var c=this.diagram.nameTable[t.id],p={},g=this.checkBoundaryConstraints(e,i,c.wrapper.bounds);if(wn(c)&&g&&"BezierSourceThumb"!==o&&_n(this.diagram)&&(p=Q(p={sourcePoint:c.sourcePoint}),c.sourcePoint.x+=e,c.sourcePoint.y+=i,"ConnectorSourceEnd"===o&&"Orthogonal"===c.type&&this.changeSegmentLength(c,s,h,d),"Bpmn"===c.shape.type)&&"Default"===c.shape.sequence&&"Sequence"===c.shape.flow&&this.updatePathElementOffset(c),"Bezier"===c.type)if(p={sourcePoint:c.sourcePoint},l)this.translateBezierPoints(t,""===o?"ConnectorSourceEnd":o,e,i,l,r,!a);else for(var u=0;u<t.segments.length;u++)this.translateBezierPoints(t,""===o?"ConnectorSourceEnd":o,e,i,t.segments[parseInt(u.toString(),10)],r,!a);return n||this.updateEndPoint(c,p),this.diagram.realActions&Z.RealAction.AnimationClick||this.diagram.refreshCanvasLayers(),g},p.prototype.updatePathElementOffset=function(t){t.wrapper.children.splice(3,1);new P;var e=t.intermediatePoints,e=gd(e,t);t.wrapper.children.splice(3,0,e)},p.prototype.changeSegmentLength=function(t,e,i,n){var r,o,a,s,h,d=!e||this.canConnect(t,e);t.segments&&null!==t.segments[0].direction&&(!e&&""===t.sourceID||n)&&d?(n=t.segments[0],r=t.segments[1],o=this.diagram.nameTable[t.sourceID],a=void 0,n.points[0]=t.sourcePoint,"Top"===n.direction||"Bottom"===n.direction?(n.points[n.points.length-1].x=t.sourcePoint.x,r.points[0].y=n.points[n.points.length-1].y):(n.points[n.points.length-1].y=t.sourcePoint.y,r.points[0].x=n.points[n.points.length-1].x),n.direction&&(n.length||0===n.length)&&(n.length=K.distancePoints(n.points[0],n.points[n.points.length-1])),r.direction&&(r.length||0===r.length)&&(r.length=K.distancePoints(n.points[n.points.length-1],r.points[r.points.length-1]),r.direction=K.direction(n.points[n.points.length-1],r.points[r.points.length-1])),""!==t.sourcePortID&&n.length<10?2<t.segments.length?(h=t.segments[2],s=K.direction(h.points[0],h.points[1]),n.direction===Ui(s)?("Right"===n.direction?h.points[0].x=n.points[n.points.length-1].x=o.wrapper.corners.middleRight.x+20:"Left"===n.direction?h.points[0].x=n.points[n.points.length-1].x=o.wrapper.corners.middleLeft.x-20:"Top"===n.direction?h.points[0].y=n.points[n.points.length-1].y=o.wrapper.corners.topCenter.y-20:h.points[0].y=n.points[n.points.length-1].y=o.wrapper.corners.bottomCenter.y+20,h.direction&&h.length&&(h.length=K.distancePoints(h.points[0],h.points[h.points.length-1])),n.length=K.distancePoints(n.points[0],n.points[n.points.length-1])):n.direction===s&&h.direction&&h.length?("Top"===n.direction||"Bottom"===n.direction?(h.points[0]=n.points[0],h.points[h.points.length-1].x=h.points[0].x):(h.points[0]=n.points[0],h.points[h.points.length-1].y=h.points[0].y),h.length=K.distancePoints(h.points[0],h.points[h.points.length-1]),t.segments.splice(0,2)):n.length=20):n.length=20:n.length<1&&(""!==t.sourceID&&("Right"===r.direction?(a=o.wrapper.corners.middleRight,r.points[r.points.length-1].y=a.y):"Left"===r.direction?(a=o.wrapper.corners.middleLeft,r.points[r.points.length-1].y=a.y):(a="Top"===r.direction?o.wrapper.corners.topCenter:o.wrapper.corners.bottomCenter,r.points[r.points.length-1].x=a.x),r.length=K.distancePoints(a,r.points[r.points.length-1]),2<t.segments.length)&&(h=t.segments[2]).direction&&h.length&&(h.length=K.distancePoints(r.points[r.points.length-1],h.points[h.points.length-1])),t.segments.splice(0,1))):(e&&!i&&t.sourceID!==e.id&&t.segments&&null!==t.segments[0].direction&&e&&e instanceof _&&d&&this.changeSourceEndToNode(t,e),e&&i&&t.sourcePortID!==i&&t.segments&&null!==t.segments[0].direction&&e&&e instanceof _&&d&&this.changeSourceEndToPort(t,e,i))},p.prototype.canConnect=function(t,e){return!(!An(e)||!Dn(e))},p.prototype.changeSourceEndToPort=function(t,e,i){var n,r,o,i=this.diagram.getWrapper(e.wrapper,i),i={x:i.offsetX,y:i.offsetY},e=Vi(i,gp(e.wrapper),e.wrapper.bounds),a=t.segments[0],s=t.segments[1];a.direction!==e?(n=[],r={},a.direction===Ui(e)?(r={},o=void 0,r="Top"===e||"Bottom"===e?(o="Top"===e?{type:"Orthogonal",isTerminal:!0,direction:e,length:Math.abs(a.points[0].y-i.y)}:{type:"Orthogonal",isTerminal:!0,direction:e,length:Math.abs(i.y-a.points[0].y)},a.points[0].x>i.x?{type:"Orthogonal",isTerminal:!0,direction:"Right",length:a.points[0].x-i.x}:{type:"Orthogonal",isTerminal:!0,direction:"Left",length:i.x-a.points[0].x}):(o="Right"===e?{type:"Orthogonal",isTerminal:!0,direction:e,length:Math.abs(a.points[0].x-i.x)}:{type:"Orthogonal",isTerminal:!0,direction:e,length:Math.abs(i.x-a.points[0].x)},a.points[0].y>i.y?{type:"Orthogonal",direction:"Top",isTerminal:!0,length:a.points[0].y-i.y}:{type:"Orthogonal",direction:"Bottom",isTerminal:!0,length:i.y-a.points[0].y}),n.push(new Ua(t,"segments",o,!0)),n.push(new Ua(t,"segments",r,!0))):n.push(new Ua(t,"segments",r={type:"Orthogonal",direction:e,length:20,isTerminal:!0},!0)),a.direction!==Ui(e)&&("Top"===e||"Bottom"===e?(a.points[0].x=i.x,a.points[0].y=a.points[a.points.length-1].y="Top"===e?i.y-20:i.y+20):(a.points[0].y=i.y,a.points[0].x=a.points[a.points.length-1].x="Right"===e?i.x+20:i.x-20),a.length=K.distancePoints(a.points[0],a.points[a.points.length-1]),s.length=K.distancePoints(a.points[a.points.length-1],s.points[s.points.length-1])),t.segments=n.concat(t.segments)):(a.points[0]=i,"Top"===e||"Bottom"===e?a.points[a.points.length-1].x=i.x:a.points[a.points.length-1].y=i.y,a.length=K.distancePoints(a.points[0],a.points[a.points.length-1]),s.length=K.distancePoints(a.points[a.points.length-1],s.points[s.points.length-1]))},p.prototype.removeTerminalSegment=function(t,e){for(var i=0;i<t.segments.length-2;i++){var n=t.segments[0];n.isTerminal&&(e?n.isTerminal=!1:(t.segments.splice(i,1),i--))}},p.prototype.changeSourceEndToNode=function(t,e){this.removeTerminalSegment(t);var i,n,r,e=e.wrapper.children[0].corners,o=t.segments[0],a=t.segments[1],s=[];"Right"===o.direction||"Left"===o.direction?(i="Left"===o.direction?e.middleLeft:e.middleRight,o.length>e.width||"Left"===o.direction&&i.x>=o.points[0].x||"Right"===o.direction&&i.x<=o.points[0].x?(o.points[0].y=o.points[o.points.length-1].y=i.y,o.points[0].x=i.x,o.length=K.distancePoints(o.points[0],o.points[o.points.length-1]),a.length=K.distancePoints(o.points[o.points.length-1],a.points[a.points.length-1])):(r=void 0,n="Bottom"===(r=a.direction||K.direction(a.points[0],a.points[a.points.length-1]))?e.bottomCenter:e.topCenter,a.length&&a.direction&&(a.length="Top"===r?o.points[o.points.length-1].y-(n.y+20):n.y+20-o.points[o.points.length-1].y),o.length=o.points[o.points.length-1].x-n.x,o.direction=0<o.length?"Right":"Left",s.push(new Ua(t,"segments",{type:"Orthogonal",direction:r,length:20},!0)),t.segments=s.concat(t.segments))):(i="Bottom"===o.direction?e.bottomCenter:e.topCenter,o.length>e.height||"Top"===o.direction&&i.y>=o.points[0].y||"Bottom"===o.direction&&i.y<=o.points[0].y?(o.points[0].x=o.points[o.points.length-1].x=i.x,o.points[0].y=i.y,o.length=K.distancePoints(o.points[0],o.points[o.points.length-1]),a.length=K.distancePoints(o.points[o.points.length-1],a.points[a.points.length-1])):(n="Left"===a.direction?e.middleLeft:e.middleRight,r=void 0,r=a.direction||K.direction(a.points[0],a.points[a.points.length-1]),a.length&&a.direction&&(a.length="Left"===r?o.points[o.points.length-1].x-(n.x+20):n.x+20-o.points[o.points.length-1].x),o.length=o.points[o.points.length-1].y-n.y,o.direction=0<o.length?"Bottom":"Top",s.push(new Ua(t,"segments",{type:"Orthogonal",direction:r,length:20},!0)),t.segments=s.concat(t.segments)))},p.prototype.translateBezierPoints=function(t,e,i,n,r,o,a){var s,h,d,l,c=t.segments.indexOf(r),p=t.segments[parseInt(c.toString(),10)],g=0<c?t.segments[c-1]:null,g=null!==g?g.point:t.sourcePoint,c=c===t.segments.length-1?t.targetPoint:p.point;p&&("BezierSourceThumb"===e&&(p.vector1.angle||p.vector1.distance)?(s=p.vector1.distance,h=p.vector1.angle,p.vector1={distance:t.distance(g,o),angle:K.findAngle(g,o)},d=p.vector1.distance-s,l=p.vector1.angle-h,this.translateSubsequentSegment(t,r,!0,d,l)):"BezierTargetThumb"===e&&(p.vector2.angle||p.vector2.distance)?(s=p.vector2.distance,h=p.vector2.angle,p.vector2={distance:t.distance(c,o),angle:K.findAngle(c,o)},d=p.vector2.distance-s,l=p.vector2.angle-h,this.translateSubsequentSegment(t,r,!1,d,l)):("ConnectorSourceEnd"===e&&!t.sourceID||"ConnectorTargetEnd"===e&&!t.targetID)&&a&&Ja(p.vector1)&&Ja(p.vector2)?(K.isEmptyPoint(p.point1)&&(p.bezierPoint1=$a(t.sourcePoint,t.targetPoint)),K.isEmptyPoint(p.point2)&&(p.bezierPoint2=$a(t.targetPoint,t.sourcePoint))):"BezierSourceThumb"===e||"ConnectorSourceEnd"===e&&!a&&Ja(p.vector1)?(p.bezierPoint1.x+=i,p.bezierPoint1.y+=n,K.isEmptyPoint(p.point1)&&!a||(p.point1={x:p.bezierPoint1.x,y:p.bezierPoint1.y}),0===i&&0===n||!0!==r.isInternalSegment||(r.isInternalSegment=!1)):("BezierTargetThumb"===e||"ConnectorTargetEnd"===e&&!a&&Ja(p.vector2))&&(p.bezierPoint2.x+=i,p.bezierPoint2.y+=n,K.isEmptyPoint(p.point2)&&!a||(p.point2={x:p.bezierPoint2.x,y:p.bezierPoint2.y}),0===i&&0===n||!0!==r.isInternalSegment||(r.isInternalSegment=!1)))},p.prototype.translateSubsequentSegment=function(t,e,i,n,r){e=t.segments.indexOf(e);t.segments[parseInt(e.toString(),10)];t.bezierSettings.smoothness&Z.BezierSmoothness.SymmetricAngle||(r=null),null==(n=t.bezierSettings.smoothness&Z.BezierSmoothness.SymmetricDistance?n:null)&&null==r||(i?0!==e&&this.updatePreviousBezierSegment(t,e,n,r):e!==t.segments.length-1&&this.updateNextBezierSegment(t,e,n,r))},p.prototype.updatePreviousBezierSegment=function(t,e,i,n){t=t.segments[e-1],e=t.vector2.distance+i,i=(t.vector2.angle+n)%360;i<0&&(i+=360),t.vector2={distance:e,angle:i}},p.prototype.updateNextBezierSegment=function(t,e,i,n){t=t.segments[e+1],e=t.vector1.distance+i,i=(t.vector1.angle+n)%360;i<0&&(i+=360),t.vector1={distance:e,angle:i}},p.prototype.dragTargetEnd=function(t,e,i,n,r,o,a,s){var h,d,l=this.diagram.nameTable[t.id],c=this.checkBoundaryConstraints(e,i,l.wrapper.bounds);if(xn(l)&&"BezierTargetThumb"!==o&&c&&_n(this.diagram)&&(d=Q(d={targetPoint:l.targetPoint}),l.targetPoint.x+=e,l.targetPoint.y+=i,"ConnectorTargetEnd"===o&&"Orthogonal"===l.type&&l.segments&&0<l.segments.length&&(h=l.segments[l.segments.length-2])&&2===l.segments[l.segments.length-1].points.length&&("Left"===h.direction||"Right"===h.direction?h.points[h.points.length-1].x=l.targetPoint.x:h.points[h.points.length-1].y=l.targetPoint.y,h.length=K.distancePoints(h.points[0],h.points[h.points.length-1]),h.direction=K.direction(h.points[0],h.points[h.points.length-1])),"Bpmn"===l.shape.type)&&"Default"===l.shape.sequence&&"Sequence"===l.shape.flow&&this.updatePathElementOffset(l),"Bezier"===l.type)if(d={targetPoint:l.targetPoint},s)this.translateBezierPoints(t,""===o?"ConnectorTargetEnd":o,e,i,s,r,!a);else for(var p=0;p<t.segments.length;p++)this.translateBezierPoints(t,""===o?"ConnectorTargetEnd":o,e,i,t.segments[parseInt(p.toString(),10)],r,!a);return n||this.updateEndPoint(l,d),this.diagram.realActions&Z.RealAction.AnimationClick||this.diagram.refreshCanvasLayers(),c},p.prototype.dragControlPoint=function(t,e,i,n,r){var o,a=this.diagram.nameTable[t.id];if(("Straight"===a.type||"Bezier"===a.type)&&0<a.segments.length){if(void 0!==r&&a.segments[parseInt(r.toString(),10)])"Bezier"===a.type?((o=(t=a.segments[parseInt(r.toString(),10)]).isInternalSegment)&&null!==a.bezierSettings&&"FreeForm"!==a.bezierSettings.segmentEditOrientation?("Horizontal"===t.orientation?t.point.x+=e:t.point.y+=i,this.updateDirectionalBezierCurve(a)):(t.point.x+=e,t.point.y+=i),o&&(a.isBezierEditing=!0)):(a.segments[parseInt(r.toString(),10)].point.x+=e,a.segments[parseInt(r.toString(),10)].point.y+=i);else for(var s=0;s<a.segments.length-1;s++)a.segments[parseInt(s.toString(),10)].point.x+=e,a.segments[parseInt(s.toString(),10)].point.y+=i;n||this.updateEndPoint(a)}return!0},p.prototype.updateDirectionalBezierCurve=function(t){var e=[];e.push(t.sourcePoint);for(var i=0;i<t.segments.length-1;i++){var n=t.segments[parseInt(i.toString(),10)];"Horizontal"===n.orientation?e.push({x:n.point.x,y:e[e.length-1].y}):e.push({x:e[e.length-1].x,y:n.point.y}),i===t.segments.length-2&&("Horizontal"===n.orientation?e.push({x:n.point.x,y:t.targetPoint.y}):e.push({x:t.targetPoint.x,y:n.point.y}))}e.push(t.targetPoint);var r,o,a,s,h,d,l=e[0],c=e[e.length-1];1<t.segments.length&&(a={x:.5*((o=e[1]).x+(r=e[2]).x),y:.5*(o.y+r.y)},(s=t.segments[0]).vector1.angle=M(l,o),s.vector1.distance=.5*K.findLength(l,o),s.vector2.angle=M(a,o),s.vector2.distance=.5*K.findLength(a,o),s.point=a,(l=t.segments[1]).vector1.angle=M(a,r),l.vector1.distance=.5*K.findLength(a,r),2<t.segments.length?(s={x:.5*(r.x+(o=e[3]).x),y:.5*(r.y+o.y)},l.vector2.angle=M(s,r),l.vector2.distance=.5*K.findLength(s,r),l.point=s,(a=t.segments[2]).vector1.angle=M(s,o),a.vector1.distance=.5*K.findLength(s,o),3<t.segments.length?(h={x:.5*(o.x+(s=e[4]).x),y:.5*(o.y+s.y)},a.vector2.angle=M(h,o),a.vector2.distance=.5*K.findLength(h,o),a.point=h,(d=t.segments[3]).vector1.angle=M(h,s),d.vector1.distance=.5*K.findLength(h,s),d.vector2.angle=M(c,s),d.vector2.distance=.5*K.findLength(c,s)):(a.vector2.angle=M(c,o),a.vector2.distance=.5*K.findLength(c,o))):(l.vector2.angle=M(c,r),l.vector2.distance=.5*K.findLength(c,r)))},p.prototype.rotateObjects=function(t,e,i,n,r){n=n||{};var o=rt();at(o,i,n.x,n.y);for(var a=0,s=e;a<s.length;a++){var h,d,l=s[a];l instanceof _?Cn(l)&&_n(this.diagram)&&(!1===r&&t===l||(d={offsetX:l.wrapper.offsetX,offsetY:l.wrapper.offsetY,rotateAngle:l.rotateAngle},l.rotateAngle=(l.rotateAngle+i+360)%360,h=z(o,{x:l.wrapper.offsetX,y:l.wrapper.offsetY}),l.offsetX=h.x,l.offsetY=h.y,this.diagram.nodePropertyChange(l,d,{offsetX:l.offsetX,offsetY:l.offsetY,rotateAngle:l.rotateAngle})),l.processId&&(h=this.diagram.nameTable[l.processId],d=this.diagram.bpmnModule.getChildrenBound(h,l.id,this.diagram),this.diagram.bpmnModule.updateSubProcessess(d,l,this.diagram)),l.children)&&l.children.length&&!l.container&&this.getChildren(l,e):this.rotatePoints(l,i,n||{x:l.wrapper.offsetX,y:l.wrapper.offsetY}),this.diagram.updateDiagramObject(l)}this.diagram.refreshCanvasLayers(),this.diagram.updateSelector()},p.prototype.snapConnectorEnd=function(t){return this.diagram.snapSettings.constraints&Z.SnapConstraints.SnapToLines&&this.snappingModule&&this.diagram.snappingModule.snapConnectorEnd(t),t},p.prototype.snapAngle=function(t){return this.diagram.snapSettings.constraints&Z.SnapConstraints.SnapToLines&&this.snappingModule?this.snappingModule.snapAngle(this.diagram,t):0},p.prototype.rotatePoints=function(t,e,i){var n;t.sourceWrapper&&t.targetWrapper||(at(n=rt(),e,i.x,i.y),t.sourcePoint=z(n,t.sourcePoint),t.targetPoint=z(n,t.targetPoint),"Bpmn"===t.shape.type&&"Default"===t.shape.sequence&&"Sequence"===t.shape.flow&&this.updatePathElementOffset(t),e={sourcePoint:t.sourcePoint,targetPoint:t.targetPoint},this.diagram.connectorPropertyChange(t,{},e),t.segments&&0<t.segments.length&&(this.diagram.protectPropertyChange(!0),(i=t).segments=[],this.diagram.connectorPropertyChange(i,{},{segments:i.segments}),this.diagram.protectPropertyChange(!1)))},p.prototype.updateInnerParentProperties=function(t){for(var e=this.diagram.isProtectedOnChange,i=(this.diagram.protectPropertyChange(!0),this.getAllDescendants(t,[],!1,!0)),n=0;n<i.length;n++){var r=this.diagram.nameTable[i[parseInt(n.toString(),10)].id];r.offsetX=r.wrapper.offsetX,r.offsetY=r.wrapper.offsetY,r.width=r.wrapper.width,r.height=r.wrapper.height}this.diagram.protectPropertyChange(e)},p.prototype.scale=function(t,e,i,n,r,o){var a=this.diagram.nameTable[t.id],s=a,h=a.wrapper,d=(r=r||t).wrapper,l=ad(d.offsetX-d.actualSize.width*d.pivot.x,d.offsetY-d.actualSize.height*d.pivot.y,d.actualSize.width,d.actualSize.height,d.rotateAngle,d.offsetX,d.offsetY,n);if(void 0!==h.actualSize.width&&void 0!==h.actualSize.height&&_n(this.diagram)){if(s.children&&!s.container){for(var c=0,p=this.getAllDescendants(s,[]);c<p.length;c++){var g=p[c];this.scaleObject(e,i,l,g,h,r)}t.wrapper.measure(new j),t.wrapper.arrange(t.wrapper.desiredSize),this.diagram.updateGroupOffset(a),this.updateInnerParentProperties(s)}else this.scaleObject(e,i,l,a,h,r);d=up(t.wrapper);if(!this.checkBoundaryConstraints(void 0,void 0,d)&&o)return this.scale(t,1/e,1/i,n,void 0,!0),!1;this.diagram.updateDiagramObject(t)}return!0},p.prototype.getAllDescendants=function(t,e,i,n){for(var r=t,o=[],a=0;a<r.children.length;a++)(t=this.diagram.nameTable[r.children[parseInt(a.toString(),10)]])&&(t.children?(i&&e.push(t),n&&o.push(t),e=this.getAllDescendants(t,e)):e.push(t));return n?o:e},p.prototype.getChildren=function(t,e){var i=t;if(t.children&&t.children.length)for(var n=0;n<i.children.length;n++)(t=this.diagram.nameTable[i.children[parseInt(n.toString(),10)]])&&e.push(t);return e},p.prototype.cloneChild=function(t){return this.diagram.nameTable[""+t]},p.prototype.scaleObject=function(t,e,i,n,r,o,a){e=e<0?1:e;var s,h,d,l,c,p,g,u,m,f,y={};(1!==(t=t<0?1:t)||1!==e)&&(m=u=void 0,n instanceof _&&(f=g=void 0,y={width:(h=n).wrapper.actualSize.width,height:n.wrapper.actualSize.height,offsetX:n.wrapper.offsetX,offsetY:n.wrapper.offsetY,margin:{top:h.margin.top,left:h.margin.left}},"Bpmn"===h.shape.type&&h.shape.activity.subProcess.processes&&0<h.shape.activity.subProcess.processes.length&&(f=this.diagram.bpmnModule.getChildrenBound(h,h.id,this.diagram),g=h.wrapper.bounds.containsRect(f)),u=h.wrapper.actualSize.width*t,m=h.wrapper.actualSize.height*e,s=(h.constraints&Z.NodeConstraints.AspectRatio)===Z.NodeConstraints.AspectRatio,d=void 0!==h.minWidth&&0!==h.minWidth,p=void 0!==h.maxWidth&&0!==h.maxWidth,l=void 0!==h.minHeight&&0!==h.minHeight,c=void 0!==h.maxHeight&&0!==h.maxHeight,s?(s=h.wrapper.actualSize,d&&l?m/h.minHeight<u/h.minWidth?m<h.minHeight&&(m=h.minHeight,u=h.minHeight*(s.width/s.height)):u<h.minWidth&&(u=h.minWidth,m=h.minWidth*(s.height/s.width)):d?u<h.minWidth&&(u=h.minWidth,m=h.minWidth*(s.height/s.width)):l&&m<h.minHeight&&(m=h.minHeight,u=h.minHeight*(s.width/s.height)),p&&c?m/h.maxHeight>u/h.maxWidth?m>h.maxHeight&&(m=h.maxHeight,u=h.maxHeight*(s.width/s.height)):u>h.maxWidth&&(u=h.maxWidth,m=h.maxWidth*(s.height/s.width)):p?u>h.maxWidth&&(u=h.maxWidth,m=h.maxWidth*(s.height/s.width)):c&&m>h.maxHeight&&(m=h.maxHeight,u=h.maxHeight*(s.width/s.height))):(p&&(u=Math.min(h.maxWidth,u)),d&&(u=Math.max(h.minWidth,u)),l&&(m=Math.max(h.minHeight,m)),c&&(m=Math.min(h.maxHeight,m))),g&&(u=Math.max(u,f.right-h.wrapper.bounds.x),m=Math.max(m,f.bottom-h.wrapper.bounds.y)),t=u/h.actualSize.width,e=m/h.actualSize.height),at(s=rt(),-(p=(o=o||n).wrapper).rotateAngle,i.x,i.y),st(s,t,e,i.x,i.y),at(s,p.rotateAngle,i.x,i.y),n instanceof _?(d=z(s,{x:(h=n).wrapper.offsetX,y:h.wrapper.offsetY}),l=h.wrapper.offsetX-h.wrapper.actualSize.width*h.pivot.x,c=h.wrapper.offsetY-h.wrapper.actualSize.height*h.pivot.y,0<u&&(h.processId&&(g=this.diagram.nameTable[h.processId]).maxWidth&&!(h.margin.left+u<g.maxWidth)||(h.width=u,h.offsetX=d.x)),0<m&&(h.processId&&(o=this.diagram.nameTable[h.processId]).maxHeight&&!(h.margin.top+m<o.maxHeight)||(h.height=m,h.offsetY=d.y)),p=h.wrapper.offsetX-h.wrapper.actualSize.width*h.pivot.x,g=h.wrapper.offsetY-h.wrapper.actualSize.height*h.pivot.y,(u=this.diagram.nameTable[h.processId])&&(p=h.offsetX-h.width*h.pivot.x,g=h.offsetY-h.height*h.pivot.y),u&&(h.margin.top+(g-c)<=0||h.margin.left+(p-l)<=0)?"Drag"!==this.diagram.eventHandler.currentAction?this.diagram.nodePropertyChange(n,{},{margin:{top:h.margin.top,left:h.margin.left}}):this.diagram.nodePropertyChange(n,{},{width:h.width,height:h.height,margin:{top:h.margin.top,left:h.margin.left}}):Ur(this.diagram,n,!0)?Gr(this.diagram,n):a||this.diagram.nodePropertyChange(n,y,{width:h.width,height:h.height,offsetX:h.offsetX,offsetY:h.offsetY,margin:{top:h.margin.top+(g-c),left:h.margin.left+(p-l)}})):(o={sourcePoint:n.sourcePoint,targetPoint:n.targetPoint},n.sourceWrapper&&n.targetWrapper||this.scaleConnector(n,s,o,t,e,i)),m=this.diagram.nameTable[n.processId])&&(m.wrapper.bounds,n.wrapper.bounds,f=this.diagram.bpmnModule.getChildrenBound(m,n.id,this.diagram),this.diagram.bpmnModule.updateSubProcessess(f,n,this.diagram))},p.prototype.scaleConnector=function(t,e,i,n,r,o){t.sourcePoint=z(e,t.sourcePoint),t.targetPoint=z(e,t.targetPoint),"Bpmn"===t.shape.type&&"Default"===t.shape.sequence&&"Sequence"===t.shape.flow&&this.updatePathElementOffset(t);var a,e={sourcePoint:t.sourcePoint,targetPoint:t.targetPoint},i=(this.diagram.connectorPropertyChange(t,i,e),this.diagram.selectedItems);Cd(this.diagram,i)&&(a={offsetX:(e=Q(this.diagram.selectedItems)).offsetX,offsetY:e.offsetY,height:e.height,width:e.width,rotateAngle:e.rotateAngle},(a=new _(this.diagram,"nodes",a,!0)).wrapper=e.wrapper,a.wrapper.rotateAngle=i.rotateAngle,this.scaleObject(n,r,o,a,a.wrapper,a,!0),i.wrapper.actualSize.width=a.width,i.wrapper.actualSize.height=a.height,i.wrapper.offsetX=a.offsetX,i.wrapper.offsetY=a.offsetY,this.diagram.selectedItems.connectors[0].id!==t.id)&&this.measureSelector(i)},p.prototype.measureSelector=function(t){for(var e=void 0,i=[],i=Q(this.diagram.selectedItems).connectors,n={x:this.diagram.selectedItems.offsetX,y:this.diagram.selectedItems.offsetY},r=0;r<i.length;r++){var o=rt(),o=(at(o,-t.rotateAngle,n.x,n.y),i[parseInt(r.toString(),10)].sourcePoint=z(o,i[parseInt(r.toString(),10)].sourcePoint),i[parseInt(r.toString(),10)].targetPoint=z(o,i[parseInt(r.toString(),10)].targetPoint),{x:i[parseInt(r.toString(),10)].sourcePoint.x,y:i[parseInt(r.toString(),10)].sourcePoint.y}),a={x:i[parseInt(r.toString(),10)].targetPoint.x,y:i[parseInt(r.toString(),10)].targetPoint.y},o=this.calculateBounds(o,a);void 0===e?e=o:e.uniteRect(o)}var s={},s={offsetX:(s=void 0!==e?{x:e.x+e.width*t.wrapper.pivot.x,y:e.y+e.height*t.wrapper.pivot.y}:s).x,offsetY:s.y,height:e.height,width:e.width,rotateAngle:0},s=new _(this.diagram,"nodes",s,!0),h=rt(),h=(at(h,t.rotateAngle,n.x,n.y),s.rotateAngle+=t.rotateAngle,s.rotateAngle=(s.rotateAngle+360)%360,z(h,{x:s.offsetX,y:s.offsetY})),h=(s.offsetX=h.x,s.offsetY=h.y,t.wrapper.actualSize.width=e.width,t.wrapper.actualSize.height=e.height,t.wrapper.offsetX=s.offsetX,t.wrapper.offsetY=s.offsetY,Fc(this.diagram.element.id));this.diagram.diagramRenderer.renderResizeHandle(t.wrapper,h,t.thumbsConstraints,this.diagram.scroller.currentZoom,t.constraints,this.diagram.scroller.transform,!1,bn(t),null,null,t.handleSize)},p.prototype.calculateBounds=function(t,e){var i=Math.min(t.x,e.x),n=Math.max(t.x,e.x),r=Math.min(t.y,e.y),t=Math.max(t.y,e.y);return new k(i,r,n-i,t-r)},p.prototype.portDrag=function(t,e,i,n){var r,o,e=this.findTarget(e,t),a=up(t.wrapper);e&&Xn(e,this.diagram)&&(t instanceof _?(r=this.getPortChanges(t,e),e.offset.x+=i/a.width,e.offset.y+=n/a.height,o=this.getPortChanges(t,e),this.diagram.nodePropertyChange(t,r,o)):(r=this.getConnectorPortChanges(t,e),this.updatePortOffset(t,e,i,n),e.alignment="Center",o=this.getConnectorPortChanges(t,e),this.diagram.connectorPropertyChange(t,r,o)),this.diagram.updateDiagramObject(t))},p.prototype.labelDrag=function(t,e,i,n){var r=this.findTarget(e,t),o=gp(t.wrapper),a=this.getAnnotationChanges(t,r),s=this.getSelectedObject(),o=(r instanceof Ze?(r.offset.x+=i/o.width,r.offset.y+=n/o.height):(this.updatePathAnnotationOffset(t,r,i,n),r instanceof Qe&&(r.alignment="Center")),this.getAnnotationChanges(t,r));t instanceof _?this.diagram.nodePropertyChange(t,a,o):this.diagram.connectorPropertyChange(t,a,o),this.diagram.updateDiagramObject(t),so(this.diagram,r,!1,e)||this.labelSelect(t,e,s);for(var h=0,d=this.diagram.views;h<d.length;h++){var l=d[h],l=this.diagram.views[l];l instanceof ru||this.diagram.refreshCanvasDiagramLayer(l)}},p.prototype.updatePathAnnotationOffset=function(t,e,i,n,r,o){var a,s,h,d=this.diagram.getWrapper(t.wrapper,e.id),l=d.offsetX,c=d.offsetY,p=t.intermediatePoints,g=0;switch(e.verticalAlignment){case"Center":"Center"===e.horizontalAlignment?h=r||{x:l+i,y:c+n}:"Right"===e.horizontalAlignment?h=r||{x:l+d.actualSize.width/2+i,y:c+n}:"Left"===e.horizontalAlignment&&(h=r||{x:l-d.actualSize.width/2+i,y:c+n});break;case"Top":"Center"===e.horizontalAlignment?h=r||{x:l+i,y:c-d.actualSize.height/2+n}:"Right"===e.horizontalAlignment?h=r||{x:l+d.actualSize.width/2+i,y:c-d.actualSize.height/2+n}:"Left"===e.horizontalAlignment&&(h=r||{x:l-d.actualSize.width/2+i,y:c-d.actualSize.height/2+n});break;case"Bottom":"Center"===e.horizontalAlignment?h=r||{x:l+i,y:c+d.actualSize.height/2+n}:"Right"===e.horizontalAlignment?h=r||{x:l+d.actualSize.width/2+i,y:c+d.actualSize.height/2+n}:"Left"===e.horizontalAlignment&&(h=r||{x:l-d.actualSize.width/2+i,y:c+d.actualSize.height/2+n})}var u,m,f,y=this.getInterceptWithSegment(h,p),v=p[p.length-1],b=K.getLengthFromListOfPoints(p);if(0<y.length){if(e.dragLimit=e.dragLimit||{},v=e.dragLimit.top||e.dragLimit.bottom||e.dragLimit.left||e.dragLimit.right?(v=this.getRelativeOffset(h,p,u={minDistance:null}),f=this.getRelativeOffset(h,y,m={minDistance:null}),null!=u&&m.minDistance<u.minDistance?f:xh(t.intermediatePoints,e).point):f=y[y.length-1]){for(var S=void 0,S=0;S<p.length;S++){if(null!=s){if(k.toBounds([s,p[parseInt(S.toString(),10)]]).containsPoint(v)){g+=K.findLength(s,v);break}g+=K.findLength(s,p[parseInt(S.toString(),10)])}s=p[parseInt(S.toString(),10)]}a={x:g/b,y:0}}this.updateLabelMargin(t,e,a,h,o,i,n)}else this.updateLabelMargin(t,e,null,h,o,i,n)},p.prototype.updatePortOffset=function(t,e,i,n,r,o){var a,s,h,d=this.diagram.getWrapper(t.wrapper,e.id),l=d.offsetX,c=d.offsetY,p=t.intermediatePoints,g=0;switch(e.verticalAlignment){case"Center":"Center"===e.horizontalAlignment?h=r||{x:l+i,y:c+n}:"Right"===e.horizontalAlignment?h=r||{x:l+d.actualSize.width/2+i,y:c+n}:"Left"===e.horizontalAlignment&&(h=r||{x:l-d.actualSize.width/2+i,y:c+n});break;case"Top":"Center"===e.horizontalAlignment?h=r||{x:l+i,y:c-d.actualSize.height/2+n}:"Right"===e.horizontalAlignment?h=r||{x:l+d.actualSize.width/2+i,y:c-d.actualSize.height/2+n}:"Left"===e.horizontalAlignment&&(h=r||{x:l-d.actualSize.width/2+i,y:c-d.actualSize.height/2+n});break;case"Bottom":"Center"===e.horizontalAlignment?h=r||{x:l+i,y:c+d.actualSize.height/2+n}:"Right"===e.horizontalAlignment?h=r||{x:l+d.actualSize.width/2+i,y:c+d.actualSize.height/2+n}:"Left"===e.horizontalAlignment&&(h=r||{x:l-d.actualSize.width/2+i,y:c+d.actualSize.height/2+n})}var u=this.getInterceptWithSegment(h,p),m=p[p.length-1],f=K.getLengthFromListOfPoints(p);if(0<u.length){if(m=u[u.length-1]){for(var y=void 0,y=0;y<p.length;y++){if(null!=s){if(k.toBounds([s,p[parseInt(y.toString(),10)]]).containsPoint(m)){g+=K.findLength(s,m);break}g+=K.findLength(s,p[parseInt(y.toString(),10)])}s=p[parseInt(y.toString(),10)]}a={x:g/f,y:0}}this.updateLabelMargin(t,e,a,h,o,i,n)}else this.updateLabelMargin(t,e,null,h,o,i,n)},p.prototype.getRelativeOffset=function(t,e,i){for(var n,r,o,a=0;a<e.length;a++)o=e[parseInt(a.toString(),10)],r=Math.round(Math.sqrt(Math.pow(t.x-o.x,2)+Math.pow(t.y-o.y,2))),null!==i.minDistance&&Math.min(Math.abs(i.minDistance),Math.abs(r))!==Math.abs(r)||(n=o,i.minDistance=r);return n},p.prototype.dragLimitValue=function(t,e,i,n){var r=!1,o=!1;return{x:r=i.x>=e.x-t.dragLimit.left-n.width/2&&i.x<=e.x+t.dragLimit.right+n.width/2?!0:r,y:o=i.y>=e.y-t.dragLimit.top-n.height/2&&i.y<=e.y+t.dragLimit.bottom+n.height/2?!0:o}},p.prototype.updateLabelMargin=function(t,e,i,n,r,o,a){if(i=i||{x:e.offset,y:0},e&&i&&0<i.x&&i.x<1){var s=K.getLengthFromListOfPoints(t.intermediatePoints),s=this.getPointAtLength(s*i.x,t.intermediatePoints,0),h=this.diagram.scrollSettings.currentZoom,d=e.dragLimit||{left:0,right:0,top:0,bottom:0};if(d.top||d.bottom||d.left||d.right){this.diagram.getWrapper(t.wrapper,e.id);var l=new k(0,0,0,0),t=this.diagram.getWrapper(t.wrapper,e.id),o=(l.x=t.offsetX/h+o,l.y=t.offsetY/h+a,l.width=t.bounds.width/h,l.height=t.bounds.height/h,new k(s.x-(d.left||0)-l.width/2,s.y-(d.top||0)-l.height/2,(d.left||0)+(d.right||0)+l.width,(d.top||0)+(d.bottom||0)+l.height));if(!o.containsPoint(n))for(var c=0,p=this.boundsInterSects([s,n],o,!1);c<p.length;c++)n=p[c];a=this.dragLimitValue(e,s,n,l);e.margin={left:a.x?n.x-s.x:e.margin.left,top:a.y?n.y-s.y:e.margin.top,right:0,bottom:0}}else e.margin={left:n.x-s.x,top:n.y-s.y,right:0,bottom:0};e.offset=i.x,r&&(e.width=r.width,e.height=r.height)}},p.prototype.boundsInterSects=function(t,e,i){var n;return e&&(e=[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height},{x:e.x,y:e.y}],n=this.intersect(t,e,i)),n},p.prototype.intersect=function(t,e,i){for(var n=[],r=0;r<t.length-1;r++)for(var o=0;o<e.length-1;o++){var a=ch(t[r],t[r+1],e[o],e[o+1]);0!==a.x&&0!==a.y&&n.push(a)}return n},p.prototype.getPointAtLength=function(t,e,i){for(var n,r,o=0,a={x:0,y:0},s=0;s<e.length;s++){if(r=e[s],n){var h,d,l,c=K.findLength(n,r);if(t<=o+c){l=t-o,h=K.findAngle(n,r),d=l*Math.cos(h*Math.PI/180),l=l*Math.sin(h*Math.PI/180),a={x:n.x+d,y:n.y+l};break}o+=c}n=r}return a},p.prototype.getInterceptWithSegment=function(t,e){for(var i=[],n=[],r=K.findLength({x:0,y:0},{x:this.diagram.scroller.viewPortWidth,y:this.diagram.scroller.viewPortHeight}),o=1;o<e.length;o++){var a=[e[o-1],e[o]],n=[],s=Math.round(K.findAngle(a[0],a[1])%360),h=Math.round(K.findAngle(a[1],a[0])%360),d=0<s&&s<=90||180<s&&s<=270?90:-90;n.push(K.transform(t,s+d,r)),n.push(K.transform(t,h+d,r));s=lh({x1:a[0].x,y1:a[0].y,x2:a[1].x,y2:a[1].y},{x1:n[0].x,y1:n[0].y,x2:n[1].x,y2:n[1].y});s.enabled&&i.push(s.intersectPt)}return i},p.prototype.getAnnotationChanges=function(t,e){var i={};return i[Jh(t,e.id,!0)]={width:e.width,height:e.height,offset:t instanceof _?{x:e.offset.x,y:e.offset.y}:e.offset,rotateAngle:e.rotateAngle,margin:{left:e.margin.left,right:e.margin.right,top:e.margin.top,bottom:e.margin.bottom},horizontalAlignment:e.horizontalAlignment,verticalAlignment:e.verticalAlignment,alignment:t instanceof W?e.alignment:void 0},{annotations:i}},p.prototype.getConnectorPortChanges=function(t,e){var i={};return i[$h(t,e.id)]={width:e.width,height:e.height,offset:e.offset,margin:{left:e.margin.left,right:e.margin.right,top:e.margin.top,bottom:e.margin.bottom},horizontalAlignment:e.horizontalAlignment,verticalAlignment:e.verticalAlignment,alignment:t instanceof W?e.alignment:void 0},{ports:i}},p.prototype.getPortChanges=function(t,e){var i={};return i[Jh(t,e.id,!1)]={offset:e.offset},{ports:i}},p.prototype.labelRotate=function(t,e,i,n){var r=this.getAnnotationChanges(t,e),o=(rt(),e.rotateAngle,this.diagram.getWrapper(t.wrapper,e.id)),i=M({x:o.offsetX,y:o.offsetY},i)+90,a=this.snapAngle(i),i=0!==a?a:i;e instanceof Qe&&e.segmentAngle&&(i-=vh(t.intermediatePoints,e,t.wrapper.bounds).angle),e.rotateAngle+=(i=(i+360)%360)-(e.rotateAngle+o.parentTransform),e instanceof Qe&&(e.alignment="Center"),n.wrapper.rotateAngle=n.rotateAngle=e.rotateAngle,a=this.getAnnotationChanges(t,e),t instanceof _?this.diagram.nodePropertyChange(t,r,a):this.diagram.connectorPropertyChange(t,r,a),this.diagram.updateDiagramObject(t);for(var s=0,h=this.diagram.views;s<h.length;s++){var d=h[s],d=this.diagram.views[d];d instanceof ru||this.diagram.refreshCanvasDiagramLayer(d)}},p.prototype.labelResize=function(t,e,i,n,r,o){var a,s,h,d=this.getAnnotationChanges(t,e),o=o.wrapper.children[0];(i&&1!==i||n&&1!==n)&&(h=rt(),a=rt(),at(h,-t.rotateAngle,t.offsetX,t.offsetY),at(a,-(s=(o.rotateAngle+(t instanceof _?t.rotateAngle:0)+360)%360),r.x,r.y),st(a,i,n,r.x,r.y),at(a,s,r.x,r.y),s=z(a,{x:o.offsetX,y:o.offsetY}),r=o.actualSize.height*n,a=o.actualSize.width*i,(n=this.findTarget(o,t))instanceof Qe&&(s.y+="Top"===n.verticalAlignment?-r/2:"Bottom"===n.verticalAlignment?r/2:0,s.x+="Left"===n.horizontalAlignment?-a/2:"Right"===n.horizontalAlignment?a/2:0),n instanceof Qe?this.updatePathAnnotationOffset(t,e,0,0,s,new j(a,r)):(i=gp(t.wrapper),(s=z(h,s)).x=s.x-o.margin.left+o.margin.right,s.y=s.y-o.margin.top+o.margin.bottom,s.y+="Top"===n.verticalAlignment?-r/2:"Bottom"===n.verticalAlignment?r/2:0,s.x+="Left"===n.horizontalAlignment?-a/2:"Right"===n.horizontalAlignment?a/2:0,h=i.width/(s.x-i.x),o=i.height/(s.y-i.y),1<a&&(n.width=a,n.offset.x=1/h),1<r&&(n.height=r,n.offset.y=1/o))),e instanceof Qe&&(e.alignment="Center"),s=this.getAnnotationChanges(t,e),t instanceof _?this.diagram.nodePropertyChange(t,d,s):this.diagram.connectorPropertyChange(t,d,s),this.diagram.updateDiagramObject(t);for(var l=0,c=this.diagram.views;l<c.length;l++){var p=c[l],p=this.diagram.views[p];p instanceof ru||this.diagram.refreshCanvasDiagramLayer(p)}},p.prototype.getSubProcess=function(t){var e,i={nodes:[],connectors:[]};return t instanceof _?e=t.processId:t&&t.nodes&&t.nodes.length&&t.nodes[0].processId&&(e=t.nodes[0].processId),e&&i.nodes.push(Q(this.diagram.nameTable[e])),i},p.prototype.checkBoundaryConstraints=function(t,e,i,n){var r,o,a=this.diagram.pageSettings,s=this.diagram.pageSettings.boundaryConstraints,h=this.diagram.scroller;return"Page"!==s&&"Diagram"!==s||(r=i?void 0:this.diagram.selectedItems.wrapper.bounds,o="Page"===s?a.width:h.viewPortWidth,s="Page"===s?a.height:h.viewPortHeight,a=(i?i:r).right+(t||0),h=(i?i:r).left+(t||0),t=(i?i:r).top+(e||0),i=(i?i:r).bottom+(e||0),!!(a<=o&&0<=h&&i<=s&&0<=t||"None"!==this.diagram.layout.type&&n))},p.prototype.dragSelectedObjects=function(t,e){var i=this,n=this.diagram.selectedItems,r=(this.state&&!this.state.backup&&(this.state.backup={},this.state.backup.offsetX=n.offsetX,this.state.backup.offsetY=n.offsetY),n=Fr(this.diagram,n)||n,this.diagram.selectedItems.nodes.filter(function(t){return"SwimLane"===t.shape.type})),o=[];if(0<r.length&&!this.diagram.currentSymbol&&1<this.diagram.selectedItems.nodes.length+this.diagram.selectedItems.connectors.length){var a=this.diagram.selectedItems.nodes.filter(function(t){return""===t.parentId||"SwimLane"!==i.diagram.nameTable[t.parentId].shape.type});if(0<a.length){for(var s=0;s<a.length;s++)(this.diagram.nameTable[a[parseInt(s.toString(),10)].parentId]&&this.diagram.nameTable[a[parseInt(s.toString(),10)].parentId].isLane||"SwimLane"===a[parseInt(s.toString(),10)].shape.type)&&(a.splice(s,1),s--);for(var h=r.filter(function(e,t,i){return t===i.findIndex(function(t){return t.id===e.id})}),s=0;s<h.length;s++)o=o.concat(cr(this.diagram,h[s].wrapper.children[0]));(0<a.length||1<h.length||0<this.diagram.selectedItems.connectors.length)&&(a=a.concat(h),this.diagram.selectedItems.nodes.splice(0,this.diagram.selectedItems.nodes.length),a.forEach(function(t){i.diagram.selectedItems.nodes.push(t)}),n=this.diagram.selectedItems,this.diagram.selectedObject.helperObject=void 0)}}return!!this.checkBoundaryConstraints(t,e)&&(this.diagram.diagramActions=this.diagram.diagramActions|(Z.DiagramAction.PreventZIndexOnDragging|Z.DiagramAction.DragUsingMouse),!((r=this.diagram.selectedObject.actualObject)&&r instanceof _&&r.isLane&&Wr(r,this.diagram))&&r&&r.isLane||(this.diagram.drag(n,t,e),vr(o,this.diagram)),this.diagram.diagramActions=this.diagram.diagramActions&~(Z.DiagramAction.PreventZIndexOnDragging|Z.DiagramAction.DragUsingMouse),this.diagram.refreshCanvasLayers(),this.checkHtmlObjectDrag(n),!0)},p.prototype.checkHtmlObjectDrag=function(t){var e=!1;this.diagram.views&&1<this.diagram.views.length&&(t instanceof B?e=t.nodes.some(function(t){return t.shape&&"HTML"===t.shape.type}):t.shape&&"HTML"===t.shape.type&&(e=!0),e)&&this.resetOverviewCanvas()},p.prototype.resetOverviewCanvas=function(){for(var t=0,e=this.diagram.views;t<e.length;t++){var i,n,r,o,a=e[t],a=this.diagram.views[a];a instanceof ru||(a=document.getElementById(a.canvas.id+"overviewrect"),i=Number(a.getAttribute("x")),n=Number(a.getAttribute("y")),r=Number(a.getAttribute("width")),o=Number(a.getAttribute("height")),hp(a,{x:i,y:n,width:Math.max(1,r),height:Math.max(1,o)}))}},p.prototype.scaleSelectedItems=function(t,e,i){var n=this.diagram.selectedItems;return this.state&&!this.state.backup&&(this.state.backup={},this.state.backup.offsetX=n.offsetX,this.state.backup.offsetY=n.offsetY,this.state.backup.width=n.width,this.state.backup.height=n.height,this.state.backup.pivot=i),n=Fr(this.diagram,n)||n,this.diagram.scale(n,t,e,i)},p.prototype.rotateSelectedItems=function(t){var e=this.diagram.selectedItems;return this.state&&!this.state.backup&&(this.state.backup={},this.state.backup.angle=e.rotateAngle),e=Fr(this.diagram,e)||e,this.diagram.rotate(e,t,void 0,!0)},p.prototype.hasSelection=function(){return oo(this.diagram)},p.prototype.isSelected=function(t){return so(this.diagram,t)},p.prototype.initExpand=function(t){var e=this.diagram.isProtectedOnChange,t=(this.diagram.protectPropertyChange(!0),t.target||t.source),i={isExpanded:t.isExpanded};t.isExpanded=!t.isExpanded,this.diagram.preventNodesUpdate=!0,this.diagram.diagramActions|=Z.DiagramAction.PreventIconsUpdate,this.diagram.nodePropertyChange(t,i,{isExpanded:t.isExpanded}),this.diagram.diagramActions=this.diagram.diagramActions&~Z.DiagramAction.PreventIconsUpdate,this.diagram.preventNodesUpdate=!1;for(var n=0,r=this.diagram.views;n<r.length;n++){var o=r[n],o=this.diagram.views[o];o instanceof ru||this.diagram.refreshCanvasDiagramLayer(o)}this.diagram.protectPropertyChange(e)},p.prototype.expandNode=function(t,e,i){var n=this.diagram.preventNodesUpdate,r=t.isExpanded,r=(this.diagram.preventNodesUpdate=!0,this.expandCollapse(t,r,this.diagram,void 0),t.isExpanded=r,this.diagram.layout.fixedNode),o=(this.diagram.layout.fixedNode=t.id,this.diagram.diagramActions!=Z.DiagramAction.Render&&this.diagram.layoutAnimateModule&&this.diagram.layout.enableAnimation&&this.diagram.organizationalChartModule&&(this.diagram.organizationalChartModule.isAnimation=!0),this.diagram.blazorActions|=Z.BlazorAction.expandNode,{});return i||(this.layoutAnimateModule&&0<this.layoutAnimateModule.setIntervalObject.length&&(this.layoutAnimateModule.stopCurrentAnimation(this.objectStore[0],e,t),this.objectStore=[]),o=this.diagram.doLayout(),this.objectStore.push(o)),this.canUpdateTemplate=!1,this.diagram.blazorActions&=~Z.BlazorAction.expandNode,this.diagram.preventNodesUpdate=n,this.diagram.layoutAnimateModule&&this.diagram.organizationalChartModule&&!i?(this.diagram.allowServerDataBinding=!1,this.layoutAnimateModule.expand(this.diagram.layout.enableAnimation,o,t,this.diagram)):(e={element:Q(t),state:!!t.isExpanded},this.triggerEvent(Z.DiagramEvent.expandStateChange,e),this.diagram.lineRoutingModule&&this.diagram.constraints&Z.DiagramConstraints.LineRouting&&"ComplexHierarchicalTree"!==this.diagram.layout.type&&this.diagram.resetSegments()),this.diagram.layout.fixedNode=""===r?"":this.diagram.layout.fixedNode,o},p.prototype.getparentexpand=function(t,e,i,n){for(var r,o=0;o<t.inEdges.length;o++){var a=e.nameTable[t.inEdges[o]],s=e.nameTable[a.sourceID];if(s.isExpanded&&!i&&s.id!==n.sourceID&&a.visible)return!1;r=!0}return r},p.prototype.expandCollapse=function(e,t,i,n){if(!(n=n&&0!==n.length?n:[]).some(function(t){return t.id===e.id})){n.push(e);for(var r=0;r<e.outEdges.length;r++){var o=i.nameTable[e.outEdges[r]],a=i.nameTable[o.targetID],s=this.getparentexpand(a,i,t,o),h=(o.visible=t,{visible:a.visible,style:{opacity:a.wrapper.style.opacity}}),d={visible:a.visible,style:{opacity:a.wrapper.style.opacity}};s&&(a.isExpanded&&this.expandCollapse(a,t,i,n),a.visible=t,a.style.opacity=this.diagram.layoutAnimateModule&&this.diagram.layout.enableAnimation&&t?.1:a.style.opacity,i.nodePropertyChange(a,h,d)),i.connectorPropertyChange(o,h,d)}}},p.prototype.updateNodeDimension=function(t,e){t instanceof _&&(t.offsetX=e.x+e.width/2,t.offsetY=e.y+e.height/2,t.width=e.width,t.height=e.height,t.wrapper.children[0].canMeasurePath=!0,this.diagram.nodePropertyChange(t,{},{width:e.width,height:e.height,offsetX:t.offsetX,offsetY:t.offsetY}),"SVG"!==this.diagram.mode)&&this.diagram.refreshDiagramLayer()},p.prototype.updateConnectorPoints=function(t,e){t instanceof W&&"Bezier"!==t.type?this.diagram.connectorPropertyChange(t,{},{targetPoint:t.targetPoint}):this.diagram.connectorPropertyChange(t,{},{segments:t.segments}),this.diagram.updateDiagramObject(t)},p.prototype.updateSelectedNodeProperties=function(t){if(this.diagram.lineRoutingModule&&this.diagram.constraints&Z.DiagramConstraints.LineRouting){this.diagram.protectPropertyChange(!0);var e=[],i=[],n=this.diagram.selectedObject.actualObject,r=this.diagram.selectedObject.helperObject,o=n instanceof B?Q(n):void 0;if(r&&n){var a=r.offsetX-n.offsetX,s=r.offsetY-n.offsetY,h=r.width-n.width,d=r.height-n.height,l=r.rotateAngle-n.rotateAngle;if(0<this.diagram.selectedItems.nodes.length+this.diagram.selectedItems.connectors.length&&(this.diagram.selectedItems.wrapper.rotateAngle=this.diagram.selectedItems.rotateAngle=r.rotateAngle),!(n instanceof _&&"SwimLane"!==n.shape.type)||n.isLane||n.isPhase||n.isHeader||Ur(this.diagram,n)){if(n instanceof B){var c=r.width/n.width,p=r.height/n.height,g=this.diagram.eventHandler.tool.getPivot(this.diagram.eventHandler.tool.corner);if(this.diagram.eventHandler.tool.corner)for(var u=0;u<n.nodes.length;u++){var m=(y=n.nodes[parseInt(u.toString(),10)]).wrapper,f=n.wrapper,f=ad(f.offsetX-f.actualSize.width*f.pivot.x,f.offsetY-f.actualSize.height*f.pivot.y,f.actualSize.width,f.actualSize.height,f.rotateAngle,f.offsetX,f.offsetY,g);this.diagram.commandHandler.scaleObject(c,p,f,y,m,n)}else for(var y,u=0;u<n.nodes.length;u++)!((y=n.nodes[u])instanceof _&&"SwimLane"!==y.shape.type)||Ur(this.diagram,y)||y.isLane||y.isPhase||y.isHeader||(y.offsetX+=a,y.offsetY+=s,y.width+=h,y.height+=d,y.rotateAngle+=l,this.diagram.nodePropertyChange(y,{},{offsetX:y.offsetX,offsetY:y.offsetY,width:y.width,height:y.height,rotateAngle:y.rotateAngle}),e=e.concat(this.diagram.spatialSearch.findObjects(n.wrapper.outerBounds)))}}else n.offsetX===n.wrapper.offsetX&&n.offsetY===n.wrapper.offsetY&&n.width===n.wrapper.width&&n.height===n.wrapper.height&&n.rotateAngle===n.wrapper.rotateAngle||(n.offsetX+=a,n.offsetY+=s,n.width+=h,n.height+=d,n.rotateAngle+=l,this.diagram.nodePropertyChange(n,{},{offsetX:n.offsetX,offsetY:n.offsetY,width:n.width,height:n.height,rotateAngle:n.rotateAngle},!1,!0)),e=this.diagram.spatialSearch.findObjects(n.wrapper.outerBounds)}else t instanceof W?e.push(t):t instanceof B&&t.connectors.length&&(e=e.concat(t.connectors)),t instanceof B&&(-1===this.diagram.nodes.indexOf(t.nodes[0])||!((y=n||t.nodes[0])instanceof _&&"SwimLane"!==y.shape.type)||Ur(this.diagram,y)||y.isLane||y.isPhase||y.isHeader||(e=e.concat(this.diagram.spatialSearch.findObjects(y.wrapper.outerBounds))));for(u=0;u<e.length;u++)e[u]instanceof W&&-1===i.indexOf(e[u].id)&&i.push(e[u].id);(0<i.length||0<this.diagram.routedConnectors.length)&&this.diagram.lineRoutingModule.renderVirtualRegion(this.diagram,!0),this.diagram.lineRoutingModule.skipObstacleCheck=!0;for(u=0;u<this.diagram.routedConnectors.length;u++){var v=this.diagram.nameTable[this.diagram.routedConnectors[u]];this.ReRouteConnector(v)}this.diagram.lineRoutingModule.skipObstacleCheck=!1;for(u=0;u<i.length;u++){v=this.diagram.nameTable[i[u]];-1===this.diagram.routedConnectors.indexOf(v.id)&&this.ReRouteConnector(v)}if(this.diagram.routedConnectors=[],r&&n&&o&&"Drag"===this.diagram.eventHandler.currentAction){for(var b=!1,S=this.diagram.nameTable,u=0;u<n.nodes.length;u++)S[n.nodes[u].parentId]&&S[n.nodes[u].parentId].isLane||(b=!0);b&&(t=Q(n),this.diagram.startGroupAction(),r={type:"PositionChanged",redoObject:Q(t),undoObject:o,category:"Internal"},this.diagram.addHistoryEntry(r),this.diagram.endGroupAction())}this.updateSelector(),this.diagram.protectPropertyChange(!1)}},p.prototype.drawSelectionRectangle=function(t,e,i,n){this.diagram.drawSelectionRectangle(t,e,i,n)},p.prototype.ReRouteConnector=function(t){var e,i,n;t instanceof W&&"Orthogonal"===t.type&&t.sourceID&&t.targetID&&t.sourceID!=t.targetID&&"ComplexHierarchicalTree"!==this.diagram.layout.type&&(n=this.diagram.getObject(t.sourceID),i=(e=this.diagram.getObject(t.targetID)).offsetX>n.offsetX?e.wrapper.outerBounds.middleLeft.x-n.wrapper.outerBounds.middleRight.x:n.wrapper.outerBounds.middleLeft.x-e.wrapper.outerBounds.middleRight.x,n=e.offsetY>n.offsetY?e.wrapper.outerBounds.topCenter.y-n.wrapper.outerBounds.bottomCenter.y:n.wrapper.outerBounds.topCenter.y-e.wrapper.outerBounds.bottomCenter.y,30<i||30<n)&&this.diagram.lineRoutingModule.refreshConnectorSegments(this.diagram,t,!0)},p.prototype.startGroupAction=function(){this.diagram.startGroupAction()},p.prototype.endGroupAction=function(){this.diagram.endGroupAction()},p.prototype.removeChildFromBPmn=function(t,e,i){t=this.diagram.nameTable[t.id]||t.nodes[0];i&&t&&t.processId&&t.processId===i.wrapper.id&&(Q(t).processId=t.processId,(i=this.diagram.nameTable[t.processId].shape.activity.subProcess.processes||[]).splice(i.indexOf(t.id),1),this.diagram.bpmnModule.removeChildFromBPMN(this.diagram.nameTable[t.processId].wrapper,t.id,this.diagram),this.diagram.nameTable[t.id].processId="",t.offsetX=t.wrapper.offsetX,t.offsetY=t.wrapper.offsetY)},p.prototype.isDroppable=function(t,e){t=this.diagram.nameTable[t.id]||t.nodes[0];return t instanceof _&&(!N.isBlazor()&&"TextAnnotation"===t.shape.shape||("Group"===e.shape.shape&&(e.shape.activity.subProcess.collapsed=!1),!t)||"Bpmn"!==t.shape.type||t.processId!==e.id&&t.id!==e.processId&&("Bpmn"!==e.shape.type||e instanceof W||!e.shape.activity||!e.shape.activity.subProcess||!e.shape.activity.subProcess.collapsed))},p.prototype.renderHighlighter=function(t,e,i){new k;if(t.target instanceof _||t.target instanceof W||e&&(t.source instanceof _||t.source instanceof W)){var n=e?t.source:t.target,r=e?t.sourceWrapper:t.targetWrapper,r=this.findTarget(r,n,i,!0),o=void 0;if(r instanceof Pl)for(var a=r.id,s=t.target,h=0,d=s.wrapper.children[0].children[0].children[2].children;h<d.length;h++){var l=d[h];if(l.id===s.id+"_"+a){o=l.children[0];break}}else o=r instanceof _?r.wrapper:e?t.sourceWrapper:t.targetWrapper;!o||r instanceof W||this.diagram.renderHighlighter(o)}},p.prototype.mouseOver=function(t,e,i){return!0},p.prototype.snapPoint=function(t,e,i,n){var r=this.diagram.selectedItems,o=e.x<t.x,a=e.y<t.y,i={x:i,y:n},n=i;return n=this.snappingModule&&(0<r.nodes.length&&r.nodes[0].constraints&Z.NodeConstraints.Drag||0<r.connectors.length&&r.connectors[0].constraints&Z.ConnectorConstraints.Drag)?this.diagram.snappingModule.snapPoint(this.diagram,r,o,a,i,t,e):n},p.prototype.removeSnap=function(){this.diagram.snapSettings.constraints&Z.SnapConstraints.SnapToObject&&this.snappingModule&&this.snappingModule.removeGuidelines(this.diagram)},p.prototype.dropAnnotation=function(t,e){(t instanceof _||t instanceof B)&&(t=t instanceof _?t:t.nodes[0],this.diagram.bpmnModule)&&"Bpmn"===e.shape.type&&!N.isBlazor()&&"TextAnnotation"===t.shape.shape&&(t.hasTarget=e.id,t.shape.annotation.nodeId=e.id,this.diagram.currentSymbol||(this.diagram.addTextAnnotation(t.shape.annotation,e),t.shape.annotation.nodeId="",this.diagram.remove(t)),this.diagram.refreshDiagramLayer())},p.prototype.drop=function(t,e,i){if(this.diagram.bpmnModule){for(var n=t instanceof _?[t]:t.nodes,r=0;r<n.length;r++){var o=n[r];o&&"Bpmn"===o.shape.type&&e instanceof _&&"Bpmn"===e.shape.type&&!(e instanceof W)&&this.diagram.bpmnModule.dropBPMNchild(e,o,this.diagram)}this.diagram.refreshDiagramLayer()}},p.prototype.addHistoryEntry=function(t){this.diagram.addHistoryEntry(t)},p.prototype.align=function(t,e,i){if(0<t.length){for(var n=0,r=(t[0]=this.diagram.nameTable[t[0].id]||t[0],"Object"===i?up(t[0].wrapper):this.diagram.selectedItems.wrapper.bounds),o={nodes:[],connectors:[]},a={nodes:[],connectors:[]},n="Object"===i?n+1:n;n<t.length;n++){var s=0,h=0,d=(t[n]=this.diagram.nameTable[t[n].id]||t[n],up(t[n].wrapper));"Left"===e?s=r.left+d.width/2-d.center.x:"Right"===e?s=r.right-d.width/2-d.center.x:"Top"===e?h=r.top+d.height/2-d.center.y:"Bottom"===e?h=r.bottom-d.height/2-d.center.y:"Center"===e?s=r.center.x-d.center.x:"Middle"===e&&(h=r.center.y-d.center.y),o=this.storeObject(o,t[n]),this.drag(t[n],s,h),this.diagram.updateSelector(),a=this.storeObject(a,t[n])}o=Q(o),a=Q(a),i={type:"Align",category:"Internal",undoObject:Q(o),redoObject:Q(a)};this.addHistoryEntry(i)}},p.prototype.distribute=function(t,e){if(0<t.length){for(var i=0,n=0,r=0,o=0,a=0,s=0,h=0,d=0,l=0,c={nodes:[],connectors:[]},p={nodes:[],connectors:[]},i=0;i<t.length;i++)t[i]=this.diagram.nameTable[t[i].id]||t[i];for(t=yh(t,e),i=1;i<t.length;i++)n=n+t[i].wrapper.bounds.topRight.x-t[i-1].wrapper.bounds.topRight.x,r=r+t[i].wrapper.bounds.topLeft.x-t[i-1].wrapper.bounds.topLeft.x,o=o+t[i].wrapper.bounds.topRight.y-t[i-1].wrapper.bounds.topRight.y,a=a+t[i].wrapper.bounds.bottomRight.y-t[i-1].wrapper.bounds.bottomRight.y,s=s+t[i].wrapper.bounds.center.x-t[i-1].wrapper.bounds.center.x,h=h+t[i].wrapper.bounds.center.y-t[i-1].wrapper.bounds.center.y,d=d+t[i].wrapper.bounds.topRight.y-t[i-1].wrapper.bounds.bottomRight.y,l=l+t[i].wrapper.bounds.middleLeft.x-t[i-1].wrapper.bounds.middleRight.x;for(i=1;i<t.length-1;i++){var g=0,u=0,m=up(t[i-1].wrapper),f=up(t[i].wrapper);"Center"===e?g=m.center.x-f.center.x+s/(t.length-1):"RightToLeft"===e?g=m.middleRight.x-f.middleLeft.x+l/(t.length-1):"Right"===e?g=m.topRight.x-f.topRight.x+n/(t.length-1):"Left"===e?g=m.topLeft.x-f.topLeft.x+r/(t.length-1):"Middle"===e?u=m.center.y-f.center.y+h/(t.length-1):"Top"===e?u=m.topRight.y-f.topRight.y+o/(t.length-1):"Bottom"===e?u=m.bottomRight.y-f.bottomRight.y+a/(t.length-1):"BottomToTop"===e&&(u=m.bottomRight.y-f.topRight.y+d/(t.length-1)),c=this.storeObject(c,t[i]),this.drag(t[i],g,u),this.diagram.updateSelector(),p=this.storeObject(p,t[i])}var c=Q(c),p=Q(p),y={type:"Distribute",category:"Internal",undoObject:Q(c),redoObject:Q(p)};this.addHistoryEntry(y)}},p.prototype.sameSize=function(t,e){if(0<t.length){for(var i=0,n={x:.5,y:.5},r=(t[0]=this.diagram.nameTable[t[0].id]||t[0],up(t[0].wrapper)),o={nodes:[],connectors:[]},a={nodes:[],connectors:[]},i=1;i<t.length;i++){t[parseInt(i.toString(),10)]=this.diagram.nameTable[t[parseInt(i.toString(),10)].id]||t[0];var s=up(t[parseInt(i.toString(),10)].wrapper),h=1,d=1;"Width"===e?h=r.width/s.width:"Height"===e?d=r.height/s.height:"Size"===e&&(h=r.width/s.width,d=r.height/s.height),o=this.storeObject(o,t[parseInt(i.toString(),10)]),this.scale(t[parseInt(i.toString(),10)],h,d,n),a=this.storeObject(a,t[parseInt(i.toString(),10)])}this.diagram.updateSelector();var o=Q(o),a=Q(a),l={type:"Sizing",category:"Internal",undoObject:Q(o),redoObject:Q(a)};this.addHistoryEntry(l)}},p.prototype.storeObject=function(t,e){return(e instanceof _?t.nodes:t.connectors).push(Q(e)),t},p.prototype.updatePanState=function(t){t?this.diagram.realActions=this.diagram.realActions|Z.RealAction.PanInProgress:(this.diagram.dataBind(),t=this.diagram.scrollSettings,this.diagram.realActions=this.diagram.realActions&~Z.RealAction.PanInProgress,t={oldValue:t={VerticalOffset:t.verticalOffset,HorizontalOffset:t.horizontalOffset,ViewportHeight:t.viewPortHeight,ViewportWidth:t.viewPortWidth,CurrentZoom:t.currentZoom},newValue:t,source:this.diagram,panState:"Completed"},this.triggerEvent(Z.DiagramEvent.scrollChange,t))},p.prototype.dataBinding=function(){this.diagram.dataBind()},p.prototype.setBlazorDiagramProps=function(t){this.diagram.setBlazorDiagramProps(t)},p.prototype.scroll=function(t,e,i){var n=this.diagram.constraints&Z.DiagramConstraints.PanX,r=this.diagram.constraints&Z.DiagramConstraints.PanY;this.diagram.pan((t=n?t:0)*this.diagram.scroller.currentZoom,(e=r?e:0)*this.diagram.scroller.currentZoom,i,!0)},p.prototype.drawHighlighter=function(t){this.diagram.renderHighlighter(t.wrapper)},p.prototype.removeHighlighter=function(){this.diagram.clearHighlighter()},p.prototype.renderContainerHelper=function(t){return Fr(this.diagram,t)},p.prototype.isParentAsContainer=function(t,e){return Ur(this.diagram,t,e)},p.prototype.isTargetSubProcess=function(t){return!!(t&&t.shape&&"Bpmn"===t.shape.type&&t.shape.activity&&"SubProcess"===t.shape.activity.activity)},p.prototype.dropChildToContainer=function(t,e){if(!(this.diagram.diagramActions&Z.DiagramAction.PreventLaneContainerUpdate)&&(qr(this.diagram,t,e),e.hasTextAnnotation))for(var i=0;i<e.outEdges.length;i++){var n=this.diagram.nameTable[e.outEdges[parseInt(i.toString(),10)]];n.isBpmnAnnotationConnector&&(n=this.diagram.nameTable[n.targetID],qr(this.diagram,t,n))}},p.prototype.updateLaneChildrenZindex=function(t,e){var t=this.findLeastIndexObject(t,e),i=this.diagram.nameTable[e.parentId];if(i&&i.zIndex>t.zIndex){for(var n=this.diagram.layers.indexOf(this.diagram.getActiveLayer()),r=this.diagram.layers[parseInt(n.toString(),10)].zIndexTable,o=JSON.parse(JSON.stringify(r)),a=t.zIndex,s=i.zIndex,h=s;a<=h;h--)a!==h?r[h-1]?(r[parseInt(h.toString(),10)]=r[h-1],this.diagram.nameTable[r[parseInt(h.toString(),10)]].zIndex=h):(r[h-1]=r[parseInt(h.toString(),10)],this.diagram.nameTable[r[h-1]].zIndex=h,delete r[parseInt(h.toString(),10)]):this.swapZIndexObjects(s,r,i.id,o);"SVG"===this.diagram.mode?(this.moveSvgNode(e.parentId,t.id),this.updateNativeNodeIndex(e.parentId,t.id)):this.diagram.refreshCanvasLayers()}},p.prototype.findLeastIndexConnector=function(t,e,i){for(var n=0;n<t.length;n++){var r=this.diagram.nameTable[t[parseInt(n.toString(),10)]];i.zIndex>r.zIndex&&(i=r)}return i},p.prototype.findLeastIndexObject=function(t,e){var i=t;return t instanceof _&&(i=this.findLeastIndexConnector(t.inEdges,e,i),i=this.findLeastIndexConnector(t.outEdges,e,i)),i},p.prototype.checkSelection=function(t,e){if(1===t.nodes.length&&0===t.connectors.length)if(Ur(this.diagram,t.nodes[0],!0)){var i="SwimLane"===t.nodes[0].shape?t.nodes[0]:this.diagram.nameTable[t.nodes[0].parentId],n=t.nodes[0];if("SwimLane"===i.shape.type){var r="Horizontal"===i.shape.orientation;(n.isPhase&&(r&&"ResizeSouth"===e||!r&&"ResizeEast"===e)||n.isLane&&(r&&"ResizeEast"===e||!r&&"ResizeSouth"===e))&&Or(this.diagram,i,e)}else if("Grid"===i.container.type)if("Horizontal"===i.container.orientation&&1===n.rowIndex||"Vertical"===i.container.orientation&&0<n.rowIndex&&0<n.columnIndex){if("ResizeSouth"===e)for(var o=0;o<this.diagram.nodes.length;o++)if((a=this.diagram.nodes[parseInt(o.toString(),10)]).rowIndex===i.rows.length-1&&0===a.columnIndex){this.select(a);break}}else if("ResizeEast"===e)for(var a,o=0;o<this.diagram.nodes.length;o++)if(1===(a=this.diagram.nodes[parseInt(o.toString(),10)]).rowIndex&&a.columnIndex===i.columns.length-1){this.select(a);break}}else Or(this.diagram,t.nodes[0],e)},p.prototype.zoom=function(t,e,i,n){this.diagram.scroller.zoom(t,e*this.diagram.scroller.currentZoom,i*this.diagram.scroller.currentZoom,n)},p);function p(t){this.clipboardData={},this.diagramObject={},this.newSelectedObjects={},this.oldSelectedObjects={},this.changedNodeZIndexes={},this.connectorsTable=[],this.PreventConnectorSplit=!1,this.processTable={},this.isContainer=!1,this.canUpdateTemplate=!1,this.cloningInProgress=!1,this.childTable={},this.objectStore=[],this.parentTable={},this.blazor="Blazor",this.blazorInterop="sfBlazor",this.cloneGroupChildCollection=[],this.diagram=t}Object.defineProperty(Rg.prototype,"viewPortHeight",{get:function(){return this.vPortHeight},set:function(t){this.vPortHeight=t,this.diagram.scrollSettings.viewPortHeight=t},enumerable:!0,configurable:!0}),Object.defineProperty(Rg.prototype,"currentZoom",{get:function(){return this.currentZoomFActor||1},set:function(t){this.currentZoomFActor=t,this.diagram.scrollSettings.currentZoom=t},enumerable:!0,configurable:!0}),Object.defineProperty(Rg.prototype,"viewPortWidth",{get:function(){return this.vPortWidth},set:function(t){this.vPortWidth=t,this.diagram.scrollSettings.viewPortWidth=t},enumerable:!0,configurable:!0}),Object.defineProperty(Rg.prototype,"horizontalOffset",{get:function(){return this.hOffset},set:function(t){this.hOffset=t,1<Math.abs(this.hOffset-this.diagram.scrollSettings.horizontalOffset)&&(this.diagram.realActions=this.diagram.realActions|Z.RealAction.hScrollbarMoved,this.scrolled=!0),this.diagram.scrollSettings.horizontalOffset=t},enumerable:!0,configurable:!0}),Object.defineProperty(Rg.prototype,"verticalOffset",{get:function(){return this.vOffset},set:function(t){this.vOffset=t,1<Math.abs(this.vOffset-this.diagram.scrollSettings.verticalOffset)&&(this.diagram.realActions=this.diagram.realActions|Z.RealAction.vScrollbarMoved,this.scrolled=!0),this.diagram.scrollSettings.verticalOffset=t},enumerable:!0,configurable:!0}),Rg.prototype.getBounds=function(){var t=this.diagram.spatialSearch.getPageBounds(0,0),t=(t.x<0||t.y<0)&&!this.diagram.pageSettings.multiplePage?this.getPageBounds(void 0,void 0,!0,!0):this.getPageBounds(void 0,void 0,!0);return t},Rg.prototype.updateScrollOffsets=function(t,e){var i,n,r=this.getBounds();r.x*=this.currentZoom,r.y*=this.currentZoom,r.width*=this.currentZoom,r.height*=this.currentZoom,i=Math.max(0,t-r.left),n=Math.max(0,e-r.top),void 0!==t&&void 0!==e?(this.horizontalOffset=i,this.verticalOffset=n,this.diagram.setOffset(i,n)):this.diagram.setOffset(-this.horizontalOffset-r.x,-this.verticalOffset-r.y),this.transform={tx:Math.max(this.horizontalOffset,-r.left)/this.currentZoom,ty:Math.max(this.verticalOffset,-r.top)/this.currentZoom,scale:this.currentZoom}},Rg.prototype.setScrollOffset=function(t,e){this.scrolled=!1;var i,n=this.getBounds(),r=(n.x*=this.currentZoom,n.y*=this.currentZoom,n.width*=this.currentZoom,n.height*=this.currentZoom,-n.left),o=-n.top,a=!1,s=this.viewPortWidth*this.currentZoom,h=this.viewPortHeight*this.currentZoom,d=r-t,l=(d!==this.horizontalOffset&&(r<this.horizontalOffset&&(this.horizontalOffset>d?this.horizontalOffset-=t:this.horizontalOffset=d,a=!0),l=Math.max(n.right+this.vScrollSize,s),!a&&l<-d+this.viewPortWidth&&((l=s-d-this.vScrollSize)<(i=-this.horizontalOffset+s-this.vScrollSize)||l-n.right>l-i?this.horizontalOffset=d:this.horizontalOffset=-(n.right+this.vScrollSize-s),a=!0),a||(this.horizontalOffset=r-t)),a=!1,o-e);l!==this.verticalOffset&&(o<this.verticalOffset&&(this.verticalOffset>l?this.verticalOffset-=e:this.verticalOffset=l,a=!0),i=Math.max(n.bottom+this.hScrollSize,h),!a&&i<h-l&&((d=h-l-this.hScrollSize)<(s=-this.verticalOffset+h-this.hScrollSize)||d-n.bottom>d-s?this.verticalOffset=l:this.verticalOffset=-(n.bottom+this.hScrollSize-h),a=!0),a||(this.verticalOffset=o-e)),this.transform={tx:Math.max(this.horizontalOffset,-n.left)/this.currentZoom,ty:Math.max(this.verticalOffset,-n.top)/this.currentZoom,scale:this.currentZoom},this.setSize()},Rg.prototype.getObjects=function(t,e){for(var i=[],n=0;n<t.length;n++){for(var r=!1,o=0;o<e.length;o++)if(t[parseInt(n.toString(),10)]===e[parseInt(o.toString(),10)]){r=!0;break}r||i.push(t[parseInt(n.toString(),10)])}return i},Rg.prototype.virtualizeElements=function(){for(var t=this.viewPortWidth/this.currentZoom,e=this.viewPortHeight/this.currentZoom,i=this.diagram.spatialSearch.findObjects(new k(-this.horizontalOffset/this.currentZoom,-this.verticalOffset/this.currentZoom,t,e)),n=[],r=0;r<i.length;r++){var o=i[parseInt(r.toString(),10)].shape;if("Bpmn"===o.type&&o&&o.activity&&o.activity.subProcess&&o.activity.subProcess.processes&&0<o.activity.subProcess.processes.length){for(var a=0;a<o.activity.subProcess.processes.length;a++)n.push(o.activity.subProcess.processes[parseInt(a.toString(),10)]);n.push(i[parseInt(r.toString(),10)].id)}else""!==i[parseInt(r.toString(),10)].processId&&void 0!==i[parseInt(r.toString(),10)].processId||n.push(i[parseInt(r.toString(),10)].id)}for(var t=n,s=[],r=0;r<i.length;r++){var h=i[parseInt(r.toString(),10)].shape;if("Bpmn"===h.type&&h&&h.activity&&h.activity.subProcess&&h.activity.subProcess.processes&&0<h.activity.subProcess.processes.length){s.push(i[parseInt(r.toString(),10)].id);for(var d=0;d<h.activity.subProcess.processes.length;d++)s.push(h.activity.subProcess.processes[parseInt(d.toString(),10)])}else""!==i[parseInt(r.toString(),10)].processId&&void 0!==i[parseInt(r.toString(),10)].processId||s.push(i[parseInt(r.toString(),10)].id)}for(r=0;r<i.length;r++)for(a=0;a<s.length;a++)if(i[parseInt(r.toString(),10)].id===s[parseInt(a.toString(),10)]){i[parseInt(r.toString(),10)].zIndex=a;break}var e=this.getObjects(t,this.oldCollectionObjects),l=(0===this.oldCollectionObjects.length&&(this.oldCollectionObjects=t),this.getObjects(this.oldCollectionObjects,t));this.diagram.updateVirtualObjects(e,!1,l),this.oldCollectionObjects=t},Rg.prototype.setSize=function(t){var e=this.getPageBounds(void 0,void 0,!0),i=(e.x*=this.currentZoom,e.y*=this.currentZoom,e.width*=this.currentZoom,e.height*=this.currentZoom,Math.min(e.x,-this.horizontalOffset)),n=Math.min(e.y,-this.verticalOffset),r=(this.horizontalOffset,this.viewPortWidth,e.right,this.verticalOffset,this.viewPortHeight,e.bottom,this.scrollerWidth),o=this.scrollerWidth,a=(-this.verticalOffset<=e.y&&-this.verticalOffset+this.viewPortHeight>=e.bottom&&(o=0),-this.horizontalOffset<=e.x&&-this.horizontalOffset+this.viewPortWidth>=e.right&&(r=0),this.hScrollSize=r,this.vScrollSize=o,this.diagramWidth),s=this.diagramHeight;this.diagramWidth=Math.max(e.right,-this.horizontalOffset+this.viewPortWidth-o)-i,this.diagramHeight=Math.max(e.bottom,-this.verticalOffset+this.viewPortHeight-r)-n,a===this.diagramWidth&&s===this.diagramHeight||"Diagram"===this.diagram.scrollSettings.scrollLimit||this.diagram.setSize(this.diagramWidth,this.diagramHeight),"Diagram"===this.diagram.scrollSettings.scrollLimit&&(a===this.diagramWidth&&s===this.diagramHeight&&1===this.currentZoom||this.diagram.diagramActions&&t&&(!this.diagram.diagramActions||!t||0===this.verticalOffset&&this.verticalOffset!==t.y||0===this.horizontalOffset&&this.horizontalOffset!==t.x)?t&&a===this.diagramWidth&&s===this.diagramHeight&&(this.diagram.diagramCanvas.scrollHeight>this.viewPortHeight&&t.y<0&&this.horizontalOffset===t.x&&0===this.verticalOffset||this.diagram.diagramCanvas.scrollWidth>this.viewPortWidth&&t.x<0&&this.verticalOffset===t.y&&0===this.horizontalOffset)&&(this.verticalOffset=t.y,this.horizontalOffset=t.x,this.transform={tx:Math.max(t.x,-e.left)/this.currentZoom,ty:Math.max(t.y,-e.top)/this.currentZoom,scale:this.currentZoom}):(this.diagram.scrollActions&Z.ScrollActions.Interaction&&t&&(this.transform={tx:Math.max(t.x,-(e.left/this.currentZoom))/this.currentZoom,ty:Math.max(t.y,-(e.top/this.currentZoom))/this.currentZoom,scale:this.currentZoom},this.horizontalOffset=t.x,this.verticalOffset=t.y),this.diagram.setSize(this.diagramWidth,this.diagramHeight),this.diagram.scrollActions&Z.ScrollActions.PropertyChange||!t||(this.horizontalOffset=t.x,this.verticalOffset=t.y,this.transform={tx:Math.max(t.x,-e.left)/this.currentZoom,ty:Math.max(t.y,-e.top)/this.currentZoom,scale:this.currentZoom}))),this.diagram.transformLayers(),this.diagram.element.style.overflow="hidden"},Rg.prototype.setViewPortSize=function(t,e){this.viewPortWidth=t,this.viewPortHeight=e},Rg.prototype.getPageBounds=function(t,e,i,n){var r,o,a;new k;return o="Content"===e||n||null===this.diagram.pageSettings.width||null===this.diagram.pageSettings.height?this.diagram.spatialSearch.getPageBounds(e=t?void 0:0,e):(n=this.diagram.pageSettings.width,t=this.diagram.pageSettings.height,r=e=0,this.diagram.pageSettings.multiplePage&&((o=this.diagram.spatialSearch.getPageBounds(0,0)).right>n&&(n*=a=Math.ceil(o.right/n)),o.bottom>t&&(t*=a=Math.ceil(o.bottom/t)),o.left<0&&Math.abs(o.left)>e&&(a=Math.ceil(Math.abs(o.left)/this.diagram.pageSettings.width),e=this.diagram.pageSettings.width*a),o.top<0)&&Math.abs(o.top)>r&&(a=Math.ceil(Math.abs(o.top)/this.diagram.pageSettings.height),r=this.diagram.pageSettings.height*a),new k(-e,-r,n+e,t+r)),i&&(a=this.diagram.scrollSettings.padding,o.x-=a.left,o.y-=a.top,o.width+=a.left+a.right,o.height+=a.top+a.bottom),o},Rg.prototype.getPageBreak=function(t){for(var e=0,i=0,n=-1,r=[],o=0,a=0,s=0,h=0,d=this.diagram.pageSettings.margin.left,l=this.diagram.pageSettings.margin.right,c=this.diagram.pageSettings.margin.top,p=this.diagram.pageSettings.margin.bottom,g=1,u=1,m={x1:o,y1:s,x2:a,y2:h};t.width>e;)(e+=this.diagram.pageSettings.width||t.width)===this.diagram.pageSettings.width&&(m={x1:t.left+d,y1:t.top+c,x2:t.left+d,y2:t.bottom-p},r[++n]=m),e<t.width&&(o=t.topLeft.x+this.diagram.pageSettings.width*g,s=t.topLeft.y+c,a=t.bottomLeft.x+this.diagram.pageSettings.width*g,h=t.bottomLeft.y-p,r[++n]=m={x1:o,y1:s,x2:a,y2:h},g++),t.width===e&&(m={x1:t.right-l,y1:t.top+c,x2:t.right-l,y2:t.bottom-p},r[++n]=m);for(;t.height>i;)(i+=this.diagram.pageSettings.height||t.height)===this.diagram.pageSettings.height&&(m={x1:t.left+d,y1:t.top+c,x2:t.right-l,y2:t.top+c},r[++n]=m),i<t.height&&(o=t.topLeft.x+d,s=t.topLeft.y+this.diagram.pageSettings.height*u,a=t.topRight.x-l,h=t.topRight.y+this.diagram.pageSettings.height*u,r[++n]=m={x1:o,y1:s,x2:a,y2:h},u++),t.height===i&&(m={x1:t.left+d,y1:t.bottom-p,x2:t.right-l,y2:t.bottom-p},r[++n]=m);return r},Rg.prototype.zoom=function(t,e,i,n,r,o,a,s){var h,d;(this.diagram.constraints&Z.DiagramConstraints.Zoom&&1!==t||this.diagram.constraints&Z.DiagramConstraints.Pan&&1===t)&&(st(h=rt(),this.currentZoom,this.currentZoom),ht(h,this.horizontalOffset,this.verticalOffset),n=z(h,n=n||{x:(this.viewPortWidth/2-this.horizontalOffset)/this.currentZoom,y:(this.viewPortHeight/2-this.verticalOffset)/this.currentZoom}),this.currentZoom*t<=this.diagram.scrollSettings.maxZoom)&&(this.currentZoom*t>=this.diagram.scrollSettings.minZoom||s||1<=t)&&(this.currentZoom*=t,(s=this.getPageBounds(void 0,void 0,!0)).x*=this.currentZoom,s.y*=this.currentZoom,st(d=rt(),t,t,n.x,n.y),ht(d,e||0,i||0),dt(h,d),n=z(h,{x:0,y:0}),1===t&&(n=this.applyScrollLimit(n.x,n.y,r,o,a)),a=-s.y>=n.y&&-s.x>=n.x&&a,!(this.diagram.scrollActions&Z.ScrollActions.PropertyChange)&&this.diagram.scrollActions&Z.ScrollActions.Interaction&&"Diagram"===this.diagram.scrollSettings.scrollLimit&&!a||(this.transform={tx:Math.max(n.x,-s.left)/this.currentZoom,ty:Math.max(n.y,-s.top)/this.currentZoom,scale:this.currentZoom},this.horizontalOffset=n.x,this.verticalOffset=n.y),this.setSize(n),"SVG"!==this.diagram.mode&&Ln(this.diagram)&&this.diagram.scroller.virtualizeElements(),"SVG"===this.diagram.mode||Ln(this.diagram)||this.diagram.refreshDiagramLayer(),this.diagram.setOffset(-this.horizontalOffset-s.x,-this.verticalOffset-s.y),Ss(this.diagram),this.diagram.views)&&this.diagram.views.overview&&(i=(e=this.diagram.views.overview).scrollOverviewRect(e.parent.scroller.horizontalOffset,e.parent.scroller.verticalOffset,e.parent.scroller.currentZoom,!0),e.updateOverviewrect(-i.x,-i.y,i.width,i.height),e.updateView(e))},Rg.prototype.fitToPage=function(t){var e,i=(t=t||{}).mode,n=t.region,r=t.margin||{},o=t.canZoomIn,a=t.customBounds,t=t.canZoomOut,s=(r.bottom=r.bottom||25,r.top=r.top||25,r.left=r.left||25,r.right=r.right||25,a),h=-this.horizontalOffset,d=-this.verticalOffset;if("PageSettings"===(n=n||"PageSettings")&&this.diagram.pageSettings.width&&this.diagram.pageSettings.height||0<this.diagram.nodes.length||0<this.diagram.connectors.length){i=i||"Page","CustomBounds"!==n&&(s=this.getPageBounds(!0,n,!0));var l={x:0,y:0},c=(r.left+r.right>this.viewPortWidth&&(this.viewPortWidth<=100?(r.left=5,r.right=5):(r.left=25,r.right=25)),r.top+r.bottom>this.viewPortHeight&&(this.viewPortHeight<=100?(r.top=5,r.bottom=5):(r.top=25,r.bottom=25)),l.x=(this.viewPortWidth-(r.left+r.right))/s.width,l.y=(this.viewPortHeight-(r.top+r.bottom))/s.height,!o&&s.width-this.horizontalOffset<this.viewPortWidth&&s.height-this.verticalOffset<this.viewPortHeight&&(l.x=Math.min(this.currentZoom,l.x),l.y=Math.min(this.currentZoom,l.y)),void 0),p=void 0,g=void 0;switch(i){case"Width":e=(c=l.x)/this.currentZoom,h+=(p=(this.viewPortWidth-s.width*c)/2-s.x*c)+(r.left-r.right)/2*c,d-=-this.verticalOffset*e,d="CustomBounds"!==n?d:d-this.verticalOffset*e;break;case"Height":e=(c=l.y)/this.currentZoom,p=(this.viewPortWidth-s.width*c)/2-s.x*c,g=(this.viewPortHeight-s.height*c)/2-s.y*c,h+=p+(r.left-r.right)/2*c,d+=g+(r.top-r.bottom)/2*c;break;case"Page":e=(c=Math.min(l.x,l.y))/this.currentZoom,p=(this.viewPortWidth-s.width*c)/2-s.x*c,g=(this.viewPortHeight-s.height*c)/2-s.y*c,h+=p+(r.left-r.right)/2*c,d+=g+(r.top-r.bottom)/2*c}}else e=1/this.currentZoom;this.zoom(e,h,d,{x:0,y:0},!0,void 0,void 0,t)},Rg.prototype.bringIntoView=function(t,e){var i=0,n=0,r=this.currentZoom,o=-this.horizontalOffset,a=-this.verticalOffset,t=new k(t.x*r,t.y*r,t.width*r,t.height*r);new k(o,a,this.viewPortWidth,this.viewPortHeight).containsRect(t)||(t.right>-o+this.viewPortWidth&&(i=t.right-this.viewPortWidth,i+=20),t.x<-o&&(i=t.x),t.bottom>-a+this.viewPortHeight&&(n=t.bottom-this.viewPortHeight,n+=20),t.y<-a&&(n=t.y),this.zoom(1,-this.horizontalOffset-i,-this.verticalOffset-n,null,void 0,e))},Rg.prototype.bringToCenter=function(t){var e=this.currentZoom,t=new k(t.x*e,t.y*e,t.width*e,t.height*e),e=t.x+t.width/2-this.viewPortWidth/2,t=t.y+t.height/2-this.viewPortHeight/2;this.zoom(1,-this.horizontalOffset-(e*=-1),-this.verticalOffset-(t*=-1),null)},Rg.prototype.applyScrollLimit=function(t,e,i,n,r){var o,a,s;return"Infinity"!==this.diagram.scrollSettings.scrollLimit||void 0!==i||n||(t=-t,e=-e),"Infinity"!==this.diagram.scrollSettings.scrollLimit&&(o=void 0,"Limited"===this.diagram.scrollSettings.scrollLimit&&(a=this.diagram.scrollSettings.scrollableArea,o=new k(a.x,a.y,a.width,a.height)),o=o||(r?this.getPageBounds(!1,void 0,!0):this.getPageBounds(!0,void 0,!0)),(o="Pan"===this.diagram[a="eventHandler"].currentAction&&this.diagram[a].inAction?this.getPageBounds(!1,void 0,!0):o).x*=this.currentZoom,o.y*=this.currentZoom,o.width*=this.currentZoom,o.height*=this.currentZoom,void 0!==i&&(t*=-1,e*=-1),n&&(t*=-1,e*=-1),r=Math.max(o.right,this.viewPortWidth),n||t<=o.x&&(t+this.viewPortWidth>=o.right||t>=o.right-this.viewPortWidth)||t>=o.x&&t+this.viewPortWidth<=r||(t=t>=o.x?Math.max(o.x,Math.min(t,t-(t+this.viewPortWidth-this.vScrollSize-r))):(s=o.right-this.viewPortWidth,Math.min(s,o.x))),a=Math.max(o.bottom,this.viewPortHeight),n||e<=o.y&&e+this.viewPortHeight>=o.bottom||e>=o.y&&e+this.viewPortHeight<=a||(e=e>=o.y?Math.max(o.y,Math.min(e,e-(e+this.viewPortHeight-this.hScrollSize-a))):(s=o.bottom-this.viewPortHeight,Math.min(o.y,s))),t*=-1,e*=-1),{x:t,y:e}};var Bg=Rg;function Rg(t){this.transform={tx:0,ty:0,scale:1},this.oldCollectionObjects=[],this.removeCollection=[],this.vPortWidth=0,this.vPortHeight=0,this.currentZoomFActor=1,this.hOffset=0,this.vOffset=0,this.scrolled=!1,this.hScrollSize=0,this.vScrollSize=0,this.diagram=t,this.objects=[],this.transform=t.scroller?t.scroller.transform:{tx:0,ty:0,scale:1},this.vPortWidth=t.scrollSettings.viewPortWidth,this.vPortHeight=t.scrollSettings.viewPortHeight,this.currentZoomFActor=t.scrollSettings.currentZoom,this.hOffset=t.scrollSettings.horizontalOffset,this.vOffset=t.scrollSettings.verticalOffset}jg.prototype.findQuads=function(t,e){null!=this.first&&this.first.isIntersect(t)&&this.first.findQuads(t,e),null!=this.second&&this.second.isIntersect(t)&&this.second.findQuads(t,e),null!=this.third&&this.third.isIntersect(t)&&this.third.findQuads(t,e),null!=this.fourth&&this.fourth.isIntersect(t)&&this.fourth.findQuads(t,e),0<this.objects.length&&e.push(this)},jg.prototype.isIntersect=function(t){return!(this.left+this.width<t.left||this.top+this.height<t.top||this.left>t.right||this.top>t.bottom)},jg.prototype.selectQuad=function(){for(var t,e=null,i=this;null!=i;)i=(t=i.getQuad(e)).source,e=t.target||e;return e},jg.prototype.getQuad=function(t){var e=this.width/2,i=this.height/2;if(1e3<=e&&1e3<=i){var n,r=this.left+e,o=this.top+i;if(this.spatialSearch.childRight<=r){if(this.spatialSearch.childBottom<=o)return this.first||(((n=new jg(this.left,this.top,e,i,this.spatialSearch)).parent=this).first=n),{source:this.first};if(this.spatialSearch.childTop>=o)return this.third||(((n=new jg(this.left,o,e,i,this.spatialSearch)).parent=this).third=n),{source:this.third}}else if(this.spatialSearch.childLeft>=r){if(this.spatialSearch.childBottom<=o)return this.second||(((n=new jg(r,this.top,e,i,this.spatialSearch)).parent=this).second=n),{source:this.second};if(this.spatialSearch.childTop>=o)return this.fourth||(((n=new jg(r,o,e,i,this.spatialSearch)).parent=this).fourth=n),{source:this.fourth}}}return this.objects.push(this.spatialSearch.childNode),{target:this}},jg.prototype.isContained=function(){return this.spatialSearch.childLeft>=this.left&&this.spatialSearch.childRight<=this.left+this.width&&this.spatialSearch.childTop>=this.top&&this.spatialSearch.childBottom<=this.top+this.height},jg.prototype.addIntoAQuad=function(t){for(var e={},i=(this.spatialSearch.setCurrentNode(t),null);!e.isAdded;)i=(e=this.spatialSearch.parentQuad.add(i)).quad;return i},jg.prototype.add=function(t){var e,i,n,r;return t=null,this.isContained()?{isAdded:!0,quad:t=this.selectQuad()}:(e=void 0,i=!(0!==this.objects.length||this.first||this.second||this.third||this.fourth),n=2*this.width,r=2*this.height,this.spatialSearch.childLeft<this.left?this.spatialSearch.childTop<this.top?(e=new jg(this.left-this.width,this.top-this.height,n,r,this.spatialSearch),i||(e.fourth=this)):(e=new jg(this.left-this.width,this.top,n,r,this.spatialSearch),i||(e.second=this)):this.spatialSearch.childTop<this.top?(e=new jg(this.left,this.top-this.height,n,r,this.spatialSearch),i||(e.third=this)):(e=new jg(this.left,this.top,n,r,this.spatialSearch),i||(e.first=this)),this.parent=e,this.spatialSearch.parentQuad=e,{isAdded:!1,quad:t})};var Ng=jg;function jg(t,e,i,n,r){this.objects=[],this.left=t,this.top=e,this.width=i,this.height=n,this.spatialSearch=r}Wg.prototype.removeFromAQuad=function(t){var e,i;this.quadTable[t.id]&&(e=this.quadTable[t.id],-1!==(i=this.objectIndex(e.objects,t)))&&(e.objects.splice(i,1),this.update(e),delete this.quadTable[t.id])},Wg.prototype.update=function(t){var e;t.parent&&0===t.objects.length&&null==t.first&&null==t.second&&null==t.third&&null==t.fourth?((e=t.parent).first===t?e.first=null:e.second===t?e.second=null:e.third===t?e.third=null:e.fourth===t&&(e.fourth=null),this.update(t.parent)):t!==this.parentQuad||t.first||t.second||t.third||t.fourth||(t.left=0,t.width=1e3,t.top=0,t.height=1e3)},Wg.prototype.addIntoAQuad=function(t){var e=this.parentQuad.addIntoAQuad(t);this.quadTable[t.id]=e},Wg.prototype.objectIndex=function(t,e){for(var i=0;i<t.length;i++)if(t[parseInt(i.toString(),10)].id===e.id)return i;return-1},Wg.prototype.updateQuad=function(t){this.setCurrentNode(t);var e=t.outerBounds;if(!(isNaN(e.x)||isNaN(e.y)||isNaN(e.width)||isNaN(e.height))){if(this.quadTable[t.id]?this.quadTable[t.id].isContained()||(this.removeFromAQuad(t),this.addIntoAQuad(t)):this.addIntoAQuad(t),!this.isWithinPageBounds(e)||this.leftElement===t||this.topElement===t||this.rightElement===t||this.bottomElement===t)return e=!1,this.pageLeft===this.childLeft&&t===this.leftElement||(this.pageLeft>=this.childLeft?(this.pageLeft=this.childLeft,this.leftElement=t,e=!0):t===this.leftElement&&(this.pageLeft=Number.MAX_VALUE,this.findLeft(this.parentQuad),e=!0)),this.pageTop===this.childTop&&t===this.topElement||(this.pageTop>=this.childTop?(this.pageTop=this.childTop,this.topElement=t,e=!0):t===this.topElement&&(this.pageTop=Number.MAX_VALUE,this.findTop(this.parentQuad),e=!0)),this.pageBottom===this.childBottom&&t===this.bottomElement||(this.pageBottom<=this.childBottom?(e=!0,this.pageBottom=this.childBottom,this.bottomElement=t):t===this.bottomElement&&(this.pageBottom=-Number.MAX_VALUE,this.findBottom(this.parentQuad),e=!0)),this.pageRight===this.childRight&&t===this.rightElement||(this.pageRight<=this.childRight?(this.pageRight=this.childRight,this.rightElement=t,e=!0):t===this.rightElement&&(this.pageRight=-Number.MAX_VALUE,this.findRight(this.parentQuad),e=!0)),e;this.setCurrentNode(null)}return!1},Wg.prototype.isWithinPageBounds=function(t){return t.left>=this.pageLeft&&t.right<=this.pageRight&&t.top>=this.pageTop&&t.bottom<=this.pageBottom},Wg.prototype.findQuads=function(t){var e=[];return this.parentQuad.findQuads(t,e),e},Wg.prototype.findObjects=function(t){for(var e=[],i=0,n=this.findQuads(t);i<n.length;i++)for(var r=0,o=n[i].objects;r<o.length;r++){var a=o[r];a.outerBounds.intersects(t)&&e.push(this.objectTable[a.id])}return e},Wg.prototype.updateBounds=function(t,e){var i=!1;return e?(this.topElement&&t.id===this.topElement.id&&(i=this.updateTop()),this.leftElement&&t.id===this.leftElement.id&&(i=this.updateLeft()),this.rightElement&&t.id===this.rightElement.id&&(i=this.updateRight()),this.bottomElement&&t.id===this.bottomElement.id&&(i=this.updateBottom())):(t===this.topElement&&(i=this.updateTop()),t===this.leftElement&&(i=this.updateLeft()),t===this.rightElement&&(i=this.updateRight()),t===this.bottomElement&&(i=this.updateBottom())),i},Wg.prototype.updateTop=function(){return this.pageTop=Number.MAX_VALUE,this.topElement=null,this.findTop(this.parentQuad),!0},Wg.prototype.updateBottom=function(){return this.pageBottom=-Number.MAX_VALUE,this.bottomElement=null,this.findBottom(this.parentQuad),!0},Wg.prototype.updateLeft=function(){return this.pageLeft=Number.MAX_VALUE,this.leftElement=null,this.findLeft(this.parentQuad),!0},Wg.prototype.updateRight=function(){return this.pageRight=-Number.MAX_VALUE,this.rightElement=null,this.findRight(this.parentQuad),!0},Wg.prototype.findBottom=function(t){t.third||t.fourth?(t.third&&this.findBottom(t.third),t.fourth&&this.findBottom(t.fourth)):(t.second&&this.findBottom(t.second),t.first&&this.findBottom(t.first));for(var e=0,i=t.objects;e<i.length;e++){var n=i[e];this.pageBottom<=n.outerBounds.bottom&&(this.pageBottom=n.outerBounds.bottom,this.bottomElement=n)}},Wg.prototype.findRight=function(t){(t.second||t.fourth)&&(t.second&&this.findRight(t.second),t.fourth)&&this.findRight(t.fourth),t.first&&this.findRight(t.first),t.third&&this.findRight(t.third);for(var e=0,i=t.objects;e<i.length;e++){var n=i[e];this.pageRight<=n.outerBounds.right&&(this.pageRight=n.outerBounds.right,this.rightElement=n)}},Wg.prototype.findLeft=function(t){t.first||t.third?(t.first&&this.findLeft(t.first),t.third&&this.findLeft(t.third)):(t.second&&this.findLeft(t.second),t.fourth&&this.findLeft(t.fourth));for(var e=0,i=t.objects;e<i.length;e++){var n=i[e];this.pageLeft>=n.outerBounds.left&&(this.pageLeft=n.outerBounds.left,this.leftElement=n)}},Wg.prototype.findTop=function(t){t.first||t.second?(t.first&&this.findTop(t.first),t.second&&this.findTop(t.second)):(t.third&&this.findTop(t.third),t.fourth&&this.findTop(t.fourth));for(var e=0,i=t.objects;e<i.length;e++){var n=i[e];this.pageTop>=n.outerBounds.top&&(this.pageTop=n.outerBounds.top,this.topElement=n)}},Wg.prototype.setCurrentNode=function(t){(this.childNode=t)?(t=t.outerBounds,this.childLeft=Number(t.left),this.childTop=Number(t.top),this.childRight=Number(t.right),this.childBottom=Number(t.bottom)):(this.childLeft=Number.MAX_VALUE,this.childTop=Number.MAX_VALUE,this.childRight=-Number.MAX_VALUE,this.childBottom=-Number.MAX_VALUE)},Wg.prototype.getPageBounds=function(t,e){return this.pageLeft===Number.MAX_VALUE?new k(0,0,0,0):(t=void 0!==t?Math.min(this.pageLeft,0):this.pageLeft,e=void 0!==e?Math.min(this.pageTop,0):this.pageTop,new k(Math.round(t),Math.round(e),Math.round(this.pageRight-t),Math.round(this.pageBottom-e)))},Wg.prototype.getQuad=function(t){return this.quadTable[t.id]};var Hg=Wg;function Wg(t){this.quadSize=500,this.objectTable=t,this.parentQuad=new Ng(0,0,2*this.quadSize,2*this.quadSize,this),this.pageLeft=Number.MAX_VALUE,this.pageRight=-Number.MAX_VALUE,this.pageTop=Number.MAX_VALUE,this.pageBottom=-Number.MAX_VALUE,this.quadTable={}}_g=function(t,e){return(_g=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)};var _g,Yg,mg=function(t,e){function i(){this.constructor=t}_g(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Og=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;0<=s;s--)(r=t[s])&&(a=(o<3?r(a):3<o?r(e,i,a):r(e,i))||a);return 3<o&&a&&Object.defineProperty(e,i,a),a},mg=(Yg=N.ChildProperty,mg(Xg,Yg),Og([N.Property(!1)],Xg.prototype,"preventDefaults",void 0),Xg);function Xg(){return null!==Yg&&Yg.apply(this,arguments)||this}Vg=function(t,e){return(Vg=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)};var Vg,Fg,Og=function(t,e){function i(){this.constructor=t}Vg(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Ug=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;0<=s;s--)(r=t[s])&&(a=(o<3?r(a):3<o?r(e,i,a):r(e,i))||a);return 3<o&&a&&Object.defineProperty(e,i,a),a},Og=(Fg=N.ChildProperty,Og(Gg,Fg),Ug([N.Property("")],Gg.prototype,"action",void 0),Ug([N.Property("")],Gg.prototype,"cursor",void 0),Gg);function Gg(){return null!==Fg&&Fg.apply(this,arguments)||this}Kg.prototype.lineRouting=function(t){var e=t.connectors.length;if(this.renderVirtualRegion(t),0<e)for(var i=0;i<e;i++){var n=t.connectors[parseInt(i.toString(),10)];"Orthogonal"===n.type&&n.visible&&this.refreshConnectorSegments(t,n,!0)}},Kg.prototype.renderVirtualRegion=function(t,e){var i=this.size,n=((t.spatialSearch.pageTop<0||t.spatialSearch.pageLeft<0)&&(i=this.size+this.size/2),t.spatialSearch.pageRight+i),r=t.spatialSearch.pageBottom+i,o=(o=t.spatialSearch.pageLeft-i)<0?o-20:0,i=(i=t.spatialSearch.pageTop-i)<0?i-20:0;if(e&&(this.width!==n-o||this.height!==r-i||this.diagramStartX!==o||this.diagramStartY!==i)||void 0===e){this.width=n-o,this.height=r-i,this.diagramStartX=o,this.diagramStartY=i,this.gridCollection=[],this.noOfRows=this.width/this.size,this.noOfCols=this.height/this.size;for(var a=this.size,s=this.diagramStartX<0?this.diagramStartX:0,h=this.diagramStartY<0?this.diagramStartY:0,d=0;d<this.noOfCols;d++){for(var l=0;l<this.noOfRows;l++){0===d&&this.gridCollection.push([0]);var c={x:s,y:h,width:a,height:a,gridX:l,gridY:d,walkable:!0,tested:void 0,nodeId:[]};this.gridCollection[parseInt(l.toString(),10)][parseInt(d.toString(),10)]=c,s+=a}s=this.diagramStartX<0?this.diagramStartX:0,h+=a}}e=this.findNodes(t.nodes);this.updateNodesInVirtualRegion(e)},Kg.prototype.findNodes=function(t){for(var e,i=[],n=0;n<t.length;n++)"SwimLane"===(e=t[parseInt(n.toString(),10)]).shape.type||e.isLane||e.isPhase||e.isHeader||!e.visible||i.push(e);return i},Kg.prototype.updateNodesInVirtualRegion=function(t){for(var e=this.size,i=this.diagramStartX<0?this.diagramStartX:0,n=this.diagramStartY<0?this.diagramStartY:0,r=0;r<this.noOfCols;r++){for(var o=0;o<this.noOfRows;o++){var a=this.gridCollection[parseInt(o.toString(),10)][parseInt(r.toString(),10)],s=new k(i,n,this.size,this.size),h=void 0,d=void 0;for(a.walkable=!0,a.tested=void 0,a.nodeId=[],d=0;d<t.length;d++)(h=t[parseInt(d.toString(),10)].wrapper.bounds?this.intersectRect(s,t[parseInt(d.toString(),10)].wrapper.bounds):h)&&(a.nodeId.push(t[parseInt(d.toString(),10)].id),a.walkable=!1,""!==t[parseInt(d.toString(),10)].parentId)&&(a.parentNodeId=t[parseInt(d.toString(),10)].parentId);i+=e}i=this.diagramStartX<0?this.diagramStartX:0,n+=e}},Kg.prototype.intersectRect=function(t,e){return!(e.left>=t.right||e.right<=t.left||e.top>=t.bottom||e.bottom<=t.top)},Kg.prototype.findEndPoint=function(t,e,i){var n,r;return e&&""!==t.sourcePortID&&t.sourcePortWrapper||!e&&""!==t.targetPortID&&t.targetPortWrapper?(n=Vi(e?{x:t.sourcePortWrapper.offsetX,y:t.sourcePortWrapper.offsetY}:{x:t.targetPortWrapper.offsetX,y:t.targetPortWrapper.offsetY},void 0,(e?t.sourceWrapper:t.targetWrapper).bounds),r=(e?t.sourcePortWrapper:t.targetPortWrapper).bounds,i?"Top"===n?{x:r.topCenter.x,y:r.topCenter.y}:"Left"===n?{x:r.middleLeft.x,y:r.middleLeft.y}:"Right"===n?{x:r.middleRight.x,y:r.middleRight.y}:{x:r.bottomCenter.x,y:r.bottomCenter.y}:{x:r.center.x,y:r.center.y}):e&&this.startNode||!e&&this.targetNode?e?{x:this.startNode.wrapper.offsetX,y:this.startNode.wrapper.offsetY}:{x:this.targetNode.wrapper.offsetX,y:this.targetNode.wrapper.offsetY}:e?{x:t.sourcePoint.x,y:t.sourcePoint.y}:{x:t.targetPoint.x,y:t.targetPoint.y}},Kg.prototype.getGridsIntersect=function(t,e){var i=[],n=Math.min(t.x,e.x),r=Math.min(t.y,e.y),o=Math.max(t.x,e.x),t=Math.max(t.y,e.y),e=this.size,a=Math.floor((n-this.diagramStartX)/e),s=Math.floor((r-this.diagramStartY)/e),h=Math.floor((o-this.diagramStartX)/e),d=Math.floor((t-this.diagramStartY)/e);if(t-r<o-n)for(var l=a;l<=h;l++)(c=this.gridCollection[parseInt(l.toString(),10)][parseInt(s.toString(),10)])&&-1===i.indexOf(c)&&i.push(c);else for(var c,p=s;p<=d;p++)(c=this.gridCollection[parseInt(a.toString(),10)][parseInt(p.toString(),10)])&&-1===i.indexOf(c)&&i.push(c);return i},Kg.prototype.isPathWalkable=function(t,e,i,n){for(var r=Math.min(t.x,e.x),o=Math.min(t.y,e.y),a=Math.max(t.x,e.x),s=Math.max(t.y,e.y),h=this.getGridsIntersect(t,e),d=0;d<h.length;d++){var l=h[parseInt(d.toString(),10)];if((!n||-1===l.nodeId.indexOf(n.sourceID)&&-1===l.nodeId.indexOf(n.targetID))&&!l.walkable)for(var c=s-o<a-r,p=0,g=l.nodeId;p<g.length;p++){var u=g[p],u=i.nameTable[""+u];if(u){u=u.wrapper.bounds;if(c){if(u.top-5<o&&u.bottom+5>s)return!1}else if(u.left-5<r&&u.right+5>a)return!1}}}return!0},Kg.prototype.checkObstaclesIntersect=function(t,e,i){for(var n=1;n<t.length;n++){var r=t[n-1],o=t[parseInt(n.toString(),10)];if(!this.isPathWalkable(r,o,i,e))return!1}return!0},Kg.prototype.refreshConnectorSegments=function(t,e,i,n){if(e.sourceID&&e.targetID&&e.sourceID!==e.targetID)if(!this.skipObstacleCheck&&e.intermediatePoints&&this.checkObstaclesIntersect(e.intermediatePoints,e,t))t.avoidLineOverlappingModule&&i&&(t.avoidLineOverlappingModule.addConnector(e),t.avoidLineOverlappingModule.refreshModifiedConnectors(t));else{var r,o,a,s,h,d,l,c,p,g,u,m=e.sourceID,f=e.targetID,y=e.sourcePortID,v=e.targetPortID;if(g=t,u=0,(p=e).constraints&Z.ConnectorConstraints.LineRouting?u=p.constraints&Z.ConnectorConstraints.LineRouting:p.constraints&Z.ConnectorConstraints.InheritLineRouting&&(u=g.constraints&Z.DiagramConstraints.LineRouting),u||n){this.startNode=t.nameTable[""+m],this.targetNode=t.nameTable[""+f],this.intermediatePoints=[],this.startArray=[],this.targetGridCollection=[],this.sourceGridCollection=[],this.startGrid=void 0,this.targetGrid=void 0;for(var b=0;b<this.noOfCols;b++)for(var S=0;S<this.noOfRows;S++)this.gridCollection[parseInt(S.toString(),10)][parseInt(b.toString(),10)].tested=this.gridCollection[parseInt(S.toString(),10)][parseInt(b.toString(),10)].parent=void 0,this.gridCollection[parseInt(S.toString(),10)][parseInt(b.toString(),10)].previousDistance=this.gridCollection[parseInt(S.toString(),10)][parseInt(b.toString(),10)].afterDistance=void 0,this.gridCollection[parseInt(S.toString(),10)][parseInt(b.toString(),10)].totalDistance=void 0;for(var w=this.findEndPoint(e,!0),x=this.findEndPoint(e,!1),b=0;b<this.noOfRows;b++)for(S=0;S<this.noOfCols;S++){var I,C=this.gridCollection[parseInt(b.toString(),10)][parseInt(S.toString(),10)],P=new k(C.x,C.y,C.width,C.height);!P.containsPoint(w)||this.startGrid||-1===C.nodeId.indexOf(m)&&""!==m||(this.startGrid=(y&&this.startGrid,C)),!P.containsPoint(x)||this.targetGrid||-1===C.nodeId.indexOf(f)&&""!==f||(this.targetGrid=(v&&this.targetGrid,C)),!y&&this.startNode&&(I=this.startNode.wrapper.bounds,P.containsPoint(I.topCenter)&&!r&&(r=C),P.containsPoint(I.middleLeft)&&!a&&(a=C),P.containsPoint(I.middleRight)&&!s&&(s=C),P.containsPoint(I.bottomCenter))&&!o&&(o=C),!v&&this.targetNode&&(I=this.targetNode.wrapper.bounds,P.containsPoint(I.topCenter)&&!d&&(d=C),P.containsPoint(I.middleLeft)&&!c&&(c=C),P.containsPoint(I.middleRight)&&!h&&(h=C),P.containsPoint({x:I.bottomCenter.x,y:I.bottomCenter.y}))&&!l&&(l=C)}this.findEdgeBoundary(y,a,s,r,o,!0),this.findEdgeBoundary(v,c,h,d,l,!1),this.startGrid.totalDistance=0,this.startGrid.previousDistance=0,this.intermediatePoints.push({x:this.startGrid.gridX,y:this.startGrid.gridY}),this.startArray.push(this.startGrid),e&&c&&h&&d&&l&&this.checkObstacles(e,t,c,h,d,l);t:for(;0<this.startArray.length;){var A=this.startArray.pop();if(A){for(b=0;b<this.targetGridCollection.length;b++){var T=this.targetGridCollection[parseInt(b.toString(),10)];if(A&&A.gridX===T.gridX&&A.gridY===T.gridY){if(this.getIntermediatePoints(A),this.optimizeIntermediatePoints(),A.nodeId&&1<A.nodeId.length&&(e.segments=[]),this.updateConnectorSegments(t,this.intermediatePoints,this.gridCollection,e,i)){this.considerWalkable=[];break t}this.targetGridCollection.splice(this.targetGridCollection.indexOf(T),1),A=this.startArray.pop()}}A&&this.findPath(A)}}}}},Kg.prototype.checkChildNodes=function(t,e){var i=!1,n=!1;if(1<=t.nodeId.length&&!e)for(var r=0;r<t.nodeId.length;r++){for(var o=t.nodeId[parseInt(r.toString(),10)],a=0;a<t.nodeId.length;a++)this.targetNode.parentId===t.nodeId[parseInt(a.toString(),10)]&&(n=!0);i=!n&&this.targetNode.id===o}else 1===t.nodeId.length&&(i=!0);return i},Kg.prototype.findEdgeBoundary=function(t,e,i,n,r,o){var a,s=o?this.sourceGridCollection:this.targetGridCollection;if(!t&&(o?this.startNode:this.targetNode)){for(var h=e.gridX;h<=i.gridX;h++)a=this.gridCollection[parseInt(h.toString(),10)][e.gridY],(this.checkChildNodes(a,o)&&(h===e.gridX||h===i.gridX)||h!==e.gridX&&h!==i.gridX)&&s.push(a);for(h=n.gridY;h<=r.gridY;h++)a=this.gridCollection[n.gridX][parseInt(h.toString(),10)],(this.checkChildNodes(a,o)&&(h===n.gridY||h===r.gridY)||h!==n.gridY&&h!==r.gridY)&&-1===s.indexOf(a)&&s.push(a)}else s.push(o?this.startGrid:this.targetGrid)},Kg.prototype.checkObstacles=function(t,e,i,n,r,o){var a;if(0===this.findNearestNeigbours(this.startGrid,this.gridCollection,!0).length&&(""!==t.sourcePortID?"Top"===(a=Vi({x:t.sourcePortWrapper.offsetX,y:t.sourcePortWrapper.offsetY},void 0,t.sourceWrapper.bounds))?this.resetGridColl(this.startGrid,"top",!0):"Right"===a?this.resetGridColl(this.startGrid,"right",!0):"Bottom"===a?this.resetGridColl(this.startGrid,"bottom",!0):this.resetGridColl(this.startGrid,"left",!0):(this.resetGridColl(this.startGrid,"top",!0),this.resetGridColl(this.startGrid,"right",!0),this.resetGridColl(this.startGrid,"bottom",!0),this.resetGridColl(this.startGrid,"left",!0))),0===this.findNearestNeigbours(this.targetGrid,this.gridCollection,!1).length&&(""!==t.targetPortID?"Top"===(a=Vi({x:t.targetPortWrapper.offsetX,y:t.targetPortWrapper.offsetY},void 0,t.targetWrapper.bounds))?this.resetGridColl(this.targetGrid,"top",!0):"Right"===a?this.resetGridColl(this.targetGrid,"right",!0):"Bottom"===a?this.resetGridColl(this.targetGrid,"bottom",!0):this.resetGridColl(this.targetGrid,"left",!0):(this.resetGridColl(this.targetGrid,"top",!1),this.resetGridColl(this.targetGrid,"right",!1),this.resetGridColl(this.targetGrid,"bottom",!1),this.resetGridColl(this.targetGrid,"left",!1))),1<this.targetGridCollection.length&&1<this.targetGridCollection[0].nodeId.length)for(var s=0;s<=1;s++){for(var h=this.targetGridCollection[parseInt(s.toString(),10)].gridX,d=this.targetGridCollection[parseInt(s.toString(),10)].gridY,l=this.targetGridCollection[parseInt(s.toString(),10)].nodeId,c=void 0,p=0;p<l.length;p++)if(this.targetNode.id!==l[parseInt(p.toString(),10)]){c=l[parseInt(p.toString(),10)];break}for(var g=void 0,u=void 0,m=void 0,f=(e.nameTable[this.targetNode.id]&&(g=e.nameTable[this.targetNode.id].wrapper),e.nameTable[""+c]&&(u=e.nameTable[""+c].wrapper),g&&u&&(m=this.contains(u.bounds,g.bounds)),void 0),y=0;y<l.length;y++)this.targetNode.parentId===l[parseInt(y.toString(),10)]&&(f=!0);this.gridCollection[parseInt(h.toString(),10)][parseInt(d.toString(),10)].walkable||!m||f||(g=u=void 0,u=this.getEndvalue(i,"left"),g=i.gridX-u.gridX,this.changeValue(i,g,"left"),g=(u=this.getEndvalue(n,"right")).gridX-n.gridX,this.changeValue(n,g,"right"),u=this.getEndvalue(r,"top"),g=r.gridY-u.gridY,this.changeValue(r,g,"top"),u=this.getEndvalue(o,"bottom"),g=o.gridY-u.gridY,this.changeValue(o,g,"top"))}},Kg.prototype.contains=function(t,e){return t.left<=e.left&&t.right>=e.right&&t.top<=e.top&&t.bottom>=e.bottom},Kg.prototype.getEndvalue=function(t,e){return this.gridCollection[t.gridX][t.gridY].walkable?t:"left"===e?this.getEndvalue(this.gridCollection[t.gridX-1][t.gridY],e):"right"===e?this.getEndvalue(this.gridCollection[t.gridX+1][t.gridY],e):"top"===e?this.getEndvalue(this.gridCollection[t.gridX][t.gridY-1],e):"bottom"===e?this.getEndvalue(this.gridCollection[t.gridX][t.gridY+1],e):t},Kg.prototype.changeValue=function(t,e,i){var n;t.walkable||this.considerWalkable.push(t);for(var r=0;r<=e;r++)"left"===i?n=this.gridCollection[t.gridX-r][t.gridY]:"right"===i?n=this.gridCollection[t.gridX+r][t.gridY]:"top"===i?n=this.gridCollection[t.gridX][t.gridY-r]:"bottom"===i&&(n=this.gridCollection[t.gridX][t.gridY+r]),n.walkable||this.considerWalkable.push(n)},Kg.prototype.getIntermediatePoints=function(t){var e;for(this.intermediatePoints=[];t;)this.intermediatePoints.push({x:t.gridX,y:t.gridY}),t=t.parent;this.intermediatePoints.reverse(),1<=this.intermediatePoints.length&&void 0!==this.intermediatePoints[0]&&void 0!==this.intermediatePoints[1]&&(this.intermediatePoints[0].x===this.intermediatePoints[1].x?this.intermediatePoints[0].y<this.intermediatePoints[1].y?(e=this.neigbour(this.startGrid,"bottom",void 0,!0),this.intermediatePoints[0].y+=e-1):(e=this.neigbour(this.startGrid,"top",void 0,!0),this.intermediatePoints[0].y-=e-1):this.intermediatePoints[0].x<this.intermediatePoints[1].x?(e=this.neigbour(this.startGrid,"right",void 0,!0),this.intermediatePoints[0].x+=e-1):(e=this.neigbour(this.startGrid,"left",void 0,!0),this.intermediatePoints[0].x-=e-1))},Kg.prototype.optimizeIntermediatePoints=function(){this.intermediatePoints=this.removePointsInSameLine(this.intermediatePoints),this.intermediatePoints=this.getValidPoints(this.intermediatePoints)},Kg.prototype.removePointsInSameLine=function(t){if(t.length<3)return t;for(var e=[t[0]],i=1;i<t.length-1;i++){var n=e[e.length-1],r=t[parseInt(i.toString(),10)],o=t[i+1];this.arePointsInSameLine(n,r,o)||e.push(r)}return e.push(t[t.length-1]),e},Kg.prototype.arePointsInSameLine=function(t,e,i){return(e.x-t.x)*(i.y-t.y)==(i.x-t.x)*(e.y-t.y)},Kg.prototype.getValidPoints=function(t){if(!(t.length<4))for(var e=1;e<t.length-3;){var i=t[parseInt(e.toString(),10)],n=t[e+1],r=t[e+2],o=t[e+3];if(i.x===n.x){if(n.y<i.y&&o.y<r.y||n.y>i.y&&o.y>r.y){for(var a=i.x<r.x?1:-1,s=n.y<i.y?-1:1,h=i.x+a,d=i.y,l=!1;h!==o.x||d!==o.y;){if(!this.isWalkable(h,d)){l=!1;break}l=!0,h!==r.x?h+=a:d+=s}if(l){i.x=r.x,t.splice(e+1,2);continue}}}else if(i.y===n.y&&(n.x<i.x&&o.x<r.x||n.x>i.x&&o.x>r.x)){for(var c=i.y<r.y?1:-1,p=n.x<i.x?-1:1,g=i.y+c,u=i.x,m=!1;u!==o.x||g!==o.y;){if(!this.isWalkable(u,g)){m=!1;break}m=!0,g!==r.y?g+=c:u+=p}if(m){i.y=r.y,t.splice(e+1,2);continue}}e++}return t},Kg.prototype.updateConnectorSegments=function(t,e,i,n,r){var o,a,s,h,d,l,c=[],p=[],g=n.targetWrapper,u=n.sourceWrapper,m=this.findEndPoint(n,!0);""===n.targetPortID&&n.targetWrapper||(o=this.findEndPoint(n,!1,!0));for(var f=0;f<e.length;f++)(s=i[e[parseInt(f.toString(),10)].x][e[parseInt(f.toString(),10)].y])&&(a=s.x+s.width/2,s=s.y+s.height/2,p.push({x:a,y:s}),1<=f&&1<p.length&&(d=p[p.length-2].x!==p[p.length-1].x?p[p.length-2].x>p[p.length-1].x?"Left":"Right":p[p.length-2].y>p[p.length-1].y?"Top":"Bottom"),2<=f&&l===d&&1<p.length&&p.splice(p.length-2,1),l=d);if(p&&1<p.length){for(var y=0;y<p.length-1;y++){var v,b=p[parseInt(y.toString(),10)],S=p[y+1];b.x!==S.x?(0===y&&""===n.sourcePortID&&u&&(m=b.x>S.x?u.bounds.middleLeft:u.bounds.middleRight),y===p.length-2&&""===n.targetPortID&&g&&(o=b.x>S.x?g.bounds.middleRight:g.bounds.middleLeft),0===y&&m&&(b.x=m.x,b.y=S.y=m.y,""===n.sourcePortID&&(v=b.x>S.x?"Left":"Right",m=Mi(n,0,m,Di(u.bounds,Ui(v)),!1)),b.x=m.x),y===p.length-2&&o&&(0<y&&n.targetDecorator&&o.x-S.x<0&&Math.abs(o.x-b.x)<n.targetDecorator.width+1&&(b.x=p[y-1].x-=this.size/2),0<y&&n.targetDecorator&&0<o.x-S.x&&Math.abs(o.x-b.x)<n.targetDecorator.width+1&&(b.x=p[y-1].x+=this.size/2),S.x=o.x,b.y=S.y=o.y)):(0===y&&""===n.sourcePortID&&u&&(m=b.y>S.y?u.bounds.topCenter:u.bounds.bottomCenter),y===p.length-2&&""===n.targetPortID&&g&&(o=b.y>S.y?g.bounds.bottomCenter:g.bounds.topCenter),0===y&&m&&(b.y=m.y,b.x=S.x=m.x,""===n.sourcePortID&&(v=b.y>S.y?"Top":"Bottom",m=Mi(n,0,m,Di(u.bounds,Ui(v)),!1)),b.y=m.y),y===p.length-2&&o&&(0<y&&n.targetDecorator&&o.y-S.y<0&&Math.abs(o.y-b.y)<n.targetDecorator.height+1&&(b.y=p[y-1].y-=this.size/2),0<y&&n.targetDecorator&&0<o.y-S.y&&Math.abs(o.y-b.y)<n.targetDecorator.height+1&&(b.y=p[y-1].y+=this.size/2),S.y=o.y,b.x=S.x=o.x))}if(t.avoidLineOverlappingModule&&r&&(t.avoidLineOverlappingModule.addConnector(n,p),(x=t.avoidLineOverlappingModule.getModifiedConnector()).has(n)&&(c=t.avoidLineOverlappingModule.getModifiedConnectorSegments(n),x.delete(n)),0<x.size)&&t.avoidLineOverlappingModule.refreshModifiedConnectors(t),0===c.length)for(y=0;y<p.length-1;y++){var b=p[parseInt(y.toString(),10)],S=p[y+1],w=b.x!==S.x?b.x>S.x?(h="Left",b.x-S.x):(h="Right",S.x-b.x):b.y>S.y?(h="Top",b.y-S.y):(h="Bottom",S.y-b.y);c.push({type:"Orthogonal",length:w,direction:h})}}if(c&&0<c.length){var x=c[c.length-1];if(1===c.length&&(x.length-=20),x.length<10&&2===c.length&&(c.pop(),0<c.length)&&(c[0].length-=20,x=c[0]),n.targetDecorator&&("Top"===x.direction||"Bottom"===x.direction)&&x.length>n.targetDecorator.height+1||("Right"===x.direction||"Left"===x.direction)&&x.length>n.targetDecorator.width+1)return!r&&t.avoidLineOverlappingModule||(n.segments=c),r&&t.connectorPropertyChange(n,{},{type:"Orthogonal",segments:c}),!0}return!1},Kg.prototype.findPath=function(t){for(var e,i,n=[],r=this.findNearestNeigbours(t,this.gridCollection,!0),o=0;o<r.length;o++)null!==(i=this.findIntermediatePoints(r[parseInt(o.toString(),10)].gridX,r[parseInt(o.toString(),10)].gridY,t.gridX,t.gridY,this.targetGrid.gridX,this.targetGrid.gridY))&&(a=this.gridCollection[i.x][i.y],e=this.octile(Math.abs(i.x-t.gridX),Math.abs(i.y-t.gridY)),t.parent&&t.parent.parent&&a.gridX!==t.parent.gridX&&a.gridY!==t.parent.gridY&&(e+=.1),e=t.previousDistance+e,a.previousDistance&&!(a.previousDistance>e)||i.x===t.gridX&&i.y===t.gridY||(n.push(i),a.previousDistance=e,a.afterDistance=a.afterDistance||this.manhattan(Math.abs(i.x-this.targetGrid.gridX),Math.abs(i.y-this.targetGrid.gridY)),a.totalDistance=a.previousDistance+a.afterDistance,a.parent=t));if(0<n.length)for(o=0;o<n.length;o++){var a=this.gridCollection[n[parseInt(o.toString(),10)].x][n[parseInt(o.toString(),10)].y];-1===this.startArray.indexOf(a)&&this.startArray.push(a)}this.sorting(this.startArray)},Kg.prototype.sorting=function(t){for(var e=!1;!e;){e=!0;for(var i,n=1;n<t.length;n+=1)t[n-1].totalDistance<t[parseInt(n.toString(),10)].totalDistance&&(e=!1,i=t[n-1],t[n-1]=t[parseInt(n.toString(),10)],t[parseInt(n.toString(),10)]=i)}return t},Kg.prototype.octile=function(t,e){var i=Math.SQRT2-1;return t<e?i*t+e:i*e+t},Kg.prototype.manhattan=function(t,e){return t+e},Kg.prototype.findNearestNeigbours=function(t,e,i){var n,r=[],o=t.parent;return o?(n=(t.gridX-o.gridX)/Math.max(Math.abs(t.gridX-o.gridX),1),o=(t.gridY-o.gridY)/Math.max(Math.abs(t.gridY-o.gridY),1),0!=n?(this.isWalkable(t.gridX,t.gridY-1,!0)&&-1===this.sourceGridCollection.indexOf(e[t.gridX][t.gridY-1])&&r.push(e[t.gridX][t.gridY-1]),this.isWalkable(t.gridX,t.gridY+1,!0)&&this.sourceGridCollection.indexOf(e[t.gridX][t.gridY+1])&&r.push(e[t.gridX][t.gridY+1]),this.isWalkable(t.gridX+n,t.gridY,!0)&&-1===this.sourceGridCollection.indexOf(e[t.gridX+n][t.gridY])&&r.push(e[t.gridX+n][t.gridY])):0!=o&&(this.isWalkable(t.gridX-1,t.gridY,!0)&&-1===this.sourceGridCollection.indexOf(e[t.gridX-1][t.gridY])&&r.push(e[t.gridX-1][t.gridY]),this.isWalkable(t.gridX+1,t.gridY,!0)&&-1===this.sourceGridCollection.indexOf(e[t.gridX+1][t.gridY])&&r.push(e[t.gridX+1][t.gridY]),this.isWalkable(t.gridX,t.gridY+o,!0))&&-1===this.sourceGridCollection.indexOf(e[t.gridX][t.gridY+o])&&r.push(e[t.gridX][t.gridY+o])):(this.neigbour(t,"top",r,i),this.neigbour(t,"right",r,i),this.neigbour(t,"bottom",r,i),this.neigbour(t,"left",r,i)),r},Kg.prototype.neigbour=function(t,e,i,n){for(var r=1;0<r;){var o,a="top"===e||"bottom"===e?t.gridX:"left"===e?t.gridX-r:t.gridX+r,s="right"===e||"left"===e?t.gridY:"top"===e?t.gridY-r:t.gridY+r;if((o=this.gridCollection[parseInt(a.toString(),10)][parseInt(s.toString(),10)])&&(n&&-1===this.sourceGridCollection.indexOf(o)||!n&&-1===this.targetGridCollection.indexOf(o)))return i&&this.isWalkable(a,s)&&i.push(o),r;if(!(0<a&&0<s))break;r++}return null},Kg.prototype.resetGridColl=function(t,e,i){for(var n=1;0<n;){var r="top"===e||"bottom"===e?t.gridX:"left"===e?t.gridX-n:t.gridX+n,o="right"===e||"left"===e?t.gridY:"top"===e?t.gridY-n:t.gridY+n;if((a=this.gridCollection[parseInt(r.toString(),10)][parseInt(o.toString(),10)])&&(i&&-1===this.sourceGridCollection.indexOf(a)||!i&&-1===this.targetGridCollection.indexOf(a))){if(this.isWalkable(r,o))break;var a=this.gridCollection[parseInt(r.toString(),10)][parseInt(o.toString(),10)];this.considerWalkable.push(a)}if(!(0<r&&0<o))break;"top"===e||"left"===e?n--:n++}return null},Kg.prototype.isWalkable=function(t,e,i){if(0<=t&&t<this.noOfRows&&0<=e&&e<this.noOfCols){t=this.gridCollection[parseInt(t.toString(),10)][parseInt(e.toString(),10)];if(t&&(t.walkable||(1===t.nodeId.length||2===t.nodeId.length&&t.parentNodeId||-1!==this.considerWalkable.indexOf(t))&&(-1!==this.sourceGridCollection.indexOf(t)||-1!==this.targetGridCollection.indexOf(t)||-1!==this.considerWalkable.indexOf(t)))&&(i&&!t.parent||!i))return!0}return!1},Kg.prototype.findIntermediatePoints=function(t,e,i,n,r,o){for(var i=t-i,n=e-n,a=t,s=e,h=0;h<this.targetGridCollection.length;h++)if(t===this.targetGridCollection[parseInt(h.toString(),10)].gridX&&e===this.targetGridCollection[parseInt(h.toString(),10)].gridY)return{x:t,y:e};if(!this.isWalkable(t,e))return null;var d=this.gridCollection[parseInt(t.toString(),10)][parseInt(e.toString(),10)];if(d.tested)return{x:t,y:e};if(d.tested=!0,0!==i&&(i=0<i?1:-1,this.isWalkable(a,s-1)&&!this.isWalkable(a-i,s-1)||this.isWalkable(a,s+1)&&!this.isWalkable(a-i,s+1)))return{x:t,y:e};if(0!==n){if(n=0<n?1:-1,this.isWalkable(a-1,s)&&!this.isWalkable(a-1,s-n)||this.isWalkable(a+1,s)&&!this.isWalkable(a+1,s-n))return{x:t,y:e};if(this.findIntermediatePoints(a+1,s,a,s,r,o)||this.findIntermediatePoints(a-1,s,a,s,r,o))return{x:t,y:e}}return this.findIntermediatePoints(a+i,s+n,a,s,r,o)},Kg.prototype.destroy=function(){},Kg.prototype.getModuleName=function(){return"LineRouting"};var Zg=Kg;function Kg(){this.size=20,this.intermediatePoints=[],this.gridCollection=[],this.startArray=[],this.targetGridCollection=[],this.sourceGridCollection=[],this.considerWalkable=[],this.skipObstacleCheck=!1}qg=function(t,e){return(qg=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)};var qg,Qg,Ug=function(t,e){function i(){this.constructor=t}qg(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Jg=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;0<=s;s--)(r=t[s])&&(a=(o<3?r(a):3<o?r(e,i,a):r(e,i))||a);return 3<o&&a&&Object.defineProperty(e,i,a),a},Ug=(Qg=N.ChildProperty,Ug($g,Qg),Jg([N.Property(!0)],$g.prototype,"inversedAlignment",void 0),$g);function $g(){return null!==Qg&&Qg.apply(this,arguments)||this}tu=function(t,e){return(tu=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)};var tu,eu,Jg=function(t,e){function i(){this.constructor=t}tu(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},g=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;0<=s;s--)(r=t[s])&&(a=(o<3?r(a):3<o?r(e,i,a):r(e,i))||a);return 3<o&&a&&Object.defineProperty(e,i,a),a},iu=function(o,a,s,h){return new(s=s||Promise)(function(t,e){function i(t){try{r(h.next(t))}catch(t){e(t)}}function n(t){try{r(h.throw(t))}catch(t){e(t)}}function r(e){e.done?t(e.value):new s(function(t){t(e.value)}).then(i,n)}r((h=h.apply(o,a||[])).next())})},nu=function(n,r){var o,a,s,h={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(i){return function(t){var e=[i,t];if(o)throw new TypeError("Generator is already executing.");for(;h;)try{if(o=1,a&&(s=2&e[0]?a.return:e[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,e[1])).done)return s;switch(a=0,(e=s?[2&e[0],s.value]:e)[0]){case 0:case 1:s=e;break;case 4:return h.label++,{value:e[1],done:!1};case 5:h.label++,a=e[1],e=[0];continue;case 7:e=h.ops.pop(),h.trys.pop();continue;default:if(!(s=0<(s=h.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){h=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3]))h.label=e[1];else if(6===e[0]&&h.label<s[1])h.label=s[1],s=e;else{if(!(s&&h.label<s[2])){s[2]&&h.ops.pop(),h.trys.pop();continue}h.label=s[2],h.ops.push(e)}}e=r.call(n,h)}catch(t){e=[6,t],a=0}finally{o=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}}},ru=(eu=N.Component,Jg(G,eu),G.prototype.updateAnnotationText=function(t){},G.prototype.clearCollection=function(t){for(var e=[],i=0,n=Object.keys(this.nameTable);i<n.length;i++){var r=n[i];(r=this.nameTable[""+r])&&(t&&r instanceof W||!t&&r instanceof _)&&e.push(r)}this.clearObjects(e)},G.prototype.onPropertyChanged=function(t,e){var R=this;if(this.rotateUsingButton)this.rotateUsingButton=!1;else{var i=!0,n=!1,r=!1,o=void 0;if(this.diagramActions&Z.DiagramAction.Render){for(var a=0,s=Object.keys(t);a<s.length;a++)switch(s[a]){case"width":case"height":this.element.style.width=this.getSizeValue(this.width),this.element.style.height=this.getSizeValue(this.height),this.eventHandler.updateViewPortSize(this.element);for(var h=0,d=this.views;h<d.length;h++){var l=d[h];(B=this.views[""+l])instanceof G||B.updateView(B)}break;case"nodes":if(0<t.nodes.length&&0===e.nodes.length)this.clearCollection(),r=!0;else{for(var c=0,p=Object.keys(t.nodes);c<p.length;c++){var g=p[c],u=Number(g),m=this.nodes[parseInt(u.toString(),10)],f=t.nodes[parseInt(u.toString(),10)],y=(t.nodes[parseInt(u.toString(),10)].style&&t.nodes[parseInt(u.toString(),10)].style.gradient&&(this.updateGradient(t.nodes[parseInt(u.toString(),10)],e.nodes[parseInt(u.toString(),10)],this.nodes[parseInt(u.toString(),10)]),this.nodes[parseInt(u.toString(),10)].oldGradientValue=Q(t.nodes[parseInt(u.toString(),10)].style.gradient)),n=n||void 0!==f.excludeFromLayout,t.nodes[u]&&t.nodes[u].shape&&t.nodes[u].shape.textAnnotation&&""!==t.nodes[u].shape.textAnnotation.textAnnotationTarget&&(o=Q(this.nameTable[m.inEdges[0]])),this.nodePropertyChange(m,e.nodes[parseInt(u.toString(),10)],f,void 0,!0,!0),{element:m,cause:this.diagramActions,diagramAction:this.getDiagramAction(this.diagramActions),oldValue:e.nodes[parseInt(u.toString(),10)],newValue:t.nodes[parseInt(u.toString(),10)]});this.triggerEvent(Z.DiagramEvent.propertyChange,y),i=i&&!1}"Canvas"===this.mode&&this.refreshDiagramLayer()}break;case"connectors":if(0<t.connectors.length&&0===e.connectors.length)this.clearCollection(!0),r=!0;else{for(var v=0,b=Object.keys(t.connectors);v<b.length;v++){var g=b[v],u=Number(g),m=this.connectors[parseInt(u.toString(),10)],f=t.connectors[parseInt(u.toString(),10)],S={sourcePoint:{x:m.sourcePoint.x,y:m.sourcePoint.y},targetPoint:{x:m.targetPoint.x,y:m.targetPoint.y}},y=(f&&(f.sourceDecorator||f.targetDecorator)&&(this.diagramActions|=Z.DiagramAction.DecoratorPropertyChange),this.connectorPropertyChange(m,e.connectors[parseInt(u.toString(),10)],f,!0,!0),t.connectors[parseInt(u.toString(),10)].sourceID&&!t.connectors[parseInt(u.toString(),10)].sourcePoint&&(e.connectors[parseInt(u.toString(),10)].sourcePoint={x:S.sourcePoint.x,y:S.sourcePoint.y},t.connectors[parseInt(u.toString(),10)].sourcePoint={x:m.sourcePoint.x,y:m.sourcePoint.y}),t.connectors[parseInt(u.toString(),10)].targetID&&!t.connectors[parseInt(u.toString(),10)].targetPoint&&(e.connectors[parseInt(u.toString(),10)].targetPoint={x:S.targetPoint.x,y:S.targetPoint.y},t.connectors[parseInt(u.toString(),10)].targetPoint={x:m.targetPoint.x,y:m.targetPoint.y}),f&&(f.sourceDecorator||f.targetDecorator)&&(this.diagramActions=this.diagramActions&~Z.DiagramAction.DecoratorPropertyChange),{element:m,cause:this.diagramActions,diagramAction:this.getDiagramAction(this.diagramActions),oldValue:e.connectors[parseInt(u.toString(),10)],newValue:t.connectors[parseInt(u.toString(),10)]});this.triggerEvent(Z.DiagramEvent.propertyChange,y),m&&m.parentId&&"UmlClassifier"===this.nameTable[m.parentId].shape.type&&this.updateConnectorEdges(this.nameTable[m.parentId]||m),i=i&&!1}this.updateBridging(),"Canvas"===this.mode&&this.refreshDiagramLayer()}break;case"bridgeDirection":this.updateBridging(),"Canvas"===this.mode&&this.refreshDiagramLayer();break;case"backgroundColor":this.intOffPageBackground();break;case"pageSettings":this.validatePageSize(),this.updatePage();break;case"selectedItems":t.selectedItems.userHandles&&this.selectedItems.wrapper&&this.selectedItems.userHandles&&0<this.selectedItems.userHandles.length?this.renderSelector(!0):t.selectedItems.constraints&&this.renderSelector(!0);break;case"snapSettings":this.updateSnapSettings(t);break;case"commandManager":this.initCommands();break;case"layout":n=!0;break;case"segmentThumbShape":this.updateSelector();break;case"dataSourceSettings":this.clear(),"None"===this.layout.type?r=!0:(this.initObjects(),n=!0);break;case"tooltip":Pe(this);break;case"rulerSettings":this.updateRulerSettings(t);break;case"layers":this.updateLayer(t);break;case"scrollSettings":this.scrollActions|=Z.ScrollActions.PropertyChange,this.updateScrollSettings(t),this.scrollActions&=~Z.ScrollActions.PropertyChange,this.scrollSettings.horizontalOffset=-this.scroller.horizontalOffset||0,this.scrollSettings.verticalOffset=-this.scroller.verticalOffset||0;break;case"locale":t.locale!==e.locale&&eu.prototype.refresh.call(this);break;case"contextMenuSettings":if(void 0!==t.contextMenuSettings.showCustomMenuOnly&&(this.contextMenuSettings.showCustomMenuOnly=t.contextMenuSettings.showCustomMenuOnly),void 0!==t.contextMenuSettings.show&&(this.contextMenuSettings.show=t.contextMenuSettings.show),t.contextMenuSettings.items){for(var w=t.contextMenuSettings.items,x=0,I=Object.keys(w);x<I.length;x++){g=I[x],u=Number(g);this.contextMenuSettings.items[parseInt(u.toString(),10)]=w[parseInt(u.toString(),10)]}this.contextMenuModule?this.contextMenuModule.refreshItems():console.warn('[WARNING] :: Module "DiagramContextMenu" is not available in Diagram component! You either misspelled the module name or forgot to load it.')}break;case"serializationSettings":void 0!==t.serializationSettings.preventDefaults&&(this.serializationSettings.preventDefaults=t.serializationSettings.preventDefaults);break;case"tool":this.eventHandler.updateTool()}if(n&&!r){if(e.layout&&"DifferentPoint"===e.layout.connectionPointOrigin&&"SamePoint"===t.layout.connectionPointOrigin||e.layout&&t.layout&&!t.layout.enableRouting&&e.layout.enableRouting){for(var C=0;C<this.nodes.length;C++){var P=this.nodes[parseInt(C.toString(),10)];if(P.ports&&0<P.ports.length){for(var N=[],A=P.ports.length-1;0<=A;A--)"LineDistribution"===P.ports[parseInt(A.toString(),10)].id.split("_")[1]&&N.push(P.ports[parseInt(A.toString(),10)]);this.removePorts(P,N)}}for(A=0;A<this.connectors.length;A++){var T=this.connectors[parseInt(A.toString(),10)],j=T.sourcePortID,H=T.targetPortID;T.sourcePortID="",T.targetPortID="",T.sourcePortWrapper=void 0,T.targetPortWrapper=void 0,T.segments=[],this.connectorPropertyChange(T,{sourcePortID:j,targetPortID:H},{sourcePortID:"",targetPortID:""})}}this.doLayout(),this.renderReactTemplates()}if(i&&this.propertyChange&&(y={element:this,cause:this.diagramActions,diagramAction:this.getDiagramAction(this.diagramActions),oldValue:e,newValue:t},this.triggerEvent(Z.DiagramEvent.propertyChange,y)),!r&&this.canLogChange()&&this.modelChanged(t,e)){var W=[],D=[],O=void 0;if(t.nodes&&0<Object.keys(t.nodes).length)for(var M=0,_=Object.keys(t.nodes);M<_.length;M++){g=_[M],O=parseInt(g,10);W.push(this.nodes[parseInt(O.toString(),10)].id)}if(t.connectors&&0<Object.keys(t.connectors).length)for(var E=0,Y=Object.keys(t.connectors);E<Y.length;E++){var g=Y[E],X=parseInt(g,10);D.push(this.connectors[parseInt(X.toString(),10)].id)}var L,z,V=W.concat(D);0===D.filter(function(t){return R.nameTable[""+t].isBpmnAnnotationConnector}).length&&(t.nodes&&t.nodes[O]&&t.nodes[O].shape&&t.nodes[O].shape.textAnnotation&&""!==t.nodes[O].shape.textAnnotation.textAnnotationTarget?(L=this.nameTable[this.nodes[parseInt(O.toString(),10)].inEdges[0]],this.startGroupAction(),L={type:"ConnectionChanged",undoObject:o,redoObject:Q(L),category:"Internal"},z={type:"PropertyChanged",undoObject:e,redoObject:t,category:"Internal"},this.historyManager&&(this.addHistoryEntry(L),this.addHistoryEntry(z,V)),this.endGroupAction()):(z={type:"PropertyChanged",undoObject:e,redoObject:t,category:"Internal"},this.historyManager&&this.addHistoryEntry(z,V)))}this.resetDiagramActions(),r&&(this.initObjects(!0),this.refreshDiagramLayer(),n)&&this.doLayout();var F=1===Object.keys(t).length&&void 0!==t.scrollSettings;if(!r)for(var k=0,U=this.views;k<U.length;k++){var B=U[k];(l=this.views[""+B])instanceof G||(t.scrollSettings&&(t.scrollSettings.currentZoom,e.scrollSettings.currentZoom),F)||this.refreshCanvasDiagramLayer(l)}}}},G.prototype.updateSnapSettings=function(t){(void 0!==t.snapSettings.constraints||t.snapSettings.horizontalGridlines||t.snapSettings.verticalGridlines||t.snapSettings.gridType)&&this.diagramRenderer.updateGrid(this.snapSettings,Kc(this.element.id),this.scroller.transform,this.rulerSettings,this.hRuler,this.vRuler)},G.prototype.updateGradient=function(t,e,i){if(i.oldGradientValue)for(var n,r=i,o=i,a=e.style.gradient,s=e.style.gradient,h=0,d=Object.keys(t.style.gradient);h<d.length;h++)switch(d[h]){case"type":r.type&&(a.type=r.type);break;case"x1":r.x1&&(a.x1=r.x1);break;case"x2":r.x2&&(a.x2=r.x2);break;case"y1":r.y1&&(a.y1=r.y1);break;case"y2":r.y2&&(a.y2=r.y2);break;case"cx":o.cx&&(s.cx=o.cx);break;case"cy":o.cy&&(s.cy=o.cy);break;case"fx":o.fx&&(s.fx=o.fx);break;case"fy":o.fy&&(s.fy=o.fy);break;case"r":o.r&&(s.r=o.r);break;case"stops":i.oldGradientValue.stops&&((n=Object.values(Q(i.oldGradientValue.stops))).pop(),e.style.gradient.stops=n)}},G.prototype.updateRulerSettings=function(t){void 0!==t.rulerSettings.dynamicGrid&&this.diagramRenderer.updateGrid(this.snapSettings,Kc(this.element.id),this.scroller.transform,this.rulerSettings,this.hRuler,this.vRuler),void 0!==t.rulerSettings.showRulers?(this.intOffPageBackground(),this.scroller.setSize(),this.renderRulers()):void 0===t.rulerSettings.horizontalRuler&&void 0===t.rulerSettings.verticalRuler||(void 0!==t.rulerSettings.horizontalRuler.thickness||void 0!==t.rulerSettings.verticalRuler.thickness?(ws(this),this.intOffPageBackground(),this.scroller.setSize(),this.renderRulers()):Ss(this)),this.diagramRenderer.updateGrid(this.snapSettings,Kc(this.element.id),this.scroller.transform,this.rulerSettings,this.hRuler,this.vRuler)},G.prototype.getPersistData=function(){return this.addOnPersist(["loaded"])},G.prototype.preRender=function(){this.initializePrivateVariables(),this.isProtectedOnChange=!0,this.serviceLocator=new Wp,this.initializeServices(),this.setCulture();var t="measureElement";window[t]&&(window[t]=null),this.initDiagram(),this.initViews(),this.unWireEvents(),this.wireEvents(),this.element.classList.add("e-diagram")},G.prototype.initializePrivateVariables=function(){var t;""===this.element.id&&(t=document.getElementsByClassName("e-diagram").length,this.element.id="diagram_"+this.diagramid+"_"+t),this.defaultLocale={Copy:"Copy",Cut:"Cut",Paste:"Paste",Undo:"Undo",Redo:"Redo",SelectAll:"Select All",Grouping:"Grouping",Group:"Group",UnGroup:"Un Group",Order:"Order",BringToFront:"Bring To Front",MoveForward:"Move Forward",SendToBack:"Send To Back",SendBackward:"Send Backward"},this.layerZIndex=-1,this.layerZIndexTable={},void 0===this.swimlaneChildTable&&void 0===this.swimlaneZIndexTable&&(this.swimlaneChildTable={},this.swimlaneZIndexTable={}),this.nameTable={},this.pathTable={},this.groupTable={},this.commands={},this.isLoading||(this.views=[]),this.commandHandler=new kg(this),this.eventHandler=new Cg(this,this.commandHandler),this.spatialSearch=new Hg(this.nameTable),this.scroller=new Bg(this)},G.prototype.initializeServices=function(){this.serviceLocator.register("localization",this.localeObj=new N.L10n(this.getModuleName(),this.defaultLocale,this.locale))},G.prototype.setCulture=function(){this.localeObj=new N.L10n(this.getModuleName(),this.defaultLocale,this.locale)},G.prototype.render=function(){this.refreshing&&this.dataSourceSettings.dataSource&&!this.isLoading&&(this.nodes=[],this.connectors=[]),this.refreshing||this.trigger("load",{diagram:this,name:"load"}),this.isRefreshed=!1,this.ignoreCollectionWatch=!0;window.domTable={};for(var t=[],e=(this.dataSourceSettings.crudAction.read&&this.renderInitialCrud(),this.initHistory(),this.diagramRenderer=new Fs(this.element.id,new Xs,"SVG"===this.mode),this.initLayers(),this.initializeDiagramLayers(),this.diagramRenderer.setLayers(),this.initObjects(!0),this.nodes),i=0;i<e.length;i++)e[parseInt(i.toString(),10)].isExpanded||t.push(e[parseInt(i.toString(),10)]);if(t.length)for(i=t.length-1;0<=i;i--)0===i?this.commandHandler.expandNode(t[parseInt(i.toString(),10)],this,!1):this.commandHandler.expandNode(t[parseInt(i.toString(),10)],this,!0);this.canLayout&&this.doLayout(),this.lineRoutingModule?this.lineRoutingModule.lineRouting(this):this.constraints&Z.DiagramConstraints.LineRouting&&console.warn('[WARNING] :: Module "LineRouting" is not available in Diagram component! You either misspelled the module name or forgot to load it.'),this.validatePageSize(),this.renderPageBreaks(),this.diagramRenderer.renderSvgGridlines(this.snapSettings,Kc(this.element.id),this.scroller.transform,this.rulerSettings,this.hRuler,this.vRuler),this.commandHandler.initSelectorWrapper(),this.notify("initial-load",{}),this.trigger("load"),this.scroller.setSize(),this.scroller.updateScrollOffsets(),this.isRefreshed||this.refreshDiagramLayer(),(0<this.scrollSettings.verticalOffset||0<this.scrollSettings.horizontalOffset)&&this.updateScrollOffset(),N.Browser.isDevice&&(this.tool=Z.DiagramTools.ZoomPan|Z.DiagramTools.SingleSelect),this.notify("initial-end",{}),this.isProtectedOnChange=!1,this.tooltipObject=Pe(this),this.diagramActions=Z.DiagramAction.Render,this.initCommands();var n,r,o,a=document.getElementsByClassName(this.element.id+"_hiddenUserHandleTemplate"),s=this.userHandleTemplate,h=a,a=this.selectedItems,d=this.element.id,l=document.getElementById(d).ej2_instances[0];if(s&&h)for(var c,p=pp(s),g=0,u=a.userHandles;g<u.length;g++)if(n=u[g],p){for(r=p(Q(n),l,"userHandleTemplate_"+n.name,void 0,void 0,!1),o=0;o<r.length;o++)(c=A("div",{style:"height: 100%; width: 100%; pointer-events: all",id:n.name+"_template_hiddenUserHandle"})).appendChild(r[o]);h[0].appendChild(c)}this.isLoading=!1,this.refreshRoutingConnectors(),this.renderComplete(),this.updateFitToPage(),this.refreshing&&this.renderReactTemplates()},G.prototype.updateFitToPage=function(){this.pageSettings&&this.pageSettings.fitOptions&&this.pageSettings.fitOptions.canFit&&this.fitToPage(this.pageSettings.fitOptions)},G.prototype.updateTemplate=function(){},G.prototype.renderInitialCrud=function(){var t,e=this;e.dataSourceSettings.crudAction.read&&((t=new N.Fetch(e.dataSourceSettings.crudAction.read,"GET")).onSuccess=function(t){e.dataSourceSettings.dataManager?e.dataSourceSettings.dataManager=JSON.parse(t):e.dataSourceSettings.dataSource=JSON.parse(t),e.dataBind()},t.send().then()),e.dataSourceSettings.connectionDataSource.crudAction.read&&((t=new N.Fetch(e.dataSourceSettings.connectionDataSource.crudAction.read,"GET")).onSuccess=function(t){e.dataSourceSettings.connectionDataSource.dataManager=JSON.parse(t),e.dataBind()},t.send().then())},G.prototype.getModuleName=function(){return"diagram"},G.prototype.getClassName=function(){return"Diagram"},G.prototype.requiredModules=function(){var t=[];return t.push({member:"Bpmn",args:[]}),t.push({member:"Bridging",args:[]}),t.push({member:"ConnectorEditingTool",args:[]}),this.constraints&Z.DiagramConstraints.UndoRedo&&t.push({member:"UndoRedo",args:[]}),"OrganizationalChart"!==this.layout.type&&"HierarchicalTree"!==this.layout.type&&!this.layout.enableAnimation||t.push({member:"LayoutAnimate",args:[]}),this.snapSettings.constraints&&t.push({member:"Snapping",args:[this]}),t.push({member:"Ej1Serialization",args:[this]}),t.push({member:"PrintandExport",args:[this]}),this.contextMenuSettings.show&&t.push({member:"contextMenu",args:[this,this.serviceLocator]}),"OrganizationalChart"!==this.layout.type&&"HierarchicalTree"!==this.layout.type||t.push({member:"OrganizationalChart",args:[this]}),"ComplexHierarchicalTree"===this.layout.type&&t.push({member:"ComplexHierarchicalTree",args:[]}),"MindMap"===this.layout.type&&t.push({member:"MindMapChart",args:[]}),"RadialTree"===this.layout.type&&t.push({member:"RadialTree",args:[]}),"SymmetricalLayout"===this.layout.type&&t.push({member:"SymmetricalLayout",args:[]}),"Flowchart"===this.layout.type&&t.push({member:"FlowchartLayout",args:[]}),(this.dataSourceSettings.dataManager||this.dataSourceSettings.dataSource||this.dataSourceSettings.crudAction.read||this.dataSourceSettings.connectionDataSource.crudAction.read)&&t.push({member:"DataBinding",args:[]}),this.constraints&Z.DiagramConstraints.LineRouting&&t.push({member:"LineRouting",args:[]}),this.constraints&Z.DiagramConstraints.AvoidLineOverlapping&&t.push({member:"AvoidLineOverlapping",args:[this]}),(this.layout&&("ComplexHierarchicalTree"===this.layout.type||"HierarchicalTree"===this.layout.type)||"Linear"===this.layout.arrangement||this.layout.enableRouting)&&t.push({member:"LineDistribution",args:[]}),t},G.prototype.removeUserHandlesTemplate=function(){if(this.selectedItems.userHandles.length)for(var t=0;t<this.selectedItems.userHandles.length;t++)for(var e=0,i=this.views;e<i.length;e++){var n=i[e];rp(this.selectedItems.userHandles[parseInt(t.toString(),10)].name+"_template_hiddenUserHandle",n)}},G.prototype.destroy=function(){if(clearInterval(this.renderTimer),this.renderTimer=null,this.hRuler&&this.vRuler&&(this.hRuler.destroy(),this.vRuler.destroy()),this.tooltipObject.destroy(),this.droppable.destroy(),this.unWireEvents(),this.notify("destroy",{}),eu.prototype.destroy.call(this),this.removeUserHandlesTemplate(),this.clearTemplate(),document.getElementById(this.element.id)){this.element.classList.remove("e-diagram");for(var t=document.getElementsByClassName("e-diagram-tooltip");0<t.length;)t[0].parentNode.removeChild(t[0]);var e,i=document.getElementById(this.element.id+"content"),i=(i&&this.element.removeChild(i),"measureElement");window[i]&&(--window[i].usageCount,e="measureElementCount",window[e]--,0===window[e])&&(window[i].parentNode.removeChild(window[i]),window[i]=null)}window.domTable={};for(var n=0;n<this.layers.length;n++)this.layers[parseInt(n.toString(),10)].zIndexTable={};this.diagramActions=void 0},G.prototype.wireEvents=function(){var t=N.Browser.touchStartEvent,e=N.Browser.touchEndEvent,i=N.Browser.touchMoveEvent,n=N.Browser.isPointer?"pointerleave":"mouseleave",r=N.Browser.isPointer,r="mozilla"!==N.Browser.info.name||r?"mousewheel":"DOMMouseScroll";N.EventHandler.add(this.diagramCanvas,t,this.eventHandler.mouseDown,this.eventHandler),N.EventHandler.add(this.diagramCanvas,i,this.eventHandler.mouseMove,this.eventHandler),N.EventHandler.add(this.diagramCanvas,e,this.eventHandler.mouseUp,this.eventHandler),N.EventHandler.add(this.diagramCanvas,n,this.eventHandler.mouseLeave,this.eventHandler),N.EventHandler.add(this.diagramCanvas,"keydown",this.eventHandler.keyDown,this.eventHandler),N.EventHandler.add(this.diagramCanvas,"keyup",this.eventHandler.keyUp,this.eventHandler),N.EventHandler.add(this.diagramCanvas,"dblclick",this.eventHandler.doubleClick,this.eventHandler),N.EventHandler.add(this.diagramCanvas,"scroll",this.eventHandler.scrolled,this.eventHandler),N.EventHandler.add(this.diagramCanvas,r,this.eventHandler.mouseWheel,this.eventHandler),N.EventHandler.add(window,"resize",this.eventHandler.windowResize,this.eventHandler),this.initDroppables()},G.prototype.unWireEvents=function(){var t=N.Browser.touchStartEvent,e=N.Browser.touchMoveEvent,i=N.Browser.isPointer?"pointerleave":"mouseleave",n=N.Browser.isPointer,n="mozilla"!==N.Browser.info.name||n?"mousewheel":"DOMMouseScroll",r=N.Browser.touchEndEvent;N.EventHandler.remove(this.diagramCanvas,t,this.eventHandler.mouseDown),N.EventHandler.remove(this.diagramCanvas,e,this.eventHandler.mouseMove),N.EventHandler.remove(this.diagramCanvas,r,this.eventHandler.mouseUp),N.EventHandler.remove(this.diagramCanvas,i,this.eventHandler.mouseLeave),N.EventHandler.remove(this.diagramCanvas,"keydown",this.eventHandler.keyDown),N.EventHandler.remove(this.diagramCanvas,"keyup",this.eventHandler.keyUp),N.EventHandler.remove(this.diagramCanvas,"dblclick",this.eventHandler.doubleClick),N.EventHandler.remove(this.diagramCanvas,"scroll",this.eventHandler.scrolled),N.EventHandler.remove(this.diagramCanvas,n,this.eventHandler.mouseWheel),N.EventHandler.remove(window,"resize",this.eventHandler.windowResize)},G.prototype.select=function(t,e,i){null!=t&&this.commandHandler.selectObjects(t,e,i)},G.prototype.getDiagramAction=function(t){var e;return 2===t&&Z.DiagramAction.Render?e="Render":t&Z.DiagramAction.UndoRedo?e="UndoRedo":t&Z.DiagramAction.PublicMethod?e="PublicMethod":t&Z.DiagramAction.ToolAction?e="ToolAction":t&Z.DiagramAction.TextEdit?e="TextEdit":t&Z.DiagramAction.Group?e="Group":t&Z.DiagramAction.Interactions?e="Interactions":t&Z.DiagramAction.PreventHistory?e="PreventHistory":t&Z.DiagramAction.DecoratorPropertyChange?e="DecoratorPropertyChange":t&Z.DiagramAction.PreventZIndexOnDragging?e="PreventZIndexOnDragging":t&Z.DiagramAction.isGroupDragging?e="isGroupDragging":t&Z.DiagramAction.DragUsingMouse&&(e="DragUsingMouse"),e},G.prototype.selectAll=function(){var t=this.getObjectsOfLayer(this.activeLayer.objects);this.select(t)},G.prototype.unSelect=function(t){t&&so(this,t)&&this.commandHandler.unSelect(t)},G.prototype.clearSelection=function(){this.commandHandler.clearSelection(!0)},G.prototype.updateViewPort=function(){var t=this.getZoomingAttribute();this.updateBlazorDiagramProperties(t),this.eventHandler.updateViewPortSize(this.element),this.updateBlazorDiagramProperties(t,!0)},G.prototype.cutCommand=function(){this.cut()},G.prototype.cut=function(){this.commandHandler.cut()},G.prototype.addProcess=function(t,e){this.bpmnModule&&this.bpmnModule.addProcess(t,e,this)},G.prototype.removeProcess=function(t){this.bpmnModule&&this.bpmnModule.removeProcess(t,this)},G.prototype.pasteCommand=function(){this.paste()},G.prototype.paste=function(t){this.commandHandler.paste(t)},G.prototype.fitToPage=function(t){var e=this.getZoomingAttribute();this.updateBlazorDiagramProperties(e),this.scroller.fitToPage(t),this.updateBlazorDiagramProperties(e,!0)},G.prototype.bringIntoView=function(t){var e=this.getZoomingAttribute();this.updateBlazorDiagramProperties(e),this.scroller.bringIntoView(t,!0),this.updateBlazorDiagramProperties(e,!0)},G.prototype.bringToCenter=function(t){var e=this.getZoomingAttribute();this.updateBlazorDiagramProperties(e),this.scroller.bringToCenter(t),this.updateBlazorDiagramProperties(e,!0)},G.prototype.copyCommand=function(){this.copy()},G.prototype.copy=function(){return this.commandHandler.copy()},G.prototype.group=function(){1<this.selectedItems.nodes.concat(this.selectedItems.connectors).length&&(this.callBlazorModel=!1,this.insertBlazorDiagramObjects(this.selectedItems),this.commandHandler.group(),this.callBlazorModel=!0,this.commandHandler.getBlazorOldValues())},G.prototype.unGroup=function(){this.callBlazorModel=!1,this.insertBlazorDiagramObjects(this.selectedItems),this.commandHandler.unGroup(),this.callBlazorModel=!0,this.commandHandler.getBlazorOldValues()},G.prototype.sendToBack=function(){this.commandHandler.sendToBack()},G.prototype.setActiveLayer=function(t){t=this.commandHandler.getLayer(t);this.activeLayer=t},G.prototype.addLayer=function(t,e){this.commandHandler.addLayer(t,e)},G.prototype.removeLayer=function(t){this.commandHandler.removeLayer(t,N.isBlazor())},G.prototype.moveObjects=function(t,e){Q(this.layers);this.enableServerDataBinding(!1),this.commandHandler.moveObjects(t,e)},G.prototype.layerObjectUpdate=function(){},G.prototype.sendLayerBackward=function(t){this.layerObjectUpdate(),this.commandHandler.sendLayerBackward(t)},G.prototype.bringLayerForward=function(t){this.layerObjectUpdate(),this.commandHandler.bringLayerForward(t)},G.prototype.cloneLayer=function(t){this.commandHandler.cloneLayer(t)},G.prototype.bringToFront=function(){this.commandHandler.bringToFront()},G.prototype.moveForward=function(){this.commandHandler.sendForward()},G.prototype.sendBackward=function(){this.commandHandler.sendBackward()},G.prototype.getObject=function(t){return this.nameTable[""+t]},G.prototype.getNodeObject=function(t){return Q(this.nameTable[""+t])},G.prototype.getConnectorObject=function(t){return Q(this.nameTable[""+t])},G.prototype.getActiveLayer=function(){return this.activeLayer},G.prototype.nudgeCommand=function(t,e,i){var n;"object"!=typeof t&&0<(this.selectedItems.nodes.length||this.selectedItems.connectors.length)&&(n=void 0,e.type&&"KEYDOWN"===e.type&&(n=e.type),this.nudge(t,void 0,void 0,n))},G.prototype.nudge=function(t,e,i,n){var r=0,o=0,e=("Left"===t||"Right"===t?r=("Left"===t?-1:1)*(e||1):o=("Up"===t?-1:1)*(i||1),"KEYDOWN"===n&&(r*=5,o*=5),this.selectedItems),t=this.selectedItems.wrapper.children[0];t instanceof H?this.commandHandler.labelDrag(e.nodes[0],t,r,o):(i=Q(this.selectedItems),this.protectPropertyChange(!0),this.drag(e,r,o),this.protectPropertyChange(!1),n={type:"PositionChanged",redoObject:Q(this.selectedItems),undoObject:i,category:"Internal"},this.addHistoryEntry(n)),this.refreshCanvasLayers()},G.prototype.insertBlazorDiagramObjects=function(t){},G.prototype.drag=function(t,e,i){if((this.insertBlazorDiagramObjects(t),this.bpmnModule&&t instanceof _)&&this.bpmnModule.updateAnnotationDrag(t,this,e,i))return;if(t instanceof B){if(this.preventConnectorsUpdate=!0,t.nodes&&t.nodes.length){for(var n=0,r=t.nodes;n<r.length;n++){var o,a=r[n];this.callBlazorModel=!1,this.drag(a,e,i),a.parentId&&(o=this.nameTable[a.parentId]).isLane&&(1<t.nodes.length&&(this.preventConnectorsUpdate=!1),$r(o,this.nameTable[o.parentId],a,this))}this.callBlazorModel=!0}if(t.connectors&&t.connectors.length){this.callBlazorModel=!1;for(var s=0,h=t.connectors;s<h.length;s++){var d=h[s];this.drag(d,e,i),-1===this.selectionConnectorsList.indexOf(d)&&this.selectionConnectorsList.push(d)}this.callBlazorModel=!0}this.updateSelector(),this.diagramActions&Z.DiagramAction.DragUsingMouse&&this.updatePage()}else t instanceof _&&this.bpmnModule&&this.bpmnModule.updateAnnotationDrag(t,this,e,i),this.commandHandler.drag(t,e,i);if(t instanceof B){this.preventConnectorsUpdate=!1;for(var l=0,c=this.selectionConnectorsList;l<c.length;l++){var p=c[l];this.updateConnectorProperties(this.nameTable[p.id]),"Bpmn"===p.shape.type&&"Default"===p.shape.sequence&&"Sequence"===p.shape.flow&&this.commandHandler.updatePathElementOffset(p)}this.selectionConnectorsList=[]}!this.callBlazorModel||this.blazorActions&Z.BlazorAction.interaction||this.blazorActions&Z.BlazorAction.GroupClipboardInProcess||this.commandHandler.getBlazorOldValues()},G.prototype.disableStackContainerPadding=function(t,e){if(t instanceof Ed&&(t.considerPadding=e),t.children)for(var i=0,n=t.children;i<n.length;i++){var r=n[i];this.disableStackContainerPadding(r,!1)}},G.prototype.scale=function(t,e,i,n){this.disableStackContainerPadding(t.wrapper,!1),this.insertBlazorDiagramObjects(t);var r=!0;if((t=t.id?this.nameTable[t.id]||t:t)instanceof B){if(t.nodes&&t.nodes.length){this.callBlazorModel=!1;for(var o=0,a=t.nodes;o<a.length;o++){var s=a[o],r=this.commandHandler.scale(s,e,i,n,t);this.commandHandler.checkBoundaryConstraints(void 0,void 0,t.wrapper.bounds)||this.commandHandler.scale(s,1/e,1/i,n,t)}this.callBlazorModel=!0}if(t.connectors&&t.connectors.length){this.callBlazorModel=!1;for(var h=0,d=t.connectors;h<d.length;h++){var l=d[h];this.commandHandler.scale(l,e,i,n,t),this.commandHandler.checkBoundaryConstraints(void 0,void 0,t.wrapper.bounds)||this.commandHandler.scale(l,1/e,1/i,n,t)}this.callBlazorModel=!0}Cd(this,this.selectedItems)||this.updateSelector(),this.refreshCanvasLayers()}else this.commandHandler.scale(t,e,i,n,t.children?t:void 0);return!this.callBlazorModel||this.blazorActions&Z.BlazorAction.interaction||this.blazorActions&Z.BlazorAction.GroupClipboardInProcess||this.commandHandler.getBlazorOldValues(),this.disableStackContainerPadding(t.wrapper,!0),r},G.prototype.rotate=function(t,e,i,n){var r,o=[];if(!n){if((r=Q(t)).nodes&&0<r.nodes.length&&r.nodes[0].children){this.fromUndo||(this.rotateUsingButton=!0);for(var a=this.commandHandler.getAllDescendants(r.nodes[0],[]),s=0;s<a.length;s++){var h=this.commandHandler.cloneChild(a[parseInt(s.toString(),10)].id);o[a[parseInt(s.toString(),10)].id]=Q(h)}}e<0&&(e=(e+360)%360)}if(this.insertBlazorDiagramObjects(t),t=t.id?this.nameTable[t.id]||t:t)if(i=i||{x:t.wrapper.offsetX,y:t.wrapper.offsetY},t instanceof B){this.callBlazorModel=!1,t.rotateAngle+=e,t.wrapper.rotateAngle+=e;var d=up(t.wrapper);if(!(d=this.commandHandler.checkBoundaryConstraints(void 0,void 0,d)))return t.rotateAngle-=e,t.wrapper.rotateAngle-=e,d;var l=[];l=(l=l.concat(t.nodes)).concat(t.connectors),this.commandHandler.rotateObjects(t,l,e,i),this.callBlazorModel=!0}else this.commandHandler.rotateObjects(t,[t],e,i);return!this.callBlazorModel||this.blazorActions&Z.BlazorAction.interaction||this.commandHandler.getBlazorOldValues(),n||this.fromUndo||r.nodes&&0<r.nodes.length&&r.nodes[0].children&&(l={type:"RotationChanged",redoObject:Q(t),undoObject:Q(r),category:"Internal",childTable:o},this.commandHandler.addHistoryEntry(l),this.commandHandler.updateSelector()),d},G.prototype.dragSourceEnd=function(t,e,i){this.insertBlazorDiagramObjects(t),this.commandHandler.dragSourceEnd(t,e,i),this.callBlazorModel&&this.commandHandler.getBlazorOldValues()},G.prototype.dragTargetEnd=function(t,e,i){this.insertBlazorDiagramObjects(t),this.commandHandler.dragTargetEnd(t,e,i),this.callBlazorModel&&this.commandHandler.getBlazorOldValues()},G.prototype.findObjectsUnderMouse=function(t,e){return this.eventHandler.findObjectsUnderMouse(t,e)},G.prototype.findObjectUnderMouse=function(t,e,i){return this.eventHandler.findObjectUnderMouse(t,e,i)},G.prototype.findTargetObjectUnderMouse=function(t,e,i,n,r){return this.eventHandler.findTargetUnderMouse(t,e,i,n,r)},G.prototype.findElementUnderMouse=function(t,e,i,n){return this.eventHandler.findElementUnderMouse(t,e,i,n)},G.prototype.findActionToBeDone=function(t,e,i,n){return this.eventHandler.findActionToBeDone(t,e,i,n)},G.prototype.updateConnectorPort=function(t){if(t.ports.length)for(var e=0,i=t.ports;e<i.length;e++){var n=i[e],r=this.getWrapper(t.wrapper,n.id);t.initPortWrapper(n,t.intermediatePoints,t.wrapper.bounds,r)}t.wrapper.measure(new j(t.wrapper.width,t.wrapper.height)),t.wrapper.arrange(t.wrapper.desiredSize)},G.prototype.getTool=function(t){var e=Dp(this.getCustomTool);return e&&(e=e(t))?e:this.eventHandler.getTool(t)},G.prototype.getCursor=function(t,e){var i=Dp(this.getCustomCursor);if(i&&(i=i(t,e)))return i;if(this.customCursor.length)for(var n=0;n<this.customCursor.length;n++)if(this.customCursor[parseInt(n.toString(),10)].action===t)return this.customCursor[parseInt(n.toString(),10)].cursor;return this.eventHandler.getCursor(t)},G.prototype.initHistory=function(){this.undoRedoModule&&this.undoRedoModule.initHistory(this)},G.prototype.addHistoryEntry=function(t,e){var i;!(this.undoRedoModule&&this.constraints&Z.DiagramConstraints.UndoRedo)||this.currentSymbol&&!this.checkCurrentSymbol(this.currentSymbol,t)||t.undoObject&&"helper"===t.undoObject.id||(i=this.undoRedoModule.addHistoryEntry(t,this),"StartGroup"!==t.type&&"EndGroup"!==t.type&&i&&this.historyChangeTrigger(t,"CustomAction",e))},G.prototype.checkCurrentSymbol=function(t,e){var i,n=!1;return e.undoObject&&e.redoObject&&(i=e.undoObject,!(!(e=e.undoObject).id||!i.id||e.id===t.id||i.id===t.id))||n},G.prototype.addCustomHistoryEntry=function(t){},G.prototype.historyChangeTrigger=function(t,e,i){var n={},r="oldValue",o="newValue",a=[];if("Internal"===t.category){switch(t&&t.redoObject&&t.redoObject.nodes instanceof Array&&t.redoObject.connectors instanceof Array?a=t.redoObject.nodes.concat(t.redoObject.connectors):t.redoObject&&a.push(t.redoObject),n.type=t.type,t.type){case"PositionChanged":"Undo"===e?(n[r]={offsetX:t.redoObject.offsetX,offsetY:t.redoObject.offsetY},n[o]={offsetX:t.undoObject.offsetX,offsetY:t.undoObject.offsetY}):(n[r]={offsetX:t.undoObject.offsetX,offsetY:t.undoObject.offsetY},n[o]={offsetX:t.redoObject.offsetX,offsetY:t.redoObject.offsetY});break;case"RotationChanged":"Undo"===e?(n[r]={rotateAngle:t.redoObject.rotateAngle},n[o]={rotateAngle:t.undoObject.rotateAngle}):(n[r]={rotateAngle:t.undoObject.rotateAngle},n[o]={rotateAngle:t.redoObject.rotateAngle});break;case"SizeChanged":"Undo"===e?(n[r]={offsetX:t.redoObject.offsetX,offsetY:t.redoObject.offsetY,width:t.redoObject.width,height:t.redoObject.height},n[o]={offsetX:t.undoObject.offsetX,offsetY:t.undoObject.offsetY,width:t.undoObject.width,height:t.undoObject.height}):(n[r]={offsetX:t.undoObject.offsetX,offsetY:t.undoObject.offsetY,width:t.undoObject.width,height:t.undoObject.height},n[o]={offsetX:t.redoObject.offsetX,offsetY:t.redoObject.offsetY,width:t.redoObject.width,height:t.redoObject.height});break;case"CollectionChanged":n[t.changeType]=a;break;case"ConnectionChanged":"Undo"===e?(n[r]={offsetX:t.redoObject.offsetX,offsetY:t.redoObject.offsetY},n[o]={offsetX:t.undoObject.offsetX,offsetY:t.undoObject.offsetY}):(n[r]={offsetX:t.undoObject.offsetX,offsetY:t.undoObject.offsetY},n[o]={offsetX:t.redoObject.offsetX,offsetY:t.redoObject.offsetY})}var s=[],h=[];if(void 0===i&&"PropertyChanged"===t.type){for(var d=0;d<Object.keys(t.undoObject).length;d++)if("nodes"===Object.keys(t.undoObject)[parseInt(d.toString(),10)])for(var l=0,c=Object.keys(t.undoObject.nodes);l<c.length;l++){var p=c[l],g=parseInt(p,10);s.push(this.nodes[parseInt(g.toString(),10)].id)}for(d=0;d<Object.keys(t.undoObject).length;d++)if("connectors"===Object.keys(t.undoObject)[parseInt(d.toString(),10)])for(var u=0,m=Object.keys(t.undoObject.connectors);u<m.length;u++){p=m[u],g=parseInt(p,10);h.push(this.connectors[parseInt(g.toString(),10)].id)}i=s.concat(h)}i={cause:t.category,source:a,change:n,action:e,sourceId:i};a.length&&this.triggerEvent(Z.DiagramEvent.historyChange,i)}},G.prototype.startGroupAction=function(){this.diagramActions&Z.DiagramAction.UndoRedo||this.addHistoryEntry({type:"StartGroup",category:"Internal"})},G.prototype.endGroupAction=function(){this.diagramActions&Z.DiagramAction.UndoRedo||this.addHistoryEntry({type:"EndGroup",category:"Internal"})},G.prototype.undo=function(){this.canEnableBlazorObject=!0,this.callBlazorModel=!1,this.undoRedoModule&&this.constraints&Z.DiagramConstraints.UndoRedo?(this.isUndo=!0,this.undoRedoModule.undo(this),this.isUndo=!1):this.constraints&Z.DiagramConstraints.UndoRedo&&console.warn('[WARNING] :: Module "UndoRedo" is not available in Diagram component! You either misspelled the module name or forgot to load it.'),this.commandHandler.getBlazorOldValues(),this.callBlazorModel=!0,this.canEnableBlazorObject=!1},G.prototype.redo=function(){this.canEnableBlazorObject=!0,this.callBlazorModel=!1,this.undoRedoModule&&this.constraints&Z.DiagramConstraints.UndoRedo?this.undoRedoModule.redo(this):this.constraints&Z.DiagramConstraints.UndoRedo&&console.warn('[WARNING] :: Module "UndoRedo" is not available in Diagram component! You either misspelled the module name or forgot to load it.'),this.commandHandler.getBlazorOldValues(),this.callBlazorModel=!0,this.canEnableBlazorObject=!1},G.prototype.getBlazorDiagramObjects=function(t){if(t)for(var e=0;e<t.length;e++)this.insertBlazorDiagramObjects(t[parseInt(e.toString(),10)]);else this.insertBlazorDiagramObjects(this.selectedItems);this.callBlazorModel=!1,this.canEnableBlazorObject=!0},G.prototype.align=function(t,e,i){this.getBlazorDiagramObjects(e),e=e||(e=[]).concat(this.selectedItems.nodes,this.selectedItems.connectors),this.diagramActions=this.diagramActions|Z.DiagramAction.PublicMethod,this.commandHandler.align(e,t,i||"Object"),this.commandHandler.getBlazorOldValues(),this.callBlazorModel=!0,this.canEnableBlazorObject=!1},G.prototype.distribute=function(t,e){this.getBlazorDiagramObjects(e),e=e||(e=[]).concat(this.selectedItems.nodes,this.selectedItems.connectors),this.diagramActions=this.diagramActions|Z.DiagramAction.PublicMethod,this.commandHandler.distribute(e,t),this.commandHandler.getBlazorOldValues(),this.canEnableBlazorObject=!1,this.callBlazorModel=!0},G.prototype.sameSize=function(t,e){this.getBlazorDiagramObjects(e),e=e||(e=[]).concat(this.selectedItems.nodes,this.selectedItems.connectors),this.diagramActions=this.diagramActions|Z.DiagramAction.PublicMethod,this.commandHandler.sameSize(e,t),this.commandHandler.getBlazorOldValues(),this.canEnableBlazorObject=!1,this.callBlazorModel=!0},G.prototype.updateBlazorDiagramProperties=function(t,e){},G.prototype.getZoomingAttribute=function(){var t=[];return t.push("scrollSettings"),t.push("snapSettings"),t},G.prototype.zoom=function(t,e){var i=this.getZoomingAttribute();this.updateBlazorDiagramProperties(i),this.scroller.zoom(t,0,0,e),this.blazorActions&Z.BlazorAction.interaction||this.updateBlazorDiagramProperties(i,!0)},G.prototype.zoomTo=function(t){var e=this.getZoomingAttribute(),i=(this.updateBlazorDiagramProperties(e),t.zoomFactor||.2),i="ZoomOut"===t.type?1/(1+i):1+i;this.scroller.zoom(i,0,0,t.focusPoint),this.updateBlazorDiagramProperties(e,!0)},G.prototype.pan=function(t,e,i,n){var r=this.getZoomingAttribute();this.updateBlazorDiagramProperties(r),this.setCursor("grabbing"),this.scroller.zoom(1,t,e,i,n),this.updateBlazorDiagramProperties(r,!0)},G.prototype.reset=function(){var t=this.getZoomingAttribute();this.updateBlazorDiagramProperties(t),this.scroller.zoom(1/this.scroller.currentZoom,-this.scroller.horizontalOffset,-this.scroller.verticalOffset,{x:0,y:0}),this.updateBlazorDiagramProperties(t,!0)},G.prototype.resetSegments=function(){if(this.constraints&Z.DiagramConstraints.LineRouting&&this.lineRoutingModule)this.lineRoutingModule.lineRouting(this);else{this.protectPropertyChange(!0);for(var t=void 0,e=0;e<this.connectors.length;e++)(t=this.connectors[parseInt(e.toString(),10)]).segments=[],this.connectorPropertyChange(t,{},{segments:t.segments}),this.avoidLineOverlappingModule&&this.avoidLineOverlappingModule.removeConnector(t);this.protectPropertyChange(!1)}},G.prototype.setBlazorDiagramProps=function(t){var e=this.getZoomingAttribute();t?this.updateBlazorDiagramProperties(e):this.updateBlazorDiagramProperties(e,!0)},G.prototype.triggerEvent=function(e,i){return iu(this,void 0,void 0,function(){return nu(this,function(t){switch(t.label){case 0:return i&&this.updateEventValue(i),[4,this.trigger(Z.DiagramEvent[""+e],i)];case 1:return[2,t.sent()]}})})},G.prototype.updateEventValue=function(t){var e=t.element;t.element&&e instanceof B&&e.nodes.length+e.connectors.length===1&&(t.element=(1===e.nodes.length?e.nodes:e.connectors)[0])},G.prototype.addNodeToLane=function(t,e,i){if(this.nameTable[""+e]){var n=this.nameTable[""+e];if(this.protectPropertyChange(!0),this.undoRedoModule&&this.historyManager.startGroupAction(),this.nameTable[t.id]||(t.offsetX=n.wrapper.bounds.width+n.wrapper.bounds.x,t.offsetY=n.wrapper.bounds.height+n.wrapper.bounds.y,t=this.add(t)),t.parentId="",n.shape.phases.length)for(var r=0;r<n.shape.phases.length;r++){h=e+i+r;if(this.nameTable[""+h]&&this.nameTable[""+h].isLane){var o,a=this.nameTable[""+h].wrapper.bounds,s={x:a.x+(a.x-n.wrapper.bounds.x+t.margin.left+t.wrapper.bounds.width/2),y:a.y+n.wrapper.bounds.y-t.margin.top};if("Horizontal"===n.shape.orientation?s.y=a.y:(s.x=a.x,o=this.nameTable[""+h].parentId+n.shape.lanes[0].id+"_0_header",s.y=a.y+(n.wrapper.bounds.y-this.nameTable[o].wrapper.bounds.height+t.margin.top+t.wrapper.bounds.height/2)),h===e+i+(n.shape.phases.length-1)||a.containsPoint(s)){this.commandHandler.updateLaneChildrenZindex(t,this.nameTable[""+h]),qr(this,this.nameTable[""+h],t,void 0,!0),$r(this.nameTable[""+h],n,t,this);break}}}else{var h=e+i+"0";this.nameTable[""+h]&&(this.commandHandler.updateLaneChildrenZindex(t,this.nameTable[""+h]),qr(this,this.nameTable[""+h],t,void 0,!0),$r(this.nameTable[""+h],n,t,this))}this.undoRedoModule&&this.historyManager.endGroupAction(),this.protectPropertyChange(!1)}this.updateDiagramElementQuad()},G.prototype.showTooltip=function(t){var e=up((t=t&&t.id&&!t.wrapper?this.nameTable[t.id]:t).wrapper),i={x:0,y:0},e=t.tooltip.content||"X:"+Math.round(e.x)+" Y:"+Math.round(e.y);t&&"Custom"===t.tooltip.openOn&&(i=t instanceof _?{x:t.offsetX+t.width/2,y:t.offsetY+t.height/2}:{x:t.targetPoint.x,y:t.targetPoint.x},this.commandHandler.showTooltip(t,i,e,"SelectTool",!0))},G.prototype.hideTooltip=function(t){t&&"Custom"===t.tooltip.openOn&&this.tooltipObject.close()},G.prototype.addNode=function(t,e){return this.add(t,e)},G.prototype.addChildToGroup=function(t,e){var i=this.allowServerDataBinding,n=(this.enableServerDataBinding(!1),this.isProtectedOnChange),r=(this.protectPropertyChange(!0),t=this.getObject(t.id),!(this.diagramActions&Z.DiagramAction.UndoRedo||this.diagramActions&Z.DiagramAction.Group||this.diagramActions&Z.DiagramAction.PreventHistory)),o=(r&&this.startGroupAction(),this.addChild(t,e)),r=(r&&((r={})[""+o]=Q(this.getObject(o)),o={type:"AddChildToGroupNode",changeType:"Insert",undoObject:Q(t),redoObject:Q(t),category:"Internal",objectId:o,childTable:r},this.addHistoryEntry(o),this.endGroupAction()),this.nameTable[e]||e),o=document.getElementById(r.id+"_groupElement"),e=document.getElementById(t.id+"_groupElement");e&&o&&e.appendChild(o),this.protectPropertyChange(n),this.enableServerDataBinding(i),this.updateSelector()},G.prototype.removeChildFromGroup=function(t,e){var i=this.allowServerDataBinding,n=(this.enableServerDataBinding(!1),this.isProtectedOnChange),r=(this.protectPropertyChange(!0),Q(t=this.getObject(t.id))),o=!(this.diagramActions&Z.DiagramAction.UndoRedo||this.diagramActions&Z.DiagramAction.Group||this.diagramActions&Z.DiagramAction.PreventHistory),a=(o&&this.startGroupAction(),this.removeChild(t,e)),a=(o&&((o={})[""+a]=Q(this.getObject(a)),r={type:"RemoveChildFromGroupNode",changeType:"Remove",undoObject:Q(r),redoObject:Q(t),category:"Internal",objectId:a,childTable:o},this.addHistoryEntry(r),this.endGroupAction()),this.nameTable[e]||e),o=a.zIndex,r=this.layers.indexOf(this.commandHandler.getObjectLayer(a.id)),e=this.layers[parseInt(r.toString(),10)].objects[o+1],r=document.getElementById(e+"_groupElement"),o=document.getElementById(a.id+"_groupElement"),a=document.getElementById(t.id+"_groupElement");a&&o&&(e&&r?a.contains(r)?a.insertBefore(o,r):a.parentNode.contains(r)&&r.parentElement===a.parentElement?a.parentNode.insertBefore(o,r):a.parentNode.appendChild(o):a.parentNode.appendChild(o)),this.protectPropertyChange(n),this.enableServerDataBinding(i),this.updateSelector()},G.prototype.getHistoryStack=function(t){var e=[],i=t?this.historyManager.undoStack:this.historyManager.redoStack;if(void 0!==this.historyManager.stackLimit){for(var n=i.length-1;0<=n;n--)if(e.push(i[parseInt(n.toString(),10)]),e.length>this.historyManager.stackLimit)return e}else e=i;return e},G.prototype.getEdges=function(t){return t.outEdge?this.nameTable[t.id].outEdges:this.nameTable[t.id].inEdges},G.prototype.getParentId=function(t){return this.nameTable[""+t].parentId},G.prototype.addConnector=function(t){return this.add(t)},G.prototype.UpdateBlazorDiagramModelCollection=function(t,e,i,n){},G.prototype.UpdateBlazorDiagramModel=function(t,e,i,n){},G.prototype.UpdateBlazorLabelOrPortObjects=function(t,e,i,n){},G.prototype.addBlazorDiagramObjects=function(){},G.prototype.removeNodeEdges=function(t,e,i){var t=this.nameTable[""+t],n=i?t.outEdges:t.inEdges;if(0<n.length)for(var r=0;r<n.length;r++)n[parseInt(r.toString(),10)]===e&&n.splice(r,1)},G.prototype.insertBlazorConnector=function(t){},G.prototype.add=function(t,e){var i,n=this.isProtectedOnChange,r=(this.protectPropertyChange(!0),!1);if(t){var o=void 0;if(o={element:t=Q(t),cause:this.diagramActions,diagramAction:this.getDiagramAction(this.diagramActions),state:"Changing",type:"Addition",cancel:!1},this.parentObject&&(o.parentId=this.parentObject.id),"helper"===t.id||this.diagramActions&Z.DiagramAction.PreventCollectionChangeOnDragOver||this.triggerEvent(Z.DiagramEvent.collectionChange,o),o.cancel&&this.drawingObject){this.removeElements(o.element),this.tooltipObject.close();var a=this.getObject(o.element.sourceID),s=void 0;if(ld(o.element)===W){if(o.element.sourceID&&(this.removeNodeEdges(o.element.sourceID,o.element.id,!0),0<a.ports.length)){for(var h=0;h<a.ports.length;h++){var d=a.ports[parseInt(h.toString(),10)];d.id===o.element.sourcePortID&&(s=!(0<d.outEdges.length))}this.removePortEdges(a,o.element.sourcePortID,o.element.id,s)}o.element.targetID&&this.removeNodeEdges(o.element.targetID,o.element.id,!1)}}this.diagramActions=this.diagramActions|Z.DiagramAction.PublicMethod,t.id=t.id||q();var l=this.activeLayer;if(!o.cancel&&l&&!l.lock){if(l.objects.indexOf(t.id)<0&&!l.lock&&(l.visible||(l.visible=!0,this.dataBind()),l.objects.push(t.id)),ld(t)===W)(i=new W(this,"connectors",t,!0)).status="New",this.nameTable[i.targetID]&&"TextAnnotation"===this.nameTable[i.targetID].shape.shape&&(i.isBpmnAnnotationConnector=!0,i.constraints=i.constraints&~Z.ConnectorConstraints.Delete),sh(i,t,this.connectorDefaults),this.connectors.push(i),this.initObject(i),!1===t.visible&&this.updateElementVisibility(i.wrapper,i,t.visible),this.updateEdges(i),this.insertBlazorConnector(i);else{if(sh(i=new _(this,"nodes",t,!0),t,this.nodeDefaults),i.parentId=t.parentId||i.parentId,i.umlIndex=t.umlIndex,i.status="New",(r="TextAnnotation"===i.shape.shape)&&!t.isTextAnnotationCopied&&(i.inEdges=t.inEdges||i.inEdges),this.nodes.push(i),this.initObject(i,l,void 0,e),r&&this.bpmnModule)for(h=0;h<this.bpmnModule.bpmnTextAnnotationConnector.length;h++)null===this.bpmnModule.bpmnTextAnnotationConnector[parseInt(h.toString(),10)].wrapper&&this.initConnectors(this.bpmnModule.bpmnTextAnnotationConnector[parseInt(h.toString(),10)],void 0,!0);if(this.updateTemplate(),this.bpmnModule&&i.shape.activity&&i.shape.activity.subProcess.processes&&i.shape.activity.subProcess.processes.length&&this.bpmnModule.updateDocks(i,this),this.lineRoutingModule&&this.constraints&Z.DiagramConstraints.LineRouting)for(var c=this.spatialSearch.findObjects(i.wrapper.outerBounds),h=0;h<c.length;h++){var p=c[parseInt(h.toString(),10)];p instanceof W&&this.connectorPropertyChange(p,{},{sourceID:p.sourceID,targetID:p.targetID,sourcePortID:p.sourcePortID,targetPortID:p.targetPortID,sourcePoint:p.sourcePoint,targetPoint:p.targetPoint})}else this.constraints&Z.DiagramConstraints.LineRouting&&console.warn('[WARNING] :: Module "LineRouting" is not available in Diagram component! You either misspelled the module name or forgot to load it.');-1<i.umlIndex&&t.parentId&&this.nameTable[t.parentId]&&"UmlClassifier"===this.nameTable[t.parentId].shape.type&&((l=this.nameTable[t.parentId]).children.splice(i.umlIndex,0,i.id),l.wrapper.children.splice(i.umlIndex,0,i.wrapper),l.wrapper.measure(new j),l.wrapper.arrange(l.wrapper.desiredSize),this.updateDiagramObject(l))}o={element:i,cause:this.diagramActions,diagramAction:this.getDiagramAction(this.diagramActions),state:"Changed",type:"Addition",cancel:!1};this.parentObject&&(o.parentId=this.parentObject.id),"helper"===t.id||this.diagramActions&Z.DiagramAction.PreventCollectionChangeOnDragOver||this.triggerEvent(Z.DiagramEvent.collectionChange,o),this.diagramActions&Z.DiagramAction.UndoRedo||this.diagramActions&Z.DiagramAction.Group||this.diagramActions&Z.DiagramAction.PreventHistory||(e={type:"CollectionChanged",changeType:"Insert",undoObject:Q(t),redoObject:Q(t),category:"Internal"},this.addHistoryEntry(e)),this.parentObject=void 0,"SVG"===this.mode&&(this.updateSvgNodes(i),this.updateTextElementValue(i),this.updateDiagramObject(i),r&&(l=this.nameTable[i.inEdges[0]],this.updateDiagramObject(l)),i.shape.activity&&i.shape.activity.subProcess.processes&&i.shape.activity.subProcess.processes.length&&this.updateProcesses(i),this.updateBridging())}}if(this.protectPropertyChange(n),this.resetDiagramActions(Z.DiagramAction.PublicMethod),i&&1<this.layers.length&&this.moveNode(i),this.views)for(var g=0,u=this.views;g<u.length;g++){var m=u[g],m=this.views[""+m];m instanceof G||this.refreshCanvasDiagramLayer(m)}return this.renderReactTemplates(),i},G.prototype.addElements=function(t){for(var e=0;e<t.length;e++)this.add(t[parseInt(e.toString(),10)]);this.pathDataStorage&&this.pathDataStorage.clear()},G.prototype.getPathData=function(t){return this.pathDataStorage||(this.pathDataStorage=new Map),this.pathDataStorage.has(t)?this.pathDataStorage.get(t):[]},G.prototype.setPathData=function(t,e){0===(this.pathDataStorage.get(t)||[]).length&&this.pathDataStorage.set(t,e)},G.prototype.updateSvgNodes=function(t){if(t.children)for(var e=0,i=t.children;e<i.length;e++){var n=i[e];this.nameTable[""+n]&&this.nameTable[""+n].parentId&&(n=Y(n+"_groupElement",this.element.id))&&n.parentNode.removeChild(n)}},G.prototype.updateProcesses=function(t){if(this.bpmnModule&&t&&t.shape&&t.shape.activity&&t.shape.activity.subProcess.processes&&t.shape.activity.subProcess.processes.length){var e=t.shape.activity.subProcess.processes;this.moveSvgNode(t.id);for(var i=0,n=e;i<n.length;i++)for(var r=n[i],o=(this.moveSvgNode(r),[]),a=(o=o.concat(this.nameTable[""+r].outEdges,this.nameTable[""+r].inEdges)).length-1;0<=a;a--)this.moveSvgNode(o[parseInt(a.toString(),10)]);for(var s=0,h=e;s<h.length;s++){r=h[s];this.nameTable[""+r].shape.activity.subProcess.processes&&this.nameTable[""+r].shape.activity.subProcess.processes.length&&this.updateProcesses(this.nameTable[""+r])}}else this.moveSvgNode(t.id)},G.prototype.moveSvgNode=function(t){var t=Y(t+"_groupElement",this.element.id),e=t.parentElement;t.parentNode.removeChild(t),e.appendChild(t)},G.prototype.addTextAnnotation=function(t,e){this.bpmnModule&&this.getBPMNTextAnnotation(e,this,t,!0)},G.prototype.spliceConnectorEdges=function(t,e){var i=[],n=e?this.nameTable[t.sourceID]:this.nameTable[t.targetID];if(n){for(var r=(i=e?n.outEdges:n.inEdges).length-1;0<=r;r--)i[parseInt(r.toString(),10)]===t.id&&i.splice(r,1);for(var o=0;n.ports&&o<n.ports.length;o++){var a=!e;this.removePortEdges(n,n.ports[parseInt(o.toString(),10)].id,t.id,a)}}},G.prototype.removeDependentConnector=function(t){if(t)for(var e,i,n,r,o=[],a=(o=o.concat(t.outEdges,t.inEdges)).length-1;0<=a;a--)(r=this.nameTable[o[parseInt(a.toString(),10)]])&&(this.connectorTable[r.id]=Q(r),r.isBpmnAnnotationConnector?(e=this.nameTable[r.targetID],this.removeObjectsFromLayer(r),-1!==(i=this.connectors.indexOf(r))&&this.connectors.splice(i,1),this.removeElements(r),this.removeFromAQuad(r),delete this.nameTable[r.id],(i=this.nameTable[r.sourceID])&&-1!==(n=i.outEdges.indexOf(r.id))&&i.outEdges.splice(n,1),t.id!==r.targetID&&this.remove(e)):this.remove(r))},G.prototype.removeObjectsFromLayer=function(t){if(t.children)for(var e=0;e<t.children.length;e++){var i=this.nameTable[t.children[parseInt(e.toString(),10)]];i&&this.removeObjectsFromLayer(i)}var n=this.layers.indexOf(this.commandHandler.getObjectLayer(t.id)),r=this.layers[parseInt(n.toString(),10)].objects.indexOf(t.id);-1<r&&(this.commandHandler.updateLayersZindexTable(n),so(this,t)&&this.unSelect(t),this.layers[parseInt(n.toString(),10)].objects.splice(r,1),delete this.layers[parseInt(n.toString(),10)].zIndexTable[this.nameTable[t.id].zIndex])},G.prototype.removeElements=function(t){if("SVG"===this.mode||"Canvas"===this.mode&&"Native"===t.shape.type){var e=Y(t.id+"_groupElement",this.element.id),i=t;if(i.ports&&0<i.ports.length)for(var n=0;n<i.ports.length;n++){var r=i.ports[parseInt(n.toString(),10)],r=Y(i.id+"_"+r.id+"_groupElement",this.element.id);r&&r.parentNode.removeChild(r)}e&&e.parentNode.removeChild(e)}if(this.refreshCanvasLayers(),t.wrapper){var o=t.wrapper.children,a=void 0;if(o)for(n=0;n<o.length;n++){if(o[parseInt(n.toString(),10)]instanceof be||o[parseInt(n.toString(),10)].id&&0<o[parseInt(n.toString(),10)].id.indexOf("icon_content")){0<o[parseInt(n.toString(),10)].id.indexOf("icon_content")&&"SVG"===this.mode&&((a=Y(o[parseInt(n.toString(),10)].id+"_shape_groupElement",this.element.id))&&a.parentNode.removeChild(a),a=Y(o[parseInt(n.toString(),10)].id+"_rect_groupElement",this.element.id))&&a.parentNode.removeChild(a);for(var s=0,h=this.views;s<h.length;s++){var d=h[s],l=(rp(o[parseInt(n.toString(),10)].id+"_groupElement",d),this.scroller.removeCollection.indexOf(t.id));this.scroller.removeCollection.splice(l,1)}}else if(o[parseInt(n.toString(),10)]instanceof an)for(var c=0,p=this.views;c<p.length;c++){var d=p[c],g=(rp(t.id+"_html_element",d),rp(o[parseInt(n.toString(),10)].id+"_html_element",d),!0),u=this.nameTable[t.parentId];(g=(this.isAngular||this.isReact||this.isVue)&&(u&&u.isLane||this.constraints&Z.DiagramConstraints.Virtualization)?!1:g)&&(this.clearTemplate(["nodeTemplate_"+t.id]),o[parseInt(n.toString(),10)].annotationId)&&this.clearTemplate(["annotationTemplate_"+t.id+o[parseInt(n.toString(),10)].annotationId])}_h(o[parseInt(n.toString(),10)].id)}}},G.prototype.removeCommand=function(){this.remove()},G.prototype.remove=function(t){var e,i=(i=[]).concat(this.selectedItems.nodes,this.selectedItems.connectors),n=!1;if(t){if(t=this.nameTable[t.id],this.insertBlazorConnector(t),t&&(Sn(t)||this.diagramActions&Z.DiagramAction.Clear)&&(e={element:t,cause:this.diagramActions,diagramAction:this.getDiagramAction(this.diagramActions),state:"Changing",type:"Removal",cancel:!1},this.diagramActions&Z.DiagramAction.Clear||"helper"===t.id||this.triggerEvent(Z.DiagramEvent.collectionChange,e),!e.cancel)){if(Sn(t)&&t&&t.shape&&"SwimLane"===t.shape.type)for(var r,o,a,s,h,d=this,l=t.wrapper.children[0].rows,c=0;c<l.length;c++)for(o=0;o<l[parseInt(c.toString(),10)].cells.length;o++){if((s=l[parseInt(c.toString(),10)].cells[parseInt(o.toString(),10)].children[0])&&s.children)for(a=s.children.length-1;0<=a;a--)s.children[parseInt(a.toString(),10)].children&&(h=d.nameTable[s.children[parseInt(a.toString(),10)].id])&&(h.isLane?zr(d,h):(d.removeDependentConnector(h),d.diagramActions|=Z.DiagramAction.PreventHistory,h.constraints&Z.NodeConstraints.Delete?d.remove(h):Yr(d,h,{},!1),d.diagramActions&=~Z.DiagramAction.PreventHistory));s&&(r=d.nameTable[s.id])&&zr(d,r)}this.diagramActions&Z.DiagramAction.UndoRedo||this.diagramActions&Z.DiagramAction.PreventHistory||!(t instanceof _||t instanceof W)||(p={type:"CollectionChanged",changeType:"Remove",undoObject:Q(t),redoObject:Q(t),category:"Internal"},this.diagramActions&Z.DiagramAction.Clear||t.children&&!t.isLane&&!t.isPhase&&0<t.children.length&&this.undoRedoModule&&"None"===this.layout.type&&(this.historyManager.startGroupAction(),n=!0),(t instanceof _||t instanceof W)&&this.deleteDependentConnector&&this.removeDependentConnector(t),t.isLane)||t.isPhase||this.diagramActions&Z.DiagramAction.Clear||this.isStackChild(t)||this.addHistoryEntry(p),"TextAnnotation"===t.shape.shape&&this.removeDependentConnector(t),!t.children||t.isLane||t.isPhase||this.diagramActions&Z.DiagramAction.UndoRedo&&N.isBlazor()||this.deleteGroup(t),t.parentId&&(this.deleteChild(t,void 0,!0),this.nameTable[t.parentId])&&"UmlClassifier"===this.nameTable[t.parentId].shape.type&&(this.updateDiagramObject(this.nameTable[t.parentId]),this.updateConnectorEdges(this.nameTable[t.parentId]));var p,g=void 0,u=(this.diagramActions=this.diagramActions|Z.DiagramAction.PublicMethod,this.nameTable[t.id]);u instanceof _?("Bpmn"===u.shape.type&&this.bpmnModule&&this.bpmnModule.removeBpmnProcesses(u,this),(u.isLane||u.isPhase||"SwimLane"===u.shape.type)&&((v=u.isLane||u.isPhase?this.nameTable[u.parentId]:this.nameTable[u.id]).wrapper.children[0],u.isLane?kr(this,u,v):u.isPhase&&Nr(this,u,v)),-1!==(g=this.nodes.indexOf(u))&&(this.crudDeleteNodes.push(this.nameTable[u.id]),this.nodes.splice(g,1),this.updateNodeEdges(u))):(-1!==(g=this.connectors.indexOf(u))&&(this.crudDeleteNodes.push(this.nameTable[u.id]),this.connectors.splice(g,1)),this.updateEdges(u),this.spliceConnectorEdges(t,!0),this.spliceConnectorEdges(t,!1)),this.isServerUpdate||this.blazorActions&Z.BlazorAction.GroupClipboardInProcess||this.commandHandler.getBlazorOldValues(),n&&this.historyManager.endGroupAction(),so(this,u)&&this.unSelect(u),u.isPhase||(this.removeObjectsFromLayer(t),this.currentDrawingObject&&(this.currentDrawingObject.wrapper=void 0),delete this.nameTable[t.id],0<i.length&&i[0].id===u.id&&u.parentId&&(g=this.nameTable[u.parentId])&&g.isLane&&"SwimLane"===this.nameTable[g.parentId].shape.type&&Lr(this,v=this.nameTable[g.parentId],g,u),this.removeElements(u),this.updateBridging(),"SVG"!==this.mode&&this.refreshDiagramLayer(),this.diagramActions&Z.DiagramAction.Clear)||(this.removeFromAQuad(u),e={element:t,cause:this.diagramActions,diagramAction:this.getDiagramAction(this.diagramActions),state:"Changed",type:"Removal",cancel:!1},"helper"!==t.id&&this.triggerEvent(Z.DiagramEvent.collectionChange,e),this.resetTool())}}else if(0<i.length){this.undoRedoModule&&(this.historyManager.startGroupAction(),this.blazorActions|=Z.BlazorAction.GroupingInProgress,n=!0);for(var m=0;m<i.length;m++){var f=i[parseInt(m.toString(),10)],y=this.nameTable[f.parentId];this.nameTable[i[parseInt(m.toString(),10)].id]&&(!(y&&y.shape instanceof Lc)||f.isPhase||f.isLane&&(f=y.shape.header.id?y.shape.header.height:0,this.selectedItems.wrapper.bounds.x<=y.wrapper.bounds.x&&this.selectedItems.wrapper.bounds.width>=y.wrapper.bounds.width&&"Horizontal"===y.shape.orientation||this.selectedItems.wrapper.bounds.y<=y.wrapper.bounds.y+f&&this.selectedItems.wrapper.bounds.height>=y.wrapper.bounds.height-f&&"Vertical"===y.shape.orientation)&&(Sn(y)||1<y.shape.lanes.length))&&this.remove(i[parseInt(m.toString(),10)])}n&&(this.blazorActions&=~Z.BlazorAction.GroupingInProgress,this.isServerUpdate=!0,this.commandHandler.getBlazorOldValues(),this.UpdateBlazorDiagramModelCollection(void 0,void 0,void 0,!0),this.historyManager.endGroupAction(),this.isServerUpdate=!1),this.clearSelection()}if(t&&(Sn(t)||this.diagramActions&Z.DiagramAction.Clear)||this.diagramActions&Z.DiagramAction.UndoRedo||this.diagramActions&Z.DiagramAction.PreventHistory||!(t instanceof _||t instanceof W)||(p={type:"ConnectionChanged",undoObject:Q(t),redoObject:Q(t),category:"Internal"},t.isLane)||t.isPhase||this.diagramActions&Z.DiagramAction.Clear||this.isStackChild(t)||this.addHistoryEntry(p),this.tooltipObject.close(),t&&"helper"!==t.id&&this.lineRoutingModule&&this.constraints&Z.DiagramConstraints.LineRouting&&t instanceof _&&"ComplexHierarchicalTree"!==this.layout.type){var v=up(t.wrapper),g=(v.Inflate(40),this.spatialSearch.findObjects(v));this.lineRoutingModule.renderVirtualRegion(this,!0);for(var b=0,S=g;b<S.length;b++){var w=S[b];w instanceof W&&"Orthogonal"===w.type&&this.lineRoutingModule.refreshConnectorSegments(this,w,!0)}}},G.prototype.isStackChild=function(t){var e,i=this.nameTable[t.parentId];return t&&t.parentId&&i.container&&"Stack"===i.container.type&&"UmlClassifier"!==this.nameTable[t.parentId].shape.type&&(e=!0,i={sourceIndex:i.wrapper.children.indexOf(t.wrapper),source:t,target:void 0,targetIndex:void 0},this.diagramActions&Z.DiagramAction.UndoRedo||this.addHistoryEntry({type:"StackChildPositionChanged",redoObject:{sourceIndex:void 0,source:t,target:void 0,targetIndex:void 0},undoObject:i,category:"Internal"})),e},G.prototype.deleteChild=function(t,e,i){var n;if(e=e?this.nameTable[e.id]:this.nameTable[t.parentId],n="string"==typeof t?t:t.id,e&&e.children){for(var r=0;r<e.children.length;r++)if(e.children[parseInt(r.toString(),10)]===n){e.children.splice(r,1);for(var o=0;o<e.wrapper.children.length;o++)e.wrapper.children[parseInt(o.toString(),10)].id===n&&e.wrapper.children.splice(o,1);if(!i){var a=this.getObject(e.parentId);if(a&&a.shape instanceof Lc)for(var s=0;s<a.shape.lanes.length;s++){var h=t.parentId.split(a.id);if(a.shape.lanes[parseInt(s.toString(),10)].id===h[1].slice(0,-1))for(var d=0;d<a.shape.lanes[parseInt(s.toString(),10)].children.length;d++)if(t.id===a.shape.lanes[parseInt(s.toString(),10)].children[parseInt(d.toString(),10)].id){a.shape.lanes[parseInt(s.toString(),10)].children.splice(d,1);break}}}}e.wrapper.measure(new j),e.wrapper.arrange(e.wrapper.desiredSize)}},G.prototype.addChild=function(t,e,i){var n,r=this.nameTable[t.id];if(r.children||(r.children=[]),r.children&&("string"==typeof e?this.nameTable[""+e]&&(n=e):(n=e.id=e.id||q(),this.add(e)),n)&&(!e.umlIndex||-1===e.umlIndex)){var o=this.nameTable[""+n];if(o.parentId=r.id,r.container&&"Stack"===r.container.type&&this.updateStackProperty(r,o),i)r.children.splice(i,0,n),r.wrapper.children.splice(i,0,o.wrapper);else{r.children.push(n),r.wrapper.children.push(o.wrapper);var a=this.getObject(t.parentId),s=!1;if(a&&a.shape instanceof Lc)for(var h=0;h<a.shape.lanes.length;h++){var d=Hr(r,this);if(a.shape.lanes[parseInt(h.toString(),10)].id===d.id){for(var l=0;l<a.shape.lanes[parseInt(h.toString(),10)].children.length;l++)if(a.shape.lanes[parseInt(h.toString(),10)].children[parseInt(l.toString(),10)].id===o.id){s=!0;break}s||a.shape.lanes[parseInt(h.toString(),10)].children.push(o);break}}}r.wrapper.measure(new j),r.wrapper.arrange(r.wrapper.desiredSize),r.isLane||(this.nameTable[t.id].width=r.wrapper.actualSize.width,this.nameTable[t.id].height=r.wrapper.actualSize.height,this.nameTable[t.id].offsetX=r.wrapper.offsetX,this.nameTable[t.id].offsetY=r.wrapper.offsetY),void 0!==r.container&&(o.offsetX=o.wrapper.offsetX,o.offsetY=o.wrapper.offsetY),(!r.parentId||this.nameTable[r.parentId]&&"SwimLane"!==this.nameTable[r.parentId].shape.type)&&this.updateDiagramObject(r)}return n},G.prototype.removeChild=function(t,e){var i,n=this.nameTable[t.id];if(n.children||(n.children=[]),n.children&&("string"==typeof e?this.nameTable[""+e]&&(i=e):i=e.id=e.id||q(),i)&&(!e.umlIndex||-1===e.umlIndex)){var r=this.nameTable[""+i];r.parentId="",n.container&&"Stack"===n.container.type&&this.updateStackProperty(n,r);for(var o=0;o<n.children.length;o++)if(n.children[parseInt(o.toString(),10)]===i){n.children.splice(o,1);for(var a=0;a<n.wrapper.children.length;a++)n.wrapper.children[parseInt(a.toString(),10)]===r.wrapper&&n.wrapper.children.splice(a,1)}n.wrapper.measure(new j),n.wrapper.arrange(n.wrapper.desiredSize),n.isLane||(this.nameTable[t.id].width=n.wrapper.actualSize.width,this.nameTable[t.id].height=n.wrapper.actualSize.height,this.nameTable[t.id].offsetX=n.wrapper.offsetX,this.nameTable[t.id].offsetY=n.wrapper.offsetY),(!n.parentId||this.nameTable[n.parentId]&&"SwimLane"!==this.nameTable[n.parentId].shape.type)&&this.updateDiagramObject(n)}return i},G.prototype.clear=function(){this.clearObjects(),this.clearLayers()},G.prototype.clearLayers=function(){for(var t=this.layers.length-1;0<=t;t--)this.removeLayer(this.layers[parseInt(t.toString(),10)].id);this.commandHandler.addLayer({id:"default_layer",visible:!0,lock:!1,objects:[],zIndex:0,objectZIndex:-1,zIndexTable:{}},null,!0),this.setActiveLayer(this.layers[this.layers.length-1].id)},G.prototype.clearObjects=function(t){var e=[],e=t||(e=e.concat(this.nodes)).concat(this.connectors);this.diagramActions=this.diagramActions|Z.DiagramAction.Clear;for(var i=0,n=e;i<n.length;i++){var r=n[i];this.nameTable[r.id]&&this.remove(r)}this.diagramActions=this.diagramActions&~Z.DiagramAction.Clear,this.spatialSearch=new Hg(this.nameTable),this.initHistory()},G.prototype.startEditCommad=function(){var t,e=this.selectedItems.nodes[0]||void 0;if(e&&e instanceof _)if(e.isLane&&e.parentId)for(var i=this.nameTable[e.parentId],n=i.shape.lanes,i=e.id.slice(i.id.length),r=i.substring(0,i.length-1),o=0;o<n.length;o++)e.isLane&&r===n[parseInt(o.toString(),10)].id&&(t=this.nameTable[n[parseInt(o.toString(),10)].header.id]);else"SwimLane"===e.shape.type&&e.shape.header&&e.shape.hasHeader&&(i=e.wrapper.children[0].rows[0].cells[0].children[0].id,t=this.nameTable[""+i]);this.startTextEdit(t)},G.prototype.startTextEdit=function(t,e){if(!Bn(this)&&!kn(this)||zn(this)){this.textEditing=!0;var i=this.scroller.transform,n=Wn(this)?i.scale:1,r=void 0,o=void 0,a=void 0,s=void 0,h=void 0;if(t=t||this.selectedItems.nodes[0]||this.selectedItems.connectors[0]){!t.shape||"UmlClassifier"!==t.shape.type||t instanceof W||(t=this.nameTable[t.children[0]]);var d=!1;if(h)d=!0;else{if("Text"===t.shape.type||0!==t.annotations.length||t.constraints&Z.NodeConstraints.ReadOnly||(this.activeLabel.isGroup=!0,this.startGroupAction(),this.addLabels(t,[{id:q(),content:""}])),!e&&("Text"!==t.shape.type&&0<t.annotations.length||"Text"===t.shape.type))if("Text"===t.shape.type)e=t.wrapper.children[0].id.split("_")[1];else for(var l=t.annotations.length-1;0<=l;l--)t.annotations[parseInt(l.toString(),10)].visibility&&(e=t.annotations[parseInt(l.toString(),10)].id);e&&(h=this.getWrapper(t.wrapper,e))}!t||!h||h instanceof an||(c=h,g=((p=t)instanceof W?Z.ConnectorConstraints:Z.NodeConstraints).ReadOnly,("Text"===p.shape.type?p.constraints&Z.NodeConstraints.ReadOnly:p.constraints&g?!!(c.constraints&Z.AnnotationConstraints.InheritReadOnly):!!(c.constraints&Z.AnnotationConstraints.ReadOnly))&&!d)||(p=h.style,g=void 0,g=(g=(h.bounds.width<t.wrapper.bounds.width?h:t.wrapper).bounds.width)<90?90:g,c=document.getElementById(this.element.id+"_editTextBoxDiv"),r=(d=document.getElementById(this.element.id+"_editBox"))?d.value:h.content,this.activeLabel.text=r,c||d||(c=A("div",{}),d=A("textarea",{}),this.diagramCanvas.appendChild(c),c.appendChild(d),d.appendChild(document.createTextNode(r))),(o=Wc(h.style,r,void 0,void 0,g)).isEmpty()&&(o="Text"!==t.shape.type?new j(Kh(t,h.id.split(t.id+"_")[1]).width||50,h.style.fontSize):new j(50<t.width?50:t.width,h.style.fontSize)),t.parentId&&"UmlClassifier"===this.nameTable[t.parentId].shape.type?(o.width=t.wrapper.bounds.width-20,a=(t.wrapper.bounds.center.x+i.tx)*i.scale-o.width/2*n-2.5,s=(t.wrapper.bounds.center.y+i.ty)*i.scale-o.height/2*n-3,h.style.textAlign="Left"):(o.width=Math.max(o.width,50),a=(h.bounds.center.x+i.tx)*i.scale-o.width/2*n-2.5,s=(h.bounds.center.y+i.ty)*i.scale-o.height/2*n-3),hp(c,{id:this.element.id+"_editTextBoxDiv",style:"position: absolute;left:"+a+"px;top:"+s+"px;width:"+(o.width+1)*n+"px;height:"+o.height*n+"px; containerName:"+t.id+";"}),hp(d,{"aria-label":r,id:this.element.id+"_editBox",style:"width:"+(o.width+1)*n+"px;height:"+o.height*n+"px;resize: none;outline: none;overflow: hidden;;font-family:"+p.fontFamily+";font-size:"+p.fontSize*n+"px;text-align:"+h.style.textAlign.toLocaleLowerCase()+";",class:"e-diagram-text-edit"}),d.style.fontWeight=p.bold?"bold":"",d.style.fontStyle=p.italic?"italic":"",d.style.lineHeight=(1.2*p.fontSize+"px;").toString(),d.style.textDecoration=p.textDecoration||"",this.activeLabel.parentId=t.id,this.activeLabel.id=e,h.visible=!1,this.updateDiagramObject(t),this.diagramActions=this.diagramActions|Z.DiagramAction.TextEdit,this.isTriggerEvent||(N.EventHandler.add(d,"input",this.eventHandler.inputChange,this.eventHandler),N.EventHandler.add(d,"focusout",this.focusOutEdit,this),d.select()))}}var c,p,g},G.prototype.updateConnectorfixedUserHandles=function(t){if(t.fixedUserHandles.length)for(var e=0,i=t.fixedUserHandles;e<i.length;e++){var n=i[e],r=this.getWrapper(t.wrapper,n.id);t.updateAnnotation(n,t.intermediatePoints,t.wrapper.bounds,r)}t.wrapper.measure(new j(t.wrapper.width,t.wrapper.height)),t.wrapper.arrange(t.wrapper.desiredSize)},G.prototype.updateNodeExpand=function(t,e){for(var i=0;i<t.outEdges.length;i++){var n=this.nameTable[t.outEdges[parseInt(i.toString(),10)]],r=this.nameTable[n.targetID];n.visible=e,!r||(e||(this.updateElementVisibility(n.wrapper,n,!1),r.isExpanded=e),this.updateNodeExpand(r,r.isExpanded),r.visible=e)||this.updateElementVisibility(r.wrapper,r,!1)}},G.prototype.updateConnectorAnnotation=function(t){if(t.annotations.length)for(var e=0,i=t.annotations;e<i.length;e++){var n=i[e],r=this.getWrapper(t.wrapper,n.id);t.updateAnnotation(n,t.intermediatePoints,t.wrapper.bounds,r,this.diagramActions&Z.DiagramAction.Interactions)}t.wrapper.measure(new j(t.wrapper.width,t.wrapper.height)),t.wrapper.arrange(t.wrapper.desiredSize)},G.prototype.removeChildrenFromLayout=function(t){for(var e,i=[],n=0;n<t.length;n++)(e=t[parseInt(n.toString(),10)]).parentId||e.processId||i.push(e);return i},G.prototype.doLayout=function(){var t,e,i,n=!1,r="ComplexHierarchicalTree"===this.layout.type||"HierarchicalTree"===this.layout.type,o=this.isProtectedOnChange,a=(this.protectPropertyChange(!0),this.removeChildrenFromLayout(this.nodes)),s=this.layout.enableRouting&&"ComplexHierarchicalTree"===this.layout.type,h={x:this.scroller.viewPortWidth,y:this.scroller.viewPortHeight};if("None"!==this.layout.type){if((this.organizationalChartModule||this.mindMapChartModule||this.radialTreeModule||this.symmetricalLayoutModule||this.complexHierarchicalTreeModule||this.flowchartLayoutModule)&&(i={state:"Started",type:this.layout.type},this.triggerEvent(Z.DiagramEvent.layoutUpdated,i)),this.organizationalChartModule?(t=this.organizationalChartModule.updateLayout(a,this.nameTable,this.layout,h,this.dataSourceSettings.id,this.diagramActions),n=!0,this.canDistribute(s,r)&&this.lineDistributionModule.initLineDistribution(this.layout,this),(this.layoutAnimateModule&&t.rootNode&&!this.diagramActions||!this.layoutAnimateModule&&t.rootNode&&!t.rootNode.isExpanded&&!this.canExpand)&&this.updateNodeExpand(t.rootNode,t.rootNode.isExpanded)):this.mindMapChartModule?(a&&0<a.length&&this.mindMapChartModule.updateLayout(a,this.nameTable,this.layout,h,this.dataSourceSettings.id,this.dataSourceSettings.root),n=!0):this.radialTreeModule?(this.radialTreeModule.updateLayout(a,this.nameTable,this.layout,h),n=!0):this.symmetricalLayoutModule?(this.symmetricalLayoutModule.maxIteration=this.layout.maxIteration,this.symmetricalLayoutModule.springLength=this.layout.springLength,this.symmetricalLayoutModule.springFactor=this.layout.springFactor,this.symmetricalLayoutModule.updateLayout(a,this.connectors,this.symmetricalLayoutModule,this.nameTable,this.layout,h),n=!0):this.complexHierarchicalTreeModule?(this.canDistribute(s,r)&&(this.lineDistributionModule.diagram=this,this.connectors.forEach(function(t){t.obstaclePointCollection=[]})),0<(e=this.complexHierarchicalTreeModule.getLayoutNodesCollection(this.nodes)).length&&this.complexHierarchicalTreeModule.doLayout(e,this.nameTable,this.layout,h,this),n=!0,this.canDistribute(s,r)&&this.lineDistributionModule.initLineDistribution(this.layout,this)):this.flowchartLayoutModule?(this.flowchartLayoutModule.updateLayout(this.nodes,this),n=!0):(e="OrganizationalChart"===this.layout.type?"HierarchicalTree":this.layout.type,console.warn("[WARNING] :: Module "+e+" is not available in Diagram component! You either misspelled the module name or forgot to load it.")),n){this.preventDiagramUpdate=!0;for(var d={},l=0,c=a;l<c.length;l++){var p=c[l];if(this.preventNodesUpdate||this.diagramActions&&this.diagramActions&Z.DiagramAction.PreventIconsUpdate||(this.updateIcon(p),this.updateDefaultLayoutIcons(p)),this.preventNodesUpdate=!0,this.nodePropertyChange(p,{},{offsetX:p.offsetX,offsetY:p.offsetY},!0),this.preventNodesUpdate=!1,p.wrapper.measure(new j(p.wrapper.width,p.wrapper.height)),p.wrapper.arrange(p.wrapper.desiredSize),this.updateDiagramObject(p,!0),0<p.inEdges.length)for(var g=0;g<p.inEdges.length;g++)d[(b=this.nameTable[p.inEdges[parseInt(g.toString(),10)]]).id]=b;if(0<p.outEdges.length)for(var u=0;u<p.outEdges.length;u++){var m=this.nameTable[p.outEdges[parseInt(u.toString(),10)]];d[m.id]=m}}for(var f=0,y=Object.keys(d);f<y.length;f++){var v=y[f],b=(s&&this.lineDistributionModule.resetConnectorSegments(this.nameTable[""+v]),d[""+v]),v=this.getPoints(b);s&&this.lineDistributionModule.resetRoutingSegments(b,this,v),Xh(b,v),"Bpmn"===b.shape.type&&"Default"===b.shape.sequence&&"Sequence"===b.shape.flow&&this.commandHandler.updatePathElementOffset(b),b.wrapper.measure(new j(void 0,void 0)),b.wrapper.arrange(b.wrapper.desiredSize),this.updateConnectorAnnotation(b),this.updateConnectorfixedUserHandles(b),this.updateQuad(b),this.updateDiagramObject(b,!0)}(s||"DifferentPoint"===this.layout.connectionPointOrigin&&this.lineDistributionModule&&r)&&this.lineDistributionModule.distributeLines(this.layout,this),this.refreshFlowChartConnectors(),this.preventDiagramUpdate=!1,this.updatePage(),this.diagramActions&Z.DiagramAction.Render&&"Canvas"!==this.mode||(this.refreshDiagramLayer(),this.isRefreshed=!0)}o||this.protectPropertyChange(o)}return n&&this.updateDiagramElementQuad(),this.diagramActions&Z.DiagramAction.Render&&this.layout.enableRouting&&this.refreshRoutingConnectors(),n&&(i={state:"Completed",type:this.layout.type},this.triggerEvent(Z.DiagramEvent.layoutUpdated,i)),!(this.blazorActions&Z.BlazorAction.expandNode)||t},G.prototype.refreshRoutingConnectors=function(){if(this.isProtectedOnChange=!0,this.routingConnectors)for(var t=0;t<this.routingConnectors.length;t++){var e=this.routingConnectors[parseInt(t.toString(),10)],i=this.nameTable[e.sourceID],n=this.nameTable[e.targetID],r=new Zg;i.visible&&n.visible&&(r.renderVirtualRegion(this,!0),r.refreshConnectorSegments(this,e,!1,!0),Xh(e,this.getPoints(e)),e.wrapper.measure(new j(void 0,void 0)),e.wrapper.arrange(e.wrapper.desiredSize),this.updateDiagramObject(e,!0),this.routingConnectors.splice(t,1),t--)}this.isProtectedOnChange=!1},G.prototype.refreshFlowChartConnectors=function(){if(this.flowchartLayoutModule){this.flowchartLayoutModule.reRouteFlowChartConnectors(this.layout.flowChartData,this);for(var t=0;t<this.connectors.length;t++){var e=this.connectors[parseInt(t.toString(),10)];Xh(e,this.getPoints(e)),e.wrapper.measure(new j(void 0,void 0)),e.wrapper.arrange(e.wrapper.desiredSize),this.updateConnectorAnnotation(e),this.updateConnectorfixedUserHandles(e),this.updateQuad(e),this.updateDiagramObject(e,!0)}}},G.prototype.canDistribute=function(t,e){return!!(t&&this.lineDistributionModule||"DifferentPoint"===this.layout.connectionPointOrigin&&this.lineDistributionModule&&e||"Linear"===this.layout.arrangement&&this.lineDistributionModule)||((t||"DifferentPoint"===this.layout.connectionPointOrigin&&e||"Linear"===this.layout.arrangement)&&console.warn('[WARNING] :: Module "LineDistribution" is not available in Diagram component! You either misspelled the module name or forgot to load it.'),!1)},G.prototype.saveDiagram=function(){for(var t,e=[],i=0;i<this.nodes.length;i++)if("SwimLane"===(t=this.nodes[parseInt(i.toString(),10)]).shape.type){for(var n=t.wrapper.children[0].childTable,r=0,o=Object.keys(n);r<o.length;r++)e=Th(n[""+o[r]],e);for(var a=0;a<e.length;a++)this.nameTable[e[parseInt(a.toString(),10)]]&&(this.swimlaneChildTable[e[parseInt(a.toString(),10)]]=this.nameTable[e[parseInt(a.toString(),10)]].zIndex);this.swimlaneZIndexTable[t.id]=t.zIndex}return Dh(this)},G.prototype.loadDiagram=function(t,e){var i;return e&&this.ej1SerializationModule?(i=JSON.parse(t),t=this.ej1SerializationModule.getSerializedData(i)):e&&console.warn('[WARNING] :: Module "Ej1Serialization" is not available in Diagram component! You either misspelled the module name or forgot to load it.'),Mh(t,this)},G.prototype.saveDiagramAsMermaid=function(){return this.layout&&"Flowchart"===this.layout.type?this.saveFlowDiagramInMermaidFormat():this.saveMindmapDiagramInMermaidFormat()},G.prototype.saveMindmapDiagramInMermaidFormat=function(){var t,e,i="",n=[];return this.layout&&"MindMap"===this.layout.type&&(n.push("mindmap"),0<this.nodes.length)&&(t=this.nodes.filter(function(t){return 0===t.inEdges.length})[0],e=this.convertMindmapToMermaid(t,0),n.push(e),e=t.outEdges,this.updateTextDataSource(n,e,1),i=(n=n.filter(function(t){return""!==t.trim()})).join("\n")),i},G.prototype.updateTextDataSource=function(t,e,i){for(var n=0;n<e.length;){var r=this.getObject(e[parseInt(n.toString(),10)]),r=this.getObject(r.targetID),o=this.convertMindmapToMermaid(r,i),o=(t.push(o),r.outEdges);0<o.length&&this.updateTextDataSource(t,o,i+1),n++}},G.prototype.convertMindmapToMermaid=function(t,e){var i=t.id,e=" ".repeat(2*(e+1)),n=0<t.annotations.length?t.annotations[0].content.replace(/\n/g," "):"",r=e+n,e=e+i;return t.shape&&"Basic"===t.shape.type?"Rectangle"===(i=t.shape).shape?r=e+"["+n+"]":"Ellipse"===i.shape?r=e+"(("+n+"))":"Hexagon"===i.shape&&(r=e+"{{"+n+"}}"):t.shape&&"Flow"===t.shape.type?"Terminator"===t.shape.shape&&(r=e+"("+n+")"):t.shape&&"Path"===t.shape.type&&((i=t.shape).data===this.bangShape?r=e+"))"+n+"((":i.data===this.cloudShape&&(r=e+")"+n+"(")),r},G.prototype.saveFlowDiagramInMermaidFormat=function(){var a=this,s=[],h="graph TD\n",t={nodes:this.nodes,edges:this.connectors},d=t.nodes.reduce(function(t,e){return t[e.id]=e.annotations.length?e.annotations[0].content:"",t},{});return t.edges.forEach(function(t){var e=t.sourceID,i=t.targetID,n=(d[""+e],d[""+i],a.nameTable[""+e]),r=a.nameTable[""+i],n=a.getNodeShape(n),r=a.getNodeShape(r),o=t.annotations[0]&&""!==t.annotations[0].content?"|"+t.annotations[0].content+"|":"",t=(-1===s.indexOf(e)?s.push(e):n="",-1===s.indexOf(i)?s.push(i):r="",a.arrowType(t));h+="    "+e+n+" "+t+o+" "+i+r+"\n"}),t.nodes.forEach(function(t){var e=t.id,i=t.style.fill,n=t.style.strokeColor,t=t.style.strokeWidth+"px";h+="    style "+e+" fill:"+i+",stroke:"+n+",stroke-width:"+t+";\n"}),h},G.prototype.arrowType=function(t){var e=t.targetDecorator.shape,i=t.style.strokeDashArray,n=t.style.strokeWidth;return t.style.opacity<1?"~~~":""!==i?"-.->":"Arrow"===e?1<n?"==>":"--\x3e":"None"===e?"---":"--\x3e"},G.prototype.getNodeShape=function(t){var e=0<t.annotations.length?t.annotations[0].content:"",i=t.shape.shape;if(!i)return"M 0 0 A 1 1 0 0 0 7 0 A 1 1 0 0 0 0 0 M -1 0 A 1 1 0 0 0 8 0 A 1 1 0 0 0 -1 0"===(t=t.shape.data)?"((("+e+")))":"M 0 0 L 1 -1 L 5 -1 L 6 0 L 0 0"===t?"[/"+e+"\\]":"M 0 1 L 0 6 C 2 7 4 7 6 6 L 6 1 C 5 0 1 0 0 1 C 1 2 5 2 6 1"===t?"[("+e+")]":"M 0 0 L 12 0 L 14 2 L 2 2 L 0 0"===t?"[\\"+e+"\\]":"M 0 0 L 5 0 L 4 1 L 1 1 L 0 0"===t?"[\\"+e+"/]":"M 0 0 L 2 -2 L 11 -2 L 13 0 L 11 2 L 2 2 L 0 0"===t?"{{"+e+"}}":">"+e+"]";switch(i){case"Terminator":return"(["+e+"])";case"Process":return"["+e+"]";case"Decision":return"{"+e+"}";case"Parallelogram":return"[/"+e+"/]";case"Ellipse":return"(("+e+"))";case"PreDefinedProcess":return"[["+e+"]]";default:return"["+e+"]"}},G.prototype.loadDiagramFromMermaid=function(t){this.layout&&"Flowchart"===this.layout.type&&this.flowchartLayoutModule?this.convertMermaidToFlowChart(t):this.layout&&"MindMap"===this.layout.type&&this.mindMapChartModule?this.convertMermaidToMindmap(t):console.warn('[WARNING] :: Module "FlowchartLayout" or "MindMap" is not available in Diagram component! You either misspelled the module name or forgot to load it.')},G.prototype.countLeadingSpaces=function(t){for(var e=0,i=t.length;e<i&&" "===t.charAt(e);)e++;return e},G.prototype.convertMermaidToMindmap=function(t){if(t&&this.layout&&"MindMap"===this.layout.type&&this.mindMapChartModule){var l=t.split(/\r?\n/).filter(function(t){return 0<t.trim().length}),c=(this.clear(),this.mermaidNodeBaseCollection=[],[]),p={text:"",children:[],currentLevel:0,branch:"Left"},g=[],u=1,m=!1,f=!1,y=!1;if(0<l.length){for(var v=this,e=0;e<l.length;e++)!function(t){var e=l[parseInt(t.toString(),10)],i=0,n="",r=v.countLeadingSpaces(e),o=e.includes('"`');if(f=e.includes('`"'),y=(m=!!o||m)||y?y:0===r&&0<t,m&&f&&!o)return p.text+="\n"+e,m=!1;if(!o&&m)return p.text+="\n"+e;if(m=!f&&m,0<e.length&&(/\s/.test(e[0])&&0<t||0===r)){if(-1!==g.findIndex(function(t){return t.space===r.toString()}))for(var a=g.length-1;0<=a;a--){var s=g[parseInt(a.toString(),10)],h=parseFloat(s.space);if(r<h)g.splice(a,1);else{if(h<r){g.push({space:r.toString(),level:s.level+1}),i=s.level+1;break}if(h===r){i=s.level;break}}}else if(0===g.length)g.push({space:r.toString(),level:u}),i=u;else{for(a=g.length-1;0<=a;a--){var d=g[parseInt(a.toString(),10)],h=parseFloat(d.space);if(!(r<h)){d=g[g.length-1];g.push({space:r.toString(),level:d.level+1});break}g.splice(a,1)}i=g[g.length-1].level}n=e.trim().replace(/^[+-]/,"")}o={text:n,branch:void 0,children:[],currentLevel:0===t?0:i-1};if(0<c.length){for(;c.length>=i&&0!==c.length;)c.pop();0<c.length&&c[c.length-1].children.push(o)}c.push(o),p=o}(e);var i,t=c[0];"mindmap"!==t.text&&!y||(y?(i={id:(i=this.getNodeDetails(t)).nodeId,shape:i.nodeShapeData,annotations:[{content:i.annotationContent}]},this.mermaidNodeBaseCollection.push(i),this.createDataSource(t.children,t,i.id)):(i=t.children[0],t={id:(t=this.getNodeDetails(i)).nodeId,shape:t.nodeShapeData,annotations:[{content:t.annotationContent}]},this.mermaidNodeBaseCollection.push(t),this.createDataSource(i.children,i,t.id)),this.addElements(this.mermaidNodeBaseCollection),this.doLayout())}}},G.prototype.createDataSource=function(t,e,i){for(var n=0;n<t.length;){var r=t[parseInt(n.toString(),10)],o=this.getNodeDetails(r),o={id:o.nodeId,shape:o.nodeShapeData,annotations:[{content:o.annotationContent}]},a={sourceID:i,targetID:o.id};this.mermaidNodeBaseCollection.push(o),this.mermaidNodeBaseCollection.push(a),this.createDataSource(r.children,r,o.id),n++}},G.prototype.getNodeDetails=function(t){var e,i=t.text.match(/^(.*?)\s*([\\[\\(\\{][\s\S]*?[\]\\)\\}]|[)\\(][\s\S]*|[)\\{][\s\S]*|[)\\(][^{}()\\[\]]*$)/),n=q(),t=t.text,r={type:"Basic",shape:"Rectangle"};return i&&(n=i[1]||n,"["===(e=(i=i[2].trim().replace(/["`]/g,"")).charAt(0))?t=i.slice(1,-1):"("===e?(t=i.startsWith("((")?i.slice(2,-1):i.slice(1,-1),r=i.startsWith("((")?{type:"Basic",shape:"Ellipse"}:{type:"Flow",shape:"Terminator"}):")"===e?(t=i.startsWith("))")?i.slice(2,-2):i.slice(1,-1),r=i.startsWith("))")?{type:"Path",data:this.bangShape}:{type:"Path",data:this.cloudShape}):"{"===e&&(t=i.slice(2,-1),r={type:"Basic",shape:"Hexagon"})),{nodeId:n,annotationContent:t,nodeShapeData:r}},G.prototype.convertMermaidToFlowChart=function(t){for(var e=[],i=(this.clear(),t.trim().split("\n")),n=1;n<i.length;n++){var r,o,a=i[parseInt(n.toString(),10)];""!==(a=a.trim())&&(a.startsWith("style")?this.parseStyle(a,e):(r=[(a=this.getLineSplitting(a))[0],a[1]],0<(r=this.getNodeData(r,e,a[2])).length&&((o=r[r.length-1]).arrowType=a[2],""!==a[3])&&(o.label&&o.label.some(function(t){return 0<t.trim().length})?o.label.push(a[3]):(o.label=[],o.label[o.parentId.length-1]=a[3])),r.filter(function(t){return t.parentId&&0===t.parentId.length}).forEach(function(t){t.parentId=null}),e=e.concat(r)))}this.createFlowChart(e),this.doLayout(),this.clearHistory()},G.prototype.createFlowChart=function(t){for(var e=[],i=0;i<t.length;i++){var n={id:(o=t[parseInt(i.toString(),10)]).id,shape:o.shape,annotations:[{content:o.name}],style:{fill:o.color,strokeColor:o.stroke,strokeWidth:o.strokeWidth}};e.push(n)}for(var r=0;r<t.length;r++){var o,a=Pd(o=t[parseInt(r.toString(),10)]);if(o.parentId&&1<o.parentId.length)for(var s=0;s<o.parentId.length;s++){var h={id:q(),sourceID:o.parentId[parseInt(s.toString(),10)],targetID:o.id,annotations:[{content:o.label?o.label[parseInt(s.toString(),10)]:""}],style:{strokeWidth:a.strokeWidth||1,strokeDashArray:a.strokeDashArray||"",opacity:void 0!==a.opacity?a.opacity:1},targetDecorator:{shape:a.targetDecorator}};e.push(h)}else o.parentId&&1===o.parentId.length&&(h={id:q(),sourceID:o.parentId[0],targetID:o.id,annotations:[{content:o.label?o.label[0]:""}],style:{strokeWidth:a.strokeWidth||1,strokeDashArray:a.strokeDashArray||"",opacity:void 0!==a.opacity?a.opacity:1},targetDecorator:{shape:a.targetDecorator}},e.push(h))}this.addElements(e)},G.prototype.getLineSplitting=function(t){var e,i,n,r,o,a="",t=t.match(/^(.*?)\s*(-->|---|--\s*.*?\s*-->|~~~|==>|===|==\s*.*?\s*==>|\s*-\.\s*->|\s*-\.\s*-|\s*-\.\s*.*?\s*\.\s*->|\s*-\..*?\.\s*->)(.*)$/);return t&&(e=t[1].trim(),i=t[2].trim(),n=t[3].trim(),t=void 0,r="",a=null!==(t=(o=i.match(/(-\.|\\-\\-|==|--|~~)(.*?)(\1>|\.->|==>|\\->|~~>)/))?{text:o[2].trim()||null,arrowType:o[1]+o[3]}:{text:null,arrowType:i}).text?t.text:"",o=(r=t.arrowType).includes("--\x3e")?"single-line-arrow":r.includes("---")?"single-line":r.includes("==>")?"double-line-arrow":r.includes("==")?"double-line":r.includes("~~~")?"wiggly-arrow":r.includes("-.->")||r.includes(".->")?"dotted-arrow":r.includes("-.-")||r.includes(".-")?"dotted":"single-line-arrow"),[e,n,o,a]},G.prototype.parseStyle=function(t,e){var i;t.startsWith("style")&&(t=t.match(/^style\s+(\w+)\s+fill:([^,]+),stroke:([^,]+),stroke-width:(\d+)px;/))&&(i={id:t[1],fill:t[2],stroke:t[3],strokeWidth:parseInt(t[4],10)},(t=e.filter(function(t){return t.id===i.id}))[0].color=i.fill,t[0].stroke=i.stroke,t[0].strokeWidth=i.strokeWidth)},G.prototype.getNodeData=function(r,o,t){for(var e,i,a=[],s=null,h=null,d=0,l="",c=this,n=0;n<r.length;n++)!function(t){var e,i=r[parseInt(t.toString(),10)],i=c.splitNested(i),n=(i[0].includes("|")&&((e=i[0].match(/\|([^|]*)\|/))&&(l=e[1]),3<=(e=i[0].split("|")).length)&&(i[0]=e[2].trim()),i[0].trim());0===t?s=n:h=n,o.find(function(t){return t.id===n})?d++:(e=1<i.length?i[1]:i[0],t=c.getShape(e),i=e.replace(/[\\[\]\\(\\)\\{\\}\\{\\}\\/>]/g,""),a.push({id:n,name:i,shape:t,color:"white",parentId:[]}))}(n);return a.length?(e=a[a.length-1]).id!==s?(e.parentId.push(s),e.label?e.label.push(l):e.label=[l]):((e=o.find(function(t){return t.id===h})).parentId?e.parentId.push(s):e.parentId=[s],e.label?e.label.push(l):e.label=[l]):2===d&&((i=o.filter(function(t){return t.id===h})[0]).parentId=i.parentId||[],i.parentId.push(s),i.label=i.label||[],i.label[i.parentId.length-1]=l),t&&(i=o.filter(function(t){return t.id===h})[0])&&(i.arrowType=t),a},G.prototype.splitNested=function(t){for(var e=[],i="",n=0,r="",o=0,a=t;o<a.length;o++){var s=a[o];"["===s||"{"===s||"("===s||">"===s?(0===n?(0<i.trim().length&&e.push(i.trim()),r=i=s):i+=s,n++):"]"===s||"}"===s||")"===s?1===n&&s===r?(e.push((i+=s).trim()),i="",n--):1<n?(i+=s,n--):i+=s:i+=s}return 0<i.trim().length&&e.push(i.trim()),e},G.prototype.getShape=function(t){var e={};return t.startsWith("(((")?e={type:"Path",data:"M 0 0 A 1 1 0 0 0 7 0 A 1 1 0 0 0 0 0 M -1 0 A 1 1 0 0 0 8 0 A 1 1 0 0 0 -1 0"}:t.startsWith("((")?e={shape:"Ellipse",type:"Basic"}:t.startsWith("([")?e={type:"Flow",shape:"Terminator"}:t.startsWith("(")?e={type:"Flow",shape:"Process"}:t.startsWith("[[")?e={type:"Flow",shape:"PreDefinedProcess"}:t.startsWith("[/")?e=t.endsWith("/]")?{type:"Basic",shape:"Parallelogram"}:{type:"Path",data:"M 0 0 L 1 -1 L 5 -1 L 6 0 L 0 0"}:t.startsWith("[(")?e={type:"Path",data:"M 0 1 L 0 6 C 2 7 4 7 6 6 L 6 1 C 5 0 1 0 0 1 C 1 2 5 2 6 1"}:t.startsWith("[\\")?e=t.endsWith("\\]")?{type:"Path",data:"M 0 0 L 12 0 L 14 2 L 2 2 L 0 0"}:{type:"Path",data:"M 0 0 L 5 0 L 4 1 L 1 1 L 0 0"}:t.startsWith("[")?e={type:"Basic",shape:"Rectangle"}:t.startsWith("{{")?e={type:"Path",data:"M 0 0 L 2 -2 L 11 -2 L 13 0 L 11 2 L 2 2 L 0 0"}:t.startsWith("{")?e={type:"Flow",shape:"Decision"}:t.startsWith(">")&&(e={type:"Path",data:"M 0 0 L 8 0 L 8 2 L 0 2 L 2 1 L 0 0"}),e},G.prototype.getDiagramContent=function(t){return this.printandExportModule?this.printandExportModule.getDiagramContent(t):(console.warn('[WARNING] :: Module "PrintAndExport" is not available in Diagram component! You either misspelled the module name or forgot to load it.'),"")},G.prototype.exportImage=function(t,e){this.printandExportModule?this.printandExportModule.exportImages(t,e):console.warn('[WARNING] :: Module "PrintAndExport" is not available in Diagram component! You either misspelled the module name or forgot to load it.')},G.prototype.printImage=function(t,e){this.printandExportModule?(e.printOptions=!0,this.printandExportModule.exportImages(t,e)):console.warn('[WARNING] :: Module "PrintAndExport" is not available in Diagram component! You either misspelled the module name or forgot to load it.')},G.prototype.setStackLimit=function(t){this.undoRedoModule&&t&&(this.historyManager.stackLimit=t,this.undoRedoModule.applyLimit(this.historyManager.currentEntry,t,this,!0))},G.prototype.clearHistory=function(){this.undoRedoModule&&this.undoRedoModule.clearHistory(this)},G.prototype.getDiagramBounds=function(){var t;return this.printandExportModule?((t=this.printandExportModule.getDiagramBounds("",{})).width=t.width>this.scrollSettings.viewPortWidth?t.width+(0<t.x?t.x:0):this.scrollSettings.viewPortWidth,t.height=t.height>this.scrollSettings.viewPortHeight?t.height+(0<t.y?t.y:0):this.scrollSettings.viewPortHeight,t.x=0<t.x?0:t.x,t.y=0<t.y?0:t.y,t):(console.warn('[WARNING] :: Module "PrintAndExport" is not available in Diagram component! You either misspelled the module name or forgot to load it.'),new k)},G.prototype.exportDiagram=function(t){return this.printandExportModule?this.printandExportModule.exportDiagram(t):(console.warn('[WARNING] :: Module "PrintAndExport" is not available in Diagram component! You either misspelled the module name or forgot to load it.'),"")},G.prototype.print=function(t){this.printandExportModule?this.printandExportModule.print(t):console.warn('[WARNING] :: Module "PrintAndExport" is not available in Diagram component! You either misspelled the module name or forgot to load it.')},G.prototype.addPorts=function(s,h){this.protectPropertyChange(!0);s=this.nameTable[s.id]||s,1<h.length&&this.startGroupAction();for(var d,l=this,t=0;t<h.length;t++)!function(e){if(s.ports.some(function(t){return t.id===h[parseInt(e.toString(),10)].id}))return;if(s instanceof _?(d=new Be(s,"ports",h[parseInt(e.toString(),10)],!0),s.ports.push(d)):s instanceof W&&(d=new je(s,"ports",h[parseInt(e.toString(),10)],!0),s.ports.push(d)),s.children)for(var t=s.wrapper,i=0;i<t.children.length;i++){var n=t.children[parseInt(i.toString(),10)];if(n.id.match(t.id)){s.initPort(l.getDescription,n,d);break}}else{var r,o,a=s.wrapper;s instanceof _?a.children.push(s.initPortWrapper(s.ports[s.ports.length-1])):s instanceof W&&(r="Bezier"===s.type?s.intermediatePoints:s.getConnectorPoints(s.type),r=s.clipDecorators(s,r),o=k.toBounds(r),a.children.push(s.initPort(s.ports[s.ports.length-1],r,o,void 0)))}l.diagramActions&Z.DiagramAction.UndoRedo||l.diagramActions&Z.DiagramAction.Group||(a={type:"PortCollectionChanged",changeType:"Insert",undoObject:Q(d),redoObject:Q(s),category:"Internal"},l.addHistoryEntry(a))}(t);1<h.length&&this.endGroupAction(),s.wrapper.measure(new j(s.width,s.height)),s.wrapper.arrange(s.wrapper.desiredSize),this.updateDiagramObject(s),this.protectPropertyChange(!1)},G.prototype.addConstraints=function(t,e){return t|e},G.prototype.removeConstraints=function(t,e){return t&~e},G.prototype.addNodeLabels=function(t,e){this.addLabels(t,e)},G.prototype.addConnectorLabels=function(t,e){this.addLabels(t,e)},G.prototype.addLabels=function(t,e){this.protectPropertyChange(!0);var i,n=(t=this.nameTable[t.id]||t).wrapper;1<e.length&&this.startGroupAction();for(var r,o=0;o<e.length;o++){if(t instanceof _)if(i=new Ze(t,"annotations",e[parseInt(o.toString(),10)],!0),t.annotations.push(i),t.children)for(var a=t,s=0;s<a.wrapper.children.length;s++)a.wrapper.children[parseInt(s.toString(),10)].id===a.id+"group_container"&&a.wrapper.children[parseInt(s.toString(),10)].children.push(t.initAnnotationWrapper(t.annotations[t.annotations.length-1],this.element.id));else n.children.push(t.initAnnotationWrapper(t.annotations[t.annotations.length-1],this.element.id));else t instanceof W&&(i=new Qe(t,"annotations",e[parseInt(o.toString(),10)],!0),t.annotations.push(i),r=n.children[0],r=new k(r.offsetX-r.width/2,r.offsetY-r.height/2,r.width,r.height),n.children.push(t.getAnnotationElement(t.annotations[t.annotations.length-1],t.intermediatePoints,r,this.getDescription,this.element.id)));this.diagramActions&Z.DiagramAction.UndoRedo||this.diagramActions&Z.DiagramAction.Group||(r={type:"LabelCollectionChanged",changeType:"Insert",undoObject:Q(i),redoObject:Q(t),category:"Internal"},this.addHistoryEntry(r))}1<e.length&&this.endGroupAction(),t.wrapper.measure(new j(n.width,n.height)),t.wrapper.arrange(n.desiredSize),this.updateDiagramObject(t),this.protectPropertyChange(!1),this.refreshCanvasLayers()},G.prototype.addChildToUmlNode=function(t,e,i){var n="NoWrap";if("Class"===t.shape.classifier||"Interface"===t.shape.classifier){if("Method"===i){l=new ec(t,"",e),"Class"===t.shape.classifier?(t.shape.classShape.methods.push(l),T=t.shape.classShape):"Interface"===t.shape.classifier&&(t.shape.interfaceShape.methods.push(l),T=t.shape.interfaceShape);var r=t,o=this,R=n;if((l=T).methods&&l.methods.length){var a=l.methods,s="",h="",d=void 0,l=1,c=void 0,p=0,g=r.shape,u="Class"===g.classifier,u=(g.classifier,u?g.classShape:g.interfaceShape);1===a.length?0<u.attributes.length?(p=u.attributes.filter(function(t){return t.isSeparator}).length,c=(l=2+u.attributes.length+p)+1,Bd(r,o,l)):c=l+1:(p=u.attributes.filter(function(t){return t.isSeparator}).length,g=u.methods.filter(function(t){return t.isSeparator}).length,c=(l=2+u.attributes.length+p+u.methods.length+g)+1);for(var m=0;m<a.length;m++){var f,y=a[a.length-1],d=y.scope&&"Public"===y.scope?" +":y.scope&&"Private"===y.scope?"-":y.scope&&"Protected"===y.scope?"#":"~";if(y.parameters)for(var v=0;v<y.parameters.length;v++)y.parameters[parseInt(v.toString(),10)].type?s+=y.parameters[parseInt(v.toString(),10)].name+":"+y.parameters[parseInt(v.toString(),10)].type:s+=y.parameters[parseInt(v.toString(),10)].name,v!==y.parameters.length-1&&(s+=",");""!==y.name&&d&&(h+=d+" "+y.name+"("+s+") : "+y.type),m!==a.length&&(f=Rd(r,y),(f=new _(o,"nodes",{id:q()+"_umlMethods",verticalAlignment:"Stretch",horizontalAlignment:"Stretch",annotations:[{id:"name",content:h,offset:{x:0,y:.5},style:{bold:!0,fontSize:f.fontSize,color:f.color,fill:f.fill,textWrapping:R,italic:f.italic,fontFamily:f.fontFamily,whiteSpace:f.whiteSpace,textAlign:f.textAlign,textDecoration:f.textDecoration,textOverflow:f.textOverflow},margin:{left:14,right:5},horizontalAlignment:"Left"}],style:{fill:r.style.fill,strokeColor:"black"===r.style.strokeColor?"#ffffff00":r.style.strokeColor},minHeight:25,constraints:(Z.NodeConstraints.Default|Z.NodeConstraints.HideThumbs)&~(Z.NodeConstraints.Rotate|Z.NodeConstraints.Drag|Z.NodeConstraints.Resize)},!0)).parentId=r.id,f.umlIndex=c,o.add(f),h="");break}}}else if("Attribute"===i){p=new Jl(t,"",e),"Class"===t.shape.classifier?(t.shape.classShape.attributes.push(p),T=t.shape.classShape):"Interface"===t.shape.classifier&&(t.shape.interfaceShape.attributes.push(p),T=t.shape.interfaceShape);var b=t,S=this,u=T,N=n;if(u.attributes&&u.attributes.length){for(var w=u.attributes,x="",I=void 0,C=(1===w.length&&Bd(b,S,w.length),0),P=0;P<w.length-1;P++)!0===w[parseInt(P.toString(),10)].isSeparator&&C++;for(var j=w.length+C+1,P=0;P<w.length;P++){var A=w[w.length-1],I=A.scope&&"Public"===A.scope?" +":A.scope&&"Private"===A.scope?"-":A.scope&&"Protected"===A.scope?"#":"~";""!==A.name&&I&&(x+=I+" "+A.name+" : "+A.type),P!==w.length&&(A=Rd(b,A),(A=new _(S,"nodes",{id:q()+"_umlProperty",style:{fill:b.style.fill,strokeColor:"black"===b.style.strokeColor?"#ffffff00":b.style.strokeColor},annotations:[{id:"name",content:x,offset:{x:0,y:.5},style:{bold:!0,fontSize:A.fontSize,color:A.color,fill:A.fill,textWrapping:N,italic:A.italic,fontFamily:A.fontFamily,whiteSpace:A.whiteSpace,textAlign:A.textAlign,textDecoration:A.textDecoration,textOverflow:A.textOverflow},margin:{left:14,right:5},horizontalAlignment:"Left"}],verticalAlignment:"Stretch",horizontalAlignment:"Stretch",constraints:(Z.NodeConstraints.Default|Z.NodeConstraints.HideThumbs)&~(Z.NodeConstraints.Rotate|Z.NodeConstraints.Drag|Z.NodeConstraints.Resize),minHeight:25},!0)).parentId=b.id,A.umlIndex=j,S.add(A),x="");break}}}}else if("Enumeration"===t.shape.classifier&&"Member"===i){g=new lc(t,"",e),t.shape.enumerationShape.members.push(g);var T=t.shape.enumerationShape,D=t,O=this,l=T,M=n;if("Enumeration"===D.shape.classifier){for(var E=l.members,L="",z=(1===E.length&&Bd(D,O,E.length),0),k=0;k<E.length-1;k++)!0===E[parseInt(k.toString(),10)].isSeparator&&z++;for(var H=E.length+z+1,k=0;k<E.length;k++){var B=E[E.length-1];""!==B.name&&(L+=B.name),k!==E.length&&(B=Rd(D,B),(B=new _(O,"nodes",{id:q()+"_umlMember",annotations:[{id:"name",content:L,offset:{x:0,y:.5},style:{bold:!0,fontSize:B.fontSize,color:B.color,fill:B.fill,textWrapping:M,italic:B.italic,fontFamily:B.fontFamily,whiteSpace:B.whiteSpace,textAlign:B.textAlign,textDecoration:B.textDecoration,textOverflow:B.textOverflow},margin:{left:14,right:5},horizontalAlignment:"Left"}],verticalAlignment:"Stretch",horizontalAlignment:"Stretch",style:{fill:D.style.fill,strokeColor:"black"===D.style.strokeColor?"#ffffff00":D.style.strokeColor,textWrapping:M},constraints:(Z.NodeConstraints.Default|Z.NodeConstraints.HideThumbs)&~(Z.NodeConstraints.Rotate|Z.NodeConstraints.Drag|Z.NodeConstraints.Resize),minHeight:25},!0)).parentId=D.id,B.umlIndex=H,O.add(B),L="");break}}}this.clearSelection(),this.updateSelector()},G.prototype.addLanes=function(t,e,i){t=this.nameTable[t.id]||t;for(var n=0;n<e.length;n++){P=C=S=b=v=y=I=x=f=m=u=h=g=p=c=l=d=w=s=a=o=r=void 0;var r=this,o=t,a=e[parseInt(n.toString(),10)],s=i;if("SwimLane"===(o=r.nameTable[o.id]).shape.type){r.protectPropertyChange(!0);var h,d=o.wrapper.children[0],l=d.bounds,c=o.shape,p=!1,g=void 0,u=void 0,m=void 0,f=void 0,y=new Ac(c,"lanes",a,!0),v=(a.height=a.height||y.height,a.width=a.width||y.width,g="Vertical"===c.orientation||c.header&&c.hasHeader?1:0,"Horizontal"===c.orientation&&(p=!0,g=0<c.phases.length?g+1:g),cr(r,d)),b=void 0!==s?s:c.lanes.length;if(g+=b,w={element:y,cause:r.diagramActions,diagramAction:r.getDiagramAction(r.diagramActions),state:"Changing",type:"Addition",cancel:!1,laneIndex:b},r.triggerEvent(Z.DiagramEvent.collectionChange,w),!w.cancel){p?((S=new Qn).height=a.height,d.addRow(g,S,!1),o.height=void 0!==o.height?o.height+a.height:o.height,o.wrapper.height=d.height=o.height):((S=new Jn).width=a.width,d.addColumn(b+1,S,!1),o.width&&(o.width+=a.width,o.wrapper.width=d.width=o.width),c.hasHeader&&(d.rows[0].cells[0].columnSpan+=1)),r.diagramActions&Z.DiagramAction.UndoRedo||(y.id=""===y.id?q():y.id),void 0!==s?c.lanes.splice(s,0,y):c.lanes.push(y),w={element:y,cause:r.diagramActions,diagramAction:r.getDiagramAction(r.diagramActions),state:"Changed",type:"Addition",cancel:!1,laneIndex:b},r.triggerEvent(Z.DiagramEvent.collectionChange,w),hr(d,r,o,g,b,p),S="Horizontal"===c.orientation?r.nameTable[d.rows[parseInt(g.toString(),10)].cells[0].children[0].id]:c.header&&c.hasHeader?r.nameTable[d.rows[1].cells[parseInt(g.toString(),10)].children[0].id]:r.nameTable[d.rows[0].cells[parseInt(g.toString(),10)].children[0].id],r.diagramActions&Z.DiagramAction.UndoRedo||(s={type:"LaneCollectionChanged",changeType:"Insert",undoObject:Q(y),redoObject:Q(S),category:"Internal"},r.addHistoryEntry(s));var S,w="Horizontal"===c.orientation?g:c.header&&c.hasHeader?1:0;gr(r,o,w),pr(o),Pr(r,o);if((h=a.children)&&0<h.length)for(u=0;u<h.length;u++){var x,I={x:(x=h[parseInt(u.toString(),10)]).wrapper.offsetX,y:x.wrapper.offsetY},C={left:0,right:0,top:0,bottom:0};if("Horizontal"===c.orientation)for(C.bottom=l.y-d.bounds.y,d.rows[parseInt(g.toString(),10)].cells[parseInt(u.toString(),10)],m=0;m<d.rows[parseInt(g.toString(),10)].cells.length;m++)Ar(r,d.rows[parseInt(g.toString(),10)].cells[parseInt(m.toString(),10)],I,x,C);else t:for(var P=0;P<=d.rows.length;P++)for(f=0;f<d.rows[parseInt(P.toString(),10)].cells.length;f++)if(C.right=l.x-d.bounds.x,Ar(r,d.rows[parseInt(P.toString(),10)].cells[parseInt(f.toString(),10)],I,x,C))break t}vr(v,r),r.drag(o,l.x-d.bounds.x,l.y-d.bounds.y)}r.protectPropertyChange(!1)}void 0!==i&&(i+=1)}this.updateDiagramElementQuad()},G.prototype.addPhases=function(t,e){t=this.nameTable[t.id]||t;for(var i=0;i<e.length;i++)this.protectPropertyChange(!0),Tr(this,t,e[parseInt(i.toString(),10)]),this.protectPropertyChange(!1);this.updateDiagramElementQuad()},G.prototype.removeLane=function(t,e){e&&(e=this.nameTable[e.header.id],this.diagramActions=this.diagramActions|Z.DiagramAction.PublicMethod,kr(this,e,t,void 0),this.updateDiagramElementQuad())},G.prototype.removePhase=function(t,e){e=e.header.id;Nr(this,this.nameTable[""+e],t),this.updateDiagramElementQuad()},G.prototype.editSegment=function(t){if("Straight"===t.connector.type){for(var e=t.connector,i=t&&t.SegmentEditing?t.SegmentEditing:"Toggle",n=t.point,r=void 0,t=void 0,o=0;o<e.segments.length;o++)if(ro(n,e.segments[parseInt(o.toString(),10)].point,e.hitPadding)){r=!0;break}(r&&"Remove"===i||!r&&"Add"===i)&&(t=!0),"Straight"!==e.type||!t&&"Toggle"!==i||this.connectorEditingToolModule.addOrRemoveSegment(e,n,this.commandHandler)}},G.prototype.removelabelExtension=function(t,e,i,n){for(var r=0;r<n.children.length;r++){var o=n.children[parseInt(r.toString(),10)];if((o instanceof H||o instanceof an)&&o.id.match("_"+e[parseInt(i.toString(),10)].id+"$")){for(var a,s,h,d=0;d<t.annotations.length;d++)o.id.match("_"+t.annotations[parseInt(d.toString(),10)].id+"$")&&(this.diagramActions&Z.DiagramAction.UndoRedo||(a={type:"LabelCollectionChanged",changeType:"Remove",undoObject:Q(t.annotations[parseInt(d.toString(),10)]),redoObject:Q(t),category:"Internal"},this.addHistoryEntry(a)),t.annotations.splice(d,1));n.children.splice(r,1),"SVG"===this.mode?((s=Y(o.id,this.element.id))&&(h=Y(o.id,this.element.id)).parentNode.removeChild(h),Y(o.id+"_text",this.element.id)&&(s=Y(o.id+"_text",this.element.id)).parentNode.removeChild(s),(h=Y(o.id+"_html_element",this.element.id))&&h.parentNode.removeChild(h)):this.refreshCanvasLayers()}}},G.prototype.removeLabels=function(e,t){e=this.nameTable[e.id]||e,1<t.length&&this.startGroupAction();for(var i,n=t.length-1;0<=n;n--)e.children&&0<e.children.length?(i=e.wrapper.children.filter(function(t){return t.id===e.id+"group_container"}))&&0<i.length&&this.removelabelExtension(e,t,n,i[0]):this.removelabelExtension(e,t,n,e.wrapper);1<t.length&&this.endGroupAction(),this.refreshCanvasLayers()},G.prototype.removePortsExtenion=function(t,e,i,n){for(var r=0;r<n.children.length;r++){var o=n.children[parseInt(r.toString(),10)];if(o instanceof P&&o.id.match("_"+e[parseInt(i.toString(),10)].id+"$")){for(var a,s,h=0;h<t.ports.length;h++)o.id.match("_"+t.ports[parseInt(h.toString(),10)].id+"$")&&(this.diagramActions&Z.DiagramAction.UndoRedo||(a={type:"PortCollectionChanged",changeType:"Remove",undoObject:Q(t.ports[parseInt(h.toString(),10)]),redoObject:Q(t),category:"Internal"},this.addHistoryEntry(a)),t.ports.splice(h,1));n.children.splice(r,1),"SVG"===this.mode?(s=Y(o.id,this.element.id))&&s.parentNode.removeChild(s):this.refreshCanvasLayers()}}},G.prototype.removePorts=function(t,e){t=this.nameTable[t.id]||t;var i=e.length;1<i&&this.startGroupAction();for(var n=e.length-1;0<=n;n--)if(t.children&&0<t.children.length)for(var r=0;r<t.wrapper.children.length;r++)t.wrapper.children[parseInt(r.toString(),10)].id.match(t.wrapper.id)&&this.removePortsExtenion(t,e,n,t.wrapper.children[parseInt(r.toString(),10)]);else this.removePortsExtenion(t,e,n,t.wrapper);1<i&&this.endGroupAction()},G.prototype.getSizeValue=function(t,e){return t=0<t.toString().indexOf("px")?t.toString():0<t.toString().indexOf("%")?void 0!==e?"100%":t.toString():t.toString()+"px",e&&(xs(this),t="calc("+t+" - "+e+"px)"),t},G.prototype.renderRulers=function(){var t,e;this.rulerSettings.showRulers?(e=xs(t=this),e=A("div",{id:t.element.id+"_overlapRuler",style:"height:"+e.height+"px;width:"+e.width+"px;position:absolute;left:0;top:0",class:"e-ruler-overlap"}),t.element.insertBefore(e,t.element.firstChild),bs(this,!0),bs(this,!1)):ws(this)},G.prototype.intOffPageBackground=function(){new j;var t=xs(this),e=document.getElementById(this.element.id+"content"),i=(this.width||(this.width="100%"),this.height||(this.height="100%"),this.getSizeValue(this.width,t.width)),n=this.getSizeValue(this.height,t.height),t=this.rulerSettings.showRulers?"width:"+i+"; height:"+n+";top:"+t.height+"px;left:"+t.width+"px;overflow: scroll;position:absolute;overflow:auto;":"width:"+i+"; height:"+n+";position:absolute; left:0px;  top:0px;overflow: auto;",i={id:this.element.id+"content",tabindex:"0",style:t};e?(this.diagramCanvas=e,sp(this.diagramCanvas,t)):(this.diagramCanvas=A("div",i),this.element.appendChild(this.diagramCanvas)),this.diagramCanvas.style.background=this.backgroundColor},G.prototype.initDiagram=function(){this.intOffPageBackground(),hp(this.element,{style:"width:"+this.getSizeValue(this.width)+"; height:"+this.getSizeValue(this.height)+";position:relative;overflow:hidden;"})},G.prototype.renderHiddenUserHandleTemplateLayer=function(t){t=A("div",{class:this.element.id+"_hiddenUserHandleTemplate",style:"width:"+t.width+"px; height:"+t.height+"px;visibility:hidden ;  overflow: hidden;"});this.element.appendChild(t)},G.prototype.renderBackgroundLayer=function(t,e){t=this.createSvg(this.element.id+"_backgroundLayer_svg",t.width,t.height),sp(t,e),e=tp("g",{id:this.element.id+"_backgroundImageLayer",class:"e-background-image-layer"});t.appendChild(e);e=tp("g",{id:this.element.id+"_backgroundLayer",class:"e-background-layer"});t.appendChild(e),this.diagramCanvas.appendChild(t)},G.prototype.renderGridLayer=function(t,e){var t=this.createSvg(this.element.id+"_gridline_svg",t.width,t.height),i=(t.setAttribute("class","e-grid-layer"),tp("g",{id:this.element.id+"_gridline"})),n=tp("rect",{id:this.element.id+"_grid_rect",x:"0",y:"0",width:"100%",height:"100%"});!bd()||""!==new URL(window.location.href).search?n.setAttribute("fill","url(#"+this.element.id+"_pattern)"):n.setAttribute("fill","url("+location.protocol+"//"+location.host+location.pathname+"#"+this.element.id+"_pattern)"),i.appendChild(n),t.appendChild(i),this.diagramCanvas.appendChild(t),ap(t,{style:e})},G.prototype.renderDiagramLayer=function(t,e){var i,n,e={id:this.element.id+"_diagramLayer_div",style:"width:"+t.width+"px; height:"+t.height+"px;"+e};this.diagramLayerDiv=A("div",e),"SVG"===this.mode?((e=this.createSvg(this.element.id+"_diagramLayer_svg",t.width,t.height)).style["pointer-events"]="none",e.setAttribute("class","e-diagram-layer"),i=tp("g",{id:this.element.id+"_diagramLayer"}),n=tp("g",{}),this.diagramLayer=i,e.style["pointer-events"]="all",n.appendChild(i),e.appendChild(n),this.diagramLayerDiv.appendChild(e)):(this.diagramLayer=Op.createCanvas(this.element.id+"_diagram",t.width,t.height),sp(this.diagramLayer,"position:absolute;left:0px;top:0px;"),this.diagramLayerDiv.appendChild(this.diagramLayer)),this.diagramCanvas.appendChild(this.diagramLayerDiv)},G.prototype.initLayers=function(){var t,e="position:absolute;top:0px;left:0px;overflow:hidden;pointer-events:none;",i=document.getElementById(this.element.id),n=i.getBoundingClientRect(),i=(this.setScaleFromElement(n,i),this.modifyBounds(n),i=A("div",{style:"visibility:hidden; width: 100px"}),document.body.appendChild(i),r=i.getBoundingClientRect().width,i.style.overflow="scroll",t=A("div",{style:"width:100%"}),i.appendChild(t),t=t.getBoundingClientRect().width,i.parentNode.removeChild(i),r-t),r=(this.scroller.scrollerWidth=i,this.scroller.setViewPortSize(n.width,n.height),this.renderRulers(),"measureElement");window[r]&&(window[r]=null,document.getElementById("measureElement").remove()),dp(),this.renderBackgroundLayer(n,e),this.renderGridLayer(n,e),this.renderDiagramLayer(n,e),this.renderHTMLLayer(n,e),this.renderPortsExpandLayer(n,e),this.renderNativeLayer(n,e),this.renderAdornerLayer(n,e),this.renderHiddenUserHandleTemplateLayer(n)},G.prototype.setScaleFromElement=function(t,e){t=t.width/e.clientWidth;this.scaleValue=t},G.prototype.modifyBounds=function(t){var e=this.scaleValue;t.x=t.x/e,t.y=t.y/e,t.width=t.width/e,t.height=t.height/e},G.prototype.modifyClientOffset=function(t,e){var i=this.scaleValue;return e?t*i:t/i},G.prototype.renderAdornerLayer=function(t,e){var i=A("div",{id:this.element.id+"_diagramAdornerLayer",style:"width:"+t.width+"px;height:"+t.height+"px;"+e}),e=A("div",{id:this.element.id+"_diagramUserHandleLayer",style:"width:"+t.width+"px;height:"+t.height+"px;"+e}),e=(e.setAttribute("class","e-userHandle-layer"),i.appendChild(e),this.createSvg(this.element.id+"_diagramAdorner_svg",t.width,t.height)),t=(e.setAttribute("class","e-adorner-layer"),e.style["pointer-events"]="none",this.adornerLayer=tp("g",{id:this.element.id+"_diagramAdorner"}),this.adornerLayer.style[" pointer-events"]="all",e.appendChild(this.adornerLayer),i.appendChild(e),this.diagramCanvas.appendChild(i),tp("g",{id:this.element.id+"_SelectorElement"}));this.adornerLayer.appendChild(t),ap(e,{style:"pointer-events:none;"})},G.prototype.renderPortsExpandLayer=function(t,e){var t=this.createSvg(this.element.id+"_diagramPorts_svg",t.width,t.height),i=(t.setAttribute("class","e-ports-expand-layer"),tp("g",{id:this.element.id+"_diagramPorts",class:"e-ports-layer",style:"pointer-events: all;"})),i=(t.appendChild(i),tp("g",{id:this.element.id+"_diagramExpander",class:"e-expand-layer",style:"pointer-events: all;"}));t.appendChild(i),this.diagramCanvas.appendChild(t),ap(t,{style:e})},G.prototype.renderHTMLLayer=function(t,e){this.htmlLayer=A("div",{id:this.element.id+"_htmlLayer",style:"width:"+t.width+"px; height:"+t.height+"px;position:absolute;top:0px;left:0px;overflow:hidden;pointer-events:none;",class:"e-html-layer"});t=A("div",{id:this.element.id+"_htmlLayer_div",style:"position:absolute;top:0px;left:0px;pointer-events:all;"});this.htmlLayer.appendChild(t),this.diagramCanvas.appendChild(this.htmlLayer)},G.prototype.renderNativeLayer=function(t,e){var t=this.createSvg(this.element.id+"_nativeLayer_svg",t.width,t.height),i=tp("g",{id:this.element.id+"_nativeLayer",style:"pointer-events:all;"});t.appendChild(i),this.diagramLayerDiv.appendChild(t),ap(t,{class:"e-native-layer",style:e})},G.prototype.createSvg=function(t,e,i){var n=document.createElementNS("http://www.w3.org/2000/svg","svg");return ap(n,{id:t,width:e,height:i}),n},G.prototype.updateBazorShape=function(){for(var t=0;t<this.nodes.length;t++){var e=this.nodes[parseInt(t.toString(),10)];switch(e.shape.type){case"Bpmn":e.shape.bpmnShape=e.shape.shape;break;case"UmlActivity":e.shape.umlActivityShape=e.shape.shape;break;case"Flow":e.shape.flowShape=e.shape.shape;break;case"Basic":e.shape.basicShape=e.shape.shape;break;case"Text":e.shape.textContent=e.shape.content}}},G.prototype.initObjects=function(t){this.updateBazorShape(),this.isLoading||this.initData(),this.initLayerObjects(),this.updateBridging(t)},G.prototype.initLayerObjects=function(){for(var t=1<this.layers.length,e=[],i={},n={},r=[],o=0,a=this.nodes;o<a.length;o++)(v=a[o]).id=v.id||q(),this.addToLayer(v,t),i[v.id]=v;for(var s=0,h=this.connectors;s<h.length;s++)(v=h[s]).id=v.id||q(),this.addToLayer(v,t),i[v.id]=v;for(var d=0,l=this.layers;d<l.length;d++){for(var c,p,g,u=0,m=(I=l[d]).objects;u<m.length;u++)i[""+(v=m[u])]&&(i[""+v]instanceof W?(A=i[""+v]).sourceID&&A.targetID?(p=i[A.sourceID],g=i[A.targetID],c=!0,this.isLoading&&(p&&p.children&&0<p.children.length||g&&g.children&&0<g.children.length)&&(c=!1),p&&p.wrapper&&g&&g.wrapper&&c?this.initConnectors(i[""+v],I):e.push(i[""+v])):(p=i[A.sourceID],g=i[A.targetID],p&&p.children&&0<p.children.length||g&&g.children&&0<g.children.length?e.push(i[""+v]):this.initConnectors(i[""+v],I)):i[""+v].children?r.push(v):i[""+v].shape instanceof Xl&&i[""+v].shape.activity.subProcess.processes&&0<i[""+v].shape.activity.subProcess.processes.length?n[i[""+v].id]=v:this.initNodes(i[""+v],I));if(this.pathDataStorage&&this.pathDataStorage.clear(),this.bpmnModule)for(var f=0,y=this.bpmnModule.bpmnTextAnnotationConnector;f<y.length;f++){var v=y[f];this.initConnectors(v,void 0,!0)}}for(var b=0,S=Object.keys(n);b<S.length;b++){v=S[b];this.initObject(i[""+v]),this.bpmnModule.updateDocks(i[""+v],this)}for(var w=0,x=this.alignGroup(r,i);w<x.length;w++){var v=x[w],I=this.commandHandler.getObjectLayer(v);this.initNodes(i[""+v],I)}for(var C=0,P=e;C<P.length;C++){var A=P[C],I=this.commandHandler.getObjectLayer(A.id);this.initConnectors(A,I)}},G.prototype.alignGroup=function(t,e){for(var i,n=[],r=[],o=0;o<t.length;o++){var a,s,h;if((s=e[""+(a=t[parseInt(o.toString(),10)])])&&s.children.length)for(i=0;i<s.children.length;i++)h=s.children[parseInt(i.toString(),10)],-1<t.indexOf(h)&&-1===n.indexOf(h)&&-1===r.indexOf(h)&&n.splice(0,0,h);-1===n.indexOf(a)&&r.push(a)}return n=n.concat(r)},G.prototype.addToLayer=function(t,e){var i,n;e&&(i=this.commandHandler.getObjectLayer(t.id)),e&&i||-1===this.activeLayer.objects.indexOf(t.id)&&this.activeLayer.objects.push(t.id),(t instanceof _||t instanceof W)&&("SwimLane"!==t.shape.type||t.children&&0<t.children.length)&&(t.parentId&&(e=this.swimlaneZIndexTable[t.parentId],n=this.swimlaneChildTable[t.id],e&&-1!==e||n&&-1!==n)&&(t.zIndex=this.swimlaneChildTable[t.id]),!(t instanceof W&&t.sourceID&&t.targetID)||-1!==this.activeLayer.objects.indexOf(t.sourceID)&&-1!==this.activeLayer.objects.indexOf(t.targetID))&&this.setZIndex(i||this.activeLayer,t)},G.prototype.updateLayer=function(t){for(var e=0,i=Object.keys(t.layers);e<i.length;e++){for(var n=i[e],r=0,o=this.layers[""+n].objects;r<o.length;r++){var a=o[r],a=this.nameTable[""+a];void 0!==t.layers[""+n].visible?this.updateElementVisibility(a.wrapper,a,t.layers[""+n].visible):!0===t.layers[""+n].lock&&this.unSelect(a)}void 0!==t.layers[""+n].lock&&(this.layers[""+n].lock=t.layers[""+n].lock)}"SVG"!==this.mode&&this.refreshDiagramLayer()},G.prototype.updateScrollSettings=function(t){var e=-this.scroller.horizontalOffset+t.scrollSettings.horizontalOffset||0,t=-this.scroller.verticalOffset+t.scrollSettings.verticalOffset||0,i={VerticalOffset:this.scrollSettings.verticalOffset,HorizontalOffset:this.scrollSettings.horizontalOffset,ViewportHeight:this.scrollSettings.viewPortHeight,ViewportWidth:this.scrollSettings.viewPortWidth,CurrentZoom:this.scroller.currentZoom};0===e&&0===t||this.pan(e,t);e="Start",t={oldValue:i,newValue:{VerticalOffset:this.scrollSettings.verticalOffset,HorizontalOffset:this.scrollSettings.horizontalOffset,ViewportHeight:this.scrollSettings.viewPortHeight,ViewportWidth:this.scrollSettings.viewPortWidth,CurrentZoom:this.scroller.currentZoom},source:this,panState:e=this.realActions&Z.RealAction.PanInProgress?"Progress":e};this.triggerEvent(Z.DiagramEvent.scrollChange,t),this.commandHandler.updatePanState(!0),"Canvas"===this.mode&&this.constraints&Z.DiagramConstraints.Virtualization&&this.refreshDiagramLayer()},G.prototype.initData=function(){var t,e=this.dataSourceSettings.dataManager||this.dataSourceSettings.dataSource;!this.dataBindingModule||this.realActions&Z.RealAction.PreventDataInit?e&&!this.dataBindingModule&&console.warn('[WARNING] :: Module "DataBinding" is not available in Diagram component! You either misspelled the module name or forgot to load it.'):e&&this.dataSourceSettings.connectionDataSource.dataManager?(t=this.dataSourceSettings.dataManager||this.dataSourceSettings.dataSource,this.nodes=this.generateData(t,!0),this.connectors=this.generateData(this.dataSourceSettings.connectionDataSource.dataManager,!1)):e&&e.dataSource&&(e.dataSource.url||"BlazorAdaptor"===e.adaptorName&&!e.dataSource.url)?this.dataBindingModule.initSource(this.dataSourceSettings,this):this.dataBindingModule.initData(this.dataSourceSettings,this)},G.prototype.generateData=function(t,e){for(var i=[],n=0;n<t.length;n++){var r=t[parseInt(n.toString(),10)],r=e?this.makeData(r,!0):this.makeData(r,!1);r&&r.id&&!qs(i,r.id)&&i.push(r)}return i},G.prototype.makeData=function(t,e){var i,n=e?this.dataSourceSettings:this.dataSourceSettings.connectionDataSource,r={};if(r.id=t[n.id]||q(),n.sourceID&&(r.sourceID=t[n.sourceID]),n.targetID&&(r.targetID=t[n.targetID]),t[n.sourcePointX]&&t[n.sourcePointY]&&(r.sourcePoint={x:Number(t[n.sourcePointX]),y:Number(t[n.sourcePointY])}),t[n.targetPointX]&&t[n.targetPointY]&&(r.targetPoint={x:Number(t[n.targetPointX]),y:Number(t[n.targetPointY])}),n.crudAction.customFields&&0<n.crudAction.customFields.length)for(i=0;i<n.crudAction.customFields.length;i++)r[n.crudAction.customFields[parseInt(i.toString(),10)]]=t[n.crudAction.customFields[parseInt(i.toString(),10)]];return r},G.prototype.initNodes=function(t,e){this.preventDiagramUpdate=!0,this.initObject(t,e),this.preventDiagramUpdate=!1},G.prototype.initConnectors=function(t,e,i){this.preventDiagramUpdate=!0,this.initObject(t,e,i),this.updateEdges(t),this.preventDiagramUpdate=!1},G.prototype.setZIndex=function(t,e){var i=t;if(e.zIndex===Number.MIN_VALUE){for(;i.zIndexTable[i.objectZIndex+1];)t.objectZIndex++;this.setIndex(t,e)}else{var n=null!==e.zIndex?e.zIndex:i.objectZIndex+1;if(i.zIndexTable[parseInt(n.toString(),10)])for(var r=Object.keys(i.zIndexTable).length,o=0;o<r;o++)if(o===n){for(var a=r;n<a;a--)i.zIndexTable[parseInt(a.toString(),10)]=i.zIndexTable[a-1],this.nameTable[i.zIndexTable[parseInt(a.toString(),10)]]&&(this.nameTable[i.zIndexTable[parseInt(a.toString(),10)]].zIndex=a);i.zIndexTable[parseInt(o.toString(),10)]=e.id}}},G.prototype.setIndex=function(n,e){var r=this,o=function(t){t.zIndex=++n.objectZIndex,"Bpmn"===t.shape.type&&t.shape.activity&&t.shape.activity.subProcess&&t.shape.activity.subProcess.processes&&t.shape.activity.subProcess.processes.length&&t.shape.activity.subProcess.processes.forEach(function(t){t=r.nameTable[""+t];t&&(t.zIndex=++n.objectZIndex)})};if(n.objects.find(function(t){return t===e.id}))if(e instanceof _){if(o(e),e.children&&0<e.children.length)for(var t=0;t<e.children.length;t++)!function(e){var t=r.nodes.find(function(t){return t.id===e}),i=r.connectors.find(function(t){return t.id===e});t?t.children&&0<t.children.length?r.setIndex(n,t):o(t):i&&o(i)}(e.children[parseInt(t.toString(),10)])}else o(e)},G.prototype.initializeDiagramLayers=function(){for(var t=0;t<this.layers.length;t++)-1!==this.layers[parseInt(t.toString(),10)].zIndex&&(r=this.layers[parseInt(t.toString(),10)],this.layers[parseInt(t.toString(),10)]=this.layers[this.layers[parseInt(t.toString(),10)].zIndex],this.layers[r.zIndex]=r);for(var e=0,i=this.layers;e<i.length;e++){var n=i[e];n.zIndex=-1!==n.zIndex?n.zIndex:this.layers.indexOf(n),this.layerZIndexTable[n.zIndex]=n.id}for(t=0;t<this.layers.length;t++)for(var r,o=t+1;o<this.layers.length;o++)this.layers[parseInt(t.toString(),10)].zIndex>this.layers[parseInt(o.toString(),10)].zIndex&&(r=this.layers[parseInt(t.toString(),10)],this.layers[parseInt(t.toString(),10)]=this.layers[parseInt(o.toString(),10)],this.layers[parseInt(o.toString(),10)]=r);0===this.layers.length&&this.commandHandler.addLayer({id:"default_layer",visible:!0,lock:!1,objects:[],zIndex:0,objectZIndex:-1,zIndexTable:{}},null,!0),this.setActiveLayer(this.layers[this.layers.length-1].id)},G.prototype.resetTool=function(){this.eventHandler.resetTool()},G.prototype.initObjectExtend=function(t,e,i){if(i){i=this.commandHandler.checkBoundaryConstraints(void 0,void 0,t.wrapper.bounds,!0);if("SwimLane"===t.shape.type)for(var n=0,r=Object.keys(e.zIndexTable);n<r.length;n++)e.zIndexTable[r[parseInt(n.toString(),10)]]&&e.zIndexTable[r[parseInt(n.toString(),10)]]===t.id&&delete e.zIndexTable[r[parseInt(n.toString(),10)]];if(e.zIndexTable[t.zIndex]=t.id,!i){for(var o=t instanceof _?this.nodes:this.connectors,n=0;n<=o.length;n++)o[parseInt(n.toString(),10)]&&t.id===o[parseInt(n.toString(),10)].id&&o.splice(n,1);delete e.zIndexTable[t.zIndex]}}},G.prototype.initObject=function(t,e,i,n){if(void 0===i&&(i=!0),void 0!==t){if(i&&(e||(this.addToLayer(t,!1),e=this.activeLayer),t instanceof _||t instanceof W)&&("SwimLane"!==t.shape.type||t.children&&0<t.children.length)&&this.setZIndex(e,t),t instanceof _){if(i){if("helper"!==t.id&&!(this.diagramActions&Z.DiagramAction.UndoRedo))if(a=Dp(this.getNodeDefaults)){if((o=a(t,this))&&o.ports)for(var r=0;r<o.ports.length;r++)o.ports[parseInt(r.toString(),10)].inEdges=[],o.ports[parseInt(r.toString(),10)].outEdges=[];o&&o!==t&&yp(o,t)}this.initNode(t,this.element.id)}}else if(t instanceof W){(a=Dp(this.getConnectorDefaults))&&((o=a(t,this))&&o!==t&&yp(o,t),t.segments.length)&&t.type!==t.segments[0].type&&(t.segments=[]);var o,a=this.nameTable[t.sourceID],s=this.nameTable[t.targetID],h=this.getConnectedPort(a,t,!0),d=this.getConnectedPort(s,t),l=this.findInOutConnectPorts(a,!1),c=this.findInOutConnectPorts(s,!0);(void 0!==a&&Dn(a)||""!==t.sourcePortID&&On(l))&&(t.sourceWrapper=this.getEndNodeWrapper(a,t,!0),t.sourcePortID)&&h&&h.constraints&&!(h.constraints&Z.PortConstraints.None)&&h.constraints&Z.PortConstraints.OutConnect&&(t.sourcePortWrapper=this.getWrapper(a.wrapper,t.sourcePortID)),(void 0!==s&&An(s)||""!==t.targetPortID&&Tn(c))&&(t.targetWrapper=this.getEndNodeWrapper(s,t,!1),t.targetPortID)&&d&&d.constraints&&!(d.constraints&Z.PortConstraints.None)&&d.constraints&Z.PortConstraints.InConnect&&(t.targetPortWrapper=this.getWrapper(s.wrapper,t.targetPortID)),i||(l=t.getConnectorPoints(t.type),Xh(t,l)),i&&t.init(this);for(var p=0;p<t.wrapper.children.length;p++)this.pathTable[t.wrapper.children[parseInt(p.toString(),10)].data]&&(t.wrapper.children[parseInt(p.toString(),10)].absoluteBounds=this.pathTable[t.wrapper.children[parseInt(p.toString(),10)].data].absoluteBounds);t.wrapper.measure(new j(void 0,void 0)),t.wrapper.arrange(t.wrapper.desiredSize),t instanceof W&&"Bezier"===t.type&&(this.updateConnectorAnnotation(t),this.updateConnectorfixedUserHandles(t));for(var g=0;g<t.wrapper.children.length;g++)this.pathTable[t.wrapper.children[parseInt(g.toString(),10)].data]={},this.pathTable[t.wrapper.children[parseInt(g.toString(),10)].data].absoluteBounds=t.wrapper.children[parseInt(g.toString(),10)].absoluteBounds}if(t instanceof _&&t.children&&t.container)for(r=0;r<t.children.length;r++)this.nameTable[t.children[parseInt(r.toString(),10)]].offsetX=this.nameTable[t.children[parseInt(r.toString(),10)]].wrapper.offsetX,this.nameTable[t.children[parseInt(r.toString(),10)]].offsetY=this.nameTable[t.children[parseInt(r.toString(),10)]].wrapper.offsetY;if(t instanceof _&&t.shape&&"Activity"===t.shape.shape&&"SubProcess"===t.shape.activity.activity&&t.shape.activity.subProcess.processes)for(var u=t.shape.activity.subProcess.processes,r=0;r<u.length;r++)this.nameTable[u[parseInt(r.toString(),10)]]&&(this.nameTable[u[parseInt(r.toString(),10)]].offsetX=this.nameTable[u[parseInt(r.toString(),10)]].wrapper.offsetX,this.nameTable[u[parseInt(r.toString(),10)]].offsetY=this.nameTable[u[parseInt(r.toString(),10)]].wrapper.offsetY);if(this.initObjectExtend(t,e,i),this.nameTable[t.id]=t,!this.refreshing&&t.shape.annotations&&0<t.shape.annotations.length)for(r=0;r<t.shape.annotations.length&&t.shape.annotations[parseInt(r.toString(),10)].text;r++)this.getBPMNTextAnnotation(t,this,t.shape.annotations[parseInt(r.toString(),10)],!1);if(t instanceof _&&t.children){this.preventNodesUpdate=!0,this.preventConnectorsUpdate=!0,n||t.container||this.updateGroupOffset(t,!0),this.groupTable[t.id]=t.children;for(r=0;r<t.children.length;r++){var m=this.nameTable[t.children[parseInt(r.toString(),10)]];m&&(m.parentId=t.id)}this.isLoading||!t.rotateAngle||t.container||this.isUndo||this.commandHandler.rotateObjects(t,[t],t.rotateAngle,{x:t.offsetX,y:t.offsetY},!1),this.preventNodesUpdate=!1,this.preventConnectorsUpdate=!1}void 0===this.enterObject&&this.updateQuad(t)}!1===t.visible&&this.updateElementVisibility(t.wrapper,t,!1)},G.prototype.getConnectedPort=function(t,e,i){if(t&&t.ports)for(var n=0,r=t.ports;n<r.length;n++){var o=r[n];if(o.id===e.sourcePortID&&i)return o;if(o.id===e.targetPortID&&!i)return o}return null},G.prototype.scaleObject=function(t,e,i){var n=i?t.wrapper.actualSize.width:t.wrapper.actualSize.height,r=i?1+(e-n)/n:1,i=i?1:1+(e-n)/n;this.realActions|=Z.RealAction.PreventDrag,this.scale(t,r,i,{x:.5,y:.5}),this.realActions&=~Z.RealAction.PreventDrag},G.prototype.updateDefaultLayoutIcons=function(t){"OrganizationalChart"!==this.layout.type&&"HierarchicalTree"!==this.layout.type&&"ComplexHierarchicalTree"!==this.layout.type||(this.updateDefaultLayoutIcon(t,t.expandIcon),this.updateDefaultLayoutIcon(t,t.collapseIcon))},G.prototype.updateDefaultLayoutIcon=function(t,e){var i,n;"None"!==e.shape&&"Auto"===e.horizontalAlignment&&"Auto"===e.verticalAlignment&&.5===e.offset.x&&1===e.offset.y&&(e=this.getWrapper(t.wrapper,"icon_content"),n=i=void 0,"TopToBottom"===this.layout.orientation||"BottomToTop"===this.layout.orientation?(i=.5,n="TopToBottom"===this.layout.orientation?1:0):"RightToLeft"!==this.layout.orientation&&"LeftToRight"!==this.layout.orientation||(i="LeftToRight"===this.layout.orientation?1:0,n=.5),e.setOffsetWithRespectToBounds(i,n,"Fraction"),e.horizontalAlignment="Center",e.verticalAlignment="Center",t.wrapper.measure(new j(t.wrapper.width,t.wrapper.height)),t.wrapper.arrange(t.wrapper.desiredSize))},G.prototype.updateGroupOffset=function(t,e){var i,n,r;(t.children&&0<t.children.length&&!t.container||t.processId)&&(i=this.nameTable[t.id],this.realActions&Z.RealAction.PreventScale||this.realActions&Z.RealAction.PreventDrag||(i.offsetX&&(this.realActions&Z.RealAction.EnableGroupAction||!(this.diagramActions&Z.DiagramAction.UndoRedo||this.diagramActions&Z.DiagramAction.ToolAction||this.diagramActions&Z.DiagramAction.PublicMethod))?(this.realActions|=Z.RealAction.PreventScale,n=i.offsetX-t.wrapper.offsetX,i.offsetX=t.wrapper.offsetX,r=i.offsetY-t.wrapper.offsetY,i.offsetY=t.wrapper.offsetY,n+r!==0&&this.drag(i,n,r),this.realActions&=~Z.RealAction.PreventScale):i.offsetX=t.wrapper.offsetX,i.offsetY&&(this.realActions&Z.RealAction.EnableGroupAction||!(this.diagramActions&Z.DiagramAction.UndoRedo||this.diagramActions&Z.DiagramAction.ToolAction||this.diagramActions&Z.DiagramAction.PublicMethod))?(this.realActions|=Z.RealAction.PreventScale,r=i.offsetY-t.wrapper.offsetY,i.offsetY=t.wrapper.offsetY,this.drag(i,0,r),this.realActions&=~Z.RealAction.PreventScale):i.offsetY=t.wrapper.offsetY,this.diagramActions&&(i.width=t.wrapper.actualSize.width,i.height=t.wrapper.actualSize.height))),t&&t.annotations&&0<t.annotations.length&&(t.wrapper.children.forEach(function(t){t instanceof F&&t.children.forEach(function(t){t&&t instanceof H&&t.refreshTextElement()})}),t.wrapper.measure(new j(t.width,t.height),t.id,this.onLoadImageSize.bind(this)),t.wrapper.arrange(t.wrapper.desiredSize)),e&&t.children&&0<t.children.length&&(void 0!==this.nameTable[t.id].width?this.scaleObject(t,this.nameTable[t.id].width,!0):this.nameTable[t.id].width=t.wrapper.actualSize.width,void 0!==this.nameTable[t.id].height?this.scaleObject(t,this.nameTable[t.id].height,!1):this.nameTable[t.id].height=t.wrapper.actualSize.height)},G.prototype.initNode=function(t,e,i){var n=t.initContainer(),r=new F;if(this.diagramSettings.inversedAlignment||(n.inversedAlignment=!1),n.children||(n.children=[]),t.children){if(n.measureChildren=!1,r.id=t.id+"group_container",t.shape&&"SwimLane"===t.shape.type?r.style.fill=t.style.fill:r.style.fill="none",r.style.strokeColor="none",r.horizontalAlignment="Stretch",r.verticalAlignment="Stretch",r.pivot=t.pivot,n.style=t.style,n.padding.left=t.padding.left,n.padding.right=t.padding.right,n.padding.top=t.padding.top,n.padding.bottom=t.padding.bottom,r.children=[],r.preventContainer=!0,t.container&&(r.relativeMode="Object"),t.container&&"Grid"===t.container.type)for(var o=0;o<t.children.length;o++){var a=new F,s=this.nameTable[t.children[o]];a.children=[],a.children.push(s.wrapper),s&&n.addObject(s.wrapper,s.rowIndex,s.columnIndex,s.rowSpan,s.columnSpan)}else for(o=0;o<t.children.length;o++)this.nameTable[t.children[o]]&&(s=this.nameTable[t.children[o]],this.updateStackProperty(t,s,o),n.children.push(s.wrapper),n.elementActions=n.elementActions|Z.ElementAction.ElementIsGroup,s.wrapper.flip=s.wrapper.flip^=t.wrapper.flip);(N.isNullOrUndefined(t.container)||t.container&&"Grid"!==t.container.type)&&n.children.push(r)}else{var h=Dp(this.setNodeTemplate),d=(d=h&&"helper"!==t.id?h(t,this):d)||t.init(this);n.children.push(d)}h=Dp(this.getDescription),(t.children?n:d).description=h||(t.annotations.length?t.annotations[0].content:t.id);var l=t.children?r:n;t.initAnnotations(this.getDescription,l,this.element.id,!!Ln(this),this.annotationTemplate),t.initPorts(this.getDescription,l),t.initIcons(this.getDescription,this.layout,l,e);for(o=0;t.fixedUserHandles,o<t.fixedUserHandles.length;o++){var c=t.initFixedUserHandles(t.fixedUserHandles[o],this.fixedUserHandleTemplate,this.element.id);l.children.push(c)}if("SwimLane"===t.shape.type&&t.wrapper&&0<t.wrapper.children.length&&t.wrapper.children[0]instanceof Zn){if(this.setZIndex(this.activeLayer,t),0<this.connectors.length)for(o=0;o<this.connectors.length;o++){var p=this.connectors[o];p.sourceID&&p.targetID&&-1===this.activeLayer.objects.indexOf(p.sourceID)&&-1===this.activeLayer.objects.indexOf(p.targetID)&&this.setZIndex(this.activeLayer,p)}pr(t),ur(this,t),this.updateDiagramElementQuad()}else n.measure(new j(t.width,t.height),t.id,this.onLoadImageSize.bind(this)),n instanceof Zn?n.arrange(n.desiredSize,!0):n.arrange(n.desiredSize);if(t.wrapper.flip!==Z.FlipDirection.None)if(t.children&&0<t.children.length){for(o=0;o<t.children.length;o++){var g=this.nameTable[t.children[o]];g&&(this.refreshing||this.commandHandler.cloningInProgress||this.diagramActions&Z.DiagramAction.UndoRedo||(g.flip^=t.flip,g.flipMode=t.flipMode),"None"!==g.flipMode&&"Label"!==g.flipMode&&"LabelText"!==g.flipMode&&"LabelAndLabelText"!==g.flipMode?this.updatePorts(g,g.flip):this.updatePorts(g,Z.FlipDirection.None),this.applyWrapperFlip(g),g.wrapper.measure(new j(g.wrapper.bounds.width,g.wrapper.bounds.height),g.id,this.onLoadImageSize.bind(this)),g.wrapper.arrange(g.wrapper.desiredSize))}var u=t.wrapper.children[t.wrapper.children.length-1];u.flip=t.wrapper.flip,u.flipMode=t.wrapper.flipMode;for(var m=0;m<u.children.length;m++){var f=u.children[m];f instanceof H&&"Port"!==t.flipMode&&"None"!==t.flipMode&&(f.flip=t.wrapper.flip,f.flipMode=t.wrapper.flipMode)}this.refreshing||this.commandHandler.cloningInProgress||this.diagramActions&Z.DiagramAction.UndoRedo||sd(t.wrapper,t.wrapper.offsetX,t.wrapper.offsetY,this,t.wrapper.flip,void 0,void 0,!0)}else this.applyWrapperFlip(t);if("Bpmn"===t.shape.type&&"TextAnnotation"===t.shape.shape){for(var y=!1,o=0;o<this.connectors.length;o++)if(this.connectors[parseInt(o.toString(),10)].id===t.id+"_connector"){y=this.connectors[parseInt(o.toString(),10)].isBpmnAnnotationConnector=!0;break}y||this.addBpmnAnnotationConnector(t,n)}t instanceof _&&t.container&&(t.width<n.outerBounds.width||t.height<n.outerBounds.height)&&n.bounds.x<=n.outerBounds.x&&n.bounds.y<=n.outerBounds.y&&(t.width=n.width=n.outerBounds.width,t.height=n.height=n.outerBounds.height,n.measure(new j(t.width,t.height)),n.arrange(n.desiredSize)),t.container&&"Grid"===t.container.type&&t.children&&0<t.children.length&&this.updateChildPosition(t)},G.prototype.applyWrapperFlip=function(t){t.wrapper.flip=t.flip,t.wrapper.flipMode=t.flipMode,t.wrapper.children[0].flip=t.flip,t.wrapper.children[0].flipMode=t.flipMode;for(var e=0;e<t.wrapper.children.length;e++){var i=t.wrapper.children[e];i instanceof F?this.applyWrapperCanvasFlip(i,t):(i.flip=t.flip,i.flipMode=t.flipMode)}},G.prototype.applyWrapperCanvasFlip=function(t,e){for(var i=0;i<t.children.length;i++){var n=t.children[parseInt(i.toString(),10)];n instanceof F?this.applyWrapperCanvasFlip(n,e):"None"!==e.flipMode&&(n.flip=e.flip,n.flipMode=e.flipMode)}},G.prototype.addBpmnAnnotationConnector=function(t,e){if(t.parentObj instanceof G||t.parentObj instanceof Ac){var i=t.shape,n=i.textAnnotation.textAnnotationDirection,r=""!==i.textAnnotation.textAnnotationTarget&&this.nameTable[i.textAnnotation.textAnnotationTarget],o=r?this.nameTable[i.textAnnotation.textAnnotationTarget]:null,a=null!=o?o.wrapper:null,s=t.ports[0],h={x:0,y:0};switch(n){case"Left":s.offset={x:0,y:.5},h.x=e.bounds.left-40,h.y=e.bounds.bottom+30;break;case"Right":s.offset={x:1,y:.5},h.x=e.bounds.right+40,h.y=e.bounds.bottom+30;break;case"Top":s.offset={x:.5,y:0},h.x=e.bounds.right+30,h.y=e.bounds.top-40;break;case"Bottom":s.offset={x:.5,y:1},h.x=e.bounds.right+30,h.y=e.bounds.bottom+40;break;default:s.offset={x:0,y:.5},h.x=e.bounds.left-40,h.y=e.bounds.bottom+30,r&&null!=e&&null!=a&&(e.bounds.left>a.bounds.right?s.offset={x:0,y:.5}:e.bounds.right<a.bounds.left?s.offset={x:1,y:.5}:e.bounds.bottom>a.bounds.top?s.offset={x:.5,y:0}:e.bounds.top<a.bounds.bottom&&(s.offset={x:.5,y:1}))}o=new W(this,"connectors",{id:t.id+"_connector",targetID:t.id,targetPortID:s.id,type:"Straight",shape:{type:"Bpmn",flow:"Association"},constraints:Z.ConnectorConstraints.Default&~(Z.ConnectorConstraints.DragTargetEnd|Z.ConnectorConstraints.Delete),isBpmnAnnotationConnector:!0},!0),n=(r?o.sourceID=i.textAnnotation.textAnnotationTarget:o.sourcePoint=h,this.isProtectedOnChange),i=(this.isProtectedOnChange=!0,t.constraints|=Z.NodeConstraints.InConnect,this.connectors.push(o),this.bpmnModule.bpmnTextAnnotationConnector||(this.bpmnModule.bpmnTextAnnotationConnector=[]),this.bpmnModule.bpmnTextAnnotationConnector.push(o),0!=(t.constraints&Z.NodeConstraints.Shadow)),o=0!=(t.constraints&Z.NodeConstraints.AllowMovingOutsideLane);t.constraints=Z.NodeConstraints.Default&~(Z.NodeConstraints.OutConnect|Z.NodeConstraints.InConnect),i&&(t.constraints|=Z.NodeConstraints.Shadow),o&&(t.constraints|=Z.NodeConstraints.AllowMovingOutsideLane),this.isProtectedOnChange=n}},G.prototype.getBPMNTextAnnotation=function(t,e,i,n){var r,o={id:i.id||q(),height:i.height||100,width:i.width||100,annotations:[{id:(i.id||q())+i.text,content:i.text}],offsetX:t.offsetX+i.length*Math.cos(i.angle*(Math.PI/180)),offsetY:t.offsetY+i.length*Math.sin(i.angle*(Math.PI/180)),shape:{type:"Bpmn",shape:"TextAnnotation",textAnnotation:{textAnnotationDirection:"Auto",textAnnotationTarget:t.id}},constraints:Z.NodeConstraints.Default&~(Z.NodeConstraints.OutConnect|Z.NodeConstraints.InConnect)},a=t.wrapper.bounds,t={x:o.offsetX,y:o.offsetY},s=Vi(t,a,a);switch(s){case"Right":r={x1:a.right,y1:a.top,x2:a.right,y2:a.bottom};break;case"Left":r={x1:a.left,y1:a.top,x2:a.left,y2:a.bottom};break;case"Bottom":r={x1:a.right,y1:a.bottom,x2:a.left,y2:a.bottom};break;case"Top":r={x1:a.right,y1:a.top,x2:a.left,y2:a.top}}var h=a.center,t=Li(r,[h,K.transform(t,i.angle,Math.max(a.width,a.height))],0,h);void 0!==i.length&&void 0!==i.angle&&t&&(t=K.transform(t,i.angle,i.length),o.offsetX=t.x,o.offsetY=t.y),"Right"===s?o.offsetX+=o.width/2:"Left"===s?o.offsetX-=o.width/2:"Bottom"===s?o.offsetY+=o.height/2:o.offsetY-=o.height/2,n?this.add(o):(h=new _(this,"nodes",o,!0),e.initObject(h,void 0,void 0,!0),e.nodes.push(h))},G.prototype.updateDiagramElementQuad=function(){for(var t=0;t<this.nodes.length;t++)this.nodes[parseInt(t.toString(),10)].wrapper&&this.nodes[parseInt(t.toString(),10)].wrapper instanceof te&&this.updateQuad(this.nodes[parseInt(t.toString(),10)])},G.prototype.onLoadImageSize=function(t,e){var i=this.getObject(t),t=document.getElementById(t+"sf-imageNode"),t=(t&&t.parentNode.removeChild(t),this.nodePropertyChange(i,{},{width:e.width,height:e.height}),{element:Q(i),size:e});this.triggerEvent(Z.DiagramEvent.onImageLoad,t)},G.prototype.updateChildPosition=function(t){for(var e=0;e<t.children.length;e++){var i=this.getObject(t.children[parseInt(e.toString(),10)]);i.offsetX=i.wrapper.offsetX,i.offsetY=i.wrapper.offsetY,i.children&&0<i.children.length&&this.updateChildPosition(i)}},G.prototype.canExecute=function(){return!0},G.prototype.updateStackProperty=function(t,e,i){t.container&&"Stack"===t.container.type&&(e.width||(e.wrapper.horizontalAlignment="Stretch",e.horizontalAlignment="Stretch"),e.height||(e.verticalAlignment="Stretch",e.wrapper.verticalAlignment="Stretch"),i)&&"UmlClassifier"===t.shape.type&&(e.umlIndex=i)},G.prototype.initViews=function(){this.isLoading||(this.views.push(this.element.id),this.views[this.element.id]=this)},G.prototype.initCommands=function(){var t=this.commandManager.commands,e={copy:{execute:this.copyCommand.bind(this),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.C,keyModifiers:Z.KeyModifiers.Control}},paste:{execute:this.pasteCommand.bind(this),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.V,keyModifiers:Z.KeyModifiers.Control}},cut:{execute:this.cutCommand.bind(this),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.X,keyModifiers:Z.KeyModifiers.Control}},delete:{execute:this.removeCommand.bind(this),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.Delete}},selectAll:{execute:this.selectAll.bind(this),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.A,keyModifiers:Z.KeyModifiers.Control}},undo:{execute:this.undo.bind(this),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.Z,keyModifiers:Z.KeyModifiers.Control}},redo:{execute:this.redo.bind(this),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.Y,keyModifiers:Z.KeyModifiers.Control}},nudgeUp:{execute:this.nudgeCommand.bind(this,"Up"),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.Up},parameter:"up"},nudgeRight:{execute:this.nudgeCommand.bind(this,"Right"),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.Right},parameter:"right"},nudgeDown:{execute:this.nudgeCommand.bind(this,"Down"),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.Down},parameter:"down"},nudgeLeft:{execute:this.nudgeCommand.bind(this,"Left"),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.Left},parameter:"left"},startEdit:{execute:this.startEditCommad.bind(this),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.F2}},endEdit:{execute:this.endEditCommand.bind(this),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.Escape}},focusToNextItem:{execute:this.navigateItems.bind(this,!0),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.Tab}},focusToPreviousItem:{execute:this.navigateItems.bind(this,!1),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.Tab,keyModifiers:Z.KeyModifiers.Shift}},selectFocusedItem:{execute:this.startEditCommad.bind(this),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.Enter}},bold:{execute:this.fontStyleCommand.bind(this,"bold"),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.B,keyModifiers:Z.KeyModifiers.Control}},italic:{execute:this.fontStyleCommand.bind(this,"italic"),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.I,keyModifiers:Z.KeyModifiers.Control}},underline:{execute:this.fontStyleCommand.bind(this,"underline"),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.U,keyModifiers:Z.KeyModifiers.Control}},duplicate:{execute:this.duplicateCommand.bind(this),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.D,keyModifiers:Z.KeyModifiers.Control}},group:{execute:this.groupCommand.bind(this,"group"),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.G,keyModifiers:Z.KeyModifiers.Control}},ungroup:{execute:this.groupCommand.bind(this,"ungroup"),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.U,keyModifiers:Z.KeyModifiers.Control|Z.KeyModifiers.Shift}},rotateClockwise:{execute:this.rotateCommand.bind(this,"clockwise"),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.R,keyModifiers:Z.KeyModifiers.Control}},rotateAntiClockwise:{execute:this.rotateCommand.bind(this,"antiClockwise"),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.L,keyModifiers:Z.KeyModifiers.Control}},flipHorizontal:{execute:this.flipCommand.bind(this,"horizontal"),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.H,keyModifiers:Z.KeyModifiers.Control}},flipVertical:{execute:this.flipCommand.bind(this,"vertical"),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.J,keyModifiers:Z.KeyModifiers.Control}},pointerTool:{execute:this.toolCommand.bind(this,"pointer"),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.Number1,keyModifiers:Z.KeyModifiers.Control}},textTool:{execute:this.toolCommand.bind(this,"text"),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.Number2,keyModifiers:Z.KeyModifiers.Control}},connectTool:{execute:this.toolCommand.bind(this,"connect"),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.Number3,keyModifiers:Z.KeyModifiers.Control}},freeForm:{execute:this.toolCommand.bind(this,"freeForm"),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.Number5,keyModifiers:Z.KeyModifiers.Control}},lineTool:{execute:this.toolCommand.bind(this,"line"),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.Number6,keyModifiers:Z.KeyModifiers.Control}},rectangleTool:{execute:this.toolCommand.bind(this,"rectangle"),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.Number8,keyModifiers:Z.KeyModifiers.Control}},ellipseTool:{execute:this.toolCommand.bind(this,"ellipse"),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.Number9,keyModifiers:Z.KeyModifiers.Control}},zoomIn:{execute:this.zoomCommand.bind(this,"zoomIn"),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.Plus,keyModifiers:Z.KeyModifiers.Control}},zoomOut:{execute:this.zoomCommand.bind(this,"zoomOut"),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.Minus,keyModifiers:Z.KeyModifiers.Control}},shiftUp:{execute:this.shiftCommand.bind(this,"Up"),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.Up,keyModifiers:Z.KeyModifiers.Shift}},shiftDown:{execute:this.shiftCommand.bind(this,"Down"),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.Down,keyModifiers:Z.KeyModifiers.Shift}},shiftLeft:{execute:this.shiftCommand.bind(this,"Left"),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.Left,keyModifiers:Z.KeyModifiers.Shift}},shiftRight:{execute:this.shiftCommand.bind(this,"Right"),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.Right,keyModifiers:Z.KeyModifiers.Shift}},alignTextCenter:{execute:this.alignCommand.bind(this,"center"),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.C,keyModifiers:Z.KeyModifiers.Control|Z.KeyModifiers.Shift}},alignTextLeft:{execute:this.alignCommand.bind(this,"right"),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.L,keyModifiers:Z.KeyModifiers.Control|Z.KeyModifiers.Shift}},alignTextRight:{execute:this.alignCommand.bind(this,"left"),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.R,keyModifiers:Z.KeyModifiers.Control|Z.KeyModifiers.Shift}},alignTextTop:{execute:this.alignCommand.bind(this,"top"),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.E,keyModifiers:Z.KeyModifiers.Control|Z.KeyModifiers.Shift}},alignTextCenterVertical:{execute:this.alignCommand.bind(this,"centerVertical"),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.M,keyModifiers:Z.KeyModifiers.Control|Z.KeyModifiers.Shift}},alignTextBottom:{execute:this.alignCommand.bind(this,"bottom"),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.V,keyModifiers:Z.KeyModifiers.Control|Z.KeyModifiers.Shift}},alignJustify:{execute:this.alignCommand.bind(this,"justify"),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.J,keyModifiers:Z.KeyModifiers.Control|Z.KeyModifiers.Shift}},sendToBack:{execute:this.orderCommand.bind(this,"sendToBack"),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.B,keyModifiers:Z.KeyModifiers.Control|Z.KeyModifiers.Shift}},bringToFront:{execute:this.orderCommand.bind(this,"bringToFront"),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.F,keyModifiers:Z.KeyModifiers.Control|Z.KeyModifiers.Shift}},sendBackward:{execute:this.orderCommand.bind(this,"sendBackward"),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.BracketLeft,keyModifiers:Z.KeyModifiers.Control}},bringForward:{execute:this.orderCommand.bind(this,"bringForward"),canExecute:this.canExecute.bind(this),gesture:{key:Z.Keys.BracketRight,keyModifiers:Z.KeyModifiers.Control}}};this.initCommandManager(t,e)},G.prototype.overrideCommands=function(t,e){for(var i=0,n=Object.keys(e);i<n.length;i++){var r=n[i],o=e[""+r];if(t.gesture.key===o.gesture.key&&t.gesture.keyModifiers===o.gesture.keyModifiers){delete e[""+r];break}}},G.prototype.initCommandManager=function(t,e){var i=0;if(t)for(i=0;i<t.length;i++)e[t[parseInt(i.toString(),10)].name]&&t[parseInt(i.toString(),10)]?(t[parseInt(i.toString(),10)].canExecute&&(e[t[parseInt(i.toString(),10)].name].canExecute=t[parseInt(i.toString(),10)].canExecute),t[parseInt(i.toString(),10)].execute&&(e[t[parseInt(i.toString(),10)].name].execute=t[parseInt(i.toString(),10)].execute),(t[parseInt(i.toString(),10)].gesture.key||t[parseInt(i.toString(),10)].gesture.keyModifiers)&&(e[t[parseInt(i.toString(),10)].name].gesture=t[parseInt(i.toString(),10)].gesture),""!==t[parseInt(i.toString(),10)].parameter&&(e[t[parseInt(i.toString(),10)].name].parameter=t[parseInt(i.toString(),10)].parameter)):(this.overrideCommands(t[parseInt(i.toString(),10)],e),e[t[parseInt(i.toString(),10)].name]={execute:t[parseInt(i.toString(),10)].execute,canExecute:t[parseInt(i.toString(),10)].canExecute,gesture:t[parseInt(i.toString(),10)].gesture,parameter:t[parseInt(i.toString(),10)].parameter});this.commands=e},G.prototype.updateNodeEdges=function(t){for(var e=0,i=t.inEdges;e<i.length;e++){var n=i[e];this.nameTable[""+n]&&(this.nameTable[""+n].targetID="")}for(var r=0,o=t.outEdges;r<o.length;r++){n=o[r];this.nameTable[""+n]&&(this.nameTable[""+n].sourceID="")}t.inEdges=[],t.outEdges=[]},G.prototype.updateIconVisibility=function(t,e){for(var i=0;i<t.wrapper.children.length;i++){var n,r=t.wrapper.children[parseInt(i.toString(),10)];r.id&&(n=r.id.split(t.id)[1])&&n.match("^_icon")&&(r.visible=e,this.updateDiagramContainerVisibility(r,e))}},G.prototype.updateEdges=function(t){var e;void 0!==t.sourceID&&""!==t.sourceID&&((e=this.nameTable[t.sourceID])&&e.outEdges&&0===e.outEdges.length&&(e.outEdges=[]),e&&e.outEdges&&-1===e.outEdges.indexOf(t.id)&&e.outEdges.push(t.id),this.updatePortEdges(e,t,!1)),void 0!==t.targetID&&""!==t.targetID&&((e=this.nameTable[t.targetID])&&e.inEdges&&0===e.inEdges.length&&(e.inEdges=[]),e&&e.inEdges&&-1===e.inEdges.indexOf(t.id)&&e.inEdges.push(t.id),this.updatePortEdges(e,t,!0),e)&&e.visible&&e.outEdges&&(t=0!==e.outEdges.length,this.updateIconVisibility(e,t))},G.prototype.updatePortEdges=function(t,e,i){if(t)for(var n=0;n<t.ports.length;n++){var r=t.ports[parseInt(n.toString(),10)],o=i?e.targetPortID:e.sourcePortID;r.id===o&&-1===(o=i?r.inEdges:r.outEdges).indexOf(e.id)&&o.push(e.id)}},G.prototype.refreshDiagram=function(){this.initLayerObjects(),this.doLayout(),this.updateBridging(),this.scroller.setSize(),this.addBlazorDiagramObjects(),this.updateFitToPage()},G.prototype.updateCanupdateStyle=function(t,e){for(var i=0;i<t.length;i++)t[parseInt(i.toString(),10)].children&&this.updateCanupdateStyle(t[parseInt(i.toString(),10)].children,e),t[parseInt(i.toString(),10)].canApplyStyle=e},G.prototype.getZindexPosition=function(t,e){var i,n,r=[],o=void 0;if(r=(r=r.concat(this.nodes)).concat(this.connectors),n=t.children?this.commandHandler.findMaxZIndex(t):t.zIndex,t.zIndex!==Number.MIN_VALUE)for(var a=0;a<r.length;a++)if(r[parseInt(a.toString(),10)].zIndex>n){"HTML"!==t.shape.type&&"Native"!==t.shape.type||(i="HTML"===t.shape.type?"html":"native"),o=Xc(e,r[parseInt(a.toString(),10)].id,i);break}return o},G.prototype.updateDiagramObject=function(t,e,i){for(var n="domTable",r=0,o=this.views;r<o.length;r++){var a,s,h,d=o[r],d=this.views[""+d];this.diagramActions&&"SVG"===d.mode&&((a=void 0)===(a=1<this.layers.length?this.commandHandler.getObjectLayer(t.id):a)||a&&a.visible||i)&&(a=$c(this.element.id),window[n][d.element.id+"_diagramLayer"]||(window[n][d.element.id+"_diagramLayer"]=document.getElementById(d.element.id+"_diagramLayer")),s=window[n][d.element.id+"_diagramLayer"],this.diagramActions&Z.DiagramAction.Interactions&&this.updateCanupdateStyle(t.wrapper.children,!0),h=this.getMidPoint(t),this.diagramRenderer.updateNode(t.wrapper,s,a,void 0,e?void 0:this.getZindexPosition(t,d.element.id),h,this.portCenterPoint),this.updateCanupdateStyle(t.wrapper.children,!0))}},G.prototype.applyMarginBezier=function(t,e){e.cx=e.cx+t.margin.left,e.cx=e.cx-t.margin.right,e.cy=e.cy+t.margin.top,e.cy=e.cy-t.margin.bottom},G.prototype.getMidPoint=function(t){if(t instanceof W&&"Bezier"===t.type){for(var e=[],i=this.getBezierPoints(t),n=K.getLengthFromListOfPoints(i),r=0;r<t.annotations.length;r++)for(var o=t.annotations[parseInt(r.toString(),10)].offset,o=this.commandHandler.getPointAtLength(o*n,i,0),a={cx:o.x,cy:o.y},s=0;s<t.wrapper.children.length;s++)t.wrapper&&t.wrapper.children[parseInt(s.toString(),10)]instanceof H&&t.wrapper.children[parseInt(s.toString(),10)].id===t.id+"_"+t.annotations[parseInt(r.toString(),10)].id&&(this.applyMarginBezier(t.wrapper.children[parseInt(s.toString(),10)],a),e[t.id+"_"+t.annotations[parseInt(r.toString(),10)].id]=this.applyAlignment(t.wrapper.children[parseInt(s.toString(),10)],a,t.annotations[parseInt(r.toString(),10)].displacement));for(r=0;r<t.ports.length;r++)for(var h=t.ports[parseInt(r.toString(),10)].offset,h=this.commandHandler.getPointAtLength(h*n,i,0),d={cx:h.x,cy:h.y},s=0;s<t.wrapper.children.length;s++)t.wrapper&&t.wrapper.children[parseInt(s.toString(),10)]instanceof P&&t.wrapper.children[parseInt(s.toString(),10)].isPathPort&&t.wrapper.children[parseInt(s.toString(),10)].id===t.id+"_"+t.ports[parseInt(r.toString(),10)].id&&(this.applyMarginBezier(t.wrapper.children[parseInt(s.toString(),10)],d),this.portCenterPoint[t.id+"_"+t.ports[parseInt(r.toString(),10)].id]=this.applyAlignment(t.wrapper.children[parseInt(s.toString(),10)],d,t.ports[parseInt(r.toString(),10)].displacement))}return e},G.prototype.applyAlignment=function(t,e,i){switch(t.horizontalAlignment){case"Auto":case"Left":e.cx=t.inversedAlignment?e.cx:e.cx-t.desiredSize.width,e.cx+=i.x;break;case"Stretch":case"Center":e.cx-=t.desiredSize.width*t.pivot.x;break;case"Right":e.cx=t.inversedAlignment?e.cx-t.desiredSize.width:e.cx,e.cx-=i.x}switch(t.verticalAlignment){case"Auto":case"Top":e.cy=t.inversedAlignment?e.cy:e.cy-t.desiredSize.height,e.cy+=i.y;break;case"Stretch":case"Center":e.cy-=t.desiredSize.height*t.pivot.y;break;case"Bottom":e.cy=t.inversedAlignment?e.cy-t.desiredSize.height:e.cy,e.cy-=i.y}return e},G.prototype.getBezierPoints=function(t){var e,i=[],n={x:t.sourcePoint.x,y:t.sourcePoint.y};for(i.push(n),e=0;e<t.segments.length;e++){var r=t.segments[parseInt(e.toString(),10)].getPoints(t.segments[parseInt(e.toString(),10)],n);i.push.apply(i,r),n=i[i.length-1]}return i},G.prototype.updateGridContainer=function(t){for(var e=$c(this.element.id),i=0,n=this.views;i<n.length;i++){var r,o=n[i];"SVG"===(o=this.views[""+o]).mode&&this.diagramActions?(r=document.getElementById(o.element.id+"_diagramLayer"),this.diagramRenderer.updateNode(t,r,e,void 0)):this.refreshCanvasDiagramLayer(o)}},G.prototype.getObjectsOfLayer=function(t){for(var e=[],i=0,n=t;i<n.length;i++){var r=n[i];this.nameTable[""+r]&&e.push(this.nameTable[""+r])}return e},G.prototype.refreshDiagramLayer=function(){for(var t=0,e=this.views;t<e.length;t++){var i,n=e[t];switch((i=this.views[""+n]).mode){case"SVG":this.refreshSvgDiagramLayer(i);break;case"Canvas":this.refreshCanvasLayers(i)}}},G.prototype.refreshCanvasLayers=function(t){if(t)this.refreshCanvasDiagramLayer(t);else for(var e=0,i=this.views;e<i.length;e++){var n=i[e],n=this.views[""+n];this.refreshCanvasDiagramLayer(n)}},G.prototype.renderBasicElement=function(t){for(var e=$c(t.element.id),i=0;i<this.basicElements.length;i++){var n=this.basicElements[parseInt(i.toString(),10)];n instanceof te&&(n.prevRotateAngle=0),n.measure(new j(n.width,n.height)),n.arrange(n.desiredSize),t.diagramRenderer.renderElement(n,t.diagramLayer,e)}},G.prototype.refreshElements=function(t){var e=!1;if(!this.isDestroyed){this.clearCanvas(t),t instanceof G?(t.diagramLayer.getContext("2d").setTransform(t.scroller.currentZoom,0,0,t.scroller.currentZoom,0,0),t.diagramLayer.getContext("2d").scale(1.5,1.5)):(e=!0,0<(n=document.getElementById(t.element.id+"_nativeLayer")).children.length&&t.updateView(t));var i=$c(t.element.id);this.renderDiagramElements(t.diagramLayer,t.diagramRenderer,i,void 0,void 0,e);for(var n,r=0;r<this.basicElements.length;r++)(n=this.basicElements[parseInt(r.toString(),10)]).measure(new j(n.width,n.height)),n.arrange(n.desiredSize),t.diagramRenderer.renderElement(n,t.diagramLayer,i);t instanceof G&&(t.diagramLayer.style.transform="scale("+2/3+")",t.diagramLayer.style.transformOrigin="0 0"),this.renderTimer=null}},G.prototype.refreshCanvasDiagramLayer=function(t){var e=this;"SVG"===t.mode||this.isDestroyed||(0<this.basicElements.length&&this.renderBasicElement(t),!this.diagramActions||0==(this.diagramActions&Z.DiagramAction.Render)||Z.DiagramAction.ToolAction&this.diagramActions||Ln(this)||1!==this.scroller.currentZoom?this.refreshElements(t):this.renderTimer||(this.renderTimer=setTimeout(function(){e.refreshElements(t)},40)))},G.prototype.updatePortVisibility=function(t,e,i){var n,r=!this.drawingObject||!this.drawingObject.shape;if((t instanceof _||t instanceof W)&&r&&bn(t)){for(var o=t.ports,a=!1,s=0;s<o.length;s++)n=this.getWrapper(t.wrapper,o[parseInt(s.toString(),10)].id),(e&Z.PortVisibility.Hover||e&Z.PortVisibility.Connect)&&Zh(o[parseInt(s.toString(),10)],e)&&(n.visible=!i,a=!0);a&&this.updateDiagramObject(t),"Canvas"===this.mode&&this.refreshCanvasLayers()}},G.prototype.refreshSvgDiagramLayer=function(t){var e,i=document.getElementById(t.element.id+"_diagramLayer"),n=$c(t.element.id);if(Ln(this))this.scroller.virtualizeElements();else{for(var r=0;r<this.basicElements.length;r++)(e=this.basicElements[parseInt(r.toString(),10)]).measure(new j(e.width,e.height)),e.arrange(e.desiredSize,!(this.diagramActions&Z.DiagramAction.Render)),this.diagramRenderer.renderElement(e,i,n);this.renderDiagramElements(i,this.diagramRenderer,n)}},G.prototype.removeVirtualObjects=function(t){if(this.deleteVirtualObject){for(var e=0;e<this.scroller.removeCollection.length;e++){var i=this.nameTable[this.scroller.removeCollection[parseInt(e.toString(),10)]];void 0!==i&&this.removeElements(i)}this.deleteVirtualObject=!1}clearInterval(t)},G.prototype.updateTextElementValue=function(t){for(var e=0;e<t.wrapper.children.length;e++){var i,n,r,o=t.wrapper.children[parseInt(e.toString(),10)];o instanceof H&&(o.canMeasure=!0,i=this.scroller.viewPortHeight,n=this.scroller.viewPortWidth,r=!1,(r=t.offsetX<n&&t.offsetY<i?!0:r)&&Ln(this)&&void 0===o.actualSize.height&&void 0===o.actualSize.width&&(t.wrapper.measure(new j(t.width,t.height),t.id,this.onLoadImageSize.bind(this)),t.wrapper.arrange(t.wrapper.desiredSize)),o.measure(new j(t.width,t.height)),o.arrange(o.desiredSize))}},G.prototype.updateVirtualObjects=function(t,e,i){var n=document.getElementById(this.element.id+"_diagramLayer"),r=$c(this.element.id);if("SVG"===this.mode){for(var o=0;o<t.length;o++){var a=this.scroller.removeCollection.indexOf(t[parseInt(o.toString(),10)]),a=(0<=a&&this.scroller.removeCollection.splice(a,1),this.nameTable[t[parseInt(o.toString(),10)]]);this.updateTextElementValue(a),this.diagramRenderer.renderElement(a.wrapper,n,r,void 0,void 0,void 0,void 0,a.zIndex)}for(var s=0;s<i.length;s++)this.scroller.removeCollection.push(i[parseInt(s.toString(),10)]);1!==this.scroller.currentZoom&&this.eventHandler.updateVirtualization()}else this.diagramActions&&this.refreshDiagramLayer()},G.prototype.renderDiagramElements=function(t,e,i,n,r,o){void 0===n&&(n=!0);for(var a,s=this.scroller.getPageBounds(),h=(s.x*=this.scroller.currentZoom,s.y*=this.scroller.currentZoom,s.width*=this.scroller.currentZoom,s.height*=this.scroller.currentZoom,-this.scroller.horizontalOffset-s.x),d=-this.scroller.verticalOffset-s.y,l=0,c=Object.keys(this.layerZIndexTable);l<c.length;l++){var p=c[l],g=this.commandHandler.getLayer(this.layerZIndexTable[""+p]),u=void 0,m=void 0,f=("Canvas"===this.mode&&Ln(this)&&!this.diagramActions&&this.scroller.virtualizeElements(),"Canvas"===this.mode&&Ln(this)&&0<this.scroller.oldCollectionObjects.length?this.scroller.oldCollectionObjects:void 0),p=Object.keys(f||g.zIndexTable);p.sort(function(t,e){return parseInt(""+t,10)-parseInt(""+e,10)});for(var y=0,v=p;y<v.length;y++){var b=v[y],S=f?this.nameTable[f[""+b]]:this.nameTable[g.zIndexTable[""+b]];if(S&&!S.parentId&&g.visible&&(!S.processId||this.refreshing)){var b=void 0,b=this.scroller.currentZoom<1&&"SVG"===this.mode?{tx:-s.x/this.scroller.currentZoom,ty:-s.y/this.scroller.currentZoom,scale:this.scroller.transform.scale}:{tx:this.scroller.transform.tx,ty:this.scroller.transform.ty,scale:this.scroller.transform.scale},w=(o&&(b={tx:-s.x/this.scroller.currentZoom,ty:-s.y/this.scroller.currentZoom,scale:this.scroller.transform.scale}),Ln(this)&&(this.scroller.currentZoom<1?(m=s.x<0||this.scroller.horizontalOffset<0?(w=this.scroller.verticalOffset<0?this.scroller.verticalOffset:0,u=(0<h?h:0)+"px",(this.realActions&Z.RealAction.vScrollbarMoved?0:-w)+"px"):u="0px",this.realActions&Z.RealAction.hScrollbarMoved&&(this.realActions=this.realActions&~Z.RealAction.hScrollbarMoved),this.realActions&Z.RealAction.vScrollbarMoved&&(this.realActions=this.realActions&~Z.RealAction.vScrollbarMoved)):(u=(s.x<0?h:-this.scroller.horizontalOffset)+"px",m=(s.y<0?d:-this.scroller.verticalOffset)+"px"),this.diagramLayer.style.left=u,this.diagramLayer.style.top=m,b.tx=-s.x/b.scale,b.ty=-s.y/b.scale),r?!1:!0);if(this.updateTextElementValue(S),this.refreshing&&S.shape.activity&&S.shape.activity.subProcess&&S.shape.activity.subProcess.processes){for(var x=0;x<S.shape.activity.subProcess.processes.length;x++){var I=S.shape.activity.subProcess.processes[parseInt(x.toString(),10)];S.wrapper.children.push(this.nameTable[""+I].wrapper)}S.wrapper.measure(new j(S.wrapper.bounds.width,S.wrapper.bounds.height)),S.wrapper.arrange(S.wrapper.desiredSize)}S instanceof W&&"Bezier"===S.type?(a=this.getMidPoint(S),"Canvas"===this.mode&&n&&(a.cx+=b.tx,a.cy+=b.ty)):a=null,e.renderElement(S.wrapper,t,i,!e.isSvgMode&&n?b:void 0,void 0,void 0,w&&(!this.diagramActions||o),void 0,void 0,a,this.portCenterPoint)}}}},G.prototype.updateBridging=function(t){if(this.bridgingModule)for(var e=0;e<this.connectors.length;e++){var i,n,r=this.connectors[parseInt(e.toString(),10)],o=(this.bridgingModule.updateBridging(r,this),this.connectors[parseInt(e.toString(),10)].wrapper);o&&o.children&&0<o.children.length&&(n=(i=o.children[0]).data,(r.isBezierEditing&&this.selectedItems.connectors[0].id===r.id||"Bezier"!==r.type)&&r.getSegmentElement(r,i,"ComplexHierarchicalTree"===this.layout.type||"HierarchicalTree"===this.layout.type?this.layout.orientation:void 0,void 0,!1),i.data!==n)&&(o.measure(new j),o.arrange(o.desiredSize),"SVG"!==this.mode||t||this.updateDiagramObject(r))}else this.constraints&Z.DiagramConstraints.Bridging&&console.warn('[WARNING] :: Module "ConnectorBridging" is not available in Diagram component! You either misspelled the module name or forgot to load it.')},G.prototype.setCursor=function(t){this.diagramRenderer.setCursor(this.diagramCanvas,t)},G.prototype.clearCanvas=function(t){var e=t.contentWidth||t.diagramLayer.width/this.scroller.currentZoom,i=t.contentHeight||t.diagramLayer.height/this.scroller.currentZoom;"SVG"!==t.mode&&Op.getContext(t.diagramLayer).clearRect(0,0,e,i)},G.prototype.updateScrollOffset=function(){this.scroller.setScrollOffset(this.diagramCanvas.scrollLeft,this.diagramCanvas.scrollTop),Ss(this),Ln(this)&&this.scroller.virtualizeElements()},G.prototype.setOffset=function(t,e){var i="domTable",i=(window[i][this.element.id+"content"]||(window[i][this.element.id+"content"]=document.getElementById(this.element.id+"content")),window[i][this.element.id+"content"]);i&&(i.scrollLeft=t,i.scrollTop=e)},G.prototype.setSize=function(t,e){var i,n,r,o;this.diagramLayer&&!this.preventDiagramUpdate&&(t-=(r=xs(this)).width,e-=r.height,(r=this.spatialSearch.getPageBounds()).x*=this.scroller.currentZoom,r.y*=this.scroller.currentZoom,r.width*=this.scroller.currentZoom,r.height*=this.scroller.currentZoom,r="SVG"===this.mode?1:1.5,n="SVG"===this.mode?Yc(this.element.id):this.diagramLayer,i="Canvas"===this.mode&&this.constraints&Z.DiagramConstraints.Virtualization?this.scroller.viewPortWidth:t,o="Canvas"===this.mode&&this.constraints&Z.DiagramConstraints.Virtualization?this.scroller.viewPortHeight:e,n.setAttribute("width",(r*i).toString()),n.setAttribute("height",(r*o).toString()),(i=document.getElementById(this.element.id+"_diagramUserHandleLayer"))&&(i.style.width=t+"px",i.style.height=e+"px"),n={width:t.toString(),height:e.toString()},this.diagramLayerDiv.style.width=t+"px",this.diagramLayerDiv.style.height=e+"px",ap(Zc(this.element.id),n),ap(Y(this.element.id).getElementsByClassName("e-ports-expand-layer")[0],n),ap(r=Vc(this.element.id),n),r.parentNode.style.width=t+"px",r.parentNode.style.height=e+"px",ap(o=Kc(this.element.id),n),this.diagramRenderer.updateGrid(this.snapSettings,o,this.scroller.transform,this.rulerSettings,this.hRuler,this.vRuler),ap(qc(this.element.id),n),this.htmlLayer.style.width=t+"px",this.htmlLayer.style.height=e+"px","SVG"===this.mode||Ln(this)||this.refreshDiagramLayer(),"SVG"===this.mode)&&Ln(this)&&this.scroller.virtualizeElements()},G.prototype.transformLayers=function(){var t=this.spatialSearch.getPageBounds();t.x*=this.scroller.currentZoom,t.y*=this.scroller.currentZoom,t.width*=this.scroller.currentZoom,t.height*=this.scroller.currentZoom,this.diagramRenderer.updateGrid(this.snapSettings,Kc(this.element.id),this.scroller.transform,this.rulerSettings,this.hRuler,this.vRuler),this.diagramRenderer.transformLayers(this.scroller.transform,"SVG"===this.mode),this.diagramActions&Z.DiagramAction.DragUsingMouse||this.updateSelector(),this.renderPageBreaks(t)},G.prototype.removePageBreaks=function(){if(this.diagramLayer){var t=Qc(this.element.id);if(t&&t.childNodes)for(var e=t.childNodes.length,i=0;i<e;i++)t.removeChild(t.childNodes[0])}},G.prototype.renderPageBreaks=function(t){this.removePageBreaks();var e=Qc(this.element.id);if(e){var i=0,n=(t=this.scroller.getPageBounds(!0),(this.scroller.transform.tx+t.x)*this.scroller.currentZoom),r=(this.scroller.transform.ty+t.y)*this.scroller.currentZoom,o=t.height*this.scroller.currentZoom,a=t.width*this.scroller.currentZoom,n=(Fs.renderSvgBackGroundImage(this.pageSettings.background,this.element,n,r,a,o),{id:e.id+"rect",x:n,y:r,height:o,width:a,angle:0,stroke:"",strokeWidth:1,fill:this.pageSettings.background.color,opacity:1,pivotX:0,pivotY:0,visible:!0,dashArray:"0"});if(this.diagramRenderer.drawRect(e,n),this.pageSettings.showPageBreaks)for(var s=this.scroller.getPageBreak(t),i=0;i<s.length;i++)this.diagramRenderer.drawLine(e,{class:"e-diagram-page-break",fill:"none",stroke:"#aaaaaa",strokeWidth:1,dashArray:"10 10",opacity:2,x:0,y:0,width:0,height:0,angle:0,pivotX:0,pivotY:0,visible:!0,startPoint:{x:(s[parseInt(i.toString(),10)].x1+this.scroller.transform.tx)*this.scroller.currentZoom,y:(s[parseInt(i.toString(),10)].y1+this.scroller.transform.ty)*this.scroller.currentZoom},endPoint:{x:(s[parseInt(i.toString(),10)].x2+this.scroller.transform.tx)*this.scroller.currentZoom,y:(s[parseInt(i.toString(),10)].y2+this.scroller.transform.ty)*this.scroller.currentZoom},id:s[parseInt(i.toString(),10)].y1===s[parseInt(i.toString(),10)].y2?"HorizontalLines":"VerticalLines"})}},G.prototype.validatePageSize=function(){var t=0;"Portrait"===this.pageSettings.orientation?this.pageSettings.width>this.pageSettings.height&&(t=this.pageSettings.height,this.pageSettings.height=this.pageSettings.width,this.pageSettings.width=t):this.pageSettings.height>this.pageSettings.width&&(t=this.pageSettings.width,this.pageSettings.width=this.pageSettings.height,this.pageSettings.height=t)},G.prototype.setOverview=function(t,e){if(t)this.views.push(t.id),(this.views[t.id]=t).renderDocument(t),t.diagramRenderer.setLayers(),t.updateView(t),this.renderNodes(t);else{for(var i=0;i<this.views.length;i++)this.views[parseInt(i.toString(),10)]===e&&(t=this.views[""+e]);this.views[""+e]=void 0;var n=this.views.indexOf(e);this.views.splice(n,1)}},G.prototype.renderNodes=function(t){var e,i,n;t&&(e=new Fs(t.id,new Xs,!1),i=document.getElementById(t.element.id+"_diagramLayer"),n=$c(t.element.id),this.renderDiagramElements(i,t.diagramRenderer||e,n,void 0,void 0,!0))},G.prototype.updateThumbConstraints=function(t,e,i){for(var n=t.length,r=0;r<n;r++){var o=t[parseInt(r.toString(),10)],a=e.thumbsConstraints,s=!1;this.nameTable[o.parentId]&&(s=this.nameTable[o.parentId].isLane),o instanceof _?(s="Bpmn"===o.shape.type&&"Activity"===o.shape.shape&&!1===o.shape.activity.subProcess.collapsed||"SwimLane"===o.shape.type||s,Cn(o)&&a&Z.ThumbsConstraints.Rotate&&!s||(a&=~Z.ThumbsConstraints.Rotate),Mn(o,"SouthEast")&&a&Z.ThumbsConstraints.ResizeSouthEast||(a&=~Z.ThumbsConstraints.ResizeSouthEast),Mn(o,"NorthWest")&&a&Z.ThumbsConstraints.ResizeNorthWest||(a&=~Z.ThumbsConstraints.ResizeNorthWest),Mn(o,"East")&&a&Z.ThumbsConstraints.ResizeEast||(a&=~Z.ThumbsConstraints.ResizeEast),Mn(o,"West")&&a&Z.ThumbsConstraints.ResizeWest||(a&=~Z.ThumbsConstraints.ResizeWest),Mn(o,"North")&&a&Z.ThumbsConstraints.ResizeNorth||(a&=~Z.ThumbsConstraints.ResizeNorth),Mn(o,"South")&&a&Z.ThumbsConstraints.ResizeSouth||(a&=~Z.ThumbsConstraints.ResizeSouth),Mn(o,"NorthEast")&&a&Z.ThumbsConstraints.ResizeNorthEast||(a&=~Z.ThumbsConstraints.ResizeNorthEast),Mn(o,"SouthWest")&&a&Z.ThumbsConstraints.ResizeSouthWest||(a&=~Z.ThumbsConstraints.ResizeSouthWest)):o instanceof W?(i||(a|=Z.ThumbsConstraints.Default),wn(o)?a|=Z.ThumbsConstraints.ConnectorSource:a&=~Z.ThumbsConstraints.ConnectorSource,xn(o)?a|=Z.ThumbsConstraints.ConnectorTarget:a&=~Z.ThumbsConstraints.ConnectorTarget):(i||(a|=Z.ThumbsConstraints.Default),Mn(o)||(a&=~(Z.ThumbsConstraints.ResizeSouthEast|Z.ThumbsConstraints.ResizeSouthWest|Z.ThumbsConstraints.ResizeSouth|Z.ThumbsConstraints.ResizeEast|Z.ThumbsConstraints.ResizeWest|Z.ThumbsConstraints.ResizeNorth|Z.ThumbsConstraints.ResizeNorthEast|Z.ThumbsConstraints.ResizeNorthWest)),Cn(o)||(a&=~Z.ThumbsConstraints.Rotate)),e.thumbsConstraints=a}},G.prototype.renderSelector=function(t,e,i){var n=this.isProtectedOnChange,r=new j,o=this.selectedItems,a=(o.constraints,this.diagramRenderer.rendererActions);document.getElementsByClassName("blazor-inner-template");if(this.diagramRenderer.rendererActions=this.currentSymbol?this.addConstraints(a,Z.RendererAction.DrawSelectorBorder):this.removeConstraints(a,Z.RendererAction.DrawSelectorBorder),this.clearSelectorLayer(),this.commandHandler.hasSelection()){if(1===o.nodes.length&&0===o.connectors.length&&(o.rotateAngle=o.nodes[0].rotateAngle,o.pivot=o.nodes[0].pivot),o.wrapper.measure(r),o.wrapper.arrange(o.wrapper.desiredSize),o.width=o.wrapper.actualSize.width,o.height=o.wrapper.actualSize.height,o.offsetX=o.wrapper.offsetX,o.offsetY=o.wrapper.offsetY,0!==o.rotateAngle){for(var s=0,h=o.nodes;s<h.length;s++){var d=h[s];d.offsetX=d.wrapper.offsetX,d.offsetY=d.wrapper.offsetY}for(var l=0,c=o.connectors;l<c.length;l++)c[l]}this.spatialSearch.getPageBounds();var p,g,u,a=Fc(this.element.id),r=Gc(this.element.id);o.thumbsConstraints=Z.ThumbsConstraints.Default,o.annotation?this.updateThumbConstraints([o.annotation],o):(this.updateThumbConstraints(o.nodes,o),this.updateThumbConstraints(o.connectors,o,!0)),o.annotation?this.renderSelectorForAnnotation(o,a):o.nodes.length+o.connectors.length===1||this.nameTable.helper?o.nodes[0]instanceof _?(!Ur(this,p=o.nodes[0])||e||"UmlClassifier"===p.shape.type||p.parentId&&this.nameTable[p.parentId]&&"UmlClassifier"===this.nameTable[p.parentId].shape.type||(o.thumbsConstraints&=~Z.ThumbsConstraints.Rotate),g=!!e||!!(p.constraints&Z.NodeConstraints.HideThumbs),u=!!("SwimLane"===p.shape.type||p.isLane||p.isPhase||e),this.diagramRenderer.renderResizeHandle(e?i:o.wrapper.children[0],a,o.thumbsConstraints,this.scroller.currentZoom,o.constraints,this.scroller.transform,void 0,bn(p),g,u,o.handleSize)):o.connectors[0]instanceof W&&Vn(this.diagramRenderer.rendererActions)&&(e=o.connectors[0],this.diagramRenderer.renderEndPointHandle(e,a,o.thumbsConstraints,o.constraints,this.scroller.transform,void 0!==e.sourceWrapper,void 0!==e.targetWrapper,!(!this.connectorEditingToolModule||!In(e)),!!this.connectorEditingToolModule,o.handleSize)):this.diagramRenderer.renderResizeHandle(o.wrapper,a,o.thumbsConstraints,this.scroller.currentZoom,o.constraints,this.scroller.transform,void 0,bn(o),null,null,o.handleSize),o.annotation||this.currentSymbol||this.diagramRenderer.renderUserHandler(o,a,this.scroller.transform,r,this.eventHandler.currentAction,this.eventHandler.inAction)}1<this.selectedItems.selectedObjects.length&&this.updateSelectionRectangle(),this.isProtectedOnChange=n},G.prototype.updateSelectionRectangle=function(){for(var t,e=Fc(this.element.id),i=0;i<this.selectedItems.selectedObjects.length;i++)t=0===i,ld(this.selectedItems.selectedObjects[parseInt(i.toString(),10)])===W?this.diagramRenderer.renderSelectionLine(this.selectedItems.selectedObjects[parseInt(i.toString(),10)].wrapper.children[0],e,this.scroller.transform,t):this.diagramRenderer.renderSelectionRectangle(this.selectedItems.selectedObjects[parseInt(i.toString(),10)].wrapper,e,this.scroller.transform,t)},G.prototype.updateSelector=function(){var t=this.allowServerDataBinding,e=(this.enableServerDataBinding(!1),new j),i=this.selectedItems,n=i.constraints;document.getElementsByClassName("blazor-inner-template");if(this.diagramActions&Z.DiagramAction.ToolAction||1!==this.selectedItems.nodes.length||(this.selectedItems.rotateAngle=this.selectedItems.nodes[0].rotateAngle,this.selectedItems.wrapper.rotateAngle=this.selectedItems.nodes[0].rotateAngle),void 0!==this.selectedItems&&(this.clearSelectorLayer(),null!==i.wrapper)&&i.wrapper.children&&i.wrapper.children.length){var r=!0,o=!0;if(Cd(this,i)&&(d=(l=this.eventHandler.action).includes("Rotate"),l=l.includes("None")||l.includes("Select")||l.includes("Drag"),(d||l)&&(o=!1),l||(r=!1)),r&&(i.wrapper.measure(e),i.wrapper.arrange(i.wrapper.desiredSize)),0!==i.rotateAngle||i.rotateAngle!==i.wrapper.prevRotateAngle)for(var a=0,s=i.nodes;a<s.length;a++){var h=s[a];h.offsetX=h.wrapper.offsetX,h.offsetY=h.wrapper.offsetY}i.width=i.wrapper.actualSize.width,i.height=i.wrapper.actualSize.height,i.offsetX=i.wrapper.offsetX,i.offsetY=i.wrapper.offsetY;var d=Fc(this.element.id),l=Gc(this.element.id),r=this.eventHandler.canHideResizers();i.thumbsConstraints=Z.ThumbsConstraints.Default,i.annotation?this.updateThumbConstraints([i.annotation],i):(this.updateThumbConstraints(i.nodes,i),this.updateThumbConstraints(i.connectors,i,!0)),this.selectedItems.constraints&Z.SelectorConstraints.UserHandle&&!i.annotation&&!this.currentSymbol&&this.diagramRenderer.renderUserHandler(i,d,this.scroller.transform,l,this.eventHandler.currentAction,this.eventHandler.inAction),i.annotation?this.renderSelectorForAnnotation(i,d):i.nodes.length+i.connectors.length===1?i.connectors[0]instanceof W&&Vn(this.diagramRenderer.rendererActions)?(e=i.connectors[0],this.diagramRenderer.renderEndPointHandle(e,d,i.thumbsConstraints,n,this.scroller.transform,void 0!==e.sourceWrapper,void 0!==e.targetWrapper,!(!this.connectorEditingToolModule||!In(e)),!!this.connectorEditingToolModule,i.handleSize)):i.nodes[0]instanceof _&&(l=i.nodes[0],!Ur(this,i.nodes[0])||"UmlClassifier"===l.shape.type||l.parentId&&this.nameTable[l.parentId]&&"UmlClassifier"===this.nameTable[l.parentId].shape.type||(i.thumbsConstraints&=~Z.ThumbsConstraints.Rotate),n=!("SwimLane"!==l.shape.type&&!l.isLane&&!l.isPhase),this.diagramRenderer.renderResizeHandle(i.wrapper.children[0],d,i.thumbsConstraints,this.scroller.currentZoom,i.constraints,this.scroller.transform,r,bn(i.nodes[0]),!!(i.nodes[0].constraints&Z.NodeConstraints.HideThumbs),n,i.handleSize)):(this.diagramActions&Z.DiagramAction.Interactions&&(this.diagramRenderer.rendererActions=this.diagramRenderer.rendererActions|Z.RendererAction.PreventRenderSelector),Cd(this,i)&&o||this.diagramRenderer.renderResizeHandle(i.wrapper,d,i.thumbsConstraints,this.scroller.currentZoom,i.constraints,this.scroller.transform,r,bn(i),null,null,i.handleSize),this.diagramRenderer.rendererActions=this.diagramRenderer.rendererActions&~Z.RendererAction.PreventRenderSelector)}1<this.selectedItems.selectedObjects.length&&this.updateSelectionRectangle(),this.enableServerDataBinding(t)},G.prototype.renderSelectorForAnnotation=function(t,e){this.diagramRenderer.renderResizeHandle(t.wrapper.children[0],e,t.thumbsConstraints,this.scroller.currentZoom,t.constraints,this.scroller.transform,void 0,bn(t.annotation),void 0,void 0,t.handleSize)},G.prototype.drawSelectionRectangle=function(t,e,i,n){this.clearSelectorLayer(),this.diagramRenderer.drawSelectionRectangle(t,e,i,n,this.adornerLayer,this.scroller.transform)},G.prototype.renderHighlighter=function(t){var e=Vc(this.element.id);this.diagramRenderer.renderHighlighter(t,e,this.scroller.transform)},G.prototype.clearHighlighter=function(){var t=Vc(this.element.id),t=t.getElementById(t.id+"_highlighter");t&&t.parentNode.removeChild(t)},G.prototype.getNodesConnectors=function(t){for(var e=0;e<this.nodes.length;e++){var i=this.nodes[parseInt(e.toString(),10)];t.push(i)}for(e=0;e<this.connectors.length;e++){var n=this.connectors[parseInt(e.toString(),10)];t.push(n)}return t},G.prototype.clearSelectorLayer=function(){var t=Vc(this.element.id);document.getElementsByClassName("blazor-inner-template");if(this.currentSymbol){var e=t.getElementById("borderRect_symbol");e&&e.parentNode.removeChild(e)}else{var e=t.getElementById(this.adornerLayer.id+"_selected_region"),i=(e&&e.parentNode.removeChild(e),this.clearHighlighter(),Fc(this.element.id).childNodes),n=void 0,r=this.eventHandler.touchArgs?this.eventHandler.touchArgs.target.id:void 0;r&&r.includes("bezierLine")&&(r=void 0);for(var o=i.length;0<o;o--)this.eventHandler&&this.eventHandler.touchArgs&&"touchmove"===this.eventHandler.touchArgs.type&&(this.diagramRenderer.touchMove=!0,r)&&r===i[o-1].id||(n=i[o-1]).parentNode.removeChild(n);if(!N.isBlazor())for(var a=Gc(this.element.id).childNodes,s=a.length;0<s;s--)a[s-1].parentNode.removeChild(a[s-1])}},G.prototype.getWrapper=function(t,e){e=t.id+"_"+e;for(var i,n=t instanceof F?t:this.getPortContainer(this.nameTable[t.id]),r=0;r<n.children.length;r++)e===n.children[parseInt(r.toString(),10)].id&&(i=n.children[parseInt(r.toString(),10)]);return i},G.prototype.getEndNodeWrapper=function(t,e,i){if("Bpmn"===t.shape.type&&t.wrapper.children[0]instanceof F){if(N.isBlazor()||"Activity"!==t.shape.shape)return("Group"===t.shape.shape?t.wrapper:t.wrapper.children[0]).children[0];if(i&&"Transaction"===t.shape.activity.subProcess.type&&e.sourcePortID){var n=e.sourcePortID,i=t.wrapper.children[0].children[0].children[2];if(i.children)for(var r=0,o=i.children;r<o.length;r++){var a=o[r];if(a.visible&&a.id===t.id+"_"+n)return a.children[0]}}return t.wrapper.children[0].children[0].children[0]}return this.containsMargin(t.wrapper.children[0])||t.children?t.wrapper:t.wrapper.children[0]},G.prototype.containsMargin=function(t){return t.margin&&(0!==t.margin.left||0!==t.margin.top||0!==t.margin.right||0!==t.margin.bottom)},G.prototype.focusOutEdit=function(){this.endEdit(),"Canvas"===this.mode&&1!==this.scroller.currentZoom&&this.refreshDiagramLayer()},G.prototype.endEditCommand=function(){this.endEdit(),this.textEditing=!1,"Canvas"===this.mode&&1!==this.scroller.currentZoom&&this.refreshDiagramLayer()},G.prototype.fontStyleCommand=function(t){for(var e=0;e<this.selectedItems.nodes.length;e++){var i,n=this.selectedItems.nodes[parseInt(e.toString(),10)];"SwimLane"===n.shape.type&&n.shape.hasHeader&&this.applyStyleText(t,n.shape.header.annotation),n.isLane&&(i=this.getObject(n.shape.header[0].id),this.applyStyle(t,i.annotations)),"Text"===n.shape.type&&this.applyStyleText(t,n),0<n.annotations.length&&(r=n.annotations,this.applyStyle(t,r))}for(var r,e=0;e<this.selectedItems.connectors.length;e++)0<this.selectedItems.connectors[parseInt(e.toString(),10)].annotations.length&&(r=this.selectedItems.connectors[parseInt(e.toString(),10)].annotations,this.applyStyle(t,r))},G.prototype.applyStyle=function(t,e){for(var i=0;i<e.length;i++)switch(t){case"bold":e[parseInt(i.toString(),10)].style.bold=!e[parseInt(i.toString(),10)].style.bold;break;case"italic":e[parseInt(i.toString(),10)].style.italic=!e[parseInt(i.toString(),10)].style.italic;break;case"underline":"None"===e[parseInt(i.toString(),10)].style.textDecoration?e[parseInt(i.toString(),10)].style.textDecoration="Underline":"Underline"===e[parseInt(i.toString(),10)].style.textDecoration&&(e[parseInt(i.toString(),10)].style.textDecoration="None")}this.dataBind()},G.prototype.applyStyleText=function(t,e){switch(t){case"bold":e.style.bold=!e.style.bold;break;case"italic":e.style.italic=!e.style.italic;break;case"underline":"None"===e.style.textDecoration?e.style.textDecoration="Underline":"Underline"===e.style.textDecoration&&(e.style.textDecoration="None")}this.dataBind()},G.prototype.duplicateCommand=function(){[].concat(this.selectedItems.nodes,this.selectedItems.connectors);this.copy(),this.paste()},G.prototype.groupCommand=function(t){switch(t){case"group":this.group();break;case"ungroup":this.unGroup()}},G.prototype.rotateCommand=function(t){var e=this.selectedItems;switch(t){case"clockwise":this.rotate(e,90);break;case"antiClockwise":this.rotate(e,-90)}},G.prototype.flipCommand=function(t){for(var e=(e=[]).concat(this.selectedItems.nodes,this.selectedItems.connectors),i=0;i<e.length;i++)switch(t){case"horizontal":e[parseInt(i.toString(),10)].flip=Z.FlipDirection.Horizontal;break;case"vertical":e[parseInt(i.toString(),10)].flip=Z.FlipDirection.Vertical}this.dataBind()},G.prototype.toolCommand=function(t){switch(t){case"pointer":this.tool=Z.DiagramTools.Default,this.dataBind();break;case"text":this.drawingObject={shape:{type:"Text"}},this.tool=Z.DiagramTools.DrawOnce,this.dataBind();break;case"connect":this.drawingObject={id:"connector1",type:"Straight"},this.tool=Z.DiagramTools.DrawOnce,this.dataBind();break;case"freeForm":this.drawingObject={id:"connector1",type:"Freehand"},this.tool=Z.DiagramTools.DrawOnce,this.dataBind();break;case"line":this.drawingObject={id:"connector1",type:"Polyline"},this.tool=Z.DiagramTools.DrawOnce,this.dataBind();break;case"rectangle":this.drawingObject={shape:{type:"Basic",shape:"Rectangle"}},this.tool=Z.DiagramTools.DrawOnce,this.dataBind();break;case"ellipse":this.drawingObject={shape:{type:"Basic",shape:"Ellipse"}},this.tool=Z.DiagramTools.DrawOnce,this.dataBind()}},G.prototype.zoomCommand=function(t){switch(t){case"zoomIn":this.zoomTo({type:"ZoomIn",zoomFactor:.2});break;case"zoomOut":this.zoomTo({type:"ZoomOut",zoomFactor:.2})}},G.prototype.shiftCommand=function(t){for(var e=0;e<this.selectedItems.nodes.length;e++)"Up"===t?this.selectedItems.nodes[parseInt(e.toString(),10)].offsetY=this.selectedItems.nodes[parseInt(e.toString(),10)].offsetY-5:"Down"===t?this.selectedItems.nodes[parseInt(e.toString(),10)].offsetY=this.selectedItems.nodes[parseInt(e.toString(),10)].offsetY+5:"Left"===t?this.selectedItems.nodes[parseInt(e.toString(),10)].offsetX=this.selectedItems.nodes[parseInt(e.toString(),10)].offsetX-5:"Right"===t&&(this.selectedItems.nodes[parseInt(e.toString(),10)].offsetX=this.selectedItems.nodes[parseInt(e.toString(),10)].offsetX+5);for(e=0;e<this.selectedItems.connectors.length;e++){var i=this.selectedItems;"Up"===t?this.drag(i,0,-5):"Down"===t?this.drag(i,0,5):"Left"===t?this.drag(i,-5,0):"Right"===t&&this.drag(i,5,0)}},G.prototype.alignCommand=function(t){if(0<this.selectedItems.nodes.length)for(var e=0;e<this.selectedItems.nodes.length;e++)this.updateNodesAndConnectorAnnotation(this.selectedItems.nodes[parseInt(e.toString(),10)],t)},G.prototype.updateNodesAndConnectorAnnotation=function(t,e){for(var i,n=0;n<t.annotations.length;n++){switch(i=t.annotations[parseInt(n.toString(),10)],e){case"left":i.horizontalAlignment="Left";break;case"center":i.horizontalAlignment="Center";break;case"right":i.horizontalAlignment="Right";break;case"justify":i.style.textAlign="Justify";break;case"top":i.verticalAlignment="Top";break;case"centerVertical":i.verticalAlignment="Center";break;case"bottom":i.verticalAlignment="Bottom"}this.dataBind()}},G.prototype.orderCommand=function(t){switch(t){case"sendToBack":this.sendToBack();break;case"bringToFront":this.bringToFront();break;case"sendBackward":this.sendBackward();break;case"bringForward":this.moveForward()}},G.prototype.navigateItems=function(t){var e=0,i=this.activeLayer.objectZIndex,n=[],r=(r=[]).concat(this.selectedItems.nodes,this.selectedItems.connectors),n=n.concat(this.nodes,this.connectors),o=((e=0<r.length?r[0].zIndex+(t?1:-1):t?0:i)<0?e=i:i<e&&(e=0),!1);do{for(var a=0;a<n.length;a++){var s=n[parseInt(a.toString(),10)];if(e===s.zIndex){this.clearSelection(),this.select([s]),o=!0;break}}}while(o||(t?e++:e--),!o)},G.prototype.endEdit=function(){return iu(this,void 0,void 0,function(){var e,i,n,r,o,a,s,h,d,l,c,p,g,u;return nu(this,function(t){if(this.diagramActions&Z.DiagramAction.TextEdit&&(p=d=void 0,o={},this.enableServerDataBinding(!1),a=document.getElementById(this.element.id+"_editBox"),!N.isBlazor())){if(e=a.value,N.EventHandler.remove(a,"input",this.eventHandler.inputChange),N.EventHandler.remove(a,"focusout",this.focusOutEdit),a=document.getElementById(this.element.id+"_editTextBoxDiv"),i=void 0,i=this.nameTable[this.activeLabel.parentId],n=Kh(i,this.activeLabel.id),l={oldValue:this.activeLabel.text,newValue:e,cancel:!1,element:i,annotation:n},a.parentNode.removeChild(a),r=void 0,d=!n||n instanceof rl?{shape:{content:i.shape.content}}:(s=Jh(i,n.id,!0),o[""+s]={content:n.content},{annotations:o}),o=!1,(o="Draw"===this.eventHandler.currentAction?this.eventHandler.isAddTextNode(i,!0):o)||a.textContent===e&&e===this.activeLabel.text||this.triggerEvent(Z.DiagramEvent.textEdit,l),r=r||this.getWrapper(i.wrapper,this.activeLabel.id),a=!1,n.content!==e&&!l.cancel&&(a=!0,this.activeLabel.isGroup||this.startGroupAction(),i.parentId&&"UmlClassifier"===this.nameTable[i.parentId].shape.type&&-1===e.indexOf("+")&&-1===e.indexOf("-")&&-1===e.indexOf("#")&&-1===e.indexOf("~")&&-1===i.id.indexOf("_umlClass_header")&&(e=" + "+e),(i.isLane||i.isPhase)&&this.protectPropertyChange(!0),p=n instanceof rl?{shape:{content:e}}:(s=Jh(i,n.id,!0),(l={})[""+s]={content:e},{annotations:l}),(l=this.getIndex(i,i.id))&&((h={})[""+l]=d,(d={})[""+l]=p,ld(i)===_?this.onPropertyChanged({nodes:d},{nodes:h}):this.onPropertyChanged({connectors:d},{connectors:h})),this.protectPropertyChange(!0),n.content=e,this.protectPropertyChange(!1),this.updateSelector(),i.isLane||i.isPhase)&&this.protectPropertyChange(!1),o&&(this.removeObjectsFromLayer(i),this.removeFromAQuad(i),delete this.nameTable[this.activeLabel.parentId],""!==e)&&(this.clearSelection(),l=Q(i),i=this.add(l),this.updateDiagramObject(i),this.commandHandler.oldSelectedObjects=hd(this),this.commandHandler.select(this.nameTable[i.id])),this.selectedItems.nodes.length){if(c=this.nameTable[this.activeLabel.parentId],(p=this.nameTable[c.parentId])&&"SwimLane"===p.shape.type||"SwimLane"===c.shape.type)if("SwimLane"===c.shape.type&&(p=this.nameTable[this.activeLabel.parentId],c=i),c.isLane||c.isPhase)for(g=c.isLane?p.shape.lanes:p.shape.phases,u=0;u<g.length;u++)g[parseInt(u.toString(),10)].id===(c.LaneHeaderParent||c.PhaseHeaderParent)&&(g[parseInt(u.toString(),10)].header.annotation.content=c.annotations[0].content);else c.isHeader&&p.shape.hasHeader&&(p.shape.header.annotation.content=c.annotations[0].content);this.dataBind()}r.visible=!0,this.updateDiagramObject(i),this.diagramActions=this.diagramActions&~Z.DiagramAction.TextEdit,(this.activeLabel.isGroup||a)&&this.endGroupAction(),this.activeLabel={id:"",parentId:"",isGroup:!1,text:void 0},this.commandHandler.getBlazorOldValues(),this.enableServerDataBinding(!0)}return[2]})})},G.prototype.getIndex=function(t,e){for(var i=ld(t)===_?this.nodes:this.connectors,n=0;n<i.length;n++)if(i[parseInt(n.toString(),10)].id.toString()===e.toString())return n.toString();return null},G.prototype.canLogChange=function(){return!(!(this.diagramActions&Z.DiagramAction.Render)||this.diagramActions&Z.DiagramAction.ToolAction||this.diagramActions&Z.DiagramAction.UndoRedo||this.diagramActions&Z.DiagramAction.PublicMethod)},G.prototype.modelChanged=function(t,e){return!!(t.connectors||e.connectors||t.nodes||e.connectors||t.pageSettings||e.pageSettings||t.bridgeDirection||e.bridgeDirection)},G.prototype.resetDiagramActions=function(t){var e=!!t;this.diagramActions&Z.DiagramAction.UndoRedo&&(!e||t===Z.DiagramAction.UndoRedo)&&(this.diagramActions=this.diagramActions&~Z.DiagramAction.UndoRedo),this.diagramActions&Z.DiagramAction.PublicMethod&&(!e||t===Z.DiagramAction.PublicMethod)&&(this.diagramActions=this.diagramActions&~Z.DiagramAction.PublicMethod)},G.prototype.removeNode=function(t,e){this.removeObjectsFromLayer(t),this.removeFromAQuad(this.nameTable[t.id]);var i=document.getElementById(t.id+"_groupElement");if(delete this.nameTable[t.id],t.children&&delete this.groupTable[t.id],this.nodes.splice(this.nodes.indexOf(t),1),i&&i.children&&0<i.children.length)for(var n=void 0,r=i.children.length-1;0<=r;r--){var o=i.children[parseInt(r.toString(),10)];0<e.length&&-1!==e.indexOf(o.id.split("_groupElement")[0])&&(n?i.parentNode.insertBefore(o,n):i.parentNode.insertBefore(o,i),n=o)}i&&i.parentNode.removeChild(i)},G.prototype.deleteGroup=function(t){var e=[];t.children&&(e=this.commandHandler.getChildren(t,[])),this.UpdateBlazorDiagramModelCollection(t);for(var i=0,n=e;i<n.length;i++){var r=n[i];r&&this.nameTable[r.id]&&this.remove(r)}},G.prototype.updateObject=function(t,e,i){if(!(this.diagramActions&Z.DiagramAction.ToolAction)){var n=t.wrapper.children[0].bounds;if(!this.commandHandler.checkBoundaryConstraints(void 0,void 0,n,!0))if(t instanceof _){for(var r=e,o=0,a=Object.keys(i);o<a.length;o++)switch(d=a[o]){case"width":t.width=r.width;break;case"height":t.height=r.height;break;case"offsetX":t.offsetX=r.offsetX;break;case"offsetY":t.offsetY=r.offsetY;break;case"rotateAngle":t.rotateAngle=r.rotateAngle}this.nodePropertyChange(t,i,e)}else{for(var s=0,h=Object.keys(i);s<h.length;s++){var d=h[s],l=e,c=t.sourcePoint,p=t.targetPoint;switch(d){case"sourcePoint":c.x=l.sourcePoint.x||c.x,c.y=l.sourcePoint.y||c.y;break;case"targetPoint":p.x=l.targetPoint.x||p.x,p.y=l.targetPoint.y||p.y}}this.connectorPropertyChange(t,i,e)}}},G.prototype.nodePropertyChangeExtend=function(t,e,i,n){return void 0!==i.style&&"Bpmn"!==t.shape.type&&(zh(i.style,t.wrapper.children[0]),n=!0),void 0!==i.shadow&&(this.updateShadow(t.shadow,i.shadow),n=!0),void 0!==i.constraints&&(e.constraints&Z.NodeConstraints.Select&&!(i.constraints&Z.NodeConstraints.Select)&&so(this,t)?this.clearSelection():(this.updateThumbConstraints(this.selectedItems.nodes,this.selectedItems),this.updateSelector(),n=!0)),this.updateTextAnnotationInSwimlane(t,i),this.swimLaneNodePropertyChange(t,e,i,n),n},G.prototype.updateTextAnnotationInSwimlane=function(t,e){if(t.hasTextAnnotation&&this.isPositionUndo)for(var i=0;i<t.outEdges.length;i++){var n,r,o=this.nameTable[t.outEdges[parseInt(i.toString(),10)]];o.isBpmnAnnotationConnector&&(o=this.nameTable[o.targetID],this.isProtectedOnChange=!0,t.laneMargin&&o&&(n=t.margin.left-t.laneMargin.left,r=t.margin.top-t.laneMargin.top,o.margin.left+=n,o.margin.top+=r,o.offsetX+=n,o.offsetY+=r,o.wrapper.offsetX+=n,o.wrapper.offsetY+=r,o.wrapper.measure(new j(o.wrapper.width,o.wrapper.height)),o.wrapper.arrange(o.wrapper.desiredSize),this.updateDiagramObject(o)),this.isProtectedOnChange=!1)}},G.prototype.swimLaneNodePropertyChange=function(t,e,i,n){if("SwimLane"===t.shape.type&&!this.currentSymbol){if(e.shape){var r=i.shape,o=t.shape,a="Horizontal"===o.orientation,s=o.padding,h=e.shape,d=t.wrapper.children[0],l=void 0,c=void 0,p=void 0;if(h.lanes||h.phases){if(h.lanes)for(var g=0,u=Object.keys(r.lanes);g<u.length;g++){var m=u[g],f=Number(m),y=h.lanes[parseInt(f.toString(),10)],m=void 0,v=r.lanes[parseInt(f.toString(),10)];if(v&&v.header&&(p=o.lanes[parseInt(f.toString(),10)].header.id,l=y.header,(c=v.header).annotation&&c.annotation.content&&(this.nameTable[""+p].annotations[0].content=c.annotation.content),c.annotation&&c.annotation.style&&(this.nameTable[""+p].annotations[0].style=c.annotation.style),this.nodePropertyChange(this.nameTable[""+p],l,c)),y.children)for(var b=0,S=Object.keys(y.children);b<S.length;b++){var w=S[b],p=o.lanes[parseInt(f.toString(),10)].children[Number(w)].id,R=this.nameTable[""+p],l=y.children[Number(w)],c=v.children[Number(w)];this.nodePropertyChange(R,l,c)}y.width&&!a&&(m=o.phases&&o.phaseSize?f+1:f,d.updateColumnWidth(m,v.width,!0,s),this.updateDiagramElementQuad()),y.height&&a&&(m=o.header&&o.hasHeader?f+1:f,m+=o.phases&&o.phaseSize?1:0,d.updateRowHeight(m,v.height,!0,s),this.updateDiagramElementQuad())}if(r.phases)for(var x=0,I=Object.keys(r.phases);x<I.length;x++){var C,P=I[x],f=Number(P),P=r.phases[parseInt(f.toString(),10)],A=void 0,N=o.header&&o.hasHeader?1:0;P&&P.header&&(p=o.phases[parseInt(f.toString(),10)].header.id,l=h.phases[parseInt(f.toString(),10)].header,(c=P.header).annotation&&c.annotation.content&&(this.nameTable[""+p].annotations[0].content=c.annotation.content),c.annotation&&c.annotation.style&&(this.nameTable[""+p].annotations[0].style=c.annotation.style),this.nodePropertyChange(this.nameTable[""+p],l,c)),P.offset&&((0===f||(C=o.phases[f-1],(A=P.offset-C.offset)<=0))&&(A=P.offset),a?(d.updateColumnWidth(f,A,!0,s),Cr(t,this,d.rows[parseInt(N.toString(),10)].cells[parseInt(f.toString(),10)],f)):d.updateRowHeight(N+f,A,!0,s))}}if(void 0!==r.phaseSize&&o.phases.length)if(0===r.phaseSize||0===h.phaseSize)if(h.phaseSize)a?(d.removeRow(o.header&&o.hasHeader?1:0),t.height=t.wrapper.height=d.height):(o.header&&o.hasHeader&&(d.rows[0].cells[1].children=d.rows[0].cells[0].children,d.rows[0].cells[1].columnSpan=d.rows[0].cells[0].columnSpan-1,d.rows[0].cells[0].children=[]),d.removeColumn(0));else{a?((D=new Qn).height=r.phaseSize,d.addRow(o.header&&o.hasHeader?1:0,D,!0),t.height=t.wrapper.height+=r.phaseSize):((D=new Jn).width=r.phaseSize,d.addColumn(0,D,!0),o.header&&o.hasHeader&&(d.rows[0].cells[0].children=d.rows[0].cells[1].children,d.rows[0].cells[1].children=[],d.rows[0].cells[1].columnSpan=1,d.rows[0].cells[1].minWidth=void 0,d.rows[0].cells[0].columnSpan=o.lanes.length+1));for(var T=0;T<o.phases.length;T++)""===o.phases[parseInt(T.toString(),10)].id&&(o.phases[parseInt(T.toString(),10)].id=q()),sr(d,this,t,o.header&&o.hasHeader?1:0,a,T)}else a?d.updateRowHeight(o.header&&o.hasHeader?1:0,r.phaseSize,!1):d.updateColumnWidth(0,r.phaseSize,!1);o.header&&o.hasHeader&&h.header&&(D=d.rows[0].cells[0].children[0].id,M=this.nameTable[""+D],this.nodePropertyChange(M,h.header,r.header)),t.height=t.wrapper.height=d.height,t.width=t.wrapper.width=d.width}else if(e.constraints){var D=e.constraints&Z.NodeConstraints.Select,O=i.constraints&Z.NodeConstraints.Select;if(D!=O){var M,r=t.shape,E=((M=this.nameTable[t.id+r.header.id]).constraints=O?M.constraints|Z.NodeConstraints.Select:M.constraints&~Z.NodeConstraints.Select,void 0);if(0<r.phaseSize)for(var L=0;L<r.phases.length;L++)(E=this.nameTable[t.id+r.phases[parseInt(L.toString(),10)].id+"_header"]).constraints=O?E.constraints|Z.NodeConstraints.Select:E.constraints&~Z.NodeConstraints.Select;for(var z=void 0,k=void 0,j=r.phases.length||1,L=0;L<r.lanes.length;L++)for(var B=0;B<j;B++)(z=this.nameTable[t.id+r.lanes[parseInt(L.toString(),10)].id+B]).constraints=O?z.constraints|Z.NodeConstraints.Select:z.constraints&~Z.NodeConstraints.Select,0===B&&((k=this.nameTable[t.id+r.lanes[parseInt(L.toString(),10)].id+"_"+B+"_header"]).constraints=O?k.constraints|Z.NodeConstraints.Select:k.constraints&~Z.NodeConstraints.Select)}}n=!0}return n},G.prototype.insertValue=function(t,e){if(!(this.blazorActions&Z.BlazorAction.GroupClipboardInProcess)){for(var i=void 0,n=e?this.oldNodeObjects:this.oldConnectorObjects,r=0;r<n.length;r++)n[parseInt(r.toString(),10)].id===t.id&&(i=!0);i||(e?this.oldNodeObjects:this.oldConnectorObjects).push(t)}},G.prototype.nodePropertyChange=function(t,e,i,n,r,o){this.canEnableBlazorObject&&"helper"!==t.id&&(d=Q(t),this.insertValue(d,!0));var a,s,h,d=t.wrapper.outerBounds,l=t.wrapper.bounds,c=!1,p=0,g=0,u=0,m=0,f=!1,y=!1,v=!1;if(void 0!==i.width&&(t.children?t.container?t.wrapper.width=i.width:this.scaleObject(t,i.width,!0):(t.wrapper.children[0].width=i.width,c=a=!0),f=!0),void 0!==i.height&&(t.children?t.container?t.wrapper.height=i.height:this.scaleObject(t,i.height,!1):(t.wrapper.children[0].height=i.height,c=a=!0),f=!0),a=this.nodePropertyChangeExtend(t,e,i,a),void 0!==i.constraints&&Pn(e)!==Pn(i)&&(t.wrapper.children[0].shadow=Pn(t)?t.shadow:null),void 0!==i.offsetX&&(p=e.offsetX,g=i.offsetX,t.wrapper.flip!==Z.FlipDirection.None&&t.offsetX!==t.wrapper.offsetX&&void 0!==e.offsetX?(h=i.offsetX-e.offsetX,t.wrapper.offsetX=t.wrapper.offsetX+h,this.updateFlipOffset(t.wrapper,h,0,t.wrapper.flip)):t.wrapper.offsetX=i.offsetX,y=c=a=!0),void 0!==i.offsetY&&(u=e.offsetY,m=i.offsetY,t.wrapper.flip!==Z.FlipDirection.None&&t.offsetY!==t.wrapper.offsetY&&void 0!==e.offsetY?(h=i.offsetY-e.offsetY,t.wrapper.offsetY=t.wrapper.offsetY+h,this.updateFlipOffset(t.wrapper,0,h,t.wrapper.flip)):t.wrapper.offsetY=i.offsetY,y=c=a=!0),void 0!==i.padding&&(t.wrapper.padding.left=(void 0!==i.padding.left?i:t.wrapper).padding.left,t.wrapper.padding.right=(void 0!==i.padding.right?i:t.wrapper).padding.right,t.wrapper.padding.top=(void 0!==i.padding.top?i:t.wrapper).padding.top,t.wrapper.padding.bottom=(void 0!==i.padding.bottom?i:t.wrapper).padding.bottom,a=!0),void 0!==i.pivot&&(t.wrapper.pivot=i.pivot,a=!0),void 0!==i.minWidth&&(t.wrapper.minWidth=t.wrapper.children[0].minWidth=i.minWidth,f=c=a=!0),void 0!==i.minHeight&&(t.wrapper.minHeight=t.wrapper.children[0].minHeight=i.minHeight,f=c=a=!0),void 0!==i.maxWidth&&(t.wrapper.maxWidth=i.maxWidth,f=c=a=!0),void 0!==i.maxHeight&&(t.wrapper.maxHeight=i.maxHeight,f=c=a=!0),void 0!==i.flip&&(h=(i.flip&Z.FlipDirection.Horizontal^t.wrapper.flip&Z.FlipDirection.Horizontal)===Z.FlipDirection.Horizontal,s=(i.flip&Z.FlipDirection.Vertical^t.wrapper.flip&Z.FlipDirection.Vertical)===Z.FlipDirection.Vertical,h&&(t.wrapper.flip^=Z.FlipDirection.Horizontal),s&&(t.wrapper.flip^=Z.FlipDirection.Vertical),c=a=!0,sd(t.wrapper,t.offsetX,t.offsetY,this,void 0,h,s),this.updateWrapperChildFlip(t)),void 0!==i.flipMode&&(h="",h=t.wrapper.flipMode=i.flipMode,c=a=!0,this.updateWrapperChildFlip(t,h)),void 0!==i.rotateAngle&&t.constraints&Z.NodeConstraints.Rotate&&(t.children&&r&&this.commandHandler.rotateObjects(t,[t],t.rotateAngle-t.wrapper.rotateAngle,{x:t.offsetX,y:t.offsetY},!1),t.wrapper.rotateAngle=i.rotateAngle,v=c=a=!0),void 0!==i.backgroundColor&&(t.wrapper.style.fill=i.backgroundColor),void 0!==i.visible&&this.updateElementVisibility(t.wrapper,t,t.visible),void 0!==i.shape&&"Bpmn"!==t.shape.type&&(a=!0,Rh(i,t,e,this),c=!0),i.margin&&(a=!0,this.updateMargin(t,i),y=c=!0),(void 0!==i.shape&&void 0===i.shape.type||void 0!==i.width||void 0!==i.height||void 0!==i.style)&&"Bpmn"===t.shape.type&&this.bpmnModule&&(c=a=!0,this.bpmnModule.updateBPMN(i,e,t,this)),"UmlActivity"!==t.shape.type||N.isBlazor()||"FinalNode"!==t.shape.shape||(c=a=!0,this.updateUMLActivity(i,e,t,this)),(t.shape&&"UmlClassifier"===t.shape.type||t.parentId&&this.nameTable[t.parentId]&&"UmlClassifier"===this.nameTable[t.parentId].shape.type)&&(c=a=!0),void 0!==i.ports)for(var b=0,S=Object.keys(i.ports);b<S.length;b++){var w=S[b],x=Number(w),I=(a=!0,i.ports[""+w]),C=t.ports[parseInt(x.toString(),10)];this.updatePort(I,C,t.wrapper),t.flip===Z.FlipDirection.None||"Port"!==t.flipMode&&"PortAndLabel"!==t.flipMode&&"PortAndLabelText"!==t.flipMode&&"All"!==t.flipMode||this.updatePorts(t,t.flip),c=!0}if(void 0!==i.annotation||void 0!==i.annotations||void 0!==i.width)for(var P=0,A=Object.keys(i.annotations||t.annotations);P<A.length;P++){var w=A[P],x=Number(w),I=(a=!0,void 0),T=(I=i.annotation||(i.annotations?i.annotations[""+w]:t.annotations),t.annotations[parseInt(x.toString(),10)]);if(T){var R=!!t.width,T=(this.updateAnnotation(I,T,t.wrapper,t,R),this.nameTable[t.parentId]);if(T&&"SwimLane"===T.shape.type)if(t.isLane||t.isPhase)for(var D=t.isLane?T.shape.lanes:T.shape.phases,O=0;O<D.length;O++)if(D[parseInt(O.toString(),10)].id===(t.LaneHeaderParent||t.PhaseHeaderParent)){D[parseInt(O.toString(),10)].header.annotation.content=t.annotations[0].content,D[parseInt(O.toString(),10)].header.annotation.style=t.annotations[0].style;break}}}if(void 0===i.expandIcon&&void 0===i.collapseIcon&&void 0===i.isExpanded||(this.updateIcon(t),this.updateDefaultLayoutIcons(t),void 0!==i.isExpanded&&(this.canExpand=!0,this.diagramActions|=Z.DiagramAction.PreventIconsUpdate,this.commandHandler.expandNode(t,this),this.diagramActions=this.diagramActions&~Z.DiagramAction.PreventIconsUpdate),this.canExpand=!(a=!0)),void 0!==i.fixedUserHandles)for(var M,x=void 0,I=void 0,E=0,L=Object.keys(i.fixedUserHandles);E<L.length;E++){w=L[E];x=Number(w),a=!0,i.fixedUserHandles[parseInt(x.toString(),10)]&&(I=i.fixedUserHandles[parseInt(x.toString(),10)]),(M=t.fixedUserHandles[parseInt(x.toString(),10)])&&this.updateNodefixedUserHandle(I,M,t.wrapper,t)}if(void 0!==i.tooltip&&this.updateTooltip(t,i),a){if(void 0===this.bpmnModule||!y&&!f||v||this.updateBpmnAnnotationPosition(p,u,g,m,t,t.wrapper,t.shape,"TextAnnotation"===t.shape.shape,e,f,this.sizeUndo),this.checkSelectedItem(t)&&t.wrapper.children[0]instanceof H&&t.wrapper.children[0].refreshTextElement(),t.wrapper.measure(new j(t.wrapper.bounds.width,t.wrapper.bounds.height),t.id,this.onLoadImageSize.bind(this)),t.wrapper.arrange(t.wrapper.desiredSize),this.updateObject(t,e,i),"SwimLane"!==t.shape.type||this.currentSymbol||this.diagramActions&Z.DiagramAction.ToolAction||(Pr(this,t),s=t.wrapper.children[0],h=t.shape,r=s.columnDefinitions().length,"Horizontal"===h.orientation&&(x=h.header&&h.hasHeader?1:0,Cr(t,this,s.rows[parseInt(x.toString(),10)].cells[r-1],r-1)),t.wrapper.measure(new j(t.wrapper.bounds.width,t.wrapper.bounds.height)),t.wrapper.arrange(t.wrapper.desiredSize)),this.diagramActions&Z.DiagramAction.ToolAction&&!(this.diagramActions&Z.DiagramAction.UndoRedo)||this.checkSelectedItem(t)&&this.updateSelector(),!1===d.equals(d,t.wrapper.outerBounds)&&(this.updateQuad(t),t.parentId)&&this.nameTable[t.parentId]&&(y=this.nameTable[t.parentId],this.updateQuad(y)),n?t&&t.visible&&t.outEdges&&this.updateIconVisibility(t,0!==t.outEdges.length):this.commandHandler.connectorSegmentChange(t,l,void 0!==i.rotateAngle),void 0!==this.bpmnModule&&this.bpmnModule.updateDocks(t,this),i.annotations&&t.processId||void 0!==i.flip||this.updateGroupOffset(t),t.parentId&&this.nameTable[t.parentId]&&((v=this.nameTable[t.parentId]).wrapper.measure(new j(v.wrapper.width,t.wrapper.height)),v.wrapper.arrange(v.wrapper.desiredSize),v.offsetX=v.wrapper.offsetX,v.offsetY=v.wrapper.offsetY),!1===l.equals(l,t.wrapper.bounds)&&("Drag"!==this.eventHandler.currentAction&&this.updateGroupSize(t),t.children)&&this.updateGroupOffset(t),"SwimLane"===t.shape.type&&!this.currentSymbol&&this.diagramActions&Z.DiagramAction.Render&&vr(cr(this,t.wrapper.children[0]),this),!this.preventNodesUpdate)if((!Ln(this)||Ln(this)&&-1<this.scroller.oldCollectionObjects.indexOf(t.id))&&(this.diagramActions&Z.DiagramAction.PreventZIndexOnDragging?this.updateDiagramObject(t,!0):this.updateDiagramObject(t),t.parentId)&&"BPMN"!==(p=this.nameTable[t.parentId]).shape.type&&(this.diagramActions&Z.DiagramAction.PreventZIndexOnDragging?this.updateDiagramObject(p,!0):this.updateDiagramObject(p)),!n&&c&&(this.lineRoutingModule&&this.diagramActions&&this.constraints&Z.DiagramConstraints.LineRouting&&"helper"!==t.id?this.diagramActions&Z.DiagramAction.ToolAction||this.lineRoutingModule.renderVirtualRegion(this,!0):this.diagramActions&&this.constraints&Z.DiagramConstraints.LineRouting&&"helper"!==t.id&&console.warn('[WARNING] :: Module "LineRouting" is not available in Diagram component! You either misspelled the module name or forgot to load it.'),this.updateConnectorEdges(t),"helper"!==t.id)&&!(this.diagramActions&Z.DiagramAction.ToolAction))for(var z=this.spatialSearch.findObjects(t.wrapper.outerBounds),k=0;k<z.length;k++){var B=z[parseInt(k.toString(),10)];B instanceof W&&this.connectorPropertyChange(z[parseInt(k.toString(),10)],{},{sourceID:B.sourceID,targetID:B.targetID,sourcePortID:B.sourcePortID,targetPortID:B.targetPortID,sourcePoint:B.sourcePoint,targetPoint:B.targetPoint})}"New"!==t.status&&this.diagramActions&&(t.status="Update")}o||(u={element:t,cause:this.diagramActions,diagramAction:this.getDiagramAction(this.diagramActions),oldValue:e,newValue:i},this.triggerEvent(Z.DiagramEvent.propertyChange,u))},G.prototype.updateWrapperChildFlip=function(t,e){if(t&&t.children&&0<t.children.length)for(var i=0;i<t.children.length;i++){var n=t.children[parseInt(i.toString(),10)],n=this.nameTable[""+n],r="";e?(r=e,n.wrapper.flipMode=r,n.flipMode=r):r=n.flipMode,"None"===r||"Label"===r||"LabelText"===r||"LabelAndLabelText"===r?this.updatePorts(n,Z.FlipDirection.None):this.updatePorts(n,n.wrapper.flip),this.updateWrapperFlip(n.wrapper,n)}var o;"None"===(e=t.flipMode)||"Label"===e||"LabelText"===e||"LabelAndLabelText"===e?this.updatePorts(t,Z.FlipDirection.None):this.updatePorts(t,t.wrapper.flip),(o=t.children?t.wrapper.children[t.wrapper.children.length-1]:t.wrapper).flip=t.wrapper.flip,o.flipMode=t.flipMode,this.updateWrapperFlip(o,t)},G.prototype.updateWrapperFlip=function(t,e){for(var i=0;i<t.children.length;i++){var n=t.children[parseInt(i.toString(),10)];n instanceof H?"None"!==e.flipMode&&"Port"!==e.flipMode?(n.flip=e.wrapper.flip,n.flipMode=e.flipMode):n.flip=Z.FlipDirection.None:n instanceof F&&this.applyWrapperCanvasFlip(n,e)}},G.prototype.getResizeHandle=function(t,e,i,n,r,o,a,s){r-=t,t=o-e,o=a-i,e=s-n;return 0==e&&(0<r&&0<o||r<0&&o<0)?"ResizeEast":0==e&&(0<r&&o<0||r<0&&0<o)?"ResizeWest":0==o&&(0<t&&e<0||t<0&&0<e)?"ResizeNorth":0==o&&(0<t&&0<e||t<0&&e<0)?"ResizeSouth":(0<r&&0<o||r<0&&o<0)&&(0<t&&0<e||t<0&&e<0)?"ResizeSouthEast":(0<r&&o<0||r<0&&0<o)&&(0<t&&0<e||t<0&&e<0)?"ResizeSouthWest":(0<r&&0<o||r<0&&o<0)&&(0<t&&e<0||t<0&&0<e)?"ResizeNorthEast":(0<r&&o<0||r<0&&0<o)&&(0<t&&e<0||t<0&&0<e)?"ResizeNorthWest":null},G.prototype.getTextAnnotationOffset=function(t,e,i,n,r){var o,a=t.width-i.width,s=t.height-i.height,e=this.getTextAnnotationQuadrant(t,e),i=this.getResizeHandle(i.offsetX,i.offsetY,i.width,i.height,t.offsetX,t.offsetY,t.width,t.height),t=0,h=0;return o=e,("ResizeEast"===i||"ResizeNorthEast"===i||"ResizeSouthEast"===i?o.includes("East"):("ResizeWest"===i||"ResizeNorthWest"===i||"ResizeSouthWest"===i)&&o.includes("West"))&&(t=i.includes("West")?-a:a),o=e,{x:n+t,y:r+(h=("ResizeSouth"===i||"ResizeSouthWest"===i||"ResizeSouthEast"===i?o.includes("South"):("ResizeNorth"===i||"ResizeNorthWest"===i||"ResizeNorthEast"===i)&&o.includes("North"))?i.includes("North")?-s:s:h)}},G.prototype.getTextAnnotationQuadrant=function(t,e){var i=t.wrapper.bounds.left,n=t.wrapper.bounds.right,r=t.wrapper.bounds.top,t=t.wrapper.bounds.bottom,o=e.wrapper.bounds.center.x,e=e.wrapper.bounds.center.y;if(i<=o&&o<=n){if(e<r)return"North";if(t<e)return"South"}if(r<=e&&e<=t){if(o<i)return"West";if(n<o)return"East"}return o<i&&e<r?"NorthWest":n<o&&e<r?"NorthEast":o<i&&t<e?"SouthWest":n<o&&t<e?"SouthEast":""},G.prototype.updateBpmnAnnotationPosition=function(t,e,i,n,r,o,a,s,h,d,l){var c,p,g=t<i?Math.abs(i-t):Math.abs(t-i),u=e<n?Math.abs(n-e):Math.abs(e-n),m=((0===g&&0===u||Number.isNaN(g)&&Number.isNaN(u))&&r.laneMargin&&(c=r.margin.left-r.laneMargin.left,p=r.margin.top-r.laneMargin.top),r.width),f=r.height,y=new k(0,0,0,0);if(0!==m&&0!==f&&(y=new k((0!==i?i:r.offsetX)-m/2,(0!==n?n:r.offsetY)-f/2,m,f)),s){var m=a,f=""!==m.textAnnotation.textAnnotationTarget&&this.nameTable[m.textAnnotation.textAnnotationTarget],s=this.selectedItems.nodes?this.selectedItems.nodes[0]:void 0,a=s&&s.shape&&"TextAnnotation"===s.shape.shape,v=(f?""===r.parentId||a?"Auto"===m.textAnnotation.textAnnotationDirection&&o.children[0]instanceof F&&o.children[0].children[0]instanceof P&&(s=o.children[0],f=document.getElementById(s.id+"_groupElement"),a=document.getElementById(s.children[0].id+"_groupElement"),f.removeChild(a),s.children.splice(0,1),this.isProtectedOnChange=!0,this.bpmnModule.setAnnotationPath(y,s,r,m,m.textAnnotation.textAnnotationDirection,this),this.isProtectedOnChange=!1):(this.isPositionUndo=!0,this.updateTextAnnotationInSwimlane(r,r),this.isPositionUndo=!1):0<r.inEdges.length&&(o=r.inEdges[0],w=this.nameTable[""+o])&&w.isBpmnAnnotationConnector&&(w.sourcePoint={x:t<i?w.sourcePoint.x+g:w.sourcePoint.x-g,y:e<n?w.sourcePoint.y+u:w.sourcePoint.y-u}),{ports:[{offset:r.ports[0].offset}]});this.nodePropertyChange(r,{},v)}else for(var b=0,S=r.outEdges;b<S.length;b++){var w,x,I,C=S[b];(w=this.nameTable[""+C])&&w.isBpmnAnnotationConnector&&(I=(C=this.nameTable[w.targetID]).shape.textAnnotation.textAnnotationTarget,I=this.nameTable[""+I],d&&!l&&(i=(x=this.getTextAnnotationOffset(r,C,h,t,e)).x,n=x.y,g=t<i?Math.abs(i-t):Math.abs(t-i),u=e<n?Math.abs(n-e):Math.abs(e-n)),"TextAnnotation"===C.shape.shape)&&!so(this,C)&&so(this,I)&&(v=x=void 0,r.isResized?(x={margin:{left:C.margin.left,top:C.margin.top}},(I=r.resizeDif[C.id])&&(C.margin.left+=I.x,C.margin.top+=I.y,v={margin:{left:C.margin.left,top:C.margin.top}})):v=void 0!==c&&void 0!==p?C.parentId?(x={margin:{left:C.margin.left,top:C.margin.top}},C.margin.left+=c,C.margin.top+=p,{margin:{left:C.margin.left,top:C.margin.top}}):(x={offsetX:C.offsetX,offsetY:C.offsetY},C.offsetX+=c,C.offsetY+=p,{offsetX:C.offsetX,offsetY:C.offsetY}):(x={offsetX:C.offsetX,offsetY:C.offsetY},C.offsetX=t<i?C.offsetX+g:C.offsetX-g,C.offsetY=e<n?C.offsetY+u:C.offsetY-u,{offsetX:C.offsetX,offsetY:C.offsetY}),this.nodePropertyChange(C,x,v))}},G.prototype.updatePorts=function(t,e){if(t&&0<t.ports.length)for(var i=0,n=Object.keys(t.ports);i<n.length;i++){var r=n[i],r=Number(r),r=t.ports[parseInt(r.toString(),10)],o=this.getWrapper(t.wrapper,r.id);(o=pd(o,e,r)).relativeMode="Point",void 0===t.wrapper.measureChildren&&(t.wrapper.measureChildren=!1),o.measure(new j(o.width,o.height)),o.arrange(o.desiredSize)}},G.prototype.updateFlipOffset=function(t,e,i,n){if(t.hasChildren())for(var r=0,o=t.children;r<o.length;r++){var a=o[r];n!==Z.FlipDirection.Horizontal&&n!==Z.FlipDirection.Both||(a.flipOffset.x=a.flipOffset.x+e),n!==Z.FlipDirection.Vertical&&n!==Z.FlipDirection.Both||(a.flipOffset.y=a.flipOffset.y+i),(a instanceof F||a instanceof te)&&this.updateFlipOffset(a,e,i,n)}},G.prototype.updateUMLActivity=function(t,e,i,n){var r;void 0===t.width&&void 0===t.height||((r=i.wrapper.children[0].children[0]).width=t.width,r.height=t.height,(r=i.wrapper.children[0].children[1]).width=t.width/1.5,r.height=t.height/1.5)},G.prototype.updateConnectorProperties=function(t){var e;this.preventConnectorsUpdate?-1===this.selectionConnectorsList.indexOf(t)&&t&&this.selectionConnectorsList.push(t):(e={sourcePoint:t.sourcePoint,targetPoint:t.targetPoint,sourceID:t.sourceID,targetID:t.targetID,sourcePortID:t.sourcePortID,targetPortID:t.targetPortID},this.connectorPropertyChange(t,{},e,void 0,!0))},G.prototype.updateConnectorEdges=function(t){if(0<t.inEdges.length)for(var e=0;e<t.inEdges.length;e++)this.updateConnectorProperties(this.nameTable[t.inEdges[parseInt(e.toString(),10)]]);if(0<t.outEdges.length)for(var i=0;i<t.outEdges.length;i++)this.updateConnectorProperties(this.nameTable[t.outEdges[parseInt(i.toString(),10)]]);t instanceof W||!t.parentId||!this.nameTable[t.parentId]||this.updateConnectorEdges(this.nameTable[t.parentId])},G.prototype.connectorProprtyChangeExtend=function(t,e,i,n){return void 0!==i.type&&i.type!==e.type&&0<t.segments.length&&void 0===i.segments&&(t.segments=[]),void 0!==i.shape&&void 0!==t.shape&&t.shape&&"Bpmn"===t.shape.type&&this.bpmnModule&&this.bpmnModule.updateBPMNConnector(t,e,i,this),void 0!==t.constraints?(this.updateThumbConstraints(this.selectedItems.connectors,this.selectedItems),!0):n},G.prototype.connectorPropertyChange=function(t,e,i,n,r){this.canEnableBlazorObject&&(p=Q(t),this.insertValue(p,!1));var o,a,s,h,d,l,c,p=t.wrapper.bounds,g=!1,u=[],g=this.connectorProprtyChangeExtend(t,e,i,g);void 0!==i.visible&&this.updateElementVisibility(t.wrapper,t,t.visible),void 0===i.sourcePoint&&void 0===i.targetPoint&&void 0===i.sourceID&&void 0===i.targetID&&void 0===i.targetPadding&&void 0===i.sourcePortID&&void 0===i.targetPortID&&void 0===i.sourcePadding&&void 0===i.type&&void 0===i.segments&&void 0===i.flip||((void 0!==i.sourceID&&i.sourceID!==e.sourceID||i.sourcePortID)&&(l=this.nameTable[t.sourceID],s=this.findInOutConnectPorts(l,!1),(!l||Dn(l)||""!==t.sourcePortID&&On(s))&&(t.sourceWrapper=l?this.getEndNodeWrapper(l,t,!0):void 0,t.sourcePortID&&void 0===i.sourcePortID&&(t.sourcePortWrapper=l?this.getWrapper(l.wrapper,t.sourcePortID):void 0),this.removePortEdges(this.nameTable[e.sourceID]||l,e.sourcePortID||t.sourcePortID,t.id,!1)),void 0!==i.sourceID&&void 0!==e.sourceID&&""!==e.sourceID&&void 0!==(h=this.nameTable[e.sourceID])&&h.outEdges&&-1!==h.outEdges.indexOf(t.id)&&Yh(h.outEdges,t.id),this.updateEdges(t)),void 0!==i.targetID&&i.targetID!==e.targetID&&(c=this.nameTable[i.targetID],d=this.findInOutConnectPorts(c,!0),(!c||An(c)||""!==t.targetPortID&&Tn(d))&&(t.targetWrapper=c?this.getEndNodeWrapper(c,t,!1):void 0,t.targetPortID&&void 0===i.targetPortID&&(t.targetPortWrapper=c?this.getWrapper(c.wrapper,t.targetPortID):void 0),this.removePortEdges(this.nameTable[e.targetID]||c,e.targetPortID||t.targetPortID,t.id,!0)),void 0!==e&&void 0!==e.targetID&&""!==e.targetID&&void 0!==(h=this.nameTable[e.targetID])&&h.inEdges&&-1!==h.inEdges.indexOf(t.id)&&Yh(h.inEdges,t.id),this.updateEdges(t)),void 0!==i.sourcePortID&&i.sourcePortID!==e.sourcePortID&&(t.sourceID&&this.nameTable[t.sourceID]&&(o=this.nameTable[t.sourceID].wrapper),!(l=this.nameTable[t.sourceID])||Dn(l)||""!==t.sourcePortID&&On(s)?t.sourcePortWrapper=o?this.getWrapper(o,i.sourcePortID):void 0:""!==t.sourcePortID||Dn(l)||(t.sourcePortWrapper=void 0)),void 0!==i.targetPortID&&i.targetPortID!==e.targetPortID&&(c=this.nameTable[t.targetID],t.targetID&&this.nameTable[t.targetID]&&(a=this.nameTable[t.targetID].wrapper),!c||An(c)||""!==t.targetPortID&&Tn(d)?t.targetPortWrapper=a?this.getWrapper(a,i.targetPortID):void 0:""!==t.targetPortID||An(c)||(t.targetPortWrapper=void 0)),void 0!==i.flip&&(t.flip=i.flip,cd(t)),"Orthogonal"===t.type&&this.lineRoutingModule&&this.diagramActions&&this.constraints&Z.DiagramConstraints.LineRouting&&!(this.diagramActions&Z.DiagramAction.ToolAction)&&"ComplexHierarchicalTree"!==this.layout.type&&(this.lineRoutingModule.renderVirtualRegion(this,!0),t.sourceID!==t.targetID)&&1<t.segments.length&&this.lineRoutingModule.refreshConnectorSegments(this,t,!1),u=this.getPoints(t)),void 0!==i.style&&zh(i.style,t.wrapper.children[0]),(0<u.length||void 0!==i.sourceDecorator||void 0!==i.targetDecorator&&Sd(Object.keys(i.targetDecorator))||void 0!==i.cornerRadius)&&(Xh(t,0<u.length?u:t.intermediatePoints,this.diagramActions),void 0!==i.type&&(g=!0),0<u.length)&&(t.wrapper.measure(new j(t.wrapper.width,t.wrapper.height)),t.wrapper.arrange(t.wrapper.desiredSize),this.updateConnectorAnnotation(t),this.updateConnectorPort(t),this.updateConnectorfixedUserHandles(t),this.updateObject(t,e,i)),(i.sourcePoint||i.targetPoint||i.segments)&&this.diagramActions===Z.DiagramAction.Render&&(g=!0),"Bpmn"===t.shape.type&&"Default"===t.shape.sequence&&"Sequence"===t.shape.flow&&this.commandHandler.updatePathElementOffset(t),n||this.updateBridging(),this.updateAnnotations(i,t),this.updateConnectorPorts(i,t),this.updatefixedUserHandle(i,t),t.wrapper.measure(new j(t.wrapper.width,t.wrapper.height)),t.wrapper.arrange(t.wrapper.desiredSize),!1===p.equals(p,t.wrapper.bounds)&&(this.updateQuad(t),"Drag"!==this.eventHandler.currentAction)&&this.updateGroupSize(t),!0!==g||!this.checkSelectedItem(t)||this.diagramActions&Z.DiagramAction.ToolAction&&!(this.diagramActions&Z.DiagramAction.UndoRedo)||this.updateSelector(),this.preventConnectorsUpdate||(!Ln(this)||Ln(this)&&-1<this.scroller.oldCollectionObjects.indexOf(t.id))&&(this.diagramActions&Z.DiagramAction.PreventZIndexOnDragging?this.updateDiagramObject(t,!0):this.updateDiagramObject(t)),this.updateConnectorEdges(t),this.diagramActions&&"New"!==t.status&&(t.status="Update"),this.triggerPropertyChange(r,t,e,i)},G.prototype.removePortEdges=function(t,e,i,n){if(t)for(var r=0;r<t.ports.length;r++){var o=t.ports[parseInt(r.toString(),10)];o.id===e&&Yh(n?o.inEdges:o.outEdges,i)}},G.prototype.updateConnectorPorts=function(t,e){if(void 0!==t.ports)for(var i=0,n=Object.keys(t.ports);i<n.length;i++){var r=n[i],o=Number(r),r=t.ports[""+r],o=e.ports[parseInt(o.toString(),10)];this.updatePort(r,o,e.wrapper,e)}},G.prototype.triggerPropertyChange=function(t,e,i,n){t||(t={element:e,cause:this.diagramActions,diagramAction:this.getDiagramAction(this.diagramActions),oldValue:i,newValue:n},this.triggerEvent(Z.DiagramEvent.propertyChange,t))},G.prototype.findInOutConnectPorts=function(t,e){var i={};return i=t?Qh(t,e):i},G.prototype.getPoints=function(t,e){var i=!(!this.lineDistributionModule||"DifferentPoint"!==this.layout.connectionPointOrigin);return t.getConnectorPoints(t.type,e,"ComplexHierarchicalTree"===this.layout.type||"HierarchicalTree"===this.layout.type?this.layout.orientation:void 0,i)},G.prototype.updateNodeProperty=function(t,e,i){if(void 0===e)this.updateElementVisibility(t,this.nameTable[t.id],e);else{t.style.opacity=i;for(var n=0;n<t.children.length;n++)t.children[parseInt(n.toString(),10)]instanceof te&&this.updateNodeProperty(t.children[parseInt(n.toString(),10)],void 0,i),t.children[parseInt(n.toString(),10)].style.opacity=i}},G.prototype.checkSelectedItem=function(t){var e=this.selectedItems,i=!1,n=[];return i=0<(n=n.concat(e.nodes,e.connectors)).length&&t.id===n[n.length-1].id?!0:i},G.prototype.updateDiagramContainerVisibility=function(t,e){if(t instanceof te)for(var i=0;i<t.children.length;i++)this.updateDiagramContainerVisibility(t.children[parseInt(i.toString(),10)],e);t.visible=e},G.prototype.updateElementVisibility=function(t,e,i){if(void 0!==i){if(t.visible=i,e instanceof _){if(e.children)for(var n=0,r=e.children;n<r.length;n++){var o=r[n];this.updateElementVisibility(this.nameTable[""+o].wrapper,this.nameTable[""+o],i)}else t.children[0].visible=i,this.updateDiagramContainerVisibility(t.children[0],i),"Bpmn"===e.shape.type&&this.bpmnModule&&this.bpmnModule.updateElementVisibility(e,i,this);var a,s;if("Bpmn"===e.shape.type&&"TextAnnotation"===e.shape.shape&&this.diagramActions&&(s=(a=this.nameTable[e.inEdges[0]]).visible,a.visible=i,this.connectorPropertyChange(a,{visible:s},{visible:i})),e.ports)for(var h=0,d=e.ports;h<d.length;h++){var l=d[h];l.visibility&Z.PortVisibility.Visible&&((y=this.getWrapper(t,l.id)).visible=i)}if(e.annotations)for(var c=0,p=e.annotations;c<p.length;c++){var g=p[c];(y=this.getWrapper(t,g.id)).visible=i&&"Visible"===y.annotationVisibility}}else if("Bpmn"===e.shape.type)for(var u=0;u<4;u++)t.children[parseInt(u.toString(),10)].visible=i;else for(u=0;u<3;u++)t.children[parseInt(u.toString(),10)].visible=i;if(e.annotations)for(var m=0,f=e.annotations;m<f.length;m++){g=f[m];(y=this.getWrapper(t,g.id)).visible=i&&"Visible"===y.annotationVisibility}if(e.expandIcon||e.collapseIcon){var y;if(y=this.getWrapper(t,"icon_content")){for(u=0;u<y.children.length;u++)y.children[parseInt(u.toString(),10)].visible=i;y.visible=i}e&&e.visible&&e.outEdges&&this.updateIconVisibility(e,0!==e.outEdges.length)}!1===i&&this.unSelect(this.nameTable[t.id]),(e instanceof _&&!this.preventNodesUpdate||e instanceof W&&!this.preventConnectorsUpdate)&&this.diagramActions&&this.updateDiagramObject(this.nameTable[t.id],void 0,!0)}},G.prototype.updateAnnotations=function(t,e){if(void 0!==t.annotations)for(var i=0,n=Object.keys(t.annotations);i<n.length;i++){var r=n[i],o=Number(r),r=t.annotations[""+r],o=e.annotations[parseInt(o.toString(),10)];this.updateAnnotation(r,o,e.wrapper,e)}},G.prototype.updatefixedUserHandle=function(t,e){if(void 0!==t.fixedUserHandles)for(var i=void 0,n=0,r=Object.keys(t.fixedUserHandles);n<r.length;n++){var o=r[n],i=Number(o),o=t.fixedUserHandles[""+o],a=e.fixedUserHandles[parseInt(i.toString(),10)];this.updateConnectorfixedUserHandle(o,a,e.wrapper,e)}},G.prototype.updateConnectorfixedUserHandle=function(t,e,i,n,r){var o=!1,a=this.getWrapper(i,e.id);void 0!==a&&(void 0!==t.width&&(a.width=t.width,o=!0),void 0!==t.height&&(a.height=t.height,o=!0),e instanceof fn&&void 0!==t.offset&&n.updateAnnotation(e,n.intermediatePoints,n.wrapper.bounds,a),e instanceof fn&&t.displacement&&(void 0===t.displacement.x&&void 0===t.displacement.y||(o=!0)),void 0!==t.fill&&(a.style.fill=t.fill),void 0!==t.handleStrokeColor&&(a.style.strokeColor=t.handleStrokeColor),void 0!==t.handleStrokeWidth&&(a.style.strokeWidth=t.handleStrokeWidth),void 0!==t.visibility&&(a.visible=t.visibility),void 0!==t.cornerRadius&&(a.cornerRadius=t.cornerRadius),this.updatefixedUserHandleContent(t,o,a,n,e,i),!0===o)&&(a.measure(new j(a.width,a.height)),a.arrange(a.desiredSize))},G.prototype.updateAnnotation=function(t,e,i,n,r){var o,a,s=!1,h=this.getWrapper(i,e.id);void 0!==h&&(void 0!==t.width&&void 0!==t.height&&(h.width=t.width,h.height=t.height,s=!0),void 0!==t.rotateAngle&&(h.rotateAngle=t.rotateAngle),!r||h instanceof an||h.refreshTextElement(),e instanceof Qe&&void 0!==t.segmentAngle&&(h.rotateAngle=e.rotateAngle),void 0!==t.rotationReference&&(h.rotationReference=t.rotationReference),e instanceof Ze&&void 0!==t.offset?(s=!0,o=(void 0!==(a=t.offset).x?a:e.offset).x,a=(void 0!==a.y?a:e.offset).y,h.setOffsetWithRespectToBounds(o,a,"Fraction"),h.relativeMode="Point"):e instanceof Qe&&(void 0!==t.offset||void 0!==t.segmentAngle||void 0!==t.alignment)&&n.updateAnnotation(e,n.intermediatePoints,n.wrapper.bounds,h),e instanceof Qe&&t.displacement&&(void 0===t.displacement.x&&void 0===t.displacement.y||(s=!0,n.updateAnnotation(e,n.intermediatePoints,n.wrapper.bounds,h))),void 0!==t.margin&&(s=!0,void 0!==t.margin.bottom&&(h.margin.bottom=t.margin.bottom),void 0!==t.margin.top&&(h.margin.top=t.margin.top),void 0!==t.margin.left&&(h.margin.left=t.margin.left),void 0!==t.margin.right)&&(h.margin.right=t.margin.right),(s||r)&&(h.width=e.width||n.width,e.template)&&(h.width=h.width||h.actualSize.width,h.height=e.height||n.height||h.actualSize.height),void 0!==t.horizontalAlignment&&(h.horizontalAlignment=t.horizontalAlignment,s=!0),void 0!==t.verticalAlignment&&(h.verticalAlignment=t.verticalAlignment,s=!0),void 0!==t.visibility&&(h.visible=!(!i.visible||!t.visibility),h.annotationVisibility=h.visible?"Visible":"Collapsed"),void 0!==t.constraints&&(h.constraints&Z.AnnotationConstraints.Select&&!(t.constraints&Z.AnnotationConstraints.Select)&&so(this,n,!1,h),h.constraints=t.constraints),void 0!==t.style&&zh(t.style,h),void 0!==t.hyperlink&&kh(t.hyperlink,h,e),this.updateAnnotationContent(t,s,h,n,e,i),!0===s&&(h.measure(new j(h.width,h.height)),h.arrange(h.desiredSize)),h instanceof an||h.refreshTextElement())},G.prototype.updatefixedUserHandleContent=function(t,e,i,n,r,o){void 0!==t&&this.updateConnectorfixedUserHandleWrapper(i,n,r,o)},G.prototype.updateConnectorfixedUserHandleWrapper=function(t,e,i,n){for(var r,o=0,a=this.views;o<a.length;o++){var s=a[o];rp(t.id+"_groupElement",s),rp(t.id+"_html_element",s)}e instanceof W&&(r=e.wrapper.children[0],r=new k(r.offsetX-r.width/2,r.offsetY-r.height/2,r.width,r.height),t=e.getFixedUserHandle(e.fixedUserHandles[e.fixedUserHandles.length-1],e.intermediatePoints,r,void 0,void 0));for(var h=0;h<n.children.length;h++)t.id===n.children[parseInt(h.toString(),10)].id&&n.children.splice(h,1,t)},G.prototype.updateAnnotationContent=function(t,e,i,n,r,o){void 0!==t.content&&(i&&("UmlActivity"!==n.shape.type||N.isBlazor()||"StructuredNode"!==n.shape.shape?i.content=t.content:i.content="<<"+t.content+">>"),i instanceof an)&&this.updateAnnotationWrapper(i,n,r,o),void 0!==t.template&&(i.content=t.template,this.updateAnnotationWrapper(i,n,r,o))},G.prototype.updateAnnotationWrapper=function(t,e,i,n){for(var r=0,o=this.views;r<o.length;r++){var a=o[r];rp(t.id+"_groupElement",a),rp(t.id+"_html_element",a)}e instanceof _?t=e.initAnnotationWrapper(i,this.element.id):e instanceof W&&(i=e.wrapper.children[0],i=new k(i.offsetX-i.width/2,i.offsetY-i.height/2,i.width,i.height),t=e.getAnnotationElement(e.annotations[e.annotations.length-1],e.intermediatePoints,i,this.getDescription,this.element.id));for(var s=0;s<n.children.length;s++)t.id===n.children[parseInt(s.toString(),10)].id&&n.children.splice(s,1,t)},G.prototype.updateNodefixedUserHandle=function(t,e,i,n){var r,o,a=!1,s=this.getWrapper(i,e.id);void 0!==s&&(void 0!==t.width&&(s.actualSize.width=t.width,a=!0),void 0!==t.height&&(s.height=t.height,a=!0),e instanceof gn&&void 0!==t.offset&&(a=!0,r=(void 0!==(o=t.offset).x?o:e.offset).x,o=(void 0!==o.y?o:e.offset).y,s.setOffsetWithRespectToBounds(r,o,"Fraction"),s.relativeMode="Point"),void 0!==t.margin&&(a=!0,void 0!==t.margin.bottom&&(s.margin.bottom=t.margin.bottom),void 0!==t.margin.top&&(s.margin.top=t.margin.top),void 0!==t.margin.left&&(s.margin.left=t.margin.left),void 0!==t.margin.right)&&(s.margin.right=t.margin.right),void 0!==t.visibility&&(s.visible=t.visibility),void 0!==t.fill&&(s.style.fill=t.fill),void 0!==t.handleStrokeColor&&(s.style.strokeColor=t.handleStrokeColor),void 0!==t.handleStrokeWidth&&(s.style.strokeWidth=t.handleStrokeWidth),void 0!==t.cornerRadius&&(s.cornerRadius=t.cornerRadius),this.updatefixedUserHandleWrapper(s,n,e,i),!0===a)&&(s.measure(new j(s.width,s.height)),s.arrange(s.desiredSize))},G.prototype.updatefixedUserHandleWrapper=function(t,e,i,n){for(var r=0,o=this.views;r<o.length;r++){var a=o[r];rp(t.id+"_groupElement",a),rp(t.id+"_html_element",a)}e instanceof _&&(t=e.initFixedUserHandles(i,void 0,void 0));for(var s=0;s<n.children.length;s++)t.id===n.children[parseInt(s.toString(),10)].id&&n.children.splice(s,1,t)},G.prototype.updatePort=function(t,e,i,n){var r,o=!1,a=this.getWrapper(i,e.id);void 0!==a&&(void 0!==t.offset&&(o=!0,n?void 0!==t.offset&&n.updateAnnotation(e,n.intermediatePoints,n.wrapper.bounds,a):(n=(void 0!==t.offset.x?t:e).offset.x,r=(void 0!==t.offset.y?t:e).offset.y,a.setOffsetWithRespectToBounds(n,r,"Fraction"),a.relativeMode="Point")),void 0!==t.width&&(o=!0,a.width=t.width),void 0!==t.height&&(o=!0,a.height=t.height),void 0!==t.connectionDirection&&(a.connectionDirection=t.connectionDirection),void 0!==t.visibility&&(a.visible=!(!i.visible||!Zh(e,Z.PortVisibility.Visible))),void 0!==t.margin&&(o=!0,void 0!==t.margin.bottom&&(a.margin.bottom=t.margin.bottom),void 0!==t.margin.top&&(a.margin.top=t.margin.top),void 0!==t.margin.right&&(a.margin.right=t.margin.right),void 0!==t.margin.left)&&(a.margin.left=t.margin.left),void 0!==t.horizontalAlignment&&(o=!0,a.horizontalAlignment=t.horizontalAlignment),void 0!==t.verticalAlignment&&(o=!0,a.verticalAlignment=t.verticalAlignment),void 0!==t.style&&(void 0!==t.style.fill&&(a.style.fill=t.style.fill),void 0!==t.style.opacity&&(a.style.opacity=t.style.opacity),void 0!==t.style.strokeColor&&(a.style.strokeColor=t.style.strokeColor),void 0!==t.style.strokeWidth&&(a.style.strokeWidth=t.style.strokeWidth),void 0!==t.style.strokeDashArray)&&(a.style.strokeDashArray=t.style.strokeDashArray),void 0!==t.shape&&a&&(n=$e(t.shape),a.data=n,a.canMeasurePath=!0),void 0!==t.pathData&&(a.data=String(t.pathData),o=!0),!0===o)&&(a.measure(new j(a.width,a.height)),a.arrange(a.desiredSize))},G.prototype.updateIcon=function(t){var e,i,n=this.getWrapper(t.wrapper,"icon_content"),r=this.diagramActions&Z.DiagramAction.Render?this.element.id:void 0,o=(n&&("SVG"===this.mode&&(e=Y(t.wrapper.id+"_icon_content",r))&&(i=Y(e.id+"_rect",r),o=Y(e.id+"_shape",r),(r=Y(o.id+"_native_element",r))&&r.parentNode.removeChild(r),o.parentNode.removeChild(o),i.parentNode.removeChild(i),e.parentNode.removeChild(e)),r=t.wrapper.children.indexOf(n),t.wrapper.children.splice(r,1)),this.getPortContainer(t));t.initIcons(this.getDescription,this.layout,o,this.element.id)},G.prototype.getPortContainer=function(t){if(t.children)for(var e=0;e<t.wrapper.children.length;e++)if(t.wrapper.children[parseInt(e.toString(),10)].id===t.id+"group_container")return t.wrapper.children[parseInt(e.toString(),10)];return t.wrapper},G.prototype.updateTooltip=function(t,e){void 0!==e.tooltip.content&&(t.tooltip.content=e.tooltip.content),void 0!==e.tooltip.position&&(t.tooltip.position=e.tooltip.position),void 0!==e.tooltip.height&&(t.tooltip.height=e.tooltip.height),void 0!==e.tooltip.width&&(t.tooltip.width=e.tooltip.width),void 0!==e.tooltip.showTipPointer&&(t.tooltip.showTipPointer=e.tooltip.showTipPointer),void 0!==e.tooltip.relativeMode&&(t.tooltip.relativeMode=e.tooltip.relativeMode)},G.prototype.updateQuad=function(t){this.spatialSearch.updateQuad(t.wrapper)&&!this.preventDiagramUpdate&&this.updatePage()},G.prototype.removeFromAQuad=function(t){if(t.children)for(var e,i=t.children,n=0;n<i.length;n++)(e=this.nameTable[i[parseInt(n.toString(),10)]])&&this.removeFromAQuad(e);this.spatialSearch.removeFromAQuad(t.wrapper);var r="SwimLane"===t.shape.type;this.spatialSearch.updateBounds(t.wrapper,r)&&!this.preventDiagramUpdate&&this.updatePage()},G.prototype.updateGroupSize=function(t){t.parentId&&(t=this.nameTable[t.parentId])&&(t.parentId?this.updateGroupSize(t):(t.wrapper.measure(new j),t.wrapper.arrange(t.wrapper.desiredSize),this.updateGroupOffset(t),this.updateDiagramObject(t)))},G.prototype.updatePage=function(){if(this.diagramActions&Z.DiagramAction.Render&&!(this.diagramActions&Z.DiagramAction.DragUsingMouse)){this.scroller.updateScrollOffsets(),this.scroller.setSize();for(var t=0,e=this.views;t<e.length;t++){var i=e[t],i=this.views[""+i];i instanceof G||i.updateView(i)}}this.diagramActions&Z.DiagramAction.DragUsingMouse&&(this.renderPageBreaks(),this.pageSettings.width&&this.pageSettings.height&&!this.pageSettings.multiplePage||(this.scroller.updateScrollOffsets(),this.scroller.setSize()))},G.prototype.protectPropertyChange=function(t){this.isProtectedOnChange=t},G.prototype.getProtectPropertyChangeValue=function(){return this.isProtectedOnChange},G.prototype.enableServerDataBinding=function(t){},G.prototype.updateShadow=function(t,e){void 0!==e.angle&&(t.angle=e.angle),void 0!==e.color&&(t.color=e.color),void 0!==e.distance&&(t.distance=e.distance),void 0!==e.opacity&&(t.opacity=e.opacity)},G.prototype.updateMargin=function(t,e){void 0!==e.margin.top&&(t.margin.top=e.margin.top),void 0!==e.margin.bottom&&(t.margin.bottom=e.margin.bottom),void 0!==e.margin.left&&(t.margin.left=e.margin.left),void 0!==e.margin.right&&(t.margin.right=e.margin.right)},G.prototype.removePreviewChildren=function(t){if(t.children&&t.children.length&&t.shape&&"SwimLane"===t.shape.type){for(var e=0;e<t.children.length;e++){var i=t.children[parseInt(e.toString(),10)],n=this.nodes.indexOf(this.nameTable[""+i]);0<=n&&this.nodes.splice(n,1),delete this.nameTable[""+i]}var r=this.nodes.indexOf(this.nameTable[this.currentSymbol.id]);0<=r&&this.nodes.splice(r,1)}},G.prototype.selectDragedNode=function(t,e,i){this.currentSymbol=t,"SVG"!==this.mode&&this.refreshDiagramLayer(),this.commandHandler.oldSelectedObjects=hd(this),this.commandHandler.select(t),this.eventHandler.mouseDown(e.event),this.eventHandler.mouseMove(e.event,e),this.preventDiagramUpdate=!1,this.updatePage(),i.style.opacity="0"},G.prototype.initDroppables=function(){var f,y,v,b=this,S={},w="selectedSymbols",x=(this.droppable=new N.Droppable(this.element),5);this.droppable.over=function(t){if(b.rulerSettings.showRulers&&(e=document.getElementById(b.element.id+"_vRuler"),e=parseFloat(e.style.width),x=e+1),0!==b.previousSelectedObjects.length||b.currentSymbol||(b.previousSelectedObjects=b.commandHandler.getSelectedObject()),b.commandHandler.PreventConnectorSplit=!0,b.currentSymbol)t.event.touches&&t.event.touches.length&&b.eventHandler.mouseMove(t.event,t.event.touches);else{var e=null;if(t.dragData||"drag"!==t.name||(i=document.getElementsByClassName("e-dragclone")[0])&&(e=i),t.dragData||e){var i=void 0,n=void 0,r=(document.getElementById(b.element.id+"content").focus(),b.eventHandler.getMousePosition(t.event)),o=void 0,e=e||t.dragData.helper,a=e.getAttribute("paletteId"),s=void 0,h=void 0,d=void 0;if(!a&&t.dragData&&(u={source:null,element:i,cancel:!1,diagram:b,dragData:t.dragData.draggedElement.ej2_instances[0].dragData,dragItem:i},c=void b.triggerEvent(Z.DiagramEvent.dragEnter,u),p=void 0,u.dragItem)&&(u.dragItem.sourcePoint&&u.dragItem.targetPoint?p=new W(b,"connectors",u.dragItem,!0):c=new _(b,"nodes",u.dragItem,!0),b.initObject(i=c||p,void 0,void 0,!0),b.enterObject=i,b.enterTable=S,i instanceof _?(c.offsetX=r.x+5+c.width*c.pivot.x,c.offsetY=r.y+c.height*c.pivot.y):i instanceof W&&(p=k.toBounds([i.sourcePoint,i.targetPoint]),l=r.x-p.left,p=r.y-p.top,i.sourcePoint.x+=l,i.sourcePoint.y+=p,i.targetPoint.x+=l,i.targetPoint.y+=p),b.preventDiagramUpdate=!0,b.currentSymbol=i,"SVG"!==b.mode&&b.refreshDiagramLayer(),b.selectDragedNode(i,t,e),delete b.enterObject,delete b.enterTable,b.droppable[w]=e,b.allowServerDataBinding=!0),a){var l=document.getElementById(a).ej2_instances[0];if(b.droppable.sourceElement=l){var c,p=l[w],a=(b.allowServerDataBinding=!1,o=Q(l[w]),f=l.childTable,p.wrapper.children[0].children[0]),g=wd(l,o,a),u=(l[w]instanceof _?("TextAnnotation"===p.shape.shape?(o.offsetX=r.x+11+g.width*o.pivot.x,o.offsetY=r.y+11+g.height*o.pivot.y):(o.offsetX=r.x+5+g.width*o.pivot.x,o.offsetY=r.y+g.height*o.pivot.y),"Bpmn"===(c=new _(b,"nodes",o,!0)).shape.type&&c.shape.activity.subProcess.processes&&c.shape.activity.subProcess.processes.length&&(c.shape.activity.subProcess.processes=[]),s=c.dragSize,h=c.previewSize,d=l.symbolDragSize,p=l.symbolPreview,c.width=s.width||d.width||h.width||p.width||c.width,c.height=s.height||d.height||h.height||p.height||c.height,"SwimLane"===c.shape.type&&(b.diagramActions|=Z.DiagramAction.PreventHistory,c.shape.isLane&&(c.children=[],y={id:"header"+q()},"Horizontal"===c.shape.orientation?(y.width=c.shape.lanes[0].header.width,y.height=c.shape.lanes[0].height):(y.width=c.shape.lanes[0].width,y.height=c.shape.lanes[0].header.height),y.style=c.shape.lanes[0].header.style,y.offsetX=r.x+x+y.width/2,y.offsetY=r.y+y.height/2,b.diagramActions|=Z.DiagramAction.PreventCollectionChangeOnDragOver,y=b.add(y),v={id:"body"+q()},"Horizontal"===c.shape.orientation?(v.width=c.shape.lanes[0].width-y.width,v.height=c.shape.lanes[0].height,v.offsetX=r.x+x+(c.shape.lanes[0].header.width+v.width/2),v.offsetY=r.y+v.height/2):(v.width=c.shape.lanes[0].width,v.height=c.shape.lanes[0].height-y.height,v.offsetX=r.x+x+v.width/2,v.offsetY=r.y+(c.shape.lanes[0].header.height+v.height/2)),v.style=c.shape.lanes[0].style,v=b.add(v),(g={id:"group"+q(),children:[y.id,v.id]}).shape=c.shape,g.width=c.shape.lanes[0].width,g.height=c.shape.lanes[0].height,g.previewSize=c.previewSize,g.dragSize=c.dragSize,g.addInfo=c.addInfo,c=b.add(g),b.diagramActions&=~Z.DiagramAction.PreventCollectionChangeOnDragOver),b.diagramActions&=~Z.DiagramAction.PreventHistory),c.shape.isPhase&&((n="Horizontal"===c.shape.orientation)?(c.offsetX=r.x+x+(c.width||a.actualSize.width)/2,c.offsetY=r.y,c.shape.data="M20,"+c.height/2+" L"+(c.width-20)+","+c.height/2+"z",c.height=1):(c.offsetX=r.x+5,c.offsetY=r.y+(c.height||a.actualSize.height)/2,c.shape.data="M"+c.width/2+",20 L"+c.width/2+","+(c.height-20)+"z",c.width=1)),"UmlClassifier"===c.shape.type&&(c.children=c.width=c.height=void 0,o.children=void 0,"Class"===c.shape.classifier&&c.shape.classShape.methods.length<=0&&c.shape.classShape.attributes.length<=0&&(c.shape.classShape.attributes=[{name:"Name",type:"Type",style:{}}]),"Enumeration"===c.shape.classifier&&c.shape.enumerationShape.members.length<=0&&(c.shape.enumerationShape.members=[{name:"Name"}]),"Interface"===c.shape.classifier)&&c.shape.interfaceShape.methods.length<=0&&c.shape.interfaceShape.attributes.length<=0&&(c.shape.interfaceShape.attributes=[{name:"Name",type:"Type",style:{}}]),i=c,o.children&&(p=o,S=b.getChildren(p,{},f),id(p,-p.offsetX,-p.offsetY,S,!0,b))):l[w]instanceof W&&(i=new W(b,"connectors",o,!0),g=k.toBounds([i.sourcePoint,i.targetPoint]),a=r.x-g.left,c=r.y-g.top,i.sourcePoint.x+=a,i.sourcePoint.y+=c,i.targetPoint.x+=a,i.targetPoint.y+=c),i.shape.isLane||(i.id+=q()),{source:l,element:i,cancel:!1,diagram:b,dragData:null,dragItem:i});if(b.enterObject=i,b.enterTable=S,b.triggerEvent(Z.DiagramEvent.dragEnter,u),i instanceof _&&"SwimLane"===i.shape.type&&i.shape.isLane&&(o=(p=u.element).shape.lanes[0],n="Horizontal"===p.shape.orientation,g=b.nameTable[i.children[0]],a=b.nameTable[i.children[1]],s=i.dragSize,h=i.previewSize,d=l.symbolDragSize,o.width=s.width||d.width||h.width||o.width,o.height=s.height||d.height||h.height||o.height,n?(y.width=o.header.width,y.height=o.height,v.width=o.width-y.width,v.height=o.height,v.offsetX=r.x+x+(o.header.width+a.width/2),v.offsetY=r.y+a.height/2):(y.width=o.width,y.height=o.header.height,v.width=o.width,v.height=o.height-y.height,v.offsetX=r.x+x+a.width/2,v.offsetY=r.y+(o.header.height+a.height/2)),y.offsetX=r.x+x+g.width/2,y.offsetY=r.y+g.height/2,i.width=o.width,i.height=o.height),i instanceof _&&i.shape.isPhase&&(n?i.height=1:i.width=1),!b.activeLayer.lock&&!u.cancel){if(b.preventDiagramUpdate=!0,i.children&&b.findChild(i,S),b.preventDiagramUpdate=!0,i.zIndex!==Number.MIN_VALUE&&(i.zIndex=Number.MIN_VALUE),b.initObject(i,void 0,void 0,!0),b.bpmnModule)for(var m=0;m<b.bpmnModule.bpmnTextAnnotationConnector.length;m++)null===b.bpmnModule.bpmnTextAnnotationConnector[parseInt(m.toString(),10)].wrapper&&b.initConnectors(b.bpmnModule.bpmnTextAnnotationConnector[parseInt(m.toString(),10)],void 0,!0);b.selectDragedNode(i,t,e)}delete b.enterObject,delete b.enterTable}b.droppable[w]=e,b.allowServerDataBinding=!0}}}},this.droppable.drop=function(p){return iu(b,void 0,void 0,function(){var e,i,n,r,o,a,s,h,d,l,c;return nu(this,function(t){if(this.allowServerDataBinding=!1,e="sourceElement",this.currentSymbol?(d=!1,r=this.currentSymbol instanceof W,p.event.touches&&this.eventHandler.mouseUp(p.event),a={source:this.droppable[e],element:this.currentSymbol,target:this.eventHandler.hoverNode||this.findObjectsUnderMouse(this.eventHandler.getMousePosition(p.event))[0]||this,cancel:!1,position:{x:this.currentSymbol.wrapper.offsetX,y:this.currentSymbol.wrapper.offsetY}},this.commandHandler.PreventConnectorSplit=!1,this.triggerEvent(Z.DiagramEvent.drop,a),h="id",(s=Q(this.currentSymbol)).hasTarget=this.currentSymbol.hasTarget,this.removeFromAQuad(this.currentSymbol),this.removeObjectsFromLayer(this.nameTable[this.currentSymbol.id]),this.removeElements(this.currentSymbol),(this.currentSymbol.shape.isLane||this.currentSymbol.shape.isPhase||"UmlClassifier"===this.currentSymbol.shape.type)&&this.removeChildInNodes(this.currentSymbol),a.cancel&&Ah(this.currentSymbol,this),this.currentSymbol.shape.isPhase&&(d=!0,n=this.currentSymbol.shape.orientation,s.shape.phases=this.currentSymbol.shape.phases),this.removePreviewChildren(this.currentSymbol),delete this.nameTable[this.currentSymbol.id],this.currentSymbol=null,this.protectPropertyChange(!0),a.cancel?this.clearSelectorLayer():(this.startGroupAction(),s&&(s.shape.isLane||d)&&(d&&(s.shape.isPhase=d,s.shape.orientation=n),this.eventHandler.addSwimLaneObject(s)),s&&"UmlClassifier"===s.shape.type&&!s.shape.relationship&&(s.children=void 0,this.clearSelectorLayer(),this.add(s)),"Bpmn"===s.shape.type&&s.shape.annotation&&s.hasTarget&&(o=s.shape.annotation.nodeId,s.shape.annotation.id=s.id,this.addTextAnnotation(s.shape.annotation,this.nameTable[""+o]),s.nodeId=""),s.shape.isLane||d||void 0===s.type&&"UmlClassifier"===s.shape.type||(s.children&&this.addChildNodes(s),a.target&&a.target instanceof _&&!r&&Ur(this,a.target)&&En(a.target)&&!this.commandHandler.isTargetSubProcess(a.target)?qr(this,a.target,s):("Bezier"===s.type&&0<s.segments.length&&(s.segments=[]),i=this.add(s,!0)),(s||i)&&(zn(this)||kn(this))&&this.select([this.nameTable[s[""+h]]],!1,this.previousSelectedObjects),this.lineRoutingModule&&this.constraints&Z.DiagramConstraints.LineRouting&&this.commandHandler.updateSelectedNodeProperties(this.selectedItems),a.target&&a.target instanceof W&&!0===this.enableConnectorSplit&&this.nameTable[s[""+h]]instanceof _&&(this.commandHandler.connectorSplit(this.nameTable[s[""+h]],a.target),this.commandHandler.PreventConnectorSplit=!1))),this.protectPropertyChange(!1),o=this.nameTable[s[""+h]],s.hasTarget&&(s.nodeId=s.hasTarget,this.remove(s)),this.bpmnModule&&o instanceof _&&s.processId&&(o.processId=s.processId,this.bpmnModule.dropBPMNchild(this.nameTable[o.processId],o,this)),a.cancel||this.endGroupAction(),"SVG"!==this.mode&&this.refreshDiagramLayer(),delete this.droppable[e]):(a={source:p.droppedElement,element:void 0,target:this.eventHandler.hoverNode||this.eventHandler.lastObjectUnderMouse||this,cancel:!1,position:void 0},this.triggerEvent(Z.DiagramEvent.drop,a),s=void 0,h="id"),d="selectedSymbols",this.droppable[d]&&this.droppable[d].parentNode)N.remove(this.droppable[d]);else for(l=document.getElementsByClassName("e-dragclone"),c=0;c<l.length;c++)l[parseInt(c.toString(),10)].remove();return this.allowServerDataBinding=!0,this.previousSelectedObjects=[],[2]})})},this.droppable.out=function(t){if("touchmove"===t.evt.type&&b.eventHandler.mouseLeave(t.evt),b.currentSymbol&&!b.eventHandler.focus){b.unSelect(b.currentSymbol),b.removeFromAQuad(b.currentSymbol),"SVG"!==b.mode&&"Native"===b.currentSymbol.shape.type&&b.removeElements(b.currentSymbol),b.removeObjectsFromLayer(b.nameTable[b.currentSymbol.id]),b.currentSymbol.shape&&"TextAnnotation"===b.currentSymbol.shape.shape&&(t=b.nameTable[b.currentSymbol.inEdges[0]],b.removeObjectsFromLayer(b.nameTable[t.id]),b.removeFromAQuad(t),b.removePreviewChildren(t),delete b.nameTable[t.id],e=b.connectors.indexOf(t),b.connectors.splice(e,1),b.removeElements(t)),b.removePreviewChildren(b.currentSymbol),delete b.nameTable[b.currentSymbol.id];var e={element:b.currentSymbol,diagram:b};if(b.triggerEvent(Z.DiagramEvent.dragLeave,e),"SVG"!==b.mode)b.refreshDiagramLayer();else if(b.removeElements(b.currentSymbol),"SwimLane"!==b.currentSymbol.shape.type&&b.currentSymbol.children&&0<b.currentSymbol.children.length)for(var i=0;i<b.currentSymbol.children.length;i++){var n=b.nameTable[b.currentSymbol.children[parseInt(i.toString(),10)]];b.removeElements(n),delete b.nameTable[b.currentSymbol.children[parseInt(i.toString(),10)]]}b.currentSymbol=null;b.droppable.selectedSymbols.style.opacity="1";delete b.droppable.sourceElement,b.diagramRenderer.rendererActions=b.removeConstraints(b.diagramRenderer.rendererActions,Z.RendererAction.DrawSelectorBorder),b.previousSelectedObject&&b.select(b.previousSelectedObject,1<b.previousSelectedObject.length),b.previousSelectedObject=null}}},G.prototype.getDropEventArgs=function(t){var e;this.eventHandler.lastObjectUnderMouse||this.eventHandler.hoverNode?(e=this.eventHandler.lastObjectUnderMouse||this.eventHandler.hoverNode,t.target=ld(e)===W?{connector:e}:{node:e}):t.target.diagramId=this.element.id},G.prototype.removeChildInNodes=function(t){if(t){if(t.children)for(var e=0;e<t.children.length;e++)this.removeChildInNodes(this.nameTable[t.children[parseInt(e.toString(),10)]]);var i=this.nodes.indexOf(t);-1!==i&&this.nodes.splice(i,1)}},G.prototype.getBlazorDragEventArgs=function(t){return t={source:t.source,element:ld(t.element)===W?{connector:t.element}:{node:t.element},cancel:t.cancel,diagramId:this.element.id}},G.prototype.findChild=function(t,e){for(var i,n=0;n<t.children.length;n++)(i=e[t.children[parseInt(n.toString(),10)]])&&(i.children&&this.findChild(i,e),i.id=i.id+q(),e[i.id]=i,t.children[parseInt(n.toString(),10)]=i.id,i=new _(this,"nodes",i,!0),this.initObject(i,void 0,void 0,!0))},G.prototype.getChildren=function(t,e,i){for(var n,r=0;r<t.children.length;r++)(n=i[t.children[parseInt(r.toString(),10)]])&&((e=n.children?this.getChildren(n,e,i):e)[n.id]=Q(n));return e},G.prototype.addChildNodes=function(t){for(var e,i=0;i<t.children.length;i++)(e=this.nameTable[t.children[parseInt(i.toString(),10)]])&&(e.children&&this.addChildNodes(e),this.add(e,!0))},G.prototype.moveNode=function(t){for(var e,i,n=this.commandHandler.getObjectLayer(t.id),r=n.zIndex,o=n.objects.length,a=0;a<this.layers.length;a++)r===this.layers[parseInt(a.toString(),10)].zIndex&&(e=this.layers[a+1]);if(1<o){var s=2;if(t.children&&0<t.children.length)for(;-1<t.children.indexOf(n.objects[o-s]);)s++;this.commandHandler.moveSvgNode(t.id,n.objects[o-s]),this.commandHandler.moveSvgNode(n.objects[o-s],t.id)}else e&&(i=this.commandHandler.getLayer(this.layerZIndexTable[e.zIndex]).objects[0])?(this.commandHandler.moveSvgNode(t.id,i),this.commandHandler.updateNativeNodeIndex(t.id,i)):this.moveObjectsUp(t,n)},G.prototype.moveObjectsUp=function(t,e){for(var i=this.layers.length-1;0<=i;i--)if(n=this.layers[parseInt(i.toString(),10)],e.id!==n.id){var n=this.commandHandler.getLayer(this.layerZIndexTable[n.zIndex]).objects[n.objects.length-1];if(n){this.commandHandler.moveSvgNode(t.id,n),this.commandHandler.moveSvgNode(n,t.id);break}}},G.prototype.insertData=function(t){return this.crudOperation(t,"create",this.getNewUpdateNodes("New"))},G.prototype.updateData=function(t){return this.crudOperation(t,"update",this.getNewUpdateNodes("Update"))},G.prototype.removeData=function(t){return this.crudOperation(t,"destroy",this.getDeletedNodes())},G.prototype.crudOperation=function(t,e,i){var n;return t?((n=this.parameterMap(t,!(t instanceof W)))&&(t=(t instanceof W?this.dataSourceSettings.connectionDataSource:this.dataSourceSettings).crudAction[""+e],this.raiseAjaxPost(JSON.stringify(n),t)),n):(this.processCrudCollection(t=i,this.dataSourceSettings.crudAction[""+e],this.dataSourceSettings.connectionDataSource.crudAction[""+e]),t)},G.prototype.processCrudCollection=function(t,e,i){if(t.nodes){var n=[],r=void 0;for(r=0;r<t.nodes.length;r++)n.push(this.parameterMap(t.nodes[parseInt(r.toString(),10)],!0));n&&0<n.length&&this.raiseAjaxPost(JSON.stringify(n),e)}if(t.connectors){n=[],r=void 0;for(r=0;r<t.connectors.length;r++)n.push(this.parameterMap(t.connectors[parseInt(r.toString(),10)],!1));n&&0<n.length&&this.raiseAjaxPost(JSON.stringify(n),i)}},G.prototype.parameterMap=function(t,e){var i,n={},r=e?this.dataSourceSettings:this.dataSourceSettings.connectionDataSource;if(r.id&&(n[r.id]=t.id),r.sourcePointX&&r.sourcePointY&&(n[r.sourcePointX]=t.sourcePoint.x,n[r.sourcePointY]=t.sourcePoint.y),r.targetPointX&&r.targetPointY&&(n[r.targetPointX]=t.targetPoint.x,n[r.targetPointY]=t.targetPoint.y),r.sourceID&&(n[r.sourceID]=t.sourceID),r.targetID&&(n[r.targetID]=t.targetID),r.crudAction&&r.crudAction.customFields&&0<r.crudAction.customFields.length)for(i=0;i<r.crudAction.customFields.length;i++)n[r.crudAction.customFields[parseInt(i.toString(),10)]]=t[r.crudAction.customFields[parseInt(i.toString(),10)]];return n},G.prototype.getNewUpdateNodes=function(t){var e,i=[],n=[];for(e in this.nameTable){var r=this.nameTable[""+e];r.status===t&&(r&&r instanceof W?(r.status="None",n):(r.status="None",i)).push(r)}return{nodes:i,connectors:n}},G.prototype.getDeletedNodes=function(){for(var t=[],e=[],i=0;i<this.crudDeleteNodes.length;i++){var n=this.crudDeleteNodes[parseInt(i.toString(),10)];n&&n.segments?e.push(n):n&&t.push(n)}return this.crudDeleteNodes=[],{nodes:t,connectors:e}},G.prototype.raiseAjaxPost=function(t,e){e=new N.Fetch(e,"POST","application/json"),t=JSON.stringify(JSON.parse(t));e.send(t).then(),e.onSuccess=function(t){}},G.prototype.getHiddenItems=function(t){if(this.contextMenuModule){this.contextMenuModule.hiddenItems=[];for(var e=0,i=t.items;e<i.length;e++){var n=i[e];if(this.contextMenuModule.ensureItems(n,t.event),n.items&&n.items.length)for(var r=0,o=n.items;r<o.length;r++){var a=o[r];this.contextMenuModule.ensureItems(a,t.event)}}return this.contextMenuModule.hiddenItems}return[]},g([N.Property("100%")],G.prototype,"width",void 0),g([N.Property(!1)],G.prototype,"enableConnectorSplit",void 0),g([N.Property("SVG")],G.prototype,"mode",void 0),g([N.Property("100%")],G.prototype,"height",void 0),g([N.Property("Circle")],G.prototype,"segmentThumbShape",void 0),g([N.Property(10)],G.prototype,"segmentThumbSize",void 0),g([N.Complex({},i)],G.prototype,"contextMenuSettings",void 0),g([N.Property(Z.DiagramConstraints.Default)],G.prototype,"constraints",void 0),g([N.Property(Z.DiagramTools.Default)],G.prototype,"tool",void 0),g([N.Property("Top")],G.prototype,"bridgeDirection",void 0),g([N.Property("transparent")],G.prototype,"backgroundColor",void 0),g([N.Complex({},h)],G.prototype,"snapSettings",void 0),g([N.Complex({},e)],G.prototype,"rulerSettings",void 0),g([N.Complex({},d)],G.prototype,"pageSettings",void 0),g([N.Complex({},mg)],G.prototype,"serializationSettings",void 0),g([N.Collection([],_)],G.prototype,"nodes",void 0),g([N.Property()],G.prototype,"drawingObject",void 0),g([N.Collection([],W)],G.prototype,"connectors",void 0),g([N.Property([])],G.prototype,"basicElements",void 0),g([N.Complex({},t)],G.prototype,"tooltip",void 0),g([N.Complex({},qp)],G.prototype,"dataSourceSettings",void 0),g([N.Property()],G.prototype,"addInfo",void 0),g([N.Property()],G.prototype,"historyManager",void 0),g([N.Property()],G.prototype,"nodeTemplate",void 0),g([N.Property()],G.prototype,"annotationTemplate",void 0),g([N.Property()],G.prototype,"userHandleTemplate",void 0),g([N.Property()],G.prototype,"fixedUserHandleTemplate",void 0),g([N.Property()],G.prototype,"getNodeDefaults",void 0),g([N.Property()],G.prototype,"nodeDefaults",void 0),g([N.Property()],G.prototype,"getConnectorDefaults",void 0),g([N.Property()],G.prototype,"connectorDefaults",void 0),g([N.Property()],G.prototype,"setNodeTemplate",void 0),g([N.Property()],G.prototype,"getDescription",void 0),g([N.Property()],G.prototype,"getCustomProperty",void 0),g([N.Property()],G.prototype,"getCustomTool",void 0),g([N.Property()],G.prototype,"getCustomCursor",void 0),g([N.Collection([],Og)],G.prototype,"customCursor",void 0),g([N.Property()],G.prototype,"updateSelection",void 0),g([N.Complex({},Ug)],G.prototype,"diagramSettings",void 0),g([N.Complex({},B)],G.prototype,"selectedItems",void 0),g([N.Complex({},n)],G.prototype,"scrollSettings",void 0),g([N.Complex({},og)],G.prototype,"layout",void 0),g([N.Complex({},Hs)],G.prototype,"commandManager",void 0),g([N.Event()],G.prototype,"dataLoaded",void 0),g([N.Event()],G.prototype,"dragEnter",void 0),g([N.Event()],G.prototype,"dragLeave",void 0),g([N.Event()],G.prototype,"dragOver",void 0),g([N.Event()],G.prototype,"click",void 0),g([N.Event()],G.prototype,"historyChange",void 0),g([N.Event()],G.prototype,"historyStateChange",void 0),g([N.Event()],G.prototype,"doubleClick",void 0),g([N.Event()],G.prototype,"textEdit",void 0),g([N.Event()],G.prototype,"scrollChange",void 0),g([N.Event()],G.prototype,"mouseWheel",void 0),g([N.Event()],G.prototype,"selectionChange",void 0),g([N.Event()],G.prototype,"sizeChange",void 0),g([N.Event()],G.prototype,"connectionChange",void 0),g([N.Event()],G.prototype,"sourcePointChange",void 0),g([N.Event()],G.prototype,"targetPointChange",void 0),g([N.Event()],G.prototype,"propertyChange",void 0),g([N.Event()],G.prototype,"positionChange",void 0),g([N.Event()],G.prototype,"keyUp",void 0),g([N.Event()],G.prototype,"keyDown",void 0),g([N.Event()],G.prototype,"animationComplete",void 0),g([N.Event()],G.prototype,"rotateChange",void 0),g([N.Event()],G.prototype,"collectionChange",void 0),g([N.Event()],G.prototype,"fixedUserHandleClick",void 0),g([N.Event()],G.prototype,"onUserHandleMouseDown",void 0),g([N.Event()],G.prototype,"onUserHandleMouseUp",void 0),g([N.Event()],G.prototype,"onUserHandleMouseEnter",void 0),g([N.Event()],G.prototype,"onUserHandleMouseLeave",void 0),g([N.Event()],G.prototype,"onFixedUserHandleMouseDown",void 0),g([N.Event()],G.prototype,"onFixedUserHandleMouseUp",void 0),g([N.Event()],G.prototype,"onFixedUserHandleMouseEnter",void 0),g([N.Event()],G.prototype,"onFixedUserHandleMouseLeave",void 0),g([N.Event()],G.prototype,"segmentCollectionChange",void 0),g([N.Event()],G.prototype,"onImageLoad",void 0),g([N.Event()],G.prototype,"expandStateChange",void 0),g([N.Event()],G.prototype,"load",void 0),g([N.Event()],G.prototype,"created",void 0),g([N.Event()],G.prototype,"mouseEnter",void 0),g([N.Event()],G.prototype,"mouseLeave",void 0),g([N.Event()],G.prototype,"mouseOver",void 0),g([N.Event()],G.prototype,"elementDraw",void 0),g([N.Event()],G.prototype,"contextMenuOpen",void 0),g([N.Event()],G.prototype,"contextMenuBeforeItemRender",void 0),g([N.Event()],G.prototype,"contextMenuClick",void 0),g([N.Event()],G.prototype,"commandExecute",void 0),g([N.Collection([],Mg)],G.prototype,"layers",void 0),g([N.Event()],G.prototype,"drop",void 0),g([N.Event()],G.prototype,"segmentChange",void 0),g([N.Event()],G.prototype,"loaded",void 0),g([N.Event()],G.prototype,"layoutUpdated",void 0),G);function G(t,e){var i,n,r=eu.call(this,t,e)||this;r.version=17.1,r.checkMenu=!1,r.isServerUpdate=!1,r.oldNodeObjects=[],r.oldDiagramObject={},r.oldConnectorObjects=[],r.canEnableBlazorObject=!1,r.connectorTable={},r.groupTable={},r.scrollActions=Z.ScrollActions.None,r.blazorActions=Z.BlazorAction.Default,r.activeLabel={id:"",parentId:"",isGroup:!1,text:void 0},r.textEditing=!1,r.isTriggerEvent=!1,r.preventNodesUpdate=!1,r.preventConnectorsUpdate=!1,r.callBlazorModel=!0,r.selectionConnectorsList=[],r.deleteVirtualObject=!1,r.canLayout=!0,r.cancelPositionChange=!1,r.isRefreshed=!1,r.swimlaneChildTable={},r.swimlaneZIndexTable={},r.canExpand=!1,r.changedConnectorCollection=[],r.changedNodesCollection=[],r.previousNodeCollection=[],r.previousConnectorCollection=[],r.crudDeleteNodes=[],r.previousSelectedObjects=[],r.blazorAddorRemoveCollection=[],r.blazorRemoveIndexCollection=[],r.diagramid=88123,r.portCenterPoint=[],r.selectedObject={helperObject:void 0,actualObject:void 0},r.deleteDependentConnector=!0,r.scaleValue=1,r.routedConnectors=[],r.pathDataStorage=new Map,r.isUndo=!1,r.mermaidNodeBaseCollection=[],r.bangShape="M0 0 a15.470625686645507,15.470625686645507 1 0,0 25.78437614440918,-3.7200001525878905 a15.470625686645507,15.470625686645507 1 0,0 25.78437614440918,0 a15.470625686645507,15.470625686645507 1 0,0 25.78437614440918,0 a15.470625686645507,15.470625686645507 1 0,0 25.78437614440918,3.7200001525878905 a15.470625686645507,15.470625686645507 1 0,0 15.470625686645507,12.276000503540038 a12.376500549316406,12.376500549316406 1 0,0 0,12.648000518798828 a15.470625686645507,15.470625686645507 1 0,0 -15.470625686645507,12.276000503540038 a15.470625686645507,15.470625686645507 1 0,0 -25.78437614440918,5.580000228881835 a15.470625686645507,15.470625686645507 1 0,0 -25.78437614440918,0 a15.470625686645507,15.470625686645507 1 0,0 -25.78437614440918,0 a15.470625686645507,15.470625686645507 1 0,0 -25.78437614440918,-5.580000228881835 a15.470625686645507,15.470625686645507 1 0,0 -10.313750457763673,-12.276000503540038 a12.376500549316406,12.376500549316406 1 0,0 0,-12.648000518798828 a15.470625686645507,15.470625686645507 1 0,0 10.313750457763673,-12.276000503540038 H0 V0 Z",r.cloudShape="M0 0 a16.18875045776367,16.18875045776367 0 0,1 26.981250762939453,-10.792500305175782 a37.77375106811523,37.77375106811523 1 0,1 43.17000122070313,-10.792500305175782 a26.981250762939453,26.981250762939453 1 0,1 37.77375106811523,21.585000610351564 a16.18875045776367,16.18875045776367 1 0,1 16.18875045776367,13.020000534057615 a21.585000610351564,21.585000610351564 1 0,1 -16.18875045776367,24.180000991821288 a26.981250762939453,16.18875045776367 1 0,1 -26.981250762939453,16.18875045776367 a37.77375106811523,37.77375106811523 1 0,1 -53.962501525878906,0 a16.18875045776367,16.18875045776367 1 0,1 -26.981250762939453,-16.18875045776367 a16.18875045776367,16.18875045776367 1 0,1 -10.792500305175782,-13.020000534057615 a21.585000610351564,21.585000610351564 1 0,1 10.792500305175782,-24.180000991821288 H0 V0 Z",r.renderTimer=null,r.ignoreCollectionWatch=!0;for(var o=0;t&&t.nodes&&o<t.nodes.length;o++)i=t.nodes[parseInt(o.toString(),10)],n=r.nodes[parseInt(o.toString(),10)],i.children&&0<i.children.length&&(i.style&&i.style.fill||(n.style.fill="transparent"),i.style&&i.style.strokeColor||(n.style.strokeColor="transparent")),i.shape&&"UmlActivity"===i.shape.type&&ih(i,n),i.shape&&"SwimLane"===i.shape.type&&Js(i,n),r.nodeDefaults&&sh(n,i,r.nodeDefaults),r.updateAnnotationText(n.annotations);if(t&&t.connectors)for(o=0;t&&t.connectors&&o<t.connectors.length;o++)i=t.connectors[parseInt(o.toString(),10)],n=r.connectors[parseInt(o.toString(),10)],r.connectorDefaults&&sh(n,i,r.connectorDefaults),r.updateAnnotationText(n.annotations);for(o=0;t&&t.connectors&&o<t.connectors.length;o++){var a=t.connectors[parseInt(o.toString(),10)],s=r.connectors[parseInt(o.toString(),10)];a.shape&&"None"!==a.shape.type&&nh(a,s)}return r}ou.prototype.exportDiagram=function(t){var e,i,n="data",r=[],o=t.margin||{},a=t&&t.region?t.region:"Content",s=t&&t.mode?t.mode:"Download",h=this.getDiagramBounds(a,t),d=(t.bounds&&(i=!0,h.x=t.bounds.x||h.x,h.y=t.bounds.y||h.y,h.width=t.bounds.width||h.width,h.height=t.bounds.height||h.height),o={top:void 0!==o.top?o.top:25,bottom:void 0!==o.bottom?o.bottom:25,right:void 0!==o.right?o.right:25,left:void 0!==o.left?o.left:25},this.diagram.nodes,"PageSettings"!==a&&(h.x-=o.left,h.y-=o.top,h.width+=o.left+o.right,h.height+=o.top+o.bottom),t.fileName||"diagram");if("SVG"!==t.format){if(null!==(n=this.setCanvas(t,h,o,s,i,a,d)))return n}else{e=t.format,t.bounds=h,t.margin=o;a=i=this.diagramAsSvg(t,o);if("Data"===s)return i;h=(new XMLSerializer).serializeToString(a);r.push(h)}if("Download"===s&&null!==n)for(var l=0;l<r.length;l++){var c,p=new Blob([r[parseInt(l.toString(),10)]],{type:"application/octet-stream"});"msie"===N.Browser.info.name?window.navigator.msSaveOrOpenBlob(p,d+"."+e):(c=A("a",{download:d+"."+e}),p=URL.createObjectURL(p),c.href=p,(p=document.createEvent("MouseEvents")).initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),c.dispatchEvent(p))}return null},ou.prototype.setCanvas=function(t,e,i,n,r,o,a){t.bounds=e,t.region=o;this.setScaleValueforCanvas(t,e);e=this.diagramAsCanvas({bounds:e,margin:i,region:o,scaleX:t.scaleX,scaleY:t.scaleY,scaleOffsetX:t.scaleOffsetX,scaleOffsetY:t.scaleOffsetY},r),r=o="JPG"===t.format?e.toDataURL("image/jpeg"):"BMP"===t.format?e.toDataURL("image/bmp"):e.toDataURL();return"Data"===n?o:(this.canvasMultiplePage(t,e,i,r,a),null)},ou.prototype.canvasMultiplePage=function(t,e,i,n,r){var o,a=this,s=[],h=n.substring(n.indexOf(":")+1,n.indexOf(";")),h=h.substring(h.indexOf("/")+1),d=(h="jpeg"===h?void 0:h.toUpperCase())||"JPG";t.multiplePage?(t.pageHeight=t.pageHeight||this.diagram.pageSettings.height,t.pageWidth=t.pageWidth||this.diagram.pageSettings.width,t.pageHeight=t.pageHeight||e.width,t.pageWidth=t.pageWidth||e.height,i=t.margin||{},t.pageOrientation&&("Landscape"===t.pageOrientation&&t.pageHeight>t.pageWidth||"Portrait"===t.pageOrientation&&t.pageWidth>t.pageHeight)&&(h=t.pageWidth,t.pageWidth=t.pageHeight,t.pageHeight=h),t.margin={top:isNaN(i.top)?0:i.top,bottom:isNaN(i.bottom)?0:i.bottom,left:isNaN(i.left)?0:i.left,right:isNaN(i.right)?0:i.right},(o=A("img",{id:this.diagram.element.id+"_printImage",src:n})).onload=function(){s=a.getMultipleImage(o,t,!0),a.exportImage(s,r,d,n)}):(s=[n],this.exportImage(s,r,d,n))},ou.prototype.exportImage=function(t,r,o,e){for(var a=[],i=t instanceof HTMLElement?0:t.length,n=0;n<i;n++){for(var s=t[parseInt(n.toString(),10)].replace(/^data:[a-z]*;,/,"").split(","),h=atob(s[1]),s=new ArrayBuffer(h.length),d=new Uint8Array(s),l=0;l<h.length;l++)d[parseInt(l.toString(),10)]=h.charCodeAt(l);a.push(s)}for(var c=0;c<a.length;c++)!function(t){var e,i,n=new Blob([a[parseInt(t.toString(),10)]],{type:"application/octet-stream"});"msie"===N.Browser.info.name?window.navigator.msSaveOrOpenBlob(n,r+"."+o):(e=A("a",{download:r+"."+o}),n=URL.createObjectURL(n),e.href=n,(i=document.createEvent("MouseEvents")).initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),setTimeout(function(){e.dispatchEvent(i)},5*(t+1)))}(c)},ou.prototype.getObjectsBound=function(t){for(var e,i=0,n=this.diagram.nodes;i<n.length;i++){var r=n[i];!r.visible||("SVG"===t.format||r instanceof be||r instanceof an)&&("SVG"!==t.format||r instanceof an)||(e=e?e.uniteRect(r.wrapper.outerBounds):r.wrapper.outerBounds)}for(var o=0,a=this.diagram.connectors;o<a.length;o++){var s=a[o];s.visible&&(e=e?e.uniteRect(s.wrapper.outerBounds):s.wrapper.outerBounds)}return e||new k(0,0,0,0)},ou.prototype.getDiagramBounds=function(t,e){var e=this.getObjectsBound(e),i=e.left,n=e.top,r=e.right-e.left,o=e.bottom-e.top,e=("Content"!==t&&(this.diagram.pageSettings&&this.diagram.pageSettings.multiplePage?(i=e.left,n=e.top,this.diagram.pageSettings.width&&(i=Math.floor(i/this.diagram.pageSettings.width)*this.diagram.pageSettings.width,r=Math.ceil(e.right/this.diagram.pageSettings.width)*this.diagram.pageSettings.width-i),this.diagram.pageSettings.height&&(n=Math.floor(n/this.diagram.pageSettings.height)*this.diagram.pageSettings.height,o=Math.ceil(e.bottom/this.diagram.pageSettings.height)*this.diagram.pageSettings.height-n),0===e.width&&null!==this.diagram.pageSettings.width&&(r=this.diagram.pageSettings.width),0===e.height&&null!==this.diagram.pageSettings.height&&(o=this.diagram.pageSettings.height)):(this.diagram.pageSettings.width&&(i=0,r=this.diagram.pageSettings.width),this.diagram.pageSettings.height&&(n=0,o=this.diagram.pageSettings.height))),this.diagram.scrollSettings.padding&&(i-=(t=this.diagram.scrollSettings.padding).left,n-=t.top,r+=t.left+t.right,o+=t.top+t.bottom),new k);return e.x=i,e.y=n,e.width=r,e.height=o,e},ou.prototype.setScaleValueforCanvas=function(t,e){var i="scaleX",n="scaleY",r="scaleOffsetX",o="scaleOffsetY";t[i]=1,t[n]=1,t[r]=0,t[o]=0,t.pageHeight=t.pageHeight||this.diagram.pageSettings.height,t.pageWidth=t.pageWidth||this.diagram.pageSettings.width;"Portrait"===(t.pageOrientation||this.diagram.pageSettings.orientation||"Portrait")?t.pageWidth>t.pageHeight&&(a=t.pageHeight,t.pageHeight=t.pageWidth,t.pageWidth=a):t.pageHeight>t.pageWidth&&(a=t.pageWidth,t.pageWidth=t.pageHeight,t.pageHeight=a),t.pageWidth&&t.pageHeight&&!t.multiplePage&&(t.stretch="Meet");var a=t.pageHeight||e.height,s=t.pageWidth||e.width;"Stretch"!==t.stretch&&"Meet"!==t.stretch&&"Slice"!==t.stretch||(t[i]=s/e.width,t[n]=a/e.height,"Meet"===t.stretch?(t[i]=t[n]=Math.min(t[i],t[n]),t[o]=(t.pageHeight-e.height*t[i])/2,t[r]=(t.pageWidth-e.width*t[i])/2):"Slice"===t.stretch&&(t[i]=t[n]=Math.max(t[i],t[n])),e.width=s,e.height=a),e.x*=t[i],e.y*=t[n]},ou.prototype.diagramAsSvg=function(t,e){var i=this.diagram.createSvg(this.diagram.element.id+"_diagram_svg",t.bounds.width,t.bounds.height),n=(document.body.appendChild(i),tp("g",{id:this.diagram.element.id+"_pageBackground"})),r=t&&t.region?t.region:"Content",o=this.getDiagramBounds(r,t),r=o.x,a=o.y,s=o.width,h=o.height;i.appendChild(n);ap(n,{x:String(r),y:String(a),width:String(s),height:String(h)}),this.setTransform(n,t.bounds,e);var d=document.getElementById(this.diagram.element.id+"gradient_pattern"),r=(d&&i.appendChild(d.cloneNode(!0)),d={x:String(r),y:String(a),width:String(s+e.left+e.right),height:String(h+e.top+e.bottom)},document.getElementById(this.diagram.element.id+"_backgroundImageLayer").cloneNode(!0)),a=(ap(r,d),i.appendChild(r),this.setTransform(r,o,e),document.getElementById(this.diagram.element.id+"_backgroundLayerrect").cloneNode(!0));if(ap(a,d),i.appendChild(a),this.setTransform(a,o,e),"SVG"===this.diagram.mode){var l,c=void 0,s=Yc(this.diagram.element.id);for(i.appendChild(s.getElementById(this.diagram.diagramLayer.id).cloneNode(!0)),c=0;c<i.childNodes.length;c++)(l=i.childNodes[parseInt(c.toString(),10)]).id===this.diagram.element.id+"_diagramLayer"&&this.setTransform(l,o,e)}else{n=tp("g",{id:this.diagram.element.id+"_diagramLayer"}),i.appendChild(n),this.setTransform(n,t.bounds,e);h=new Fs("",null,!0),r=$c(this.diagram.element.id);this.diagram.renderDiagramElements(i,h,r,!1)}return document.body.removeChild(i),i},ou.prototype.setTransform=function(t,e,i){t.setAttribute("transform","translate("+(-e.x+i.left)+", "+(-e.y+i.top)+")")},ou.prototype.diagramAsCanvas=function(t,e){var i,n,r,o,a="scaleX",s="scaleY",h="scaleOffsetX",d="scaleOffsetY",l=t.bounds,c=t.margin,p=t.region,g=this.getDiagramBounds(p,t),u=this.diagram.pageSettings.background.color,m=Op.createCanvas(this.diagram.element.id+"_diagram",t.bounds.width,t.bounds.height),f=m.getContext("2d"),l=(f.translate(-l.x,-l.y),f.save(),f.fillStyle="transparent"===this.diagram.pageSettings.background.color?"white":this.diagram.pageSettings.background.color,f.fillRect((l="Content"===p?g:l).x,l.y,l.width,l.height),this.diagram.pageSettings.background),y=(l&&l.source?(g=this.getDiagramBounds(p,t),(p=new Image).src=l.source,o=g.width/p.width,y=g.height/p.height,i=g.x,n=g.y,v=g.width,b=g.height,r=this.isImageExportable(l),"None"!==l.scale&&"None"!==l.align?(v=(o="Meet"===l.scale?Math.min(o,y):Math.max(o,y))*p.width,b=o*p.height,-1<l.align.indexOf("xmid")?i+=(g.width-v)/2:-1<l.align.indexOf("xmax")&&(i=i+g.width-v),-1<l.align.indexOf("ymid")?n+=(g.height-b)/2:-1<l.align.indexOf("ymax")&&(n=n+g.height-b),"none"!==this.diagram.pageSettings.background.color&&"transparent"!==this.diagram.pageSettings.background.color||(f.fillStyle="white",f.fillRect(g.x*t[a],g.y*t[s],g.width*t[a],g.height*t[s])),r&&f.drawImage(p,i,n,o*p.width,o*p.height)):r&&f.drawImage(p,i,n,g.width,g.height)):(f.fillStyle="transparent"===u?"white":u,f.fillRect(g.x*t[a]-c.left,g.y*t[s]-c.top,g.width*t[a]+c.left+c.right,t[s]*g.height+c.top+c.bottom)),this.diagram.pageSettings.background.color),v=this.diagram.pageSettings.width,l=(v&&(f.strokeStyle="none"===y?"transparent":y,f.lineWidth=v,f.strokeRect(g.x*t[a],g.y*t[s],g.width*t[a],g.height*t[s])),f.restore(),$c(this.diagram.element.id)),b=new Fs("",null,!1);return this.updateObjectValue(t[a],t[h],t[d],!0),this.diagram.renderDiagramElements(m,b,l,!1,!0),this.updateObjectValue(t[a],t[h],t[d],!1),m},ou.prototype.updateWrapper=function(t,e,i,n,r){if(t&&0<t.length)for(var o=0;o<t.length;o++)t[parseInt(o.toString(),10)].children&&this.updateWrapper(t[parseInt(o.toString(),10)].children,e,i,n,r),t[parseInt(o.toString(),10)].exportScaleValue.x=e,t[parseInt(o.toString(),10)].exportScaleValue.y=e,t[parseInt(o.toString(),10)].exportScaleOffset.x=i,t[parseInt(o.toString(),10)].exportScaleOffset.y=n,t[parseInt(o.toString(),10)].isExport=r},ou.prototype.scaleGradientValue=function(t,e,i){var n;0<t.style.gradient.stops.length&&(n=t.style.gradient,t.style.gradient instanceof Et?(n.x1=i?n.x1*e:n.x1/e,n.y1=i?n.y1*e:n.y1/e,n.x2=i?n.x2*e:n.x2/e,n.y2=i?n.y2*e:n.y2/e):(n.fx=i?n.fx*e:n.fx/e,n.fy=i?n.fy*e:n.fy/e,n.cx=i?n.cx*e:n.cx/e,n.cy=i?n.cy*e:n.cy/e,n.r=i?n.r*e:n.r/e))},ou.prototype.updateObjectValue=function(t,e,i,n){for(var r=0;r<this.diagram.nodes.length;r++)a=this.diagram.nodes[parseInt(r.toString(),10)].wrapper,this.scaleGradientValue(this.diagram.nodes[parseInt(r.toString(),10)],t,n),this.updateWrapper(a.children,t,e,i,n),a.exportScaleValue.x=t,a.exportScaleValue.y=t,a.exportScaleOffset.x=e,a.exportScaleOffset.y=i,a.isExport=n;for(var o=0;o<this.diagram.connectors.length;o++)for(var a=this.diagram.connectors[parseInt(o.toString(),10)].wrapper,s=0;s<a.children.length;s++)(a.children[parseInt(s.toString(),10)].isExport=n)&&(a.children[parseInt(s.toString(),10)].exportScaleValue.x=t,a.children[parseInt(s.toString(),10)].exportScaleValue.y=t,a.children[parseInt(s.toString(),10)].exportScaleOffset.x=e,a.children[parseInt(s.toString(),10)].exportScaleOffset.y=i)},ou.prototype.isImageExportable=function(t){var e=!0;if(t.source)try{var i,n=(i=Op.createCanvas(this.diagram.element.id+"temp_canvas",100,100)).getContext("2d"),r=(n.save(),new Image);r.src=t.source,n.drawImage(r,0,0,100,100),n.restore(),i.toDataURL()}catch(t){e=!1}return e},ou.prototype.getPrintCanvasStyle=function(t,e){var i=0,n=0,r=new j;return i=t.width,n=t.height,(e.pageHeight||e.pageWidth)&&(n=e.pageHeight||n,i=e.pageWidth||i),e.pageOrientation&&("Landscape"===e.pageOrientation&&i<n||"Portrait"===e.pageOrientation&&n<i)&&(t=i,i=n,n=t),r.height=n,r.width=i,r},ou.prototype.getMultipleImage=function(t,e,i){var n=[],r=A("div",{}),o=this.getPrintCanvasStyle(t,e),a=e.margin,s=a.left,h=a.top,d=a.right,l=a.bottom,c=0,p=o.width+c,g=o.height+0,u=0,m=0;if(e&&e.multiplePage){r.style.height="auto",r.style.width="auto";var f=t.height,y=t.width,v=0,b=0,S=void 0,w=0,x=0,I=void 0,C=void 0;do{for(;w=o.width,x=o.height,u+o.width>=y&&(w=y-u),m+o.height>=f&&(x=f-m),(I=(C=Op.createCanvas(this.diagram.element.id+"_multiplePrint",o.width,o.height)).getContext("2d")).drawImage(t,c+u+s,0+m+h,w-d-s,x-l-h,0+s,0+h,w-d-s,x-l-h),u+o.width>=y&&(u-=u-y),S=C.toDataURL(),I.restore(),u+=p,i?n.push(S):this.printImage(r,S,v+""+b,p+"px;",g+"px;"),v++,u<y;);}while(b++,v=c=u=0,m+o.height>=f&&(m-=m-f),(m+=g)<f)}else{a=this.getPrintCanvasStyle(t,e),e=a.width,a=a.height,S=((I=(C=Op.createCanvas(this.diagram.element.id+"_diagram",e,a)).getContext("2d")).drawImage(t,0+s,0+h,t.width-(d+s),t.height-(h+l),0+s,0+h,e-(d+s),a-(h+l)),C.toDataURL());I.restore(),i?n.push(S):this.printImage(r,S,0)}return i?n:r},ou.prototype.printImage=function(t,e,i,n,r){n={class:"e-diagram-print-page",style:"width:"+n+"height:"+r},r=A("img",n),n=A("div",n);hp(r,{id:this.diagram.element.id+"_multiplePrint_img"+i,style:"float:left",src:e}),n.appendChild(r),t.appendChild(n)},ou.prototype.print=function(t){t.mode="Data";var e=this.exportDiagram(t);this.printImages(e,t)},ou.prototype.printImages=function(t,i){var n=this,t={id:this.diagram.element.id+"_printImage",src:t},r=(i.margin={top:0,bottom:0,right:0,left:0},A("img",t));r.onload=function(){var t=n.getMultipleImage(r,i),e=window.open("");null!=(n.printWindow=e)&&t instanceof HTMLElement&&(e.document.write("<html><head><style> body{margin:0px;}  @media print { .e-diagram-print-page{page-break-after: left; }.e-diagram-print-page:last-child {page-break-after: avoid;}}</style><title></title></head>"),window.addEventListener("beforeunload",n.closePrintWindow),e.addEventListener("load",function(){setTimeout(function(){e.window.print(),e.close()},3e3)}),e.document.write("<center>"+t.innerHTML+"</center>"),e.document.close())}},ou.prototype.getContent=function(t){for(var e=this.diagram.snapSettings.constraints,i=(this.diagram.snapSettings.constraints=this.diagram.snapSettings.constraints&~Z.SnapConstraints.ShowLines,this.diagram.dataBind(),this.diagram.clearSelection(),t=t||document.styleSheets,""),n=0;n<t.length;n++)!t[parseInt(n.toString(),10)].href&&"string"!=typeof t[parseInt(n.toString(),10)]||(i+="<link href='"+(t[parseInt(n.toString(),10)].href||t[parseInt(n.toString(),10)])+"' rel='stylesheet' />");var r=document.getElementById(this.diagram.element.id+"content").innerHTML;return r=(r=i+"<body style=\"margin: 0px; padding: 0px\"><div style='margin-left:0px;margin-top:0px;margin-right:0px;margin-bottom:0px;'>"+r+"</div></body>").replace(/ transform: t/g," -webkit-transform: t"),this.diagram.snapSettings.constraints=e,this.diagram.dataBind(),r},ou.prototype.getDiagramContent=function(t){var e,i,n,r,o,a,s,h,d,l,c;return 1===this.diagram.scroller.currentZoom?c=this.getContent(t):(e=(s=document.getElementById(this.diagram.element.id+"content")).scrollLeft,i=s.scrollTop,n=this.diagram.scrollSettings.currentZoom,r=this.diagram.scroller.horizontalOffset,o=this.diagram.scroller.verticalOffset,a=Number(String(this.diagram.width).split("%")[0])?s.clientWidth:Number(String(this.diagram.width).split("px")[0]),s=Number(String(this.diagram.height).split("%")[0])?s.clientHeight:Number(String(this.diagram.height).split("px")[0]),h=this.getDiagramBounds("",{}),this.diagram.scroller.zoom(1/n),l=d=0,d=h.x,l=h.y,this.diagram.scroller.transform={tx:-d,ty:-l,scale:this.diagram.scroller.currentZoom},this.diagram.scroller.horizontalOffset=-d,this.diagram.scroller.verticalOffset=-l,this.diagram.scroller.setSize(),this.diagram.setSize(h.width,h.height),c=this.getContent(t),this.diagram.setSize(a,s),this.diagram.scroller.zoom(n/this.diagram.scrollSettings.currentZoom),this.diagram.dataBind(),e||i?this.diagram.setOffset(e,i):(this.diagram.scroller.transform={tx:r/this.diagram.scroller.currentZoom,ty:o/this.diagram.scroller.currentZoom,scale:this.diagram.scroller.currentZoom},this.diagram.scroller.horizontalOffset=r,this.diagram.scroller.verticalOffset=o),this.diagram.renderSelector(!1)),bd()?c.replace("url("+location.protocol+"//"+location.host+location.pathname+"#diagram_pattern ","url(#diagram_pattern)"):c},ou.prototype.exportImages=function(i,n){var r=this,t=n&&n.region?n.region:"Content",o=n.margin||{},o={top:isNaN(o.top)?0:o.top,bottom:isNaN(o.bottom)?0:o.bottom,left:isNaN(o.left)?0:o.left,right:isNaN(o.right)?0:o.right},a=this.getDiagramBounds(t,{}),s=(n.bounds&&(a.x=(isNaN(n.bounds.x)?a:n.bounds).x,a.y=(isNaN(n.bounds.y)?a:n.bounds).y,a.width=n.bounds.width||a.width,a.height=n.bounds.height||a.height),document.createElement("img")),h=(hp(s,{src:i}),this);s.onload=function(){var t=Op.createCanvas(h.diagram.element.id+"innerImage",a.width+(o.left+o.right),a.height+(o.top+o.bottom)),e=t.getContext("2d");e.fillStyle=h.diagram.pageSettings.background.color,e.fillRect(0,0,a.width+(o.left+o.right),a.height+(o.top+o.bottom)),e.drawImage(s,0,0,a.width,a.height,o.left,o.top,a.width,a.height),i=i&&"JPG"===n.format?t.toDataURL("image/jpeg"):t.toDataURL(),n.printOptions?h.printImages(i,n):(e.restore(),e=n.fileName||"diagram",r.canvasMultiplePage(n,t,o,i,e))},"SVG"===n.format&&this.exportDiagram(n)},ou.prototype.destroy=function(){window.removeEventListener("beforeunload",this.closePrintWindow),this.printWindow=void 0},ou.prototype.getModuleName=function(){return"PrintandExport"};Jg=ou;function ou(t){var e=this;this.printWindow=void 0,this.closePrintWindow=function(){e.printWindow&&!e.printWindow.closed&&e.printWindow.close()},this.diagram=t}au.prototype.destroy=function(){},au.prototype.getModuleName=function(){return"DataBinding"},au.prototype.initData=function(t,e){var i=t.dataManager||t.dataSource||{},n=i.data||i.json||(i.dataSource?i.dataSource.json:void 0);(n=n&&0===n.length&&i.dataSource.data?i.dataSource.data:n)&&n.length&&(this.applyDataSource(t,n,e),e.trigger("dataLoaded",{diagram:N.isBlazor()?null:e}))},au.prototype.initSource=function(e,i){var n,r=this,t=e,o=e;(t.dataManager instanceof b.DataManager||t.dataSource instanceof b.DataManager)&&(t=(o.dataManager||o.dataSource).defaultQuery||new b.Query,(e.dataManager||e.dataSource).executeQuery(t).then(function(t){n=t.result,i.isDestroyed||(i.protectPropertyChange(!0),r.applyDataSource(e,n,i),i.refreshDiagram(),i.protectPropertyChange(!1),i.trigger("dataLoaded",{diagram:N.isBlazor()?null:i}))}))},au.prototype.applyDataSource=function(t,e,i){this.dataTable={};var n,r,o,a,s=[],h=[];if(void 0!==e){for(var d=0;d<e.length;d++)void 0===(n=e[parseInt(d.toString(),10)])[t.parentId]||null===n[t.parentId]||"object"!=typeof n[t.parentId]?isNaN(n[t.parentId])&&void 0!==n[t.parentId]?void 0!==s[n[t.parentId]&&n[t.parentId].toLowerCase()]?s[n[t.parentId].toLowerCase()].items.push(n):s[n[t.parentId]&&n[t.parentId].toLowerCase()]={items:[n]}:void 0!==s[n[t.parentId]]?s[n[t.parentId]].items.push(n):s[n[t.parentId]]={items:[n]}:s=this.updateMultipleRootNodes(n,s,t,e),t.root&&isNaN(t.root)&&n[t.id]&&isNaN(n[t.id])?t.root.toLowerCase()===n[t.id].toLowerCase()&&(r={items:[n]}):t.root===n[t.id]&&(r={items:[n]});if(r)h.push(r);else for(var l=0,c=Object.keys(s);l<c.length;l++){var p=c[l];p&&"undefined"!==p&&"''"!==p&&"null"!==p||h.push(s[""+p])}for(var g=0;g<h.length;g++)for(var u=0;u<h[parseInt(g.toString(),10)].items.length;u++)a=h[parseInt(g.toString(),10)].items[parseInt(u.toString(),10)],o=this.applyNodeTemplate(t,a,i),i.nodes.push(o),isNaN(a[t.id])&&void 0!==a[t.id]?this.dataTable[a[t.id].toLowerCase()]=o:this.dataTable[a[t.id]]=o,void 0!==(a=isNaN(o.data[t.id])&&void 0!==o.data[t.id]?s[o.data[t.id].toLowerCase()]:s[o.data[t.id]])&&this.renderChildNodes(t,a,o.id,s,i)}this.dataTable=null},au.prototype.updateMultipleRootNodes=function(t,e,i,n){for(var r,o=t[i.parentId],a=0;a<o.length;a++)o[parseInt(a.toString(),10)]?e[""+(r=isNaN(o[parseInt(a.toString(),10)])?o[parseInt(a.toString(),10)].toLowerCase():o[parseInt(a.toString(),10)])]?e[""+r].items.push(t):e[""+r]={items:[t]}:e[""+(r=o[parseInt(a.toString(),10)])]?e[""+r].items.push(t):e[""+r]={items:[t]};return e},au.prototype.applyNodeTemplate=function(t,e,i){var n,r={id:q(),data:e},o=("Flowchart"===i.layout.type&&(o=this.getFlowChartNodeShape(e),n={fill:e.color||"white",strokeColor:e.stroke||"black",strokeWidth:e.strokeWidth||1},r.shape=o,r.style=n,r.annotations=[{content:e.name||""}]),Dp(t.doBinding)),a=(o&&o(r,e,i),new _(i,"nodes",r,!0));if(sh(a,r,i.nodeDefaults),t.dataMapSettings)for(var s=void 0,h=[],d=[],l=0;l<t.dataMapSettings.length;l++){if(-1!==t.dataMapSettings[parseInt(l.toString(),10)].property.indexOf(".")){for(var d=this.splitString(t.dataMapSettings[parseInt(l.toString(),10)].property),c=0;c<d.length;c++)-1!==d[parseInt(c.toString(),10)].indexOf("[")&&(s=d[parseInt(c.toString(),10)].indexOf("["),h=d[parseInt(c.toString(),10)].split("["));s?d[2]?a[h[0]][d[0].charAt(s+1)][d[1]][d[2]]=e[t.dataMapSettings[parseInt(l.toString(),10)].field]:(p=e[t.dataMapSettings[parseInt(l.toString(),10)].field],a[h[0]][d[0].charAt(s+1)][d[1]]=p):d[2]?a[d[0]][d[1]][d[2]]=e[t.dataMapSettings[parseInt(l.toString(),10)].field]:a[d[0]][d[1]]=e[t.dataMapSettings[parseInt(l.toString(),10)].field]}else{var p=t.dataMapSettings[parseInt(l.toString(),10)].property;a[""+(p=p.charAt(0).toLowerCase()+p.slice(1))]=e[t.dataMapSettings[parseInt(l.toString(),10)].field]}s=0,h=[],d=[]}return this.collectionContains(a,i,t.id,t.parentId)?e[t.id]&&isNaN(e[t.id])?this.dataTable[e[t.id].toLowerCase()]:this.dataTable[e[t.id]]:a},au.prototype.getFlowChartNodeShape=function(t){if(""!==t.shape)switch(t.shape){case"Rectangle":return{type:"Basic",shape:"Rectangle"};case"Decision":return{type:"Flow",shape:"Decision"};case"Hexagon":return{type:"Path",data:"M 0 0 L 2 -2 L 11 -2 L 13 0 L 11 2 L 2 2 L 0 0"};case"Ellipse":return{type:"Basic",shape:"Ellipse"};case"Terminator":return{type:"Flow",shape:"Terminator"};case"PredefinedProcess":return{type:"Flow",shape:"PreDefinedProcess"};case"Parallelogram":return{type:"Basic",shape:"Parallelogram"};case"ParallelogramAlt":return{type:"Path",data:"M 0 0 L 12 0 L 14 2 L 2 2 L 0 0"};case"Trapezoid":return{type:"Path",data:"M 0 0 L 1 -1 L 5 -1 L 6 0 L 0 0"};case"TrapezoidAlt":return{type:"Path",data:"M 0 0 L 5 0 L 4 1 L 1 1 L 0 0"};case"DataSource":return{type:"Path",data:"M 0 1 L 0 6 C 2 7 4 7 6 6 L 6 1 C 5 0 1 0 0 1 C 1 2 5 2 6 1"};case"Asymmetric":return{type:"Path",data:"M 0 0 L 8 0 L 8 2 L 0 2 L 2 1 L 0 0"};case"DoubleCircle":return{type:"Path",data:"M 0 0 A 1 1 0 0 0 7 0 A 1 1 0 0 0 0 0 M -1 0 A 1 1 0 0 0 8 0 A 1 1 0 0 0 -1 0"};case"Document":return{type:"Flow",shape:"Document"};case"PaperTap":return{type:"Flow",shape:"PaperTap"};case"DirectData":return{type:"Flow",shape:"DirectData"};case"SequentialData":return{type:"Flow",shape:"SequentialData"};case"Sort":return{type:"Flow",shape:"Sort"};case"MultiDocument":return{type:"Flow",shape:"MultiDocument"};case"Collate":return{type:"Flow",shape:"Collate"};case"SummingJunction":return{type:"Flow",shape:"SummingJunction"};case"Or":return{type:"Flow",shape:"Or"};case"InternalStorage":return{type:"Flow",shape:"InternalStorage"};case"Extract":return{type:"Flow",shape:"Extract"};case"ManualOperation":return{type:"Flow",shape:"ManualOperation"};case"Merge":return{type:"Flow",shape:"Merge"};case"OffPageReference":return{type:"Flow",shape:"OffPageReference"};case"SequentialAccessStorage":return{type:"Flow",shape:"SequentialAccessStorage"};case"Data":return{type:"Flow",shape:"Data"};case"Card":return{type:"Flow",shape:"Card"};case"Delay":return{type:"Flow",shape:"Delay"};case"Preparation":return{type:"Flow",shape:"Preparation"};case"Display":return{type:"Flow",shape:"Display"};case"ManualInput":return{type:"Flow",shape:"ManualInput"};case"LoopLimit":return{type:"Flow",shape:"LoopLimit"};case"StoredData":return{type:"Flow",shape:"StoredData"};case"Annotation":return{type:"Flow",shape:"Annotation"};case"Annotation2":return{type:"Flow",shape:"Annotation2"};default:return{type:"Flow",shape:"Process"}}return{type:"Flow",shape:"Process"}},au.prototype.splitString=function(t){for(var e=[],e=t.split("."),i=0;i<e.length;i++)e[parseInt(i.toString(),10)]=e[parseInt(i.toString(),10)].charAt(0).toLowerCase()+e[parseInt(i.toString(),10)].slice(1);return e},au.prototype.renderChildNodes=function(t,e,i,n,r){for(var o,a,s,h=0;h<e.items.length;h++)(s=e.items[parseInt(h.toString(),10)])[t.id]&&(o=this.applyNodeTemplate(t,s,r),a=!1,this.collectionContains(o,r,t.id,t.parentId)?a=!0:(s[t.id]&&isNaN(s[t.id])?this.dataTable[s[t.id].toLowerCase()]=o:this.dataTable[s[t.id]]=o,r.nodes.push(o)),this.containsConnector(r,i,o.id)||r.connectors.push(this.applyConnectorTemplate(i,o.id,r)),a||void 0!==(s=o.data[t.id]&&isNaN(o.data[t.id])?n[o.data[t.id].toLowerCase()]:n[o.data[t.id]])&&this.renderChildNodes(t,s,o.id,n,r))},au.prototype.containsConnector=function(t,e,i){return""!==e&&""!==i&&t.connectors.some(function(t){return void 0!==t&&t.sourceID===e&&t.targetID===i})},au.prototype.collectionContains=function(t,e,i,n){var r=isNaN(t.data[""+i])&&t.data[""+i]?this.dataTable[t.data[""+i].toLowerCase()]:this.dataTable[t.data[""+i]];return void 0!==r&&r.data[""+i]===t.data[""+i]&&r.data[""+n]===t.data[""+n]},au.prototype.applyConnectorTemplate=function(t,e,i){var n,r,t={id:q(),sourceID:t,targetID:e},o=("Flowchart"===i.layout.type&&("string"==typeof(n=i.nodes.find(function(t){return t.id===e})).data.label?t.annotations=[{content:n.data.label}]:Array.isArray(n.data.label)&&((o=0)<(r=i.connectors.filter(function(t){return t.targetID===e})).length&&(o=r.length),t.annotations=[{content:n.data.label[parseInt(o.toString(),10)]}]),r=this.getConnectorArrowType(n.data)),new W(i,"connectors",t,!0));return r&&(o.style.strokeWidth=r.strokeWidth,o.targetDecorator.shape=r.targetDecorator),sh(o,t,i.connectorDefaults),o},au.prototype.getConnectorArrowType=function(t){if(""===t.arrowType)return{targetDecorator:"Arrow",strokeWidth:1};switch(t.arrowType){case"None":return{targetDecorator:"None",strokeWidth:1};case"Arrow":return{targetDecorator:"Arrow",strokeWidth:1};case"Diamond":return{targetDecorator:"Diamond",strokeWidth:1};case"Circle":return{targetDecorator:"Circle",strokeWidth:1};case"OpenArrow":return{targetDecorator:"OpenArrow",strokeWidth:1};case"Square":return{targetDecorator:"Square",strokeWidth:1};case"Fletch":return{targetDecorator:"Fletch",strokeWidth:1};case"OpenFetch":return{targetDecorator:"OpenFetch",strokeWidth:1};case"IndentedArrow":return{targetDecorator:"IndentedArrow",strokeWidth:1};case"OutdentedArrow":return{targetDecorator:"OutdentedArrow",strokeWidth:1};case"DoubleArrow":return{targetDecorator:"DoubleArrow",strokeWidth:1};default:return{targetDecorator:"Arrow",strokeWidth:1}}};e=au;function au(){this.dataTable={}}var su=function(o,a,s,h){return new(s=s||Promise)(function(t,e){function i(t){try{r(h.next(t))}catch(t){e(t)}}function n(t){try{r(h.throw(t))}catch(t){e(t)}}function r(e){e.done?t(e.value):new s(function(t){t(e.value)}).then(i,n)}r((h=h.apply(o,a||[])).next())})},hu=function(n,r){var o,a,s,h={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(i){return function(t){var e=[i,t];if(o)throw new TypeError("Generator is already executing.");for(;h;)try{if(o=1,a&&(s=2&e[0]?a.return:e[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,e[1])).done)return s;switch(a=0,(e=s?[2&e[0],s.value]:e)[0]){case 0:case 1:s=e;break;case 4:return h.label++,{value:e[1],done:!1};case 5:h.label++,a=e[1],e=[0];continue;case 7:e=h.ops.pop(),h.trys.pop();continue;default:if(!(s=0<(s=h.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){h=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3]))h.label=e[1];else if(6===e[0]&&h.label<s[1])h.label=s[1],s=e;else{if(!(s&&h.label<s[2])){s[2]&&h.ops.pop(),h.trys.pop();continue}h.label=s[2],h.ops.push(e)}}e=r.call(n,h)}catch(t){e=[6,t],a=0}finally{o=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}}},du={content:".e-diagramcontent",copy:"e-copy",paste:"e-paste",undo:"e-undo",redo:"e-redo",cut:"e-cut",selectAll:"e-selectall",grouping:"e-grouping",group:"e-group",unGroup:"e-ungroup",bringToFront:"e-bringfront",sendToBack:"e-sendback",moveForward:"e-bringforward",sendBackward:"e-sendbackward",order:"e-order"},d=(lu.prototype.addEventListener=function(){this.parent.isDestroyed||this.parent.on("initial-load",this.render,this)},lu.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off("initial-load",this.render)},lu.prototype.render=function(){this.l10n=this.serviceLocator.getService("localization"),this.element=A("ul",{id:this.parent.element.id+"_contextMenu"}),this.parent.element.appendChild(this.element);var t="#"+this.parent.element.id;this.contextMenu=new S.ContextMenu({items:this.getMenuItems(),enableRtl:this.parent.enableRtl,enablePersistence:this.parent.enablePersistence,locale:this.parent.locale,target:t,select:this.contextMenuItemClick.bind(this),beforeOpen:this.contextMenuBeforeOpen.bind(this),onOpen:this.contextMenuOpen.bind(this),beforeItemRender:this.BeforeItemRender.bind(this),onClose:this.contextMenuOnClose.bind(this),cssClass:"e-diagram-menu",animationSettings:{effect:"None"}}),this.contextMenu.appendTo(this.element)},lu.prototype.getMenuItems=function(){var t=[],e=[],i=[];if(!this.parent.contextMenuSettings.showCustomMenuOnly){for(var n=0,r=this.getDefaultItems();n<r.length;n++){var o=r[n];-1!==o.toLocaleLowerCase().indexOf("group")?"grouping"!==o.toLocaleLowerCase()&&i.push(this.buildDefaultItems(o)):-1!==o.toLocaleLowerCase().indexOf("order")?"order"!==o.toLocaleLowerCase()&&e.push(this.buildDefaultItems(o)):t.push(this.buildDefaultItems(o))}var a=this.buildDefaultItems("grouping"),a=(a.items=i,t.push(a),this.buildDefaultItems("order"));a.items=e,t.push(a)}if(this.parent.contextMenuSettings.items)for(var s=0,h=this.parent.contextMenuSettings.items;s<h.length;s++){var d=h[s];t.push(d)}return t},lu.prototype.contextMenuOpen=function(){this.isOpen=!0},lu.prototype.BeforeItemRender=function(t){this.parent.trigger(Kt,t)},lu.prototype.contextMenuItemClick=function(t){document.getElementById(this.parent.element.id+"content").focus(),this.parent.trigger(Gt,t);var e=this.getKeyFromId(t.item.id);if(!t.cancel)switch(e){case"cut":this.parent.cut();break;case"copy":this.parent.copy();break;case"undo":this.parent.undo();break;case"redo":this.parent.redo();break;case"paste":this.parent.paste();break;case"selectAll":this.parent.selectAll();break;case"group":this.parent.group();break;case"unGroup":this.parent.unGroup();break;case"bringToFrontOrder":this.parent.bringToFront();break;case"moveForwardOrder":this.parent.moveForward();break;case"sendToBackOrder":this.parent.sendToBack();break;case"sendBackwardOrder":this.parent.sendBackward()}},lu.prototype.contextMenuOnClose=function(t){0<t.items.length&&t.items[0].parentObj instanceof S.ContextMenu&&this.updateItemStatus()},lu.prototype.getLocaleText=function(t){return this.l10n.getConstant(this.localeText[""+t])},lu.prototype.updateItemStatus=function(){this.contextMenu.showItems(this.hiddenItems,!0),this.contextMenu.enableItems(this.disableItems,!1,!0),this.hiddenItems=[],this.disableItems=[],this.isOpen=!1},lu.prototype.ensureItems=function(t,e){var i=this.getKeyFromId(t.id);this.defaultItems[""+i];-1!==this.getDefaultItems().indexOf(i)&&t.target&&(e||this.parent.checkMenu)&&!this.ensureTarget(t)&&this.hiddenItems.push(t.id)},lu.prototype.refreshItems=function(){this.updateItems(),this.contextMenu.refresh()},lu.prototype.updateItems=function(){for(var t=!0,e=0;e<this.parent.contextMenuSettings.items.length;e++){for(var i=this.parent.contextMenuSettings.items[parseInt(e.toString(),10)],n=0;n<this.contextMenu.items.length;n++)this.contextMenu.items[parseInt(n.toString(),10)].text===this.parent.contextMenuSettings.items[parseInt(e.toString(),10)].text&&(t=!1);t&&this.contextMenu.insertAfter([i],this.contextMenu.items[this.contextMenu.items.length-1].text)}},lu.prototype.contextMenuBeforeOpen=function(c){return su(this,void 0,void 0,function(){var e,i,n,r,o,a,s,h,d,l;return hu(this,function(t){for(this.parent.checkMenu||-1===window.navigator.userAgent.indexOf("Linux")&&-1===window.navigator.userAgent.indexOf("X11")||(this.parent.checkMenu=c.cancel=!0),this.parent.checkMenu&&(this.hiddenItems=[]),(e=c).hiddenItems=[],i=0,n=c.items;i<n.length;i++)if(l=n[i],this.ensureItems(l,c.event),l.items.length)for(r=0,o=l.items;r<o.length;r++)a=o[r],this.ensureItems(a,c.event);for(this.eventArgs=c.event,this.parent.trigger(Zt,e),s=!0,this.hiddenItems=this.hiddenItems.concat(e.hiddenItems),this.contextMenu.enableItems(this.disableItems,!1,!0),h=this,d=0;d<c.items.length;d++)l=c.items[parseInt(d.toString(),10)],-1<h.hiddenItems.indexOf(l.id)&&h.contextMenu.hideItems([l.id],!0);for(d=0;d<h.contextMenu.items.length;d++)l=h.contextMenu.items[parseInt(d.toString(),10)],-1===h.hiddenItems.indexOf(l.id)&&(s=!1,h.contextMenu.showItems([l.id],!0));return s&&(e.cancel=s,this.hiddenItems=[]),this.parent.selectedItems.nodes.length&&this.parent.selectedItems.nodes[0].isPhase&&!this.parent.contextMenuSettings.showCustomMenuOnly&&(c.cancel=!0),[2]})})},lu.prototype.ensureTarget=function(t){var e=this.parent.selectedItems.nodes.length+this.parent.selectedItems.connectors.length,i=!1;switch(this.getKeyFromId(t.id)){case"undo":i=!(!this.parent.historyManager||!this.parent.historyManager.canUndo);break;case"redo":i=!(!this.parent.historyManager||!this.parent.historyManager.canRedo);break;case"paste":i=!!this.parent.commandHandler.clipboardData.clipObject;break;case"selectAll":i=!!(this.parent.nodes.length+this.parent.connectors.length);break;case"grouping":i=!!(1<e||this.parent.selectedItems.nodes[0]&&this.parent.selectedItems.nodes[0].children&&1<this.parent.selectedItems.nodes[0].children.length);break;case"group":i=1<e;break;case"unGroup":i=!!(1===this.parent.selectedItems.nodes.length&&0===this.parent.selectedItems.connectors.length&&this.parent.selectedItems.nodes[0]&&this.parent.selectedItems.nodes[0].children&&1<this.parent.selectedItems.nodes[0].children.length);break;case"cut":case"copy":case"order":case"bringToFrontOrder":case"moveForwardOrder":case"sendToBackOrder":case"sendBackwardOrder":i=!!e}return i},lu.prototype.destroy=function(){this.contextMenu.destroy(),N.remove(this.element),this.removeEventListener()},lu.prototype.getModuleName=function(){return"contextMenu"},lu.prototype.generateID=function(t){return this.parent.element.id+"_contextMenu_"+t},lu.prototype.getKeyFromId=function(t){return t.replace(this.parent.element.id+"_contextMenu_","")},lu.prototype.buildDefaultItems=function(t){var e;switch(t){case"copy":e={target:du.content,iconCss:du.copy};break;case"cut":e={target:du.content,iconCss:du.cut};break;case"paste":e={target:du.content,iconCss:du.paste};break;case"undo":e={target:du.content,iconCss:du.undo};break;case"redo":e={target:du.content,iconCss:du.redo};break;case"grouping":e={target:du.content};break;case"group":e={target:du.content,iconCss:du.group};break;case"unGroup":e={target:du.content,iconCss:du.unGroup};break;case"order":e={target:du.content,iconCss:du.order};break;case"bringToFrontOrder":e={target:du.content,iconCss:du.bringToFront};break;case"moveForwardOrder":e={target:du.content,iconCss:du.moveForward};break;case"sendToBackOrder":e={target:du.content,iconCss:du.sendToBack};break;case"sendBackwardOrder":e={target:du.content,iconCss:du.sendBackward};break;case"selectAll":e={target:du.content}}return this.defaultItems[""+t]={text:this.getLocaleText(t),id:this.generateID(t),target:e.target,iconCss:e.iconCss?"e-icons "+e.iconCss:""},this.defaultItems[""+t]},lu.prototype.getDefaultItems=function(){return["copy","cut","paste","undo","redo","selectAll","grouping","group","unGroup","order","bringToFrontOrder","moveForwardOrder","sendToBackOrder","sendBackwardOrder"]},lu.prototype.setLocaleKey=function(){return{copy:"Copy",cut:"Cut",paste:"Paste",undo:"Undo",redo:"Redo",selectAll:"SelectAll",grouping:"Grouping",group:"Group",unGroup:"UnGroup",order:"Order",bringToFrontOrder:"BringToFront",moveForwardOrder:"MoveForward",sendToBackOrder:"SendToBack",sendBackwardOrder:"SendBackward"}},lu);function lu(t,e){this.defaultItems={},this.disableItems=[],this.hiddenItems=[],this.localeText=this.setLocaleKey(),this.parent=t,this.serviceLocator=e,this.addEventListener()}u.prototype.getSize=function(t,e){var i=new j(t.width,t.height);if(void 0===i.width||void 0===i.height){if(e instanceof P||(i.width=i.width||50,i.height=i.height||50),e.actualSize.width&&e.actualSize.height)return e.actualSize;e.measure(new j),i.width=i.width||e.desiredSize.width,i.height=i.height||e.desiredSize.height,void 0!==t.maxWidth&&(i.width=Math.min(i.width,t.maxWidth)),void 0!==t.maxHeight&&(i.height=Math.min(i.height,t.maxHeight)),void 0!==t.minWidth&&(i.width=Math.max(i.width,t.minWidth)),void 0!==t.minHeight&&(i.height=Math.max(i.height,t.minHeight))}return i},u.prototype.initBPMNContent=function(t,e,i){var n=e.shape,r=e.shape.shape;return"Event"===r&&(t=this.getBPMNEventShape(e,n.event)),"Gateway"===r&&(t=this.getBPMNGatewayShape(e)),"DataObject"===r&&(t=this.getBPMNDataObjectShape(e)),"Message"!==r&&"DataSource"!==r||(t=this.getBPMNShapes(e)),"Group"===r&&((t=this.getBPMNGroup(e,i)).style.strokeDashArray=""!==e.style.strokeDashArray?e.style.strokeDashArray:"2 2 6 2",t.cornerRadius=10),"Activity"===r&&(t=this.getBPMNActivityShape(e)),t="TextAnnotation"===r?e.parentObj instanceof ru||e.parentObj instanceof Ac?this.getBpmnTextAnnotationShape(e,e.shape,i):this.getBpmnTextAnnotationSymbol(e,e.shape,i):t},u.prototype.getBpmnTextAnnotationShape=function(t,e,i){var n=new F,r=(n.measureChildren=!1,n.offsetX=t.offsetX,n.offsetY=t.offsetY,n.float=!0,n.id=t.id+"_textannotation",n.style.strokeColor="transparent",n.style.fill="transparent",n.relativeMode="Object",n.rotateAngle=0,t.width),o=t.height,a=new k(0,0,0,0),r=(0!==r&&0!==o&&(a=new k(t.offsetX-r/2,t.offsetY-o/2,r,o)),i.isProtectedOnChange);return i.isProtectedOnChange=!1,this.setAnnotationPath(a,n,t,e,e.textAnnotation.textAnnotationDirection,i),i.isProtectedOnChange=r,n},u.prototype.getBpmnTextAnnotationSymbol=function(t,e,i){var n="M33.33,15 L0,43 M39.33,0 L33.33,0 L33.33,30 L39.33,30 M60,0",e=("Top"===e.textAnnotation.textAnnotationDirection?n="M15,33.33 L43,0 M0,39.33 L0,33.33 L30,33.33 L30,39.33 M0,60":"Right"===e.textAnnotation.textAnnotationDirection?n="M6,15 L39.33,43 M0,0 L6,0 L6,30 L0,30 M-20,0":"Bottom"===e.textAnnotation.textAnnotationDirection&&(n="M15,6 L43,39.33 M0,0 L0,6 L30,6 L30,0 M0,-20"),new P);return e.data=n,e.style.fill="white"===t.style.fill?"transparent":t.style.fill,e.style.strokeDashArray=t.style.strokeDashArray||"",e.style.strokeWidth=t.style.strokeWidth,e.style.strokeColor="transparent"===t.style.strokeColor?"black":t.style.strokeColor,e.style.opacity=t.style.opacity,e},u.prototype.getBPMNShapes=function(t){var e=new P,i=(this.setStyle(e,t),0!=(t.constraints&Z.NodeConstraints.Shadow)&&t.visible&&(e.shadow=t.shadow),cu(t.shape.shape));return e.data=i,e.id=t.id+"_"+t.shape.shape,void 0!==t.width&&void 0!==t.height&&(e.width=t.width,e.height=t.height),e},u.prototype.getBPMNGroup=function(t,e){var i=new F,n=(this.setStyle(i,t),i.id=t.id+"_group",i.children||(i.children=[]),t.shape.group);if(t.shape.group)for(var r=0;r<n.children.length;r++){var o=e.nameTable[n.children[parseInt(r.toString(),10)]];i.children.push(o.wrapper)}return i.width=t.width,i.height=t.height,i},u.prototype.getBPMNGatewayShape=function(t){var e=new F,i=new P,n=(i.id=t.id+"_0_gateway",i.offsetX=t.offsetX,i.offsetY=t.offsetY,i.data="M 40 20 L 20 40 L 0 20 L 20 0 L 40 20 Z",this.setStyle(i,t),new P),r=(n.id=t.id+"_1_gatewayType",n.style.opacity=t.style.opacity,n.style.strokeColor=t.style.strokeColor,n.horizontalAlignment="Center",n.verticalAlignment="Center",n.relativeMode="Object",t.shape.gateway),o=gu(r.type),r=("EventBased"===r.type||"ExclusiveEventBased"===r.type||"ParallelEventBased"===r.type?n.style.fill="white":n.style.fill="black",n.data=o,e.style.fill="transparent",e.style.strokeColor="transparent",e.style.strokeWidth=0,e.children=[i,n],this.getSize(t,i));return this.setSizeForBPMNGateway(t.shape.gateway,e,r.width,r.height),e},u.prototype.getBPMNDataObjectShape=function(t){var e=new F,i=t.shape.dataObject,n=new P,r=(n.id=t.id+"_0_dataobj",n.data="M29.904,5 L7.853,5 L7.853,45 L42.147,45 L42.147,17.242,L29.932,5,L29.932,17.242,L42.147,17.242",this.getSize(t,n)),o=(n.width=r.width,n.height=r.height,this.setStyle(n,t),new P),r=(o.id=t.id+"_1_type",o.width=25,o.height=20,o.margin.left=5,o.margin.top=5,o.data="M 3 9.4 l 6 0 v 2.4 l 3.6 -4 L 9 4 v 2.5 H 3 V 9.4 Z",o.style.opacity=t.style.opacity,new P);switch(r.id=t.id+"_2_collection",r.width=7.5,r.height=15,r.style.fill="black",r.visible=!0,r.horizontalAlignment="Center",r.verticalAlignment="Bottom",r.relativeMode="Object",r.style.opacity=t.style.opacity,r.data="M 0 0 L 0.1 0 L 0.1 2 L 0 2 Z M 0.4 0 L 0.6 0 L 0.6 2 L0.4 2 Z M 0.9 0 L 1 0 L 1 2 L 0.9 2 Z",i.type){case"None":o.visible=!1;break;case"Input":o.style.fill="white";break;case"Output":o.style.fill="black"}return!1===i.collection&&(r.visible=!1),e.style.fill="transparent",e.style.strokeColor="transparent",e.style.strokeWidth=0,e.children=[n,o,r],e},u.prototype.getBPMNTaskShape=function(t){var e=t.shape.activity.task,i=new F,n=new qt,r=(n.cornerRadius=10,this.getSize(t,n)),o=(n.id=t.id+"_0_task",n.width=r.width,n.height=r.height,this.setStyle(n,t),void 0!==e.call&&!0===e.call&&(n.style.strokeWidth=4),i.width=r.width,i.height=r.height,this.getTaskChildCount(t)),r=r.width/2-12*o,a=1===o?8+r:r+8*(o-1),s=new P,h=("Receive"===e.type||"Send"===e.type?(s.width=18,s.height=16):"Manual"===e.type?(s.width=16,s.height=11):(s.width=20,s.height=20),s.id=t.id+"_1_tasktType",s.margin.left=5,s.margin.top=5,e.type=e.type||"None",uu(e.type)),h=(s.data=h,s.style.fill="transparent",s.style.opacity=t.style.opacity,"Send"===e.type&&(s.style.fill="black"),i.style.fill="transparent",i.style.strokeColor="transparent",i.style.strokeWidth=0,i.children=[n,s],"Service"===e.type&&((n=new P).id=t.id+"_1_taskTypeService",n.data=h,n.margin.left=s.margin.left+9,n.margin.top=s.margin.top+9,n.style.fill="white",n.style.opacity=t.style.opacity,i.children.push(n)),e.loop),n=new P,d=mu(h),d=(n.data=d,n.style.fill="black",n.visible="None"!==h,n.margin.left=(a=1===o?9+r:a)-3,!0===n.visible&&(a+=20),n.width=12,n.height=12,n.margin.bottom=5,n.id=t.id+"_2_loop",n.horizontalAlignment="Left",n.verticalAlignment="Bottom",n.setOffsetWithRespectToBounds(0,1,"Fraction"),n.relativeMode="Point",n.style.fill="transparent",s.style.opacity=t.style.opacity,i.children.push(n),new P),d=this.getBPMNCompensationShape(t,d);return!0===e.compensation?d.visible=!0:d.visible=!1,d.margin.left=(a=1===o?9+r:a)-3,a+=18,i.children.push(d),i},u.prototype.getBPMNEventShape=function(t,e,i,n){var r,o,a,s,h=new F,d=(n=n||t.id,"M164.1884,84.6909000000001C156.2414,84.6909000000001,149.7764,78.2259000000001,149.7764,70.2769000000001C149.7764,62.3279000000001,156.2414,55.8629000000001,164.1884,55.8629000000001C172.1354,55.8629000000001,178.6024,62.3279000000001,178.6024,70.2769000000001C178.6024,78.2259000000001,172.1354,84.6909000000001,164.1884,84.6909000000001"),l=t.shape.event,i=(N.isBlazor()||"Event"!==t.shape.shape||(a=l.event,s=l.trigger),r=e.width,o=e.height,i?(r=r||20,o=o||20):void 0!==e.width&&void 0!==e.height||((i=new P).data=d,r=(i=this.getSize(t,i)).width,o=i.height),t.shape.activity),c=(N.isBlazor()||"Activity"!==t.shape.shape||(i.subProcess,a=e.event,s=e.trigger),new P),p=(c.data=d,c.id=n+"_0_event",c.width=r,c.height=o,c.horizontalAlignment="Center",c.verticalAlignment="Center",c.relativeMode="Object",this.setStyle(c,t),new P),g=(p.data=d,p.id=n+"_1_event",p.style.gradient=t.style.gradient,p.horizontalAlignment="Center",p.verticalAlignment="Center",p.relativeMode="Object",p.style.strokeColor=t.style.strokeColor,p.style.opacity=t.style.opacity,new P),i=pu(s);switch(g.data=i,g.id=n+"_2_trigger",g.horizontalAlignment="Center",g.verticalAlignment="Center",g.relativeMode="Object",g.style.strokeColor=t.style.strokeColor,g.style.opacity=t.style.opacity,a){case"Start":p.visible=!1;break;case"NonInterruptingStart":c.style.strokeDashArray="2 3",p.visible=!1;break;case"Intermediate":c.style.fill=t.style.fill,c.style.gradient=null;break;case"NonInterruptingIntermediate":c.style.fill=t.style.fill,c.style.gradient=null,c.style.strokeDashArray="2 3",p.style.strokeDashArray="2 3";break;case"ThrowingIntermediate":case"End":c.style.fill="End"!==a||"white"!==t.style.fill?t.style.fill:"black",c.style.gradient=null,g.style.fill="black",g.style.strokeColor="white"}return h.style.fill="transparent",h.style.strokeColor="transparent",h.style.strokeWidth=0,h.children=[c,p,g],this.setSizeForBPMNEvents(l,h,r,o),h},u.prototype.setEventVisibility=function(t,e){var t=t.shape.event.event,i=e[0],n=e[1];e[2];switch(t){case"Start":n.visible=!1;break;case"NonInterruptingStart":i.style.strokeDashArray="2 3",n.visible=!1}},u.prototype.setSubProcessVisibility=function(t){var e=t.shape.activity.subProcess,i=e.events.length,n="Transaction"===t.shape.activity.subProcess.type?2:0,r=t.wrapper.children[0].children[0];if(!1===e.adhoc&&(r.children[3+n+i].visible=!1),!1===e.compensation&&(r.children[4+n+i].visible=!1),0<i)for(var o=0;o<i;o++)this.setEventVisibility(t,r.children[2+o].children)},u.prototype.getBPMNSubProcessShape=function(t){var e,i=new F,n=new P,r=(new F,new P),o=t.shape.activity,a=o.subProcess,s=this.getSubprocessChildCount(t),h=new qt,d=(h.id=t.id+"_0_Subprocess",h.style.fill="transparent",h.cornerRadius=10,this.getSize(t,h)),o=(h.width=d.width,h.height=d.height,i.children=[h],"Transaction"===o.subProcess.type&&this.getBPMNSubProcessTransaction(t,t.shape,i),d.width/2),d=1===s?o-6:o-12*s/2-4*(s-1)/2,l=(this.setStyle(h,t),0!=(t.constraints&Z.NodeConstraints.Shadow)&&t.visible&&(i.shadow=t.shadow),new P);if(l.id=t.id+"_0_collapsed",l.width=12,l.height=12,l.style.fill="black",l.style.strokeColor=t.style.strokeColor,l.margin.bottom=5,l.style.opacity=t.style.opacity,l.horizontalAlignment="Left",l.verticalAlignment="Bottom",l.setOffsetWithRespectToBounds(0,1,"Fraction"),l.relativeMode="Point",l.data=cu("collapsedShape"),l.margin.left=d,!0!==a.collapsed||a.processes?l.visible=!1:l.visible=!0,!0===l.visible&&(d+=16),i.children.push(l),"Event"===a.type){h.style.strokeWidth=1,h.style.strokeDashArray="2 2";for(var c=a.events,p=0;p<c.length;p++)e=c[parseInt(p.toString(),10)],this.getBPMNSubEvent(e,t,i)}(r=this.getBPMNSubProcessLoopShape(t)).margin.left=d=1===s?o-6:d,!0===r.visible&&(d+=16),r.style.opacity=t.style.opacity,i.children.push(r),h.id=t.id+"_boundary","Default"===a.boundary&&(h.style.strokeWidth=1,h.style.strokeDashArray="1 0"),"Call"===a.boundary&&(h.style.strokeWidth=4,h.style.strokeDashArray="1 0"),"Event"===a.boundary&&(h.style.strokeWidth=1,h.style.strokeDashArray="2 2"),(n=this.getBPMNAdhocShape(t,n,a)).margin.left=d=1===s?o-6:d,!0===n.visible&&(d+=16),n.style.opacity=t.style.opacity,i.children.push(n);l=new P;return!0===a.compensation?l.visible=!0:l.visible=!1,(l=this.getBPMNCompensationShape(t,l)).margin.left=d=1===s?o-6:d,!0===l.visible&&(d+=16),l.style.opacity=t.style.opacity,i.children.push(l),i.style.strokeColor="transparent",i.style.strokeWidth=0,i.style.fill="transparent",i},u.prototype.getBPMNSubEvent=function(t,e,i,n){i.children=i.children||[];var r=this.getBPMNEventShape(e,t,!0,n);this.getBPMNSubprocessEvent(e,r,t),r.id=n||e.id+"_subprocessEvents",r.width=t.width||20,r.height=t.height||20,r.setOffsetWithRespectToBounds(t.offset.x,t.offset.y,"Fraction"),r.relativeMode="Point",r.margin=t.margin,r.horizontalAlignment=t.horizontalAlignment,r.verticalAlignment=t.verticalAlignment,r.style.fill="transparent",r.style.strokeColor="transparent",r.style.strokeWidth=0,i.children.push(r)},u.prototype.getBPMNSubProcessTransaction=function(t,e,i){var n=i.children[0].width,r=i.children[0].height,o=new qt,o=(o.margin={left:3,right:0,top:3,bottom:0},o.id=t.id+"_0_Subprocess_innnerRect",o.cornerRadius=10,o.width=n-6,o.style.fill="transparent",o.height=r-6,i.children.push(o),new F),e=(o.id=t.id+"_transaction_events",o.style.gradient=t.style.gradient,e.activity.subProcess.transaction);this.getBPMNSubEvent(e.success,t,o,t.id+"_success"),this.getBPMNSubEvent(e.cancel,t,o,t.id+"_cancel"),this.getBPMNSubEvent(e.failure,t,o,t.id+"_failure"),this.updateDiagramContainerVisibility(o.children[0],e.success.visible),this.updateDiagramContainerVisibility(o.children[1],e.cancel.visible),this.updateDiagramContainerVisibility(o.children[2],e.failure.visible),o.float=!0,o.width=n,o.height=r,o.style.fill=o.style.strokeColor="transparent",i.children.push(o)},u.prototype.getBPMNSubProcessLoopShape=function(t){var e=t.shape.activity,i=new P,e=e.subProcess.loop,n=mu(e);return i.visible="None"!==e,i.id=t.id+"_loop",i.data=n,i.style.fill="black",i.width=12,i.height=12,i.horizontalAlignment="Left",i.verticalAlignment="Bottom",i.setOffsetWithRespectToBounds(0,1,"Fraction"),i.relativeMode="Point",i.margin.bottom=5,i.style.fill="transparent",i.style.strokeColor=t.style.strokeColor,i},u.prototype.drag=function(t,e,i,n){var r=n.nameTable[t.processId],i=(0<=t.margin.top+i&&n.nodePropertyChange(t,{},{margin:{top:t.margin.top+i}}),0<=t.margin.left+e&&n.nodePropertyChange(t,{},{margin:{left:t.margin.left+e}}),this.getChildrenBound(r,t.id,n));this.updateSubProcessess(i,t,n),r.wrapper.measure(new j(void 0,void 0)),r.wrapper.arrange(r.wrapper.desiredSize),n.refreshCanvasLayers(),n.updateSelector(),n.updateDiagramObject(r),n.updateConnectorEdges(t),this.updateDocks(t,n)},u.prototype.dropBPMNchild=function(t,e,i){var n,r,o;e&&"Bpmn"===e.shape.type&&"Bpmn"===t.shape.type&&!N.isBlazor()&&"TextAnnotation"!==e.shape.shape&&(n=i.nameTable[t.id].shape.activity.subProcess,i.currentSymbol&&"Bpmn"===t.shape.type&&!n.collapsed?e.processId=t.id:(n.processes=n.processes||[],n.processes&&-1===n.processes.indexOf(e.id)&&!n.collapsed&&(n.processes.push(e.id),1<n.processes.length&&this.sortProcessOrder(n.processes,i),n=Q(e),o=i.nameTable[e.id].wrapper,r=i.nameTable[t.id].wrapper,o.margin.top=o.offsetY-o.actualSize.height/2-(t.offsetY-t.actualSize.height/2),o.margin.left=o.offsetX-o.actualSize.width/2-(t.offsetX-t.actualSize.width/2),o.margin.top=o.margin.top<0?0:o.margin.top,o.margin.left=o.margin.left<0?0:o.margin.left,i.nameTable[e.id].processId=t.id,r.children.push(i.nameTable[e.id].wrapper),o=this.getChildrenBound(t,e.id,i),this.updateSubProcessess(o,e,i),r.measure(new j(void 0,void 0)),r.arrange(r.desiredSize),i.refreshCanvasLayers(),i.updateSelector(),o=Q(e),i.addHistoryEntry({type:"PositionChanged",undoObject:{nodes:[n]},redoObject:{nodes:[o]},category:"Internal"}),"SVG"===i.mode&&(e.zIndex<t.zIndex&&(i.updateProcesses(e),this.updateSubprocessNodeIndex(e,i,t)),Y(t.id+"_groupElement").appendChild(Y(e.id+"_groupElement"))),this.updateDocks(e,i))))},u.prototype.sortProcessOrder=function(t,i){t.sort(function(t,e){return i.nameTable[""+t].zIndex-i.nameTable[""+e].zIndex})},u.prototype.updateIndex=function(t,e){var i=t.getIndex(e,e.id);t.nodes.splice(Number(i),1),e.zIndex=t.nodes[t.nodes.length-1].zIndex+1,t.nodes.push(e)},u.prototype.updateSubprocessNodeIndex=function(t,e,i){if(t.shape.activity.subProcess.processes&&0<t.shape.activity.subProcess.processes.length)for(var n=0;n<t.shape.activity.subProcess.processes.length;n++){this.updateIndex(e,t);var r=t.shape.activity.subProcess.processes[parseInt(n.toString(),10)];0<e.nameTable[""+r].shape.activity.subProcess.processes.length?this.updateSubprocessNodeIndex(e.nameTable[""+r],e,i):(r=e.nameTable[t.shape.activity.subProcess.processes[parseInt(n.toString(),10)]],this.updateIndex(e,r))}else this.updateIndex(e,t)},u.prototype.updateDocks=function(t,e){if("Bpmn"===t.shape.type&&t.shape.activity.subProcess.processes&&!t.shape.activity.subProcess.collapsed)for(var i=0,n=t.shape.activity.subProcess.processes;i<n.length;i++){var r=n[i],r=e.nameTable[""+r];r&&(e.updateConnectorEdges(r),r.wrapper.measure(new j(r.wrapper.width,r.wrapper.height)),r.wrapper.arrange(r.wrapper.desiredSize),r.shape.activity.subProcess.processes)&&r.shape.activity.subProcess.processes.length&&this.updateDocks(r,e)}},u.prototype.removeBpmnProcesses=function(t,e){var i=e.nameTable[t.processId];if("Bpmn"===t.shape.type&&t.shape.activity.subProcess.processes&&0<t.shape.activity.subProcess.processes.length)for(var n,r=(n=t.shape.activity.subProcess.processes).length-1;0<=r;r--)e.remove(e.nameTable[n[parseInt(r.toString(),10)]]);i&&(e.removeDependentConnector(t),n=i.shape.activity.subProcess.processes,this.removeChildFromBPMN(i.wrapper,t.id,e,!0),i=n.indexOf(t.id),n.splice(i,1))},u.prototype.removeChildFromBPMN=function(t,e,i,n){for(var r=0,o=t.children;r<o.length;r++){var a=o[r];a.id===e?(t.children.splice(t.children.indexOf(a),1),n||this.removeGElement(a.id,i)):a.children&&this.removeChildFromBPMN(a,e,i,n)}},u.prototype.removeGElement=function(t,e){var i,n=document.getElementById(t+"_groupElement"),r=document.getElementById(e.element.id+"_diagramLayer"),t=(n.parentElement.removeChild(n),r.appendChild(n),e.nameTable[""+t]),o=e.nameTable[""+t.processId],a=t.zIndex+1,a=this.getNode(a,e);0<a.length&&(i=document.getElementById(a[0].id+"_groupElement"),a=-1!==(e=Array.from(r.children).findIndex(function(t){return t===i}))?e:1,t.zIndex<o.zIndex)&&r.children[parseInt(a.toString(),10)].insertAdjacentElement("beforebegin",n)},u.prototype.getNode=function(e,t){var i=t.nodes.filter(function(t){return t.zIndex===e});return 0===i.length&&0<e?this.getNode(e-1,t):i},u.prototype.removeProcess=function(t,e){var i,n,r=e.nameTable[""+t];r&&(n=e.nameTable[r.processId])&&"Bpmn"===n.shape.type&&(i=n.shape.activity.subProcess.processes,e.removeDependentConnector(r),this.removeChildFromBPMN(n.wrapper,t,e,!0),n=i.indexOf(t),i.splice(n,1),r.processId="",e.refreshDiagramLayer(),e.updateSelector())},u.prototype.addProcess=function(t,e,i){t.id=t.id||q();var n=t.id,r=i.nameTable[""+n],o=Q(r),a=(r||i.add(t),t.processId=e,i.nameTable[""+e]),s=a.shape.activity.subProcess;s.processes||(s.processes=[]),r&&a&&"Bpmn"===a.shape.type&&"Bpmn"===r.shape.type&&(r.processId=e,(s=a.shape.activity.subProcess.processes).indexOf(n)<0&&s.push(n),a.wrapper.children.push(r.wrapper),a.wrapper.measure(new j),a.wrapper.arrange(a.wrapper.desiredSize),i.bpmnModule.updateDocks(a,i),i.refreshDiagramLayer(),i.diagramActions&Z.DiagramAction.UndoRedo||i.historyManager.currentEntry&&"CollectionChanged"===i.historyManager.currentEntry.type||(s=Q(r),i.addHistoryEntry({type:"PositionChanged",undoObject:{nodes:[o]},redoObject:{nodes:[s]},category:"Internal"})),"SVG"===i.mode)&&r.shape&&r.shape.activity&&!r.shape.activity.subProcess.processes&&Y(e+"_groupElement").appendChild(Y(t.id+"_groupElement"))},u.prototype.getChildrenBound=function(t,e,i){var n,t=t.shape.activity.subProcess.processes;if(t&&t.length)for(var r=0,o=t;r<o.length;r++){var a=o[r];e!==a&&(n=n?i.nameTable[""+a].wrapper.bounds.uniteRect(n):i.nameTable[""+a].wrapper.bounds)}return n||i.nameTable[""+e].wrapper.bounds},u.prototype.updateSubProcessess=function(t,e,i){var n,r,o,a,s=i.nameTable[e.processId],h={x:.5,y:.5},s=(s.wrapper.bounds.left+e.margin.left+e.width>s.wrapper.bounds.right&&(o=!0),s.wrapper.bounds.top+e.margin.top+e.height>s.wrapper.bounds.bottom&&(a=!0),o&&(h.x=0),a&&(h.y=0),s.wrapper.actualSize);o&&(n=(e.wrapper.margin.left+e.wrapper.bounds.width)/s.width),a&&(r=(e.wrapper.margin.top+e.wrapper.bounds.height)/s.height),(0<n||0<r)&&i.commandHandler.scale(i.nameTable[e.processId],n||1,r||1,h)},u.prototype.getBPMNCompensationShape=function(t,e){return e.id=t.id+"_0_compensation",e.width=12,e.height=12,e.margin.bottom=5,e.style.fill="transparent",e.style.strokeColor=t.style.strokeColor,e.horizontalAlignment="Left",e.verticalAlignment="Bottom",e.relativeMode="Object",e.data="M 22.462 18.754 l -6.79 3.92 l 6.79 3.92 V 22.89 l 6.415 3.705 v -7.841 l -6.415 3.705 V 18.754 Z M 28.331 19.701 v 5.947 l -5.149 -2.973 L 28.331 19.701 Z M 21.916 25.647 l -5.15 -2.973 l 5.15 -2.973 V 25.647 Z M 22.275 12.674 c -5.513 0 -9.999 4.486 -9.999 9.999 c 0 5.514 4.486 10.001 9.999 10.001 c 5.514 0 9.999 -4.486 9.999 -10.001 C 32.274 17.16 27.789 12.674 22.275 12.674 Z M 22.275 32.127  c -5.212 0 -9.453 -4.241 -9.453 -9.454 c 0 -5.212 4.241 -9.453 9.453 -9.453 c 5.212 0 9.453 4.241 9.453 9.453 C 31.728 27.887 27.487 32.127 22.275 32.127 Z",e},u.prototype.getBPMNActivityShape=function(t){var e,i=new F,n=t.shape.activity,r=n.activity,o=n.subProcess;n.activity;return"Task"===r&&(e=this.getBPMNTaskShape(t)),(e="SubProcess"===r&&o?this.getBPMNSubProcessShape(t):e).id=r+t.id,i.children=[e],i.style.fill="transparent",i.style.strokeColor="transparent",i.style.strokeWidth=0,i},u.prototype.getBPMNSubprocessEvent=function(t,e,i){if(0!==i.annotations.length)for(var n=0;n<i.annotations.length;n++){var r=i.annotations[parseInt(n.toString(),10)];(r=t.initAnnotationWrapper(r)).width=i.width,r.height=i.height,e.children.push(r)}if(0!==i.ports.length)for(n=0;n<i.ports.length;n++){var o=i.ports[parseInt(n.toString(),10)],o=t.initPortWrapper(o);e.children.push(o)}},u.prototype.getBPMNAdhocShape=function(t,e,i){return e.id=t.id+"_0_adhoc",e.width=12,e.height=8,e.style.fill="black",e.style.strokeColor=t.style.strokeColor,e.margin.bottom=5,e.horizontalAlignment="Left",e.verticalAlignment="Bottom",e.relativeMode="Object",e.data="M 49.832 76.811 v -2.906 c 0 0 0.466 -1.469 1.931 -1.5 c 1.465 -0.031 2.331 1.219 2.897 1.688 s 1.06 0.75 1.526 0.75 c 0.466 0 1.548 -0.521 1.682 -1.208 s 0.083 3.083 0.083 3.083 s -0.76 0.969 -1.859 0.969 c -1.066 0 -1.865 -0.625 -2.464 -1.438 s -1.359 -0.998 -2.064 -0.906 C 50.598 75.467 49.832 76.811 49.832 76.811 Z",i&&!0===i.adhoc?e.visible=!0:e.visible=!1,e},u.prototype.setAnnotationPath=function(t,e,i,n,r,o){var a,s,h,d,l=new P,c=(l.id=e.id+"_path",l.width=i.width,l.height=i.height,l.style.fill="transparent",l.style.strokeColor="transparent"===i.style.strokeColor?"black":i.style.strokeColor,l.style.opacity=i.style.opacity,l.relativeMode="Object",l.horizontalAlignment="Stretch",l.verticalAlignment="Stretch",0<i.ports.length?i.ports[0]:new Be(i,"ports","",!0));switch(o.protectPropertyChange(!0),i.ports=[c],o.protectPropertyChange(!1),r){case"Left":l.data="M10,20 L0,20 L0,0 L10,0",l.width=10,l.horizontalAlignment="Left",c.offset={x:0,y:.5};break;case"Right":l.data="M0,0 L10,0 L10,20 L0,20",l.width=10,l.horizontalAlignment="Right",c.offset={x:1,y:.5};break;case"Top":l.data="M20,10 L20,0 L0,0 L0,10",l.height=10,l.verticalAlignment="Top",c.offset={x:.5,y:0};break;case"Bottom":l.data="M0,0 L0,10 L20,10 L20,0",l.height=10,l.verticalAlignment="Bottom",c.offset={x:.5,y:1};break;default:""!==n.textAnnotation.textAnnotationTarget?o.nameTable[n.textAnnotation.textAnnotationTarget]&&((a=o.nameTable[n.textAnnotation.textAnnotationTarget]).hasTextAnnotation=!0,null!==a.wrapper)&&(s=a.width,h=a.height,d=new k(0,0,0,0),0!==s&&0!==h&&(d=new k(a.offsetX-s/2,a.offsetY-h/2,s,h)),this.setAnnotationPosition(d,i,t,l)):""===n.textAnnotation.textAnnotationTarget&&(l.data="M10,20 L0,20 L0,0 L10,0",l.width=10,l.horizontalAlignment="Left",c.offset={x:0,y:.5})}e.children=[],e.children.push(l)},u.prototype.setAnnotationPosition=function(t,e,i,n){e=e.ports[0],i={x:i.x,y:i.y},i=this.getAnnotationPathAngle(i,t);90===i?(n.data="M20,10 L20,0 L0,0 L0,10",n.height=10,n.verticalAlignment="Top",e.offset={x:.5,y:0}):180===i?(n.data="M0,0 L10,0 L10,20 L0,20",n.width=10,n.horizontalAlignment="Right",e.offset={x:1,y:.5}):0===i?(n.data="M10,20 L0,20 L0,0 L10,0",n.width=10,n.horizontalAlignment="Left",e.offset={x:0,y:.5}):(n.data="M0,0 L0,10 L20,10 L20,0",n.height=10,n.verticalAlignment="Bottom",e.offset={x:.5,y:1})},u.prototype.getSubprocessChildCount=function(t){var e=0,t=t.shape.activity.subProcess,i=t.loop;return void 0!==i&&"None"!==i&&e++,void 0!==t.compensation&&!0===t.compensation&&e++,void 0!==t.collapsed&&!0===t.collapsed&&e++,void 0!==t.adhoc&&!0===t.adhoc&&e++,e},u.prototype.getTaskChildCount=function(t){var e=0,t=t.shape.activity.task;return void 0!==t.compensation&&!0===t.compensation&&e++,void 0!==t.loop&&"None"!==t.loop&&e++,e},u.prototype.setStyle=function(t,e){t.style.fill=e.style.fill,t.style.strokeColor=e.style.strokeColor,t.style.strokeWidth=e.style.strokeWidth,t.style.strokeDashArray=e.style.strokeDashArray,t.style.opacity=e.style.opacity,t.style.gradient=e.style.gradient,0!=(e.constraints&Z.NodeConstraints.Shadow)&&e.visible&&(t.shadow=e.shadow)},u.prototype.updateBPMN=function(t,e,i,n){var r,o,a=t.shape||{},s=i.wrapper.children[0],h=i.shape.shape||i.shape.bpmnShape,d=(a.textAnnotation&&"TextAnnotation"===h&&(void 0!==a.textAnnotation.textAnnotationDirection&&(this.setAnnotationPath(i.wrapper.bounds,i.wrapper.children[0],i,i.shape,i.shape.textAnnotation.textAnnotationDirection,n),i.wrapper.children[0].children[0].id=i.id+"_textannotation_path",d={ports:{0:{offset:i.ports[0].offset}}},n.nodePropertyChange(i,{},d)),void 0!==a.textAnnotation.textAnnotationTarget)&&((d=n.nameTable[a.textAnnotation.textAnnotationTarget])&&"Bpmn"===d.shape.type?(o=n.nameTable[i.inEdges[0]])&&(o.sourceID=d.id,n.connectorPropertyChange(o,{},{sourceID:d.id})):""===a.textAnnotation.textAnnotationTarget&&(o=n.nameTable[i.inEdges[0]])&&(r=(d=n.nameTable[e.shape.textAnnotation.textAnnotationTarget]).outEdges.indexOf(o.id),d.outEdges.splice(r,1),o.sourceID="",n.connectorPropertyChange(o,{},{sourceID:""}))),void 0!==t.width||void 0!==t.height);"Gateway"===a.shape&&a.gateway?(this.removeBPMNElementFromDOM(i,n),i.wrapper.children[0]=this.getBPMNGatewayShape(i)):"DataObject"===a.shape&&a.dataObject?(this.removeBPMNElementFromDOM(i,n),i.wrapper.children[0]=this.getBPMNDataObjectShape(i)):"Activity"===a.shape&&a.activity?(this.removeBPMNElementFromDOM(i,n),i.wrapper.children[0]=this.getBPMNActivityShape(i)):"Event"!==i.shape.bpmnShape&&"Event"!==i.shape.shape&&"Event"!==a.shape||!a.event?"Message"===a.shape||"DataSource"===a.shape?(this.removeBPMNElementFromDOM(i,n),i.wrapper.children[0]=this.getBPMNShapes(i)):void 0!==a.gateway||"Gateway"===h&&d?this.updateBPMNGateway(i,t):void 0!==a.dataObject||"DataObject"===h&&d?this.updateBPMNDataObject(i,t,e):void 0!==a.activity||"Activity"===h&&d?this.updateBPMNActivity(i,t,e,n):(void 0!==a.event||"Event"===h&&d)&&this.updateBPMNEvent(i,t,e):(this.removeBPMNElementFromDOM(i,n),r=a.event,i.wrapper.children[0]=this.getBPMNEventShape(i,r)),i.wrapper.children[0].id=i.wrapper.children[0].id||s.id,t.style&&((o=s)instanceof te&&(o=N.isBlazor()||"Activity"!==i.shape.shape?N.isBlazor()||"Group"!==i.shape.shape?s.children[0]:s:s.children[0].children[0]),zh(t.style,o),t.style&&t.style.strokeColor&&s&&void 0!==s.children&&0<s.children.length&&(N.isBlazor()||"Activity"!==i.shape.shape||"SubProcess"!==i.shape.activity.activity?(!N.isBlazor()&&"Gateway"===i.shape.shape||!N.isBlazor()&&"Event"===i.shape.shape)&&this.updateBPMNStyle(s,t.style.strokeColor):(h=s.children[0],this.updateBPMNStyle(h,t.style.strokeColor))),t.style)&&void 0!==t.style.opacity&&this.updateBpmnChildOpacity(i.wrapper,t.style.opacity)},u.prototype.updateBpmnChildOpacity=function(t,e){if(t.children&&0<t.children.length)for(var i=0;i<t.children.length;i++){var n=t.children[parseInt(i.toString(),10)];n.children&&this.updateBpmnChildOpacity(n,e),n instanceof H||(n.style.opacity=e)}},u.prototype.removeBPMNElementFromDOM=function(t,e){for(var i=0,n=e.views;i<n.length;i++){var r=n[i];rp(t.id+"_groupElement",r)}},u.prototype.updateBPMNStyle=function(t,e){for(var i=0;i<t.children.length;i++)zh({strokeColor:e},t.children[parseInt(i.toString(),10)])},u.prototype.updateBPMNGateway=function(t,e){var i,n=t.shape,r=t.wrapper.children[0];n&&(zh(t.style,r.children[0]),i=gu(n.gateway.type),i=this.updateGatewaySubType(r,t,i),n=n.gateway.type,i.style.fill="None"===n||"EventBased"===n||"ExclusiveEventBased"===n||"ParallelEventBased"===n?"white":"black",rp(r.children[1].id),r.children.splice(1,1),r.children.push(i)),void 0===e.width&&void 0===e.height||this.setSizeForBPMNGateway(t.shape.gateway,r,e.width||t.width,e.height||t.height)},u.prototype.updateGatewaySubType=function(t,e,i){var n=new P;return n.id=e.id+"_1_gatewayType",n.width=t.children[1].width,n.height=t.children[1].height,n.margin.left=t.children[1].margin.left,n.margin.top=t.children[1].margin.top,n.data=i,n.offsetX=t.children[1].offsetX,n.offsetY=t.children[1].offsetY,n.style=t.children[1].style,n.horizontalAlignment=t.children[1].horizontalAlignment,n.verticalAlignment=t.children[1].verticalAlignment,n.relativeMode=t.children[1].relativeMode,n.transform=t.children[1].transform,n},u.prototype.updateBPMNDataObject=function(t,e,i){var n=e.shape,r=t.wrapper.children[0];if(n){var o=r.children[1],a=r.children[2];if(void 0!==e.style&&(zh(e.style,r.children[0]),o.style.opacity=t.style.opacity,a.style.opacity=t.style.opacity),n.dataObject){switch(n.dataObject.type){case"None":o.visible=!1;break;case"Input":o.style.fill="white";break;case"Output":o.style.fill="black"}"None"===i.shape.dataObject.type&&(o.visible=!0),void 0!==e.shape.dataObject.collection&&(a.visible=n.dataObject.collection)}}void 0===e.width&&void 0===e.height||this.setSizeForBPMNDataObjects(t.shape.dataObject,r,e.width||t.width,e.height||t.height)},u.prototype.getEvent=function(t,e,i,n,r,o){switch(i){case"Start":r.visible=!1,n.style.strokeDashArray="",o.style.fill="white",o.style.strokeColor="black",n.style.fill="white";break;case"NonInterruptingStart":n.style.strokeDashArray="2 3",o.style.fill="white",n.style.fill="white",o.style.strokeColor="black",r.visible=!1;break;case"Intermediate":n.style.strokeDashArray="",n.style.fill="white",r.style.strokeDashArray="",n.style.gradient=null,o.style.fill="white",o.style.strokeColor="black",this.updateEventVisibility(e,r);break;case"NonInterruptingIntermediate":n.style.fill="white",n.style.gradient=null,o.style.fill="white",o.style.strokeColor="black",n.style.strokeDashArray="2 3",r.style.strokeDashArray="2 3",this.updateEventVisibility(e,r);break;case"ThrowingIntermediate":case"End":n.style.fill="End"!==i?"white":"black",n.style.strokeDashArray="",r.style.strokeDashArray="",n.style.gradient=null,o.style.fill="black",this.updateEventVisibility(e,r)}},u.prototype.updateEventVisibility=function(t,e){var i,n;t.shape.activity&&t.shape.activity.subProcess&&t.shape.activity.subProcess.events&&void 0!==t.shape.activity.subProcess.events[0]&&void 0!==t.shape.activity.subProcess.events[0].event?"NonInterruptingStart"!==t.shape.activity.subProcess.events[0].event&&"Start"!==t.shape.activity.subProcess.events[0].event||(e.visible=!0):t.shape.activity&&t.shape.activity.subProcess&&t.shape.activity.subProcess.transaction?(i=t.shape.activity.subProcess.transaction,n=["success","failure","cancel"].some(function(t){var t=i[""+t];return!!t&&("Start"===(t=t.event)||"NonInterruptingStart"===t)}),e.visible=n||e.visible):void 0===t.shape.event||"NonInterruptingStart"!==t.shape.event.event&&"Start"!==t.shape.event.event||(e.visible=!0)},u.prototype.updateBPMNEvent=function(t,e,i){e.shape;var n=t.wrapper.children[0];void 0===e.width&&void 0===e.height||this.setSizeForBPMNEvents(t.shape.event,n,e.width||t.width,e.height||t.height)},u.prototype.updateBPMNActivity=function(t,e,i,n){var r,o,a,s,h,d=e.shape,l=t.wrapper.children[0];l&&l.children&&0<l.children.length&&l.children[0]&&(r=this.getSize(t,l.children[0].children[0]),d&&(a=i.shape.activity.activity,o=t.shape.activity.activity,"SubProcess"!==a&&"Task"!==a||"SubProcess"!==o&&"Task"!==o?("Task"===o&&void 0!==d.activity.task&&(this.updateBPMNActivityTask(t,e),a=this.getTaskChildCount(t),h=void 0,s=r.width/2-12*a,h=1===a?8+s:s+8*(a-1),void 0!==d.activity.task.loop)&&this.updateBPMNActivityTaskLoop(t,e,h,a,s,2),"SubProcess"===o&&void 0!==d.activity.subProcess&&this.updateBPMNActivitySubProcess(t,e,i,n)):(n.removeElements(t),t.wrapper.children[0]=this.getBPMNActivityShape(t)),this.setSizeForBPMNActivity(t.shape.activity,l,e.width||r.width,e.height||r.height,t)),void 0===e.width&&void 0===e.height||this.setSizeForBPMNActivity(t.shape.activity,l,e.width||r.width,e.height||r.height,t))},u.prototype.updateBPMNActivityTask=function(t,e){for(var e=e.shape,i=t.wrapper.children[0].children[0],n=e.activity.task,r=0;r<i.children.length;r++)i.children[parseInt(r.toString(),10)].id===t.id+"_2_loop"&&(a=document.getElementById(t.id+"_2_loop")).parentNode.removeChild(a);if(void 0!==n.type){n.type=n.type||"None";var o=uu(n.type);i.children[1].data=o;for(var a,r=0;r<i.children.length;r++)i.children[parseInt(r.toString(),10)].id===t.id+"_1_tasktType"&&(i.children.splice(r,1),(a=document.getElementById(t.id+"_1_tasktType")).parentNode.removeChild(a)),i.children[parseInt(r.toString(),10)].id===t.id+"_1_taskTypeService"&&(i.children.splice(r,1),(a=document.getElementById(t.id+"_1_taskTypeService")).parentNode.removeChild(a));var s=new P;s.id=t.id+"_1_tasktType",s.margin.left=5,s.margin.top=5,s.data=o,s.style.fill="transparent",s.style.opacity=t.style.opacity,"Receive"===n.type||"Send"===n.type?(s.width=18,s.height=16,"Send"===n.type&&(s.style.fill="black"),i.children.splice(1,0,s)):"Manual"===n.type?(s.width=16,s.height=11,i.children.splice(1,0,s)):"Service"!==n.type?(s.width=20,s.height=20,i.children.splice(1,0,s)):(s.width=20,s.height=20,i.children.splice(1,0,s),(n=new P).id=t.id+"_1_taskTypeService",n.data=o,n.margin.left=i.children[1].margin.left+9,n.margin.top=i.children[1].margin.top+9,n.style.fill="white",n.style.opacity=t.style.opacity,i.children.splice(2,0,n))}void 0!==e.activity.task.call&&(!1!==e.activity.task.call?i.children[0].style.strokeWidth=4:i.children[0].style.strokeWidth=1),void 0!==e.activity.task.compensation&&(!0===e.activity.task.compensation?(s="Service"===t.shape.activity.task.type,i.children[s?4:3].visible=!0):i.children[3].visible=!1)},u.prototype.updateBPMNActivityTaskLoop=function(t,e,i,n,r,o){var a,s,e=e.shape,h=t.wrapper.children[0].children[0],e=e.activity,t=t.shape.activity.task.type,d=0;void 0!==e.subProcess?(a=e.subProcess,d="Transaction"===e.subProcess.type?2:0<e.subProcess.events.length?1:0,s=mu(a=a.loop),h.children[2+d].data=s,h.children[2+d].visible="None"!==a):void 0!==e.task&&void 0!==e.task.loop&&"Service"!==t?(s=mu(e.task.loop),h.children[2].data=s,h.children[2].visible="None"!==e.task.loop):void 0!==e.task&&void 0!==e.task.loop&&"Service"===t&&(s=mu(e.task.loop),h.children[3].data=s,h.children[3].visible="None"!==e.task.loop),this.updateChildMargin(h,n,r,i,o+d)},u.prototype.updateChildMargin=function(t,e,i,n,r){if(1===e)for(var o=r;o<t.children.length;o++)2!==o&&!0===t.children[parseInt(o.toString(),10)].visible&&(t.children[parseInt(o.toString(),10)].margin.left=n,n=i+8);else{n=i+8*(e-1);for(o=r;o<t.children.length;o++)2!==o&&!0===t.children[parseInt(o.toString(),10)].visible&&(t.children[parseInt(o.toString(),10)].margin.left=n,n+=20)}},u.prototype.updateBPMNActivitySubProcess=function(t,e,i,n){var r=e.shape,o=t.wrapper.children[0],a=this.getSize(t,o.children[0].children[0]),r=r.activity.subProcess,s=this.getSubprocessChildCount(t),a=a.width/2-12*s,h=1===s?8+a:a+8*(s-1);zh(t.style,o.children[0].children[0]),void 0!==r.events&&this.updateBPMNSubProcessEvent(t,e,i,n),void 0!==r.adhoc&&this.updateBPMNSubProcessAdhoc(t,i,r,h,s,a),void 0!==r.boundary&&this.updateBPMNSubProcessBoundary(t,r),void 0!==r.collapsed&&this.updateBPMNSubProcessCollapsed(t,i,r,h,s,a,n),void 0!==r.compensation&&this.updateBPMNSubProcessCompensation(t,i,r,h,s,a),void 0!==r.loop&&this.updateBPMNSubProcessLoop(t,i,r,h,s,a),void 0!==r.transaction&&this.updateBPMNSubProcessTransaction(t,e,i,n)},u.prototype.updateBPMNSubProcessEvent=function(t,e,i,n){for(var r=e.shape,o=t.wrapper.children[0],a=o.children[0],s=(o.children[0].children.length,r.activity.subProcess),h=0,d=Object.keys(s.events);h<d.length;h++){var l=d[h],l=Number(l),c=a.children[l+2],p=t.shape.activity.subProcess.events[parseInt(l.toString(),10)];this.updateBPMNSubEvent(t,s.events[parseInt(l.toString(),10)],p,c,e,i,n)}},u.prototype.updateBPMNSubEvent=function(t,e,i,n,r,o,a){var s,h,d,l,c,p=t.wrapper.children[0],g=r.shape;void 0!==n.children&&(c=n.children[0],s=n.children[1],h=n.children[2],d=l=void 0,!r.style||void 0===r.style.strokeColor&&void 0===r.style.opacity||(p.children[0].children[1].style.strokeColor=r.style.strokeColor,p.children[0].children[1].style.opacity=r.style.opacity),void 0!==g.activity.subProcess&&(l=e.event,d=e.trigger),void 0!==l&&this.getEvent(r,o,l,c,s,h),void 0!==d&&(r.style&&zh(r.style,p.children[0]),this.removeBPMNElementFromDOM(t,a),t.wrapper.children[0]=this.getBPMNActivityShape(t)),void 0===e.height&&void 0===e.width||this.getEventSize(e,n),void 0!==e.id&&(n.id=e.id),void 0!==e.margin&&(n.margin=e.margin),void 0!==e.horizontalAlignment&&(n.horizontalAlignment=e.horizontalAlignment),void 0!==e.verticalAlignment&&(n.verticalAlignment=e.verticalAlignment),void 0!==e.offset&&(n.setOffsetWithRespectToBounds(i.offset.x,i.offset.y,"Fraction"),n.relativeMode="Point"),void 0!==e.annotations&&(g=void 0,o=p.children[0].children[2],n.children[3])&&3<n.children.length&&(g=n.children[3],a.updateAnnotation(e.annotations[0],g,o)),void 0!==e.ports&&(l=void 0,c=p.children[0].children[2],n.children[4])&&4<n.children.length&&(l=n.children[4],a.updatePort(e.ports[0],l,c)),void 0!==e.visible)&&"Event"!==t.shape.activity.subProcess.type&&this.updateDiagramContainerVisibility(n,e.visible)},u.prototype.updateBPMNSubProcessTransaction=function(t,e,i,n){var r,o=e.shape.activity.subProcess.transaction,a=t.wrapper.children[0].children[0].children[2];void 0!==o.success&&(r=t.shape.activity.subProcess.transaction.success,this.updateBPMNSubEvent(t,o.success,r,a.children[0],e,i,n)),void 0!==o.cancel&&(r=t.shape.activity.subProcess.transaction.cancel,this.updateBPMNSubEvent(t,o.cancel,r,a.children[1],e,i,n)),void 0!==o.failure&&(r=t.shape.activity.subProcess.transaction.failure,this.updateBPMNSubEvent(t,o.failure,r,a.children[2],e,i,n));for(var s=0,h=t.outEdges;s<h.length;s++){var d=h[s],l=n.nameTable[""+d];switch(l.sourcePortID){case"success":o.success&&void 0!==o.success.visible&&n.connectorPropertyChange(l,{},{sourcePortID:"success"});break;case"cancel":o.cancel&&void 0!==o.cancel.visible&&n.connectorPropertyChange(l,{},{sourcePortID:"cancel"});break;case"failure":o.failure&&void 0!==o.failure.visible&&n.connectorPropertyChange(l,{},{sourcePortID:"failure"})}}},u.prototype.getEventSize=function(t,e){void 0!==t.height&&(e.height=t.height,e.children[0].height=t.height,e.children[1].height=.85*t.height,e.children[2].height=.54*t.height),void 0!==t.width&&(e.width=t.width,e.children[0].width=t.width,e.children[1].width=.85*t.width,e.children[2].width=.54*t.width)},u.prototype.updateBPMNSubProcessAdhoc=function(t,e,i,n,r,o){t.shape;var a=t.wrapper.children[0].children[0],t="Transaction"===t.shape.activity.subProcess.type?2:0<t.shape.activity.subProcess.events.length?1:0;!1===i.adhoc?a.children[3+t].visible=!1:a.children[3+t].visible=!0,this.updateChildMargin(a,r,o,n,3+t)},u.prototype.updateBPMNSubProcessBoundary=function(t,e){t.shape;t=t.wrapper.children[0].children[0].children[0];"Default"===e.boundary&&(t.style.strokeWidth=1,t.style.strokeDashArray="1 0"),"Call"===e.boundary&&(t.style.strokeWidth=4,t.style.strokeDashArray="1 0"),"Event"===e.boundary&&(t.style.strokeWidth=1,t.style.strokeDashArray="2 2")},u.prototype.updateElementVisibility=function(t,e,i){if(t.shape.activity.subProcess.processes&&0<t.shape.activity.subProcess.processes.length)for(var n=t.shape.activity.subProcess.processes,r=n.length-1;0<=r;r--)for(var o=i.nameTable[n[parseInt(r.toString(),10)]],a=(o.visible=e,i.updateElementVisibility(o.wrapper,o,e),e&&(N.isBlazor()||"Event"!==o.shape.shape||this.setEventVisibility(o,o.wrapper.children[0].children),"SubProcess"===o.shape.activity.activity)&&this.setSubProcessVisibility(o),o.inEdges.concat(o.outEdges)),s=a.length-1;0<=s;s--){var h=i.nameTable[a[parseInt(s.toString(),10)]];h.visible=e,i.updateElementVisibility(h.wrapper,h,e)}if(e&&(N.isBlazor()||"Event"!==t.shape.shape||this.setEventVisibility(t,t.wrapper.children[0].children),"SubProcess"===t.shape.activity.activity&&this.setSubProcessVisibility(t),"Task"!==t.shape.activity.activity||N.isBlazor()||"Activity"!==t.shape.shape||"None"!==t.shape.activity.subProcess.loop||(t.wrapper.children[0].children[0].children[3].visible=!1),"DataObject"===t.shape.shape))if(!1===t.shape.dataObject.collection&&"None"===t.shape.dataObject.type)for(s=t.wrapper.children[0].children.length-1;0<s;s--)t.wrapper.children[0].children[parseInt(s.toString(),10)].visible=!1;else!0===t.shape.dataObject.collection&&"None"===t.shape.dataObject.type?t.wrapper.children[0].children[1].visible=!1:!1!==t.shape.dataObject.collection||"Input"!==t.shape.dataObject.type&&"Output"!==t.shape.dataObject.type||(t.wrapper.children[0].children[2].visible=!1)},u.prototype.updateBPMNSubProcessCollapsed=function(t,e,i,n,r,o,a){var s=t.shape.activity.subProcess.events.length,h=t.wrapper.children[0].children[0],d="Transaction"===t.shape.activity.subProcess.type?3:0<t.shape.activity.subProcess.events.length?0:1;!1===i.collapsed?(this.updateElementVisibility(t,!0,a),h.children[d+s].visible=!1):(this.updateElementVisibility(t,!1,a),h.children[d+s].visible=!0),this.updateChildMargin(h,r,o,n,3+s)},u.prototype.updateBPMNSubProcessCompensation=function(t,e,i,n,r,o){var a=t.wrapper.children[0].children[0],t="Transaction"===t.shape.activity.subProcess.type?2:0<t.shape.activity.subProcess.events.length?1:0;!1===i.compensation?a.children[4+t].visible=!1:a.children[4+t].visible=!0,this.updateChildMargin(a,r,o,n,4+t)},u.prototype.updateBPMNSubProcessLoop=function(t,e,i,n,r,o){this.updateBPMNActivityTaskLoop(t,t,n,r,o,1)},u.prototype.updateBPMNConnector=function(t,e,i,n){var r=i.shape,o=t.shape.flow;return"Sequence"!==r.flow&&!r.sequence||"Sequence"!==o||(t=this.getSequence(t,e,i,n)),"Association"!==r.flow&&!r.association||"Association"!==o||(t=this.getAssociation(t,e,i,n)),t="Message"!==r.flow&&!r.message||"Message"!==o?t:this.getMessage(t,e,i,n)},u.prototype.getSequence=function(t,e,i,n){if("Normal"!==i.shape.sequence&&"Normal"!==t.shape.sequence||(t.targetDecorator.shape="Arrow",t.sourceDecorator.shape="None",t.style.strokeDashArray="None",t.targetDecorator.style.fill="black",t.targetDecorator.width=10,t.targetDecorator.height=10,n.connectorPropertyChange(t,e,{targetDecorator:{shape:"Arrow",style:{fill:"black"},height:10,width:10},sourceDecorator:{shape:"None"},style:{strokeDashArray:"None"}}),t.wrapper.children[3].visible=!1),"Default"===i.shape.sequence||"Default"===t.shape.sequence){t.targetDecorator.shape="Arrow",t.sourceDecorator.shape="None",t.style.strokeDashArray="None",t.targetDecorator.style.fill="black",t.targetDecorator.width=10,t.targetDecorator.height=10,n.connectorPropertyChange(t,e,{style:{strokeDashArray:"None"},targetDecorator:{shape:"Arrow",style:{fill:"black"},height:10,width:10},sourceDecorator:{shape:"None"}});for(var r=new P,o=(new P,void 0),a=(t.getSegmentElement(t,r),t.intermediatePoints),s=0;s<a.length-1;s++)length+=t.distance(a[parseInt(s.toString(),10)],a[s+1]),o=t.findPath(a[parseInt(s.toString(),10)],a[s+1]);r=new P;r.data=o[0],r.id=t.id+"_"+i.shape.sequence||t.shape.sequence,r.offsetX=o[1].x,r.offsetY=o[1].y,r.rotateAngle=45,r.transform=Z.Transform.Self,this.removeDomElement(t,n,r)}return"Conditional"!==i.shape.sequence&&"Conditional"!==t.shape.sequence||(t.sourceDecorator.shape="Diamond",t.sourceDecorator.width=20,t.sourceDecorator.height=10,t.sourceDecorator.style.fill="white",t.targetDecorator.style.fill="black",t.style.strokeDashArray="None",t.targetDecorator.shape="Arrow",n.connectorPropertyChange(t,e,{style:{strokeDashArray:"None"},targetDecorator:{shape:"Arrow",style:{fill:"black"},height:10,width:10},sourceDecorator:{shape:"Diamond",width:20,height:10,style:{fill:"white"}}}),t.wrapper.children[3].visible=!1),t},u.prototype.getAssociation=function(t,e,i,n){return"Default"!==i.shape.association&&"Default"!==t.shape.association||(t.sourceDecorator.shape="None",t.targetDecorator.shape="None",t.style.strokeDashArray="2 2",n.connectorPropertyChange(t,e,{style:{strokeDashArray:"2 2"},targetDecorator:{shape:"None"},sourceDecorator:{shape:"None"}}),t.wrapper.children[3].visible=!1),"Directional"!==i.shape.association&&"Directional"!==t.shape.association||(t.sourceDecorator.shape="None",t.style.strokeDashArray="2 2",t.targetDecorator.shape="OpenArrow",t.targetDecorator.width=10,t.targetDecorator.height=10,n.connectorPropertyChange(t,e,{style:{strokeDashArray:"2 2"},targetDecorator:{shape:"OpenArrow",width:10,height:10},sourceDecorator:{shape:"None"}}),t.wrapper.children[3].visible=!1),"BiDirectional"!==i.shape.association&&"BiDirectional"!==t.shape.association||(t.sourceDecorator.shape="OpenArrow",t.targetDecorator.shape="OpenArrow",t.sourceDecorator.width=10,t.sourceDecorator.height=10,t.sourceDecorator.style.fill="black",n.connectorPropertyChange(t,e,{style:{strokeDashArray:"2 2"},targetDecorator:{shape:"OpenArrow",width:10,height:10},sourceDecorator:{shape:"OpenArrow",width:10,height:10,style:{fill:"black"}}}),t.wrapper.children[3].visible=!1),t},u.prototype.getMessage=function(t,e,i,n){t.sourceDecorator.shape="Circle",t.sourceDecorator.width=10,t.targetDecorator.shape="Arrow",t.sourceDecorator.height=10,t.sourceDecorator.style.fill="White",t.targetDecorator.style.fill="White",n.connectorPropertyChange(t,e,{sourceDecorator:{shape:"Circle",style:{fill:"White"},width:10,height:10},targetDecorator:{shape:"Arrow",style:{fill:"white"}}});for(var r,o,a=t.intermediatePoints,s=0,h=0;h<a.length-1;h++){var d=.5*(s+=t.distance(a[h],a[h+1]));d<=s&&(r=M(a[parseInt(h.toString(),10)],a[h+1]),o=K.transform(a[parseInt(h.toString(),10)],r,d))}e=new P;return t.wrapper.children[0].style.strokeDashArray=" 4 4",t.style.strokeDashArray="4 4",e.id=t.id+"_"+i.shape.message||t.shape.message,e.width=25,e.height=15,e.data="M0,0 L19.8,12.8 L40,0 L0, 0 L0, 25.5 L40, 25.5 L 40, 0",e.horizontalAlignment="Center",e.verticalAlignment="Center",e.transform=Z.Transform.Self,e.style.fill="NonInitiatingMessage"===i.shape.message?"lightgrey":"white",e.offsetX=o.x,e.offsetY=o.y,"Default"!==i.shape.message&&void 0!==i.shape.message||"Default"!==t.shape.message?e.style.fill="NonInitiatingMessage"===(i.shape.message||t.shape.message)?"lightgrey":"white":e.visible=!1,this.removeDomElement(t,n,e),t},u.prototype.removeDomElement=function(t,e,i){for(var n=0,r=e.views;n<r.length;n++){var o=r[n];rp(t.id+"_groupElement",o),rp(t.id+"_content_groupElement",o),rp(t.id+"_html_element",o)}t.wrapper.children.splice(3,1),t.wrapper.children.splice(3,0,i)},u.prototype.setSizeForBPMNEvents=function(t,e,i,n){e.children[0].width=i,e.children[0].height=n;var r=e.children[1],r=(r.width=.85*i,r.height=.85*n,e.children[2]);"Message"===t.trigger?(r.width=.54*i,r.height=.4*n):(r.width=.5*i,r.height=.5*n)},u.prototype.updateAnnotationDrag=function(t,e,i,n){return!!t.processId&&(this.drag(t,i,n,e),!0)},u.prototype.getAnnotationPathAngle=function(t,e){var i=0;switch(Vi(t,e,e)){case"Right":i=0;break;case"Left":i=180;break;case"Bottom":i=90;break;case"Top":i=270}return i},u.prototype.setSizeForBPMNGateway=function(t,e,i,n){e.children[0].width=i,e.children[0].height=n,e.children[1].width=.45*i,e.children[1].height=.45*n},u.prototype.setSizeForBPMNDataObjects=function(t,e,i,n){e.children[0].width=i,e.children[0].height=n},u.prototype.setSizeForBPMNActivity=function(t,e,i,n,r){e.children[0].width=i,e.children[0].height=n,e.children[0].children[0].width=i,e.children[0].children[0].height=n,"Transaction"===t.subProcess.type&&(e.children[0].children[1].width=Math.max(i-6,1),e.children[0].children[1].height=Math.max(n-6,1),e.children[0].children[2].width=i,e.children[0].children[2].height=n);for(var n=new qt,n=this.getSize(r,n),t="Task"===t.activity?this.getTaskChildCount(r):this.getSubprocessChildCount(r),r=(i||n.width)/2,o=1===t?r-6:r-12*t/2-4*(t-1)/2,a=0;a<e.children[0].children.length;a++)e.children[0].children[parseInt(a.toString(),10)].visible&&(-1<e.children[0].children[parseInt(a.toString(),10)].id.indexOf("_loop")||-1<e.children[0].children[parseInt(a.toString(),10)].id.indexOf("_0_compensation")||-1<e.children[0].children[parseInt(a.toString(),10)].id.indexOf("_0_adhoc")||-1<e.children[0].children[parseInt(a.toString(),10)].id.indexOf("_0_collapsed"))&&(e.children[0].children[parseInt(a.toString(),10)].margin.left=o,o+=e.children[0].children[parseInt(a.toString(),10)].actualSize.width+4)},u.prototype.updateDiagramContainerVisibility=function(t,e){if(t instanceof te)for(var i=0;i<t.children.length;i++)this.updateDiagramContainerVisibility(t.children[parseInt(i.toString(),10)],e);t.visible&&t.visible!==e&&(t.visible=e)},u.prototype.destroy=function(){},u.prototype.getModuleName=function(){return"Bpmn"};mg=u;function u(){this.bpmnTextAnnotationConnector=[]}function cu(t){return fu[t.toString()]}function pu(t){return yu[t.toString()]}function gu(t){return vu[t.toString()]}function uu(t){return bu[t.toString()]}function mu(t){return Su[t.toString()]}var fu={Event:"M80.5,12.5 C80.5,19.127417 62.59139,24.5 40.5,24.5 C18.40861,24.5 0.5,19.127417 0.5,12.5C0.5,5.872583 18.40861,0.5 40.5,0.5 C62.59139,0.5 80.5,5.872583 80.5,12.5 z",Message:"M0,0L19.8,12.8L40,0L0,0L0,25.5L40,25.5L40,0z",DataSource:"M 0 10.6 c 0 5.9 16.8 10.6 37.5 10.6 S 75 16.4 75 10.6 v 0 v 68.9 v -0.1 C 75 85.3 58.2 90 37.5 90 S 0 85.3 0 79.4 l 0 0.1 V 56 V 40.6 L 0 10.6 C 0 4.7 16.8 0 37.5 0 S 75 4.7 75 10.6 S 58.2 21.2 37.5 21.2S 0 16.5 0 10.6 l 0 6.7 v -0.2 c 0 5.9 16.8 10.6 37.5 10.6 S 75 22.9 75 17.1 v 6.8 v -0.1 c 0 5.9 -16.8 10.6 -37.5 10.6 S 0 29.6 0 23.8",SubProcess:"M100,100 h200 a20,20 0 0 1 20,20 v200 a20,20 0 0 1 -20,20 h-200 a20,20 0 0 1 -20,-20 v-200 a20,20 0 0 1 20,-20 z",collapsedShape:"M 8.13789 15 H 0 V 0 H 8.13789 V 15 Z M 0.625991 13.75 H 7.51189 V 1.25 H 0.625991 V 13.75 Z M 2.18095 7.03125 L 5.95631 7.03125 L 5.95631 7.46875 L 2.18095 7.46875 Z M 3.8342 3.73 L 4.30369 3.73 L 4.30369 11.2687 L 3.8342 11.2687 Z"},yu={Message:"M0,0 L19.8,12.8 L40,0 L0, 0 L0, 25.5 L40, 25.5 L 40, 0",Timer:"M40,20c0,8.654-5.496,16.024-13.189,18.81C24.685,39.58,22.392,40,20,40C8.954,40,0,31.046,0,20S8.954,0,20,0S40,8.954,40,20z M20,0 L20,2.583 L20,5.283 M10.027,2.681L11.659,5.507 L12.669,7.257 M2.731,9.989 L6.014,11.885 L7.307,12.631 M0.067,19.967 L2.667,19.967 L5.35,19.967M2.748,29.939 L5.731,28.217 L7.323,27.298 M10.056,37.236 L11.292,35.095 L12.698,32.66 M20.033,39.9 L20.033,36.417 L20.033,34.617M30.006,37.219 L28.893,35.292 L27.364,32.643 M37.302,29.911 L34.608,28.355 L32.727,27.269M39.967,19.933 L37.417,19.933 L34.683,19.933 M37.286,9.961 L34.583,11.521 L32.71,12.602 M29.977,2.664 L28.653,4.957 L27.336,7.24 M22.104,8.5 L19.688,20 L24.75,20 L31.604,20 L24.75,20 L19.688,20z",Error:"M 23.77 18.527 l -7.107 27.396 l 8.507 -17.247 L 36.94 40.073 l 6.394 -25.997 l -8.497 15.754 L 23.77 18.527 Z",Escalation:"M 30.001 8.098 L 11.842 43.543 l 18.159 -18.882 l 18.162 18.882 L 30.001 8.098 Z ",Cancel:"M 3.5 16 L 0 12.6 L 4.6 8 L 0 3.5 L 3.4 0 L 8 4.6 l 4.5 -4.5 L 16 3.5 L 11.5 8 l 4.5 4.5 l -3.4 3.5 L 8 11.4 L 3.5 16 Z",Compensation:"M 25.7086 0 L 0 25 L 25.7086 50 V 26.3752 L 50 50 V 0 L 25.7086 23.6248 V 0 Z ",Conditional:"M 0 0 H 16 V 16 H 0 z M 1.14 3.2 H 14.85 M 1.14 6.4 H 14.85 M 1.14 9.6 H 14.85 M 1.14 12.8 H 14.85",Link:"M 32.014 19.258 v 5.992 H 9.373 v 9.504 h 22.641 v 5.988 L 50.622 30 L 32.014 19.258 Z",Signal:"M 50 50 H 0 L 25.0025 0 L 50 50 Z",Terminate:"M 25 50 C 11.21 50 0 38.79 0 25 C 0 11.21 11.21 0 25 0 C 38.78 0 50 11.21 50 25 C 50 38.79 38.78 50 25 50",Multiple:"M 17.784 48.889 H 42.21 l 7.548 -23.23 L 29.997 11.303 L 10.236 25.658 L 17.784 48.889 Z",Parallel:"M 27.276 49.986 h 5.58 v -17.15 h 17.146 V 27.17 h -17.15 l 0.004 -17.15 h -5.58 l -0.004 17.15 H 9.994 v 5.666 h 17.278 L 27.276 49.986 Z"},vu={None:"",Exclusive:"M 11.196 29.009 l 6.36 -9.712 l -5.764 -8.899 h 4.393 l 3.732 5.979 l 3.656 -5.979 h 4.354 l -5.789 9.039l 6.36 9.572 h -4.532 l -4.126 -6.437 l -4.139 6.437 H 11.196 Z",Inclusive:"M 20.323 31.333 c -6.625 0 -12.015 -5.39 -12.015 -12.015 s 5.39 -12.015 12.015 -12.015 s 12.016 5.39 12.016 12.015 S 26.948 31.333 20.323 31.333 Z M 20.323 9.303 c -5.522 0 -10.015 4.493 -10.015 10.015 s 4.492 10.015 10.015 10.015 s 10.016 -4.493 10.016 -10.015 S 25.846 9.303 20.323 9.303 Z",Parallel:"M 18.394 29.542 v -8.833 H 9.626 v -3.691 h 8.768 V 8.251 h 3.734 v 8.767 h 8.768 v 3.691 h -8.768 v 8.833 H 18.394 Z",Complex:"M29.198,19.063L23.089,19.063L27.794,14.358L26.38,12.944L21.223,18.101L21.223,10.443L19.223,10.443L19.223,17.976L14.022,12.776L12.608,14.19L17.48,19.063L10.365,19.063L10.365,21.063L18.261,21.063L12.392,26.932L13.806,28.346L19.223,22.929L19.223,30.225L21.223,30.225L21.223,22.805L25.925,27.507L27.339,26.093L22.309,21.063L29.198,21.063z",EventBased:"M 20.322 29.874 c -5.444 0 -9.873 -4.43 -9.873 -9.874 s 4.429 -9.874 9.873 -9.874 s 9.874 4.429 9.874 9.874 S 25.767 29.874 20.322 29.874 Z M 20.322 32.891 c -7.107 0 -12.89 -5.783 -12.89 -12.891 c 0 -7.107 5.782 -12.89 12.89 -12.89 c 7.108 0 12.891 5.783 12.891 12.89 C 33.213 27.108 27.431 32.891 20.322 32.891 Z M 24.191 25.386 h -7.984 l -2.469 -7.595 l 6.461 -4.693 l 6.461 4.693 L 24.191 25.386 Z",ExclusiveEventBased:"M 30 15 C 30 23.28 23.28 30 15 30 S 0 23.28 0 15 S 6.72 0 15 0 S 30 6.72 30 15 z M 15 5 L 5 12.5 L 8 22.5 H 22 L 25 12.5 z",ParallelEventBased:"M 35 17.5 C 35 27.16 27.16 35 17.5 35 S 0 27.16 0 17.5 S 7.84 0 17.5 0 S 35 7.84 35 17.5 z M 14.58 5.83 V 14.58 H 5.83 V 20.42 H 14.58 V 29.17 H 20.42 V 20.42 H 29.17 V 14.58 H 20.42 V 5.83 z"},bu={None:"",Service:"M 32.699 20.187 v -4.005 h -3.32 c -0.125 -0.43 -0.292 -0.83 -0.488 -1.21 l 2.373 -2.375 l -2.833 -2.83 l -2.333 2.333 c -0.44 -0.253 -0.9 -0.448 -1.387 -0.595 v -3.32 h -4.003 v 3.32 c -0.46 0.137 -0.890.322 -1.3 0.537 l -2.285 -2.275 l -2.833 2.83 l 2.285 2.278 c -0.235 0.42 -0.41 0.847 -0.547 1.307 h -3.33 v 4.005 h 3.33 c 0.148 0.488 0.343 0.955 0.588 1.395 l -2.325 2.325 l 2.822 2.832 l 2.373 -2.382 c 0.392 0.205 0.792 0.37 1.212 0.497 v 3.33 h 4.003 v -3.33 c 0.46 -0.138 0.89 -0.323 1.3 -0.547 l 2.43 2.432 l 2.822 -2.832 l -2.42 -2.422 c 0.222 -0.41 0.4 -0.85 0.535-1.297 H 32.699 Z M 22.699 21.987 c -2.1 0 -3.803 -1.703 -3.803 -3.803 c 0 -2.1 1.703 -3.803 3.803 -3.803 c 2.1 0 3.803 1.703 3.803 3.803 C 26.502 20.285 24.8 21.987 22.699 21.987 Z",Receive:"M 12.217 12.134 v 13.334 h 20 V 12.134 H 12.217 Z M 30.44 13.007 l -8.223 5.35 l -8.223 -5.35 H 30.44 Z M 13.09 24.594 V 13.459 l 9.127 5.94 l 9.127 -5.94 v 11.135 H 13.09 Z",Send:"M0,1.2260086 L8.0000002,8.3380068 16,1.2260086 16,12.000007 0,12.000007 z M1.6300015,0 L14.371001,0 8.0000055,5.662 z",InstantiatingReceive:"M 16.306 17.39 v 8.79 h 13.198 v -8.79 H 16.306 Z M 28.375 17.946 l -5.47 3.558 l -5.47 -3.558 H 28.375 Z M 28.948 25.625 H 16.861 v -7.389 l 6.043 3.931 l 6.043 -3.931 V 25.625 Z M 22.905 11.785c -5.514 0 -9.999 4.486 -9.999 10 c 0 5.514 4.485 10 9.999 10 s 9.999 -4.486 9.999 -10 C 32.904 16.272 28.419 11.785 22.905 11.785 Z M 22.905 31.239 c -5.212 0 -9.453 -4.241 -9.453 -9.454c 0 -5.212 4.241 -9.453 9.453 -9.453 s 9.452 4.241 9.452 9.453 C 32.357 26.998 28.117 31.239 22.905 31.239 Z",Manual:"M9.21 612 L5.82 612 L1.07 612 a1.07317 1 -180 0 1 -1.07317 -1 L0 604.75 A3.42007 1.59344 -180 0 0 1.61 604 L2.6 604 L5.99 604 a0.721171 0.672 0 0 1 0.721171 0.672 a0.721171 0.672 0 0 1 -0.721171 0.672 L2.6 605.34 a0.48818 0.183302 -90 0 0 0.0837073 0.342385 L5.63 605.69 a0.721171 0.672 0 0 1 0.184585 -0.0223847 L10.28 605.66 a0.721171 0.672 0 0 1 0.721171 0.672 a0.721171 0.672 0 0 1 -0.721171 0.672 L5.82 607.01 a0.721171 0.672 0 0 1 -0.184585 -0.0223847 L5.63 607.35 a0.721171 0.672 0 0 1 0.184585 -0.0223847 L10.01 607.33 a0.721171 0.672 0 0 1 0.721171 0.672 a0.721171 0.672 0 0 1 -0.721171 0.672 L5.82 608.67 a0.721171 0.672 0 0 1 -0.184585 -0.0223847 L5.63 609.01 a0.721171 0.672 0 0 1 0.184585 -0.0223847 L9.47 608.99 a0.721171 0.672 0 0 1 0.721171 0.672 a0.721171 0.672 0 0 1 -0.721171 0.672 L5.82 610.34 a0.721171 0.672 0 0 1 -0.184585 -0.0223847 L5.63 610.68 a0.721171 0.672 0 0 1 0.184585 -0.0223847 L9.21 610.66 a0.721171 0.672 0 0 1 0.721171 0.672 a0.721171 0.672 0 0 1 -0.721171 0.672",BusinessRule:"M 32.844 13.245 h -0.089 v 0 H 13.764 v -0.015 h -1.009 v 16.989 h 0.095 v 0.011 h 19.716 v -0.011 h 0.278 V 13.245 Z M 31.844 14.229 v 4.185 h -18.08 v -4.185 H 31.844 Z M 18.168 25.306 v 3.938 h -4.404 v -3.938 H 18.168 Z M 13.764 24.322 v -4.923 h 4.404 v 4.923 H 13.764 Z M 19.177 25.306 h 12.667 v 3.938 H 19.177 V 25.306 Z M 19.177 24.322v -4.923 h 12.667 v 4.923 H 19.177 Z",User:"M8.6751149,13.75 L10.79009,18.703003 11.664047,18.696991 13.792084,13.75 13.824066,13.75 C18.177001,13.75 21.709022,17.259003 21.748998,21.60199 21.748998,21.649994 21.743993,21.700012 21.735021,21.747009 21.137981,24.774994 18.775997,27.144989 15.74904,27.75 L6.7491024,27.75 C3.7231224,27.144989 1.3601628,24.774994 0.76312089,21.747009 0.75414884,21.700012 0.74914402,21.649994 0.75012076,21.60199 0.78912175,17.259003 4.3221171,13.75 8.6751149,13.75 z M11.249014,0.75 C14.287014,0.75 16.749015,3.2119999 16.749015,6.25 16.749015,9.2880001 14.287014,11.75 11.249014,11.75 8.211015,11.75 5.7490147,9.2880001 5.7490147,6.25 5.7490147,3.2119999 8.211015,0.75 11.249014,0.75 z",Script:"M22.3,80.4 A82.9529,77.0159,-180,0,0,10.3,46.7 A69.8467,64.8477,0,0,1,0,19.7 A27.6207,25.6439,0,0,1,12.1,0 L84.7,0 A37.4124,34.7347,-180,0,0,77.7,19.6 A82.8871,76.9547,-180,0,0,89.7,53.3 A69.8146,64.81790000000001,0,0,1,100,80.3 A27.603399999999997,25.6278,0,0,1,87.9,100 L15.3,100 A37.4265,34.7479,-180,0,0,22.3,80.4 M12.5,28.6 L67.3,28.6 M18.3,42.9 L72.1,42.9 M80.8,57.1 L26,57.1 M85.6,71.4 L32.6,71.4"},Su={None:"",Standard:"M 52.002 73.379 c -2.494 -2.536 -6.55 -2.534 -9.043 0 c -1.208 1.228 -1.874 2.861 -1.874 4.598 c 0 1.225 0.337 2.395 0.957 3.411 l -1.167 1.186 l 2.071 0.458 l 2.071 0.458 l -0.45 -2.106 l -0.45 -2.106 l -1.292 1.314c -1.119 -2.065 -0.842 -4.709 0.877 -6.458 c 2.084 -2.119 5.475 -2.117 7.557 0 c 2.083 2.119 2.083 5.565 0 7.685c -0.976 0.992 -2.272 1.557 -3.65 1.59 l 0.025 1.068 c 1.65 -0.041 3.2 -0.716 4.368 -1.903 c 1.208 -1.228 1.874 -2.861 1.874 -4.597 C 53.875 76.24 53.209 74.607 52.002 73.379 Z",ParallelMultiInstance:"M 51.5,69.5 L52.5,69.5 L52.5,84.5 L51.5 84.5 Z M 46.5,69.5 L47.5,69.5 L47.5,84.5 L46.5 84.5 Z M 41.5,69.5 L42.5,69.5 L42.5,84.5 L41.5 84.5 Z  ",SequenceMultiInstance:"M 40.375,71.5 L 55.375,71.5 L 55.375,72.5 L 40.375,72.5 Z M 40.375,76.5 L 55.375,76.5 L 55.375,77.5 L 40.375,77.5 Z M 40.375,76.5 L 55.375,76.5 L 55.375,77.5 L 40.375,77.5 Z M 40.375,81.5 L 55.375,81.5L 55.375,82.5 L 40.375,82.5 Z"},Ug=(wu.prototype.updateBridging=function(t,e){var i,n,r=[];if(t.bridges=[],n=e,(i=t).constraints&Z.ConnectorConstraints.Bridging?i.constraints&Z.ConnectorConstraints.Bridging:i.constraints&Z.ConnectorConstraints.InheritBridging?n.constraints&Z.DiagramConstraints.Bridging:0){for(var o=this.getPoints(t),a=k.toBounds(o),s=t.bridgeSpace,h=e.bridgeDirection||"Top",d=-1,l=e.connectors,c=0;c<l.length;c++){var p=l[parseInt(c.toString(),10)];if(t&&p&&t.id!==p.id&&p.visible){var g=this.getPoints(p),u=k.toBounds(g);if(this.intersectsRect(a,u)){var m=this.intersect(o,g,!1,h,!0);if(0<m.length)for(var f=0;f<m.length;f++){var y=0,v=0,b=this.getLengthAtFractionPoint(t,m[parseInt(f.toString(),10)]);if(-1!==b.pointIndex){var S=b.lengthFractionIndex,y=(b.fullLength,b.segmentIndex),v=b.pointIndex,b=this.getPointAtLength(S-s/2,o),S=this.getPointAtLength(S+s/2,o),w=(this.isEmptyPoint(S)&&(S=b),void 0),x=t.sourcePoint,w="Straight"===t.type?t.targetPoint:t.intermediatePoints[parseInt(v.toString(),10)],x=this.angleCalculation(x,w);if(r.length){for(var I,C=t.sourcePoint,P=Math.abs(this.lengthCalculation(C,S)),A=-1,d=-1,T=0;T<r[parseInt(y.toString(),10)].bridges.length;T++){d++;var D=r[parseInt(y.toString(),10)].bridges[parseInt(T.toString(),10)];if(P<Math.abs(this.lengthCalculation(C,D.endPoint))){A=d;break}}0<=A?((I=this.createSegment(b,S,x,h,v,t,e)).target=p.id,r[parseInt(y.toString(),10)].bridges.splice(A,0,I),r[parseInt(y.toString(),10)].bridges.join(),r[parseInt(y.toString(),10)].bridgeStartPoint.splice(A,0,b),r[parseInt(y.toString(),10)].bridgeStartPoint.join()):((I=this.createSegment(b,S,x,h,v,t,e)).target=p.id,r[parseInt(y.toString(),10)].bridges.push(I),r[parseInt(y.toString(),10)].bridgeStartPoint.push(b)),r[parseInt(y.toString(),10)].segmentIndex=y}else isNaN(b.x)||isNaN(b.y)||this.isEmptyPoint(S)||(w={bridges:[],bridgeStartPoint:[],segmentIndex:y},(x=this.createSegment(b,S,x,h,v,t,e)).target=p.id,(v=[]).push(b),[].push(S),r[parseInt(y.toString(),10)]=w,r[parseInt(y.toString(),10)].bridges.push(x),r[parseInt(y.toString(),10)].bridgeStartPoint=v,r[parseInt(y.toString(),10)].segmentIndex=y)}}}}}0!==r.length&&this.firstBridge(r,t,s)}},wu.prototype.firstBridge=function(t,e,i){for(var n=0;n<t.length;n++){for(var r,o=t[parseInt(n.toString(),10)],a=1;a<o.bridges.length;a++)K.findLength(o.bridges[parseInt(a.toString(),10)].endPoint,o.bridges[a-1].endPoint)<i&&(o.bridges[a-1].endPoint=o.bridges[parseInt(a.toString(),10)].endPoint,h=o.bridges[a-1],r=this.createBridgeSegment(h.startPoint,h.endPoint,h.angle,i,h.sweep),o.bridges[a-1].path=r,o.bridges.splice(a,1),o.bridgeStartPoint.splice(a,1),a--);e.sourcePoint;for(var s=0;s<o.bridges.length;s++){var h;(h=o.bridges[parseInt(s.toString(),10)]).endPoint;e.bridges.push(h)}}},wu.prototype.createSegment=function(t,e,i,n,r,o,a){var s={angle:0,endPoint:{x:0,y:0},target:"",path:"",segmentPointIndex:-1,startPoint:{x:0,y:0},sweep:1,rendered:!1},n=this.sweepDirection(i,n,o,a),a=this.createBridgeSegment(t,e,i,o.bridgeSpace,n);return s.path=a,s.startPoint=t,s.endPoint=e,s.angle=i,s.segmentPointIndex=r,s.sweep=n,s},wu.prototype.createBridgeSegment=function(t,e,i,n,r){return"A "+n/2+" "+n/2+" "+i+" , 1 "+r+" "+e.x+","+e.y},wu.prototype.sweepDirection=function(t,e,i,n){var r,o=Math.abs(t);switch(e){case"Top":case"Bottom":r=1,0<=o&&o<=90&&(r=0);break;case"Left":case"Right":r=1,t<0&&-180<=t&&(r=0)}return r="Right"!==e&&"Bottom"!==e?r:0===r?1:0},wu.prototype.getPointAtLength=function(t,e){for(var i,n=0,r={x:0,y:0},o=0;o<e.length;o++){var a=e[parseInt(o.toString(),10)];if(i){var s=this.lengthCalculation(i,a);if(t<n+s){var h=t-n,d=K.findAngle(i,a),l=h*Math.cos(d*Math.PI/180),h=h*Math.sin(d*Math.PI/180),r={x:i.x+l,y:i.y+h};break}n+=s}i=a}return r},wu.prototype.getPoints=function(t){var e=[];if(t.intermediatePoints&&("Straight"===t.type||"Orthogonal"===t.type))for(var i=0;i<t.intermediatePoints.length;i++)e.push(t.intermediatePoints[parseInt(i.toString(),10)]);return e},wu.prototype.intersectsRect=function(t,e){return e.x<t.x+t.width&&t.x<e.x+e.width&&e.y<t.y+t.height&&t.y<e.y+e.height},wu.prototype.intersect=function(t,e,i,n,r){i&&2<=e.length&&(e.splice(0,1),e.splice(0,1));for(var o=[],a=0;a<t.length-1;a++){var s=this.inter1(t[parseInt(a.toString(),10)],t[a+1],e,r,n);if(0<s.length)for(var h=0;h<s.length;h++)o.push(s[parseInt(h.toString(),10)]);i&&1<=e.length&&e.splice(0,1)}return o},wu.prototype.inter1=function(t,e,i,n,r){for(var o=[],a=0;a<i.length-1;a++){var s=ch(t,e,i[parseInt(a.toString(),10)],i[a+1]);if(!this.isEmptyPoint(s)){var h=this.angleCalculation(t,e),d=this.angleCalculation(i[parseInt(a.toString(),10)],i[a+1]),h=this.checkForHorizontalLine(h),d=this.checkForHorizontalLine(d);switch(r){case"Left":case"Right":d<h&&o.push(s);break;case"Top":case"Bottom":h<d&&o.push(s)}h===d&&n&&o.push(s)}}return o},wu.prototype.checkForHorizontalLine=function(t){t=Math.abs(t);return 90<t?180-t:t},wu.prototype.isEmptyPoint=function(t){return 0===t.x&&0===t.y},wu.prototype.getLengthAtFractionPoint=function(t,e){for(var i=100,n=-1,r=0,o=-1,a=0,s=0,h=t.sourcePoint,d=h,l=[],c=0;c<t.intermediatePoints.length;c++){var p=t.intermediatePoints[parseInt(c.toString(),10)];l.push(p)}for(var g=0;g<l.length;g++){var u=l[parseInt(g.toString(),10)],m=this.getSlope(u,h,e,t);m<i&&(i=m,s=r+this.lengthCalculation(e,d),o=a,n=g),r+=K.findLength(u,h),d=h=u}return a++,{lengthFractionIndex:s,fullLength:r,segmentIndex:o,pointIndex:n}},wu.prototype.getSlope=function(t,e,i,n){var r=Math.abs(t.x-e.x),o=Math.abs(t.y-e.y),a=(i.y-t.y)/(e.y-t.y),s=(i.x-t.x)/(e.x-t.x);if(!isFinite(a)||!isFinite(s)||isNaN(a)||isNaN(s)){if(t.x===e.x){if(t.y===e.y)return 1e4;if(t.y>i.y&&i.y>e.y||t.y<i.y&&i.y<e.y)return Math.abs(t.x-i.x)}else if(t.y===e.y&&(t.x>i.x&&i.x>e.x||t.x<i.x&&i.x<e.x))return Math.abs(t.y-i.y)}else if((t.x>=i.x&&i.x>=e.x||t.x<=i.x&&i.x<=e.x||r<3)&&(t.y>=i.y&&i.y>=e.y||t.y<=i.y&&i.y<=e.y||o<3))return Math.abs(a-s);return 1e4},wu.prototype.angleCalculation=function(t,e){var i=t.x-e.x,t=t.y-e.y;return Math.atan2(t,i)*(180/Math.PI)},wu.prototype.lengthCalculation=function(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))},wu.prototype.destroy=function(){},wu.prototype.getModuleName=function(){return"Bridging"},wu);function wu(){}xu.prototype.canSnap=function(){return 0!=(this.diagram.snapSettings.constraints&(Z.SnapConstraints.SnapToObject|Z.SnapConstraints.SnapToLines))},xu.prototype.getWrapperObject=function(t,e){if(t.nodes&&0<t.nodes.length&&(this.diagram.snapSettings.constraints&Z.SnapConstraints.SnapToLines||this.diagram.snapSettings.constraints&Z.SnapConstraints.SnapToObject)){var i=0;if(i<t.nodes.length)return(("SwimLane"===t.nodes[parseInt(i.toString(),10)].shape.type||t.nodes[parseInt(i.toString(),10)].isLane||""!==t.nodes[parseInt(i.toString(),10)].parentId&&e[t.nodes[parseInt(i.toString(),10)].parentId]&&e[t.nodes[parseInt(i.toString(),10)].parentId].isLane)&&e.helper?e.helper:t).wrapper}return t.wrapper},xu.prototype.setSnapLineColor=function(){return this.diagram.snapSettings.snapLineColor},xu.prototype.snapPoint=function(t,e,i,n,r,o,a){var s=this.diagram.snapSettings,h=this.diagram.scroller.currentZoom,d={x:0,y:0},l=up(this.getWrapperObject(e,t.nameTable)),c={snapped:!1,offset:0},p={snapped:!1,offset:0},t=(this.diagram.snapSettings.constraints&Z.SnapConstraints.SnapToObject&&((g=document.createElementNS("http://www.w3.org/2000/svg","g")).setAttribute("id","_SnappingLines"),g.setAttribute("shapeRendering","crispEdges"),this.getAdornerLayerSvg().appendChild(g),this.snapObject(t,e,g,c,p,r,o===a)),l.x+r.x),e=l.y+r.y,g=l.x+l.width+r.x,u=l.y+l.height+r.y,m=s.verticalGridlines.scaledIntervals,g=this.round(g,m,h),t=this.round(t,m,h),m=s.horizontalGridlines.scaledIntervals,s=this.round(e,m,h),e=this.round(u,m,h),u=l.x+l.width,m=l.y+l.height;return c.snapped?this.diagram.snapSettings.constraints&Z.SnapConstraints.SnapToObject?d.x=c.offset:d.x=a.x-o.x:this.diagram.snapSettings.constraints&Z.SnapConstraints.SnapToVerticalLines?1<=Math.abs(r.x)&&(i?Math.abs(g-u)>Math.abs(t-l.x)?d.x+=t-l.x:d.x+=g-u:Math.abs(g-u)<Math.abs(t-l.x)?d.x+=g-u:d.x+=t-l.x):d.x=a.x-o.x,p.snapped?d.y=p.offset:this.diagram.snapSettings.constraints&Z.SnapConstraints.SnapToHorizontalLines?1<=Math.abs(r.y)&&(n?Math.abs(e-m)>Math.abs(s-l.y)?d.y+=s-l.y:d.y+=e-m:Math.abs(e-m)<Math.abs(s-l.y)?d.y+=e-m:d.y+=s-l.y):d.y=a.y-o.y,d},xu.prototype.round=function(t,e,i){1===i&&(i=Math.pow(2,Math.floor(Math.log(i)/Math.log(2))));for(var n=0,r=0,r=0;r<e.length;r++)n+=e[parseInt(r.toString(),10)];var o=t%(n/=i),a=Math.floor(Math.abs(t)/n)*n;if(a!==t)if(0<=t)for(r=0;r<e.length;r++){if(o<=e[parseInt(r.toString(),10)]/i)return a+(o<e[parseInt(r.toString(),10)]/(2*i)?0:e[parseInt(r.toString(),10)]/i);a+=e[parseInt(r.toString(),10)]/i,o-=e[parseInt(r.toString(),10)]/i}else for(a*=-1,r=e.length-1;0<=r;r--){if(Math.abs(o)<=e[parseInt(r.toString(),10)]/i)return a-(Math.abs(o)<e[parseInt(r.toString(),10)]/(2*i)?0:e[parseInt(r.toString(),10)]/i);a-=e[parseInt(r.toString(),10)]/i,o+=e[parseInt(r.toString(),10)]/i}return t},xu.prototype.snapObject=function(t,e,i,n,r,o,a){for(var s,h,d,l,c,p=null,g=this.diagram.scroller,u=this.diagram.snapSettings,m=[],f=[],y=[],v=[],b=up(this.getWrapperObject(e,t.nameTable)),S=t.scroller.currentZoom,w=-g.horizontalOffset,x=-g.verticalOffset,I=u.snapObjectDistance/S,u=new k(0,0,g.viewPortWidth,g.viewPortHeight),g=new k(w/S,b.y-I-5,u.width/S,b.height+2*I+10),C=new k(b.x-I-5,x/S,b.width+2*I+10,u.height/S),u=new k(w/S,x/S,u.width/S,u.height/S),P=this.findNodes(t.spatialSearch,e,C,u),A=t.nameTable,T=0;T<P.length;T++)l=P[parseInt(T.toString(),10)],this.canBeTarget(t,l)&&!(this.diagram.nameTable[l.id]instanceof W)&&this.canConsider(A,e,l)&&((c=l.bounds).height+c.y<o.y+b.y?y.push({obj:l,distance:Math.abs(b.y+o.y-c.y-c.height)}):c.y>b.y+o.y+b.height&&v.push({obj:l,distance:Math.abs(b.y+o.y+b.height-c.y)}),null==p||p>Math.abs(c.y-b.y-o.y))&&(Math.abs(c.x+c.width/2-(b.x+b.width/2+o.x))<=I?(h=this.createSnapObject(c,b,"centerX"),p=Math.abs(c.y-b.y)):Math.abs(c.x+c.width-(b.x+b.width+o.x))<=I?(h=this.createSnapObject(c,b,"right"),p=Math.abs(c.y-b.y)):Math.abs(c.x-(b.x+o.x))<=I?(h=this.createSnapObject(c,b,"left"),p=Math.abs(c.y-b.y)):Math.abs(c.x-(b.x+b.width+o.x))<=I?(h=this.createSnapObject(c,b,"rightLeft"),p=Math.abs(c.y-b.y)):Math.abs(c.x+c.width-(b.x+o.x))<=I&&(h=this.createSnapObject(c,b,"leftRight"),p=Math.abs(c.y-b.y)));for(var P=this.findNodes(t.spatialSearch,e,g,u),D=0;D<P.length;D++)l=P[parseInt(D.toString(),10)],this.canBeTarget(t,l)&&!(this.diagram.nameTable[l.id]instanceof W)&&this.canConsider(A,e,l)&&((c=l.bounds).x+c.width<b.x+o.x&&(m[m.length]={obj:l,distance:Math.abs(b.x+o.x-c.x-c.width)}),c.x>b.x+o.x+b.width&&(f[f.length]={obj:l,distance:Math.abs(b.x+o.x+b.width-c.x)}),null==s||s>Math.abs(c.x-b.x-o.x))&&(Math.abs(c.y+c.height/2-(b.y+b.height/2+o.y))<=I?(d=this.createSnapObject(c,b,"centerY"),s=Math.abs(c.x-b.x)):Math.abs(c.y-b.y-o.y)<=I?(d=this.createSnapObject(c,b,"top"),s=Math.abs(c.x-b.x)):Math.abs(c.y+c.height-(b.y+b.height+o.y))<=I?(d=this.createSnapObject(c,b,"bottom"),s=Math.abs(c.x-b.x)):Math.abs(c.y+c.height-b.y-o.y)<=I?(d=this.createSnapObject(c,b,"topBottom"),s=Math.abs(c.x-b.x)):Math.abs(c.y-(b.y+b.height+o.y))<=I&&(d=this.createSnapObject(c,b,"bottomTop"),s=Math.abs(c.x-b.x)));this.createGuidelines(t,h,d,i,n,r,a),n.snapped||this.createHSpacingLines(t,i,e,m,f,n,r,a,o,I),r.snapped||this.createVSpacingLines(t,i,e,y,v,n,r,a,o,I)},xu.prototype.snapConnectorEnd=function(t){var e=this.diagram.snapSettings,i=this.diagram.scroller.currentZoom;return e.constraints&Z.SnapConstraints.SnapToLines&&(t.x=this.round(t.x,e.verticalGridlines.scaledIntervals,i),t.y=this.round(t.y,e.horizontalGridlines.scaledIntervals,i)),t},xu.prototype.canBeTarget=function(t,e){return e=this.diagram.nameTable[e.id],!so(this.diagram,e,!1)},xu.prototype.snapSize=function(t,e,i,n,r,o,a,s){for(var h,d,l,c,p,g=this.diagram.snapSettings,u=this.diagram.scroller,m=up(a.wrapper),f=t.nameTable,y=[],v=[],b=t.scroller.currentZoom,S=-u.horizontalOffset,w=-u.verticalOffset,x=g.snapObjectDistance/b,g=new k(0,0,u.viewPortWidth,u.viewPortHeight),u=new k(S/b,(m.y-5)/b,g.width/b,(m.height+10)/b),I=new k((m.x-5)/b,w/b,(m.width+10)/b,g.height/b),g=new k(S/b,w/b,g.width/b,g.height/b),C=[],P=this.findNodes(t.spatialSearch,a,I,g,C),A=0;A<P.length;A++)z=P[parseInt(A.toString(),10)],this.canConsider(f,a,z)&&!(this.diagram.nameTable[z.id]instanceof W)&&(p=z.bounds,null==h||h>Math.abs(p.y-m.y))&&(e.left?Math.abs(m.x+r-p.x)<=x?(l=this.createSnapObject(p,m,"left"),h=Math.abs(p.y-m.y)):Math.abs(m.x+r-p.x-p.width)<=x&&(l=this.createSnapObject(p,m,"leftRight"),h=Math.abs(p.y-m.y)):e.right&&(Math.abs(m.x+r+m.width-p.x-p.width)<=x?(l=this.createSnapObject(p,m,"right"),h=Math.abs(p.y-m.y)):Math.abs(m.x+r+m.width-p.x)<=x&&(l=this.createSnapObject(p,m,"rightLeft"),h=Math.abs(p.y-m.y))));for(var P=this.findNodes(t.spatialSearch,a,u,g),T=0;T<P.length;T++){var D=P[parseInt(T.toString(),10)];this.canConsider(f,a,D)&&!(this.diagram.nameTable[D.id]instanceof W)&&(D=D.bounds,null==d||d>Math.abs(D.x-m.x))&&(i.top?Math.abs(m.y+o-D.y)<=x?(c=this.createSnapObject(D,m,"top"),d=Math.abs(D.x-m.x)):Math.abs(m.y+o-D.y-D.height)<=x&&(c=this.createSnapObject(D,m,"topBottom"),d=Math.abs(D.x-m.x)):i.bottom&&(Math.abs(m.y+m.height+o-D.y-D.height)<=x?(c=this.createSnapObject(D,m,"bottom"),d=Math.abs(D.x-m.x)):Math.abs(m.y+m.height+o-D.y)<=x&&(c=this.createSnapObject(D,m,"bottomTop"),d=Math.abs(D.x-m.x))))}for(A=0;A<C.length;A++){var O,M,E,L,z=C[parseInt(A.toString(),10)];this.canConsider(f,a,z)&&(O=z.bounds,M=e.left?-r:r,E=void 0,(L=Math.abs(m.width+M-O.width))<=x&&(E=e.left?-O.width+m.width:O.width-m.width,y[y.length]={source:z,difference:L,offset:E}),M=i.top?-o:o,(L=Math.abs(m.height+M-O.height))<=x)&&(E=i.top?-O.height+m.height:O.height-m.height,v[v.length]={source:z,difference:L,offset:E})}t.getTool||this.createGuidelines(t,l,c,n,e,i,s),!e.snapped&&0<y.length&&(e.left||e.right)&&this.addSameWidthLines(t,n,y,e,s,a),!i.snapped&&0<v.length&&(i.top||i.bottom)&&this.addSameHeightLines(t,n,v,i,s,a)},xu.prototype.snapTop=function(t,e,i,n,r,o,a,s){var h,d=r,l=(e.top=!0,t.left=t.right=!1,this.diagram.scroller.currentZoom);return this.diagram.snapSettings.constraints&Z.SnapConstraints.SnapToObject&&!o.rotateAngle&&(h=s.y-s.height*o.pivot.y+r-(o.offsetY-o.height*o.pivot.y),this.snapSize(this.diagram,t,e,i,n,h,this.diagram.selectedItems,a)),e.snapped?d=r-h+e.offset:this.diagram.snapSettings.constraints&Z.SnapConstraints.SnapToHorizontalLines&&(t=s.y-s.height*o.pivot.y,d=this.round(t+r,this.diagram.snapSettings.horizontalGridlines.scaledIntervals,l)-t),d},xu.prototype.snapRight=function(t,e,i,n,r,o,a,s){var h,d=n,l=(t.right=!0,e.top=e.bottom=!1,this.diagram.scroller.currentZoom);return this.diagram.snapSettings.constraints&Z.SnapConstraints.SnapToObject&&!o.rotateAngle&&(h=s.x+s.width*(1-o.pivot.x)+n-(o.offsetX+o.width*(1-o.pivot.x)),this.snapSize(this.diagram,t,e,i,h,r,this.diagram.selectedItems,a)),t.snapped?d=n-h+t.offset:this.diagram.snapSettings.constraints&Z.SnapConstraints.SnapToVerticalLines&&(e=s.x+s.width*(1-o.pivot.x),d=this.round(e+n,this.diagram.snapSettings.verticalGridlines.scaledIntervals,l)-e),d},xu.prototype.snapLeft=function(t,e,i,n,r,o,a,s){var h=n,d=0,l=(t.left=!0,e.top=e.bottom=!1,this.diagram.scroller.currentZoom);return this.diagram.snapSettings.constraints&Z.SnapConstraints.SnapToObject&&!o.rotateAngle&&(d=s.x-s.width*o.pivot.x+n-(o.offsetX-o.width*o.pivot.x),this.snapSize(this.diagram,t,e,i,d,r,this.diagram.selectedItems,a)),t.snapped?h=n-d+t.offset:this.diagram.snapSettings.constraints&Z.SnapConstraints.SnapToVerticalLines&&(e=s.x-s.width*o.pivot.x,h=this.round(e+n,this.diagram.snapSettings.horizontalGridlines.scaledIntervals,l)-e),h},xu.prototype.snapBottom=function(t,e,i,n,r,o,a,s){var h=r,d=(e.bottom=!0,t.left=t.right=!1,this.diagram.scroller.currentZoom),l=0;this.diagram.snapSettings.constraints&Z.SnapConstraints.SnapToObject&&!o.rotateAngle&&(l=s.y+s.height*(1-o.pivot.y)+r-(o.offsetY+o.height*(1-o.pivot.y)),this.snapSize(this.diagram,t,e,i,n,l,this.diagram.selectedItems,a)),o instanceof H||o instanceof an?up(o):up(o.wrapper);return e.snapped?h=r-l+e.offset:this.diagram.snapSettings.constraints&Z.SnapConstraints.SnapToHorizontalLines&&(t=s.y+s.height*(1-o.pivot.y),h=this.round(t+r,this.diagram.snapSettings.horizontalGridlines.scaledIntervals,d)-t),h},xu.prototype.createGuidelines=function(t,e,i,n,r,o,a){return e&&(r.offset=e.offsetX,r.snapped=!0,a||(e.type,this.renderAlignmentLines(e.start,e.end,n,t.scroller.transform))),i&&(o.offset=i.offsetY,o.snapped=!0,a||(i.type,this.renderAlignmentLines(i.start,i.end,n,t.scroller.transform))),n},xu.prototype.renderAlignmentLines=function(t,e,i,n){t={x:(t.x+n.tx)*n.scale,y:(t.y+n.ty)*n.scale},e={x:(e.x+n.tx)*n.scale,y:(e.y+n.ty)*n.scale};var n={stroke:this.setSnapLineColor(),strokeWidth:1,startPoint:{x:t.x,y:t.y},endPoint:{x:e.x,y:e.y},fill:this.setSnapLineColor(),dashArray:"",width:1,x:0,y:0,height:0,angle:0,pivotX:0,pivotY:0,visible:!0,opacity:1,id:q()},r=0;for(this.line.push(n),r=0;r<this.line.length;r++)this.diagram.diagramRenderer.drawLine(i,this.line.pop())},xu.prototype.createHSpacingLines=function(t,e,i,n,r,o,a,s,h,d){var l,c,p,g,u,m=0,f=(this.sortByDistance(n,"distance",!0),this.sortByDistance(r,"distance",!0),[]),y=t.selectedObject.helperObject?up(t.selectedObject.helperObject.wrapper):up(i.wrapper);0<n.length&&(f[f.length]=n[0],m=(l=n[0].obj.bounds).y,1<n.length&&(c=n[1].obj.bounds,p=l.x-c.x-c.width,Math.abs(p-n[0].distance)<=d)?m=this.findEquallySpacedNodesAtLeft(n,p,m,f):p=n[0].distance),this.sortByDistance(f,"distance"),f[f.length]={obj:i,distance:0},m=y.y<m||!m?y.y:m,0<r.length&&(i=void 0,m=(g=r[0].obj.bounds).y<m?g.y:m,1<r.length&&(i=(c=r[1].obj.bounds).x-g.x-g.width),0<n.length?Math.abs(r[0].distance-n[0].distance)<=d?(u=Math.abs(r[0].distance-n[0].distance)/2,r[0].distance<n[0].distance?p-=u:p+=u,f[f.length]=r[0]):1===n.length&&(l=void 0,f.splice(0,1),f[f.length]=r[0],p=i):(p=i,f[f.length]=r[0]),1<r.length)&&g.x+g.width<c.x&&(m=this.findEquallySpacedNodesAtRight(r,i,m,f,d)),2<f.length&&(this.addHSpacingLines(t,e,f,s,m),u=0,s&&(u=h.x),l?o.offset=p-Math.abs(y.x+u-l.x-l.width)+u:g&&(o.offset=Math.abs(y.x+y.width+u-g.x)-p+u),o.snapped=!0)},xu.prototype.createVSpacingLines=function(t,e,i,n,r,o,a,s,h,d){var l,c,p,g,u,m=0,f=(this.sortByDistance(n,"distance",!0),this.sortByDistance(r,"distance",!0),[]),y=up(this.getWrapperObject(i,t.nameTable));0<n.length&&(f[f.length]=n[0],m=(l=n[0].obj.bounds).x+l.width,1<n.length&&(c=n[1].obj.bounds,p=l.y-c.y-c.height,Math.abs(p-n[0].distance)<=d)?m=this.findEquallySpacedNodesAtTop(n,p,m,f):p=n[0].distance),this.sortByDistance(f,"distance"),f[f.length]={obj:i,distance:0},m=y.x+y.width>m||!m?y.x+y.width:m,0<r.length&&(m=(u=r[0].obj.bounds).x+u.width>m?u.x+u.width:m,1<r.length&&(g=(c=r[1].obj.bounds).y-u.y-u.height),0<n.length?Math.abs(r[0].distance-n[0].distance)<=d?(i=Math.abs(r[0].distance-n[0].distance)/2,r[0].distance<n[0].distance?p-=i:p+=i,f[f.length]=r[0]):1===n.length&&(l=void 0,f.splice(0,1),f[f.length]=r[0],p=g):(p=g,f[f.length]=r[0]),1<r.length)&&c.y>u.y+u.height&&(m=this.findEquallySpacedNodesAtBottom(r,g,m,f,d)),2<f.length&&(this.addVSpacingLines(t,e,f,s,m),i=0,s&&(i=h.y),l?a.offset=p-Math.abs(y.y+i-l.y-l.height)+i:u&&(a.offset=Math.abs(y.y+y.height+i-u.y)-p+i),a.snapped=!0)},xu.prototype.addHSpacingLines=function(t,e,i,n,r){var o;if(!n)for(o=0;o<i.length-1;o++){var a=i[parseInt(o.toString(),10)].obj instanceof B?up(i[parseInt(o.toString(),10)].obj.wrapper):i[parseInt(o.toString(),10)].obj.bounds,s=i[o+1].obj instanceof B?up(i[o+1].obj.wrapper):i[o+1].obj.bounds,a={x:a.x+a.width,y:r-15},s={x:s.x,y:r-15};this.renderSpacingLines(a,s,e,this.getAdornerLayerSvg(),t.scroller.transform)}},xu.prototype.addVSpacingLines=function(t,e,i,n,r){if(!n)for(var o=0;o<i.length-1;o++){var a=i[parseInt(o.toString(),10)].obj instanceof B?up(i[parseInt(o.toString(),10)].obj.wrapper):i[parseInt(o.toString(),10)].obj.bounds,s=i[o+1].obj instanceof B?up(i[o+1].obj.wrapper):i[o+1].obj.bounds,a={x:r+15,y:a.y+a.height},s={x:r+15,y:s.y};this.renderSpacingLines(a,s,e,this.getAdornerLayerSvg(),t.scroller.transform)}},xu.prototype.addSameWidthLines=function(t,e,i,n,r,o){this.sortByDistance(i,"offset");var a,s,h,d=up(o.wrapper),o=i[0],l=o.source.bounds,c=[];for(c.push(i[0]),h=1;h<i.length;h++)i[parseInt(h.toString(),10)].source.bounds.width===l.width&&c.push(i[parseInt(h.toString(),10)]);if(!r)for(a={x:d.x+o.offset,y:d.y-15},s={x:d.x+d.width+o.offset,y:d.y-15},this.renderSpacingLines(a,s,e,this.getAdornerLayerSvg(),t.scroller.transform),h=0;h<c.length;h++)a={x:(d=c[parseInt(h.toString(),10)].source.bounds).x,y:d.y-15},s={x:d.x+d.width,y:d.y-15},this.renderSpacingLines(a,s,e,this.getAdornerLayerSvg(),t.scroller.transform);n.offset=o.offset,n.snapped=!0},xu.prototype.addSameHeightLines=function(t,e,i,n,r,o){this.sortByDistance(i,"offset");var a,s,h,d=up(o.wrapper),o=i[0],l=o.source.bounds,c=[];for(c.push(i[0]),h=0;h<i.length;h++)i[parseInt(h.toString(),10)].source.bounds.height===l.height&&c.push(i[parseInt(h.toString(),10)]);if(!r)for(a={x:d.x+d.width+15,y:d.y+o.offset},s={x:d.x+d.width+15,y:d.y+o.offset+d.height},this.renderSpacingLines(a,s,e,this.getAdornerLayerSvg(),t.scroller.transform),h=0;h<c.length;h++)a={x:(d=c[parseInt(h.toString(),10)].source.bounds).x+d.width+15,y:d.y},s={x:d.x+d.width+15,y:d.y+d.height},this.renderSpacingLines(a,s,e,this.getAdornerLayerSvg(),t.scroller.transform);n.offset=o.offset,n.snapped=!0},xu.prototype.renderSpacingLines=function(t,e,i,n,r){var o,a,s=new P,h={};t={x:(t.x+r.tx)*r.scale,y:(t.y+r.ty)*r.scale},e={x:(e.x+r.tx)*r.scale,y:(e.y+r.ty)*r.scale},a=t.x===e.x?(o="M"+(t.x-5)+" "+(t.y+5)+"L"+t.x+" "+t.y+"L"+(t.x+5)+" "+(t.y+5)+"zM"+(e.x-5)+" "+(e.y-5)+" L"+e.x+" "+e.y+" L"+(e.x+5)+" "+(e.y-5)+"z",a={startPoint:{x:t.x-8,y:t.y-1},endPoint:{x:t.x+8,y:t.y-1},stroke:this.setSnapLineColor(),strokeWidth:1,fill:this.setSnapLineColor(),dashArray:"",width:1,x:0,y:0,height:0,angle:0,pivotX:0,pivotY:0,visible:!0,opacity:1,id:q()},s.data=o,h.data=s.data,h.angle=0,h.pivotX=0,h.pivotY=0,h.x=0,h.y=0,h.height=0,h.width=1,h.id=q(),this.diagram.diagramRenderer.drawPath(i,h),this.line.push(a),this.diagram.diagramRenderer.drawLine(i,this.line.pop()),{startPoint:{x:e.x-8,y:e.y+1},endPoint:{x:e.x+8,y:e.y+1},stroke:this.setSnapLineColor(),strokeWidth:1,fill:this.setSnapLineColor(),dashArray:"",width:1,x:0,y:0,height:0,angle:0,pivotX:0,pivotY:0,visible:!0,opacity:1,id:this.getAdornerLayerSvg().id+"spacing"}):(o="M"+(t.x+5)+" "+(t.y+5)+" L"+t.x+" "+t.y+" L"+(t.x+5)+" "+(t.y-5)+"zM"+(e.x-5)+" "+(e.y-5)+" L"+e.x+" "+e.y+" L"+(e.x-5)+" "+(e.y+5)+"z",s.data=o,h.data=o,h.angle=0,h.pivotX=0,h.pivotY=0,h.x=0,h.y=0,h.height=0,h.width=1,h.id=q(),this.diagram.diagramRenderer.drawPath(i,h),a={visible:!0,opacity:1,id:q(),startPoint:{x:t.x-1,y:t.y-8},endPoint:{x:t.x-1,y:t.y+8},stroke:this.setSnapLineColor(),strokeWidth:1,fill:this.setSnapLineColor(),dashArray:"0",width:1,x:0,y:0,height:0,angle:0,pivotX:0,pivotY:0},this.line.push(a),this.diagram.diagramRenderer.drawLine(i,this.line.pop()),{width:1,x:0,y:0,height:0,angle:0,pivotX:0,pivotY:0,visible:!0,opacity:1,id:q(),startPoint:{x:e.x+1,y:e.y-8},endPoint:{x:e.x+1,y:e.y+8},stroke:this.setSnapLineColor(),strokeWidth:1,fill:this.setSnapLineColor(),dashArray:"0"}),this.line.push(a),this.diagram.diagramRenderer.drawLine(i,this.line.pop()),a={startPoint:{x:t.x,y:t.y},endPoint:{x:e.x,y:e.y},stroke:this.setSnapLineColor(),strokeWidth:1,fill:this.setSnapLineColor(),dashArray:"0",width:1,x:0,y:0,height:0,angle:0,pivotX:0,pivotY:0,visible:!0,opacity:1,id:q()},this.line.push(a),this.diagram.diagramRenderer.drawLine(i,this.line.pop())},xu.prototype.createSnapObject=function(t,e,i){var n;switch(i){case"left":n={start:{x:t.x,y:Math.min(t.y,e.y)},end:{x:t.x,y:Math.max(t.y+t.height,e.y+e.height)},offsetX:t.x-e.x,offsetY:0,type:"sideAlign"};break;case"right":n={type:"sideAlign",start:{x:t.x+t.width,y:Math.min(t.y,e.y)},offsetX:t.x+t.width-e.x-e.width,offsetY:0,end:{x:t.x+t.width,y:Math.max(t.y+t.height,e.y+e.height)}};break;case"top":n={offsetY:t.y-e.y,offsetX:0,type:"sideAlign",start:{x:Math.min(t.x,e.x),y:t.y},end:{x:Math.max(t.x+t.width,e.x+e.width),y:t.y}};break;case"bottom":n={type:"sideAlign",offsetY:t.y+t.height-e.y-e.height,offsetX:0,end:{x:Math.max(t.x+t.width,e.x+e.width),y:t.y+t.height},start:{x:Math.min(t.x,e.x),y:t.y+t.height}};break;case"topBottom":n={start:{x:Math.min(t.x,e.x),y:t.y+t.height},end:{x:Math.max(t.x+t.width,e.x+e.width),y:t.y+t.height},offsetY:t.y+t.height-e.y,offsetX:0,type:"sideAlign"};break;case"bottomTop":n={start:{x:Math.min(t.x,e.x),y:t.y},end:{x:Math.max(t.x+t.width,e.x+e.width),y:t.y},offsetY:t.y-e.y-e.height,offsetX:0,type:"sideAlign"};break;case"leftRight":n={start:{x:t.x+t.width,y:Math.min(t.y,e.y)},end:{x:t.x+t.width,y:Math.max(t.y+t.height,e.y+e.height)},offsetX:t.x+t.width-e.x,offsetY:0,type:"sideAlign"};break;case"rightLeft":n={start:{x:t.x,y:Math.min(t.y,e.y)},end:{x:t.x,y:Math.max(t.y+t.height,e.y+e.height)},offsetX:t.x-e.x-e.width,offsetY:0,type:"sideAlign"};break;case"centerX":n={start:{x:t.x+t.width/2,y:Math.min(t.y,e.y)},end:{x:t.x+t.width/2,y:Math.max(t.y+t.height,e.y+e.height)},offsetX:t.x+t.width/2-(e.x+e.width/2),offsetY:0,type:"centerAlign"};break;case"centerY":n={start:{x:Math.min(t.x,e.x),y:t.y+t.height/2},end:{x:Math.max(t.x+t.width,e.x+e.width),y:t.y+t.height/2},offsetY:t.y+t.height/2-(e.y+e.height/2),offsetX:0,type:"centerAlign"}}return n},xu.prototype.snapAngle=function(t,e){var i=this.diagram.snapSettings.snapAngle,n=e%(i||0);return i/2<=n?e+i-n:e-n},xu.prototype.canConsider=function(t,e,i){return!this.diagram.selectedItems.nodes.length||this.diagram.selectedItems.nodes[0].id!==i.id},xu.prototype.findNodes=function(t,e,i,n,r){for(var o,a,s=[],h=t.findQuads(r?n:i),d=0;d<h.length;d++){var l=h[parseInt(d.toString(),10)];if(0<l.objects.length)for(var c=0;c<l.objects.length;c++)o=l.objects[parseInt(c.toString(),10)],this.diagram.nameTable[o.id]instanceof W||!o.visible||"SwimLane"===this.diagram.nameTable[o.id].shape.type||this.diagram.nameTable[o.id].isLane||this.diagram.nameTable[o.id].isPhase||this.diagram.nameTable[o.id].isHeader||"helper"===o.id||(a=up(o),-1===s.indexOf(o)&&this.intersectsRect(i,a)&&s.push(o),r&&r.indexOf(o)&&this.intersectsRect(n,a)&&r.push(o))}return s},xu.prototype.intersectsRect=function(t,e){return e.x<t.x+t.width&&t.x<e.x+e.width&&e.y<t.y+t.height&&t.y<e.y+e.height},xu.prototype.getAdornerLayerSvg=function(){return this.diagram.diagramRenderer.adornerSvgLayer},xu.prototype.removeGuidelines=function(t){var e=this.getAdornerLayerSvg().getElementById("_SnappingLines"),i=this.getAdornerLayerSvg().getElementById("pivotLine");e&&e.parentNode.removeChild(e),i&&i.parentNode.removeChild(i)},xu.prototype.sortByDistance=function(t,e,i){var n,r,o;if(i)for(n=0;n<t.length;n++)for(r=n+1;r<t.length;r++)t[parseInt(n.toString(),10)][""+e]>t[parseInt(r.toString(),10)][""+e]&&(o=t[parseInt(n.toString(),10)],t[parseInt(n.toString(),10)]=t[parseInt(r.toString(),10)],t[parseInt(r.toString(),10)]=o);else for(n=0;n<t.length;n++)for(r=n+1;r<t.length;r++)t[parseInt(n.toString(),10)][""+e]<t[parseInt(r.toString(),10)][""+e]&&(o=t[parseInt(n.toString(),10)],t[parseInt(n.toString(),10)]=t[parseInt(r.toString(),10)],t[parseInt(r.toString(),10)]=o)},xu.prototype.findEquallySpacedNodesAtLeft=function(t,e,i,n){for(var r,o,a=1;a<t.length&&(o=t[a-1].obj.bounds,r=t[parseInt(a.toString(),10)].obj.bounds,o=o.x-r.x-r.width,Math.abs(o-e)<=1);a++)n[n.length]=t[parseInt(a.toString(),10)],r.y<i&&(i=r.y);return i},xu.prototype.findEquallySpacedNodesAtRight=function(t,e,i,n,r){var o,a,s=t[0].distance;if(Math.abs(e-s)<=r)for(var h=0;h<t.length-1&&(o=t[parseInt(h.toString(),10)].obj,a=t[h+1].obj.bounds,o=o.bounds,a=a.x-o.x-o.width,Math.abs(a-e)<=1);h++)n[n.length]=t[h+1],o.y<i&&(i=o.y);return i},xu.prototype.findEquallySpacedNodesAtTop=function(t,e,i,n){for(var r,o,a=1;a<t.length&&(o=t[a-1].obj.bounds,r=t[parseInt(a.toString(),10)].obj.bounds,o=o.y-r.y-r.height,Math.abs(o-e)<=1);a++)n[n.length]=t[parseInt(a.toString(),10)],r.x+r.width>i&&(i=r.x+r.width);return i},xu.prototype.findEquallySpacedNodesAtBottom=function(t,e,i,n,r){var o,a,s=t[0].distance;if(Math.abs(e-s)<=r)for(var h=0;h<t.length-1&&(o=t[parseInt(h.toString(),10)].obj,a=t[h+1].obj.bounds,o=o.bounds,a=a.y-o.y-o.height,Math.abs(a-e)<=1);h++)n[n.length]=t[h+1],o.x+o.width>i&&(i=o.x+o.width);return i},xu.prototype.getLayer=function(){var t;return this.diagram.snapSettings.constraints&Z.SnapConstraints.SnapToObject&&((t=document.createElementNS("http://www.w3.org/2000/svg","g")).setAttribute("id","_SnappingLines"),t.setAttribute("shapeRendering","crispEdges"),this.getAdornerLayerSvg().appendChild(t)),t},xu.prototype.destroy=function(){},xu.prototype.getModuleName=function(){return"Snapping"};n=xu;function xu(t){this.line=[],this.diagram=t}m.prototype.initHistory=function(t){t.historyManager={canRedo:!1,canUndo:!1,currentEntry:null,push:t.addHistoryEntry.bind(t),undo:Function,redo:Function,startGroupAction:t.startGroupAction.bind(t),endGroupAction:t.endGroupAction.bind(t),canLog:null,undoStack:[],redoStack:[],stackLimit:t.historyManager?t.historyManager.stackLimit:void 0}},m.prototype.addHistoryEntry=function(t,e){if("EndGroup"===t.type&&"StartGroup"===e.historyManager.currentEntry.type)return e.historyManager.currentEntry.previous&&(e.historyManager.currentEntry.previous.next=void 0),e.historyManager.currentEntry=e.historyManager.currentEntry.previous,e.historyManager.currentEntry||(e.historyManager.canUndo=!1),!1;var i=null;if(e.historyManager.canLog&&!0===e.historyManager.canLog(t).cancel)return!1;return e.historyManager&&e.historyManager.canUndo&&e.historyManager.currentEntry&&((i=e.historyManager.currentEntry).next?i.previous&&(i.next.previous=null,(i.next=t).previous=i):(i.next=t).previous=i),e.historyManager.currentEntry=t,e.historyManager.stackLimit&&("StartGroup"!==t.type&&"EndGroup"!==t.type||(i="EndGroup"===t.type,this.setEntryLimit(i)),this.hasGroup||0!==this.groupCount||(this.historyCount<e.historyManager.stackLimit?this.historyCount++:this.applyLimit(e.historyManager.currentEntry,e.historyManager.stackLimit,e))),this.getHistoryList(e),e.historyManager.canUndo=!0,!(e.historyManager.canRedo=!1)},m.prototype.applyLimit=function(t,e,i,n){var r;t&&t.previous&&("StartGroup"!==t.type&&"EndGroup"!==t.type||(r="StartGroup"===t.type,this.setEntryLimit(r)),this.hasGroup||0!==this.groupCount||e--,0===e?(n&&this.limitHistoryStack(t.previous,i),i.historyManager.stackLimit<this.historyCount&&(this.historyCount=i.historyManager.stackLimit),delete t.previous):t.previous&&this.applyLimit(t.previous,e,i,n)),this.groupCount=0},m.prototype.clearHistory=function(t){var e=t.historyManager;e.currentEntry=void 0,e.canUndo=!1,e.canRedo=!1,this.historyCount=0,this.groupCount=0,t.historyManager.undoStack=[],t.historyManager.redoStack=[]},m.prototype.setEntryLimit=function(t){t?this.groupCount--:this.groupCount++,this.hasGroup=t&&!t},m.prototype.limitHistoryStack=function(t,e){"StartGroup"!==t.type&&"EndGroup"!==t.type&&(this.removeFromStack(e.historyManager.undoStack,t),this.removeFromStack(e.historyManager.redoStack,t)),t.previous&&this.limitHistoryStack(t.previous,e)},m.prototype.removeFromStack=function(t,e){if(t.length)for(var i=0;i<=t.length;i++)if(t[parseInt(i.toString(),10)].undoObject===e.undoObject&&t[parseInt(i.toString(),10)].redoObject===e.redoObject){t.splice(i,1);break}},m.prototype.undo=function(t){var e=this.getUndoEntry(t),i=0;e&&("Internal"===e.category?("EndGroup"===e.type?(i++,this.groupUndo=!0):this.undoEntry(e,t),this.groupUndo&&(this.undoGroupAction(e,t,i),this.groupUndo=!1)):(N.isBlazor()||t.historyManager.undo(e),i={entryType:"undo",oldValue:e.undoObject,newValue:e.redoObject},t.triggerEvent(Z.DiagramEvent.historyStateChange,i)))},m.prototype.getHistoryList=function(t){var e,i,n=[],r=[],o=t.historyManager.currentEntry,o=t.historyManager.currentEntry;for(t.historyManager.canUndo||0===t.historyManager.undoStack.length?this.getHistroyObject(n,o):this.getHistroyObject(r,o);o&&o.previous;)e=o.previous,this.getHistroyObject(n,e),o=o.previous;for(o=t.historyManager.currentEntry;o&&o.next;)i=o.next,this.getHistroyObject(r,i),o=o.next;t.historyManager.undoStack=n,t.historyManager.redoStack=r},m.prototype.getHistroyObject=function(t,e){e&&"StartGroup"!==e.type&&"EndGroup"!==e.type&&t.push({redoObject:e.redoObject||null,undoObject:e.undoObject||null,type:e.type||null,category:e.category||null})},m.prototype.undoGroupAction=function(t,e,i){for(;0!==i;)this.undoEntry(t,e),"StartGroup"===(t=this.getUndoEntry(e)).type?i--:"EndGroup"===t.type&&i++},m.prototype.undoEntry=function(t,e){var i,n,r,o;switch("PropertyChanged"!==t.type&&"CollectionChanged"!==t.type&&"LabelCollectionChanged"!==t.type&&(o=i=t.undoObject||t.previous.undoObject),"StartGroup"!==t.type&&"EndGroup"!==t.type&&0<e.historyManager.undoStack.length&&(r=e.historyManager.undoStack.splice(0,1),e.historyManager.redoStack.splice(0,0,r[0]),o=t.undoObject),e.protectPropertyChange(!0),e.diagramActions|=Z.DiagramAction.UndoRedo,t.type){case"PositionChanged":case"Align":case"Distribute":this.recordPositionChanged(i,e);break;case"SizeChanged":case"Sizing":this.recordSizeChanged(i,e,t);break;case"RotationChanged":this.recordRotationChanged(i,e,t,"undo");break;case"ConnectionChanged":this.recordConnectionChanged(i,e);break;case"PropertyChanged":this.recordPropertyChanged(t,e,!1);break;case"CollectionChanged":t&&t.next&&"AddChildToGroupNode"===t.next.type&&"Insert"===t.next.changeType&&(n=e.getObject(t.next.undoObject.id),e.insertValue(Q(n),!0)),t.isUndo=!0,this.recordCollectionChanged(t,e),t.isUndo=!1,t&&t.next&&"AddChildToGroupNode"===t.next.type&&"Insert"===t.next.changeType&&((n=e.getObject(t.next.undoObject.id)).wrapper.measure(new j),n.wrapper.arrange(n.wrapper.desiredSize),e.updateDiagramObject(n));break;case"LabelCollectionChanged":t.isUndo=!0,this.recordLabelCollectionChanged(t,e),t.isUndo=!1;break;case"PortCollectionChanged":t.isUndo=!0,this.recordPortCollectionChanged(t,e),t.isUndo=!1;break;case"Group":this.unGroup(t,e);break;case"UnGroup":this.group(t,e);break;case"SegmentChanged":this.recordSegmentChanged(i,e);break;case"PortPositionChanged":this.recordPortChanged(t,e,!1);break;case"AnnotationPropertyChanged":this.recordAnnotationChanged(t,e,!1);break;case"ChildCollectionChanged":this.recordChildCollectionChanged(t,e,!1);break;case"StackChildPositionChanged":this.recordStackPositionChanged(t,e,!1);break;case"RowHeightChanged":this.recordGridSizeChanged(t,e,!1,!0);break;case"ColumnWidthChanged":this.recordGridSizeChanged(t,e,!1,!1);break;case"LanePositionChanged":this.recordLanePositionChanged(t,e,!1);break;case"LaneCollectionChanged":case"PhaseCollectionChanged":t.isUndo=!0,this.recordLaneOrPhaseCollectionChanged(t,e,!1),t.isUndo=!1;break;case"SendToBack":case"SendForward":case"SendBackward":case"BringToFront":this.recordOrderCommandChanged(t,e,!1);break;case"AddChildToGroupNode":this.recordAddChildToGroupNode(t,e,!1);break;case"RemoveChildFromGroupNode":this.recordRemoveChildFromGroupNode(t,e,!1);break;case"ExternalEntry":e.historyManager.undo(t)}e.diagramActions&=~Z.DiagramAction.UndoRedo,e.protectPropertyChange(!1),e.historyChangeTrigger(t,"Undo"),o&&(r=this.checkNodeObject(o,e))&&(o=Dp(e.updateSelection))&&o(r,e)},m.prototype.checkNodeObject=function(t,e){if(t.id)h=e.nameTable[t.id];else if(t.nodes&&0<t.nodes.length||t.connectors&&0<t.connectors.length)for(var i=0,n=0<t.nodes.length?t.nodes:t.connectors;i<n.length;i++)h=n[i],h=e.nameTable[h.id];else{var r=t.nodes||t.connectors;if(r)for(var o=0,a=Object.keys(r);o<a.length;o++)var s=a[o],s=Number(s),h=(t.nodes?e.nodes:e.connectors)[parseInt(s.toString(),10)]}return h},m.prototype.group=function(t,e){e.add(t.undoObject)},m.prototype.unGroup=function(t,e){t.redoObject=Q(t.undoObject);t=t.undoObject;e.commandHandler.unGroup(t)},m.prototype.ignoreProperty=function(t){return"zIndex"===t||"wrapper"===t||"parentObj"===t||"controlParent"===t},m.prototype.getProperty=function(t,e){for(var i=0,n=Object.keys(e);i<n.length;i++){var r=n[i];!t||this.ignoreProperty(r)||(e[""+r]instanceof Object?this.getProperty(t[""+r],e[""+r]):t[""+r]=e[""+r])}},m.prototype.recordLaneOrPhaseCollectionChanged=function(t,e,i){var n,r=t.redoObject,o=t.undoObject,t=t.isUndo?"Insert"===t.changeType?"Remove":"Insert":t.changeType;"Remove"===t?e.remove(r):r.isPhase?(n=e.nameTable[r.parentId],e.addPhases(n,[o])):(t=xr(n=e.nameTable[r.parentId],r),e.addLanes(n,[o],t)),e.clearSelection()},m.prototype.recordAnnotationChanged=function(t,e,i){var i=i?t.redoObject:t.undoObject,n=(e.canEnableBlazorObject&&(n=Q(e.nameTable[i.id]),e.insertValue(n,n instanceof _)),Kh(i,t.objectId)),r=e.commandHandler.getAnnotationChanges(e.nameTable[i.id],n),i=e.nameTable[i.id],t=Kh(i,t.objectId);t.offset=n.offset,t.margin=n.margin,t.width=n.width,t.height=n.height,t.rotateAngle=n.rotateAngle,t.margin=n.margin,i instanceof _?e.nodePropertyChange(i,{},r):e.connectorPropertyChange(i,{},r)},m.prototype.recordChildCollectionChanged=function(t,e,i){var n=i?t.redoObject:t.undoObject,r=e.nameTable[n.parentId],o=e.nameTable[n.id];r?qr(e,r,o,!i,"AddNodeToLane"===t.historyAction,i):(o.parentId&&(r=e.nameTable[o.parentId])&&(this.removeChildFromLane(e,r,o),r.children.splice(r.children.indexOf(o.id),1),r.wrapper.children.splice(r.wrapper.children.indexOf(o.wrapper),1)),n.parentId&&""!==n.parentId&&((r=e.nameTable[n.parentId]).children.push(n.id),r.wrapper.children.push(o.wrapper)),o.parentId=n.parentId,e.removeElements(o),e.updateDiagramObject(o))},m.prototype.removeChildFromLane=function(t,e,i){t=t.nameTable[e.parentId];if(t&&t.shape&&0<t.shape.lanes.length){var n="Horizontal"===t.shape.orientation,r=0,n=(0<t.shape.phases.length&&0<t.shape.phaseSize||(r=1),n?t.shape.hasHeader?e.rowIndex-(2-r):e.rowIndex-(1-r):e.columnIndex-(1-r)),o=t.shape.lanes[parseInt(n.toString(),10)];if(o&&o.children&&0<o.children.length)for(var a=o.children.length-1;0<=a;a--)o.children[parseInt(a.toString(),10)].id===i.id&&o.children.splice(a,1)}},m.prototype.recordStackPositionChanged=function(t,e,i){var n,t=i?t.redoObject:t.undoObject;t.source&&(n=e.nameTable[t.source.parentId])&&(t.target?(n.wrapper.children.splice(t.targetIndex,1),n.wrapper.children.splice(t.sourceIndex,0,t.source.wrapper)):void 0!==t.sourceIndex?(e.nameTable[t.source.id]||e.add(t.source),n.wrapper.children.splice(t.sourceIndex,0,e.nameTable[t.source.id].wrapper),e.nameTable[t.source.id].parentId=n.id):(n.wrapper.children.splice(n.wrapper.children.indexOf(e.nameTable[t.source.id].wrapper),1),e.nameTable[t.source.id].parentId=""),i&&"UmlClassifier"===n.shape.type&&e.remove(t.source),n.wrapper.measure(new j),n.wrapper.arrange(n.wrapper.desiredSize),e.updateDiagramObject(n),e.updateSelector())},m.prototype.recordGridSizeChanged=function(t,e,i,n){var r,o,a,s,h,d,l=i?t.redoObject:t.undoObject,i=i?t.undoObject:t.redoObject;l.parentId&&(t=e.nameTable[l.parentId],r=e.nameTable[l.id],o=t.wrapper.bounds.x,a=t.wrapper.bounds.y,"SwimLane"===t.shape.type)&&(s=t.wrapper.children[0],h=t.shape.padding,d=!1,e.diagramActions&Z.DiagramAction.UndoRedo&&(d=!0),wr(e,i,t,l),n?(s.updateRowHeight(l.rowIndex,l.wrapper.actualSize.height,!0,h,d),t.height=t.wrapper.height=s.height):(s.updateColumnWidth(l.columnIndex,l.wrapper.actualSize.width,!0,h,d),t.width=t.wrapper.width=s.width,l.isPhase&&(r.maxWidth=r.wrapper.maxWidth=l.wrapper.actualSize.width)),pr(t),i=o-t.wrapper.bounds.x,n=a-t.wrapper.bounds.y,e.drag(t,i,n),e.clearSelection(),e.updateDiagramObject(t))},m.prototype.recordLanePositionChanged=function(t,e,i){i=i?t.redoObject:t.undoObject;i.source&&(t=e.nameTable[i.source.parentId])&&"SwimLane"===t.shape.type&&(br(e,i.target,i.source),e.clearSelection())},m.prototype.recordPortChanged=function(t,e,i){var i=(i?t.redoObject:t.undoObject).nodes[0],n=(e.canEnableBlazorObject&&(n=Q(e.nameTable[i.id]),e.insertValue(n,!0)),qh(i,t.objectId)),r=e.commandHandler.getPortChanges(e.nameTable[i.id],n),i=e.nameTable[i.id];qh(i,t.objectId).offset=n.offset,e.nodePropertyChange(i,{},r),i.parentId&&e.updateConnectorEdges(e.nameTable[i.parentId])},m.prototype.recordPropertyChanged=function(t,e,i){var n=t.redoObject,t=t.undoObject;this.getProperty(e,i?n:t),i?e.onPropertyChanged(n,t):e.onPropertyChanged(t,n),e.diagramActions=e.diagramActions|Z.DiagramAction.UndoRedo},m.prototype.recordOrderCommandChanged=function(t,e,i){var n=t.redoObject,r=t.undoObject;e.commandHandler.orderCommands(i,i?n:r,t.type),e.diagramActions=e.diagramActions|Z.DiagramAction.UndoRedo},m.prototype.recordAddChildToGroupNode=function(t,e,i){var n=e.nameTable[t.undoObject.id],r=e.nameTable[t.objectId];i&&"Insert"===t.changeType?e.addChildToGroup(n,r.id):e.removeChildFromGroup(n,r.id)},m.prototype.recordRemoveChildFromGroupNode=function(t,e,i){var n=e.nameTable[t.undoObject.id],r=e.nameTable[t.objectId];i&&"Remove"===t.changeType?e.removeChildFromGroup(n,r.id):e.addChildToGroup(n,r.id)},m.prototype.recordSegmentChanged=function(t,e){var i,n=0;if(t.connectors&&0<t.connectors.length)for(n=0;n<t.connectors.length;n++)i=t.connectors[parseInt(n.toString(),10)],this.segmentChanged(i,e)},m.prototype.segmentChanged=function(t,e){var i=e.nameTable[t.id];i.segments=t.segments,e.commandHandler.updateEndPoint(i)},m.prototype.recordPositionChanged=function(t,e){var i,n,r=0;if(t.nodes&&0<t.nodes.length){for(r=0;r<t.nodes.length;r++)e.bpmnModule&&(e.isPositionUndo=!0),i=t.nodes[parseInt(r.toString(),10)],this.positionChanged(i,e);e.isPositionUndo=!1}if(t.connectors&&0<t.connectors.length)for(r=0;r<t.connectors.length;r++)n=t.connectors[parseInt(r.toString(),10)],this.segmentChanged(n,e),this.connectionChanged(n,e)},m.prototype.positionChanged=function(t,e){var i,n,r=e.nameTable[t.id];t.processId&&!r.processId&&e.addProcess(t,t.processId),!t.processId&&r.processId&&e.removeProcess(t.id),n=r.processId?(i=t.margin.left-r.margin.left,t.margin.top-r.margin.top):(r.parentId&&(n=e.nameTable[r.parentId]).isLane&&(t.wrapper.offsetX=t.width/2+(n.wrapper.bounds.x+t.margin.left),t.wrapper.offsetY=t.height/2+(n.wrapper.bounds.y+t.margin.top)),i=t.wrapper.offsetX-r.offsetX,t.wrapper.offsetY-r.offsetY),e.drag(r,i,n),e.bpmnModule&&e.bpmnModule.updateDocks(r,e)},m.prototype.recordSizeChanged=function(t,e,i){var n,r,o=0;if(t&&t.nodes&&0<t.nodes.length)for(o=0;o<t.nodes.length;o++)if((r=t.nodes[parseInt(o.toString(),10)]).children&&!r.container)for(var a=e.commandHandler.getAllDescendants(r,[]),s=0;s<a.length;s++){var h=i.childTable[a[parseInt(s.toString(),10)].id];ld(h)===_?(this.sizeChanged(h,e,i),this.positionChanged(h,e)):this.connectionChanged(h,e,i)}else e.bpmnModule&&(e.sizeUndo=!0),this.sizeChanged(r,e),this.positionChanged(r,e),e.bpmnModule&&(e.sizeUndo=!1);if(t&&t.connectors&&0<t.connectors.length)for(var d=t.connectors,o=0;o<d.length;o++)n=d[parseInt(o.toString(),10)],this.connectionChanged(n,e)},m.prototype.sizeChanged=function(t,e,i){var n=e.nameTable[t.id],r=t.wrapper.actualSize.width/n.wrapper.actualSize.width,o=t.wrapper.actualSize.height/n.wrapper.actualSize.height;i&&i.childTable&&(i.childTable[t.id]=Q(n)),e.scale(n,r,o,{x:t.wrapper.offsetX/n.wrapper.offsetX,y:t.wrapper.offsetY/n.wrapper.offsetY})},m.prototype.recordRotationChanged=function(t,e,i,n){var r,o=0,a=e.selectedItems;if(a.rotateAngle=t.rotateAngle,a&&a.wrapper&&(a.wrapper.rotateAngle=t.rotateAngle),e.fromUndo=!0,t&&t.nodes&&0<t.nodes.length)for(o=0;o<t.nodes.length;o++){var s,h=!1;if((s=t.nodes[parseInt(o.toString(),10)]).children&&0<s.children.length){for(var d=0;d<s.children.length;d++){var l=e.nameTable[s.children[parseInt(d.toString(),10)]];if(ld(l)!==_&&(""===l.sourceID||""===l.targetID)){h=!0;break}}if(h&&0<Object.keys(i.childTable).length){for(var c=e.commandHandler.getAllDescendants(s,[]),p=0;p<c.length;p++){var g=i.childTable[c[parseInt(p.toString(),10)].id];if(ld(g)===_){var u={id:"",rotateAngle:0,wrapper:{offsetX:0,offsetY:0}};if("redo"===n?(u.id=g.id,u.rotateAngle=s.rotateAngle):u=g,this.rotationChanged(u,e),"undo"===n){var m=e.nameTable[u.id];this.undoOffsets.push({id:m.id,offsetX:m.offsetX,offsetY:m.offsetY})}else{for(var f=-1,y=this.undoOffsets.length-1;0<=y;y--)if(this.undoOffsets[parseInt(y.toString(),10)].id===u.id){u.wrapper=this.undoOffsets[parseInt(y.toString(),10)],f=y;break}-1!==f&&this.undoOffsets.splice(f,1)}this.positionChanged(u,e)}else this.connectionChanged(g,e,i)}e.nameTable[s.id].rotateAngle=t.rotateAngle,e.updateSelector(),this.rotationChanged(s,e)}else this.rotationChanged(s,e),this.positionChanged(s,e)}else this.rotationChanged(s,e),this.positionChanged(s,e)}if(e.fromUndo=!1,t&&t.connectors&&0<t.connectors.length)for(o=0;o<t.connectors.length;o++)r=t.connectors[parseInt(o.toString(),10)],this.connectionChanged(r,e)},m.prototype.rotationChanged=function(t,e){var i=e.nameTable[t.id];e.rotate(i,t.rotateAngle-i.rotateAngle)},m.prototype.recordConnectionChanged=function(t,e){t=t&&t.connectors?t.connectors[0]:t;t.sourceID&&e.nameTable[t.sourceID]&&e.insertValue(e.nameTable[t.sourceID],!0),t.targetID&&e.nameTable[t.targetID]&&e.insertValue(e.nameTable[t.targetID],!0),(t instanceof W||"None"===t.shape.type||"Bpmn"===t.shape.type)&&this.connectionChanged(t,e)},m.prototype.connectionChanged=function(t,e,i){var n=e.nameTable[t.id],r=(t.sourcePortID!==n.sourcePortID&&(e.removePortEdges(e.nameTable[n.sourceID],n.sourcePortID,n.id,!1),n.sourcePortID=t.sourcePortID,e.connectorPropertyChange(n,{},{sourcePortID:t.sourcePortID})),t.targetPortID!==n.targetPortID&&(e.removePortEdges(e.nameTable[n.targetID],n.targetPortID,n.id,!0),n.targetPortID=t.targetPortID,e.connectorPropertyChange(n,{},{targetPortID:t.targetPortID})),t.sourceID!==n.sourceID&&(""===t.sourceID?Yh((r=e.nameTable[n.sourceID]).outEdges,t.id):((r=e.nameTable[t.sourceID]).outEdges.push(t.id),e.updatePortEdges(r,t,!1)),n.sourceID=t.sourceID,e.connectorPropertyChange(n,{},{sourceID:t.sourceID})),t.targetID!==n.targetID&&(""===t.targetID?Yh((r=e.nameTable[n.targetID]).inEdges,t.id):((r=e.nameTable[t.targetID]).inEdges.push(t.id),e.updatePortEdges(r,t,!0)),n.targetID=t.targetID,e.connectorPropertyChange(n,{},{targetID:t.targetID})),i&&i.childTable&&(i.childTable[t.id]=Q(n)),t.sourcePoint.x-n.sourcePoint.x),i=t.sourcePoint.y-n.sourcePoint.y,r=(0==r&&0==i||e.dragSourceEnd(n,r,i),t.targetPoint.x-n.targetPoint.x),i=t.targetPoint.y-n.targetPoint.y;0==r&&0==i||e.dragTargetEnd(n,r,i),e.updateSelector(),"SVG"!==e.mode&&e.refreshDiagramLayer()},m.prototype.recordCollectionChanged=function(t,e){var i,n=t.undoObject;t&&t.changeType&&("Remove"===(t.isUndo?"Insert"===t.changeType?"Remove":"Insert":t.changeType)?n.nodeId?e.remove(e.nameTable[n.nodeId+"_textannotation_"+n.id]):(e.remove(n),n.parentId&&(i=e.nameTable[n.parentId])&&this.removeChildFromLane(e,i,n),e.clearSelectorLayer()):(e.clearSelectorLayer(),n.parentId?(i=e.nameTable[n.parentId])?e.addChild(i,n):e.add(n):n.nodeId?e.addTextAnnotation(n,e.nameTable[n.nodeId]):e.nameTable[n.id]||(n&&n.shape&&"SwimLane"===n.shape.type&&t.isUndo&&Mr(n,void 0,void 0,void 0,void 0,!0),this.updateConnectorZindex(n,e),e.add(n)),n.processId&&e.nameTable[n.processId]&&e.addProcess(n,n.processId)),"SVG"!==e.mode)&&e.refreshDiagramLayer()},m.prototype.updateConnectorZindex=function(t,e){var i,n;(t.sourceID||t.targetID)&&(n=e.nameTable[t.sourceID],i=e.nameTable[t.targetID],n&&n.parentId?(n=e.nameTable[n.parentId])&&n.isLane&&Kr(t,e.nameTable[n.parentId],e):i&&i.parentId&&(n=e.nameTable[i.parentId])&&n.isLane&&Kr(t,e.nameTable[n.parentId],e))},m.prototype.recordLabelCollectionChanged=function(t,e){var i=t.undoObject,n=t.redoObject,n=e.nameTable[n.id];t&&t.changeType&&("Remove"===(t.isUndo?"Insert"===t.changeType?"Remove":"Insert":t.changeType)?(e.removeLabels(n,[i]),e.clearSelectorLayer()):(e.clearSelectorLayer(),e.addLabels(n,[i])),"SVG"!==e.mode)&&e.refreshDiagramLayer()},m.prototype.recordPortCollectionChanged=function(t,e){var i=t.undoObject,n=t.redoObject,n=e.nameTable[n.id];t&&t.changeType&&("Remove"===(t.isUndo?"Insert"===t.changeType?"Remove":"Insert":t.changeType)?(e.removePorts(n,[i]),e.clearSelectorLayer()):(e.clearSelectorLayer(),e.addPorts(n,[i])),"SVG"!==e.mode)&&e.refreshDiagramLayer()},m.prototype.redo=function(t){this.checkRedo=!0;var e=this.getRedoEntry(t),i=0;e&&("Internal"===e.category?("StartGroup"===e.type?(i++,this.groupUndo=!0):this.redoEntry(e,t),this.groupUndo&&(this.redoGroupAction(e,t,i),this.groupUndo=!1)):(N.isBlazor()||t.historyManager.redo(e),i={entryType:"redo",oldValue:e.redoObject,newValue:e.undoObject},t.triggerEvent(Z.DiagramEvent.historyStateChange,i))),this.checkRedo=!1},m.prototype.redoGroupAction=function(t,e,i){for(;0!==i;)this.redoEntry(t,e),"EndGroup"===(t=this.getRedoEntry(e)).type?i--:"StartGroup"===t.type&&i++},m.prototype.redoEntry=function(t,e){var i,n,r;switch("PropertyChanged"!==t.type&&"CollectionChanged"!==t.type&&(i=t.redoObject,r=t.redoObject),e.diagramActions|=Z.DiagramAction.UndoRedo,"StartGroup"!==t.type&&"EndGroup"!==t.type&&0<e.historyManager.redoStack.length&&(n=e.historyManager.redoStack.splice(0,1),e.historyManager.undoStack.splice(0,0,n[0]),r=t.redoObject),e.protectPropertyChange(!0),t.type){case"PositionChanged":case"Align":case"Distribute":this.recordPositionChanged(i,e);break;case"SizeChanged":case"Sizing":this.recordSizeChanged(i,e,t);break;case"RotationChanged":this.recordRotationChanged(i,e,t,"redo");break;case"ConnectionChanged":this.recordConnectionChanged(i,e);break;case"PropertyChanged":this.recordPropertyChanged(t,e,!0);break;case"CollectionChanged":this.recordCollectionChanged(t,e);break;case"LabelCollectionChanged":this.recordLabelCollectionChanged(t,e);break;case"PortCollectionChanged":this.recordPortCollectionChanged(t,e);break;case"Group":this.group(t,e);break;case"UnGroup":this.unGroup(t,e);break;case"SegmentChanged":this.recordSegmentChanged(i,e);break;case"PortPositionChanged":this.recordPortChanged(t,e,!0);break;case"AnnotationPropertyChanged":this.recordAnnotationChanged(t,e,!0);break;case"ChildCollectionChanged":this.recordChildCollectionChanged(t,e,!0);break;case"StackChildPositionChanged":this.recordStackPositionChanged(t,e,!0);break;case"RowHeightChanged":this.recordGridSizeChanged(t,e,!0,!0);break;case"ColumnWidthChanged":this.recordGridSizeChanged(t,e,!0,!1);break;case"LanePositionChanged":this.recordLanePositionChanged(t,e,!0);break;case"LaneCollectionChanged":case"PhaseCollectionChanged":this.recordLaneOrPhaseCollectionChanged(t,e,!0);break;case"SendToBack":case"SendForward":case"SendBackward":case"BringToFront":this.recordOrderCommandChanged(t,e,!0);break;case"AddChildToGroupNode":this.recordAddChildToGroupNode(t,e,!0);break;case"RemoveChildFromGroupNode":this.recordRemoveChildFromGroupNode(t,e,!0);break;case"ExternalEntry":e.historyManager.redo(t)}e.protectPropertyChange(!1),e.diagramActions&=~Z.DiagramAction.UndoRedo,e.historyChangeTrigger(t,"Redo"),r&&(n=this.checkNodeObject(r,e))&&(r=Dp(e.updateSelection))&&r(n,e)},m.prototype.getUndoEntry=function(t){var e,i=null,t=t.historyManager;return t.canUndo&&(i=t.currentEntry,(e=t.currentEntry.previous)?(t.currentEntry=e,t.canRedo||(t.canRedo=!0)):(t.canRedo=!0,t.canUndo=!1)),i},m.prototype.getRedoEntry=function(t){var e,i=null,t=t.historyManager;return t.canRedo&&((e=t.currentEntry.previous||t.canUndo?t.currentEntry.next:t.currentEntry)&&(t.currentEntry=e,t.canUndo||(t.canUndo=!0),e.next||(t.canRedo=!1,t.canUndo=!0)),i=t.currentEntry),i},m.prototype.destroy=function(){},m.prototype.getModuleName=function(){return"UndoRedo"};g=m;function m(){this.groupUndo=!1,this.childTable=[],this.historyCount=0,this.hasGroup=!1,this.groupCount=0,this.undoOffsets=[],this.checkRedo=!1}Cu.prototype.expand=function(t,e,i,n){var r,o,a=this,s=0;n.realActions=n.realActions|Z.RealAction.AnimationClick,this.setIntervalObject[parseInt(0..toString(),10)]=setInterval(function(){return s++,a.layoutAnimation(e,a.setIntervalObject,6===s,n,i)},20),i.isExpanded&&(r=.2,n.protectPropertyChange(!1),o={},t)&&(this.updateOpacity(i,r,n),o[parseInt(0..toString(),10)]=setInterval(function(){n.allowServerDataBinding=!1,r<=1?a.updateOpacity(i,r,n):clearInterval(o[0]),r+=.2,n.allowServerDataBinding=!0},20))},Cu.prototype.stopCurrentAnimation=function(t,e,i){clearInterval(this.setIntervalObject[0]),this.setIntervalObject=[];for(var n=0;n<t.objects.length;n++){var r=e.nameTable[t.objects[parseInt(n.toString(),10)].id];r.offsetX+=t.objects[parseInt(n.toString(),10)].differenceX-t.objects[parseInt(n.toString(),10)].differenceX/5,r.offsetY+=t.objects[parseInt(n.toString(),10)].differenceY-t.objects[parseInt(n.toString(),10)].differenceY/5}e.realActions=e.realActions&Z.RealAction.AnimationClick,e.refreshCanvasLayers(),e.protectPropertyChange(!0),e.triggerEvent(Z.DiagramEvent.animationComplete,void 0),e.layout.fixedNode="",e.protectPropertyChange(this.protectChange);i={element:Q(i),state:!!i.isExpanded};e.triggerEvent(Z.DiagramEvent.expandStateChange,i),e.lineRoutingModule&&e.constraints&Z.DiagramConstraints.LineRouting&&e.resetSegments()},Cu.prototype.layoutAnimation=function(t,e,i,n,r){if(!i)for(var o=0;o<t.objects.length;o++){var a=n.nameTable[t.objects[parseInt(o.toString(),10)].id];a.offsetX+=t.objects[parseInt(o.toString(),10)].differenceX/5,a.offsetY+=t.objects[parseInt(o.toString(),10)].differenceY/5}i&&(clearInterval(e[0]),this.setIntervalObject=[],n.realActions=n.realActions&~Z.RealAction.AnimationClick,n.refreshCanvasLayers(),n.protectPropertyChange(!0),n.triggerEvent(Z.DiagramEvent.animationComplete,void 0),n.organizationalChartModule.isAnimation=!1,n.layout.fixedNode="",n.protectPropertyChange(this.protectChange),i={element:Q(r),state:!!r.isExpanded},n.triggerEvent(Z.DiagramEvent.expandStateChange,i),n.lineRoutingModule)&&n.constraints&Z.DiagramConstraints.LineRouting&&n.resetSegments()},Cu.prototype.updateOpacity=function(t,e,i){for(var n=0;n<t.outEdges.length;n++){var r=i.nameTable[t.outEdges[parseInt(n.toString(),10)]],o=i.nameTable[r.targetID];r.style.opacity=e;for(var a=0;a<r.wrapper.children.length;a++)r.wrapper.children[parseInt(a.toString(),10)].style.opacity=e,o.style.opacity=e,o.wrapper instanceof te&&i.updateNodeProperty(o.wrapper,void 0,e);this.updateOpacity(o,e,i)}},Cu.prototype.destroy=function(){},Cu.prototype.getModuleName=function(){return"LayoutAnimate"};var Iu=Cu;function Cu(){this.protectChange=!1,this.setIntervalObject=[]}Au.prototype.updateCoordinate=function(t){this.coordinate+=t;var t="Left"===this.direction||"Right"===this.direction,e=t?{x:this.startPoint.x,y:this.coordinate}:{x:this.coordinate,y:this.startPoint.y},t=t?{x:this.endPoint.x,y:this.coordinate}:{x:this.coordinate,y:this.endPoint.y};this.startPoint=e,this.previous&&this.previous.adjustEnd(e),this.endPoint=t,this.next&&this.next.adjustStart(t)},Au.prototype.adjustStart=function(t){this.startPoint=t,this.updateSortedValues()},Au.prototype.adjustEnd=function(t){this.endPoint=t,this.updateSortedValues()},Au.prototype.updateSortedValues=function(){var t="Top"===this.direction||"Bottom"===this.direction;this.sortedStart=t?Math.min(this.startPoint.y,this.endPoint.y):Math.min(this.startPoint.x,this.endPoint.x),this.sortedEnd=t?Math.max(this.startPoint.y,this.endPoint.y):Math.max(this.startPoint.x,this.endPoint.x),this.startEvent.refresh(),this.endEvent.refresh()};var Pu=Au;function Au(t,e,i){this.startPoint=t,this.endPoint=e,(this.previous=i)&&(i.next=this);i=t.x===e.x;this.coordinate=i?t.x:t.y,this.sortedStart=i?Math.min(t.y,e.y):Math.min(t.x,e.x),this.sortedEnd=i?Math.max(t.y,e.y):Math.max(t.x,e.x),this.direction=i?t.y<e.y?"Bottom":"Top":t.x<e.x?"Right":"Left",this.startEvent=new Tu(this,!0),this.endEvent=new Tu(this,!1)}Du.prototype.refresh=function(){this.value=this.isStart?this.segment.sortedStart:this.segment.sortedEnd},Du.prototype.compareTo=function(t){return this.value!==t.value?this.value<t.value?-1:1:this.isStart?-1:t.isStart?1:0};var Tu=Du;function Du(t,e){this.segment=t,this.isStart=e,this.value=e?t.sortedStart:t.sortedEnd}Mu.prototype.addSegment=function(t){var e=this.getBranches(t.direction);this.addSegmentToBranch(e,t)},Mu.prototype.addSegmentToBranch=function(t,e){t.has(e.coordinate)||t.set(e.coordinate,new Set);t=t.get(e.coordinate);t&&(t.add(e.startEvent),t.add(e.endEvent))},Mu.prototype.removeSegment=function(t){var e=this.getBranches(t.direction);this.removeSegmentFromBranch(e,t)},Mu.prototype.removeSegmentFromBranch=function(t,e){var i=t.get(e.coordinate);i&&(i.delete(e.startEvent),i.delete(e.endEvent),0===i.size)&&t.delete(e.coordinate)},Mu.prototype.findOverlappingSegments=function(t){var e=this.getBranches(t.direction);return this.findOverlappingSegmentsInBranch(e,t)},Mu.prototype.findOverlappingSegmentsInBranch=function(t,e){var i=[],n=new Set,t=t.get(e.coordinate);if(t){var r=[];t.forEach(function(t){return r.push(t)});for(var o=0;o<r.length;o++){var a=r[parseInt(o.toString(),10)];!(a.segment.sortedStart<e.sortedStart&&a.segment.sortedEnd>e.sortedEnd)&&(a.value<e.sortedStart||a.value>e.sortedEnd)||a.segment===e||n.has(a.segment)||(n.add(a.segment),Math.max(e.sortedStart,a.segment.sortedStart)<Math.min(e.sortedEnd,a.segment.sortedEnd)&&i.push(a.segment))}}return i},Mu.prototype.getBranches=function(t){return"Left"===t||"Right"===t?this.horizontalBranches:this.verticalBranches};var Ou=Mu;function Mu(){this.horizontalBranches=new Map,this.verticalBranches=new Map}Lu.prototype.getModifiedConnector=function(){return this.modifiedConnector},Lu.prototype.getModifiedConnectorSegments=function(t){t=this.segmentMappings.get(t);return t?this.convertSegmentsToOrthogonal(t):[]},Lu.prototype.refreshModifiedConnectors=function(i){var n=this;this.modifiedConnector.forEach(function(t){var e=n.getModifiedConnectorSegments(t);e.length&&(t.segments=e,i.connectorPropertyChange(t,{},{type:"Orthogonal",segments:e}))}),this.modifiedConnector.clear()},Lu.prototype.removeConnector=function(t){var e=this,i=this.segmentMappings.get(t);i&&i.forEach(function(t){e.segmentTree.removeSegment(t),e.connectorMappings.delete(t)}),this.segmentMappings.delete(t)},Lu.prototype.addConnector=function(t,e,i){var n=this,r=(0===(e=void 0===e?[]:e).length&&(e=t.intermediatePoints),this.removeConnector(t),this.createLineSegments(e));if(this.mapSegmentsToConnector(t,r),3<e.length)this.adjustConnector(t);else{for(var o=new Set,a=0,s=r;a<s.length;a++)for(var h=s[a],d=0,l=this.segmentTree.findOverlappingSegments(h);d<l.length;d++){var c=l[d],c=this.connectorMappings.get(c);o.add(c)}o.forEach(function(t){return n.adjustConnector(t)})}},Lu.prototype.createLineSegments=function(t){for(var e=[],i=0;i<t.length-1;i++){var n=new Pu(t[parseInt(i.toString(),10)],t[parseInt((i+1).toString(),10)],0===i?null:e[parseInt((i-1).toString(),10)]);e.push(n)}return e},Lu.prototype.mapSegmentsToConnector=function(e,t){var i=this;this.segmentMappings.set(e,t),t.forEach(function(t){i.segmentTree.addSegment(t),i.connectorMappings.has(t)||i.connectorMappings.set(t,e)})},Lu.prototype.convertSegmentsToOrthogonal=function(t){var e=[];return t.forEach(function(t){t={type:"Orthogonal",direction:t.direction,length:Math.abs(t.sortedEnd-t.sortedStart)};e.push(t)}),e},Lu.prototype.adjustConnector=function(t){for(var e=this,i=(this.requireReroute=!1,this.segmentMappings.get(t)),n=void 0,r=0;r<i.length-1;r++){var o=i[parseInt(r.toString(),10)];if(o.previous&&o.next){var a=this.segmentTree.findOverlappingSegments(o);if(0<a.length&&!this.resolveOverlappingSegments(o,a)&&this.requireReroute){n=o;break}}}if(n&&this.diagram.lineRoutingModule&&this.reRoutedCount<=Lu.maxReRouteLimit){for(;0<this.considerNonWalkable.length;)this.considerNonWalkable.pop().walkable=!0;this.diagram.lineRoutingModule.getGridsIntersect(n.startPoint,n.endPoint).forEach(function(t){t.walkable=!1,e.considerNonWalkable.push(t)}),this.reRoutedCount++,this.diagram.lineRoutingModule.refreshConnectorSegments(this.diagram,t,!1)}for(this.reRoutedCount=0;0<this.considerNonWalkable.length;)this.considerNonWalkable.pop().walkable=!0},Lu.prototype.resolveOverlappingSegments=function(t,e){this.modifiedSegments.clear(),this.currentSegments.clear();var i=this.shouldAdjustSelfFirst(t,e),n=e[0],r=i?this.calculateShiftDirection(t,e):this.calculateShiftDirection(n,this.segmentTree.findOverlappingSegments(n)),o=!1;return i?(i=1===e.length?n:void 0,(o=this.attemptAdjustment(t,r,i))||(r=Ui(r),o=this.attemptAdjustment(t,r,i))):(o=this.attemptAdjustment(n,r,t))||(r=Ui(r),o=this.attemptAdjustment(n,r,t)),this.updateSegmentTreeWithModifiedSegments(),o},Lu.prototype.shouldAdjustSelfFirst=function(t,e){var i,n,r=1<e.length;return r=1!==e.length||(e=e[0]).previous&&e.next&&(i=Math.max(t.sortedStart,e.sortedStart),t=((n=Math.min(t.sortedEnd,e.sortedEnd))-i)/(t.sortedEnd-t.sortedStart),!((n-i)/(e.sortedEnd-e.sortedStart)<=t))?r:!0},Lu.prototype.attemptAdjustment=function(t,e,i){void 0===i&&(i=void 0);var n,r=this.adjustSegment(t,e);return this.updateModifiedSegments(r),r&&1===this.modifiedSegments.size||i&&i.previous&&i.next&&(n=this.getDependentSegments(t,this.modifiedSegments),i=this.adjustSegment(i,Ui(e),!0),!r&&i?this.updateModifiedSegments(!0):r&&i?(e=this.getDependentSegments(t,this.currentSegments),t=0===this.modifiedSegments.size||this.modifiedSegments.size>this.currentSegments.size||n.length>e.length,this.updateModifiedSegments(t)):this.updateModifiedSegments(!1),r=r||i),r},Lu.prototype.getDependentSegments=function(i,t){var n=[];return t.forEach(function(t,e){e!==i&&n.push(e)}),n},Lu.prototype.updateModifiedSegments=function(i){var n=this;i&&this.modifiedSegments.clear(),this.currentSegments.forEach(function(t,e){i&&n.modifiedSegments.set(e,e.coordinate),n.segmentTree.removeSegment(e),e.updateCoordinate(t-e.coordinate),n.segmentTree.addSegment(e)}),this.currentSegments.clear()},Lu.prototype.updateSegmentTreeWithModifiedSegments=function(){var i=this;0<this.modifiedSegments.size&&this.modifiedSegments.forEach(function(t,e){i.segmentTree.removeSegment(e),e.updateCoordinate(t-e.coordinate),i.segmentTree.addSegment(e);t=i.connectorMappings.get(e);i.modifiedConnector.has(t)||i.modifiedConnector.add(t)})},Lu.prototype.resolveOverlappingAtGivenDirection=function(t,e,i,n){var r=this.shouldAdjustSelfFirst(t,e),e=e[0],o=r?t:e;return n&&(o=r&&e.previous&&e.next?e:t),this.adjustSegment(o,i,n)},Lu.prototype.calculateShiftDirection=function(t,e){var i,n,r,o,a,s,h,e=e[0],d=t.previous,l=t.next,c="Left"===t.direction||"Right"===t.direction?t.startPoint.x:t.startPoint.y,p="Left"===t.direction||"Right"===t.direction?t.endPoint.x:t.endPoint.y,g=t.direction;return d.direction===l.direction?(i=e.previous,n=e.next,r=e.sortedStart<=c&&c<=e.sortedEnd,o=e.sortedStart<=p&&p<=e.sortedEnd,r&&o&&(a="Left"===e.direction||"Right"===e.direction?e.startPoint.x:e.startPoint.y,s="Left"===e.direction||"Right"===e.direction?e.endPoint.x:e.endPoint.y,t.direction!==e.direction&&(h=a,a=s,s=h),h=Math.abs(c-a),Math.abs(p-s)<h?o=!1:r=!1),r?g=t.direction===e.direction&&n?Ui(n.direction):t.direction!==e.direction&&i?i.direction:Ui(d.direction):o&&(g=t.direction===e.direction&&i?i.direction:t.direction!==e.direction&&n?Ui(n.direction):Ui(d.direction))):g=l.direction,g},Lu.prototype.adjustSegment=function(t,e,i){void 0===i&&(i=!1);var n=t.coordinate,r=t.previous,o=t.next,a=!0,s=(r.direction===o.direction&&(a=!(o.direction===e)),-1*Lu.ConnectorSpacing);s+=a?this.calculateShortSegmentShift(r,o):this.calculateLongSegmentShift(r,o);a=("Right"===e||"Bottom"===e?1:-1)*Lu.ConnectorSpacing;if(Math.abs(a)<=s){if(this.segmentTree.removeSegment(t),t.updateCoordinate(a),this.segmentTree.addSegment(t),this.currentSegments.has(t)||this.currentSegments.set(t,n),this.diagram.lineRoutingModule){o=t.startPoint,s=t.endPoint;if(!this.diagram.lineRoutingModule.isPathWalkable(o,s,this.diagram))return!(this.requireReroute=!0)}a=this.segmentTree.findOverlappingSegments(t);if(0!==a.length)return!(0!==this.modifiedSegments.size&&this.modifiedSegments.size>this.currentSegments.size+1)&&this.resolveOverlappingAtGivenDirection(t,a,e,i);o=this.segmentTree.findOverlappingSegments(r);if(0!==o.length){s=o[0];if(s.previous&&s.next)return this.adjustSegment(t,e,i)}}return t.coordinate!==n},Lu.prototype.calculateShortSegmentShift=function(t,e){var i=t?Math.abs(t.sortedEnd-t.sortedStart):0,n=e?Math.abs(e.sortedEnd-e.sortedStart):0;return t.direction===e.direction?i:Math.min(i,n)},Lu.prototype.calculateLongSegmentShift=function(t,e){var i=t?Math.abs(t.sortedEnd-t.sortedStart):0,n=e?Math.abs(e.sortedEnd-e.sortedStart):0;return t.direction===e.direction?n:2*Math.max(i,n)+Lu.ConnectorSpacing},Lu.prototype.destroy=function(){},Lu.prototype.getModuleName=function(){return"AvoidLineOverlapping"},Lu.ConnectorSpacing=5,Lu.maxReRouteLimit=5;var Eu=Lu;function Lu(t){this.requireReroute=!1,this.reRoutedCount=0,this.considerNonWalkable=[],this.diagram=t,this.segmentTree=new Ou,this.segmentMappings=new Map,this.connectorMappings=new Map,this.modifiedConnector=new Set,this.modifiedSegments=new Map,this.currentSegments=new Map}ku.prototype.destroy=function(){},ku.prototype.getModuleName=function(){return"LineDistribution"},ku.prototype.initLineDistribution=function(t,e){var i="Bottom";if("DifferentPoint"===e.layout.connectionPointOrigin||e.layout.enableRouting){var n="Top",r=("BottomToTop"===t.orientation?(i="Top",n="Bottom"):"RightToLeft"===t.orientation?(i="Left",n="Right"):"LeftToRight"===t.orientation&&(i="Right",n="Left"),e.nodes);if(0<r.length)for(var o=0;o<r.length;o++){var a=e.nameTable[r[parseInt(o.toString(),10)].id];this.addDynamicPortandDistrrbuteLine(t,a,i,n,e)}}},ku.prototype.ObstacleSegment=function(t){return t.direction=dd(t.startpt,t.endpt),t.distance=K.findLength(t.startpt,t.endpt),t.orientation="Left"===t.direction||"Right"===t.direction?"horizontal":"vertical",t.id=t.id,"horizontal"===t.orientation?(t.coord=t.startpt.y,"Left"===t.direction?(t.start=t.endpt.x,t.end=t.startpt.x):(t.start=t.startpt.x,t.end=t.endpt.x)):(t.coord=t.startpt.x,"Top"===t.direction?(t.start=t.endpt.y,t.end=t.startpt.y):(t.start=t.startpt.y,t.end=t.endpt.y)),t},ku.prototype.distributeLines=function(t,e){for(var i="LeftToRight"===t.orientation||"RightToLeft"===t.orientation,n="obstaclePointCollection",r=(i?t.horizontalSpacing:t.verticalSpacing)-8-10,o=[],a=[],R=e.connectors,s=0;s<R.length;s++){for(var h=R[parseInt(s.toString(),10)],d=[],l=0;l<h.segments.length;l++)for(var N=h.segments[parseInt(l.toString(),10)],c=0;c<N.points.length;c++){var j=N.points[parseInt(c.toString(),10)];0!==d.length&&K.equals(j,d[d.length-1])||d.push(j)}for(var H=[],p=1;p<d.length;p++){var g=this.ObstacleSegment({startpt:d[p-1],endpt:d[parseInt(p.toString(),10)],id:h.id});H.push(g)}var u={wrapper:h,segments:H},m=[];if(i)for(l=0;l<u.segments.length;l++)"vertical"===(g=u.segments[parseInt(l.toString(),10)]).orientation&&m.push(g);else for(var l=0;l<u.segments.length;l++)"horizontal"===(g=u.segments[parseInt(l.toString(),10)]).orientation&&m.push(g);for(p=0;p<m.length;p++){for(var f=m[parseInt(p.toString(),10)],y=(this.containsValue(o,f.coord)||o.push({key:f.coord,value:[]}),void 0),c=0;c<o.length;c++){l=o[parseInt(c.toString(),10)].key;if(Number(l)===f.coord){y=c;break}}o[parseInt(y.toString(),10)].value.push(f)}a.push(u)}this.sortConnectors(o,e);for(var v=[],b=0;b<o.length;b++){var W=o[parseInt(b.toString(),10)],S=W.value,w=(S.sort(),void 0),w=[],y=0,x=Number.MIN_VALUE;w.push([]);for(var I=0;I<S.length;I++)f=S[parseInt(I.toString(),10)],x=!(0<w[parseInt(y.toString(),10)].length)||x>=f.start?(w[parseInt(y.toString(),10)].push(f),Math.max(x,w[parseInt(y.toString(),10)][w[parseInt(y.toString(),10)].length-1].end)):(y++,w.push([]),w[parseInt(y.toString(),10)].push(f),w[parseInt(y.toString(),10)][w[parseInt(y.toString(),10)].length-1].end);for(I=0;I<w.length;I++){for(var _=w[parseInt(I.toString(),10)],C=[],p=0;p<_.length;p++)(A=_[parseInt(p.toString(),10)]).start&&C.push(A);for(var Y=i?"Bottom":"Right",P=[],p=0;p<C.length;p++)(A=C[parseInt(p.toString(),10)]).direction===Y&&P.push(A);for(var A,T=[],p=0;p<C.length;p++)(A=C[parseInt(p.toString(),10)]).direction!==Y&&T.push(A);var D=[];if(0<P.length)for(var X=P[0].start,p=0;p<T.length;)T[parseInt(p.toString(),10)].end>X?(D.push(T[parseInt(p.toString(),10)]),T.splice(p,1)):p++;var O=[],O=this.updateSegmentRow(D,O),M=[],M=[],E=(M=this.updateSegmentRow(T,M),P.reverse(),M=this.updateSegmentRow(P,M),0<O[O.length-1].length||O.splice(O.length-1,1),0<M[M.length-1].length||M.splice(M.length-1,1),[]);if(0<D.length&&(C[C.length-1].direction===D[D.length-1].direction||C[0].direction===D[0].direction))for(var E=M,L=0;L<O.length;L++){var z=O[parseInt(L.toString(),10)];E[E.length]=z}else{E=O;for(L=0;L<M.length;L++){z=M[parseInt(L.toString(),10)];E[E.length]=z}}if(1<E.length)for(var k=1,V=("BottomToTop"!==t.orientation&&"RightToLeft"!==t.orientation||(k=-1),W.key-k*r/2),F=r/E.length,s=0;s<E.length;s++)for(var U=V+s*F*k,L=0;L<E[parseInt(s.toString(),10)].length;L++){(f=E[parseInt(s.toString(),10)][parseInt(L.toString(),10)]).coord=U,this.containsValue(v,f.coord)||v.push({key:f.coord,value:[]});for(var G=void 0,c=0;c<v.length;c++)if(v[parseInt(c.toString(),10)].key===f.coord){G=c;break}v[parseInt(G.toString(),10)].value.push(f)}}}for(b=0;b<a.length;b++){for(u=a[parseInt(b.toString(),10)],d=[],s=0;s<u.segments.length;s++)0===s?d.push(this.getObstacleStartPoint(u.segments[parseInt(s.toString(),10)])):i?"vertical"===u.segments[parseInt(s.toString(),10)].orientation&&(d[d.length-1]=this.getObstacleStartPoint(u.segments[parseInt(s.toString(),10)])):"horizontal"===u.segments[parseInt(s.toString(),10)].orientation&&(d[d.length-1]=this.getObstacleStartPoint(u.segments[parseInt(s.toString(),10)])),d.push(this.getObstacleEndPoint(u.segments[parseInt(s.toString(),10)]));u.wrapper[n]=[];for(p=0;p<d.length;p++){var B=d[parseInt(p.toString(),10)];(0===p||0<p&&!K.equals(B,d[p-1]))&&u.wrapper[n].push(this.getPointvalue(B.x,B.y))}"Orthogonal"===u.wrapper.type&&this.resetConnectorPoints(u.wrapper,e)}},ku.prototype.sortConnectors=function(t,i){for(var e=0;e<t.length;e++)for(var n=0;n<t[parseInt(e.toString(),10)].value.length;n++)1<t[parseInt(e.toString(),10)].value.length&&("LeftToRight"===i.layout.orientation||"RightToLeft"===i.layout.orientation?t[parseInt(e.toString(),10)].value.sort(function(t,e){t=i.nameTable[""+t.id],e=i.nameTable[""+e.id];return t.targetPoint.y-e.targetPoint.y}):"TopToBottom"!==i.layout.orientation&&"BottomToTop"!==i.layout.orientation||t[parseInt(e.toString(),10)].value.sort(function(t,e){t=i.nameTable[""+t.id],e=i.nameTable[""+e.id];return t.targetPoint.x-e.targetPoint.x}))},ku.prototype.resetConnectorPoints=function(t,e){var i="obstaclePointCollection";if(t.segments[0].points&&0<t.segments[0].points.length&&t[i]){for(var n=t,r=(n.sourcePoint=t[i][0],n.targetPoint=t[i][t[i].length-1],void 0),r=[],o=0;o<t[i].length-1;o++){var a=t[i][parseInt(o.toString(),10)],s=t[i][o+1],h=yd(a,s),a=dd(a,s),s=(o===t[i].length-2&&("RightToLeft"===e.layout.orientation&&"Left"===a||"LeftToRight"===e.layout.orientation&&"Right"===a||"TopToBottom"===e.layout.orientation&&"Bottom"===a||"BottomToTop"===e.layout.orientation&&"Top"===a)&&(h/=2),new Ua(t,"segments",{type:"Orthogonal"},!0));s.length=h,s.direction=a,r.push(s)}n.segments=r,n.type="Orthogonal",e.connectorPropertyChange(n,{},{type:"Orthogonal",segments:n.segments})}},ku.prototype.getObstacleEndPoint=function(t){return"horizontal"===t.orientation?"Left"===t.direction?this.getPointvalue(t.start,t.coord):this.getPointvalue(t.end,t.coord):"Top"===t.direction?this.getPointvalue(t.coord,t.start):this.getPointvalue(t.coord,t.end)},ku.prototype.getObstacleStartPoint=function(t){return"horizontal"===t.orientation?"Left"===t.direction?this.getPointvalue(t.end,t.coord):this.getPointvalue(t.start,t.coord):"Top"===t.direction?this.getPointvalue(t.coord,t.end):this.getPointvalue(t.coord,t.start)},ku.prototype.updateSegmentRow=function(t,e){var i=0;0<e.length||(e[0]=[]);for(var n=0;n<t.length;n++)for(var r=t[parseInt(n.toString(),10)];i<e.length;){if(i===e.length-1&&(e[i+1]=[]),!(0<e[parseInt(i.toString(),10)].length)||e[parseInt(i.toString(),10)][e[parseInt(i.toString(),10)].length-1].end<r.start){e[parseInt(i.toString(),10)].push(r);break}i++}return e},ku.prototype.portOffsetCalculation=function(t,e,i,n){"Top"===i&&(t.offset={x:(n+1)*(1/(e+1)),y:0}),"Bottom"===i&&(t.offset={x:(n+1)*(1/(e+1)),y:1}),"Left"===i&&(t.offset={x:0,y:(n+1)*(1/(e+1))}),"Right"===i&&(t.offset={x:1,y:(n+1)*(1/(e+1))})},ku.prototype.addDynamicPortandDistrrbuteLine=function(t,e,i,n,r){e.ports&&0<e.ports.length&&(o=e.ports,r.removePorts(e,o)),e.ports;var o=e.outEdges,a=e.inEdges;this.initPort(o,r,e,i,!1),this.initPort(a,r,e,n,!0)},ku.prototype.initPort=function(t,e,i,n,r){var o=t;1<t.length&&r&&(t=this.sortObjects(o,r,e));for(var a=0;a<=t.length-1;a++){var s=e.nameTable[t[parseInt(a.toString(),10)]],h=(s.obstaclePointCollection=[],qh(i,r?s.targetPortID:s.sourcePortID)),d=n,d=(void 0===h&&((h=new Be(i,"ports","",!0)).id=q()+"_LineDistribution",r?s.targetPortID=h.id:s.sourcePortID=h.id),this.portOffsetCalculation(h,t.length,d,a),i.ports.push(h),i.initPortWrapper(i.ports[i.ports.length-1]));i.wrapper.children.push(d),i.wrapper.measure(new j(i.width,i.height),i.id),i.wrapper.arrange(i.wrapper.desiredSize),e.connectorPropertyChange(s,r?{targetPortID:""}:{sourcePortID:""},r?{targetPortID:h.id}:{sourcePortID:h.id})}},ku.prototype.sortObjects=function(t,e,i){for(var n,r=0;r<t.length;r++)for(var o=r+1;o<t.length;o++){var a=i.nameTable[t[parseInt(r.toString(),10)]],s=i.nameTable[t[parseInt(o.toString(),10)]];e&&(a=i.nameTable[a.sourceID],s=i.nameTable[s.sourceID],"LeftToRight"===i.layout.orientation||"RightToLeft"===i.layout.orientation?a.offsetY>s.offsetY&&(n=t[parseInt(r.toString(),10)],t[parseInt(r.toString(),10)]=t[parseInt(o.toString(),10)],t[parseInt(o.toString(),10)]=n):a.offsetX>s.offsetX&&(n=t[parseInt(r.toString(),10)],t[parseInt(r.toString(),10)]=t[parseInt(o.toString(),10)],t[parseInt(o.toString(),10)]=n))}return t},ku.prototype.resetConnectorSegments=function(t){for(var e=t.segments,i=e.length;0<i;i--)e.splice(i-1,1)},ku.prototype.resetRoutingSegments=function(t,e,i){if(t.levelSkip){for(var n=void 0,r=void 0,o=e.layout.ranks.reverse(),a=0;a<o.length;a++)for(var s=0;s<o[parseInt(a.toString(),10)].length;s++)t.sourceID===o[parseInt(a.toString(),10)][parseInt(s.toString(),10)].id&&(n=a),t.targetID===o[parseInt(a.toString(),10)][parseInt(s.toString(),10)].id&&(r=a);var h=[];if(n<r)for(a=0;a<o.length;a++)n<a&&a<r&&h.push(o[parseInt(a.toString(),10)]);else for(a=0;a<o.length;a++)a<n&&r<a&&h.push(o[parseInt(a.toString(),10)]);for(var d=[],a=0;a<h.length;a++)for(var l,s=0;s<h[parseInt(a.toString(),10)].length;s++)void 0===h[parseInt(a.toString(),10)][parseInt(s.toString(),10)].edges&&(l=e.nameTable[h[parseInt(a.toString(),10)][parseInt(s.toString(),10)].id],d.push(l));e.routingConnectors||(e.routingConnectors=[]);t:for(var c=0;c<d.length;c++)for(var p=d[parseInt(c.toString(),10)].wrapper.bounds,a=0;a<t.segments.length;a++)for(var g=t.segments[parseInt(a.toString(),10)].points,s=0;s<g.length;s++){var u=g[parseInt(s.toString(),10)],m=g[s+1];if(m){u=this.pointsAlongLine(u,m);if(this.pointInsideBounds(u,p)){e.routingConnectors.push(t);break t}}}}},ku.prototype.pointsAlongLine=function(t,e){for(var i=e.x-t.x,e=e.y-t.y,n=Math.sqrt(i*i+e*e),r=i/n*1,o=e/n*1,a=[],s=0;s<=n;s+=1)a.push({x:t.x+r*s,y:t.y+o*s});return a},ku.prototype.pointInsideBounds=function(t,e){for(var i=0,n=t;i<n.length;i++){var r=n[i];if(e.right>r.x&&e.left<r.x&&e.top<r.y&&e.bottom>r.y)return!0}return!1},ku.prototype.getPointvalue=function(t,e){return{x:Number(t)||0,y:Number(e)||0}},ku.prototype.containsValue=function(t,e){for(var i=0;i<t.length;i++)if(t[parseInt(i.toString(),10)]===e)return!0;return!1};var zu=ku;function ku(){}Ru.prototype.destroy=function(){},Ru.prototype.getModuleName=function(){return"OrganizationalChart"},Ru.prototype.updateLayout=function(t,e,i,n,r,o){e={type:i.type,connectionPointOrigin:i.connectionPointOrigin,nameTable:e,anchorX:0,anchorY:0,firstLevelNodes:[],centerNode:null,levels:[],maxLevel:0,graphNodes:{},orientation:i.orientation,horizontalSpacing:i.horizontalSpacing,verticalSpacing:i.verticalSpacing,verticalAlignment:i.verticalAlignment,horizontalAlignment:i.horizontalAlignment,fixedNode:i.fixedNode,getLayoutInfo:Dp(i.getLayoutInfo),layoutInfo:i.layoutInfo,margin:i.margin,bounds:i.bounds,objects:[],root:i.root};return this.doLayout(e,t,n,r,o),e},Ru.prototype.doLayout=function(t,e,i,n,r){var o,a=[];for(t.nameTable[t.root]&&t.firstLevelNodes.push(t.nameTable[t.root]),u=0;u<e.length;u++)(o=e[parseInt(u.toString(),10)]).excludeFromLayout||((t.graphNodes[o.id]=this.setUpLayoutInfo(t,o)).tree.hasSubTree=!1,t.nameTable[t.root])||o.inEdges&&o.inEdges.length||(o.parentId||o.processId||a.push(o),o.data&&String(o.data[""+n])===t.root&&t.firstLevelNodes.push(o));for(0===t.firstLevelNodes.length&&(t.firstLevelNodes=a),u=0;u<t.firstLevelNodes.length;u++)o=t.firstLevelNodes[parseInt(u.toString(),10)],this.updateEdges(t,o,1,r,e);if(0<t.firstLevelNodes.length){t.rootNode=t.firstLevelNodes[0];for(var s=0,h=0,d=void 0,l=void 0,c=void 0,p=void 0,g=void 0,u=0;u<t.firstLevelNodes.length;u++){var g=this.updateTree(t,s,h,t.firstLevelNodes[parseInt(u.toString(),10)],0,t.firstLevelNodes[u-1]),m=t.graphNodes[t.firstLevelNodes[parseInt(u.toString(),10)].id];g.y=Math.min(g.y,m.y),g.x=Math.min(g.x,m.x),-1!==t.orientation.indexOf("Left")?h=g.right+t.horizontalSpacing:s=g.right+t.horizontalSpacing,l=0===u?(d=g.x,p=g.y,c=g.right,g.bottom):(d=Math.min(d,g.x),p=Math.min(p,g.y),c=Math.max(c,g.right),Math.max(l,g.bottom)),t.levels=[],t.maxLevel=void 0}for(this.updateAnchor(t,{x:d,y:p,right:c,bottom:l},i),u=0;u<t.firstLevelNodes.length;u++)this.updateNodes(t,t.firstLevelNodes[parseInt(u.toString(),10)],0);for(u=0;u<t.firstLevelNodes.length;u++)this.updateConnectors(t,t.firstLevelNodes[parseInt(u.toString(),10)],1)}},Ru.prototype.getBounds=function(t){var e=t.offsetX-t.actualSize.width*t.pivot.x,i=t.offsetY-t.actualSize.height*t.pivot.y;return new k(e,i,t.actualSize.width,t.actualSize.height)},Ru.prototype.updateTree=function(t,e,i,n,r,o,a){var s,h,d,l,c,p,g,u,m={},i=this.getDimensions(t,n,e,i,r),m=t.graphNodes[n.id],f=(t.maxLevel=Math.max(t.maxLevel,r),r),y=this.hasChild(t,n);return y||m.tree.assistants.length?(g=p=c=l=d=u=h=void 0,g=i.y+i.height+t.verticalSpacing,m.tree.assistants.length&&(f=(s=this.setDepthSpaceForAssitants(t,n,g,i.height,r,t.verticalSpacing)).level,g=s.bottom),m.tree.assistants.length||"Horizontal"===m.tree.orientation||(g=i.y+i.height+t.verticalSpacing/2),m.tree.children.length&&(h="Horizontal"!==m.tree.orientation||"Balanced"===m.tree.type&&1!==m.tree.children.length?"Balanced"===m.tree.type?this.updateHorizontalTreeWithMultipleRows(t,n,o,i.x,g,f):this.updateVerticalTree(t,n,i.x,g,f,a):this.updateHorizontalTree(t,n,o,i.x,g,f)),m.y&&m.y>i.y||(m.y=i.y),void 0!==m.mid&&(e=m.mid),m.tree.assistants.length&&(p=void 0!==e?e:i.x,c=this.setBreadthSpaceForAssistants(t,n,i,p,g,r),y||(e=((d=h=c).x+d.right)/2-i.width/2,h=d),l=c?c.canMoveBy:void 0),m.x=e,m.translate||(m.treeWidth=h.right-h.x),u={x:e,y:i.y,right:e+i.width,bottom:i.y+i.height},this.translateSubTree({layout:t,shape:n,shapeBounds:u,treeBounds:h,dim:i,level:r},l,void 0!==o,a),m.firstChild&&"string"!=typeof m.firstChild&&(m.firstChild.x+=m.subTreeTranslation),n.treeBounds=h):(n.treeBounds=this.updateLeafNode(t,n,o,i,r,a),n.treeBounds)},Ru.prototype.updateLeafNode=function(t,e,i,n,r,o){var a=t.graphNodes[e.id],s=(a.x=n.x,a.y&&a.y>n.y||(a.y=n.y,a.maxLevel=Math.max(r,a.maxLevel||0)),{x:n.x,y:n.y,right:n.x+n.width,bottom:n.y+n.height});return a.maxLevel=Math.max(a.maxLevel||0,r),this.translateSubTree({layout:t,shape:e,shapeBounds:s,treeBounds:s,dim:n,level:r},void 0,void 0!==i,o),{x:a.x,y:a.y,right:a.x+n.width,bottom:a.y+n.height}},Ru.prototype.setUpLayoutInfo=function(t,e){var i={subTreeTranslation:0};return"OrganizationalChart"===t.type?i.tree={orientation:"Vertical",type:"Alternate",offset:20,enableRouting:!0}:i.tree={orientation:"Horizontal",type:"Center",enableRouting:!0},i.tree.children=[],i.tree.assistants=[],i.tree.level=0,i.translate=!0,i},Ru.prototype.translateSubTree=function(t,e,i,n){var r=t.layout,o=t.shape,a=t.shapeBounds,s=t.treeBounds,h=t.level,t=t.dim,d=r.graphNodes[o.id],l=r.nameTable[d.firstChild?d.firstChild.child:d.tree.children[0]],c=l?r.graphNodes[l.id]:null,p=this.hasChild(r,o),g=this.findIntersectingLevels(r,a,h,d.actualLevel),u=this.findIntersectingLevels(r,s,h,d.actualLevel),m=[];g.length&&d.translate?(d.intersect=g,this.spaceLeftFromPrevSubTree(r,o,a),d.canMoveBy=d.diff,void 0!==e&&(d.canMoveBy=Math.min(e,d.canMoveBy)),l&&void 0!==c.canMoveBy&&(c.canMoveBy>=d.canMoveBy&&(d.translated=!0),d.canMoveBy=Math.min(d.canMoveBy,c.canMoveBy)),i&&(d.x-=d.canMoveBy,d.subTreeTranslation-=d.canMoveBy,p&&(this.shiftSubordinates(r,u,d.canMoveBy),s.x=Math.min(s.x,d.x),s.right=Math.max(s.right,d.x+t.width),s.bottom=Math.max(s.bottom,d.y+t.height),s.x-=d.canMoveBy,s.right-=d.canMoveBy),l&&c.canMoveBy>d.canMoveBy?d.canMoveBy=c.canMoveBy-d.canMoveBy:l&&void 0!==d.canMoveBy&&(d.canMoveBy=0))):(p&&(s.x=Math.min(s.x,a.x),s.right=Math.max(s.right,a.x+t.width),s.bottom=Math.max(s.bottom,d.y+t.height)),d.translate||(d.canMoveBy=0,d.subTreeTranslation=0)),n||(a={x:d.x,y:t.y,right:d.x+t.width,bottom:t.y+t.height},m.push({rBounds:a}),this.updateRearBounds(r,o,m,h))},Ru.prototype.updateRearBounds=function(t,e,i,n,r){var o,a,s,h,d=!0,e=(e&&(r=(e=t.graphNodes[e.id]).intersect,d=!e.tree.children.length&&!e.tree.assistants.length),i[0].rBounds),l=i[i.length-1].rBounds;if(r&&r.length){for(h=(o=t.levels[r[0]].rBounds).bottom,o.y<e.y&&(o.bottom=e.y,i.splice(0,0,{rBounds:o})),h>l.bottom?i.push({rBounds:{x:o.x,right:o.right,y:e.bottom,bottom:h}}):(o=t.levels[r[r.length-1]].rBounds,d&&o.bottom>l.bottom&&(o.y=l.bottom,i.push({rBounds:o}))),a=r[0],s=i.length-1;0<=s;s--)t.levels.splice(a,0,i[parseInt(s.toString(),10)]);a+=i.length,t.levels.splice(a,r.length)}else for(a=this.findLevel(t,i[i.length-1].rBounds,n),s=i.length-1;0<=s;s--)t.levels.splice(a,0,i[parseInt(s.toString(),10)])},Ru.prototype.shiftSubordinates=function(t,e,i){var n;if(0!==i)for(n=0;n<e.length;n++)t.levels[e[parseInt(n.toString(),10)]].rBounds&&(t.levels[e[parseInt(n.toString(),10)]].rBounds.x-=i,t.levels[e[parseInt(n.toString(),10)]].rBounds.right-=i)},Ru.prototype.setDepthSpaceForAssitants=function(t,e,i,n,r,o){for(var a,s,h=t.graphNodes[e.id],d={},l=0;l<h.tree.assistants.length;l++)(d=t.graphNodes[h.tree.assistants[parseInt(l.toString(),10)]])&&(d.tree.children=d.tree.assistants=[],d.y=i,a=(s=t.nameTable[h.tree.assistants[parseInt(l.toString(),10)]]).actualSize.height,s=i+(a=-1!==t.orientation.indexOf("Left")?s.actualSize.width:a)+o/2,t.maxLevel=r+1,l%2==1)&&l!==h.tree.assistants.length-1&&(i=s,r++);return{level:t.maxLevel,bottom:i+a+o}},Ru.prototype.setBreadthSpaceForAssistants=function(t,e,i,n,r,o){for(var a,s,h,d,l=t.graphNodes[e.id],c=o,p={x:0,y:0,right:0,bottom:0},g=0;g<l.tree.assistants.length;g++)(a=t.graphNodes[l.tree.assistants[parseInt(g.toString(),10)]])&&(s=(d=t.nameTable[l.tree.assistants[parseInt(g.toString(),10)]]).actualSize.width,-1!==t.orientation.indexOf("Left")&&(s=d.actualSize.height),d=g%2==0?n+i.width/2-20-s:n+i.width/2+20,s=this.updateTree(t,d,a.y,t.nameTable[l.tree.assistants[parseInt(g.toString(),10)]],c+1),this.hasChild(t,e)||(0===g?p=s:this.uniteRects(p,s)),g%2==0&&a.prevBounds&&(h=void 0===h?a.canMoveBy:Math.min(h,a.canMoveBy)),g%2!=1&&g!==l.tree.assistants.length-1||(d=this.findIntersectingLevels(t,s,c+1),this.updateRearBounds(t,null,[{rBounds:s}],c+1,d),c++));return p&&(p.canMoveBy=h),p},Ru.prototype.getDimensions=function(t,e,i,n,r){var o=e.actualSize.width,a=e.actualSize.height;return t.orientation=t.orientation||"TopToBottom",-1!==t.orientation.indexOf("Left")&&(r||(t=i,i=n,n=t),a=e.actualSize.width,o=e.actualSize.height),{x:i,y:n,width:o,height:a}},Ru.prototype.hasChild=function(t,e){t=t.graphNodes[e.id];return t?t.tree.children&&t.tree.children.length:0},Ru.prototype.updateHorizontalTree=function(t,e,i,n,r,o){var a,s,h,d,l,c,p=this.getDimensions(t,e,n,r,o),g={},u=(g=t.graphNodes[e.id]).tree.type,m=o,f=0,f=n,y=r;t.levels.slice(0,t.levels.length);if(this.hasChild(t,e)){for(var v=-1!==t.orientation.indexOf("Left"),b=0;b<g.tree.children.length;b++){var S,w=(S=t.nameTable[g.tree.children[parseInt(b.toString(),10)]]).actualSize.width,x=S.actualSize.height,I=v?x:w,w=v?w:x,x=(t.levels[m+1]&&t.levels[m+1].rBounds,this.updateTree(t,f,y,S,m+1,t.nameTable[g.tree.children[b-1]])),C=t.graphNodes[S.id];g.maxLevel=Math.max(g.maxLevel||0,C.maxLevel||0),s={x:C.x,y:C.y,right:C.x+I,bottom:C.y+w},0===b&&(a={x:Math.min(C.x,x.x),y:Math.min(C.y,x.y),right:x.right,bottom:x.bottom},c=C),l?(l.x=s.x,l.y=s.y,s.right>l.right&&(l.right=s.right),l.bottom=s.bottom):l=s,0===b&&(g.firstChild={x:C.x,canMoveBy:C.canMoveBy,child:S.id}),this.hasChild(t,S)&&(!g.firstChild||g.firstChild.x>=C.firstChild.x?(C.firstChild&&g.firstChild.canMoveBy<C.canMoveBy&&(d=g.firstChild.canMoveBy,C.canMoveBy=d,t.graphNodes[g.firstChild.child].canMoveBy=d,g.firstChild.canMoveBy=d),I=void 0!==d?d:C.canMoveBy,g.firstChild={x:C.firstChild.x,canMoveBy:I,child:S.id}):C.firstChild&&C.translated&&g.firstChild.canMoveBy>C.canMoveBy&&(g.firstChild.canMoveBy=t.graphNodes[g.firstChild.child].canMoveBy=C.canMoveBy)),h=h?Math.max(C.maxLevel,h):C.maxLevel,this.uniteRects(a,x),f=0!==b&&!this.hasChild(t,S)&&C.subTreeTranslation<0?x.right-C.subTreeTranslation+t.horizontalSpacing:x.right+t.horizontalSpacing}isNaN(void 0)||(c.canMoveBy=void 0),g.mid=(c.x+l.right)/2-p.width/2,"Left"===u?g.mid=s.right-p.width:"Right"===u&&(g.mid=n)}return a},Ru.prototype.updateHorizontalTreeWithMultipleRows=function(t,e,i,n,r,o){var a,s,h,d,l,c,p,g=this.getDimensions(t,e,n,r,o),u=t.graphNodes[e.id],m=(u.tree.type,o),f=n,y=r,v=(t.levels.slice(0,t.levels.length),0);if(this.hasChild(t,e))for(var b=-1!==t.orientation.indexOf("Left"),S=void 0,w=this.splitChildrenInRows(t,e),x=5===u.tree.children.length&&3===w[0].length,I=[],C=[],P=(x?C=w:this.splitRows(w,I,C),{leftTree:I,rows:w,rightTree:C,dimensions:g}),o=this.updateLeftTree(t,P,e,n,y,m),A=P.bounds,T=void 0,D=(o||0)+(void 0!==o?t.horizontalSpacing/2:0),O=(void 0!==o&&(u.mid=D-g.width/2,T=o+t.horizontalSpacing),y=r,void 0),O=[],M=0;M<C.length;M++)for(f=!(w[M].length%2==1&&M===C.length-1||x)&&T||n,0!==M&&(y=O[M-1].bottom+t.verticalSpacing),l=0;l<C[M].length;l++)h=(a=t.nameTable[C[M][l]]).actualSize.width,d=a.actualSize.height,d=b?d:h,(h=t.graphNodes[a.id]).actualLevel=m+1+M,0===l&&I[M]&&I[M].length&&(h.translate=!1),x&&1===M&&(0===l&&c+d+t.horizontalSpacing<=p&&(S=!0,f=c-d/2),S)&&1===l&&(f=p-d/2),s=this.updateTree(t,f,y,a,m+1,t.nameTable[C[M][l-1]]),x&&l<=2&&0===M&&1===l&&(c=s.x-t.horizontalSpacing/2,p=s.x+d+t.horizontalSpacing/2),0===l?O[M]={x:s.x,y:s.y,right:s.right,bottom:s.bottom}:this.uniteRects(O[M],s),A=A||{x:O[M].x,y:O[M].y,right:O[M].right,bottom:O[M].bottom},this.uniteRects(A,O[M]),f=s.right+t.horizontalSpacing,(!u.firstChild||(M===C.length-1&&w[M].length%2==1||x)&&0===l&&void 0!==h.canMoveBy&&v>h.canMoveBy)&&(v=Math.min(v,h.canMoveBy||0),u.firstChild={x:h.x,child:a.id,canMoveBy:h.canMoveBy}),P.leftCenter=c,P.rightCenter=p,P.align=S,P.level=m,P.rightBounds=O,this.alignRowsToCenter(t,M,e,P,T);return A},Ru.prototype.updateLeftTree=function(t,e,i,n,r,o){for(var a,s,h,d,l,c=e.leftTree,p=t.graphNodes[i.id],g=[],u=-1!==t.orientation.indexOf("Left"),m=0;m<c.length&&c[parseInt(m.toString(),10)].length;m++){a=n,g[m-1]&&(r=g[m-1].bottom+t.verticalSpacing);for(var f=0;f<c[parseInt(m.toString(),10)].length;f++){var y=t.nameTable[c[parseInt(m.toString(),10)][parseInt(f.toString(),10)]],v=(u?y.actualSize.height:y.actualSize.width,u?y.actualSize.width:y.actualSize.height,t.graphNodes[y.id]);v.actualLevel=o+1+m,d=this.updateTree(t,a,r,y,o+1,t.nameTable[c[parseInt(m.toString(),10)][f-1]]),0===f?g[parseInt(m.toString(),10)]={x:d.x,y:d.y,right:d.right,bottom:d.bottom}:this.uniteRects(g[parseInt(m.toString(),10)],d),0===m&&0===f?(s=v.canMoveBy,p.firstChild={x:v.x,child:y.id,canMoveBy:v.canMoveBy}):0===f&&void 0!==v.canMoveBy&&s>v.canMoveBy&&(s=Math.min(s,v.canMoveBy||0),p.firstChild={x:v.x,child:y.id,canMoveBy:v.canMoveBy}),a=d.right+t.horizontalSpacing}h=0===m?g[parseInt(m.toString(),10)].right:Math.max(h,g[parseInt(m.toString(),10)].right)}for(m=0;m<c.length&&c[parseInt(m.toString(),10)].length;m++){if(h!==g[parseInt(m.toString(),10)].right)for(var b=h-g[parseInt(m.toString(),10)].right,f=0;f<c[parseInt(m.toString(),10)].length;f++){t.nameTable[c[parseInt(m.toString(),10)][parseInt(f.toString(),10)]];t.graphNodes[c[parseInt(m.toString(),10)][parseInt(f.toString(),10)]].x+=b}0===m?l={x:g[0].x,y:g[0].y,right:g[0].right,bottom:g[0].bottom}:this.uniteRects(l,g[parseInt(m.toString(),10)])}return e.bounds=l,h},Ru.prototype.alignRowsToCenter=function(t,e,i,n,r){var o,a,s,h,i=t.graphNodes[i.id],d=n.rows,l=n.rightTree,c=n.leftCenter,p=n.rightCenter,g=n.align,u=n.rightBounds,m=n.dimensions,n=n.level,f=5===i.tree.children.length&&3===d[0].length;f&&1===e&&(o=u[0].right-u[0].x>=u[1].right-u[1].x?0:1),e===d.length-1&&(d[parseInt(e.toString(),10)].length%2==1||f&&1===e)&&(d=l[parseInt(e.toString(),10)][Math.floor(l[parseInt(e.toString(),10)].length/2)],s=t.nameTable[""+d],a=t.graphNodes[""+d].x,h=t.graphNodes[""+d].y,s=this.getDimensions(t,s,a,h,n+1),h=void 0,!g&&f?(1===o&&(e=0),h=(u[parseInt(o.toString(),10)].x+u[parseInt(o.toString(),10)].right)/2-(u[parseInt(e.toString(),10)].x+u[parseInt(e.toString(),10)].right)/2,0===e&&(i.mid+=h)):f||void 0===r||(h=r-t.horizontalSpacing/2-(a+s.width/2)),void 0!==h&&this.updateRearBoundsOfTree(t,l[parseInt(e.toString(),10)],h,m),f&&(i.mid=(p+c)/2+(0===e?h:0)-m.width/2),void 0===i.mid&&t.graphNodes[""+d]&&(i.mid=a),e++)},Ru.prototype.updateRearBoundsOfTree=function(t,e,i,n){for(var r=0;r<e.length;r++){var o,a,s=t.graphNodes[e[parseInt(r.toString(),10)]];s.x+=i,s.canMoveBy+=i,r===e.length-1&&(o={x:s.x,y:s.y,right:s.x+n.width,bottom:s.y+n.height},a=this.findIntersectingLevels(t,o,s.actualLevel),this.updateRearBounds(t,null,[{rBounds:o}],s.actualLevel,a))}},Ru.prototype.splitRows=function(t,e,i){for(var n=0;n<t.length;n++){e[parseInt(n.toString(),10)]=[],i[parseInt(n.toString(),10)]=[];if(t[parseInt(n.toString(),10)].length,t[parseInt(n.toString(),10)].length%2!=1)for(var r=Math.ceil(t[parseInt(n.toString(),10)].length/2),o=0;o<r;o++)e[parseInt(n.toString(),10)].push(t[parseInt(n.toString(),10)][parseInt(o.toString(),10)]);for(var a=e[parseInt(n.toString(),10)].length;a<t[parseInt(n.toString(),10)].length;a++)i[parseInt(n.toString(),10)].push(t[parseInt(n.toString(),10)][parseInt(a.toString(),10)])}},Ru.prototype.updateVerticalTree=function(t,e,i,n,r,o){for(var a,s,h,d,l,c,p,g,u,m,f,y,v=t.graphNodes[e.id],b=t.nameTable[v.tree.children[0]],S=-1!==t.orientation.indexOf("Left"),w="Left"===v.tree.type?-1:0,x=n,n=r,I=[],C=[],P=0;P<v.tree.children.length;P++)"Alternate"===v.tree.type&&(m=P%2==0&&2<v.tree.children.length?"Left":"Right",w=P%2==0&&2<v.tree.children.length?-1:0),y=i+this.findOffset(t,e,v,m),a=t.nameTable[v.tree.children[parseInt(P.toString(),10)]],h=S?a.actualSize.height:a.actualSize.width,d=S?a.actualSize.width:a.actualSize.height,y=this.updateTree(t,y+w*h,x,a,r+1,void 0,!0),p={x:(s=t.graphNodes[a.id]).x,y:s.y,right:s.x+h,bottom:s.y+d},0===P?(this.uniteRects(y,p),c=y):this.uniteRects(c,y),!s.prevBounds||"Alternate"===v.tree.type&&P%2==1&&2<v.tree.children.length||(f=void 0!==f?Math.min(s.canMoveBy,f):s.canMoveBy),v.maxLevel=Math.max(v.maxLevel||0,s.maxLevel||0),"Alternate"===v.tree.type&&2<v.tree.children.length&&P%2==0?(0!==P&&(x=l.bottom+t.verticalSpacing/2),C.push({rBounds:p}),s.levelBounds&&(C=C.concat(s.levelBounds))):(x="Alternate"===v.tree.type&&2<v.tree.children.length?Math.max(y.bottom,l.bottom)+t.verticalSpacing/2:y.bottom+t.verticalSpacing/2,r=v.maxLevel,I.push({rBounds:p}),g?this.uniteRects(g,p):g={x:s.x,y:s.y,right:s.x+h,bottom:s.y+d},s.levelBounds&&(I=I.concat(s.levelBounds))),0===P&&(v.firstChild={x:s.x,canMoveBy:s.canMoveBy,child:a.id}),this.hasChild(t,a)&&(!v.firstChild||v.firstChild.x>=s.firstChild.x?(s.firstChild&&v.firstChild.canMoveBy<s.canMoveBy&&(y=v.firstChild.canMoveBy,s.canMoveBy=y,t.graphNodes[v.firstChild.child].canMoveBy=y,v.firstChild.canMoveBy=y),v.firstChild={x:s.firstChild.x,canMoveBy:void 0!==f?f:s.canMoveBy,child:a.id}):s.firstChild&&s.translated&&v.firstChild.canMoveBy>s.canMoveBy&&(v.firstChild.canMoveBy=t.graphNodes[v.firstChild.child].canMoveBy=s.canMoveBy)),l=p;return o?v.levelBounds=I:("Alternate"===v.tree.type&&2<v.tree.children.length&&(o={x:C[0].rBounds.x,y:C[0].rBounds.y,right:C[C.length-1].rBounds.right,bottom:C[C.length-1].rBounds.bottom},u=this.findIntersectingLevels(t,o,n+1),this.updateRearBounds(t,null,C,n+1,u)),u=this.findIntersectingLevels(t,g||c,n+1),this.updateRearBounds(t,null,g?I:[{rBounds:c}],n+1,u)),isNaN(f)||(t.graphNodes[b.id].canMoveBy=f),v.childBounds=c,v.mid=i,c},Ru.prototype.splitChildrenInRows=function(t,e){var i,t=t.graphNodes[e.id],n=(i=4,[]),r=t.tree.children.length,o=this.extend(t.tree.children);for(t.tree.rows?(t.tree.children.length,i=(e=t.tree.rows)%2==0?e:e-1):3===t.tree.children.length||4===t.tree.children.length?i=2:5===t.tree.children.length&&(i=3);0<r;)n[n.length]=o.splice(0,i),(r-=i)<i&&(r%2==0?i=r:1!==r&&(i=r-1),r<i)&&(i=r);return n},Ru.prototype.extend=function(t){for(var e=[],i=0;i<t.length;i++)e[parseInt(i.toString(),10)]=t[parseInt(i.toString(),10)];return e},Ru.prototype.findOffset=function(t,e,i,n){var r=0,o=-1!==t.orientation.indexOf("Left")?e.actualSize.height:e.actualSize.width,e=n||i.tree.type,r=i.tree.offset||20;switch("Alternate"===i.tree.type&&r>=t.horizontalSpacing&&(r=t.horizontalSpacing/2),e){case"Left":r=o/2-r;break;case"Right":r+=o/2}return r},Ru.prototype.uniteRects=function(t,e){t.x=Math.min(t.x,e.x),t.right=Math.max(t.right,e.right),t.bottom=Math.max(t.bottom,e.bottom)},Ru.prototype.spaceLeftFromPrevSubTree=function(t,e,i){for(var n,r=t.graphNodes[e.id],o=t.horizontalSpacing,a=0;a<r.intersect.length;a++)n=t.levels[r.intersect[parseInt(a.toString(),10)]].rBounds,n=i.x-(n.right+o),(void 0===r.diff||n<r.diff)&&(r.diff=n,r.prevBounds=t.levels[r.intersect[parseInt(a.toString(),10)]].rBounds)},Ru.prototype.findIntersectingLevels=function(t,e,i,n){var r={x:e.x,y:e.y,right:e.right,bottom:e.bottom},o=(r.y-=t.verticalSpacing/2,r.bottom+=t.verticalSpacing/2,[]),a=void 0!==n?n:i,s=t.levels[parseInt(a.toString(),10)]?t.levels[parseInt(a.toString(),10)].rBounds:null;do{if(s&&(r.y<s.y&&r.bottom>s.y||r.y<s.bottom&&s.bottom<r.bottom||r.y>=s.y&&r.bottom<=s.bottom||r.y<s.y&&r.bottom>s.bottom))o.splice(0,0,a);else if(s&&s.bottom<r.y)break}while(a--,s=t.levels[parseInt(a.toString(),10)]?t.levels[parseInt(a.toString(),10)].rBounds:null,0<=a);a=(void 0!==n?n:i)+1,s=t.levels[parseInt(a.toString(),10)]?t.levels[parseInt(a.toString(),10)].rBounds:null;do{if(s&&(r.y<s.y&&r.bottom>s.y||r.y<s.bottom&&s.bottom<r.bottom||r.y>=s.y&&r.bottom<=s.bottom||r.y<s.y&&r.bottom>s.bottom))o.push(a);else if(s&&s.y>r.bottom)break}while(a++,s=t.levels[parseInt(a.toString(),10)]?t.levels[parseInt(a.toString(),10)].rBounds:null,a<=t.levels.length);return o},Ru.prototype.findLevel=function(t,e,i){for(var n=e,r=0,o=t.levels[parseInt(r.toString(),10)]?t.levels[parseInt(r.toString(),10)].rBounds:null;r<t.levels.length;){if(o&&n.bottom<o.y)return r;r++,o=t.levels[parseInt(r.toString(),10)]?t.levels[parseInt(r.toString(),10)].rBounds:null}return r},Ru.prototype.getParentNode=function(t,e){return t.nameTable[t.nameTable[e.inEdges[0]].sourceID]},Ru.prototype.updateEdges=function(t,e,i,n,r){var o,a=t.graphNodes[e.id];if(e.outEdges&&e.outEdges.length&&(e.isExpanded||n===Z.DiagramAction.Render))for(o=0;o<e.outEdges.length;o++){var s=t.nameTable[t.nameTable[e.outEdges[parseInt(o.toString(),10)]].targetID];s&&!s.excludeFromLayout&&(-1===a.tree.children.indexOf(s.id)&&a.tree.children.push(s.id),s.outEdges&&s.outEdges.length&&s.isExpanded&&(a.tree.hasSubTree=!0),this.updateEdges(t,s,i+1,n,r))}a.tree.level=i,a.tree.hasSubTree&&(a.tree.orientation="Horizontal",a.tree.type="Center"),(t.getLayoutInfo||t.layoutInfo)&&"OrganizationalChart"===t.type&&(t.getLayoutInfo?t.getLayoutInfo(e,a.tree):hh(a.tree,t.layoutInfo,r,e),"Balanced"===a.tree.type)&&a.tree.hasSubTree&&(a.tree.type="Center",a.tree.orientation="Horizontal"),t.level&&"Alternate"!==a.tree.type&&i>=t.level&&(a.tree.hasSubTree=!1)},Ru.prototype.updateAnchor=function(t,e,i){var n,r,o,a=0,s=0,i=new k(0,0,i.x,i.y),h=t.bounds||i,d=t.orientation;if(t.fixedNode){r=(i=t.nameTable[t.fixedNode]).actualSize.width,o=i.actualSize.height,t.anchorX=i.offsetX,t.anchorY=i.offsetY;var l=i.pivot;for(t.anchorX+="RightToLeft"===t.orientation?r*l.x:-r*l.x,t.anchorY+="BottomToTop"===t.orientation?o*l.y:-o*l.y,n=i,a=0;n.inEdges.length;)n=this.getParentNode(t,n),a+=t.graphNodes[n.id].subTreeTranslation||0;-1!==t.orientation.indexOf("Left")?(s=t.graphNodes[i.id].y,"LeftToRight"===d?t.anchorX-=s:t.anchorX+=s,t.anchorY-=t.graphNodes[i.id].x+a):(s=t.graphNodes[i.id].y,t.anchorX-=t.graphNodes[i.id].x+a,"TopToBottom"===d?t.anchorY-=s:t.anchorY+=s)}else if("TopToBottom"===d||"BottomToTop"===d){switch(t.horizontalAlignment){case"Left":t.anchorX=h.x-e.x+t.margin.left;break;case"Right":t.anchorX=h.x+h.width-t.margin.right-e.right;break;case"Auto":case"Center":t.anchorX=h.x+h.width/2-(e.x+e.right)/2}switch(t.verticalAlignment){case"Auto":case"Top":var c=h.y+t.margin.top;t.anchorY="TopToBottom"===d?c:e.bottom+c;break;case"Bottom":c=h.y+h.height-t.margin.bottom;t.anchorY="TopToBottom"===d?c-e.bottom:c;break;case"Center":var p=void 0;p=h.y+h.height/2,t.anchorY="TopToBottom"===t.orientation?p-(e.y+e.bottom)/2:p+(e.y+e.bottom)/2}}else{switch(t.horizontalAlignment){case"Auto":case"Left":var g=h.x+t.margin.left;t.anchorX="LeftToRight"===d?g:e.bottom+g;break;case"Right":g=h.x+h.width-t.margin.right;t.anchorX="LeftToRight"===d?g-e.bottom:g;break;case"Center":p=void 0;p=h.width/2+h.x,t.anchorX="LeftToRight"===t.orientation?p-(e.y+e.bottom)/2:p+(e.y+e.bottom)/2}switch(t.verticalAlignment){case"Top":t.anchorY=h.y+t.margin.top-e.x;break;case"Auto":case"Center":t.anchorY=h.y+h.height/2-(e.right+e.x)/2;break;case"Bottom":t.anchorY=h.y+h.height-t.margin.bottom-e.right}}},Ru.prototype.updateConnectors=function(t,e,i){var n,r,o,a=t.graphNodes[e.id];if(e.outEdges.length)for(n=0;n<e.outEdges.length;n++)(o=t.nameTable[e.outEdges[parseInt(n.toString(),10)]]).points=[],r=t.nameTable[o.targetID],o.visible&&(o.visited=!0,t.getConnectorSegments?t.getConnectorSegments(o):a&&-1!==a.tree.children.indexOf(o.targetID)&&(o.segments=[],"Bezier"===o.type&&"SamePoint"===t.connectionPointOrigin&&o.segments.push(new Xa(o,"segments",{type:"Bezier"},!0)),"OrganizationalChart"===t.type)&&"Orthogonal"===o.type&&this.updateSegments(t,o,e,r,n),r)&&(r.isExpanded||this.hasChild(t,r))&&this.updateConnectors(t,r,i+1);if(a&&a.tree.assistants.length)for(n=0;n<a.tree.assistants.length;n++)r=t.nameTable[a.tree.assistants[parseInt(n.toString(),10)]],o=t.nameTable[r.inEdges[0]],this.get3Points(t,e,r,o),(r.isExpanded||this.hasChild(t,r))&&this.updateConnectors(t,r,i+1)},Ru.prototype.updateSegments=function(t,e,i,n,r){var o=t.graphNodes[i.id];o.tree.assistants.length?this.updateSegmentsForHorizontalOrientation(t,i,n,e):"Horizontal"===o.tree.orientation&&"Balanced"===o.tree.type?this.updateSegmentsForBalancedTree(t,e,i,n,r):"Horizontal"===o.tree.orientation?this.updateSegmentsForHorizontalOrientation(t,i,n,e):o.tree.offset<5?this.get5Points(t,i,n,e):this.get3Points(t,i,n,e)},Ru.prototype.updateSegmentsForBalancedTree=function(t,e,i,n,r){var o,a,s=t.graphNodes[i.id];5===s.tree.children.length&&2<r?(o=s.tree.children[1],isNaN(t.graphNodes[""+o].treeWidth)&&(t.graphNodes[""+o].treeWidth=t.nameTable[""+o].actualSize.width),a=3!==r?1:-1,-1!==t.orientation.indexOf("Left")?(t.nameTable[""+o].offsetY,t.graphNodes[""+o].treeWidth,t.verticalSpacing):(t.nameTable[""+o].offsetX,t.graphNodes[""+o].treeWidth,t.horizontalSpacing),this.getSegmentsForMultipleRows(t,i,n,e)):5<s.tree.children.length?r<4||r<s.tree.rows?this.getSegmentsForMultipleRows(t,i,n,e):this.updateSegmentsForHorizontalOrientation(t,i,n,e):4!==s.tree.children.length||r<2||r<s.tree.rows?this.getSegmentsForMultipleRows(t,i,n,e):this.updateSegmentsForHorizontalOrientation(t,i,n,e)},Ru.prototype.get3Points=function(t,e,i,n){var r,o,a=[],s=this.getBounds(e),h=this.getBounds(i);-1!==t.orientation.indexOf("Top")?(r=0===t.orientation.indexOf("Top")?s.bottomCenter:s.topCenter,o=e.offsetX>i.offsetX?h.middleRight:h.middleLeft,a.push(r,{x:s.bottomCenter.x,y:o.y},o)):(r=0===t.orientation.indexOf("Left")?s.middleRight:s.middleLeft,o=e.offsetY>i.offsetY?h.bottomCenter:h.topCenter,a.push(r,{x:h.bottomCenter.x,y:s.middleRight.y},o)),this.getSegmentsFromPoints(a,n)},Ru.prototype.get5Points=function(t,e,i,n){var r,o,a,s,h=[],d=this.getBounds(e),l=this.getBounds(i);-1!==t.orientation.indexOf("Top")?(r=e.offsetY<i.offsetY?d.bottomCenter:d.topCenter,s=t.verticalSpacing/4*(e.offsetY<i.offsetY?1:-1),a=t.horizontalSpacing/2*(e.offsetX>i.offsetX?1:-1),o=e.offsetX>i.offsetX?l.middleRight:l.middleLeft,h.push(r,{x:r.x,y:r.y+s},{x:o.x+a,y:r.y+s},{x:o.x+a,y:o.y},o)):(r=e.offsetX>i.offsetX?d.middleLeft:d.middleRight,o=e.offsetY>i.offsetY?l.bottomCenter:l.topCenter,a=t.horizontalSpacing/4*(e.offsetX<i.offsetX?1:-1),s=t.verticalSpacing/2*(e.offsetY>i.offsetY?1:-1),h.push(r,{x:r.x+a,y:r.y},{x:r.x+a,y:r.y+s},{x:o.x,y:r.y+s},o)),this.getSegmentsFromPoints(h,n)},Ru.prototype.getSegmentsFromPoints=function(t,e){for(var i,n=[],r=0;r<t.length-2;r++)(i=new Ua(e,"segments",{type:"Orthogonal"},!0)).direction=K.direction(t[parseInt(r.toString(),10)],t[r+1]),i.length=K.distancePoints(t[parseInt(r.toString(),10)],t[r+1]),n.push(i);e.segments=n},Ru.prototype.getSegmentsForMultipleRows=function(t,e,i,n){var r=[],o=this.getBounds(i),a=this.getBounds(e);switch(t.orientation){case"TopToBottom":d={x:a.bottomCenter.x,y:a.bottomCenter.y+t.verticalSpacing/4},(h=new Ua(n,"segments",{type:"Orthogonal"},!0)).direction=K.direction(a.bottomCenter,d),h.length=K.distancePoints(a.bottomCenter,d),r.push(h);break;case"BottomToTop":d={x:a.bottomCenter.x,y:a.topCenter.y-t.verticalSpacing/4},(h=new Ua(n,"segments",{type:"Orthogonal"},!0)).direction=K.direction(a.topCenter,d),h.length=K.distancePoints(a.topCenter,d),r.push(h);break;case"LeftToRight":var s,h,d={x:a.middleRight.x+t.verticalSpacing/4,y:a.middleRight.y};(h=new Ua(n,"segments",{type:"Orthogonal"},!0)).direction=K.direction(a.middleRight,d),h.length=K.distancePoints(a.middleRight,d),r.push(h),o.center.y!==a.center.y&&(s={x:a.middleRight.x+t.verticalSpacing/4,y:o.middleLeft.y},(h=new Ua(n,"segments",{type:"Orthogonal"},!0)).direction=K.direction(d,s),h.length=K.distancePoints(d,s),r.push(h));break;case"RightToLeft":d={x:a.middleLeft.x-t.verticalSpacing/4,y:a.middleRight.y},(h=new Ua(n,"segments",{type:"Orthogonal"},!0)).direction=K.direction(a.middleLeft,d),h.length=K.distancePoints(a.middleLeft,d),r.push(h),o.center.y!==a.center.y&&(s={x:a.middleLeft.x-t.verticalSpacing/4,y:o.middleLeft.y},(h=new Ua(n,"segments",{type:"Orthogonal"},!0)).direction=K.direction(s,s),h.length=K.distancePoints(s,s),r.push(h))}n.segments=r},Ru.prototype.updateSegmentsForHorizontalOrientation=function(t,e,i,n){var r=[],o=this.getBounds(e),a=this.getBounds(i);switch(t.orientation){case"TopToBottom":d={x:o.bottomCenter.x,y:a.topCenter.y-t.verticalSpacing/2},(h=new Ua(n,"segments",{type:"Orthogonal"},!0)).direction=K.direction(o.bottomCenter,d),h.length=K.distancePoints(o.bottomCenter,d),r.push(h);break;case"BottomToTop":d={x:o.topCenter.x,y:a.bottomCenter.y+t.verticalSpacing/2},(h=new Ua(n,"segments",{type:"Orthogonal"},!0)).direction=K.direction(o.topCenter,d),h.length=K.distancePoints(o.topCenter,d),r.push(h);break;case"LeftToRight":var s,h,d={x:a.middleLeft.x-t.verticalSpacing/2,y:o.middleRight.y};(h=new Ua(n,"segments",{type:"Orthogonal"},!0)).direction=K.direction(o.middleRight,d),h.length=K.distancePoints(o.middleRight,d),r.push(h),a.center.y!==o.center.y&&(s={x:a.middleLeft.x-t.verticalSpacing/2,y:a.middleLeft.y},(h=new Ua(n,"segments",{type:"Orthogonal"},!0)).direction=K.direction(d,s),h.length=K.distancePoints(d,s),r.push(h));break;case"RightToLeft":d={x:a.middleRight.x+t.verticalSpacing/2,y:o.middleRight.y},(h=new Ua(n,"segments",{type:"Orthogonal"},!0)).direction=K.direction(o.middleLeft,d),h.length=K.distancePoints(o.middleLeft,d),r.push(h),a.center.y!==o.center.y&&(s={x:a.middleRight.x+t.verticalSpacing/2,y:a.middleLeft.y},(h=new Ua(n,"segments",{type:"Orthogonal"},!0)).direction=K.direction(d,s),h.length=K.distancePoints(d,s),r.push(h))}return n.segments=r,[]},Ru.prototype.updateNodes=function(t,e,i,n,r,o){var a,s,h,d,l;if(e&&!e.excludeFromLayout){c=e.actualSize.width,h=e.actualSize.height,d=t.anchorX,l=t.anchorY,"LeftToRight"===t.orientation?(d+=t.graphNodes[e.id].y+c/2,l+=t.graphNodes[e.id].x+i+h/2):"RightToLeft"===t.orientation?(d-=t.graphNodes[e.id].y+c/2,l+=t.graphNodes[e.id].x+i+h/2):"TopToBottom"===t.orientation?(d+=t.graphNodes[e.id].x+i+c/2,l+=t.graphNodes[e.id].y+h/2):(d+=t.graphNodes[e.id].x+i+c/2,l-=t.graphNodes[e.id].y+h/2),t.graphNodes&&(d+=r=r||0,l+=o=o||0,this.isAnimation||(e.offsetX=d,e.offsetY=l));var c={id:e.id,differenceX:d-e.offsetX,differenceY:l-e.offsetY},p=(t.objects.push(c),[]);if(this.hasChild(t,e))for(a=0;a<t.graphNodes[e.id].tree.children.length;a++)s=t.nameTable[t.graphNodes[e.id].tree.children[parseInt(a.toString(),10)]],this.updateNodes(t,s,i+(t.graphNodes[e.id].subTreeTranslation||0),n,r,o),p.push(s);if(t.graphNodes[e.id].tree.assistants.length)for(a=0;a<t.graphNodes[e.id].tree.assistants.length;a++)s=t.nameTable[t.graphNodes[e.id].tree.assistants[parseInt(a.toString(),10)]],this.updateNodes(t,s,i+(t.graphNodes[e.id].subTreeTranslation||0),null,r,o)}};var Bu=Ru;function Ru(){this.isAnimation=!1}ju.prototype.destroy=function(){},ju.prototype.getModuleName=function(){return"MindMapChart"},ju.prototype.updateLayout=function(t,e,i,n,r,o){o=this.checkRoot(t,i,r,o,e);if(o)i.fixedNode=o;else for(var a=0,s=t;a<s.length;a++){var h=s[a];if(!(h.excludeFromLayout||h.inEdges&&h.inEdges.length)){i.fixedNode=h.id;break}}for(var o=e[i.fixedNode],d=this.findFirstLevelNodes(o,i,e),l=[],c=[],p=(p=Dp(i.getBranch))||Dp(this.getBranch),g=0,u=d;g<u.length;g++){var m=p(h=u[g],d);("Left"===(h&&h.branch?h.branch:m)?l:c).push(h)}o=new k(0,0,n.x,n.y);e[i.fixedNode].offsetX=o.x+o.width/2,e[i.fixedNode].offsetY=o.y+o.height/2,l.length&&this.updateMindMapBranch(t,c,e,i,n,r,"Left"),c.length&&this.updateMindMapBranch(t,l,e,i,n,r,"Right")},ju.prototype.checkRoot=function(t,e,i,n,r){for(var o=0,a=t;o<a.length;o++){var s=a[o];if(!s.excludeFromLayout){if(s.data&&(s.data[""+i].toString()===n||s.data[""+i].toString()===e.root))return s.id;if(!s.data&&s.id===e.root)return s.id}}return""},ju.prototype.updateMindMapBranch=function(t,e,i,n,r,o,a){n={type:"HierarchicalTree",horizontalSpacing:n.verticalSpacing,verticalSpacing:n.horizontalSpacing,verticalAlignment:n.verticalAlignment,horizontalAlignment:n.horizontalAlignment,fixedNode:n.fixedNode,getLayoutInfo:Dp(n.getLayoutInfo),layoutInfo:n.layoutInfo,margin:n.margin,orientation:n.orientation,root:n.fixedNode};n.orientation="Vertical"===n.orientation?"Left"===a?"TopToBottom":"BottomToTop":"Left"===a?"LeftToRight":"RightToLeft",this.excludeFromLayout(e,i,!0),(new Bu).updateLayout(t,i,n,r,o),this.excludeFromLayout(e,i,!1)},ju.prototype.getBranch=function(t,e){e=e.indexOf(t)%2==0?"Left":"Right";return e},ju.prototype.excludeFromLayout=function(t,e,i){for(var n=0,r=t;n<r.length;n++)e[r[n].id].excludeFromLayout=i},ju.prototype.findFirstLevelNodes=function(t,e,i){var n=[];if(t&&t.outEdges.length)for(var r=0,o=t.outEdges;r<o.length;r++){var a=o[r];n.push(i[i[""+a].targetID])}return n};var Nu=ju;function ju(){this.isAnimation=!1}Wu.prototype.destroy=function(){},Wu.prototype.getModuleName=function(){return"RadialTree"},Wu.prototype.updateLayout=function(t,e,i,n){i={type:i.type,nameTable:e,anchorX:0,anchorY:0,firstLevelNodes:[],centerNode:null,levels:[],maxLevel:0,graphNodes:{},layoutNodes:[],orientation:i.orientation,horizontalSpacing:i.horizontalSpacing,verticalSpacing:i.verticalSpacing,verticalAlignment:i.verticalAlignment,horizontalAlignment:i.horizontalAlignment,fixedNode:i.fixedNode,margin:i.margin,bounds:i.bounds,objects:[],root:i.root};this.doLayout(i,t,e,n)},Wu.prototype.doLayout=function(t,e,i,n){for(var r,o=0;o<e.length;o++)(r=e[parseInt(o.toString(),10)]).excludeFromLayout||(t.graphNodes[r.id]=this.setUpLayoutInfo(t,r),r.inEdges&&r.inEdges.length)||t.firstLevelNodes.push(r);t.root&&i[t.root]?t.centerNode=i[t.root]:t.firstLevelNodes.length&&(t.centerNode=t.firstLevelNodes[0],t.root=t.centerNode.id),t.centerNode&&(this.updateEdges(t,t.centerNode,0,i),this.depthFirstAllignment(t,t.centerNode,0,0),this.populateLevels(t),this.transformToCircleLayout(t),this.updateAnchor(t,n),this.updateNodes(t,t.centerNode,i))},Wu.prototype.updateEdges=function(t,e,i,n){var r=t.graphNodes[e.id];t.layoutNodes.push(r),r.level=i,r.visited=!0,t.maxLevel=Math.max(t.maxLevel,i);for(var o=0;o<e.outEdges.length;o++){var a=n[n[e.outEdges[parseInt(o.toString(),10)]].targetID];a.excludeFromLayout||a.visited||(r.children.push(a),this.updateEdges(t,a,i+1,n))}},Wu.prototype.depthFirstAllignment=function(i,t,e,n){var r,o=i.graphNodes[t.id];if(o.children.length){n+=300;for(var a=0;a<o.children.length;a++)e=(r=this.depthFirstAllignment(i,o.children[parseInt(a.toString(),10)],e,n)).x,n=r.y;o.children=o.children.sort(function(t,e){return i.graphNodes[t.id].x-i.graphNodes[e.id].x});var t=i.graphNodes[o.children[0].id].min,s=i.graphNodes[o.children[o.children.length-1].id].max;if(o.x=t+(s-t)/2,e=s+i.horizontalSpacing,o.segmentOffset=s+i.horizontalSpacing,o.x-=o.width/2,o.y-=o.height/2,o.min=t,o.max=s,o.x<t&&o.visited){o.x=t,e=o.x+o.width/2-(s-t)/2,o.visited=!1;for(a=0;a<o.children.length;a++)r=this.depthFirstAllignment(i,o.children[parseInt(a.toString(),10)],e,n);o.visited=!0,e=o.x+o.width+i.horizontalSpacing}e=e<(s=i.graphNodes[o.children[o.children.length-1].id].segmentOffset)?s:e,o.y=n-=300}else o.x=e,o.y=n,o.min=e,o.max=e+o.width,e+=o.width+i.horizontalSpacing;return{x:e,y:n}},Wu.prototype.populateLevels=function(r){for(var o=[],a=Math.min.apply(Math,r.layoutNodes.map(function(t){return t.x})),s=Math.max.apply(Math,r.layoutNodes.map(function(t){return t.x+t.width+r.horizontalSpacing}))-a,t=(r.levels=[],0);t<=r.maxLevel;t++)!function(e){var t={};o=(o=r.layoutNodes.filter(function(t){return t.level===e?t:null})).sort(function(t,e){return t.x-e.x}),t.min=o[0].x,t.max=o[o.length-1].x+o[o.length-1].width+r.horizontalSpacing,t.actualCircumference=0;for(var i=t.height=0;i<o.length;i++)o[parseInt(i.toString(),10)].height>t.height&&(t.height=o[parseInt(i.toString(),10)].height),t.actualCircumference+=Math.max(o[parseInt(i.toString(),10)].width,o[parseInt(i.toString(),10)].height),i!==o.length-1&&(t.actualCircumference+=r.horizontalSpacing);t.circumference=t.max-t.min,t.actualCircumference<t.circumference&&(t.circumference=(t.circumference+t.actualCircumference)/2),t.radius=t.circumference/(2*Math.PI)+t.height,t.nodes=[],1<e&&r.levels[e-1].radius+r.levels[e-1].height>=t.radius&&(t.radius=r.levels[e-1].radius+r.levels[e-1].height);for(var n=0;n<o.length;n++)o[parseInt(n.toString(),10)].ratio=Math.abs(o[parseInt(n.toString(),10)].x+o[parseInt(n.toString(),10)].width/2-a)/s,t.nodes.push(o[parseInt(n.toString(),10)]);r.levels.push(t)}(t)},Wu.prototype.transformToCircleLayout=function(t){var e=t.graphNodes[t.centerNode.id];e.x=0,e.y=0;for(var i=1;i<t.levels.length;i++)for(var n=0;n<t.levels[parseInt(i.toString(),10)].nodes.length;n++){var r=t.levels[parseInt(i.toString(),10)].nodes[parseInt(n.toString(),10)];r.x=Math.cos(360*r.ratio*Math.PI/180)*(t.levels[parseInt(i.toString(),10)].radius+t.verticalSpacing*i),r.y=Math.sin(360*r.ratio*Math.PI/180)*(t.levels[parseInt(i.toString(),10)].radius+t.verticalSpacing*i),t.anchorX=Math.min(t.anchorX,r.x),t.anchorY=Math.min(t.anchorY,r.y)}},Wu.prototype.updateAnchor=function(t,e){t.anchorX=t.centerNode.offsetX||e.x/2,t.anchorY=t.centerNode.offsetY||e.y/2},Wu.prototype.updateNodes=function(t,e,i){var n=t.graphNodes[e.id],r=n.x+t.anchorX,o=n.y+t.anchorY;e.offsetX=r,e.offsetY=o;for(var a=0;a<n.children.length;a++){var s=n.children[parseInt(a.toString(),10)];this.updateNodes(t,i[s.id],i)}},Wu.prototype.setUpLayoutInfo=function(t,e){var i={};return i.name=e.id,i.x=0,i.y=0,i.min=0,i.max=0,i.width=e.actualSize.width,i.height=e.actualSize.height,i.children=[],i.level=0,i.ratio=0,i.visited=!1,i};var Hu=Wu;function Wu(){}Yu.prototype.applyChanges=function(){this.graphNode.treeInfo.center=this.location};var _u=Yu;function Yu(t){this.velocityX=0,this.velocityY=0,this.nodes=[],this.graphNode=t;var e=Gu(this.graphNode);this.location=e.center,this.nodes=[],t.treeInfo.parents||(t.treeInfo.parents=[]),t.treeInfo.children||(t.treeInfo.children=[]),this.nodes=t.treeInfo.parents.concat(t.treeInfo.children)}Vu.prototype.destroy=function(){},Vu.prototype.getModuleName=function(){return"SymmetricalLayout"},Vu.prototype.doGraphLayout=function(t){var e=this.selectedNode,t=(e.treeInfo.Bounds=t.getModelBounds(t.nodes),e.treeInfo.GraphNodes),i=this.convertGraphNodes(t),t=i.length,t=Math.min(this.maxIteration,t*t*t);this.preLayoutNodes(i,e.treeInfo.Bounds);for(var n=0,r=t;n<r;n++)this.makeSymmetricLayout(i),this.appendForces(i);this.resetGraphPosition(i,e)},Vu.prototype.preLayoutNodes=function(t,e){for(var i=Math.max(e.width,e.height),n=i/2,r=i/2,o=2*Math.PI/t.length,a=o,s=0;s<t.length;s++){var h=t[parseInt(s.toString(),10)];this.getForceNode(h).location={x:n+i*Number(Math.cos(a).toFixed(2)),y:r+i*Number(Math.sin(a).toFixed(2))},a-=o}},Vu.prototype.doLayout=function(t){this.selectedNode=t.selectedNode,this.doGraphLayout(t)},Vu.prototype.makeSymmetricLayout=function(t){for(var e,i=0;i<t.length;i++){for(var n,r=t[parseInt(i.toString(),10)],o=(n=this.getForceNode(r)).nodes,a=0;a<o.length;a++){var s=o[parseInt(a.toString(),10)];this.calcNodesForce(n,this.getForceNode(s))}for(var h=0,d=o.length;h<d&&!(d<2);h++){var l=this.getForceNode(o[parseInt(h.toString(),10)]),c=d<=h+1?this.getForceNode(o[0]):this.getForceNode(o[h+1]),p=360/o.length/2*Math.PI/180,p=2*this.springLength*Math.sin(p);this.calcRelatesForce(l,c,p)}for(var g=0;g<t.length;g++)Zu((s=t[parseInt(g.toString(),10)]).id,o)||s.id===r.id||(e=this.getForceNode(s),this.updateNeigbour(n,e))}},Vu.prototype.appendForces=function(t){for(var e=null,i=0;i<t.length;i++){var n=t[parseInt(i.toString(),10)],n=(e=this.getForceNode(n)).location;n.x+=Math.min(e.velocityX,this.mszMaxForceVelocity.width),n.y+=Math.min(e.velocityY,this.mszMaxForceVelocity.height),e.velocityX=0,e.velocityY=0,e.location=n}},Vu.prototype.resetGraphPosition=function(t,e){for(var i={width:Number.MAX_VALUE,height:Number.MAX_VALUE},n=null,r=0;r<t.length;r++){var o=t[parseInt(r.toString(),10)],a={x:(n=this.getForceNode(o)).location.x-o.actualSize.width/2,y:n.location.y-o.actualSize.height/2};i.width=Math.min(i.width,a.x),i.height=Math.min(i.height,a.y)}for(r=0;r<t.length;r++)o=t[parseInt(r.toString(),10)],(a=(n=this.getForceNode(o)).location).x-=i.width-(e.treeInfo.location?e.treeInfo.location.x:0),a.y-=i.height-(e.treeInfo.location?e.treeInfo.location.y:0),n.location=a,n.applyChanges()},Vu.prototype.convertGraphNodes=function(t){for(var e=[],i=0,n=Object.keys(t);i<n.length;i++){var r=t[""+n[i]],o=new _u(r);r.treeInfo.tag=o,e.push(r)}return e},Vu.prototype.getForceNode=function(t){return t.treeInfo.tag},Vu.prototype.updateNeigbour=function(t,e){var i,n;null!=e&&null!=t&&(i=this.pointDistance(t.location,e.location),t=this.lineAngle(t.location,e.location),i<(n=.9*this.springLength))&&this.calcForce(i,n,t,e)},Vu.prototype.lineAngle=function(t,e){var i=0,n=e.x-t.x,e=e.y-t.y;return 0==n?i=e<=0?3*Math.PI/2:Math.PI/2:0==e?i=n<0?Math.PI:0:(i=Math.atan(e/n),n<0&&0<e||n<0&&e<0?i=Math.PI+i:0<n&&e<0&&(i=2*Math.PI+i)),i},Vu.prototype.pointDistance=function(t,e){var i=e.x-t.x,e=e.y-t.y;return Math.sqrt(i*i+e*e)},Vu.prototype.calcRelatesForce=function(t,e,i){var n=this.pointDistance(t.location,e.location),t=this.lineAngle(t.location,e.location);n<i&&this.calcForce(n,i,t,e)},Vu.prototype.updateLayout=function(t,e,i,n,r,o){(new Fu).updateLayout(t,e,i,n,r,o)},Vu.prototype.calcNodesForce=function(t,e){var i=this.pointDistance(t.location,e.location),t=this.lineAngle(t.location,e.location);(i>this.springLength||i<this.springLength)&&this.calcForce(i,this.springLength,t,e)},Vu.prototype.calcForce=function(t,e,i,n){var r=n.nodes.length,t=(t-e)*(this.springFactor/(r*r)*Math.sqrt(r)),e=Math.cos(i)*t,r=Math.sin(i)*t;n.velocityX-=e,n.velocityY-=r};var Xu=Vu;function Vu(){this.cdCOEF=.442,this.cfMAXVELOCITY=50,this.cnMAXITERACTION=1e3,this.cnSPRINGLENGTH=100,this.mszMaxForceVelocity={width:this.cfMAXVELOCITY,height:this.cfMAXVELOCITY},this.springLength=0,this.springFactor=this.cdCOEF,this.maxIteration=this.cnMAXITERACTION,this.springLength=this.cnSPRINGLENGTH}Uu.prototype.updateLayout=function(t,e,i,n,r,o){this.nameTable=n,this.nodes=t,this.connectors=e;var a=t;0<a.length&&(this.mhelperSelectedNode=Q(a[0]));for(var s=0,h=t;s<h.length;s++){var d=m=h[s];d.treeInfo={},d.treeInfo.graphType="Node",this.graphObjects.push(d)}for(var l=0,c=e;l<c.length;l++){var p=c[l];p.treeInfo={},p.treeInfo.graphType="Connector",this.graphObjects.push(p)}this.updateLayout1(this.graphObjects,i);for(var g=this.getModelBounds(a),u=0;u<a.length;u++){var m=a[parseInt(u.toString(),10)],f=(o.x-g.width)/2,y=r.margin,f=m.treeInfo.tag.location.x-(m.offsetX-m.actualSize.width/2)-g.x+f+y.left,y=m.treeInfo.tag.location.y-(m.offsetY-m.actualSize.height/2)-g.y+y.top;m.offsetX+=f,m.offsetY+=y,delete m.treeInfo}return!0},Uu.prototype.getModelBounds=function(t){t=t.slice();for(var e=null,i=0;i<t.length;i++)var n,r=Gu(n=t[parseInt(i.toString(),10)]),r=new k((n.treeInfo.tag?n.treeInfo.tag.location:r).x,(n.treeInfo.tag?n.treeInfo.tag.location:r).y,n.actualSize.width,n.actualSize.height),e=e?e.uniteRect(r):r;return e},Uu.prototype.updateLayout1=function(t,e){this.detectCyclesInGraph(t);var i=t.length;if(0<i){for(var n=[],r=[],o=[],a=0;a<t.length;a++){var s=t[parseInt(a.toString(),10)];void 0===s.treeInfo.isCycleEdge&&(s.treeInfo.isCycleEdge=!1),("Connector"!==s.treeInfo.graphType||s.treeInfo.isCycleEdge?"Connector"===s.treeInfo.graphType?n:o:r).push(s)}for(r=r.concat(o),r=n.concat(r);i>this.dictionaryLength(this.passedNodes);)this.getNodesToPosition(r),null!=this.selectedNode&&(e.doLayout(this),this.selectedNode=null,this.visitedStack=[]);this.passedNodes=null,this.selectedNode=null}return!1},Uu.prototype.getNodesToPosition=function(t){for(var e=0;e<t.length;e++){var i=t[parseInt(e.toString(),10)];this.selectNodes(i);break}},Uu.prototype.selectNodes=function(t){var e=t;"Connector"===t.treeInfo.graphType?this.exploreGraphEdge(t):null!=e&&this.addNode(t,"passed")&&(this.addNode(t,"selected"),this.isConnectedToAnotherNode(e))&&(this.selectedNode={treeInfo:{}},this.selectedNode.treeInfo.LeftMargin=10,this.selectedNode.treeInfo.TopMargin=10,this.selectConnectedNodes(e))},Uu.prototype.selectConnectedNodes=function(t){var e=this.selectedNode,i=(e.treeInfo.GraphNodes||(e.treeInfo.GraphNodes={}),t),n=(this.addNode(i,"passed"),i.id);this.dictionaryContains(e.treeInfo.GraphNodes,i)?(e=e.treeInfo.GraphNodes[""+n]).treeInfo.Added&&(e.treeInfo.Added=!1,this.getConnectedRelatives(e),this.exploreRelatives(t)):(n=this.addGraphNode(i),this.getConnectedRelatives(n),this.exploreRelatives(t))},Uu.prototype.exploreRelatives=function(t){this.exploreRelatives1(t,"Parents"),this.exploreRelatives1(t,"Children")},Uu.prototype.exploreRelatives1=function(t,e){for(var i=[],i="Parents"===e?t.inEdges:t.outEdges,n=0;n<i.length;n++){var r,o,a=this.nameTable[i[parseInt(n.toString(),10)]];this.addNode(a,"passed")&&(r=this.nameTable[a.sourceID],o=this.nameTable[a.targetID],"Parents"===e&&null!=r&&Zu(r.id,this.nodes)?this.selectConnectedNodes(this.nameTable[a.sourceID]):"Children"===e&&null!=o&&Zu(o.id,this.nodes)&&this.selectConnectedNodes(this.nameTable[a.targetID]))}},Uu.prototype.getConnectedRelatives=function(t){this.getConnectedParents(t),this.getConnectedChildren(t)},Uu.prototype.dictionaryContains=function(t,e){for(var i=Object.keys(t),n=0;n<i.length;n++)if(i[parseInt(n.toString(),10)]===e.id)return!0;return!1},Uu.prototype.dictionaryLength=function(t){return Object.keys(t).length},Uu.prototype.getConnectedChildren=function(t){for(var e=this.selectedNode,i=t,n=0;n<i.outEdges.length;n++){var r,o=this.nameTable[i.outEdges[parseInt(n.toString(),10)]];o.treeInfo.isCycleEdge||Zu((o=this.nameTable[o.targetID]).id,this.nodes)&&null!=o&&o.visible&&(r=void 0,this.dictionaryContains(e.treeInfo.GraphNodes,o)?r=e.treeInfo.GraphNodes[o.id]:(r=this.addGraphNode(o)).treeInfo.Added=!0,t.treeInfo.children||(t.treeInfo.children=[]),r.treeInfo.parents||(r.treeInfo.parents=[]),this.setNode(r.treeInfo.parents,t),this.findNode(t.treeInfo.children,r.id)<0)&&t.treeInfo.children.push(r)}},Uu.prototype.getConnectedParents=function(t){for(var e=this.selectedNode,i=t,n=0;n<i.inEdges.length;n++){var r,o=this.nameTable[i.inEdges[parseInt(n.toString(),10)]];o.treeInfo.isCycleEdge||Zu((o=this.nameTable[o.sourceID]).id,this.nodes)&&null!=o&&o.visible&&(r=void 0,this.dictionaryContains(e.treeInfo.GraphNodes,o)?r=e.treeInfo.GraphNodes[o.id]:(r=this.addGraphNode(o)).treeInfo.Added=!0,t.treeInfo.parents||(t.treeInfo.parents=[]),r.treeInfo.children||(r.treeInfo.children=[]),this.setNode(r.treeInfo.children,t),this.findNode(t.treeInfo.parents,r.id)<0)&&t.treeInfo.parents.push(r)}},Uu.prototype.setNode=function(t,e){var i=this.findNode(t,e.id);0<=i&&i<t.length?t[parseInt(i.toString(),10)]=e:t.push(e)},Uu.prototype.findNode=function(t,e){var i=-1;if(null!=t&&""!==e)for(var n=0,r=t.length;n<r;n++){var o=t[parseInt(n.toString(),10)];if(null!=o&&o.id===e){i=n;break}}return i},Uu.prototype.addGraphNode=function(t){var e=t,i=(this.selectedNode.treeInfo.GraphNodes[e.id]=e,this.mhelperSelectedNode);return null!=i&&t.id===i.id&&(this.mhelperSelectedNode=e),e},Uu.prototype.isConnectedToAnotherNode=function(t){var e=!1;return e=0<t.inEdges.concat(t.outEdges).length&&!(e=null!=t.inEdges&&0<t.inEdges.length?this.searchEdgeCollection(t.inEdges,"FromNode"):e)&&null!=t.outEdges&&0<t.outEdges.length?this.searchEdgeCollection(t.outEdges,"ToNode"):e},Uu.prototype.searchEdgeCollection=function(t,e){for(var i=!1,n=0;n<t.length-1;n++){var r=this.nameTable[t[parseInt(n.toString(),10)]];if(this.addNode(r,"passed")&&(!r.treeInfo.isCycleEdge&&("FromNode"===e&&null!=this.nameTable[r.sourceID]||"ToNode"===e&&null!=this.nameTable[r.targetID]))){i=!0;break}}return i},Uu.prototype.exploreGraphEdge=function(t){var e=t;null!=e&&!e.treeInfo.isCycleEdge&&this.addNode(t,"passed")&&(this.addNode(t,"selected"),t=this.nameTable[e.sourceID],this.nameTable[e.targetID],null!=t)&&this.selectNodes(t)},Uu.prototype.addNode=function(t,e){return"passed"!==e&&t.visible||this.dictionaryContains(this.passedNodes,t)||(this.passedNodes[t.id]=t),!!t.visible},Uu.prototype.detectCyclesInGraph=function(t){for(var e=[],i=[],n=0;n<t.length;n++)"Connector"!==t[parseInt(n.toString(),10)].treeInfo.graphType&&e.push(t[parseInt(n.toString(),10)]);if(0<e.length)for(i.push(e[0]),this.visitedStack.push(e[0]);0<i.length;){var r,o=this.getUnVisitedChildNodes(i[i.length-1]);0<o.length?(r=o[0],o=o[o.length-1],Zu(r.id,this.visitedStack)?(o.treeInfo.isCycleEdge=!0,this.cycleEdgesCollection.push(o)):(i.push(r),this.visitedStack.splice(0,0,r))):i.pop()}},Uu.prototype.getUnVisitedChildNodes=function(t){var e=[];if(0<t.outEdges.length)for(var i=0;i<t.outEdges.length;i++){var n,r=this.nameTable[t.outEdges[parseInt(i.toString(),10)]];if(!Zu(r.id,this.visitedStack))return null!=(n=this.nameTable[r.targetID])&&e.push(n),e.push(r),this.visitedStack.splice(0,0,r),e}return e};var Fu=Uu;function Uu(){this.visitedStack=[],this.cycleEdgesCollection=[],this.graphObjects=[],this.passedNodes=[]}function Gu(t){var e=t.offsetX-t.actualSize.width*t.pivot.x,i=t.offsetY-t.actualSize.height*t.pivot.y;return new k(e,i,t.actualSize.width,t.actualSize.height)}function Zu(t,e){for(var i=0;i<e.length;i++)if(e[parseInt(i.toString(),10)].id===t)return 1}qu.prototype.destroy=function(){},qu.prototype.getModuleName=function(){return"ComplexHierarchicalTree"},qu.prototype.doLayout=function(t,e,i,n,r){(new Qu).doLayout(t,e,i,n,r)},qu.prototype.getLayoutNodesCollection=function(t){for(var e,i=[],n=0;n<t.length;n++)(e=t[parseInt(n.toString(),10)]).excludeFromLayout||!(0<e.inEdges.length+e.outEdges.length||0===e.offsetX&&0===e.offsetY)||e.parentId||e.processId||i.push(e);return i};var Ku=qu;function qu(){}f.prototype.createVertex=function(t,e,i,n,r,o){return{value:e,geometry:{x:i,y:n,width:r,height:o},name:e,vertex:!0,inEdges:t.inEdges.slice(),outEdges:t.outEdges.slice()}},f.prototype.getEdges=function(t){var e=[],i=this.nameTable[t.name];if(t&&!i.excludeFromLayout){for(var n=0;0<t.inEdges.length&&n<t.inEdges.length;n++){var r=this.nameTable[t.inEdges[parseInt(n.toString(),10)]];this.nameTable[r.sourceID].excludeFromLayout||e.push(r)}for(n=0;0<t.outEdges.length&&n<t.outEdges.length;n++){r=this.nameTable[t.outEdges[parseInt(n.toString(),10)]];this.nameTable[r.targetID].excludeFromLayout||e.push(r)}}return e},f.prototype.findRoots=function(t){for(var e=[],i=null,n=-1e5,r=0,o=Object.keys(t);r<o.length;r++){for(var a=t[""+o[r]],s=this.getEdges(a),h=0,d=0,l=0;l<s.length;l++)this.getVisibleTerminal(s[parseInt(l.toString(),10)],!0).name===a.name?h++:d++;0===d&&0<h&&e.push(a);var c=h-d;n<c&&(n=c,i=a)}return 0===e.length&&null!=i&&e.push(i),e},f.prototype.getVisibleTerminal=function(t,e){var i=this.nameTable[t.targetID];e&&(i=this.nameTable[t.sourceID]);for(var n=0;n<this.vertices.length;n++)if(this.vertices[parseInt(n.toString(),10)].name===i.id)return this.vertices[parseInt(n.toString(),10)];return null},f.prototype.traverse=function(t,e,i,n,r,o){if(null!=t){var a=t.name;if(null==o||null!=o[""+a]){null==n[""+a]&&(n[""+a]=t),null!=o&&delete o[""+a];for(var s=this.getEdges(t),h=[],d=0;d<s.length;d++)h[parseInt(d.toString(),10)]=this.getVisibleTerminal(s[parseInt(d.toString(),10)],!0)===t;for(d=0;d<s.length;d++)if(!e||h[parseInt(d.toString(),10)]){for(var l,c=this.getVisibleTerminal(s[parseInt(d.toString(),10)],!h[parseInt(d.toString(),10)]),p=1,g=0;g<s.length;g++)g!==d&&(l=h[parseInt(g.toString(),10)],this.getVisibleTerminal(s[parseInt(g.toString(),10)],!l)===c)&&(l?p++:p--);0<=p&&(n=this.traverse(c,e,s[parseInt(d.toString(),10)],n,r,o))}}else if(null==n[""+a])for(d=0;d<r.length;d++){var u=r[parseInt(d.toString(),10)];if(null!=u[""+a]){for(var m=0,f=Object.keys(u);m<f.length;m++){var y=f[m];n[""+y]=u[""+y]}return r.splice(d,1),n}}}return n},f.prototype.getModelBounds=function(t){t=t.slice();for(var e=null,i=0;i<t.length;i++){var n,r,o=t[parseInt(i.toString(),10)].geometry;e?(n=Math.max(e.x+e.width,o.x+o.width),r=Math.max(e.y+e.height,o.y+o.height),e.x=Math.min(e.x,o.x),e.y=Math.min(e.y,o.y),e.width=n-e.x,e.height=r-e.y):e={x:o.x,y:o.y,width:o.width,height:o.height}}return e},f.prototype.doLayout=function(t,e,i,n,R){this.nameTable=e;for(var r,o=i.enableRouting,a={horizontalSpacing:i.horizontalSpacing,verticalSpacing:i.verticalSpacing,orientation:i.orientation,marginX:i.margin.left,marginY:i.margin.top,enableLayoutRouting:o},s=new im,h=(s.edgeMapper=[],s.diagram=R,[]),d=(this.vertices=[],{}),l=0;l<t.length;l++)if(!this.nameTable[t[parseInt(l.toString(),10)].id].excludeFromLayout){var c=this.createVertex(t[parseInt(l.toString(),10)],t[parseInt(l.toString(),10)].id,0,0,t[parseInt(l.toString(),10)].actualSize.width,t[parseInt(l.toString(),10)].actualSize.height);if(this.vertices.push(c),(0<t[parseInt(l.toString(),10)].inEdges.length||0<t[parseInt(l.toString(),10)].outEdges.length)&&h.push(t[parseInt(l.toString(),10)]),d[c.name]=c,s)for(var p=t[parseInt(l.toString(),10)].outEdges.slice(),g=0;g<p.length;g++){var N=e[p[parseInt(g.toString(),10)]];s.setEdgeMapper({key:N,value:[]})}}for(var u=[],m=this.findRoots(d),l=0;l<m.length;l++){var f={};u.push(f),this.traverse(m[parseInt(l.toString(),10)],!0,null,f,u,d)}for(var y,v={marginX:0,marginY:0},b=[],S=!1,l=0;l<u.length;l++){for(var f=u[parseInt(l.toString(),10)],w=0,x=Object.keys(f);w<x.length;w++){var I=x[w];b.push(f[""+I])}("Linear"===i.arrangement&&l===u.length-1||o)&&(S=!0),r=new Ju(this,b,m,a),this.cycleStage(r),this.layeringStage(r),s&&"DifferentPoint"===i.connectionPointOrigin||S?(s.arrangeElements(y={model:r,matrix:[],rowOffset:[],roots:[]},i),i.ranks=y.model.ranks):"Nonlinear"===i.arrangement&&(this.crossingStage(r),v=this.placementStage(r,v.marginX,v.marginY),b=[])}var C=this.getModelBounds(this.vertices);this.updateMargin(i,a,C,n);for(var P,j,A,T,D,l=0;l<this.vertices.length;l++)(B=this.vertices[parseInt(l.toString(),10)])&&((P=this.nameTable[B.name]).offsetX=0,P.offsetY=0,T=j=B.geometry.x-(P.offsetX-P.actualSize.width/2)+a.marginX,D=A=B.geometry.y-(P.offsetY-P.actualSize.height/2)+a.marginY,"BottomToTop"===a.orientation?(o&&(B.geometry.y=C.height-A-P.actualSize.height/2),D=C.height-A):"RightToLeft"===a.orientation&&(T=C.width-j),P.offsetX+=T-P.offsetX,P.offsetY+=D-P.offsetY,s.nodePropertyChange(P));if(!S)for(l=0;l<this.vertices.length;l++)this.isNodeOverLap(this.nameTable[this.vertices[parseInt(l.toString(),10)].name],i);if(s.updateLayout(n,C,i,a,h,e),o){for(var O={},M=0;M<y.matrix.length;M++)for(var H=y.matrix[parseInt(M.toString(),10)].value,E=0;E<H.length;E++)for(var W=H[parseInt(E.toString(),10)],L=0;L<W.cells.length;L++){var z=W.cells[parseInt(L.toString(),10)];"internalVertex"===this.getType(z.type)&&(O[z.id]=z)}this.updateRankValuess(r);for(var l=0,_=Object.keys(O);l<_.length;l++){I=_[parseInt(l.toString(),10)];this.setVertexLocationValue(O[""+I],i.orientation,C)}this.localEdgeProcessing(r,O),this.assignRankOffset(r),this.updateEdgeSetXYValue(r);for(var k=this.getValues(r.edgeMapper),l=0;l<k.length;l++){if(0<k[parseInt(l.toString(),10)].x.length)for(g=0;g<k[parseInt(l.toString(),10)].x.length;g++)"RightToLeft"!==i.orientation&&"LeftToRight"!==i.orientation?k[parseInt(l.toString(),10)].x[parseInt(g.toString(),10)]=k[parseInt(l.toString(),10)].x[parseInt(g.toString(),10)]+a.marginX:(i.orientation,k[parseInt(l.toString(),10)].x[parseInt(g.toString(),10)]=k[parseInt(l.toString(),10)].x[parseInt(g.toString(),10)]+i.verticalSpacing/2);this.setEdgePosition(k[parseInt(l.toString(),10)],r,a)}for(var B,M=0;M<this.vertices.length;M++)1<(B=this.vertices[parseInt(M.toString(),10)]).outEdges.length&&this.updateMultiOutEdgesPoints(B)}},f.prototype.setEdgeXY=function(t,e,i,n){if(t&&e.source.id){for(var r=void 0,o=void 0,a=0;a<t.length;a++)for(var s=0;s<t[parseInt(a.toString(),10)].length;s++)t[parseInt(a.toString(),10)][parseInt(s.toString(),10)].id!==e.target.id&&t[parseInt(a.toString(),10)][parseInt(s.toString(),10)].id!==e.source.id||(t[parseInt(a.toString(),10)][parseInt(s.toString(),10)].id===e.target.id&&void 0===r&&(r=a),t[parseInt(a.toString(),10)][parseInt(s.toString(),10)].id===e.source.id&&void 0===o&&(o=a));for(var h=void 0,d=r;d<=o;d++)void 0!==(h=void 0===h?this[d+"_RankOffset"]:h)&&h<this[d+"_RankOffset"]&&(h=this[d+"_RankOffset"]);void 0===this.edges&&(this.edges={}),this.edges[e.ids[0]]={x:e.x,y:0};i=this.resetOffsetXValue(h,i/10);e.x[n-e.minRank-1]=i;for(s=0;s<e.edges.length;s++)e.edges[parseInt(s.toString(),10)].levelSkip=!0}},f.prototype.resetOffsetXValue=function(t,e){for(var i=0,n=Object.keys(this.edges);i<n.length;i++)for(var r=n[parseInt(i.toString(),10)],o=this.edges[""+r].x,a=0;a<o.length;a++)if(this.edges[""+r].x[parseInt(a.toString(),10)]===t)return this.resetOffsetXValue(t+e,e);return t},f.prototype.setEdgePosition=function(t,e,i){var n=0;if(101207!==t.temp[0]){void 0===t.maxRank&&(t.maxRank=-1),void 0===t.minRank&&(t.minRank=-1);var r=t.maxRank,o=t.minRank,a=(r===o&&(r=t.source.maxRank,o=t.target.minRank),0),s=this.jettyPositions[t.ids[0]],h=(void 0===t.isReversed?t.isReversed=!1:t.isReversed=!0,(t.isReversed?t.target:t.source).cell),d=!1;"TopToBottom"===e.layout.orientation||"LeftToRight"===e.layout.orientation?("TopToBottom"===e.layout.orientation&&(d=!1),"LeftToRight"===e.layout.orientation&&(d=(t.isReversed,!1))):t.isReversed||(d=!0);for(var l=0;l<t.edges.length;l++){var c=t.edges[parseInt(l.toString(),10)],p=this.getVisibleTerminal(c,!0),g=[],u=t.isReversed,p=(p!==h&&(u=!u),null!=s&&(v=u?2:0,S=u?(d?this.rankBottomY:this.rankTopY)[parseInt(o.toString(),10)]:(d?this.rankTopY:this.rankBottomY)[parseInt(r.toString(),10)],b=s[4*a+1+v],u!==d&&(b=-b),"TopToBottom"!==i.orientation&&"BottomToTop"!==i.orientation||(S+=b),w=s[4*a+v],"TopToBottom"===i.orientation||"BottomToTop"===i.orientation?g.push(this.getPointvalue(w,S+i.marginY)):"LeftToRight"===i.orientation?g.push(this.getPointvalue(S+b,w+i.marginY)):g.push(this.getPointvalue(S,w+i.marginY))),t.x.length-1),m=-1,f=-1,y=t.maxRank-1;u&&(p=0,m=t.x.length,y=t.minRank+(f=1));for(var v,b,S,w,x=p;t.maxRank!==t.minRank&&x!==m;x+=f){var I,C=t.x[parseInt(x.toString(),10)]+n,P=(this.rankTopY[parseInt(y.toString(),10)]+this.rankBottomY[y+1])/2,A=(this.rankTopY[y-1]+this.rankBottomY[parseInt(y.toString(),10)])/2;u&&(I=P,P=A,A=I),"TopToBottom"===i.orientation||"BottomToTop"===i.orientation?(g.push(this.getPointvalue(C,P+i.marginY)),g.push(this.getPointvalue(C,A+i.marginY))):(g.push(this.getPointvalue(P,C+i.marginY)),g.push(this.getPointvalue(A,C+i.marginY))),this.limitX=Math.max(this.limitX,C),y+=f}null!=s&&(v=u?2:0,p=u?(d?this.rankTopY:this.rankBottomY)[parseInt(r.toString(),10)]:(d?this.rankBottomY:this.rankTopY)[parseInt(o.toString(),10)],b=s[4*a+3-v],S=p-(b=u!==d?-b:b),w=s[4*a+2-v],"TopToBottom"===i.orientation||"BottomToTop"===i.orientation?g.push(this.getPointvalue(w,S+i.marginY)):g.push(this.getPointvalue(S,w+i.marginY))),this.setEdgePoints(c,g,e),n=0===n?this.parallelEdgeSpacing:0<n?-n:-n+this.parallelEdgeSpacing,a++}t.temp[0]=101207}},f.prototype.getPointvalue=function(t,e){return{x:Number(t)||0,y:Number(e)||0}},f.prototype.updateEdgeSetXYValue=function(t){if(t.layout.enableLayoutRouting){var e=!1;"LeftToRight"!==t.layout.orientation&&"RightToLeft"!==t.layout.orientation||(e=!0);for(var i=0;i<t.ranks.length;i++)for(var n=t.ranks[parseInt(i.toString(),10)],r=0;r<n.length;r++){var o,a,s=n[parseInt(r.toString(),10)];s.edges&&0<s.edges.length&&(o=0<t.layout.horizontalSpacing?t.layout.horizontalSpacing/2:15,a=!0,a=(s.minRank===i-1||s.maxRank===i-1)&&a)&&this.setXY(s,i,void 0,!!e,t.ranks,o)}}},f.prototype.getPreviousLayerConnectedCells=function(t,e){if(null==e.previousLayerConnectedCells){e.previousLayerConnectedCells=[],e.previousLayerConnectedCells[0]=[];for(var i=0;i<e.connectsAsSource.length;i++){var n=e.connectsAsSource[parseInt(i.toString(),10)];-1===n.minRank||n.minRank===t-1?e.previousLayerConnectedCells[0].push(n.target):e.previousLayerConnectedCells[0].push(n)}}return e.previousLayerConnectedCells[0]},f.prototype.compare=function(t,e){if(null!=t&&null!=e){if(e.weightedValue>t.weightedValue)return-1;if(e.weightedValue<t.weightedValue)return 1}return 0},f.prototype.localEdgeProcessing=function(t,e){for(var i=0;i<t.ranks.length;i++)for(var n=t.ranks[parseInt(i.toString(),10)],r=0;r<n.length;r++){var o=n[parseInt(r.toString(),10)];if(this.crossReduction.isVertex(o))for(var a=this.getPreviousLayerConnectedCells(i,o),s=i-1,h=0;h<2;h++){if(-1<s&&s<t.ranks.length&&null!=a&&0<a.length){for(var d=[],l=0;l<a.length;l++){var c=this.weightedCellSorter(a[parseInt(l.toString(),10)],this.getX(s,a[parseInt(l.toString(),10)]));d.push(c)}d.sort(this.compare),o.width=e[o.id].cell.geometry.width,o.height=e[o.id].cell.geometry.height;for(var p=void 0,g=(p="TopToBottom"===t.layout.orientation||"BottomToTop"===t.layout.orientation?(o.x[0]=e[o.id].cell.geometry.x+e[o.id].cell.geometry.width/2,o.x[0]-o.width/2+e[o.id].cell.geometry.height/2):(o.x[0]=e[o.id].cell.geometry.y,o.x[0]))+o.width,u=0,m=[],l=0;l<d.length;l++){var f=d[parseInt(l.toString(),10)].cell,y=void 0;if(this.crossReduction.isVertex(f))for(var y=0===h?o.connectsAsSource:o.connectsAsTarget,v=0;v<y.length;v++)y[parseInt(v.toString(),10)].source!==f&&y[parseInt(v.toString(),10)].target!==f||(u+=y[parseInt(v.toString(),10)].edges.length,m.push(y[parseInt(v.toString(),10)]));else u+=f.edges.length,m.push(f)}var b=(u+1)*this.previousEdgeDistance;o.width>b+2*this.previousEdgeDistance&&(p+=this.previousEdgeDistance,g-=this.previousEdgeDistance);for(var S=(g-p)/u,w=p+S/2,x=this.minEdgeJetty-this.previousEdgeOffset,l=0;l<m.length;l++){var I=m[parseInt(l.toString(),10)].edges.length,C=(void 0===this.jettyPositions&&(this.jettyPositions={}),this.jettyPositions[m[parseInt(l.toString(),10)].ids[0]]);null==C&&(C=[],this.jettyPositions[m[parseInt(l.toString(),10)].ids[0]]=C),l<u/2?x+=this.previousEdgeOffset:u/2<l&&(x-=this.previousEdgeOffset);for(var P=0;P<I;P++)C[4*P+2*h]=w,w+=S,C[4*P+2*h+1]=x}}a=this.getNextLayerConnectedCells(i,o),s=i+1}}},f.prototype.updateMultiOutEdgesPoints=function(t){for(var e=0;e<t.outEdges.length/2;e++){var i=this.nameTable[t.outEdges[parseInt(e.toString(),10)]],n=this.nameTable[t.outEdges[t.outEdges.length-(e+1)]];i.sourceID!==n.targetID&&i.targetID!==n.sourceID&&(n.geometry.points[0].y=i.geometry.points[0].y)}},f.prototype.getNextLayerConnectedCells=function(t,e){if(null==e.nextLayerConnectedCells){e.nextLayerConnectedCells=[],e.nextLayerConnectedCells[0]=[];for(var i=0;i<e.connectsAsTarget.length;i++){var n=e.connectsAsTarget[parseInt(i.toString(),10)];-1===n.maxRank||n.maxRank===t+1?e.nextLayerConnectedCells[0].push(n.source):e.nextLayerConnectedCells[0].push(n)}}return e.nextLayerConnectedCells[0]},f.prototype.getX=function(t,e){return this.crossReduction.isVertex(e)?e.x[0]:this.crossReduction.isVertex(e)?0:e.x[t-e.minRank-1]||e.temp[t-e.minRank-1]},f.prototype.getGeometry=function(t){return t.geometry},f.prototype.setEdgePoints=function(t,e,i){if(null!=t){var n=this.getGeometry(t);if(null!=e)for(var r=0;r<e.length;r++)e[r].x=e[r].x,e[r].y=e[r].y;n.points=e,t.geometry=n}},f.prototype.assignRankOffset=function(t){if(t)for(var e=0;e<t.ranks.length;e++)this.rankCoordinatesAssigment(e,t)},f.prototype.rankCoordinatesAssigment=function(t,e){for(var i,n=e.ranks[parseInt(t.toString(),10)],r=e.layout.horizontalSpacing,o=0;o<n.length;o++)void 0===this[t+"_RankOffset"]&&(this[t+"_RankOffset"]=0),i=n[parseInt(o.toString(),10)].x[0],this[t+"_RankOffset"]<i&&(this[t+"_RankOffset"]=i+n[parseInt(o.toString(),10)].width/2+r)},f.prototype.getType=function(t){return"internalVertex"===t?"internalVertex":"internalEdge"},f.prototype.updateRankValuess=function(t){this.rankTopY=[],this.rankBottomY=[];for(var e=0;e<t.ranks.length;e++)this.rankTopY[parseInt(e.toString(),10)]=Number.MAX_VALUE,this.rankBottomY[parseInt(e.toString(),10)]=-Number.MAX_VALUE},f.prototype.setVertexLocationValue=function(t,e,i){var n=t.cell.geometry,r="TopToBottom"===e||"BottomToTop"===e?(n.x,n.y):(n.y,n.x);"RightToLeft"===e?(n.y,r=i.width-n.x-n.height,this.rankBottomY[t.minRank]=Math.max(this.rankBottomY[t.minRank],r),this.rankTopY[t.minRank]=Math.min(this.rankTopY[t.minRank],r+n.height)):(this.rankTopY[t.minRank]=Math.min(this.rankTopY[t.minRank],r),this.rankBottomY[t.minRank]=Math.max(this.rankBottomY[t.minRank],r+n.height))},f.prototype.calculateRectValue=function(t){var e={x:0,y:0,right:0,bottom:0,height:0,width:0};return e.x=t.offsetX-t.actualSize.width/2,e.right=t.offsetX+t.actualSize.width/2,e.y=t.offsetY-t.actualSize.height/2,e.bottom=t.offsetY+t.actualSize.height/2,e},f.prototype.isNodeOverLap=function(t,e){for(var i,n=0;n<this.vertices.length;n++){var r=this.nameTable[this.vertices[parseInt(n.toString(),10)].value];t.id!==r.id&&0!==r.offsetX&&0!==r.offsetY&&(i=this.calculateRectValue(t),r=this.calculateRectValue(r),this.isIntersect(r,i,e))&&("TopToBottom"===e.orientation||"BottomToTop"===e.orientation?t.offsetX+=e.horizontalSpacing:t.offsetY+=e.verticalSpacing,this.isNodeOverLap(t,e))}},f.prototype.isIntersect=function(t,e,i){return!(Math.floor(t.right+i.horizontalSpacing)<=Math.floor(e.x)||Math.floor(t.x-i.horizontalSpacing)>=Math.floor(e.right)||Math.floor(t.y-i.verticalSpacing)>=Math.floor(e.bottom)||Math.floor(t.bottom+i.verticalSpacing)<=Math.floor(e.y))},f.prototype.updateMargin=function(t,e,i,n){var n={x:0,y:0,width:n.x,height:n.y},r=i.x,o=i.y,a=i.x+i.width,s=i.y+i.height,h=t.bounds||n;if("TopToBottom"===e.orientation||"BottomToTop"===e.orientation){switch(t.horizontalAlignment){case"Auto":case"Left":e.marginX=h.x-r+t.margin.left;break;case"Right":e.marginX=h.x+h.width-t.margin.right-a;break;case"Center":e.marginX=h.x+h.width/2-(r+a)/2}switch(t.verticalAlignment){case"Top":var d=h.y+t.margin.top;e.marginY="TopToBottom"===e.orientation?d:-d;break;case"Bottom":d=h.y+h.height-t.margin.bottom;e.marginY="TopToBottom"===e.orientation?d-s:-(d-s);break;case"Auto":case"Center":var l=h.y+h.height/2;e.marginY="TopToBottom"===e.orientation?l-(o+s)/2:(o+s)/2-l}}else{switch(t.horizontalAlignment){case"Auto":case"Left":var c=h.x+t.margin.left;e.marginX="LeftToRight"===e.orientation?c:-c;break;case"Right":c=h.x+h.width-t.margin.right;e.marginX="LeftToRight"===e.orientation?c-a:a-c;break;case"Center":l=void 0;l=h.width/2+h.x,e.marginX="LeftToRight"===e.orientation?l-(o+s)/2:(r+a)/2-l}switch(t.verticalAlignment){case"Top":e.marginY=h.y+t.margin.top-o;break;case"Auto":case"Center":e.marginY=h.y+h.height/2-(o+s)/2;break;case"Bottom":e.marginY=h.y+h.height-t.margin.bottom-s}}},f.prototype.placementStage=function(t,e,i){e=this.coordinateAssignment(e,i,parent,t);return e.model=t,e.widestRankValue=null,this.placementStageExecute(e),{marginX:e.marginX+t.layout.horizontalSpacing,marginY:e.marginY+t.layout.verticalSpacing}},f.prototype.coordinateAssignment=function(t,e,i,n){var r={};return"TopToBottom"===n.layout.orientation||"BottomToTop"===n.layout.orientation?(r.horizontalSpacing=n.layout.horizontalSpacing,r.verticalSpacing=n.layout.verticalSpacing):(r.horizontalSpacing=n.layout.verticalSpacing,r.verticalSpacing=n.layout.horizontalSpacing),r.orientation="north",r.marginX=r.marginX=t,r.marginY=r.marginY=e,r},f.prototype.calculateWidestRank=function(t,e,i){var n=!1,r=("LeftToRight"!==t.model.layout.orientation&&"RightToLeft"!==t.model.layout.orientation||(n=!0),-t.verticalSpacing),o=0;t.rankSizes=[],t.rankOffset=[];for(var a=i.maxRank;0<=a;a--){for(var s=0,h=i.ranks[parseInt(a.toString(),10)],d=n?t.marginY:t.marginX,l=0;l<h.length;l++){var c,p,g=h[parseInt(l.toString(),10)];this.crossReduction.isVertex(g)?(c=g).cell&&(c.cell.inEdges||c.cell.outEdges)&&(p=this.nameTable[c.cell.name],c.width=p.actualSize.width,c.height=p.actualSize.height,s=Math.max(s,n?c.width:c.height)):g&&(p=1,null!=g.edges&&(p=g.edges.length),g.width=10*(p-1)),!n||g.height||(g.height=0),d+=(n?g.height:g.width)/2,this.setXY(g,a,d,!!n),this.setTempVariable(g,a,d),(d+=(n?g.height:g.width)/2+t.horizontalSpacing)>t.widestRankValue&&(t.widestRankValue=d,t.widestRank=a),t.rankSizes[parseInt(a.toString(),10)]=d}t.rankOffset[parseInt(a.toString(),10)]=r;var u=s/2+o/2+t.verticalSpacing,o=s;"north"===t.orientation||"west"===t.orientation?r+=u:r-=u;for(l=0;l<h.length;l++){var m=h[parseInt(l.toString(),10)];this.setXY(m,a,r,!n)}}},f.prototype.setTempVariable=function(t,e,i){this.crossReduction.isVertex(t)?t.temp[0]=i:t.temp[e-t.minRank-1]=i},f.prototype.setXY=function(t,e,i,n,r,o){t&&t.cell?0<t.cell.inEdges.length||0<t.cell.outEdges.length?n?t.y[0]=i:t.x[0]=i:n?t.y[e-t.minRank-1]=i:t.x[e-t.minRank-1]=i:this.setEdgeXY(r,t,o,e)},f.prototype.rankCoordinates=function(t,e,i,n){for(var r=!1,o=("LeftToRight"!==t.model.layout.orientation&&"RightToLeft"!==t.model.layout.orientation||(r=!0),n.ranks[parseInt(e.toString(),10)]),a=0,s=(r?t.marginY:t.marginX)+(t.widestRankValue-t.rankSizes[parseInt(e.toString(),10)])/2,h=0;h<o.length;h++){var d,l=o[parseInt(h.toString(),10)],c=(this.crossReduction.isVertex(l)?(d=this.nameTable[l.cell.name],l.width=d.actualSize.width,l.height=d.actualSize.height,a=Math.max(a,l.height)):(d=1,null!=l.edges&&(d=l.edges.length),r?l.height=10*(d-1):l.width=10*(d-1)),(r?l.height:l.width)/2);s+=c,this.setXY(l,e,s,!!r),this.setTempVariable(l,e,s),s+=c+t.horizontalSpacing}},f.prototype.initialCoords=function(t,e,i){this.calculateWidestRank(t,e,i);for(var n=t.widestRank;0<=n;n--)n<i.maxRank&&this.rankCoordinates(t,n,e,i);for(n=t.widestRank+1;n<=i.maxRank;n++)0<n&&this.rankCoordinates(t,n,e,i)},f.prototype.isAncestor=function(t,e){if(null!=e&&null!=t.hashCode&&null!=e.hashCode&&t.hashCode.length<e.hashCode.length){if(t.hashCode!==e.hashCode){if(null==t.hashCode||null==t.hashCode)return!1;for(var i=0;i<t.hashCode.length;i++)if(t.hashCode[parseInt(i.toString(),10)]!==e.hashCode[parseInt(i.toString(),10)])return!1}return!0}return!1},f.prototype.weightedCellSorter=function(t,e){var i={};return i.cell=t||null,i.weightedValue=e||0,i.visited=!1,i.rankIndex=null,i},f.prototype.minNode=function(t,e){for(var i=[],n={map:{}},r=[],o=0;o<=e.maxRank;o++){r[parseInt(o.toString(),10)]=e.ranks[parseInt(o.toString(),10)];for(var a=0;a<r[parseInt(o.toString(),10)].length;a++){var s=r[parseInt(o.toString(),10)][parseInt(a.toString(),10)],h=this.weightedCellSorter(s,o);h.rankIndex=a,h.visited=!0,i.push(h),e.setDictionaryForSorter(n,s,h,!0)}}for(var d=10*i.length,l=0;0<i.length&&l<=d;){var c=i.shift(),p=c.cell,g=c.weightedValue,u=c.rankIndex,m=this.crossReduction.getConnectedCellsOnLayer(p,g),f=this.crossReduction.getConnectedCellsOnLayer(p,g,!0),y=m?m.length:0,v=f?f.length:0,b=this.medianXValue(t,m,g+1),S=this.medianXValue(t,f,g-1),w=y+v,x=this.crossReduction.getTempVariable(p,g),w=0<w?(b*y+S*v)/w:x,S=(1===y&&1===v?w=S*v/v:1===y&&(w=b*y/y),!1),v=void 0;w<x-1?0===u||(b=r[parseInt(g.toString(),10)][u-1],(y=this.crossReduction.getTempVariable(b,g)+b.width/2+t.intraCellSpacing+p.width/2)<w)?(v=w,S=!0):y<this.crossReduction.getTempVariable(p,g)-1&&(v=y,S=!0):x+1<w&&(u===r[parseInt(g.toString(),10)].length-1||(b=r[parseInt(g.toString(),10)][u+1],w<(y=this.crossReduction.getTempVariable(b,g)-b.width/2-t.intraCellSpacing-p.width/2))?(v=w,S=!0):y>this.crossReduction.getTempVariable(p,g)+1&&(v=y,S=!0)),S&&(this.setTempVariable(p,g,v),this.updateNodeList(i,n,m,e),this.updateNodeList(i,n,f,e)),this.crossReduction.isVertex(c.cell)&&(c.visited=!1),l++}},f.prototype.updateNodeList=function(t,e,i,n){for(var r=0;r<i.length;r++){var o=i[parseInt(r.toString(),10)],o=n.getDictionaryForSorter(e,o);null!=o&&!1===o.visited&&(o.visited=!0,t.push(o))}},f.prototype.medianXValue=function(t,e,i){if(!e||0===e.length)return 0;for(var n,r=[],o=0;o<e.length;o++)r[parseInt(o.toString(),10)]=this.crossReduction.getTempVariable(e[parseInt(o.toString(),10)],i);return r.sort(function(t,e){return t-e}),e.length%2==1?r[Math.floor(e.length/2)]:(r[(n=e.length/2)-1]+r[parseInt(n.toString(),10)])/2},f.prototype.placementStageExecute=function(t){var e=!1,i=("LeftToRight"!==t.model.layout.orientation&&"RightToLeft"!==t.model.layout.orientation||(e=!0),t.jettyPositions={},t.model),n=(e?t.currentYDelta=0:t.currentXDelta=0,this.initialCoords(t,{model:i},i),this.minNode(t,i),1e8);t.maxIterations||(t.maxIterations=8);for(var r=0;r<t.maxIterations;r++){if((e?t.currentYDelta:t.currentXDelta)<n){for(var o=0;o<i.ranks.length;o++)for(var a=i.ranks[parseInt(o.toString(),10)],s=0;s<a.length;s++){var h=a[parseInt(s.toString(),10)];this.setXY(h,o,this.crossReduction.getTempVariable(h,o),!!e)}n=e?t.currentYDelta:t.currentXDelta}e?t.currentYDelta=0:t.currentXDelta=0}this.setCellLocations(t,i)},f.prototype.setCellLocations=function(t,e){for(var i=this.getValues(e.vertexMapper),n=0;n<i.length;n++)this.setVertexLocation(t,i[parseInt(n.toString(),10)])},f.prototype.garphModelsetVertexLocation=function(t,e,i,n){var r=e.geometry,o=null;return null!=r&&(o={x:i,y:n,width:r.width,height:r.height},r.x===i&&r.y===n||(e.geometry=o)),o},f.prototype.setVertexLocation=function(t,e){var i=!1,n=("LeftToRight"!==t.model.layout.orientation&&"RightToLeft"!==t.model.layout.orientation||(i=!0),e.cell),r=e.x[0]-e.width/2,o=e.y[0]-e.height/2;this.garphModelsetVertexLocation(t,n,r,o),i?(t.marginY||(t.marginY=0),t.marginY=Math.max(t.marginY,o+e.height)):(t.marginX||(t.marginX=0),t.marginX=Math.max(t.marginX,r+e.width))},f.prototype.getValues=function(t){var e=[];if(t.map)for(var i=0,n=Object.keys(t.map);i<n.length;i++){var r=n[i];e.push(t.map[""+r])}return e},f.prototype.crossingStage=function(t){this.crossReduction.execute(t)},f.prototype.layeringStage=function(t){this.initialRank(t),this.fixRanks(t)},f.prototype.initialRank=function(t){for(var e=t.startNodes,i=t.getDictionaryValues(t.vertexMapper),n=e.slice();0<e.length;){for(var r=(c=e[0]).connectsAsTarget,o=c.connectsAsSource,a=!0,s=1e8,h=0;h<r.length;h++){if(5270620!==(u=r[parseInt(h.toString(),10)]).temp[0]){a=!1;break}var d=u.source,s=Math.min(s,d.temp[0]-1)}if(a){if(c.temp[0]=s,t.maxRank||(t.maxRank=1e8),t.maxRank=Math.min(t.maxRank,s),null!=o)for(h=0;h<o.length;h++)(u=o[parseInt(h.toString(),10)]).temp[0]=5270620,-1===(d=u.target).temp[0]&&(e.push(d),d.temp[0]=-2);e.shift()}else{var l=e.shift();if(e.push(c),l===c&&1===e.length)break}}for(h=0;h<i.length;h++)i[parseInt(h.toString(),10)].temp[0]-=t.maxRank;for(h=0;h<n.length;h++)for(var c,p=0,r=(c=n[parseInt(h.toString(),10)]).connectsAsSource,g=0;g<r.length;g++){var u,d=(u=r[parseInt(g.toString(),10)]).target;c.temp[0]=Math.max(p,d.temp[0]+1),p=c.temp[0]}t.maxRank=1e8-t.maxRank},f.prototype.fixRanks=function(t){t.fixRanks()},f.prototype.cycleStage=function(t){for(var e={},i=(t.startNodes=[],t.getDictionaryValues(t.vertexMapper)),n=[],r=0;r<i.length;r++)i[parseInt(r.toString(),10)].temp[0]=-1,n[i[parseInt(r.toString(),10)].id]=i[parseInt(r.toString(),10)];var o=null;if(null!=t.roots)for(var a=t.roots,o=[],r=0;r<a.length;r++)o[parseInt(r.toString(),10)]=t.getDictionary(t.vertexMapper,a[parseInt(r.toString(),10)]),null!=o[parseInt(r.toString(),10)]&&t.startNodes.push(o[parseInt(r.toString(),10)]);t.visit("removeParentConnection",o,!0,null,{seenNodes:e,unseenNodes:n});var s=t.clone(e,null,!0);t.visit("removeNodeConnection",n,!0,s,{seenNodes:e,unseenNodes:n})},f.prototype.remove=function(t,e){var i=e.indexOf(t);return-1!==i&&e.splice(i,1),t},f.prototype.invert=function(t,e){var i=t.source;t.source=t.target,t.target=i,t.isReversed=!t.isReversed},f.prototype.getEdgesBetween=function(t,e,i){i=null!=i&&i;for(var n=this.getEdges(t),r=[],o=0;o<n.length;o++){var a=this.getVisibleTerminal(n[parseInt(o.toString(),10)],!0),s=this.getVisibleTerminal(n[parseInt(o.toString(),10)],!1);(a===t&&s===e||!i&&a===e&&s===t)&&r.push(n[parseInt(o.toString(),10)])}return r};var Qu=f;function f(){this.nameTable={},this.crossReduction=new tm,this.previousEdgeOffset=6,this.previousEdgeDistance=5,this.jettyPositions={},this.rankBottomY=null,this.limitX=null,this.rankTopY=null,this.parallelEdgeSpacing=10,this.minEdgeJetty=12}$u.prototype.resetEdge=function(t){return t.geometry={x:0,y:0,width:0,height:0,relative:!0},t},$u.prototype.createInternalCells=function(t,e,i,n){for(var r=0;r<e.length;r++){i[parseInt(r.toString(),10)]={x:[],y:[],temp:[],cell:e[parseInt(r.toString(),10)],id:e[parseInt(r.toString(),10)].name,connectsAsTarget:[],connectsAsSource:[],type:"internalVertex"},this.setDictionary(this.vertexMapper,e[parseInt(r.toString(),10)],i[parseInt(r.toString(),10)]);var o=t.getEdges(e[parseInt(r.toString(),10)]);i[parseInt(r.toString(),10)].connectsAsSource=[];for(var a=0;a<o.length;a++){var s=t.getVisibleTerminal(o[parseInt(a.toString(),10)],!1);if(s!==e[parseInt(r.toString(),10)]){var h=t.getEdgesBetween(e[parseInt(r.toString(),10)],s,!1),s=t.getEdgesBetween(e[parseInt(r.toString(),10)],s,!0);if(null!=h&&0<h.length&&2*s.length>=h.length){var d={x:[],y:[],temp:[],edges:h,ids:[]};if(n.enableLayoutRouting)for(var l=0;l<h.length;l++){var c=h[parseInt(l.toString(),10)];this.setDictionary(this.edgeMapper,void 0,d,c.id),this.resetEdge(c)}d.source=i[parseInt(r.toString(),10)];for(var p=0;p<h.length;p++)d.ids.push(h[parseInt(p.toString(),10)].id);d.source=i[parseInt(r.toString(),10)],i[parseInt(r.toString(),10)].connectsAsSource||(i[parseInt(r.toString(),10)].connectsAsSource=[]),i[parseInt(r.toString(),10)].connectsAsSource.indexOf(d)<0&&i[parseInt(r.toString(),10)].connectsAsSource.push(d)}}}i[parseInt(r.toString(),10)].temp[0]=0}},$u.prototype.fixRanks=function(){var t=[];this.ranks=[];for(var e=0;e<this.maxRank+1;e++)t[parseInt(e.toString(),10)]=[],this.ranks[parseInt(e.toString(),10)]=t[parseInt(e.toString(),10)];var i=null;if(null!=this.roots)for(var n=this.roots,i=[],e=0;e<n.length;e++){var r=n[parseInt(e.toString(),10)],r=this.getDictionary(this.vertexMapper,r);i[parseInt(e.toString(),10)]=r}this.visit("updateMinMaxRank",i,!1,null,{seenNodes:null,unseenNodes:null,rankList:t})},$u.prototype.updateMinMaxRank=function(t,e,i){var n=i.parent,r=i.root,o=i.edge,a=i.rankList;if((r.maxRank||0===r.maxRank||(r.maxRank=-1),r.minRank||0===r.minRank||(r.minRank=-1),0===e&&r.maxRank<0&&r.minRank<0&&(a[r.temp[0]].push(r),r.maxRank=r.temp[0],r.minRank=r.temp[0],r.temp[0]=a[r.maxRank].length-1),null!=n&&null!=o)&&1<n.maxRank-r.maxRank){o.maxRank=n.maxRank,o.minRank=r.maxRank,o.temp=[],o.x=[],o.y=[];for(var s=o.minRank+1;s<o.maxRank;s++)a[parseInt(s.toString(),10)].push(o),this.hierarchicalUtil.setTempVariable(o,s,a[parseInt(s.toString(),10)].length-1)}},$u.prototype.setDictionary=function(t,e,i,n){var r;return n?(r=t.map[""+n],t.map[""+n]=i):(n=e.name,r=t.map[""+n],t.map[""+n]=i),r},$u.prototype.setDictionaryForSorter=function(t,e,i,n){var e=e.id,r=t.map[""+e];return t.map[""+e]=i,r},$u.prototype.getDictionary=function(t,e){this.multiObjectIdentityCounter||0===this.multiObjectIdentityCounter||(this.multiObjectIdentityCounter=0);var i=e.name;return i?t.map[""+i]:e.layoutObjectId?t.map[e.layoutObjectId]:(e.layoutObjectId="graphHierarchyNode#"+this.multiObjectIdentityCounter++,e.layoutObjectId)},$u.prototype.getDictionaryForSorter=function(t,e){this.multiObjectIdentityCounter||0===this.multiObjectIdentityCounter||(this.multiObjectIdentityCounter=0);var i=e.id;return i?t.map[""+i]:e.layoutObjectId?t.map[e.layoutObjectId]:(e.layoutObjectId="graphHierarchyNode#"+this.multiObjectIdentityCounter++,e.layoutObjectId)},$u.prototype.getDictionaryValues=function(t){for(var e=[],i=0,n=Object.keys(t.map);i<n.length;i++){var r=n[i];e.push(t.map[""+r])}return e},$u.prototype.visit=function(t,e,i,n,r){if(null!=e){for(var o=0;o<e.length;o++){var a=e[parseInt(o.toString(),10)];null!=a&&(null==n&&(n=new Object),r.parent=null,r.root=a,r.edge=null,i?(a.hashCode=[],a.hashCode[0]=this.dfsCount,a.hashCode[1]=o,this.extendedDfs(t,n,o,0,r)):this.depthFirstSearch(t,n,0,r))}this.dfsCount++}},$u.prototype.depthFirstSearch=function(t,e,i,n){var r=n.root;if(null!=r){var o=r.id;if(null==e[""+o]){e[""+o]=r,this.updateConnectionRank(t,i,0,n);for(var a=r.connectsAsSource.slice(),s=0;s<a.length;s++){var h=a[parseInt(s.toString(),10)],d=h.target;n.parent=r,n.root=d,n.edge=h,this.depthFirstSearch(t,e,i+1,n)}}else this.updateConnectionRank(t,i,1,n)}},$u.prototype.updateConnectionRank=function(t,e,i,n){var r=n.parent,o=n.root,a=n.edge;"removeParentConnection"!==t&&"removeNodeConnection"!==t||this.removeConnectionEdge(r,o,a,e,n,"removeNodeConnection"===t),"updateMinMaxRank"===t&&this.updateMinMaxRank(e,i,n)},$u.prototype.removeConnectionEdge=function(t,e,i,n,r,o){var a=r.seenNodes,r=r.unseenNodes;this.hierarchicalUtil.isAncestor(e,t)&&(this.hierarchicalUtil.invert(i,0),this.hierarchicalUtil.remove(i,t.connectsAsSource),o?(e.connectsAsSource.push(i),t.connectsAsTarget.push(i),this.hierarchicalUtil.remove(i,e.connectsAsTarget)):(t.connectsAsTarget.push(i),this.hierarchicalUtil.remove(i,e.connectsAsTarget),e.connectsAsSource.push(i))),delete r[(a[e.id]=e).id]},$u.prototype.extendedDfs=function(t,e,i,n,r){var o=r.parent,a=r.root;r.edge;if(null!=a){null==o||null!=a.hashCode&&a.hashCode[0]===o.hashCode[0]||(s=o.hashCode.length+1,a.hashCode=o.hashCode.slice(),a.hashCode[s-1]=i);var s,o=a.id;if(null==e[""+o]){e[""+o]=a,this.updateConnectionRank(t,n,0,r);for(var h=a.connectsAsSource.slice(),d=0;d<h.length;d++){var l=h[parseInt(d.toString(),10)],c=l.target;r.parent=a,r.root=c,r.edge=l,this.extendedDfs(t,e,d,n+1,r)}}else this.updateConnectionRank(t,n,1,r)}},$u.prototype.clone=function(t,e,i){if(i=null!=i&&i,null==t||"function"!=typeof t.constructor)return null;for(var n=t.constructor(),r=0,o=Object.keys(t);r<o.length;r++){var a=o[r];"layoutObjectId"===a||!(null==e||e.indexOf(a)<0)||!i&&"object"==typeof t[""+a]||(n[""+a]=t[""+a])}return n};var Ju=$u;function $u(t,e,i,n){this.multiObjectIdentityCounter=0,this.dfsCount=0,this.hierarchicalUtil=new Qu,this.roots=i,this.vertexMapper={map:{}};var r=[];this.layout=n,this.maxRank=1e8,this.edgeMapper={map:{}},this.hierarchicalLayout=t,this.createInternalCells(t,e,r,n);for(var o=0;o<e.length;o++){for(var a=r[parseInt(o.toString(),10)].connectsAsSource,s=0;s<a.length;s++){var h,d,l=a[parseInt(s.toString(),10)],c=l.edges;null!=c&&0<c.length&&(c=c[0],h=t.getVisibleTerminal(c,!1),d=this.getDictionary(this.vertexMapper,h),r[parseInt(o.toString(),10)]===d&&(h=t.getVisibleTerminal(c,!0),d=this.getDictionary(this.vertexMapper,h)),null!=d)&&r[parseInt(o.toString(),10)]!==d&&(0===(l.target=d).connectsAsTarget.length&&(d.connectsAsTarget=[]),d.connectsAsTarget.indexOf(l)<0)&&d.connectsAsTarget.push(l)}r[parseInt(o.toString(),10)].temp[0]=1}}em.prototype.calculateCrossings=function(t){for(var e=t.ranks.length,i=0,n=1;n<e;n++)i+=this.calculateRankCrossing(n,t);return i},em.prototype.getTempVariable=function(t,e){return t?this.isVertex(t)?t.temp[0]:t.temp[e-t.minRank-1]:0},em.prototype.calculateRankCrossing=function(t,e){for(var i=0,n=e.ranks[parseInt(t.toString(),10)],r=e.ranks[t-1],o=[],a=0;a<n.length;a++){for(var s=n[parseInt(a.toString(),10)],h=this.getTempVariable(s,t),d=this.getConnectedCellsOnLayer(s,t,!0),l=[],c=0;c<d.length;c++){var p=d[parseInt(c.toString(),10)],p=this.getTempVariable(p,t-1);l.push(p)}l.sort(function(t,e){return t-e}),o[parseInt(h.toString(),10)]=l}for(var g=[],a=0;a<o.length;a++)g=g.concat(o[parseInt(a.toString(),10)]);for(var u=1;u<r.length;)u<<=1;for(var m=2*u-1,f=(--u,[]),a=0;a<m;++a)f[parseInt(a.toString(),10)]=0;for(a=0;a<g.length;a++){var y=g[parseInt(a.toString(),10)]+u;for(++f[parseInt(y.toString(),10)];0<y;)y%2&&(i+=f[y+1]),y=y-1>>1,++f[parseInt(y.toString(),10)]}return i},em.prototype.execute=function(t){this.nestedBestRanks=[];for(var e=0;e<t.ranks.length;e++)this.nestedBestRanks[parseInt(e.toString(),10)]=t.ranks[parseInt(e.toString(),10)].slice();for(var i=0,n=this.calculateCrossings(t),e=0;e<24&&i<2;e++){this.weightedMedian(e,t);var r=this.calculateCrossings(t);if(r<n)for(var n=r,i=0,o=0;o<this.nestedBestRanks.length;o++)for(var a=t.ranks[parseInt(o.toString(),10)],s=0;s<a.length;s++){var h=a[parseInt(s.toString(),10)],d=this.nestedBestRanks[parseInt(o.toString(),10)][h.temp[0]],l=!0;h.edges&&d&&!d.edges&&(l=!1),d&&l&&(this.nestedBestRanks[parseInt(o.toString(),10)][h.temp[0]]=h)}else{i++;for(o=0;o<this.nestedBestRanks.length;o++)for(a=t.ranks[parseInt(o.toString(),10)],s=0;s<a.length;s++){h=a[parseInt(s.toString(),10)];this.setTempVariable(h,o,s)}}if(0===n)break}for(var c=[],p=[],e=0;e<t.maxRank+1;e++)p[parseInt(e.toString(),10)]=[],c[parseInt(e.toString(),10)]=p[parseInt(e.toString(),10)];for(e=0;e<this.nestedBestRanks.length;e++)for(o=0;o<this.nestedBestRanks[parseInt(e.toString(),10)].length;o++)p[parseInt(e.toString(),10)].push(this.nestedBestRanks[parseInt(e.toString(),10)][parseInt(o.toString(),10)]);t.ranks=c},em.prototype.isVertex=function(t){return!!(t&&t.cell&&(t.cell.inEdges&&t.cell.inEdges.length||t.cell.outEdges&&t.cell.outEdges.length))},em.prototype.weightedMedian=function(t,e){var i=t%2==0;if(i)for(var n=e.maxRank-1;0<=n;n--)this.medianRank(n,i);else for(n=1;n<e.maxRank;n++)this.medianRank(n,i)},em.prototype.getConnectedCellsOnLayer=function(t,e,i){var n="nextLayerConnectedCells",r="connectsAsTarget";if((i=void 0===i?!1:i)&&(n="previousLayerConnectedCells",r="connectsAsSource"),t){if(this.isVertex(t)){if(null==t[""+n]){t[""+n]=[],t[""+n][0]=[];for(var o=0;o<t[""+r].length;o++){var a=t[""+r][parseInt(o.toString(),10)];void 0===a.maxRank&&(a.maxRank=-1),-1===a.maxRank||(i?a.minRank===e-1:a.maxRank===e+1)?t[""+n][0].push(i?a.target:a.source):t[""+n][0].push(a)}}return t[""+n][0]}if(null==t[""+n]){t[""+n]=[];for(o=0;o<t.temp.length;o++)t[""+n][parseInt(o.toString(),10)]=[],o===(i?0:t.temp.length-1)?t[""+n][parseInt(o.toString(),10)].push(i?t.target:t.source):t[""+n][parseInt(o.toString(),10)].push(t)}return t[""+n][e-t.minRank-1]}return null},em.prototype.medianValue=function(t,e){for(var i,n,r,o=[],a=0,s=0;s<t.length;s++){var h=t[parseInt(s.toString(),10)];o[a++]=this.getTempVariable(h,e)}return o.sort(function(t,e){return t-e}),a%2==1?o[Math.floor(a/2)]:2===a?(o[0]+o[1])/2:(n=o[(i=a/2)-1]-o[0],r=o[a-1]-o[parseInt(i.toString(),10)],(o[i-1]*r+o[parseInt(i.toString(),10)]*n)/(n+r))},em.prototype.setTempVariable=function(t,e,i){t&&(t.temp[0]=i)},em.prototype.medianRank=function(t,e){for(var i=this.nestedBestRanks[parseInt(t.toString(),10)].length,n=[],r=[],o=0;o<i;o++){var a=this.nestedBestRanks[parseInt(t.toString(),10)][parseInt(o.toString(),10)],s={medianValue:0},h=(s.cell=a,void 0),d=void 0,d=e?t+1:t-1;null!=(h=e?this.getConnectedCellsOnLayer(a,t):this.getConnectedCellsOnLayer(a,t,!0))&&0!==h.length?(s.medianValue=this.medianValue(h,d),n.push(s)):r[this.getTempVariable(a,t)]=!0}n.sort(this.compare);for(o=0;o<i;o++)null==r[parseInt(o.toString(),10)]&&0<n.length&&(a=n.shift().cell,this.setTempVariable(a,t,o))},em.prototype.compare=function(t,e){if(null!=t&&null!=e){if(e.medianValue>t.medianValue)return-1;if(e.medianValue<t.medianValue)return 1}return 0};var tm=em;function em(){}nm.prototype.arrangeElements=function(i,t){var e=i.model.layout,t="LeftToRight"===t.orientation||"RightToLeft"===t.orientation,n=t?e.verticalSpacing:e.horizontalSpacing;this.groupLayoutCells(i),this.createMatrixCells(i);for(var r=0;r<i.matrix.length;r++)for(var o=i.matrix[parseInt(r.toString(),10)].key,a=i.matrix[parseInt(o.toString(),10)].value,s=1;s<a.length;s++){var h=a[parseInt(s.toString(),10)],d=a[s-1];h.offset+=d.offset+d.size/2+n+h.size/2}i.roots.sort(function(t,e){return t.cells[0]&&e.cells[0]?i.model.roots.indexOf(t.cells[0].cell)-i.model.roots.indexOf(e.cells[0].cell):0});for(r=0;r<i.roots.length;r++){var l=i.roots[parseInt(r.toString(),10)];this.arrangeMatrix(l,null,i)}for(var c=0;c<i.matrix.length;c++)for(var p,g,u,m,f=i.matrix[parseInt(c.toString(),10)].value,s=0;s<f.length;s++)1<(h=f[parseInt(s.toString(),10)]).visitedParents.length&&(p=h.visitedParents[0],m=h.visitedParents[h.visitedParents.length-1],u=this.findParentVertexCellGroup(p),g=this.findParentVertexCellGroup(m),p!==u&&u.offset<p.offset&&(p=u),g=((m=m!==g&&g.offset>m.offset?u:m).offset+.5*m.size+p.offset-.5*p.size)/2,u=h.initialOffset,(m=h.offset)!==u)&&(u<=g&&g<=m?this.translateMatrixCells(g-h.offset,h):g<u&&this.translateMatrixCells(u-h.offset,h));this.setXYforMatrixCell(i)},nm.prototype.groupLayoutCells=function(t){for(var e=t.model.ranks,i=e.length-1;0<=i;i--){for(var n=[],r=0;r<e[parseInt(i.toString(),10)].length;r++){var o=e[parseInt(i.toString(),10)][parseInt(r.toString(),10)];"internalVertex"===this.getType(o.type)&&n.push(e[parseInt(i.toString(),10)][parseInt(r.toString(),10)])}for(var a=[],s=0;s<e[parseInt(i.toString(),10)].length;s++){o=e[parseInt(i.toString(),10)][parseInt(s.toString(),10)];"internalEdge"===this.getType(o.type)&&a.push(o)}for(;1<n.length;){for(var h=n[0],d=this.selectIds(h.connectsAsTarget,!0),l=this.selectIds(h.connectsAsSource,!1);1<n.length;){var c=n[1],p=this.selectIds(c.connectsAsTarget,!0),g=this.selectIds(c.connectsAsSource,!1),p=this.compareLists(d,p),g=this.compareLists(l,g);if(!p||!g)break;this.updateMutualSharing(n[0],c.id),this.updateMutualSharing(n[1],h.id),n.splice(1,1)}n.splice(0,1)}for(;1<a.length;){var u=a[0],m=u.source,f=u.target;if(null!=m.identicalSibiling){for(var y=[],v=0;v<a.length;v++){var b=a[parseInt(v.toString(),10)];b.target===f&&y.push(b)}for(v=0;v<y.length;v++){var S=y[parseInt(v.toString(),10)];this.containsValue(m.identicalSibiling,S.source.id)&&(S.source.identicalSibiling=null)}u.source.identicalSibiling=null}a.splice(0,1)}}},nm.prototype.createMatrixCells=function(i){for(var t=i.model.layout,e="LeftToRight"===t.orientation||"RightToLeft"===t.orientation,n=e?t.verticalSpacing:t.horizontalSpacing,r=e?t.horizontalSpacing:t.verticalSpacing,o=i.model.ranks,a=[],s=-r,h=o.length-1;0<=h;h--){var d=0,l=o.length-1-h,c=o[parseInt(h.toString(),10)].slice(),p=[],g=(i.matrix.push({key:l,value:p}),[]);for(a.push({index:l,value:g});0<c.length;){var u=c[0],m={level:l,parents:[],children:[],visitedParents:[],visitedChildren:[],ignoredChildren:[],cells:[],size:0,offset:0,initialOffset:0},f=(p.push(m),this.getType(u.type));if("internalVertex"===f){if(m.cells.push(u),null!=u.identicalSibiling)for(var y=0;y<c.length;y++){var v=c[parseInt(y.toString(),10)],b=this.getType(v.type);if("internalVertex"===b&&this.containsValue(u.identicalSibiling,v.id)&&(m.cells.push(v),m.cells.length>u.identicalSibiling.length))break}for(y=0;y<m.cells.length;y++){v=m.cells[parseInt(y.toString(),10)];if("internalVertex"===this.getType(v.type)){var S=v.cell.geometry;if(m.size+=e?S.height:S.width,d=Math.max(d,e?S.width:S.height),g.push({key:v.id,value:m}),0<v.connectsAsTarget.length)for(var w=0;w<v.connectsAsTarget.length;w++){var x=v.connectsAsTarget[parseInt(w.toString(),10)],I=null;if(this.containsValue(a[l-1].value,x.ids)?I=x.ids:this.containsValue(a[l-1].value,x.source.id)&&(I=x.source.id),null!=I){for(var C=a[l-1].value,P=void 0,A=0;A<C.length;A++)if(C[parseInt(A.toString(),10)].key===I){P=C[parseInt(A.toString(),10)].value;break}this.containsValue(m.parents,P)||m.parents.push(P),this.containsValue(P.children,m)||P.children.push(m)}}var T=m.cells[parseInt(y.toString(),10)];-1!==c.indexOf(T)&&c.splice(c.indexOf(T),1)}}m.size+=(m.cells.length-1)*n}else if("internalEdge"===f){m.cells.push(u);for(y=0;y<m.cells.length;y++){var D=m.cells[parseInt(y.toString(),10)];if("internalEdge"===this.getType(D.type)&&null!=D.edges){for(var O=-5,w=0;w<D.edges.length;w++)O+=6;m.size+=O}g.push({key:D.ids,value:m});I=null;if(this.containsValue(a[l-1].value,D.ids)?I=D.ids:this.containsValue(a[l-1].value,D.source.id)&&(I=D.source.id),null!=I){for(var M=a[l-1].value,P=void 0,A=0;A<M.length;A++)if(M[parseInt(A.toString(),10)].key===I){P=M[parseInt(A.toString(),10)].value;break}this.containsValue(m.parents,P)||m.parents.push(P),this.containsValue(P.children,m)||P.children.push(m)}T=m.cells[parseInt(y.toString(),10)];-1!==c.indexOf(T)&&c.splice(c.indexOf(T),1)}m.size+=(m.cells.length-1)*n}if(m.cells.length){f=m.cells.filter(function(t){return"internalVertex"===t.type});if(0<f.length)for(var E=0,L=f;E<L.length;E++)if("break"===function(t){var e=t.cell;if(i.model.roots.some(function(t){return t===e}))return i.roots.push(m),"break"}(L[E]))break}}i.rowOffset.push(s+d/2+r),s+=d+r}},nm.prototype.arrangeMatrix=function(t,e,i){var n=i.model.layout,n="LeftToRight"===n.orientation||"RightToLeft"===n.orientation?n.verticalSpacing:n.horizontalSpacing,r=i.matrix[t.level].value,o=r.indexOf(t);if(0<t.visitedParents.length&&(1===t.visitedParents.length&&(t.initialOffset=t.offset),o+1<r.length)){var a=r[o+1];if(0<a.visitedParents.length&&!this.containsValue(t.visitedParents,e))return t.visitedParents.push(e),void e.ignoredChildren.push(t)}if(0<t.children.length){for(var s=0;s<t.children.length;s++){var h=t.children[parseInt(s.toString(),10)];this.containsValue(t.visitedChildren,h)||(this.arrangeMatrix(h,t,i),t.visitedChildren.push(h))}if(0<t.visitedChildren.length){for(var d=t.visitedChildren.slice(),s=0;s<t.ignoredChildren.length;s++)d.splice(0,1),t.visitedChildren.splice(0,1);0<d.length&&(a=t.visitedChildren[0],l=t.visitedChildren[t.visitedChildren.length-1],(l=(a.offset-a.size/2+(l.offset+l.size/2))/2)<t.offset?this.shiftMatrixCells(t.offset-l,a,!0,t,i):l>t.offset&&this.shiftMatrixCells(l-t.offset,t,!1,null,i))}}else{var l,a=t.offset;0<o&&(a=(l=r[o-1]).offset+l.size/2+n+t.size/2),this.shiftMatrixCells(a-t.offset,t,!1,null,i)}this.containsValue(t.visitedParents,e)||t.visitedParents.push(e)},nm.prototype.findParentVertexCellGroup=function(t){return!t.cells[0]&&0<t.parents.length?this.findParentVertexCellGroup(t.parents[0]):t},nm.prototype.translateMatrixCells=function(t,e){if(0!==t&&(e.offset+=t,0<e.visitedChildren.length))for(var i=0;i<e.visitedChildren.length;i++){var n=e.visitedChildren[parseInt(i.toString(),10)];this.translateMatrixCells(t,n)}},nm.prototype.setXYforMatrixCell=function(t){for(var e=t.model.layout,i="LeftToRight"===e.orientation||"RightToLeft"===e.orientation,n=i?e.verticalSpacing:e.horizontalSpacing,r=0;r<t.matrix.length;r++)for(var o=t.matrix[parseInt(r.toString(),10)].value,a=0;a<o.length;a++)for(var s=o[parseInt(a.toString(),10)],h=s.offset-s.size/2,d=0;d<s.cells.length;d++){var l=s.cells[parseInt(d.toString(),10)],c=this.getType(l.type);if("internalVertex"===c){var p=l,g=p.cell.geometry.width,u=p.cell.geometry.height;p.cell.geometry=i?new k(t.rowOffset[s.level]-g/2,h,g,u):new k(h,t.rowOffset[s.level]-u/2,g,u),h+=(i?u:g)+n}else if("internalEdge"===c){var m=l,f=s.visitedParents[0];if(f)for(var y=0;y<f.visitedChildren.length;y++){for(var v=f.visitedChildren[parseInt(y.toString(),10)],b=[],S=0;S<v.cells.length;S++){var w=v.cells[parseInt(S.toString(),10)];"internalVertex"===this.getType(w.type)&&b.push(w)}if(0<b.length)break}for(S=0;S<m.edges.length;S++){var x=m.edges[parseInt(S.toString(),10)],I=this.getPointvalue(h+.5,t.rowOffset[s.level]);if(i&&(I=this.getPointvalue(t.rowOffset[s.level],h+.5)),this.containsValue(this.getEdgeMapper(),x)){for(var C=void 0,y=0;y<this.getEdgeMapper().length;y++)if(this.getEdgeMapper()[parseInt(y.toString(),10)].key===x){C=y;break}this.getEdgeMapper()[parseInt(C.toString(),10)].value.push(I)}h+=6}h+=n}}},nm.prototype.getType=function(t){return"internalVertex"===t?"internalVertex":"internalEdge"},nm.prototype.selectIds=function(t,e){for(var i=[],n=0;n<t.length;n++){var r=t[parseInt(n.toString(),10)];i.push((e?r.source:r.target).id)}return i},nm.prototype.compareLists=function(t,e){var i=t.slice(),n=e.slice();if(i.length!==n.length)return!1;if(0===i.length)return!0;for(var r=!0,o=0;o<n.length;o++){var a=n[parseInt(o.toString(),10)];if(-1===i.indexOf(a)){r=!1;break}}return r},nm.prototype.updateMutualSharing=function(t,e){null!=t.identicalSibiling||(t.identicalSibiling=[]),t.identicalSibiling.push(e)},nm.prototype.containsValue=function(t,e){for(var i=0;i<t.length;i++)if(t[parseInt(i.toString(),10)].key===e||t[parseInt(i.toString(),10)]===e)return!0;return!1},nm.prototype.shiftMatrixCells=function(t,e,i,n,r){if(0!==t){for(var o=r.matrix[e.level].value,a=o.indexOf(e),s=a;s<o.length;s++)o[parseInt(s.toString(),10)].offset+=t;if(i)if(0<e.visitedChildren.length)this.shiftMatrixCells(t,e.visitedChildren[0],!0,e,r);else{for(var s=1,h=null;a+s<o.length;){var d=o[a+s];if(null!=n&&this.containsValue(d.visitedParents,n)){if(!(0<d.visitedChildren.length)){s++;continue}h=d}break}null!=h&&this.shiftMatrixCells(t,h.visitedChildren[0],!0,h,r)}}},nm.prototype.getPointvalue=function(t,e){return{x:Number(t)||0,y:Number(e)||0}},nm.prototype.getEdgeMapper=function(){return this.edgeMapper},nm.prototype.setEdgeMapper=function(t){this.edgeMapper.push(t)},nm.prototype.updateLayout=function(t,e,i,n,r,o){for(var a=(t.x-e.width)/2-e.x,t=(t.y-e.height)/2-e.y,a=Math.round(a),t=Math.round(t),s=[],h=new k(e.x+a,e.y+t,e.width,e.height),d=i.margin,l="RightToLeft"===n.orientation||"LeftToRight"===n.orientation?n.horizontalSpacing:n.verticalSpacing,c=0;c<r.length;c++){var p=r[parseInt(c.toString(),10)];if(null!=p.outEdges&&0<p.outEdges.length)for(var g=p.outEdges.length,u=0;u<g;u++){if((A=o[p.outEdges[parseInt(u.toString(),10)]]).pointCollection=[],1<g){for(var m,f,y=l/2,v=null,b=void 0,S=this.getEdgeMapper(),w=0;w<S.length;w++)if(S[parseInt(w.toString(),10)].key===A){b=w;break}b&&0<S[parseInt(b.toString(),10)].value.length&&(O=m=(f=S[parseInt(b.toString(),10)].value[0]).x+d.left,M=f=f.y+d.top,"BottomToTop"===n.orientation?M=e.height-f:"RightToLeft"===n.orientation&&(O=e.width-m),e.x<0&&(O-=e.x),e.y<0&&(M-=e.y),v=this.getPointvalue(O,M));for(var x=[],I=0;I<A.segments.length;I++)for(E in P=A.segments[parseInt(I.toString(),10)].points)x.push(P[parseInt(E.toString(),10)]);if(x=this.updateConnectorPoints(x,y,v,h,n.orientation),null!=v&&"DifferentPoint"!==this.diagram.layout.connectionPointOrigin)for(var C=0;C<x.length;C++){var P=x[parseInt(C.toString(),10)];A.pointCollection.push(this.getPointvalue(P.x,P.y))}this.resetConnectorPoints(A)}s.push(A)}if(null!=p.inEdges&&1<p.inEdges.length)for(g=p.inEdges.length,S=this.getEdgeMapper(),u=0;u<g;u++){var A=o[p.inEdges[parseInt(u.toString(),10)]];if(this.containsValue(s,A)||(A.pointCollection=[]),1<g){var T,D,O,M,y=l/2,v=null,b=void 0,w=void 0;for(w=0;w<S.length;w++)if(S[parseInt(w.toString(),10)].key===A){b=w;break}b&&0<S[parseInt(b.toString(),10)].value.length&&!this.containsValue(s,A)&&(O=T=(D=S[parseInt(w.toString(),10)].value[0]).x+d.left,M=D=D.y+d.top,"BottomToTop"===n.orientation?M=e.height-D:"RightToLeft"===n.orientation&&(O=e.width-T),e.x<0&&(O-=e.x),e.y<0&&(M-=e.y),v=this.getPointvalue(O,M));for(var E,x=[],C=0;C<A.segments.length;C++)for(E in P=A.segments[parseInt(C.toString(),10)].points)x.push(P[parseInt(E.toString(),10)]);if(x.reverse(),(x=this.updateConnectorPoints(x,y,v,h,i.orientation)).reverse(),A.pointCollection=[],null!=v&&"DifferentPoint"!==this.diagram.layout.connectionPointOrigin)for(C=0;C<x.length;C++){P=x[parseInt(C.toString(),10)];A.pointCollection.push(this.getPointvalue(P.x,P.y))}this.resetConnectorPoints(A)}}}},nm.prototype.inflate=function(t,e,i){return t.x-=e,t.y-=i,t.width+=2*e,t.height+=2*i,t},nm.prototype.updateConnectorPoints=function(t,e,i,n,r){var o,a,s,h,r="LeftToRight"===r||"RightToLeft"===r,d=t[0],l=t[t.length-1];return null!=i?(s=K.transform(d,K.findAngle(d,t[1]),e),o=K.transform(l,K.findAngle(l,t[t.length-2]),e),h=this.getPointvalue(i.x,s.y),a=this.getPointvalue(i.x,o.y),r&&(h.x=s.x,h.y=i.y,a.x=o.x,a.y=i.y),Math.abs(K.findAngle(a,o))<.1?[d,s,h,o,l]:[d,s,h,a,o,l]):4===t.length?(s=K.transform(d,K.findAngle(d,t[1]),e),h=this.getPointvalue(t[2].x,s.y),r&&(h.x=s.x,h.y=t[2].y),[d,s,h,l]):t},nm.prototype.resetConnectorPoints=function(t){if(t.pointCollection&&0<t.pointCollection.length){(h=t).sourcePoint=t.pointCollection[0],h.targetPoint=t.pointCollection[t.pointCollection.length-1];for(var e=[],i=0;i<t.pointCollection.length-1;i++){var n=t.pointCollection[parseInt(i.toString(),10)],r=t.pointCollection[i+1],o=yd(n,r),a=dd(n,r);i===t.pointCollection.length-2&&("RightToLeft"===this.diagram.layout.orientation&&"Left"===a||"LeftToRight"===this.diagram.layout.orientation&&"Right"===a||"TopToBottom"===this.diagram.layout.orientation&&"Bottom"===a||"BottomToTop"===this.diagram.layout.orientation&&"Top"===a)&&(o/=2),(d=new Ua(t,"segments",{type:"Orthogonal"},!0)).length=o,d.direction=a,e.push(d)}h.segments=e,h.type="Orthogonal",this.diagram.connectorPropertyChange(h,{},{type:"Orthogonal",segments:h.segments})}else if("DifferentPoint"===this.diagram.layout.connectionPointOrigin){var s="obstaclePointCollection";if(t.segments[0].points&&0<t.segments[0].points.length&&t[s]){(h=t).sourcePoint=t[s][0],h.targetPoint=t[s][t[s].length-1];for(var h,e=[],i=0;i<t[s].length-1;i++){var d,n=t[s][parseInt(i.toString(),10)],r=t[s][i+1],l=yd(n,r),a=dd(n,r);i===t[s].length-2&&("RightToLeft"===this.diagram.layout.orientation&&"Left"===a||"LeftToRight"===this.diagram.layout.orientation&&"Right"===a||"TopToBottom"===this.diagram.layout.orientation&&"Bottom"===a||"BottomToTop"===this.diagram.layout.orientation&&"Top"===a)&&(l/=2),(d=new Ua(t,"segments",{type:"Orthogonal"},!0)).length=l,d.direction=a,e.push(d)}h.segments=e,h.type="Orthogonal",this.diagram.connectorPropertyChange(h,{},{type:"Orthogonal",segments:h.segments})}}},nm.prototype.nodePropertyChange=function(t){this.diagram.nodePropertyChange(t,{},{offsetX:t.offsetX,offsetY:t.offsetY})};var im=nm;function nm(){this.edgeMapper=[]}om.prototype.createInternalCells=function(t,e){for(var i=0;i<t.length;i++)for(var n=t[parseInt(i.toString(),10)],r={tempRank:-1,cell:n,hashCode:[],maxRank:null,minRank:null,id:n.id,internalOutEdges:[],internalInEdges:[],identicalSibling:[]},o=(e.push(r),this.vertexMapper.set(n.id,r),this.layout.getEdges(n)),a=0;a<o.length;){var s=o[parseInt(a.toString(),10)],s=this.layout.getVisibleTerminal(s,!1);if(s!==n){var h=this.layout.getEdgesBetween(n,s,!0);if(0<h.length){for(var d={connectorIds:[],edges:h,ids:[],isReversed:!1,source:null,target:null,tempRank:0,maxRank:null,minRank:null},l=0;l<h.length;l++){var c=h[parseInt(l.toString(),10)];d.ids.push(c.id),-1!==o.indexOf(c)&&(o.indexOf(c)<a&&a--,o.splice(o.indexOf(c),1))}-1===(d.source=r).internalOutEdges.indexOf(d)&&r.internalOutEdges.push(d)}}else a++}},om.prototype.layeringStage=function(){this.recycleConnectors(),this.initialRank(),this.fixRanks()},om.prototype.recycleConnectors=function(){var t=[this.rootNode];this.visit(t,!0)},om.prototype.initialRank=function(){for(var t=[this.rootNode],e=Array.from(this.vertexMapper.values());0<t.length;){for(var i,n=t[0],r=n.internalOutEdges,o=n.internalInEdges,a=!0,s=1e8,h=0;h<o.length;h++){if(5270620!==(g=o[parseInt(h.toString(),10)]).tempRank){a=!1;break}s=(u=g.source).tempRank?Math.min(s,u.tempRank-1):s}if(a){if(n.tempRank=s,this.maxRank=Math.min(this.maxRank,s),r.length){n.cell.isDecisionNode&&(i=r.find(function(t){return t.target.cell.isYesChild}),d=r.find(function(t){return t.target.cell.isDecisionNode}),-1===r.indexOf(d)&&0!==r.indexOf(i)&&r.reverse(),"RightInFlow"===this.layout.yesBranchDirection||"SameAsFlow"===this.layout.yesBranchDirection&&"LeftInFlow"===this.layout.noBranchDirection)&&r.reverse();for(h=0;h<r.length;h++)(g=r[parseInt(h.toString(),10)]).tempRank=5270620,-1===(u=g.target).tempRank&&(u.tempRank=-2,t.push(u))}t.shift()}else{var d=t.shift();if(t.push(n),d===n&&1===t.length)break}}for(h=0;h<e.length;h++)e[parseInt(h.toString(),10)].tempRank-=this.maxRank;for(var l=0,c=this.rootNode.internalOutEdges,p=0;p<c.length;p++){var g,u=(g=c[parseInt(p.toString(),10)]).target;this.rootNode.tempRank=void 0!==u.tempRank&&null!==u.tempRank?Math.max(l,u.tempRank+1):l,l=this.rootNode.tempRank}this.maxRank=1e8-this.maxRank},om.prototype.fixRanks=function(){var t=new Map;this.ranks=new Map;for(var e=0;e<=this.maxRank;e++)t.set(e,[]),this.ranks.set(e,t.get(e));var i=[this.rootNode];this.visit(i,!1,t)},om.prototype.visit=function(t,e,i){if(void 0===i&&(i=null),t){for(var n=0;n<t.length;n++){var r,o=t[parseInt(n.toString(),10)];o&&(r=new Map,e?(o.hashCode=[this.dfsCount,n],this.extendedDfs(null,o,null,r,n)):this.depthFirstSearch(null,o,null,r,i))}this.dfsCount++}},om.prototype.extendedDfs=function(t,n,e,r,i){var o=this,i=(!t||n.hashCode&&n.hashCode[0]===t.hashCode[0]||(n.hashCode=t.hashCode.concat([i])),n.id);r.has(i)?this.removeConnectionEdge(t,n,e):(r.set(i,n),this.removeConnectionEdge(t,n,e),n.internalOutEdges.slice().forEach(function(t,e){var i=t.target;o.extendedDfs(n,i,t,r,e)}))},om.prototype.removeConnectionEdge=function(t,e,i){t&&this.isAncestor(e,t)&&(this.invert(i),this.remove(i,t.internalOutEdges),t.internalInEdges.push(i),this.remove(i,e.internalInEdges),e.internalOutEdges.push(i))},om.prototype.invert=function(t){var e=t.source;t.source=t.target,t.target=e,t.isReversed=!t.isReversed},om.prototype.remove=function(t,e){t=e.indexOf(t);e.splice(t,1)},om.prototype.isAncestor=function(t,e){if(null!==e&&null!==t.hashCode&&null!==e.hashCode&&t.hashCode.length<e.hashCode.length){if(t.hashCode!==e.hashCode)for(var i=0;i<t.hashCode.length;i++)if(t.hashCode[parseInt(i.toString(),10)]!==e.hashCode[parseInt(i.toString(),10)])return!1;return!0}return!1},om.prototype.depthFirstSearch=function(t,i,e,n,r){var o=this,a=i.id;n.has(a)?this.updateMinMaxRank(t,i,e,1,r):(n.set(a,i),this.updateMinMaxRank(t,i,e,0,r),i.internalOutEdges.slice().forEach(function(t){var e=t.target;o.depthFirstSearch(i,e,t,n,r)}))},om.prototype.updateMinMaxRank=function(t,e,i,n,r){var o=Array.from(r.values());if(null==e.maxRank&&0!==e.maxRank&&(e.maxRank=-1),null==e.minRank&&0!==e.minRank&&(e.minRank=-1),0===n&&e.maxRank<0&&e.minRank<0&&0<=e.tempRank&&(r=e.tempRank,o[parseInt(r.toString(),10)].push(e),e.maxRank=r,e.minRank=r,e.tempRank=o[e.maxRank].length-1),null!==t&&null!==i)if(1<t.maxRank-e.maxRank){i.maxRank=t.maxRank,i.minRank=e.maxRank;for(var a=i.minRank+1;a<i.maxRank;a++)o[parseInt(a.toString(),10)].push(i)}else if(i.isReversed){i.maxRank=t.maxRank,i.minRank=e.maxRank;for(a=i.minRank;a<=i.maxRank;a++)o[parseInt(a.toString(),10)].push(i)}};var rm=om;function om(t,e,i){var o=this,t=(this.dfsCount=0,this.maxRank=1e8,this.layout=t,this.vertexMapper=new Map,this.ranks=new Map,[]);this.createInternalCells(i,t),t.forEach(function(r){r.internalOutEdges.forEach(function(t){var e,i,n=t.edges;n&&0<n.length&&(n=n[0],e=o.layout.getVisibleTerminal(n,!1),i=o.vertexMapper.get(e.id),r===i&&(e=o.layout.getVisibleTerminal(n,!0),i=o.vertexMapper.get(e.id)),i)&&r!==i&&(t.target=i,-1===r.internalInEdges.indexOf(t))&&i.internalInEdges.push(t)})}),this.rootNode=this.vertexMapper.get(e.id)}sm.prototype.arrangeElements=function(){if(null!==this.flowchartModel){var t=this.flowchartModel.layout,e="LeftToRight"===t.orientation?t.verticalSpacing:t.horizontalSpacing;this.groupLayoutCells(),this.createMatrixCells();for(var i=0,n=this.matrix;i<n.length;i++)for(var r=n[i],o=1;o<r.length;o++){var a=r[parseInt(o.toString(),10)],s=r[o-1];a.offset+=s.offset+s.size/2+e+a.size/2}for(var h=0,d=this.matrix[0];h<d.length;h++){var l=d[h];this.arrangeMatrix(l,null)}for(var c=0,p=this.matrix;c<p.length;c++)for(var g=p[c],o=0;o<g.length;o++)if(1<(a=g[parseInt(o.toString(),10)]).visitedParents.length){var u=a.visitedParents[0],m=a.visitedParents[a.visitedParents.length-1],f=this.findParentVertexCellGroup(u),y=this.findParentVertexCellGroup(m),v=(u!==f&&f.offset<u.offset&&(u=f),m!==y&&y.offset>m.offset&&(m=f),(u.offset+m.offset)/2),y=a.cells.find(function(t){return"internalInEdges"in t&&"internalOutEdges"in t});if("SameAsFlow"===this.flowchartModel.layout.yesBranchDirection){var b=a.visitedParents.slice();if(y&&y.cell.isYesChild){for(var S=0,w=b;S<w.length;S++)if(!(D=(T=w[S]).cells.find(function(t){return"internalInEdges"in t&&"internalOutEdges"in t}))){v=T.offset;break}}else{"LeftInFlow"===this.flowchartModel.layout.noBranchDirection&&b.reverse();for(var x=0,I=b;x<I.length;x++)if(D=(T=I[x]).cells.find(function(t){return"internalInEdges"in t&&"internalOutEdges"in t})){if(D.cell.isYesChild){v=T.offset;break}}else{var C=this.findParentVertexCellGroup(T);if(C)if((E=C.cells.find(function(t){return"internalInEdges"in t&&"internalOutEdges"in t}))&&E.cell.isYesChild){v=T.offset;break}}}}else if("SameAsFlow"===this.flowchartModel.layout.noBranchDirection){b=a.visitedParents.slice();if(y&&y.cell.isNoChild){for(var P=0,A=b;P<A.length;P++)if(!(D=(T=A[P]).cells.find(function(t){return"internalInEdges"in t&&"internalOutEdges"in t}))){v=T.offset;break}}else{"LeftInFlow"===this.flowchartModel.layout.yesBranchDirection&&b.reverse();for(var T,D,O=0,M=b;O<M.length;O++)if(D=(T=M[O]).cells.find(function(t){return"internalInEdges"in t&&"internalOutEdges"in t})){if(D.cell.isNoChild){v=T.offset;break}}else{var E,C=this.findParentVertexCellGroup(T);if(C)if((E=C.cells.find(function(t){return"internalInEdges"in t&&"internalOutEdges"in t}))&&E.cell.isNoChild){v=T.offset;break}}}}f=a.initialOffset,u=a.offset;u!==f&&(f<=v&&v<=u?this.translateMatrixCells(v-a.offset,a):v<f&&this.translateMatrixCells(f-a.offset,a))}this.setXYForMatrixCell()}},sm.prototype.arrangeMatrix=function(t,e){var i=this.flowchartModel.layout,i="LeftToRight"===i.orientation?i.verticalSpacing:i.horizontalSpacing,n=this.matrix[t.level],r=n.indexOf(t);if(t.visitedParents.length&&(1===t.visitedParents.length&&(t.initialOffset=t.offset),r+1<n.length)){var o=n[r+1];if(o.visitedParents.length&&-1===t.visitedParents.indexOf(e))return void(t.level!==e.level&&(t.visitedParents.push(e),e.ignoredChildren.push(t)))}if(t.children.length){for(var a=0,s=t.children;a<s.length;a++){var h=s[a];t.visitedChildren.indexOf(h)&&(this.arrangeMatrix(h,t),(t.level!==h.level?t.visitedChildren:t.loopChildren).push(h))}if(t.visitedChildren.length){for(var d,l,c,p=t.visitedChildren.slice(),g=0,u=t.ignoredChildren;g<u.length;g++)!function(e){p=p.filter(function(t){return t!==e})}(u[g]);p.length&&(o=p[0],d=p[p.length-1],l=(o.offset+d.offset)/2,t.cells.length&&(f=t.cells.filter(function(t){return"internalInEdges"in t&&"internalOutEdges"in t})[0],m=o.cells.filter(function(t){return"internalInEdges"in t&&"internalOutEdges"in t})[0],c=d.cells.filter(function(t){return"internalInEdges"in t&&"internalOutEdges"in t})[0],f)&&f.cell.isDecisionNode&&("SameAsFlow"===this.flowchartModel.layout.yesBranchDirection?m?l=(m.cell.isYesChild?o:d).offset:c&&(l=(c.cell.isYesChild?d:o).offset):"SameAsFlow"===this.flowchartModel.layout.noBranchDirection&&(m?l=(m.cell.isNoChild?o:d).offset:c&&(l=(c.cell.isNoChild?d:o).offset))),l<t.offset?this.shiftMatrixCells(t.offset-l,o,!0,t):l>t.offset&&this.shiftMatrixCells(l-t.offset,t))}}else{var m,f=t.offset;0<r&&(f=(m=n[r-1]).offset+m.size/2+i+t.size/2),this.shiftMatrixCells(f-t.offset,t)}-1===t.visitedParents.indexOf(e)&&null!==e&&t.level!==e.level&&t.visitedParents.push(e)},sm.prototype.shiftMatrixCells=function(t,e,i,n){if(void 0===i&&(i=!1),void 0===n&&(n=null),0!==t){for(var r=this.matrix[e.level],o=r.indexOf(e),a=o;a<r.length;a++)r[parseInt(a.toString(),10)].offset+=t;if(i)if(e.visitedChildren.length)this.shiftMatrixCells(t,e.visitedChildren[0],!0,e);else{for(var a=1,s=null;o+a<r.length;){var h=r[o+a];if(null!==n&&-1!==h.visitedParents.indexOf(n)){if(!h.visitedChildren.length){a++;continue}s=h}break}null!==s&&this.shiftMatrixCells(t,s.visitedChildren[0],!0,s)}}},sm.prototype.findParentVertexCellGroup=function(t){return!("internalInEdges"in t.cells[0]&&"internalOutEdges"in t.cells[0])&&t.parents.length?this.findParentVertexCellGroup(t.parents[0]):t},sm.prototype.translateMatrixCells=function(t,e){if(0!==t&&(e.offset+=t,e.visitedChildren.length)){for(var i=0,n=e.visitedChildren;i<n.length;i++){var r=n[i];this.translateMatrixCells(t,r)}for(var o=0,a=e.loopChildren;o<a.length;o++){var s=a[o];this.translateMatrixCells(t,s)}}},sm.prototype.getObjectValues=function(t){var e,i=[];for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&i.push(t[""+e]);return i},sm.prototype.setXYForMatrixCell=function(){var t=this.flowchartModel.layout,e="LeftToRight"===t.orientation,i=e?t.verticalSpacing:t.horizontalSpacing,n=0;this.siblingModel&&(t=this.getObjectValues(this.rowMaxDimension),t=Math.max.apply(Math,t),n=this.siblingModel.getSiblingDimension(t));for(var r=0,o=this.getObjectValues(this.matrix);r<o.length;r++)for(var a=0,s=o[r];a<s.length;a++){var h=s[a],d=h.offset-h.size/2;0!==n&&(d+=n+i);for(var l=0,c=h.cells;l<c.length;l++){var p=c[l];if("internalInEdges"in p&&"internalOutEdges"in p){var g=p,u=g.cell.geometry.width,m=g.cell.geometry.height;g.cell.geometry=e?new k(this.rowOffset[h.level]-u/2,d,u,m):new k(d,this.rowOffset[h.level]-m/2,u,m),d+=(e?m:u)+i}else if("edges"in p){var f=p,y=f.isReversed;if(!y){g=h.visitedParents[0];if(g)for(var v=0,b=g.visitedChildren;v<b.length;v++)if(b[v].cells.some(function(t){return"internalInEdges"in t&&"internalOutEdges"in t})){y=!0;break}}for(var S=0,w=f.edges;S<w.length;S++){var x,I=w[S];y&&(x={x:d+.5,y:this.rowOffset[h.level]},e&&(x={x:this.rowOffset[h.level],y:d+.5}),this.flowchartModel.layout.edgesMapper.has(I))&&(this.flowchartModel.layout.edgesMapper.get(I).push(x),this.flowchartModel.layout.loopedgesMapper.set(I,f.isReversed)),d+=6}d+=i}}}},sm.prototype.getSiblingDimension=function(t){var e=this.flowchartModel.layout,i="LeftToRight"===e.orientation,e=i?e.horizontalSpacing:e.verticalSpacing,n=0;for(o in this.rowMaxDimension)if(Object.prototype.hasOwnProperty.call(this.rowMaxDimension,o)){if(!(this.rowMaxDimension[""+o]<t))break;n=parseInt(o,10)}this.rowMaxDimension[parseInt(n.toString(),10)]+e<=t&&this.rowMaxDimension[n+1]&&n++;var r=[];for(o in this.matrix)Object.prototype.hasOwnProperty.call(this.matrix,o)&&parseInt(o,10)<=n&&(r[""+o]=this.matrix[""+o]);var o,a,s,h,d,l,c,p=0;for(o in r)Object.prototype.hasOwnProperty.call(r,o)&&(s=r[""+o]).length&&((d=s[a=0].cells[0])&&"cell"in d?(h=d.cell.geometry,a=i?h.y:h.x):d&&"edges"in d&&(l=d.edges[d.edges.length-1],(c=this.flowchartModel.layout.edgesMapper.get(l)).length)&&(a=i?c[0].y:c[0].x),d=0,(s=s[s.length-1].cells[s[s.length-1].cells.length-1])&&"cell"in s?(h=s.cell.geometry,d=i?h.y+h.height:h.x+h.width):s&&"edges"in s&&(l=s.edges[s.edges.length-1],(c=this.flowchartModel.layout.edgesMapper.get(l)).length)&&(d=i?c[0].y:c[0].x),p=Math.max(p,d-a));return p},sm.prototype.createMatrixCells=function(){for(var t=this.flowchartModel.layout,e="LeftToRight"===t.orientation,i=e?t.verticalSpacing:t.horizontalSpacing,n=e?t.horizontalSpacing:t.verticalSpacing,t=this.flowchartModel.ranks,r=Array.from(t.values()),o={},a=-n,s=r.length-1;0<=s;s--){var h=0,d=r.length-1-s,l=r[parseInt(s.toString(),10)].slice(),c=[],p=(this.matrix[parseInt(d.toString(),10)]=c,{});for(o[parseInt(d.toString(),10)]=p;0<l.length;){var g=l[0],u={parents:[],children:[],visitedParents:[],visitedChildren:[],ignoredChildren:[],loopChildren:[],cells:[],level:d,initialOffset:0,size:0,offset:0};if(c.push(u),"internalInEdges"in g&&"internalOutEdges"in g){if(u.cells.push(g),g.identicalSibling)for(var m=0;m<l.length;m++){var f=l[parseInt(m.toString(),10)];if("internalInEdges"in f&&"internalOutEdges"in f&&-1!==g.identicalSibling.indexOf(f.id)&&(u.cells.push(f),u.cells.length>g.identicalSibling.length))break}for(var y=u.cells,m=0;m<y.length;m++)if("internalInEdges"in(f=y[parseInt(m.toString(),10)])&&"internalOutEdges"in f){var v=f.cell.geometry;if(u.size+=e?v.height:v.width,h=Math.max(h,e?v.width:v.height),p[f.id]=u,f.internalInEdges.length)for(var b=f.internalInEdges,S=0;S<b.length;S++){var w=b[parseInt(S.toString(),10)];w.isReversed||(A=null,o[d-1]&&Object.prototype.hasOwnProperty.call(o[d-1],w.ids)?A=w.ids:o[d-1]&&Object.prototype.hasOwnProperty.call(o[d-1],w.source.id)&&(A=w.source.id),null!==A&&(P=o[d-1][""+A],-1===u.parents.indexOf(P)&&u.parents.push(P),-1===P.children.indexOf(u))&&(P.children.length&&P.children[0].level===P.level?P.children.unshift(u):P.children.push(u)))}l.splice(l.indexOf(f),1)}u.size+=(u.cells.length-1)*i}else if("edges"in g){u.cells.push(g);for(y=u.cells,m=0;m<y.length;m++){var x=y[parseInt(m.toString(),10)];if("edges"in x&&x.edges){for(var I=-5,C=0;C<x.edges.length;C++){x.edges[parseInt(C.toString(),10)];I+=6}u.size+=I}var P,A=null;x.isReversed?o[parseInt(d.toString(),10)][x.ids]?A=x.ids:o[parseInt(d.toString(),10)][x.source.id]&&(A=x.source.id):o[d-1][x.ids]?A=x.ids:o[d-1][x.source.id]&&(A=x.source.id),null!==A&&(P=o[x.isReversed?d:d-1][""+A],-1===u.parents.indexOf(P)&&u.parents.push(P),-1===P.children.indexOf(u))&&P.children.push(u),p[x.ids]=u,l.splice(l.indexOf(x),1)}u.size+=(u.cells.length-1)*i}}this.rowOffset[parseInt(d.toString(),10)]=a+h/2+n,this.rowMaxDimension[parseInt(d.toString(),10)]=this.rowOffset[parseInt(d.toString(),10)]+h/2,a+=h+n}},sm.prototype.groupLayoutCells=function(){var t=this.flowchartModel.ranks,e=Array.from(t.values());e.reverse();for(var i=e.length-1;0<=i;i--){for(var n=e[parseInt(i.toString(),10)].filter(function(t){return"internalInEdges"in t&&"internalOutEdges"in t}),a=e[parseInt(i.toString(),10)].filter(function(t){return"edges"in t&&"edges"in t});1<n.length;){var r=n[0];if(r.cell.isYesChild||r.cell.isNoChild);else for(var o=r.internalInEdges.map(function(t){return t.source.id}),s=r.internalOutEdges.map(function(t){return t.target.id});1<n.length;){var h=n[1],d=h.internalInEdges.map(function(t){return t.source.id}),l=h.internalOutEdges.map(function(t){return t.target.id}),d=this.compareLists(o,d),l=this.compareLists(s,l);if(!d||!l)break;this.updateMutualSharing(n[0],h.id),this.updateMutualSharing(n[1],r.id),n.splice(1,1)}n.shift()}for(;1<a.length;)!function(){var t=a[0],e=t.source,i=t.target;if(e.identicalSibling){for(var n=0,r=a.filter(function(t){return t.target===i});n<r.length;n++){var o=r[n];-1!==e.identicalSibling.indexOf(o.source.id)&&(o.source.identicalSibling=null)}t.source.identicalSibling=null}a.shift()}()}},sm.prototype.updateMutualSharing=function(t,e){t.identicalSibling?t.identicalSibling.push(e):t.identicalSibling=[e]},sm.prototype.compareLists=function(t,e){var i=t.slice(),t=e.slice();if(i.length!==t.length)return!1;if(0!==i.length)for(var n=0,r=t;n<r.length;n++){var o=r[n];if(-1===i.indexOf(o))return!1}return!0};var am=sm;function sm(t){this.flowchartModel=t,this.matrix=[],this.rowOffset=[],this.rowMaxDimension=[],this.siblingModel=null}dm.prototype.updateLayout=function(t,e){this.diagram=e,this.yesBranchDirection=this.diagram.layout.flowchartLayoutSettings.yesBranchDirection,this.noBranchDirection=this.diagram.layout.flowchartLayoutSettings.noBranchDirection,this.yesBranchValues=this.diagram.layout.flowchartLayoutSettings.yesBranchValues||["Yes","True"],this.noBranchValues=this.diagram.layout.flowchartLayoutSettings.noBranchValues||["No","False"],this.orientation="TopToBottom"===this.diagram.layout.orientation||"BottomToTop"===this.diagram.layout.orientation?"TopToBottom":"LeftToRight",this.horizontalAlignment=this.diagram.layout.horizontalAlignment,this.verticalAlignment=this.diagram.layout.verticalAlignment,this.verticalSpacing=this.diagram.layout.verticalSpacing,this.horizontalSpacing=this.diagram.layout.horizontalSpacing,this.margin=this.diagram.layout.margin;var i=[],n=[];this.rootNodes=[],this.vertexMapper.clear(),this.edgesMapper.clear(),this.loopedgesMapper.clear();for(var r=0,o=t;r<o.length;r++){var a=o[r];a.excludeFromLayout||(g=this.createVertex(a),this.vertexMapper.set(g.id,g),n.push(g),g.inEdges&&0!==g.inEdges.length)||(i.push(g),this.rootNodes.push(a))}for(var s=null,h=0,d=i;h<d.length;h++){var l=d[h],c=[],l=(this.getTreeVertices(l,c,n),new rm(this,l,c)),c=(l.layeringStage(),new am(l));c.siblingModel=s,c.arrangeElements(),s=c}var t=Array.from(this.vertexMapper.values()),p=this.getModelBounds(t);this.updateAnchor(p);for(var g,u,m="LeftToRight"===this.orientation?this.horizontalSpacing:this.verticalSpacing,f=[],y=0,v=t;y<v.length;y++)(g=v[y])&&((u=g.item)&&(u.offsetX=g.geometry.x+g.geometry.width/2+this.anchorX,u.offsetY=g.geometry.y+g.geometry.height/2+this.anchorY,g.inEdges&&0<g.inEdges.length||g.outEdges&&0<g.outEdges.length)&&f.push(u),e.dataBind());t=new k(p.x+this.anchorX,p.y+this.anchorY,p.width,p.height);this.nodeWithMultiEdges=f,this.inverseSpacing=m,this.transModelBounds=t,this.diagram.layout.flowChartData=this},dm.prototype.reRouteFlowChartConnectors=function(t,e){this.diagram=e;for(var e=t.nodeWithMultiEdges,i=t.inverseSpacing,n=(this.orientation=t.orientation,"TopToBottom"===this.orientation),r=t.transModelBounds,o=(this.vertexMapper=t.vertexMapper,this.loopedgesMapper=t.loopedgesMapper,this.edgesMapper=t.edgesMapper,this.anchorX=t.anchorX,this.anchorY=t.anchorY,[]),a=0,s=e;a<s.length;a++){var h=s[a];if(h.outEdges&&0<h.outEdges.length)for(var d=0,l=h.outEdges;d<l.length;d++){var c,p,g,u=l[d],m=this.diagram.nameTable[""+u];this.loopedgesMapper.has(m)&&this.loopedgesMapper.get(m)?-1===o.indexOf(m)&&(this.updateLoopConnector(m),o.push(m)):(x=[],1<h.outEdges.length?(v=i/2,b=null,this.edgesMapper.has(m)&&(S=this.edgesMapper.get(m)[0])&&(b={x:S.x+this.anchorX,y:S.y+this.anchorY}),m.segments=[],m.intermediatePoints=[],w=[m.sourcePoint,m.targetPoint],2<(w=n?(x=this.updateVerticalConnectorSegments(m,w),c=this.diagram.nameTable[m.sourceID],!this.vertexMapper.get(c.id).isDecisionNode&&x.length<=2?this.updateConnectorPoints(x,v,b,r):x):x=this.updateHorizontalSegments(m,w)).length&&this.updatePoints(w,m),o.push(m)):4===m.intermediatePoints.length&&(c=m.intermediatePoints[0],p=m.intermediatePoints[3],g=n?{x:c.x,y:p.y-20}:{x:p.x-20,y:c.y},this.updatePoints([c,g,p],m),o.push(m)))}if(h.inEdges&&1<h.inEdges.length)for(var f=0,y=h.inEdges;f<y.length;f++){var v,b,S,w,x,u=y[f],m=this.diagram.nameTable[""+u];-1===o.indexOf(m)&&(m.segments[0].points=[],this.loopedgesMapper.has(m)&&this.loopedgesMapper.get(m)?(this.updateLoopConnector(m),o.push(m)):1<h.inEdges.length&&(v=i/2,b=null,this.edgesMapper.has(m)&&-1===o.indexOf(m)&&(S=this.edgesMapper.get(m)[0])&&(b={x:S.x+this.anchorX,y:S.y+this.anchorY}),m.segments=[],w=[m.targetPoint,m.sourcePoint],x=[],x=n?this.updateVerticalConnectorSegments(m,w):this.updateHorizontalSegments(m,w),(w=this.updateConnectorPoints(x,v,b,r)).reverse(),2<w.length)&&this.updatePoints(w,m))}}},dm.prototype.updateAnchor=function(t){var e=this.diagram.scrollSettings.viewPortWidth,i=this.diagram.scrollSettings.viewPortHeight;"TopToBottom"===this.orientation?(this.anchorX=e/2-t.width/2-t.x,this.anchorY=this.margin.top):(this.anchorX=this.margin.left,this.anchorY=i/2-t.height/2-t.y),1===this.rootNodes.length&&(e=this.rootNodes[0],e=(i=this.vertexMapper.get(e.id).geometry).x+i.width/2,i=i.y+i.height/2,e=e-(t.x+t.width/2),i=i-(t.y+t.height/2),"TopToBottom"===this.orientation?this.anchorX-=e:this.anchorY-=i)},dm.prototype.updateConnectorPoints=function(t,e,i,n){var r,o="LeftToRight"===this.orientation,a=t.slice();function s(t,e){return Math.atan2(e.y-t.y,e.x-t.x)*(180/Math.PI)}function h(t,e,i){i*=Math.PI/180;return{x:t.x+e*Math.cos(i),y:t.y+e*Math.sin(i)}}if(2<a.length){var t=h(a[0],e,s(a[0],a[1])),d=h(t,(l=a[1],d=l.x-t.x,l=l.y-t.y,Math.sqrt(d*d+l*l)),s(t,a[2]));if(a.splice(1,0,d),a.splice(1,0,t),a.splice(3,2),null!=i){var l=a.length,c=h(a[l-1],e,s(a[l-1],a[l-2]));for(a.splice(l-1,0,c);2<a.length-2;)a.splice(2,1);var p,g,l,d=i;this.inflate(n,n.width,n.height),l=(l=(t=o?(p=[{x:n.left,y:d.y},{x:n.right,y:d.y}],g=[{x:a[1].x,y:n.top},{x:a[1].x,y:n.bottom}],[{x:c.x,y:n.top},{x:c.x,y:n.bottom}]):(p=[{x:d.x,y:n.top},{x:d.x,y:n.bottom}],g=[{x:n.left,y:a[1].y},{x:n.right,y:a[1].y}],[{x:n.left,y:c.y},{x:n.right,y:c.y}]),[]),this.diagram.commandHandler.intersect(p,g,!(d=[]))),(d=this.diagram.commandHandler.intersect(p,t,!1)).length&&a.splice(2,0,d[0]),l.length&&a.splice(2,0,l[0])}}else 2===a.length&&null!=i&&(n=a[0],g=a[1],c=h(n,e,p=s(a[0],a[1])),t=h(g,e,(p+180)%360),a.splice(1,0,t),d=o?(r={x:c.x,y:i.y},{x:t.x,y:i.y}):(r={x:i.x,y:c.y},{x:i.x,y:t.y}),a.splice(1,0,d),a.splice(1,0,r),a.splice(1,0,c));return a},dm.prototype.inflate=function(t,e,i){t.x-=e,t.y-=i,t.width+=2*e,t.height+=2*i},dm.isBranchConnector=function(t,e){var i;return!!(0<t.annotations.length&&t.annotations[0].content)&&(i=t.annotations[0].content,e.some(function(t){return 0===i.localeCompare(t,void 0,{sensitivity:"accent"})}))},dm.prototype.isYesBranchConnector=function(t){return dm.isBranchConnector(t,this.yesBranchValues)},dm.prototype.isNoBranchConnector=function(t){return dm.isBranchConnector(t,this.noBranchValues)},dm.prototype.updateHorizontalSegments=function(t,e){var i,n,r,o,a=[],s=this.diagram.nameTable[t.sourceID],h=this.diagram.nameTable[t.targetID],d=this.vertexMapper.get(s.id).isDecisionNode,l=this.horizontalSpacing/2,c=this.verticalSpacing/2;return d?(d=this.isYesBranchConnector(t),t=this.isNoBranchConnector(t),h.wrapper.bounds.containsPoint({x:h.offsetX,y:s.offsetY})||s.offsetY!==h.offsetY&&(d&&"SameAsFlow"===this.yesBranchDirection||t&&"SameAsFlow"===this.noBranchDirection&&"SameAsFlow"!==this.yesBranchDirection)?d&&"LeftInFlow"===this.yesBranchDirection||t&&("SameAsFlow"===this.yesBranchDirection&&("SameAsFlow"===this.noBranchDirection||"LeftInFlow"===this.noBranchDirection)||"RightInFlow"===this.yesBranchDirection&&("LeftInFlow"===this.noBranchDirection||"RightInFlow"===this.noBranchDirection))?(i=s.offsetX,n=s.wrapper.bounds.top,r=h.wrapper.bounds.left,o=h.wrapper.bounds.center.y,a.push({x:i,y:n}),a.push({x:i,y:n-c}),a.push({x:r-l,y:n-c}),a.push({x:r-l,y:o}),a.push({x:r,y:o})):s.offsetY!==h.offsetY&&(d&&"SameAsFlow"===this.yesBranchDirection||t&&"SameAsFlow"===this.noBranchDirection&&"SameAsFlow"!==this.yesBranchDirection)&&(i=s.wrapper.bounds.right,n=s.offsetY,r=h.wrapper.bounds.left,o=h.wrapper.bounds.center.y,a.push({x:i,y:n}),a.push({x:r-l,y:n}),a.push({x:r-l,y:o}),a.push({x:r,y:o})):s.wrapper.bounds.bottom<h.wrapper.bounds.center.y?(i=s.wrapper.bounds.bottom,n=s.offsetX,r=h.wrapper.bounds.left,o=h.offsetY,a.push({x:n,y:i}),a.push({x:n,y:o}),a.push({x:r,y:o})):s.wrapper.bounds.top>h.wrapper.bounds.center.y?(i=s.wrapper.bounds.top,n=s.offsetX,r=h.wrapper.bounds.left,o=h.offsetY,a.push({x:n,y:i}),a.push({x:n,y:o}),a.push({x:r,y:o})):(d&&"RightInFlow"===this.yesBranchDirection||t&&("SameAsFlow"===this.yesBranchDirection&&("RightInFlow"===this.noBranchDirection||"SameAsFlow"===this.noBranchDirection)||"LeftInFlow"===this.yesBranchDirection&&("LeftInFlow"===this.noBranchDirection||"RightInFlow"===this.noBranchDirection)))&&(i=s.offsetX,n=s.wrapper.bounds.bottom,r=h.wrapper.bounds.left,o=h.wrapper.bounds.center.y,a.push({x:i,y:n}),a.push({x:i,y:n+c}),a.push({x:r-l,y:n+c}),a.push({x:r-l,y:o}),a.push({x:r,y:o}))):a=e,a},dm.prototype.updateVerticalConnectorSegments=function(t,e){var i,n,r,o,a,s,h,d,l,c=[],p=this.diagram.nameTable[t.sourceID],g=this.diagram.nameTable[t.targetID],u=this.vertexMapper.get(p.id).isDecisionNode,m=this.horizontalSpacing/2,f=this.verticalSpacing/2;return u?(u=this.isYesBranchConnector(t),t=this.isNoBranchConnector(t),p.wrapper.bounds.right<g.wrapper.bounds.center.x&&(u&&"RightInFlow"===this.yesBranchDirection||t&&("SameAsFlow"===this.yesBranchDirection&&("RightInFlow"===this.noBranchDirection||"SameAsFlow"===this.noBranchDirection)||"LeftInFlow"===this.yesBranchDirection&&("LeftInFlow"===this.noBranchDirection||"RightInFlow"===this.noBranchDirection)))?(s=p.wrapper.bounds.right,h=p.offsetY,d=g.wrapper.bounds.top,l=g.offsetY,c.push({x:s,y:h}),0===(o=(o=this.diagram.nodes.filter(function(t){return t.wrapper.bounds.containsPoint({x:g.offsetX,y:p.offsetY})})).sort(function(t,e){return e.wrapper.bounds.left-t.wrapper.bounds.left})).length?c.push({x:g.offsetX,y:h}):(a=o[0].wrapper.bounds,c.push({x:a.left-m,y:o[0].offsetY}),c.push({x:a.left-m,y:a.bottom+f})),c.push({x:d,y:l})):p.wrapper.bounds.left>g.wrapper.bounds.center.x&&(u&&"LeftInFlow"===this.yesBranchDirection||t&&("SameAsFlow"===this.yesBranchDirection&&("SameAsFlow"===this.noBranchDirection||"LeftInFlow"===this.noBranchDirection)||"RightInFlow"===this.yesBranchDirection&&("LeftInFlow"===this.noBranchDirection||"RightInFlow"===this.noBranchDirection)))?(s=p.wrapper.bounds.left,h=p.offsetY,d=g.wrapper.bounds.top,l=g.offsetY,c.push({x:s,y:h}),i=k.toBounds([c[0],{x:g.offsetX,y:h}]),0===(o=(o=this.diagram.nodes.filter(function(t){return t.wrapper.bounds.intersects(i)&&t.id!==p.id&&t.id!==g.id})).sort(function(t,e){return e.wrapper.bounds.right-t.wrapper.bounds.right})).length?c.push({x:g.offsetX,y:h}):(a=o[0].wrapper.bounds,c.push({x:a.right+m,y:o[0].offsetY}),c.push({x:a.right+m,y:a.bottom+f})),c.push({x:d,y:l})):u&&"RightInFlow"===this.yesBranchDirection||t&&("SameAsFlow"===this.yesBranchDirection&&("RightInFlow"===this.noBranchDirection||"SameAsFlow"===this.noBranchDirection)||"LeftInFlow"===this.yesBranchDirection&&("LeftInFlow"===this.noBranchDirection||"RightInFlow"===this.noBranchDirection))?(s=p.wrapper.bounds.right,h=p.offsetY,d=g.wrapper.bounds.topCenter.x,l=g.wrapper.bounds.topCenter.y,c.push({x:s,y:h}),c.push({x:s+m,y:h}),c.push({x:s+m,y:l-f}),c.push({x:d,y:l-f}),c.push({x:d,y:l}),n=k.toBounds([c[1],c[2]]),0<(o=(o=this.diagram.nodes.filter(function(t){return t.wrapper.bounds.intersects(n)})).sort(function(t,e){return e.wrapper.bounds.right-t.wrapper.bounds.right})).length&&o[0].wrapper.bounds.intersects(n)&&(a=o[0].wrapper.bounds,c[1].x=a.right+m,c[2].x=a.right+m)):u&&"LeftInFlow"===this.yesBranchDirection||t&&("SameAsFlow"===this.yesBranchDirection&&("SameAsFlow"===this.noBranchDirection||"LeftInFlow"===this.noBranchDirection)||"RightInFlow"===this.yesBranchDirection&&("LeftInFlow"===this.noBranchDirection||"RightInFlow"===this.noBranchDirection))?(s=p.wrapper.bounds.left,h=p.offsetY,d=g.wrapper.bounds.topCenter.x,l=g.wrapper.bounds.topCenter.y,c.push({x:s,y:h}),c.push({x:s-m,y:h}),c.push({x:s-m,y:l-f}),c.push({x:d,y:l-f}),c.push({x:d,y:l}),r=k.toBounds([c[1],c[2]]),0<(o=(o=this.diagram.nodes.filter(function(t){return t.wrapper.bounds.intersects(r)})).sort(function(t,e){return e.wrapper.bounds.left-t.wrapper.bounds.left})).length&&o[0].wrapper.bounds.intersects(r)&&(a=o[0].wrapper.bounds,c[1].x=a.left-m,c[2].x=a.left-m)):p.offsetX!==g.offsetX&&(u&&"SameAsFlow"===this.yesBranchDirection||t&&"SameAsFlow"===this.noBranchDirection&&"SameAsFlow"!==this.yesBranchDirection)?(s=p.offsetX,h=p.wrapper.bounds.bottom,d=g.wrapper.bounds.topCenter.x,l=g.wrapper.bounds.topCenter.y,c.push({x:s,y:h}),c.push({x:s,y:l-f}),c.push({x:d,y:l-f}),c.push({x:d,y:l})):c=e):c=e,c},dm.prototype.getModelBounds=function(t){var e=new k(0,0,0,0);return(t=Array.from(t)).forEach(function(t){t=t.geometry;e.uniteRect(t)}),e},dm.prototype.createVertex=function(t){var e=this,i=(isNaN(t.width)?t.wrapper.bounds:t).width,n=(isNaN(t.height)?t.wrapper.bounds:t).height,i=new k(0,0,i,n),r=[],o=[],a={isYesBranch:!1,isNoBranch:!1};if(null!=t.inEdges)for(var s=0,h=t.inEdges;s<h.length;s++){var d=h[s];(p=this.diagram.nameTable[""+d])&&r.push(p)}if(null!=t.outEdges)for(var l=0,c=t.outEdges;l<c.length;l++){var p,d=c[l];(p=this.diagram.nameTable[""+d])&&o.push(p)}var g=a.isYesBranch,u=a.isNoBranch;return null!=r&&r.forEach(function(t){a=e.checkForYesOrNoBranch(t,g,u)}),null!=o&&o.forEach(function(t){e.edgesMapper.set(t,[]),e.loopedgesMapper.set(t,!1)}),{id:t.id,geometry:i,inEdges:r,layoutObjectId:{},outEdges:o,item:t,isDecisionNode:!1,isYesChild:a.isYesBranch,isNoChild:a.isNoBranch}},dm.prototype.updatePoints=function(t,e){for(var i,n=[],r=[],o=0;o<t.length;o++)t[o+2]&&(n.push(t[parseInt(o.toString(),10)]),n.push(t[o+1]),i={type:"Orthogonal",points:n,length:n[0].x===n[1].x?Math.abs(n[0].y-n[1].y):Math.abs(n[0].x-n[1].x),direction:n[0].x===n[1].x?n[0].y>n[1].y?"Top":"Bottom":n[0].x>n[1].x?"Left":"Right"},n=[],r.push(i));e.segments=r},dm.prototype.contains=function(t,e){return t.x>=e.left&&t.x<=e.right&&t.y>=e.top&&t.y<=e.bottom},dm.prototype.updateLoopConnector=function(t){var e=[];if(this.edgesMapper.has(t)){var i=this.edgesMapper.get(t);if(i)for(var n=0,r=i;n<r.length;n++){var o=r[n],a=o.x+this.anchorX,o=o.y+this.anchorY;e.push({x:a,y:o})}}e.reverse();var s,h,d,l,c,p,g,u,m,f,y,i=[],v=this.diagram.nameTable[t.sourceID],b=this.diagram.nameTable[t.targetID],S=v.wrapper.bounds,w=b.wrapper.bounds,x=v,I=b,v=this.vertexMapper.get(t.sourceID).isDecisionNode,b=this.isYesBranchConnector(t),C=this.isNoBranchConnector(t),b=b&&"LeftInFlow"===this.yesBranchDirection,C=C&&("RightInFlow"===this.yesBranchDirection&&("RightInFlow"===this.noBranchDirection||"SameAsFlow"===this.noBranchDirection)||"LeftInFlow"===this.noBranchDirection&&("RightInFlow"===this.yesBranchDirection||"SameAsFlow"===this.yesBranchDirection)),P=this.horizontalSpacing/2,A=this.verticalSpacing/2,T=(new k).uniteRect(x.wrapper.bounds).uniteRect(I.wrapper.bounds),D=this.diagram.nodes.filter(function(t){return t.id!==I.id&&t.id!==x.id&&t.wrapper.bounds.intersects(T)});"TopToBottom"===this.orientation?(l=Array.from(this.vertexMapper.values()).filter(function(t){return t.item.wrapper.bounds.containsPoint({x:t.item.wrapper.bounds.x,y:x.offsetY})&&x.id!==t.item.id}),c=Array.from(this.vertexMapper.values()).filter(function(t){return t.item.wrapper.bounds.containsPoint({x:t.item.wrapper.bounds.x,y:I.offsetY})&&I.id!==t.item.id}),p=Math.max.apply(Math,e.map(function(t){return t.x})),s=!1,v?(b||C)&&(s=!0):s=0<l.length&&l[0].item.wrapper.bounds.x>S.x,0===c.length||!s&&0<c.length&&0<c.filter(function(t){return t.item.wrapper.bounds.right<w.left}).length?(d=(u=!s&&p>S.right?S.right:S.left)+(s?-P:P),g=!s&&p>w.right?w.right:w.left,i.push({x:u,y:x.offsetY}),i.push({x:d,y:x.offsetY}),i.push({x:d,y:I.offsetY}),i.push({x:g,y:I.offsetY})):(u=c[0].item.wrapper.bounds.bottom+A,g=(d=s?S.left:S.right)+(s?-P:P),y=!s&&p>w.right?w.right+P:w.left-P,h=!s&&p>w.right?w.right:w.left,i.push({x:d,y:x.offsetY}),i.push({x:g,y:x.offsetY}),i.push({x:g,y:u}),i.push({x:y,y:u}),i.push({x:y,y:I.offsetY}),i.push({x:h,y:I.offsetY})),0<D.length&&(f=s?Math.min.apply(Math,D.map(function(t){return t.wrapper.bounds.left})):Math.max.apply(Math,D.map(function(t){return t.wrapper.bounds.right})),s&&f<i[1].x||!s&&f>i[1].x)&&(i[1].x=d=f+(s?-P:P),i[2].x=d)):(l=Array.from(this.vertexMapper.values()).filter(function(t){return t.item.wrapper.bounds.containsPoint({y:t.item.wrapper.bounds.y,x:x.offsetX})&&x.id!==t.item.id}),c=Array.from(this.vertexMapper.values()).filter(function(t){return t.item.wrapper.bounds.containsPoint({y:t.item.wrapper.bounds.y,x:I.offsetX})&&I.id!==t.item.id}),p=Math.max.apply(Math,e.map(function(t){return t.y})),g=!1,v?(b||C)&&(g=!0):g=0<l.length&&l[0].item.wrapper.bounds.y>S.y,0===c.length||!g&&0<c.length&&c.some(function(t){return t.item.wrapper.bounds.bottom<w.top})?(i.push({x:x.offsetX,y:!g&&p>S.bottom?S.bottom:S.top}),m=i[0].y+(g?-A:A),i.push({x:x.offsetX,y:m})):(u=c[0].item.wrapper.bounds.right+P,m=!g&&p>w.bottom?w.bottom+A:w.top-A,i.push({x:x.offsetX,y:g?S.top:S.bottom}),i.push({x:x.offsetX,y:i[0].y+(g?-A:A)}),i.push({x:u,y:i[1].y}),i.push({x:u,y:m})),i.push({x:I.offsetX,y:m}),i.push({x:I.offsetX,y:!g&&p>w.bottom?w.bottom:w.top}),0<D.length&&(f=g?Math.min.apply(Math,D.map(function(t){return t.wrapper.bounds.top})):Math.max.apply(Math,D.map(function(t){return t.wrapper.bounds.bottom})),g&&i[1].y>f||!g&&i[1].y<f)&&(i[1].y=f+(y=g?-A:A),i[2].y=f+y)),this.updatePoints(i,t)},dm.prototype.checkForYesOrNoBranch=function(t,i,n){var r=this;return t.annotations&&t.annotations.length&&t.annotations.forEach(function(t){var e;"string"==typeof t.content&&(e=t.content.toString(),r.yesBranchValues.forEach(function(t){0===e.localeCompare(t,void 0,{sensitivity:"accent"})&&(i=!0)}),r.noBranchValues.forEach(function(t){0===e.localeCompare(t,void 0,{sensitivity:"accent"})&&(n=!0)}))}),{isYesBranch:i,isNoBranch:n}},dm.prototype.getTreeVertices=function(e,i,n){var t,r,o,a,s=this;null!=e&&-1===i.indexOf(e)&&(i.push(e),n=n.filter(function(t){return t!==e}),2===(r=e.item.outEdges).length&&(t=this.diagram.nameTable[this.diagram.nameTable[r[0]].targetID],r=this.diagram.nameTable[this.diagram.nameTable[r[1]].targetID],t=this.vertexMapper.get(t.id),r=this.vertexMapper.get(r.id),t)&&r&&(o=t.isYesChild||r.isYesChild,a=t.isNoChild||r.isNoChild,o&&!a?(t.isYesChild?r.isNoChild=!0:t.isNoChild=!0,a=!0):!o&&a&&(t.isNoChild?r.isYesChild=!0:t.isYesChild=!0,o=!0),e.isDecisionNode=o),e.outEdges.forEach(function(t){t=s.diagram.nameTable[t.targetID],t=s.vertexMapper.get(t.id);null!=t&&(e.isDecisionNode||(t.isYesChild=!1,t.isNoChild=!1),s.getTreeVertices(t,i,n))}))},dm.prototype.getEdges=function(t){var e=[];if(null!=t){for(var i=0,n=t.inEdges;i<n.length;i++){var r=n[i];e.push(r)}for(var o=0,a=t.outEdges;o<a.length;o++){var s=a[o];e.push(s)}}return e},dm.prototype.getVisibleTerminal=function(t,e){e=e?t.sourceID:t.targetID;return this.vertexMapper.get(e)},dm.prototype.getEdgesBetween=function(t,e,i){for(var n=this.getEdges(t),r=[],o=0;o<n.length;o++){var a=this.getVisibleTerminal(n[parseInt(o.toString(),10)],!0),s=this.getVisibleTerminal(n[parseInt(o.toString(),10)],!1);a.id===t.id&&s.id===e.id&&r.push(n[parseInt(o.toString(),10)])}return r},dm.prototype.destroy=function(){},dm.prototype.getModuleName=function(){return"FlowchartLayout"};var hm=dm;function dm(){this.rootNodes=[],this.vertexMapper=new Map,this.edgesMapper=new Map,this.loopedgesMapper=new Map,this.anchorX=0,this.anchorY=0,this.verticalSpacing=50,this.horizontalSpacing=50,this.horizontalAlignment="Center",this.verticalAlignment="Top",this.margin={top:50,right:50,bottom:50,left:50},this.orientation="TopToBottom",this.yesBranchDirection="SameAsFlow",this.noBranchDirection="RightInFlow",this.yesBranchValues=["Yes","True"],this.noBranchValues=["No","False"],this.diagram=new ru}cm.prototype.renderConnectorsCollection=function(t,e){t.connectors=[];for(var i=[],n=0;n<e.connectors.length;n++){var r=e.connectors[parseInt(n.toString(),10)],r=this.convertToConnector(r);i.push(r)}t.connectors=i},cm.prototype.convertToConnector=function(t){var e={style:{}};return t.name&&(e.id=t.name),t.addInfo&&(e.addInfo=t.addInfo),t.bridgeSpace&&(e.bridgeSpace=t.bridgeSpace),t.constraints&&(e.constraints=this.setConnectorConstraints(t.constraints)),t.cornerRadius&&(e.cornerRadius=t.cornerRadius),t.labels&&(e.annotations=this.labelProperties.setLabelProperties(t.labels,t)),t.lineColor&&(e.style.fill=t.lineColor),t.lineWidth&&(e.style.strokeWidth=t.lineWidth),t.lineDashArray&&(e.style.strokeDashArray=t.lineDashArray),t.opacity&&(e.style.opacity=t.opacity),t.lineHitPadding&&(e.hitPadding=t.lineHitPadding),t.margin&&(e.margin={left:t.margin.left,right:t.margin.right,top:t.margin.top,bottom:t.margin.bottom}),t.segments&&(e.type=t.segments[0].type.charAt(0).toUpperCase()+t.segments[0].type.slice(1),e.segments=this.setConnectorSegments(t.segments)),t.shape&&(e.shape=this.getConnectorShape(t.shape)),t.sourceDecorator&&(e.sourceDecorator={height:t.sourceDecorator.height,width:t.sourceDecorator.width,shape:this.getDecoratorShape(t.sourceDecorator.shape),pathData:t.sourceDecorator.pathData,style:{fill:t.sourceDecorator.fillColor,strokeColor:t.sourceDecorator.lineColor,strokeWidth:t.sourceDecorator.lineWidth}}),t.targetDecorator&&(e.targetDecorator={height:t.targetDecorator.height,width:t.targetDecorator.width,shape:this.getDecoratorShape(t.targetDecorator.shape),pathData:t.targetDecorator.pathData,style:{fill:t.targetDecorator.fillColor,strokeColor:t.targetDecorator.lineColor,strokeWidth:t.targetDecorator.lineWidth}}),t.sourceNode&&(e.sourceID=t.sourceNode),t.targetNode&&(e.targetID=t.targetNode),t.sourcePoint&&(e.sourcePoint={x:t.sourcePoint.x,y:t.sourcePoint.y}),t.targetPoint&&(e.targetPoint={x:t.targetPoint.x,y:t.targetPoint.y}),t.sourcePort&&(e.sourcePortID=t.sourcePort),t.targetPort&&(e.targetPortID=t.targetPort),t.tooltip&&(e.tooltip={content:t.tooltip.content,relativeMode:t.tooltip.relativeMode}),t.visible&&(e.visible=t.visible),t.zOrder&&(e.zIndex=t.zOrder),e},cm.prototype.getConnectorShape=function(t){var e=null;return e=t&&("bpmn"===t.type&&(e={type:"Bpmn",flow:t.flow.charAt(0).toUpperCase()+t.flow.slice(1)},"sequence"===t.flow?e.sequence=t.sequence.charAt(0).toUpperCase()+t.sequence.slice(1):"association"===t.flow?e.association=t.association.charAt(0).toUpperCase()+t.association.slice(1):e.message=t.message.charAt(0).toUpperCase()+t.message.slice(1)),"umlclassifier"===t.type&&(e={type:"UmlClassifier",relationship:t.relationship.charAt(0).toUpperCase()+t.relationship.slice(1),multiplicity:{type:t.multiplicity.type.charAt(0).toUpperCase()+t.multiplicity.type.slice(1),source:{upperBounds:t.multiplicity.source.upperBounds,optional:t.multiplicity.source.optional,lowerBounds:t.multiplicity.source.lowerBounds},target:{upperBounds:t.multiplicity.target.upperBounds,optional:t.multiplicity.target.optional,lowerBounds:t.multiplicity.target.lowerBounds}}}),"umlactivity"===t.type)?{type:"UmlActivity",flow:t.flow.charAt(0).toUpperCase()+t.flow.slice(1)}:e},cm.prototype.getDecoratorShape=function(t){return"path"===t?"Custom":t.charAt(0).toUpperCase()+t.slice(1)},cm.prototype.setConnectorSegments=function(t){var e=[];if(0<t.length)for(var i=0;i<t.length;i++){var n={},r=t[parseInt(i.toString(),10)];n.direction=r.direction?r.direction.charAt(0).toUpperCase()+r.direction.slice(1):r._direction?r._direction.charAt(0).toUpperCase()+r._direction.slice(1):null,n.length=r.length||r._length||null,n.point=r.point?{x:r.point.x,y:r.point.y}:null,n.point1=r.point1?{x:r.point1.x,y:r.point1.y}:null,n.point2=r.point2?{x:r.point2.x,y:r.point2.y}:null,n.vector1=r.vector1?{angle:r.vector1.angle,distance:r.vector1.distance}:null,n.vector2=r.vector2?{angle:r.vector2.angle,distance:r.vector2.distance}:null,r.points&&(n.points=this.getSegmentPoints(r.points)),r.type&&(n.type=r.type.charAt(0).toUpperCase()+r.type.slice(1)),e.push(n)}return e},cm.prototype.getSegmentPoints=function(t){var e=[];if(0<t.length)for(var i=0;i<t.length;i++){var n={},r=t[parseInt(i.toString(),10)];n.x=r.x,n.y=r.y,e.push(n)}return e},cm.prototype.setConnectorConstraints=function(t){var e=Z.ConnectorConstraints.None;return t&Z.ConnectorConstraints.Select&&(e|=Z.ConnectorConstraints.Select),t&Z.ConnectorConstraints.Delete&&(e|=Z.ConnectorConstraints.Delete),t&Z.ConnectorConstraints.Drag&&(e|=Z.ConnectorConstraints.Drag),t&Z.ConnectorConstraints.DragSourceEnd&&(e|=Z.ConnectorConstraints.DragSourceEnd),t&Z.ConnectorConstraints.DragTargetEnd&&(e|=Z.ConnectorConstraints.DragTargetEnd),t&Z.ConnectorConstraints.DragSegmentThumb&&(e|=Z.ConnectorConstraints.DragSegmentThumb),t&Z.ConnectorConstraints.Bridging&&(e|=Z.ConnectorConstraints.Bridging),t&Z.ConnectorConstraints.InheritBridging&&(e|=Z.ConnectorConstraints.InheritBridging),t&Z.ConnectorConstraints.AllowDrop&&(e|=Z.ConnectorConstraints.AllowDrop),t&Z.ConnectorConstraints.InheritTooltip&&(e|=Z.ConnectorConstraints.InheritTooltip),t&Z.ConnectorConstraints.PointerEvents&&(e|=Z.ConnectorConstraints.PointerEvents),t&Z.ConnectorConstraints.BridgeObstacle&&(e|=Z.ConnectorConstraints.BridgeObstacle),t&Z.ConnectorConstraints.Interaction&&(e|=Z.ConnectorConstraints.Interaction),t&Z.ConnectorConstraints.Default&&(e|=Z.ConnectorConstraints.Default),e},cm.prototype.getModuleName=function(){return"ConnectorProperties"};var lm=cm;function cm(t){this.labelProperties=t}gm.prototype.setLabelProperties=function(t,e){var i=[];if(0<t.length)for(var n=0;n<t.length;n++){var r=t[parseInt(n.toString(),10)],o={style:{}};if(r.name&&(a=(a=r.name.split("_"))[a.length-1],o.id=a),r.addInfo&&(o.addInfo=r.addInfo),r.text&&(o.content=r.text),r.constraints&&(o.constraints=this.setLabelConstraints(r.constraints)),r.readOnly&&(o.constraints=o.constraints|Z.AnnotationConstraints.ReadOnly),r.dragLimit&&(o.dragLimit={left:r.dragLimit.left,right:r.dragLimit.right,top:r.dragLimit.top,bottom:r.dragLimit.bottom}),r.height&&(o.height=r.height),r.horizontalAlignment&&(o.horizontalAlignment=r.horizontalAlignment.charAt(0).toUpperCase()+r.horizontalAlignment.slice(1).toLowerCase()),r.verticalAlignment&&(o.verticalAlignment=r.verticalAlignment.charAt(0).toUpperCase()+r.verticalAlignment.slice(1).toLowerCase()),r.hyperlink&&(o.hyperlink={link:r.hyperlink,color:"blue"}),r.margin&&(o.margin={left:r.margin.left,right:r.margin.right,top:r.margin.top,bottom:r.margin.bottom}),o.rotateAngle=r.rotateAngle,r.offset&&(o.offset=e?r.offset.x:{x:r.offset.x,y:r.offset.y}),o.style.color=r.fontColor,o.style.fontFamily=r.fontFamily,o.style.fontSize=r.fontSize,o.style.italic=r.italic,o.style.bold=r.bold,r.borderColor&&(o.style.strokeColor=r.borderColor),r.borderWidth&&(o.style.strokeWidth=r.borderWidth),r.wrapping)switch(r.wrapping){case"wrap":o.style.textWrapping="Wrap";break;case"nowrap":o.style.textWrapping="NoWrap";break;case"wrapwithoverflow":o.style.textWrapping="WrapWithOverflow"}r.textOverflow&&r.overflowType&&(o.style.textOverflow=r.overflowType.charAt(0).toUpperCase()+r.overflowType.slice(1)),r.textAlign&&(o.style.textAlign=r.textAlign.charAt(0).toUpperCase()+r.textAlign.slice(1).toLowerCase()),r.textDecoration&&(o.style.textDecoration=r.textDecoration.charAt(0).toUpperCase()+r.textDecoration.slice(1).toLowerCase(),"Linethrough"===o.style.textDecoration)&&(o.style.textDecoration="LineThrough");var a=this.setLabelAppearance(o,r);o.style.fill=a.fill,o.style.opacity=a.opacity,o.visibility=a.visibility,r.width&&(o.width=r.width),i.push(o)}return i},gm.prototype.setLabelAppearance=function(t,e){var i={};return e.fillColor&&(i.fill="white"===e.fillColor?"transparent":e.fillColor),e.opacity&&(i.opacity=e.opacity),e.visible&&(i.visibility=e.visible),i},gm.prototype.setLabelConstraints=function(t){var e=Z.AnnotationConstraints.None;return t&Z.AnnotationConstraints.Select&&(e|=Z.AnnotationConstraints.Select),t&Z.AnnotationConstraints.Drag&&(e|=Z.AnnotationConstraints.Drag),t&Z.AnnotationConstraints.Resize&&(e|=Z.AnnotationConstraints.Resize),t&Z.AnnotationConstraints.Rotate&&(e|=Z.AnnotationConstraints.Rotate),e},gm.prototype.getModuleName=function(){return"LabelProperties"};var pm=gm;function gm(t){this.modelProperties=t}mm.prototype.renderNodesCollection=function(t,e){t.nodes=[];for(var i=[],n=0;n<e.nodes.length;n++){var r=e.nodes[parseInt(n.toString(),10)],o=[],a=this.convertToNode(r);if(a.shape&&a.shape.activity&&a.shape.activity.subProcess&&a.shape.activity.subProcess.processes&&0<a.shape.activity.subProcess.processes.length){for(var s=[],h=0;h<a.shape.activity.subProcess.processes.length;h++){var d=a.shape.activity.subProcess.processes[parseInt(h.toString(),10)];d.margin.right=0,d.margin.bottom=0,d.processId=a.id,s.push(d.id),o.push(d)}a.shape.activity.subProcess.processes=s}if("group"===r.type&&!r.isSwimlane){var l=[];if(a.children&&0<a.children.length){for(var c=0;c<a.children.length;c++){var p=a.children[parseInt(c.toString(),10)];i.push(p),l.push(p.id)}a.children=l}}i.push(a),o&&0<o.length&&(i=i.concat(o))}return t.nodes=i,t.nodes},mm.prototype.convertToNode=function(t){var e={style:{},margin:{}};return t.name&&(e.id=t.name),t.fillColor&&(e.style.fill=t.fillColor),t.borderColor&&(e.style.strokeColor=t.borderColor),t.borderWidth&&(e.style.strokeWidth=t.borderWidth),t.borderDashArray&&(e.style.strokeDashArray=t.borderDashArray),t.opacity&&(e.style.opacity=t.opacity),t.gradient&&(e.style.gradient=this.setGradient(t.gradient)),t.isExpanded&&(e.isExpanded=t.isExpanded),t.width&&(e.width=t.width),t.height&&(e.height=t.height),t.offsetX&&(e.offsetX=t.offsetX),t.offsetY&&(e.offsetY=t.offsetY),t.visible&&(e.visible=t.visible),e.zIndex=-1===t.zOrder?-1:t.zOrder,t.excludeFromLayout&&(e.excludeFromLayout=t.excludeFromLayout),t.rotateAngle&&(e.rotateAngle=t.rotateAngle),t.pivot&&(e.pivot=t.pivot),t.addInfo&&(e.addInfo=t.addInfo),t.marginLeft&&(e.margin.left=t.marginLeft),t.marginRight&&(e.margin.right=t.marginRight),t.marginTop&&(e.margin.top=t.marginTop),t.marginBottom&&(e.margin.bottom=t.marginBottom),t.horizontalAlign&&(e.horizontalAlignment=t.horizontalAlign),t.verticalAlign&&(e.verticalAlignment=t.verticalAlign),t.constraints&&(e.constraints=this.setNodeConstraints(t.constraints)),t.labels&&(e.annotations=this.labelProperties.setLabelProperties(t.labels,void 0)),t.shadow&&(e.shadow={angle:t.shadow.angle,opacity:t.shadow.opacity,distance:t.shadow.distance}),t.tooltip&&(e.tooltip={relativeMode:t.tooltip.relativeMode}),t.expandIcon&&(e.expandIcon={shape:t.expandIcon.shape.charAt(0).toUpperCase()+t.expandIcon.shape.slice(1),width:t.expandIcon.width,height:t.expandIcon.height,margin:{left:t.expandIcon.margin.left,right:t.expandIcon.margin.right,top:t.expandIcon.margin.top,bottom:t.expandIcon.margin.bottom},offset:{x:t.expandIcon.offset.x,y:t.expandIcon.offset.y},borderColor:t.expandIcon.borderColor,borderWidth:t.expandIcon.borderWidth,cornerRadius:t.expandIcon.cornerRadius,pathData:t.expandIcon.pathData},"Arrowup"===e.expandIcon.shape?e.expandIcon.shape="ArrowUp":"Arrowdown"===e.expandIcon.shape&&(e.expandIcon.shape="ArrowDown")),t.collapseIcon&&(e.collapseIcon={shape:t.collapseIcon.shape.charAt(0).toUpperCase()+t.collapseIcon.shape.slice(1),width:t.collapseIcon.width,height:t.collapseIcon.height,margin:{left:t.collapseIcon.margin.left,right:t.collapseIcon.margin.right,top:t.collapseIcon.margin.top,bottom:t.collapseIcon.margin.bottom},offset:{x:t.collapseIcon.offset.x,y:t.collapseIcon.offset.y},borderColor:t.collapseIcon.borderColor,borderWidth:t.collapseIcon.borderWidth,cornerRadius:t.collapseIcon.cornerRadius,pathData:t.collapseIcon.pathData},"Arrowup"===e.collapseIcon.shape?e.collapseIcon.shape="ArrowUp":"Arrowdown"===e.collapseIcon.shape&&(e.collapseIcon.shape="ArrowDown")),t.ports&&(e.ports=this.portProperties.setPortProperties(t.ports)),t.children&&"bpmn"!==t.type&&!t.isSwimlane&&(e.children=this.getChildren(e,t)),t.children&&0<t.children.length||(e.maxWidth=t.maxWidth,e.maxHeight=t.maxHeight,e.minWidth=t.minWidth,e.minHeight=t.minHeight),e=t.shape||t.type?this.setShape(e,t):e},mm.prototype.getChildren=function(t,e){if(e.children&&0<e.children.length){for(var i=[],n=0;n<e.children.length;n++){var r=this.convertToNode(e.children[parseInt(n.toString(),10)]);r.children&&this.getChildren(t,r),i.push(r)}t.children=i}return t.children},mm.prototype.setShape=function(t,e){switch(e.type){case"basic":var i=e.shape.charAt(0).toUpperCase()+e.shape.slice(1);"path"===e.shape?t.shape={type:"Path",data:e.pathData}:t.shape={type:"Basic",shape:i,cornerRadius:e.cornerRadius,points:e.points};break;case"flow":i=e.shape.charAt(0).toUpperCase()+e.shape.slice(1);t.shape={type:"Flow",shape:i};break;case"umlactivity":t.shape={type:"UmlActivity",shape:e.shape.charAt(0).toUpperCase()+e.shape.slice(1)};break;case"image":t.shape={type:"Image",source:e.source,align:this.getImageContentAlignment(e.contentAlignment),scale:e.scale.charAt(0).toUpperCase()+e.scale.slice(1)};break;case"html":t.shape={type:"HTML"};break;case"native":t.shape={type:"Native"};break;case"text":t.shape={type:"Text",content:e.textBlock.text};break;case"bpmn":t.shape=this.renderBpmnShape(t,e);break;case"group":e.isSwimlane&&(t.shape=this.renderSwimlaneShape(t,e))}return t},mm.prototype.getImageContentAlignment=function(t){if(t)switch(t){case"xminymin":return"XMinYMin";case"xminymid":return"XMinYMid";case"xminymax":return"XMinYMax";case"xmidymin":return"XMidYMin";case"xmidymid":return"XMidYMid";case"xmidymax":return"XMidYMax";case"xmaxymin":return"XMaxYMin";case"xmaxymid":return"XMaxYMid";case"xmaxymax":return"XMaxYMax";case"none":return"None"}return"None"},mm.prototype.setNodeConstraints=function(t){var e=Z.NodeConstraints.None;return t&Z.NodeConstraints.Select&&(e|=Z.NodeConstraints.Select),t&Z.NodeConstraints.Delete&&(e|=Z.NodeConstraints.Delete),t&Z.NodeConstraints.Drag&&(e|=Z.NodeConstraints.Drag),t&Z.NodeConstraints.Rotate&&(e|=Z.NodeConstraints.Rotate),t&Z.NodeConstraints.ResizeNorthEast&&(e|=Z.NodeConstraints.ResizeNorthEast),t&Z.NodeConstraints.ResizeEast&&(e|=Z.NodeConstraints.ResizeEast),t&Z.NodeConstraints.OutConnect&&(e|=Z.NodeConstraints.ResizeSouthEast),t&Z.NodeConstraints.Expandable&&(e|=Z.NodeConstraints.ResizeSouth),t&Z.NodeConstraints.AllowDrop&&(e|=Z.NodeConstraints.ResizeSouthWest),t&Z.NodeConstraints.ResizeNorthEast&&(e|=Z.NodeConstraints.ResizeWest),t&Z.NodeConstraints.ResizeEast&&(e|=Z.NodeConstraints.ResizeNorthWest),t&Z.NodeConstraints.ResizeNorth&&(e|=Z.NodeConstraints.ResizeNorth),t&Z.NodeConstraints.Resize&&(e|=Z.NodeConstraints.Resize),t&Z.NodeConstraints.Shadow&&(e|=Z.NodeConstraints.Shadow),t&Z.NodeConstraints.AspectRatio&&(e|=Z.NodeConstraints.AspectRatio),t&Z.NodeConstraints.AllowDrop&&(e|=Z.NodeConstraints.AllowDrop),t&Z.NodeConstraints.InheritTooltip&&(e|=Z.NodeConstraints.InheritTooltip),t&Z.NodeConstraints.PointerEvents&&(e|=Z.NodeConstraints.PointerEvents),t&Z.NodeConstraints.Inherit&&(e|=Z.NodeConstraints.Inherit),t&Z.NodeConstraints.Default&&(e|=Z.NodeConstraints.Default),e},mm.prototype.setGradient=function(t){var e={};return t&&("linear"===t.type?e={type:"Linear",x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2,stops:this.getGradientStops(t.stops)}:"radial"===t.type&&(e={type:"Radial",cx:t.cx,cy:t.cy,fx:t.fx,fy:t.fy,stops:this.getGradientStops(t.stops)})),e},mm.prototype.getGradientStops=function(t){for(var e=[],i=0;i<t.length;i++){var n={},r=t[parseInt(i.toString(),10)];n.color=r.color,n.offset=r.offset,e.push(n)}return e},mm.prototype.renderBpmnShape=function(t,e){return"event"===e.shape?t.shape={type:"Bpmn",shape:e.shape.charAt(0).toUpperCase()+e.shape.slice(1),event:{event:e.event.charAt(0).toUpperCase()+e.event.slice(1),trigger:e.trigger.charAt(0).toUpperCase()+e.trigger.slice(1)}}:"gateway"===e.shape?t.shape={type:"Bpmn",shape:e.shape.charAt(0).toUpperCase()+e.shape.slice(1),gateway:{type:e.gateway.charAt(0).toUpperCase()+e.gateway.slice(1)}}:"activity"===e.shape?(t.shape={type:"Bpmn",shape:e.shape.charAt(0).toUpperCase()+e.shape.slice(1),activity:{activity:e.activity.charAt(0).toUpperCase()+e.activity.slice(1)}},t.shape.activity.activity="Subprocess"===t.shape.activity.activity?"SubProcess":t.shape.activity.activity,"task"===e.activity&&(t.shape.activity.task={type:e.task.type.charAt(0).toUpperCase()+e.task.type.slice(1),loop:e.task.loop.charAt(0).toUpperCase()+e.task.loop.slice(1),compensation:e.task.compensation,call:e.task.call}),"subprocess"===e.activity&&("event"===e.subProcess.type?t.shape.activity.subProcess={collapsed:e.subProcess.collapsed,compensation:e.subProcess.compensation,adhoc:e.subProcess.adhoc,loop:e.subProcess.loop.charAt(0).toUpperCase()+e.subProcess.loop.slice(1),boundary:e.subProcess.boundary.charAt(0).toUpperCase()+e.subProcess.boundary.slice(1),type:e.subProcess.type.charAt(0).toUpperCase()+e.subProcess.type.slice(1),event:{event:e.subProcess.event.charAt(0).toUpperCase()+e.subProcess.event.slice(1),trigger:e.subProcess.trigger.charAt(0).toUpperCase()+e.subProcess.trigger.slice(1)}}:"transaction"===e.subProcess.type&&(t.shape.activity.subProcess={collapsed:e.subProcess.collapsed,compensation:e.subProcess.compensation,adhoc:e.subProcess.adhoc,loop:e.subProcess.loop.charAt(0).toUpperCase()+e.subProcess.loop.slice(1),boundary:e.subProcess.boundary.charAt(0).toUpperCase()+e.subProcess.boundary.slice(1),type:e.subProcess.type.charAt(0).toUpperCase()+e.subProcess.type.slice(1),events:this.renderEventsCollection(e.subProcess.events),processes:this.renderProcessesCollection(e)}))):"dataobject"===e.shape?(t.shape={type:"Bpmn",shape:e.shape.charAt(0).toUpperCase()+e.shape.slice(1)},e.annotation&&(t.shape.annotation={text:e.annotation.text,angle:e.annotation.angle,width:e.annotation.width,height:e.annotation.height,length:e.annotation.length})):t.shape={type:"Bpmn",shape:e.shape.charAt(0).toUpperCase()+e.shape.slice(1)},t.shape},mm.prototype.renderSwimlaneShape=function(t,e){t.shape={type:"SwimLane",orientation:e.orientation.charAt(0).toUpperCase()+e.orientation.slice(1),header:{annotation:{content:e.header.text},height:50,style:{fontSize:e.header.fontSize,color:e.header.fontColor,fill:e.header.fillColor}}};for(var i=[],n=[],r=0;r<e.lanes.length;r++){i[parseInt(r.toString(),10)]={header:{annotation:{content:e.lanes[parseInt(r.toString(),10)].header.text,width:e.lanes[parseInt(r.toString(),10)].header.width,style:{fontSize:e.lanes[parseInt(r.toString(),10)].header.fontSize,color:e.lanes[parseInt(r.toString(),10)].header.fontColor}}},style:{fill:e.lanes[parseInt(r.toString(),10)].fillColor},children:[]};for(var o=0;o<e.lanes[parseInt(r.toString(),10)].children.length;o++){var a=this.convertToNode(e.lanes[parseInt(r.toString(),10)].children[parseInt(o.toString(),10)]);null==a.wrapper&&(a.wrapper={actualSize:{width:a.width,height:a.height},offsetX:a.offsetX,offsetY:a.offsetY}),i[parseInt(r.toString(),10)].children.push(a)}}for(r=0;r<e.phases.length;r++)n[parseInt(r.toString(),10)]={header:{annotation:{content:e.phases[parseInt(r.toString(),10)].label.text,style:{fill:e.phases[parseInt(r.toString(),10)].label.fillColor,fontSize:e.phases[parseInt(r.toString(),10)].label.fontSize,color:e.phases[parseInt(r.toString(),10)].label.fontColor}}},offset:e.phases[parseInt(r.toString(),10)].offset,style:{fill:e.phases[parseInt(r.toString(),10)].fillColor,strokeColor:e.phases[parseInt(r.toString(),10)].lineColor,strokeDashArray:e.phases[parseInt(r.toString(),10)].lineDashArray}};return t.shape.lanes=i,t.shape.phases=n,t.shape},mm.prototype.renderEventsCollection=function(t){var e=[];if(0<t.length)for(var i=0;i<t.length;i++){var n={},r=t[parseInt(i.toString(),10)];n.event=r.event.charAt(0).toUpperCase()+r.event.slice(1),n.trigger=r.trigger.charAt(0).toUpperCase()+r.trigger.slice(1),n.offset={x:r.offset.x,y:r.offset.y},e.push(n)}return e},mm.prototype.renderProcessesCollection=function(t){var e=[];if(t.subProcess&&0<t.subProcess.processes.length)for(var i=0;i<t.subProcess.processes.length;i++){var n=t.subProcess.processes[parseInt(i.toString(),10)],n=this.convertToNode(n);e.push(n)}return e},mm.prototype.getModuleName=function(){return"NodeProperties"};var um=mm;function mm(t,e){this.labelProperties=t,this.portProperties=e}ym.prototype.setPortProperties=function(t){var e=[];if(0<t.length)for(var i=0;i<t.length;i++){var n=t[parseInt(i.toString(),10)],r={style:{}};r.id=n.name,n.addInfo&&(r.addInfo=n.addInfo),r.height=n.size,r.width=n.size,n.horizontalAlignment&&(r.horizontalAlignment=n.horizontalAlignment.charAt(0).toUpperCase()+n.horizontalAlignment.slice(1)),n.verticalAlignment&&(r.verticalAlignment=n.verticalAlignment.charAt(0).toUpperCase()+n.verticalAlignment.slice(1)),n.margin&&(r.margin={left:n.margin.left,right:n.margin.right,top:n.margin.top,bottom:n.margin.bottom}),r.offset={x:n.offset.x,y:n.offset.y},r.style.strokeColor=n.borderColor,r.style.strokeWidth=n.borderWidth,r.style.fill=n.fillColor,r.constraints=this.setPortConstraints(n.constraints),n.pathData&&(r.pathData=n.pathData),"path"===n.shape?r.shape="Custom":n.shape?r.shape=n.shape.charAt(0).toUpperCase()+n.shape.slice(1):r.shape="Square",r.visibility=this.setPortVisibility(n.visibility),e.push(r)}return e},ym.prototype.setPortConstraints=function(t){var e=Z.PortConstraints.Default;return t&Z.PortConstraints.Draw&&(e|=Z.PortConstraints.Draw),e=t&Z.PortConstraints.None?Z.PortConstraints.None:e},ym.prototype.setPortVisibility=function(t){var e;return t&Z.PortVisibility.Visible&&(e|=Z.PortVisibility.Visible),t&Z.PortVisibility.Hidden&&(e|=Z.PortVisibility.Hidden),t&Z.PortVisibility.Hover&&(e|=Z.PortVisibility.Hover),t&Z.PortVisibility.Connect&&(e|=Z.PortVisibility.Connect),e},ym.prototype.getModuleName=function(){return"PortProperties"};var fm=ym;function ym(t){this.modelProperties=t}bm.prototype.getSerializedData=function(t){return this.convertedData.mode="SVG",this.convertedData.basicElements=[],this.convertedData.width=t.width,this.convertedData.height=t.height,t.nodes&&0<t.nodes.length?this.nodeProperties.renderNodesCollection(this.convertedData,t):this.convertedData.nodes=t.nodes,t.connectors&&0<t.connectors.length?this.connectorProperties.renderConnectorsCollection(this.convertedData,t):this.convertedData.connectors=t.connectors,void 0!==t.defaultSettings&&(this.convertedData.getNodeDefaults=this.getNodeDefaults(t.defaultSettings.node),this.convertedData.getConnectorDefaults=this.getConnectorDefaults(t.defaultSettings.connector)),this.setLayers(this.convertedData,t),this.setDataSourceSettings(this.convertedData,t),this.setRulerSettings(this.convertedData,t),this.setSnapSettings(this.convertedData,t),t.snapSettings.enableSnapToObject?this.convertedData.snapSettings.constraints=this.convertedData.snapSettings.constraints|Z.SnapConstraints.SnapToObject:this.convertedData.snapSettings.constraints=this.convertedData.snapSettings.constraints&~Z.SnapConstraints.SnapToObject,void 0===t.pageSettings.backgroundImage&&(t.pageSettings.pageBackgroundColor="transparent",t.pageSettings.backgroundImage={source:"",scale:"meet",alignment:"xmidymid"},t.pageSettings.showPageBreak=!1),this.setScrollSettings(this.convertedData,t),this.setPageSettings(this.convertedData,t),this.setContextMenu(this.convertedData,t),this.setTooltip(this.convertedData,t),this.setModelLayout(this.convertedData,t),this.setSelectedItems(this.convertedData,t),this.convertedData.constraints=this.setDiagramConstraints(t.constraints),this.convertedData.tool=this.setDiagramTool(t.tool),this.convertedData.drawType=t.drawType,this.convertedData.commandManager=t.commandManager,this.convertedData},bm.prototype.getNodeDefaults=function(t){return t?this.nodeProperties.convertToNode(t):null},bm.prototype.getConnectorDefaults=function(t){return t?this.connectorProperties.convertToConnector(t):null},bm.prototype.setLayers=function(t,e){if(t.layers=[],0<e.layers.length)for(var i=0;i<e.layers.length;i++){var n={},r=e.layers[parseInt(i.toString(),10)];n.id=r.name,n.visible=r.visible,n.lock=r.lock,n.objects=r.objects,t.layers.push(n)}},bm.prototype.setDataSourceSettings=function(t,e){t.dataSourceSettings={},t.dataSourceSettings.id=e.dataSourceSettings.id,t.dataSourceSettings.dataManager=e.dataSourceSettings.dataSource,t.dataSourceSettings.root=e.dataSourceSettings.root,t.dataSourceSettings.parentId=e.dataSourceSettings.parent,t.dataSourceSettings.crudAction={read:e.dataSourceSettings.crudAction.read,create:e.dataSourceSettings.crudAction.create,update:e.dataSourceSettings.crudAction.update,destroy:e.dataSourceSettings.crudAction.destroy,customFields:e.dataSourceSettings.customFields},e.dataSourceSettings.connectionDataSource&&(t.dataSourceSettings.connectionDataSource={},t.dataSourceSettings.connectionDataSource.id=e.dataSourceSettings.connectionDataSource.id,t.dataSourceSettings.connectionDataSource.dataManager=e.dataSourceSettings.connectionDataSource.dataSource,t.dataSourceSettings.connectionDataSource.sourceID=e.dataSourceSettings.connectionDataSource.sourceNode,t.dataSourceSettings.connectionDataSource.targetID=e.dataSourceSettings.connectionDataSource.targetNode,t.dataSourceSettings.connectionDataSource.sourcePointX=e.dataSourceSettings.connectionDataSource.sourcePointX,t.dataSourceSettings.connectionDataSource.sourcePointY=e.dataSourceSettings.connectionDataSource.sourcePointY,t.dataSourceSettings.connectionDataSource.targetPointX=e.dataSourceSettings.connectionDataSource.targetPointX,t.dataSourceSettings.connectionDataSource.targetPointY=e.dataSourceSettings.connectionDataSource.targetPointY,t.dataSourceSettings.connectionDataSource.crudAction={read:e.dataSourceSettings.connectionDataSource.crudAction.read,create:e.dataSourceSettings.connectionDataSource.crudAction.create,update:e.dataSourceSettings.connectionDataSource.crudAction.update,destroy:e.dataSourceSettings.connectionDataSource.crudAction.destroy,customFields:e.dataSourceSettings.connectionDataSource.customFields})},bm.prototype.setRulerSettings=function(t,e){t.rulerSettings={},t.rulerSettings.showRulers=e.rulerSettings.showRulers,t.rulerSettings.horizontalRuler=this.setRulerProperties(e.rulerSettings.horizontalRuler),t.rulerSettings.verticalRuler=this.setRulerProperties(e.rulerSettings.verticalRuler)},bm.prototype.setRulerProperties=function(t){var e={};return e.interval=t.interval,e.segmentWidth=t.segmentWidth,e.markerColor=t.markerColor,e.thickness=t.thickness,e.arrangeTick=t.arrangeTick,e},bm.prototype.setSnapSettings=function(t,e){t.snapSettings={},e.snapSettings&&(t.snapSettings.horizontalGridLines=this.setGridLines(e.snapSettings.horizontalGridLines),t.snapSettings.verticalGridLines=this.setGridLines(e.snapSettings.verticalGridLines),t.snapSettings.snapAngle=e.snapSettings.snapAngle,t.snapSettings.snapObjectDistance=e.snapSettings.snapObjectDistance,t.snapSettings.constraints=this.setSnapConstraints(e.snapSettings.snapConstraints))},bm.prototype.setSnapConstraints=function(t){var e=Z.SnapConstraints.None;return t&Z.SnapConstraints.ShowHorizontalLines&&(e|=Z.SnapConstraints.ShowHorizontalLines),t&Z.SnapConstraints.ShowVerticalLines&&(e|=Z.SnapConstraints.ShowVerticalLines),t&Z.SnapConstraints.ShowLines&&(e|=Z.SnapConstraints.ShowLines),t&Z.SnapConstraints.SnapToHorizontalLines&&(e|=Z.SnapConstraints.SnapToHorizontalLines),t&Z.SnapConstraints.SnapToVerticalLines&&(e|=Z.SnapConstraints.SnapToVerticalLines),t&Z.SnapConstraints.SnapToLines&&(e|=Z.SnapConstraints.SnapToLines),e},bm.prototype.setGridLines=function(t){var e={};return e.lineColor=t.lineColor,e.lineDashArray=t.lineDashArray,e.lineIntervals=t.lineInterval,e.snapIntervals=t.snapInterval,e},bm.prototype.setScrollSettings=function(t,e){t.scrollSettings={horizontalOffset:e.scrollSettings.horizontalOffset,verticalOffset:e.scrollSettings.verticalOffset,currentZoom:e.scrollSettings.currentZoom,viewPortWidth:e.scrollSettings.viewPortWidth,viewPortHeight:e.scrollSettings.viewPortHeight,minZoom:e.scrollSettings.minZoom,maxZoom:e.scrollSettings.maxZoom,scrollLimit:e.pageSettings.scrollLimit.charAt(0).toUpperCase()+e.pageSettings.scrollLimit.slice(1),scrollableArea:e.pageSettings.scrollableArea,canAutoScroll:e.enableAutoScroll,autoScrollBorder:e.pageSettings.autoScrollBorder}},bm.prototype.setPageSettings=function(t,e){t.pageSettings={width:e.pageSettings.pageWidth,height:e.pageSettings.pageHeight,margin:{left:e.pageSettings.pageMargin,right:e.pageSettings.pageMargin,top:e.pageSettings.pageMargin,bottom:e.pageSettings.pageMargin},orientation:e.pageSettings.pageOrientation.charAt(0).toUpperCase()+e.pageSettings.pageOrientation.slice(1),boundaryConstraints:e.pageSettings.boundaryConstraints.charAt(0).toUpperCase()+e.pageSettings.boundaryConstraints.slice(1),background:{color:e.pageSettings.pageBackgroundColor,source:e.backgroundImage.source,scale:e.backgroundImage.scale,align:e.backgroundImage.align},multiplePage:e.pageSettings.multiplePage,showPageBreaks:e.pageSettings.showPageBreak}},bm.prototype.setContextMenu=function(t,e){t.contextMenuSettings={},t.contextMenuSettings.show=e.enableContextMenu,void 0!==e.contextMenu&&(t.contextMenuSettings.showCustomMenuOnly=e.contextMenu.showCustomMenuItemsOnly,t.contextMenuSettings.items=this.getContextMenuItems(e.contextMenu.items))},bm.prototype.getContextMenuItems=function(t){for(var e={},i=0;i<t.length;i++){var n=t[parseInt(i.toString(),10)];e.id=n.name,e.text=n.text,this.items.push(e),t.subItems&&0<t.subItems.length&&this.getContextMenuItems(t.subItems)}return this.items},bm.prototype.setTooltip=function(t,e){t.tooltip={content:e.tooltip.templateId,relativeMode:e.tooltip.relativeMode}},bm.prototype.setModelLayout=function(t,e){t.layout={fixedNode:e.layout.fixedNode,horizontalSpacing:e.layout.horizontalSpacing,verticalSpacing:e.layout.verticalSpacing,maxIteration:e.layout.maxIteration,springFactor:e.layout.springFactor,springLength:e.layout.springLength,margin:{left:e.layout.margin.left,right:e.layout.margin.right,top:e.layout.margin.top,bottom:e.layout.margin.bottom},horizontalAlignment:e.layout.horizontalAlignment.charAt(0).toUpperCase()+e.layout.horizontalAlignment.slice(1),verticalAlignment:e.layout.verticalAlignment.charAt(0).toUpperCase()+e.layout.verticalAlignment.slice(1),orientation:"toptobottom"===e.layout.orientation?"TopToBottom":"bottomtotop"===e.layout.orientation?"BottomToTop":"righttoleft"===e.layout.orientation?"RightToLeft":"LeftToRight",connectorSegments:e.layout.getConnectorSegments,type:e.layout.type.charAt(0).toUpperCase()+e.layout.type.slice(1),getLayoutInfo:e.layout.getLayoutInfo,bounds:e.layout.bounds,root:e.layout.root},t.layout&&"Hierarchicaltree"===t.layout.type?t.layout.type="HierarchicalTree":t.layout&&"Organizationalchart"===t.layout.type?t.layout.type="OrganizationalChart":t.layout&&"Radialtree"===t.layout.type&&(t.layout.type="RadialTree")},bm.prototype.setSelectedItems=function(t,e){t.selectedItems={};t.selectedItems.nodes=[],t.selectedItems.connectors=[],t.selectedItems.offsetX=e.selectedItems.offsetX,t.selectedItems.offsetY=e.selectedItems.offsetY,t.selectedItems.width=e.selectedItems.width,t.selectedItems.height=e.selectedItems.height,t.selectedItems.rotateAngle=e.selectedItems.rotateAngle,t.selectedItems.constraints=this.setSelectorConstraints(e.selectedItems.constraints),t.selectedItems.userHandles=e.selectedItems.userHandles},bm.prototype.setSelectorConstraints=function(t){var e=Z.SelectorConstraints.None;return t&Z.SelectorConstraints.ConnectorSourceThumb&&(e|=Z.SelectorConstraints.Rotate),t&Z.SelectorConstraints.ResizeAll&&(e|=Z.SelectorConstraints.ResizeAll),t&Z.SelectorConstraints.ResizeSouthEast&&(e|=Z.SelectorConstraints.UserHandle),t&Z.SelectorConstraints.ToolTip&&(e|=Z.SelectorConstraints.ToolTip),t&Z.SelectorConstraints.All&&(e|=Z.SelectorConstraints.All),e},bm.prototype.setDiagramConstraints=function(t){var e=Z.DiagramConstraints.None;return t&Z.DiagramConstraints.UserInteraction&&(e|=Z.DiagramConstraints.UserInteraction),t&Z.DiagramConstraints.ApiUpdate&&(e|=Z.DiagramConstraints.ApiUpdate),t&Z.DiagramConstraints.PageEditable&&(e|=Z.DiagramConstraints.PageEditable),t&Z.DiagramConstraints.LineRouting&&(e|=Z.DiagramConstraints.Bridging),t&Z.DiagramConstraints.Zoom&&(e|=Z.DiagramConstraints.Zoom),t&Z.DiagramConstraints.PanX&&(e|=Z.DiagramConstraints.PanX),t&Z.DiagramConstraints.PanY&&(e|=Z.DiagramConstraints.PanY),t&Z.DiagramConstraints.Pan&&(e|=Z.DiagramConstraints.Pan),t&Z.DiagramConstraints.UndoRedo&&(e|=Z.DiagramConstraints.UndoRedo),t&Z.DiagramConstraints.ZoomTextEdit&&(e|=Z.DiagramConstraints.ZoomTextEdit),e},bm.prototype.setDiagramTool=function(t){var e=Z.DiagramTools.None;return t&Z.DiagramTools.MultipleSelect&&(e|=Z.DiagramTools.SingleSelect),t&Z.DiagramTools.ZoomPan&&(e|=Z.DiagramTools.MultipleSelect),t&Z.DiagramTools.DrawOnce&&(e|=Z.DiagramTools.ZoomPan),t&Z.DiagramTools.ContinuousDraw&&(e|=Z.DiagramTools.DrawOnce),t&Z.DiagramTools.ContinuousDraw&&(e|=Z.DiagramTools.ContinuousDraw),e},bm.prototype.destroy=function(){},bm.prototype.getModuleName=function(){return"Ej1Serialization"};var vm=bm;function bm(t){this.labelProperties=new pm(this),this.connectorProperties=new lm(this.labelProperties),this.portProperties=new fm(this),this.nodeProperties=new um(this.labelProperties,this.portProperties),this.convertedData={},this.items=[],this.diagram=t}function Sm(t){return t.sourcePoint||t.targetPoint||t.sourceID||t.targetID||t.sourcePortID||t.targetPortID||t.sourceDecorator||t.targetDecorator?W:(!t.shape||t.shape instanceof Xd||t.shape.type,_)}wm=function(t,e){return(wm=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)};var wm,xm,Im=function(t,e){function i(){this.constructor=t}wm(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Cm=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;0<=s;s--)(r=t[s])&&(a=(o<3?r(a):3<o?r(e,i,a):r(e,i))||a);return 3<o&&a&&Object.defineProperty(e,i,a),a},Pm=(xm=N.ChildProperty,Im(Am,xm),Cm([N.Property("")],Am.prototype,"id",void 0),Cm([N.Property()],Am.prototype,"height",void 0),Cm([N.Property(!0)],Am.prototype,"expanded",void 0),Cm([N.Property("")],Am.prototype,"iconCss",void 0),Cm([N.Property("")],Am.prototype,"title",void 0),Cm([N.CollectionFactory(Sm)],Am.prototype,"symbols",void 0),Am);function Am(t,e,i,n){return xm.call(this,t,e,i,n)||this}Tm=N.ChildProperty,Im(Om,Tm),Cm([N.Property()],Om.prototype,"width",void 0),Cm([N.Property()],Om.prototype,"height",void 0);var Tm,Dm=Om;function Om(){return null!==Tm&&Tm.apply(this,arguments)||this}Mm=N.ChildProperty,Im(Lm,Mm),Cm([N.Property()],Lm.prototype,"width",void 0),Cm([N.Property()],Lm.prototype,"height",void 0),Cm([N.Complex({},K)],Lm.prototype,"offset",void 0);var Mm,Em=Lm;function Lm(){return null!==Mm&&Mm.apply(this,arguments)||this}zm=N.Component,Im(y,zm),y.prototype.onPropertyChanged=function(t,e){for(var i,n=!1,r=0,o=Object.keys(t);r<o.length;r++)switch(o[r]){case"width":this.element.style.width=this.width.toString();break;case"height":this.element.style.height=this.height.toString();break;case"symbolPreview":break;case"symbolWidth":case"symbolHeight":case"getSymbolInfo":n=!this.isReact;break;case"enableSearch":t.enableSearch&&!N.isBlazor()?this.createTextbox():(i=document.getElementById(this.element.id+"_search"))&&i.parentNode.removeChild(i);break;case"palettes":for(var a=0,s=Object.keys(t.palettes);a<s.length;a++){var h=s[a],h=Number(h);N.isBlazor()||this.accordionElement.items[parseInt(h.toString(),10)]||(this.accordionElement.items[parseInt(h.toString(),10)]={header:t.palettes[parseInt(h.toString(),10)].title||"",expanded:t.palettes[parseInt(h.toString(),10)].expanded,iconCss:t.palettes[parseInt(h.toString(),10)].iconCss||""}),t.palettes[parseInt(h.toString(),10)].height&&(document.getElementById(this.palettes[parseInt(h.toString(),10)].id+"_content").style.height=t.palettes[parseInt(h.toString(),10)].height+"px"),void 0===t.palettes[parseInt(h.toString(),10)].iconCss||N.isBlazor()||(this.accordionElement.items[parseInt(h.toString(),10)].iconCss=t.palettes[parseInt(h.toString(),10)].iconCss||"",n=!0),void 0===t.palettes[parseInt(h.toString(),10)].expanded||N.isBlazor()||(this.palettes[parseInt(h.toString(),10)].isInteraction?this.palettes[parseInt(h.toString(),10)].isInteraction=!1:(this.accordionElement.items[parseInt(h.toString(),10)].expanded=t.palettes[parseInt(h.toString(),10)].expanded,this.isExpand=!0),this.isExpandMode)||this.isMethod||this.isExpand||(this.isExpand=!0)}break;case"enableAnimation":N.isBlazor()||(this.enableAnimation?this.accordionElement.animation={expand:{duration:400},collapse:{duration:400}}:this.accordionElement.animation={expand:{duration:0},collapse:{duration:0}});break;case"expandMode":N.isBlazor()||(this.accordionElement.expandMode=this.expandMode,this.isExpandMode=n=!0);break;case"allowDrag":this.allowDrag=t.allowDrag,this.allowDrag?(this.initDraggable(),this.draggable.helper=this.helper):this.draggable.helper=function(){return null}}if(n&&this.refreshPalettes(),this.isExpand&&!n){this.refresh(),this.isExpand=!1;for(var d=0;d<this.palettes.length;d++){var l=this.palettes[parseInt(d.toString(),10)].id;window[""+l]&&1<window[""+l].length&&(window[""+l][1].parentNode.removeChild(window[""+l][1]),window[""+l][1]=null)}}this.isMethod=!1},y.prototype.getPersistData=function(){return this.addOnPersist(["loaded"])},y.prototype.preRender=function(){var n=this,t=(this.l10n=new N.L10n(this.getModuleName(),this.defaultLocale(),this.locale),""===this.element.id&&(t=document.getElementsByClassName("e-symbolpalette").length,this.element.id="symbolpalette_"+this.paletteid+"_"+t),this.element.style.overflow="auto",this.element.style.height=this.height.toString(),this.element.style.width=this.width.toString(),this.enableSearch&&!N.isBlazor()&&this.createTextbox(),N.isBlazor()||(t=A("div",{id:this.element.id+"_container"}),this.accordionElement=new S.Accordion({expandMode:this.expandMode}),this.enableAnimation||(this.accordionElement.animation={expand:{duration:0},collapse:{duration:0}}),this.accordionElement.created=function(){n.checkOnRender=!0},this.accordionElement.expanded=function(t){var e=n.accordionElement.items.indexOf(t.item),i=n.allowServerDataBinding;n.allowServerDataBinding=!1,n.palettes[parseInt(e.toString(),10)].expanded=t.isExpanded,n.palettes[parseInt(e.toString(),10)].isInteraction=!0,n.allowServerDataBinding=i},this.accordionElement.expanding=function(t){var e;n.checkOnRender&&(e={element:t.element,content:t.content,index:t.index,cancel:!1,isExpanded:t.isExpanded,palette:n.palettes[t.index]},n.trigger("paletteExpanding",e),t.cancel=e.cancel)},this.element.appendChild(t)),"measureElement");window[t]&&(window[t]=null),dp(),this.unWireEvents(),this.wireEvents()},y.prototype.defaultLocale=function(){return{SearchShapes:"Search Shapes"}},y.prototype.render=function(){this.diagramRenderer=new Fs(this.element.id,new Xs,!1),this.svgRenderer=new Fs(this.element.id,new Xs,!0),this.updatePalettes(),N.isBlazor()||this.accordionElement.appendTo("#"+this.element.id+"_container"),this.renderComplete()},y.prototype.getModuleName=function(){return"SymbolPalette"},y.prototype.requiredModules=function(){var t=[];return t.push({member:"Bpmn",args:[]}),t},y.prototype.destroy=function(){var t,e,i;this.allowDrag&&(this.draggable.destroy(),this.unWireEvents(),this.notify("destroy",{}),zm.prototype.destroy.call(this),(t=document.getElementById(this.element.id+"_container"))&&(this.element.removeChild(t),e="measureElement",window[e])&&(--window[e].usageCount,i="measureElementCount",window[i]--,0===window[i])&&(window[e].parentNode.removeChild(window[e]),window[e]=null),t=document.getElementById(this.element.id+"_search"))&&t.parentNode.removeChild(t)},y.prototype.addPalettes=function(t){for(var e,i=0;i<t.length;i++){var n=this.allowServerDataBinding;this.isProtectedOnChange=!0,this.allowServerDataBinding=!1,e=new Pm(this,"palettes",t[parseInt(i.toString(),10)],!0),this.palettes.push(e),this.initSymbols(e),this.allowServerDataBinding=n,this.isProtectedOnChange=!1,this.renderPalette(e)}this.bulkChanges={},N.isBlazor()||this.accordionElement.refresh()},y.prototype.removePalette=function(t){for(var e=0;e<this.palettes.length;e++)if(this.palettes[parseInt(e.toString(),10)].id===t){this.palettes.splice(e,1),N.isBlazor()||this.accordionElement.items.splice(e,1);break}},y.prototype.removePalettes=function(t){var e=this.allowServerDataBinding;this.allowServerDataBinding=!1;for(var i=0;i<t.length;i++)this.removePalette(t[parseInt(i.toString(),10)]);N.isBlazor()?this.updatePalettes():this.accordionElement.refresh(),this.allowServerDataBinding=e},y.prototype.initSymbols=function(t){for(var e,i,n,r,o,a,s=[],h=0,d=0,l=0,c=t.symbols;l<c.length;l++)"SwimLane"===(b=c[l]).shape.type&&(a="Horizontal"===(r=(o=b).shape).orientation,r.isLane?(h=a?this.symbolHeight-this.symbolHeight/2:this.symbolHeight-this.symbolHeight/4,d=a?this.symbolWidth-this.symbolWidth/4:this.symbolWidth-this.symbolWidth/2,this.laneTable[b.id]={height:h,width:d},e=r.lanes[0].header,i=r.lanes[0].style,n=e.style,(n={id:"header"+q(),shape:{type:"Basic",shape:"Rectangle"},width:(a?e:o).width,height:(a?o:e).height,style:n,annotations:[{content:e.annotation.content}]}).offsetX=n.width/2,n.offsetY=n.height/2,this.addPaletteItem(t.id,n),(e={id:"lane"+q(),shape:{type:"Basic",shape:"Rectangle"},width:a?o.width-e.width:o.width,height:a?o.height:o.height-e.height,style:i}).offsetX=a?n.width+e.width/2:e.width/2,e.offsetY=a?e.height/2:n.height+e.height/2,this.addPaletteItem(t.id,e),o.children=[n.id,e.id]):r.isPhase&&(h=o.height||this.symbolHeight,d=o.width||this.symbolWidth,b.shape.type="Path",b.shape.data=a?"M0,0 L"+d+",0":"M0,0 L0,"+d)),"UmlClassifier"!==b.shape.type||b.shape.relationship||(n=i=void 0,n="white"===(e=b).style.fill?{fill:"#26A0DA"}:{fill:b.style.fill},"Class"===b.shape.classifier?(i={id:"node"+q(),shape:{type:"HTML",content:'<div id="parentDiv" style="width:100%; height:50%; border:1px solid #000; background:#6BA5D7; display: flex; align-items: center; justify-content: center;"><div id="textDiv" style="font-size:0.7vw;">class</div></div>'},width:e.width||100,height:e.height||100,style:n,offsetX:e.width?e.width/2:50,offsetY:e.height?e.height/2:50},this.addPaletteItem(t.id,i)):"Enumeration"===b.shape.classifier?(i={id:"node"+q(),shape:{type:"HTML",content:'<div id="parentDiv2" style="width:100%; height:50%; border:1px solid #000; background:#6BA5D7; display: flex; align-items: center; justify-content: center;"><div id="textDiv2" style="font-size:0.5vw;">Enumeration</div></div>'},width:e.width||100,height:e.height||100,style:n,offsetX:e.width?e.width/2:50,offsetY:e.height?e.height/2:50},this.addPaletteItem(t.id,i)):"Interface"===b.shape.classifier&&(i={id:"node"+q(),shape:{type:"HTML",content:'<div id="parentDiv3" style="width:100%; height:50%; border:1px solid #000; background:#6BA5D7; display: flex; align-items: center; justify-content: center;"><div id="textDiv3" style="font-size:0.7vw;">Interface</div></div>'},width:e.width||100,height:e.height||100,style:n,offsetX:e.width?e.width/2:50,offsetY:e.height?e.height/2:50},this.addPaletteItem(t.id,i)),r={id:"member"+q(),shape:{type:"HTML",content:'<div style="width:100%;height:100%;border:1px solid #000;background:white"></div>'},width:e.width||100,height:e.height||100,offsetX:e.width?e.width/2:50,offsetY:e.height?e.height/2+i.height/2:50+i.height/2},this.addPaletteItem(t.id,r),e.children=[i.id,r.id]),"UmlClassifier"===b.shape.type&&b.shape.relationship&&("Inheritance"===b.shape.relationship&&(b.style.strokeDashArray=b.style.strokeDashArray||"4 4"),"Dependency"===b.shape.relationship)&&(b.style.strokeDashArray=b.style.strokeDashArray||"4 4"),b instanceof _?(o=Dp(this.getNodeDefaults))&&o(b,this):b instanceof W&&(a=Dp(this.getConnectorDefaults))&&a(b,this),(this.symbolTable[b.id]=b)instanceof _&&b.children&&s.push(b);for(var p=0;p<s.length;p++)for(var g=void 0,u=0;u<s[parseInt(p.toString(),10)].children.length;u++)(g=this.symbolTable[s[parseInt(p.toString(),10)].children[parseInt(u.toString(),10)]])&&((this.childTable[g.id]=g).parentId=s[parseInt(p.toString(),10)].id);for(var m=0,f=t.symbols;m<f.length;m++)(b=f[m])instanceof _&&b.children||this.prepareSymbol(b);for(var y=0,v=s;y<v.length;y++){var b=v[y];this.prepareSymbol(b)}},y.prototype.renderPalette=function(t){var e,i="display:none;overflow:auto;",i=(t.height&&(i+="height:"+t.height+"px"),document.getElementById(t.id),A("div",{id:t.id,style:i,class:"e-remove-palette"}));this.element.appendChild(i),N.isBlazor()||(e={header:t.title,expanded:t.expanded,content:"#"+t.id,iconCss:t.iconCss},this.accordionElement.items.push(e)),this.renderSymbols(t,i)},y.prototype.addPaletteItem=function(t,e,i){e=Q(e);for(var n=0;n<this.palettes.length;n++){var r=this.palettes[parseInt(n.toString(),10)];if(-1!==r.id.indexOf(t)){for(var o=[void 0,r,"symbols",{},!0],a=new(Function.prototype.bind.apply(Sm(e),o)),s=0;s<Object.keys(e).length;s++){var h=this.allowServerDataBinding;this.allowServerDataBinding=!1,a[Object.keys(e)[parseInt(s.toString(),10)]]=e[Object.keys(e)[parseInt(s.toString(),10)]],this.allowServerDataBinding=h}sh(a,e,a instanceof _?this.nodeDefaults:this.connectorDefaults),r.symbols.push(a);var o=this.allowServerDataBinding;this.allowServerDataBinding=!1,this.prepareSymbol(a),this.allowServerDataBinding=o,this.symbolTable[a.id]=a,i?this.childTable[a.id]=a:(o=document.getElementById(r.id))&&o.appendChild(this.getSymbolContainer(a,o));break}}},y.prototype.removePaletteItem=function(t,e){for(var i,n=0;n<this.palettes.length;n++){var r=this.palettes[parseInt(n.toString(),10)];if(-1!==r.id.indexOf(t))for(var o=0,a=r.symbols;o<a.length;o++){var s=a[o];if(-1!==s.id.indexOf(e)){var h=r.symbols.indexOf(s);if(r.symbols.splice(h,1),s.children)for(var d=s.children,l=0;l<d.length;l++)delete this.symbolTable[d[parseInt(l.toString(),10)]];delete this.symbolTable[s.id];h=document.getElementById(s.id+"_container");h.parentNode.removeChild(h),i=!0;break}}if(i)break}},y.prototype.prepareSymbol=function(t){var e,i,n,r,o,a,s=new Ed,h=t,d=new F,l=t instanceof _?t.initContainer():null,c=(l&&!l.children&&(l.children=[]),Dp(this.getSymbolTemplate));if(!(p=c?c(t):p))if(h.children)p=this.getContainer(h,l);else{if(t instanceof W&&"UmlClassifier"===t.shape.type&&t.shape.relationship)for(var p,g=(p=t.init(this)).children.length-1;0<=g;g--)p.children[parseInt(g.toString(),10)]instanceof H&&p.children.splice(g,1);else p=t.init(this);t instanceof _&&t.parentId&&l.children.push(p)}t.parentId||(c={width:this.symbolWidth,height:this.symbolHeight},c=(c=(n=Dp(this.getSymbolInfo))?n(t):c)||this.symbolInfo||{},t.shape&&t.shape.isPhase&&(c.width=c.width||this.symbolWidth,c.height=c.height||this.symbolHeight),p.relativeMode="Object",p.horizontalAlignment=p.verticalAlignment="Center",d.style.strokeColor=d.style.fill="none",d.children=[p],p.measure(new j),p.arrange(p.desiredSize),n=c.width=c.width||(void 0!==h.width?p.actualSize.width:void 0)||this.symbolWidth,i=c.height=c.height||(void 0!==h.height?p.actualSize.height:void 0)||this.symbolHeight,void 0!==n&&void 0!==i?(a=n,r=i,o=!!t.shape.isPhase,void 0!==this.symbolWidth?a=this.symbolWidth-this.symbolMargin.left-this.symbolMargin.right:n+=h.style.strokeWidth,void 0!==this.symbolHeight?r=this.symbolHeight-this.symbolMargin.top-this.symbolMargin.bottom:i+=h.style.strokeWidth,t.shape&&"Bpmn"!==t.shape.type&&c.description&&""!==c.description.text&&(r-=20),e=a/(!o&&p.width||n),o=r/(!o&&p.height||i),c.fit&&(e=a/c.width,o=r/c.height),n=a,i=r,e=o=Math.min(e,o),d.width=n,d.height=i,p.width=c.width,p.height=c.height,this.scaleSymbol(t,d,e,o,n,i)):(a=void 0,t instanceof W&&(a=Fi(t)),p.width=(t.width||a?a:p.actualSize).width,p.height=(t.height||a?a:p.actualSize).height),(t.wrapper=s).children=[d],p.pivot=s.pivot={x:0,y:0},s.id=p.id+"_symbol",s.style.fill=s.style.strokeColor="transparent",t instanceof _?(s.offsetX=t.style.strokeWidth/2,s.offsetY=t.style.strokeWidth/2):(s.offsetX=.5,s.offsetY=.5),this.getSymbolDescription(c,n,s,t),s.padding={left:1,right:1,bottom:1,top:1},s.measure(new j),s.arrange(s.desiredSize),c.width=c.width||p.actualSize.width,c.height=c.height||p.actualSize.height,t[this.info]=c),t.parentId&&(l.measure(new j(h.width,h.height)),l.arrange(l.desiredSize))},y.prototype.getContainer=function(t,e){e.measureChildren=!1;var i,n=t.children;e.children=[];for(var r=0;r<n.length;r++)this.symbolTable[n[parseInt(r.toString(),10)]]&&e.children.push(this.symbolTable[n[parseInt(r.toString(),10)]].wrapper);return e.measure(new j(t.width,t.height)),e.arrange(e.desiredSize),0===e.bounds.x&&0===e.bounds.y||(id(t,(i=e.bounds).x,i.y,this.symbolTable,!1,this),e=this.getContainer(t,e)),e},y.prototype.getSymbolDescription=function(t,e,i,n){var r;t&&t.description&&t.description.text&&(r=new H,t.description.overflow=t.description.overflow||"Ellipsis",t.description.wrap=t.description.wrap||"WrapWithOverflow",r.id=i.id+"_text",r.content=t.description.text,r.width=e,r.height=20,r.style.strokeColor="transparent",r.style.color=t.description.color||"black",r.style.fill=t.description.fill||"transparent",r.style.fontFamily=t.description.fontFamily||"Arial",r.style.fontSize=t.description.fontSize||12,r.style.bold=t.description.bold||!1,r.style.italic=t.description.italic||!1,r.style.textDecoration=t.description.textDecoration||"None",r.style.strokeWidth=0,r.style.textWrapping=t.description.wrap,r.style.textOverflow=t.description.overflow,n.shape&&"Bpmn"===n.shape.type?r.margin={left:0,right:0,top:t.description.margin?t.description.margin.top:0,bottom:(t.description.margin||this.symbolMargin).bottom}:r.margin={left:0,right:0,top:t.description.margin?t.description.margin.top:0,bottom:t.description.margin?t.description.margin.bottom:5},i.children.push(r))},y.prototype.renderSymbols=function(t,e){for(var i=0,n=t.symbols;i<n.length;i++){var r=n[i];r.parentId||this.getSymbolContainer(r,e)}},y.prototype.getSymbolPreview=function(t,e,i){this.allowServerDataBinding=!1;var n,r,o,a=t.wrapper.children[0].desiredSize.width+t.style.strokeWidth,s=t.wrapper.children[0].desiredSize.height+t.style.strokeWidth,h=t.wrapper.children[0].children[0],d=t.previewSize,d=((t&&(d.width||d.height)||void 0!==this.symbolPreview.width||void 0!==this.symbolPreview.height)&&(a=(d.width||this.symbolPreview.width||a)-t.style.strokeWidth,s=(d.height||this.symbolPreview.height||s)-t.style.strokeWidth,t instanceof W&&(h.actualSize.width<=t.style.strokeWidth&&(h.actualSize.width=this.symbolWidth),h.actualSize.height<=t.style.strokeWidth)&&(h.actualSize.height=this.symbolHeight),d=a/h.actualSize.width,l=s/h.actualSize.height,d=l=Math.min(d,l),c=h.actualSize.width*d,o=h.actualSize.height*l,t.wrapper.children[0].width=a,t.wrapper.children[0].height=s,this.measureAndArrangeSymbol(h,t instanceof _),this.scaleSymbol(t,t.wrapper.children[0],d,l,c,o,!0),a=c,s=o),{x:h.offsetX,y:h.offsetY}),l=(h.offsetX=h.offsetY=t.style.strokeWidth/2,h.pivot={x:0,y:0},this.measureAndArrangeSymbol(h,t instanceof _),A("div",{draggable:"true",class:"e-dragclone",style:"pointer-events:none"})),c=(document.body.appendChild(l),"margin:5px;");return"Native"===t.shape.type?(r=tp("svg",{id:t.id+"_preview",width:Math.ceil(a)+1,height:Math.ceil(s)+1}),o=tp("g",{id:t.id+"_g"}),r.appendChild(o),l.appendChild(r),this.svgRenderer.renderElement(h,o,void 0,void 0,r),this.prepareSymbol(t)):"HTML"===t.shape.type?(n=this.getHtmlSymbol(t,r,l,s,a,!0),this.prepareSymbol(t)):"UmlClassifier"!==t.shape.type||t.shape.relationship?(t.children&&0<t.children.length&&ah(t,"HTML",this.childTable)?n=this.getGroupParent(t,r,l,t.wrapper.actualSize.height,t.wrapper.actualSize.width,!0):(r=Op.createCanvas(t.id+"_preview",2*(Math.ceil(a)+t.style.strokeWidth+1),2*(Math.ceil(s)+t.style.strokeWidth+1)),l.appendChild(r),"Basic"===t.shape.type||"Flow"===t.shape.type?c+="transform: scale(0.5) translate(-"+r.width/2+"px, -"+r.height/2+"px);":c+="transform:scale(0.5);",r.setAttribute("transform-origin","0 0"),o=2,t instanceof W&&(o=1.9),r.getContext("2d").setTransform(o,0,0,o,0,0),this.diagramRenderer.renderElement(h,r,void 0)),this.prepareSymbol(t)):t.children&&0<t.children.length&&ah(t,"HTML",this.childTable)&&(n=this.getHtmlSymbol(t,r,l,t.wrapper.actualSize.height,t.wrapper.actualSize.width,!0),this.prepareSymbol(t)),sp(n&&("HTML"===t.shape.type||t.children&&0<t.children.length)?n:r,c),h.offsetX=d.x,h.offsetY=d.y,this.allowServerDataBinding=!0,l},y.prototype.measureAndArrangeSymbol=function(t,e){t.children&&!e&&(t.children[0].transform=Z.Transform.Self),t.measure(new j),t.arrange(t.desiredSize),t.children&&0<t.children.length&&(t.children[0].transform=Z.Transform.Parent)},y.prototype.updateSymbolSize=function(t,e,i){var n=t.wrapper.children[0].children[0],r=t.style.strokeWidth;n.width=(e||n.width)-(r+1),n.height=(i||n.height)-(r+1),t.wrapper.measure(new j),t.wrapper.arrange(t.wrapper.desiredSize)},y.prototype.getSymbolContainer=function(t,e,i){var n,r,o,a=this.symbolTable[t.id][this.info],a=this.getSymbolSize(t,a),s=a.width+1,h=a.height+1,d="SearchPalette"===e.id?t.id+"SearchSymbol":t.id,l=A("div",{id:d+"_container",style:"width:"+s+"px;height:"+h+"px;float:left;overflow:hidden"});return e.appendChild(l),"Native"===t.shape.type?(n=tp("svg",{id:d,width:Math.ceil(t.wrapper.actualSize.width)+1,height:Math.ceil(t.wrapper.actualSize.height)+1}),o=tp("g",{id:d+"_g"}),n.appendChild(o),l.appendChild(n),this.updateSymbolSize(t),this.svgRenderer.renderElement(t.wrapper,o,void 0,void 0,n)):"HTML"===t.shape.type?r=this.getHtmlSymbol(t,n,l,t.wrapper.actualSize.height,t.wrapper.actualSize.width,!1,"SearchPalette"===e.id):"UmlClassifier"!==t.shape.type||t.shape.relationship?t.children&&0<t.children.length&&ah(t,"HTML",this.childTable)?r=this.getGroupParent(t,n,l,t.wrapper.actualSize.height,t.wrapper.actualSize.width,!1):(n=Op.createCanvas(d,Math.ceil(2*(t.wrapper.actualSize.width+t.style.strokeWidth))+1,Math.ceil(2*(t.wrapper.actualSize.height+t.style.strokeWidth))+1),l.appendChild(n),e=2,t instanceof W&&(e=1.9),n.getContext("2d").setTransform(e,0,0,e,0,0),this.diagramRenderer.renderElement(t.wrapper,o||n,void 0,void 0,void 0,void 0,!0,void 0,!0)):t.children&&0<t.children.length&&ah(t,"HTML",this.childTable)&&(r=this.getHtmlSymbol(t,n,l,t.wrapper.actualSize.height,t.wrapper.actualSize.width,!1)),i?n:(d=t.wrapper.actualSize.width+t.style.strokeWidth,e=t.wrapper.actualSize.height+t.style.strokeWidth,o="pointer-events:none;transform-origin:0 0;overflow:hidden;",t.shape.isPhase?"Horizontal"===t.shape.orientation?o+="margin-left:"+Math.max(this.symbolMargin.left,(s-d)/2)+"px;margin-top:"+a.height/2+"px;":o+="margin-left:"+a.width/2+"px;margin-top:"+Math.max(this.symbolMargin.top,(h-e)/2)+"px;":o+="margin-left:"+Math.max(this.symbolMargin.left,(s-d)/2)+"px;margin-top:"+Math.max(this.symbolMargin.top,(h-e)/2)+"px;",n instanceof HTMLCanvasElement&&(o+="transform:scale(.5,.5);"),sp(r&&("HTML"===t.shape.type||t.children&&0<t.children.length)?r:n,o),l.classList.add("e-symbol-draggable"),l)},y.prototype.getGroupParent=function(t,e,i,n,r,o){var a=A("div",{id:t.id+(o?"_html_div_preview":"_html_div")}),s=A("div",{id:t.id+(o?"_htmlLayer_preview":"_htmlLayer"),style:"width:"+Math.ceil(r+1)+"px;height:"+Math.ceil(n+1)+"px;position:absolute",class:"e-html-layer"}),h=A("div",{id:t.id+(o?"_htmlLayer_div_preview":"_htmlLayer_div"),style:"width:"+Math.ceil(r+1)+"px;height:"+Math.ceil(n+1)+"px;position:absolute"});return s.appendChild(h),a.appendChild(s),e=Op.createCanvas(o?t.id+"_preview":t.id,Math.ceil(r)+1,Math.ceil(n)+1),a.appendChild(e),i.appendChild(a),this.diagramRenderer.renderElement(t.wrapper.children[0].children[0],e,s),a},y.prototype.getHtmlSymbol=function(t,e,i,n,r,o,a){var a=a?t.id+"SearchSymbol":t.id,s=A("div",{id:a+(o?"_html_div_preview":"_html_div")}),h=A("div",{id:a+(o?"_htmlLayer_preview":"_htmlLayer"),style:"width:"+Math.ceil(r+1)+"px;height:"+Math.ceil(n+1)+"px;position:absolute",class:"e-html-layer"}),d=A("div",{id:a+(o?"_htmlLayer_div_preview":"_htmlLayer_div"),style:"width:"+Math.ceil(r+1)+"px;height:"+Math.ceil(n+1)+"px;position:absolute"}),d=(h.appendChild(d),s.appendChild(h),t.wrapper.actualSize.width+t.style.strokeWidth),l=t.wrapper.actualSize.height+t.style.strokeWidth,c=(c="pointer-events:none;transform-origin:0 0;overflow:hidden;")+("margin-left:"+Math.max(this.symbolMargin.left,(r-d)/2)+"px;margin-top:"+Math.max(this.symbolMargin.top,(n-l)/2)+"px;")+"transform:scale(.5,.5);position:absolute";return e=Op.createCanvas(a,Math.ceil(2*(t.wrapper.actualSize.width+t.style.strokeWidth))+1,Math.ceil(2*(t.wrapper.actualSize.height+t.style.strokeWidth))+1),i.appendChild(e),e.getContext("2d").setTransform(2,0,0,2,0,0),sp(e,c),i.appendChild(s),o?("UmlClassifier"===t.shape.type&&("Class"===t.shape.classifier?t.wrapper.children[0].children[0].children[0].content='<div id="parentDiv" style="width:100%; height:50%; border:1px solid #000; background:#6BA5D7; display: flex; align-items: center; justify-content: center;"><div id="textDiv" style="font-size:1vw;">class</div></div>':"Enumeration"===t.shape.classifier?t.wrapper.children[0].children[0].children[0].content='<div id="parentDiv2" style="width:100%; height:50%; border:1px solid #000; background:#6BA5D7; display: flex; align-items: center; justify-content: center;"><div id="textDiv2" style="font-size:0.8vw;">Enumeration</div></div>':"Interface"===t.shape.classifier&&(t.wrapper.children[0].children[0].children[0].content='<div id="parentDiv3" style="width:100%; height:50%; border:1px solid #000; background:#6BA5D7; display: flex; align-items: center; justify-content: center;"><div id="textDiv3" style="font-size:0.9vw;">Interface</div></div>')),this.diagramRenderer.renderElement(t.wrapper.children[0].children[0],e,h)):this.diagramRenderer.renderElement(t.wrapper,e,h),s},y.prototype.getSymbolSize=function(t,e){var i=t.wrapper.actualSize.width,n=t.wrapper.actualSize.height;return this.symbolWidth||this.symbolHeight?(i=this.symbolWidth,n=Math.max(this.symbolHeight,n)):(i+=this.symbolMargin.left+this.symbolMargin.right+t.style.strokeWidth,n+=this.symbolMargin.top+this.symbolMargin.bottom+t.style.strokeWidth),new j(i,n)},y.prototype.getMousePosition=function(t){var e,i;return{x:-1!==t.type.indexOf("touch")?(i=t.changedTouches[0].clientY,e=t.changedTouches[0].clientX,i=i-this.element.offsetTop,e-this.element.offsetLeft):(i=t.clientY-this.element.offsetTop,t.clientX-this.element.offsetLeft),y:i}},y.prototype.getContent=function(t){return this.hoverElement instanceof _&&this.hoverElement.constraints&Z.NodeConstraints.Tooltip||this.hoverElement instanceof W&&this.hoverElement.constraints&Z.ConnectorConstraints.Tooltip?this.hoverElement.tooltip.content:t.id},y.prototype.initTooltip=function(t){var e;return N.isBlazor()||(e=new v.Tooltip,e=this.updateTooltipContent(this.hoverElement.tooltip,e),(e=new v.Tooltip(e)).cssClass="e-symbolPalette-tooltip",e.opensOn="custom",e.appendTo("#"+t.id),e.close()),e},y.prototype.updateTooltipContent=function(t,e){return e.content=t.content,e.position="BottomRight",e.showTipPointer=t.showTipPointer,e.width=t.width,e.height=t.height,t.animation?e.animation=t.animation:e.animation={close:{effect:"None"}},e},y.prototype.elementEnter=function(t,e,i){e||(this.symbolTooltipObject.windowCollision=!0,this.hoverElement.tooltip.isSticky&&(this.symbolTooltipObject.isSticky=!0),this.hoverElement instanceof _?this.hoverElement.constraints&(Z.NodeConstraints.Default&&Z.NodeConstraints.Tooltip)||(this.hoverElement.tooltip.content=this.hoverElement.id,this.symbolTooltipObject.content=N.initializeCSPTemplate(function(){return this.hoverElement.id},this)):this.hoverElement instanceof W&&(this.hoverElement.constraints&(Z.ConnectorConstraints.Default&&Z.ConnectorConstraints.Tooltip)||(this.hoverElement.tooltip.content=this.hoverElement.id,this.symbolTooltipObject.content=N.initializeCSPTemplate(function(){return this.hoverElement.id},this))),this.hoverElement.tooltip.content&&("Mouse"===this.hoverElement.tooltip.relativeMode&&(this.hoverElement.tooltip.relativeMode="Object"),this.symbolTooltipObject.offsetX=0,this.symbolTooltipObject.offsetY=0),e=i?this.hoverElement.id+"SearchSymbol":this.hoverElement.id,i=document.getElementById(e),"Auto"===this.hoverElement.tooltip.openOn&&""!==this.hoverElement.tooltip.content&&(this.symbolTooltipObject.close(),this.symbolTooltipObject.opensOn=this.hoverElement.tooltip.openOn,this.symbolTooltipObject.dataBind()),"Auto"===this.hoverElement.tooltip.openOn&&(this.symbolTooltipObject.target=this.hoverElement.id,this.symbolTooltipObject.open(i)))},y.prototype.mouseMove=function(t,e){!this.highlightedSymbol||this.selectedSymbol&&this.selectedSymbol.id+"_container"===this.highlightedSymbol.id||(this.highlightedSymbol.classList.remove("e-symbol-hover"),this.highlightedSymbol.style.backgroundColor="",this.highlightedSymbol=null);var i=t.target.id.split("_container")[0],n=((this.symbolTable[""+i]||"SearchPalette"!==i&&t.target&&t.target.id.includes("SearchSymbol"))&&((n=document.getElementById(i+"_container")).classList.add("e-symbol-hover"),this.highlightedSymbol=n),t.preventDefault(),!1),r=(t.target&&t.target.id.includes("SearchSymbol")&&(n=!0,i=i.split("SearchSymbol")[0]),this.symbolTable[""+i]);this.symbolTable[""+i]&&r!==this.hoverElement&&(this.currentPosition=this.getMousePosition(t),i=this.getContent(r),this.hoverElement&&"Auto"===this.hoverElement.tooltip.openOn&&""!==i&&this.elementLeave(),this.hoverElement=r,this.symbolTooltipObject=this.initTooltip(this.hoverElement),""===i&&(i=this.hoverElement.id),this.hoverElement.tooltip)&&""!==i&&this.elementEnter(this.currentPosition,!1,n),void 0===r&&this.hoverElement&&!this.hoverElement.tooltip.isSticky&&"Auto"===this.hoverElement.tooltip.openOn&&(this.hoverElement=null,this.elementLeave())},y.prototype.elementLeave=function(){this.symbolTooltipObject&&"Custom"!==this.symbolTooltipObject.opensOn&&this.symbolTooltipObject.close()},y.prototype.mouseLeave=function(t){this.elementLeave(),t.preventDefault()},y.prototype.mouseUp=function(t){var e,i;this.isMethod=!0,t&&t.target&&("iconSearch"===t.srcElement.id?(e=document.getElementById("iconSearch")).classList.contains("e-clear-searchtext")&&(e.className="e-input-group-icon e-search e-icons",document.getElementById("textEnter").value="",this.searchPalette("")):(e=t.target.id.split("_container")[0])&&this.selectedSymbol?(i={oldValue:this.oldObject,newValue:e},this.trigger("paletteSelectionChange",i),this.oldObject=e,t.preventDefault()):""!==this.oldObject&&(this.oldObject=""))},y.prototype.keyUp=function(t){var e,i=this;this.enableSearch&&(e=this,document.getElementById("iconSearch").className="e-input-group-icon e-clear-searchtext e-icons",!t||"Enter"!==t.key&&13!==t.keyCode?(this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){t.target instanceof HTMLInputElement&&(e.searchPalette(t.target.value),i.timer=null)},500)):t.target instanceof HTMLInputElement&&this.searchPalette(t.target.value))},y.prototype.mouseDown=function(t){var e,i,n=t.target.id.split("_container")[0],r=!1;n.includes("SearchSymbol")&&(n=n.split("SearchSymbol")[0],r=!0),this.selectedSymbol&&(i=document.getElementById(this.selectedSymbol.id+"_container"),e=document.getElementById(this.selectedSymbol.id+"SearchSymbol_container"),(i||e)&&(i.classList.remove("e-symbol-selected"),e)&&e.classList.remove("e-symbol-selected"),(i=document.getElementById(this.selectedSymbol.id+"_container"))&&(i.style.backgroundColor=""),this.selectedSymbol=null),this.symbolTable[""+n]&&((i=document.getElementById((r?n+"SearchSymbol":n)+"_container")).classList.add("e-symbol-selected"),this.selectedSymbol=this.symbolTable[""+n],t.preventDefault())},y.prototype.keyDown=function(t){t&&"Escape"===t.key&&(t=this.draggable.helperElement)&&t.parentNode&&(t.parentNode.removeChild(t),this.draggable.intDestroy())},y.prototype.initDraggable=function(){this.allowDrag&&(this.draggable=new N.Draggable(this.element,{dragTarget:".e-symbol-draggable",helper:this.helper,dragStart:this.dragStart,preventDefault:!1,dragStop:this.dragStop,drag:function(t){var e=ep(t.target,"e-droppable");e&&e.classList.contains("e-diagram")&&e.ej2_instances[0].droppable.over(t)},cursorAt:{left:this.symbolPreview.offset.x,top:this.symbolPreview.offset.y}}))},y.prototype.dragStart=function(t){var e=this.helper[0];e&&e.setAttribute("paletteId",this.element.id)},y.prototype.dragStop=function(t){ep(t.target,"e-diagram")||N.remove(t.helper)},y.prototype.scaleSymbol=function(t,e,i,n,r,o,a){if(t instanceof W){for(var s=t.wrapper,h=(t.wrapper=e.children[0],t.scale(i,n,r,o,e.children[0])),d=r/2-e.children[0].children[0].offsetX+h.x/2,l=o/2-e.children[0].children[0].offsetY+h.y/2,c=0,p=e.children[0].children;c<p.length;c++){var g=p[c];g.offsetX+=d,g.offsetY+=l,g.staticSize=!1}t.wrapper=s}else if("Bpmn"===t.shape.type&&this.bpmnModule){s=t.wrapper;(t.wrapper=e).children[0].width=r,e.children[0].height=o,this.bpmnModule.updateBPMN({width:r,height:o},t,t,null),t.wrapper=s}else if(t.children){var u,m,f=t.children;if(!a)for(var y,v=void 0,b=0;b<f.length;b++)(v=e.children[0].children[parseInt(b.toString(),10)])&&(v.children[0].children&&this.measureChild(v),y=this.symbolTable[v.id],v.width=y.width,v.height=y.height,v.measure(new j),v.arrange(v.children[0].desiredSize));if(u=r/e.children[0].desiredSize.width,m=o/e.children[0].desiredSize.height,e.children[0].measure(new j),e.children[0].arrange(e.children[0].desiredSize),!a)for(var S=void 0,b=0;b<f.length;b++)(S=e.children[0].children[parseInt(b.toString(),10)])&&(S.children[0].children&&this.scaleChildren(S,u,m,t),this.scaleGroup(S,u,m,t));if(a){for(var w,x,S=void 0,b=0;b<f.length;b++)w=r/t.wrapper.children[0].desiredSize.width,x=o/t.wrapper.children[0].desiredSize.height,(S=e.children[0].children[parseInt(b.toString(),10)])&&(S.children[0].children&&this.scaleChildren(S,w,x,t,!0),this.scaleGroup(S,w,x,t,!0));t.wrapper.children[0].measure(new j),t.wrapper.children[0].arrange(t.wrapper.children[0].desiredSize)}}else ed(e.children[0],i,n,e)},y.prototype.scaleChildren=function(t,e,i,n,r){for(var o,a=0;a<t.children.length;a++)(o=t.children[parseInt(a.toString(),10)]).children[0].children?this.scaleChildren(o,e,i,n,r):this.scaleGroup(o,e,i,n,r)},y.prototype.measureChild=function(t){for(var e,i,n=0;n<t.children.length;n++)(e=t.children[parseInt(n.toString(),10)]).children[0].children?this.measureChild(e):(i=this.symbolTable[e.id],e.width=i.width,e.height=i.height,e.measure(new j),e.arrange(e.children[0].desiredSize))},y.prototype.scaleGroup=function(t,e,i,n,r){t.width=t.width*e,t.height=t.height*i,t.offsetX=r?t.offsetX*e-n.style.strokeWidth:t.offsetX*e+n.style.strokeWidth/2,t.offsetY=r?t.offsetY*i-n.style.strokeWidth:t.offsetY*i+n.style.strokeWidth/2,t.measure(new j),t.arrange(t.children[0].desiredSize)},y.prototype.refreshPalettes=function(){N.isBlazor()||(this.accordionElement.items=[]);for(var t="e-remove-palette",e=this.element.id,i=(e&&document.getElementById(e).classList.contains(t)?document.getElementById(e):document).getElementsByClassName(t);0<i.length;)i[0].parentNode.removeChild(i[0]);this.updatePalettes(),N.isBlazor()||this.accordionElement.dataBind()},y.prototype.updatePalettes=function(){for(var t=0;t<this.palettes.length;t++){var e=this.palettes[parseInt(t.toString(),10)];"search_palette"===e.id?(this.palettes.splice(t,1),t--):(this.initSymbols(e),this.renderPalette(e))}},y.prototype.createTextbox=function(){var t=A("div",{id:this.element.id+"_search"}),e=(sp(t,"height:30px"),t.className="e-input-group",this.element.appendChild(t),A("input",{})),e=(e.placeholder=this.l10n.getConstant("SearchShapes"),e.id="textEnter",sp(e,"width:100%;height:auto"),e.className="e-input",t.appendChild(e),A("span",{id:"iconSearch",className:"e-input-group-icon e-search e-icons"}));t.appendChild(e)},y.prototype.getFilterSymbol=function(t){var e=this;return t.filter(function(t){return!e.ignoreSymbolsOnSearch.includes(t.id)})},y.prototype.searchPalette=function(t){var e,i=[],n=document.getElementById("SearchPalette");if(n){for(var r=n.children.length-1;0<=r;r--)n.removeChild(n.children[parseInt(r.toString(),10)]);this.palettes.splice(0,1)}for(r=0;r<this.palettes.length;r++)for(var o=this.palettes[parseInt(r.toString(),10)],a=0;a<o.symbols.length;a++){var s=o.symbols[parseInt(a.toString(),10)];""!==t&&-1!==s.id.toLowerCase().indexOf(t.toLowerCase())&&i.push(s)}var h,d=Dp(this.filterSymbols);if(d&&(i=d(i)||[]),this.ignoreSymbolsOnSearch&&0<this.ignoreSymbolsOnSearch.length&&(i=this.getFilterSymbol(i)),""!==t&&(d=new Pm(this,"palettes",h={id:"search_palette",expanded:!0,symbols:i,title:"Search Shapes"},!0),this.palettes.splice(0,0,d)),n||N.isBlazor()||(n=e=this.createSearchPalette(e)),0<i.length)for(var l=0,c=i;l<c.length;l++){var p=c[l];""===p.parentId&&this.getSymbolContainer(p,n)}else""!==t?((d=A("div",{id:"EmptyDiv",style:"text-align:center;font-style:italic"})).innerHTML="No Items To Display",n.appendChild(d)):(document.getElementById("iconSearch").className="e-input-group-icon e-search e-icons",!N.isBlazor()&&(this.accordionElement.removeItem(0),h=document.getElementById("SearchPalette"))&&h.remove())},y.prototype.createSearchPalette=function(t){t=A("div",{id:"SearchPalette",style:"display:none;overflow:auto;"}),this.element.appendChild(t);return this.accordionElement.addItem({header:"Search Results",expanded:!0,content:"#SearchPalette"},0),t},y.prototype.wireEvents=function(){var t=N.Browser.touchStartEvent,e=N.Browser.touchEndEvent,i=N.Browser.touchMoveEvent;N.EventHandler.add(this.element,t,this.mouseDown,this),N.EventHandler.add(this.element,i,this.mouseMove,this),N.EventHandler.add(this.element,e,this.mouseUp,this),N.EventHandler.add(this.element,"mouseleave",this.mouseLeave,this),N.EventHandler.add(this.element,"keyup",this.keyUp,this),N.EventHandler.add(document,"keydown",this.keyDown,this),this.initDraggable()},y.prototype.unWireEvents=function(){var t=N.Browser.touchStartEvent,e=N.Browser.touchEndEvent,i=N.Browser.touchMoveEvent,n=N.Browser.isPointer?"pointerleave":"mouseleave";N.EventHandler.remove(this.element,t,this.mouseDown),N.EventHandler.remove(this.element,i,this.mouseMove),N.EventHandler.remove(this.element,e,this.mouseUp),N.EventHandler.remove(this.element,n,this.mouseLeave),N.EventHandler.remove(this.element,"keyup",this.keyUp),N.EventHandler.remove(document,"keydown",this.keyDown)},Cm([N.Property("S")],y.prototype,"accessKey",void 0),Cm([N.Property("100%")],y.prototype,"width",void 0),Cm([N.Property("100%")],y.prototype,"height",void 0),Cm([N.Collection([],Pm)],y.prototype,"palettes",void 0),Cm([N.Property()],y.prototype,"getSymbolInfo",void 0),Cm([N.Property({fit:!0})],y.prototype,"symbolInfo",void 0),Cm([N.Property()],y.prototype,"filterSymbols",void 0),Cm([N.Property()],y.prototype,"ignoreSymbolsOnSearch",void 0),Cm([N.Property()],y.prototype,"getSymbolTemplate",void 0),Cm([N.Property()],y.prototype,"symbolWidth",void 0),Cm([N.Property()],y.prototype,"symbolHeight",void 0),Cm([N.Complex({left:10,right:10,top:10,bottom:10},ft)],y.prototype,"symbolMargin",void 0),Cm([N.Property(!0)],y.prototype,"allowDrag",void 0),Cm([N.Complex({},Em)],y.prototype,"symbolPreview",void 0),Cm([N.Complex({},Dm)],y.prototype,"symbolDragSize",void 0),Cm([N.Property(!1)],y.prototype,"enableSearch",void 0),Cm([N.Property(!0)],y.prototype,"enableAnimation",void 0),Cm([N.Property("Multiple")],y.prototype,"expandMode",void 0),Cm([N.Event()],y.prototype,"paletteSelectionChange",void 0),Cm([N.Event()],y.prototype,"paletteExpanding",void 0),Cm([N.Property()],y.prototype,"getNodeDefaults",void 0),Cm([N.Property()],y.prototype,"nodeDefaults",void 0),Cm([N.Property()],y.prototype,"getConnectorDefaults",void 0),Cm([N.Property()],y.prototype,"connectorDefaults",void 0);var zm,Im=y;function y(t,e){var i,n,r=zm.call(this,t,e)||this;r.symbolTable={},r.childTable={},r.info="info",r.oldObject=null,r.laneTable={},r.isExpand=!1,r.isExpandMode=!1,r.isMethod=!1,r.paletteid=88123,r.checkOnRender=!1,r.symbolTooltipObject=null,r.helper=function(t){var e,i=r.selectedSymbol&&r.selectedSymbol.id||t.sender.target.id.split("_container")[0],i=r.symbolTable[""+i];return i&&r.selectedSymbol&&(r.selectedSymbols=r.selectedSymbol.id===i.id?i:r.selectedSymbol,(e=r.getSymbolPreview(r.selectedSymbols,t.sender,r.element)).setAttribute("paletteId",r.element.id)),e};for(var o=0;r&&r.palettes&&o<r.palettes.length;o++)for(var a=0;a<r.palettes[parseInt(o.toString(),10)].symbols.length;a++)i=r.palettes[parseInt(o.toString(),10)].symbols[parseInt(a.toString(),10)],n=t.palettes[parseInt(o.toString(),10)].symbols[parseInt(a.toString(),10)],i&&"UmlActivity"===i.shape.type&&ih(n,i),(r.nodeDefaults||r.connectorDefaults)&&sh(i,n,i instanceof _?r.nodeDefaults:r.connectorDefaults);return r}Z.ActivityFlow=Ea,Z.Annotation=Fe,Z.AvoidLineOverlapping=Eu,Z.BasicShape=sl,Z.BezierSegment=Xa,Z.BezierSettings=Pa,Z.BpmnActivity=kl,Z.BpmnAnnotation=Nl,Z.BpmnDataObject=fl,Z.BpmnDiagrams=mg,Z.BpmnEvent=xl,Z.BpmnFlow=ka,Z.BpmnGateway=gl,Z.BpmnShape=Xl,Z.BpmnSubEvent=Pl,Z.BpmnSubProcess=El,Z.BpmnTask=bl,Z.BpmnTextAnnotation=Wl,Z.BpmnTransactionSubProcess=Dl,Z.Canvas=F,Z.CanvasRenderer=Op,Z.ChildContainer=kc,Z.ClassifierMultiplicity=as,Z.ColumnDefinition=Jn,Z.Command=Rs,Z.CommandHandler=kg,Z.CommandManager=Hs,Z.ComplexHierarchicalTree=Ku,Z.ConnectTool=xo,Z.ConnectionDataSource=dg,Z.Connector=W,Z.ConnectorBridging=Ug,Z.ConnectorDrawingTool=No,Z.ConnectorEditing=xg,Z.ConnectorFixedUserHandle=fn,Z.ConnectorProperties=lm,Z.ConnectorSegment=Na,Z.ConnectorShape=Da,Z.Container=te,Z.ContextMenuSettings=i,Z.CrudAction=ag,Z.CustomCursorAction=Og,Z.DataBinding=e,Z.DataMappingItems=Kp,Z.DataSource=qp,Z.Decorator=ba,Z.Diagram=ru,Z.DiagramConnectorSegment=Ka,Z.DiagramConnectorShape=ps,Z.DiagramContextMenu=d,Z.DiagramElement=qt,Z.DiagramEventHandler=Cg,Z.DiagramGradient=Dt,Z.DiagramRenderer=Fs,Z.DiagramShape=bc,Z.DiagramShapeStyle=C,Z.DiagramTooltip=t,Z.Ej1Serialization=vm,Z.ExpandTool=Uo,Z.FixedUserHandle=ln,Z.FixedUserHandleTool=bo,Z.FlowShape=ll,Z.FlowchartLayout=hm,Z.FlowchartLayoutSettings=fg,Z.FreeHandTool=ga,Z.Gradient=Pt,Z.GraphForceNode=_u,Z.GraphLayoutManager=Fu,Z.GridCell=tr,Z.GridPanel=Zn,Z.GridRow=$n,Z.Gridlines=a,Z.Header=Ic,Z.HierarchicalTree=Bu,Z.Html=Jd,Z.Hyperlink=Ye,Z.Image=el,Z.ImageElement=le,Z.KeyGesture=zs,Z.LabelDragTool=ra,Z.LabelProperties=pm,Z.LabelResizeTool=sa,Z.LabelRotateTool=la,Z.LabelTool=Ko,Z.Lane=Ac,Z.Layout=og,Z.LayoutAnimation=Iu,Z.LineDistribution=zu,Z.LineRouting=Zg,Z.LinearGradient=Et,Z.Margin=ft,Z.Matrix=nt,Z.MethodArguments=Kl,Z.MindMap=Nu,Z.MoveTool=Po,Z.MultiplicityLabel=ns,Z.Native=Kd,Z.Node=_,Z.NodeDrawingTool=ko,Z.NodeFixedUserHandle=gn,Z.NodeProperties=um,Z.OrthogonalSegment=Ua,Z.Overview=Zs,Z.Palette=Pm,Z.Path=Ud,Z.PathAnnotation=Qe,Z.PathElement=P,Z.PathPort=je,Z.Phase=Oc,Z.Point=K,Z.PointPort=Be,Z.PolyLineDrawingTool=ea,Z.PolygonDrawingTool=Jo,Z.Port=Le,Z.PortProperties=fm,Z.PrintAndExport=Jg,Z.RadialGradient=kt,Z.RadialTree=Hu,Z.Rect=k,Z.RelationShip=ds,Z.ResizeTool=Eo,Z.RotateTool=Do,Z.RowDefinition=Qn,Z.Ruler=ys,Z.SelectTool=fo,Z.Selector=B,Z.Shadow=bt,Z.Shape=Xd,Z.ShapeAnnotation=Ze,Z.ShapeStyle=Nt,Z.Size=j,Z.SnapSettings=h,Z.Snapping=n,Z.StackPanel=Ed,Z.Stop=xt,Z.StraightSegment=Wa,Z.StrokeStyle=Wt,Z.SwimLane=Lc,Z.SymbolDragSize=Dm,Z.SymbolPalette=Im,Z.SymbolPaletteInfo=Ie,Z.SymbolPreview=Em,Z.SymbolSize=Ki,Z.SymmetricLayout=Xu,Z.Text=rl,Z.TextDrawingTool=Wo,Z.TextElement=H,Z.TextStyle=Xt,Z.Thickness=mt,Z.ToolBase=en,Z.UmlActivityShape=Ul,Z.UmlClass=rc,Z.UmlClassAttribute=Jl,Z.UmlClassMethod=ec,Z.UmlClassifierShape=fc,Z.UmlEnumeration=gc,Z.UmlEnumerationMember=lc,Z.UmlInterface=sc,Z.UndoRedo=g,Z.UserHandle=Ts,Z.Vector=xa,Z.ZoomPanTool=Xo,Z.addChildToContainer=qr,Z.alignElement=sd,Z.alignLabelOnSegments=Ch,Z.arrangeChild=id,Z.bBoxText=wp,Z.bezierPoints=es,Z.canMeasureDecoratorPath=Sd,Z.canResizeCorner=Fh,Z.canShowControlPoints=Gh,Z.canShowCorner=Uh,Z.changeOldFlipDirectionType=Eh,Z.checkBrowserInfo=bd,Z.checkChildNodeInContainer=Gr,Z.checkParentAsContainer=Ur,Z.checkPort=md,Z.checkPortRestriction=Zh,Z.cloneArray=fp,Z.cloneBlazorObject=vd,Z.cloneObject=Q,Z.cloneSelectedObjects=hd,Z.completeRegion=Ks,Z.contains=ro,Z.contextMenuBeforeItemRender=Kt,Z.contextMenuClick=Gt,Z.contextMenuOpen=Zt,Z.cornersPointsBeforeRotation=gp,Z.createHelper=Vr,Z.deserialize=Mh,Z.extendArray=vp,Z.extendObject=yp,Z.findAngle=M,Z.findAnnotation=Kh,Z.findBounds=Xr,Z.findConnectorPoints=li,Z.findDistance=yd,Z.findMargin=Ti,Z.findNearestPoint=rh,Z.findNodeByName=qs,Z.findObjectIndex=Jh,Z.findObjectType=Qs,Z.findParentInSwimlane=Id,Z.findPath=fd,Z.findPoint=Di,Z.findPort=qh,Z.findPortIndex=$h,Z.findPortToolToActivate=no,Z.findToolToActivate=io,Z.flipConnector=cd,Z.getAlignedPosition=Ih,Z.getAlignedPositionForPorts=wh,Z.getAnnotationPosition=vh,Z.getBasicShape=me,Z.getBezierBounds=ts,Z.getBezierDirection=Ph,Z.getBezierPoints=$a,Z.getBounds=up,Z.getBpmnGatewayShapePathData=gu,Z.getBpmnLoopShapePathData=mu,Z.getBpmnShapePathData=cu,Z.getBpmnTaskShapePathData=uu,Z.getBpmnTriggerShapePathData=pu,Z.getChild=Th,Z.getCollectionChangeEventArguements=function(t,e,i,n){return t},Z.getConnectorArrowType=Pd,Z.getConnectorDirection=dd,Z.getCursor=ho,Z.getDecoratorShape=ti,Z.getDirection=Qa,Z.getDropEventArguements=function(t,e){return e},Z.getElement=rd,Z.getFlowShape=hi,Z.getFreeHandPath=R,Z.getFunction=Dp,Z.getIconShape=ni,Z.getInOutConnectPorts=Qh,Z.getIndex=function(t,e){if(t.nodes&&0<t.nodes.length)for(var i=0;i<t.nodes.length;i++)if(t.nodes[parseInt(i.toString(),10)].id===e)return i;if(t.connectors&&0<t.connectors.length)for(i=0;i<t.connectors.length;i++)if(t.connectors[parseInt(i.toString(),10)].id===e)return i;return null},Z.getInternalProperties=mp,Z.getIntersection=Mi,Z.getIntersectionPoints=Li,Z.getInterval=th,Z.getLineSegment=ph,Z.getObjectFromCollection=td,Z.getObjectType=ld,Z.getOffset=Tp,Z.getOffsetOfConnector=xh,Z.getOffsetOfPorts=Sh,Z.getOppositeDirection=Ui,Z.getOuterBounds=Fi,Z.getPathOffset=ud,Z.getPathString=tt,Z.getPoint=ad,Z.getPoints=gh,Z.getPolygonPath=L,Z.getPortDirection=Vi,Z.getPortShape=$e,Z.getPortsPosition=bh,Z.getPreviewSize=wd,Z.getRectanglePath=E,Z.getSegmentThumbShapeHorizontal=ei,Z.getSegmentThumbShapeVertical=ii,Z.getSpaceValue=$s,Z.getString=et,Z.getSymbolSize=xd,Z.getTooltipOffset=uh,Z.getUMLActivityShapes=Wh,Z.getUMLFinalNode=Hh,Z.getUserHandlePosition=Vh,Z.groupHasType=ah,Z.hasSelection=oo,Z.hasSingleConnection=ao,Z.identityMatrix=rt,Z.initFixedUserHandlesSymbol=fh,Z.initTooltip=Pe,Z.insertObject=nd,Z.intersect2=ch,Z.intersect3=lh,Z.isDiagramChild=oh,Z.isEmptyVector=Ja,Z.isPointOverConnector=dh,Z.isSelected=so,Z.menuClass=du,Z.middleElement=xp,Z.moveChildInStack=eo,Z.multiplyMatrix=dt,Z.orthoConnection2Segment=Bi,Z.overFlow=Ip,Z.parsePathData=O,Z.pathSegmentCollection=X,Z.processPathData=D,Z.randomId=q,Z.removeChildInContainer=Yr,Z.removeChildNodes=Ah,Z.removeGradient=_h,Z.removeItem=Yh,Z.renderContainerHelper=Fr,Z.renderStackHighlighter=to,Z.rotateMatrix=at,Z.rotatePoint=Ap,Z.rotateSize=Pp,Z.scaleElement=ed,Z.scaleMatrix=st,Z.scalePathData=J,Z.selectionHasConnector=Cd,Z.serialize=Dh,Z.setConnectorDefaults=nh,Z.setPortsEdges=eh,Z.setSwimLaneDefaults=Js,Z.setUMLActivityDefaults=ih,Z.sort=yh,Z.splitArrayCollection=$,Z.swapBounds=vi,Z.templateCompiler=pp,Z.textAlignToString=bp,Z.transformPath=V,Z.transformPointByMatrix=z,Z.transformPointsByMatrix=ot,Z.translateMatrix=ht,Z.updateCanvasBounds=_r,Z.updateConnector=Xh,Z.updateContent=Nh,Z.updateDefaultValues=sh,Z.updateHyperlink=kh,Z.updateLaneBoundsAfterAddChild=$r,Z.updateLaneBoundsWithSelector=Jr,Z.updateLayoutValue=hh,Z.updatePathElement=gd,Z.updatePortEdges=pd,Z.updateShape=Rh,Z.updateShapeContent=Bh,Z.updateStyle=zh,Z.updateTooltip=De,Z.updateUmlActivityNode=jh,Z.updateZindex=Kr,Z.updatedSegment=U,Z.upgrade=Lh,Z.whiteSpaceToString=Cp,Z.wordBreakToString=Sp,Object.defineProperty(Z,"__esModule",{value:!0})});
//# sourceMappingURL=ej2-diagrams.umd.min.js.map
