this.ej=this.ej||{},this.ej.spreadsheet=function(e,t,r,n,i,a,o,s,l,d,h,p){"use strict";function c(e,r,n){var i,a=[];if(e){var o=void 0;if(r&&!t.isNullOrUndefined(n)&&(o=Ae(r,n)),e=-1===(e=e.lastIndexOf("!")>-1?e.substring(e.lastIndexOf("!")+1):e).indexOf(":")?e+":"+e:e,!new RegExp(/^(?=.*[a-zA-Z])(?=.*\d)/g).test(e)){var s=e.split(":");e=t.isNullOrUndefined(e.match(/[0-9]/))?s[0]+"1:"+s[1]+(o?o.rowCount-1:"1"):"A"+s[0]+":"+(o?v(o.colCount):"A")+s[1]}e.split(":").forEach(function(e){i=u(e),a.push(i[0]),a.push(i[1])})}return a}function u(e){return[parseInt(e.match(/\d+/)[0],10)-1,f(e.match(/[A-Z]+/i)[0].toUpperCase())]}function f(e){for(var t=0,r=(e=e.split("").reverse().join("")).length-1;r>=0;r--)t+=(e[r].charCodeAt(0)-64)*Math.pow(26,r);return t-1}function g(e,t){return v(t+1)+(e+1)}function m(e){return g(e[0],e[1])+":"+(t.isNullOrUndefined(e[2])?g(e[0],e[1]):g(e[2],e[3]))}function v(e){return e/26>1?v(e%26==0?e/26-1:Math.floor(e/26))+String.fromCharCode(e%26==0?"Z".charCodeAt(0):64+e%26):String.fromCharCode(64+e)}function y(e,t,r){return c(C(e),t,r)}function C(e){var t=e.lastIndexOf("!");return t>-1?e.substring(t+1):e}function b(e){return e.name+"!"+e.selectedRange}function x(e,t){var r=S(e,t);return{sheetIndex:r,indices:y(t,e,r)}}function S(e,t){return t.indexOf("!")>-1?Se(e,Ie(t)):e.activeSheetIndex}function w(e){var t=e.slice();return e[0]>e[2]&&I(t,0,2),e[1]>e[3]&&I(t,1,3),t}function I(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function E(e){return e[0]===e[2]&&e[1]===e[3]}function R(e,t,r,n,i,a){return new xr(e,t,r,n,i,a)}function N(e,t){return void 0===t&&(t=[]),t.push({member:"dataBind",args:[e]}),t.push({member:"workbookProtectSheet",args:[e]}),e.allowSave&&t.push({member:"workbookSave",args:[e]}),e.allowPrint&&t.push({member:"print",args:[e]}),e.allowOpen&&t.push({member:"workbookOpen",args:[e]}),e.allowEditing&&(t.push({member:"workbookEdit",args:[e]}),t.push({member:"workbookFormula",args:[e]})),e.allowNumberFormatting&&t.push({member:"workbookNumberFormat",args:[e]}),e.allowCellFormatting&&t.push({member:"workbookcellformat",args:[e]}),e.allowSorting&&t.push({member:"workbookSort",args:[e]}),e.allowHyperlink&&t.push({member:"workbookHyperlink",args:[e]}),e.allowFiltering&&t.push({member:"workbookFilter",args:[e]}),e.allowFindAndReplace&&t.push({member:"workbookfindAndReplace",args:[e]}),e.allowInsert&&t.push({member:"workbookinsert",args:[e]}),e.allowDelete&&t.push({member:"workbookdelete",args:[e]}),e.allowDataValidation&&t.push({member:"workbookDataValidation",args:[e]}),e.allowMerge&&t.push({member:"workbookmerge",args:[e]}),e.allowCellFormatting&&t.push({member:"workbookConditionalFormatting",args:[e]}),e.allowImage&&t.push({member:"workbookImage",args:[e]}),e.allowChart&&t.push({member:"workbookChart",args:[e]}),e.allowAutoFill&&t.push({member:"workbookautofill",args:[e]}),t}function F(e,r,n,i,a,o,s){var l=e.value;if(l&&"string"==typeof l){if(l.includes("\n"))return{isNumber:!1,value:l};if(fe(l))return{isNumber:!0,value:l};if(a&&l.includes(a)&&(s||e.format.includes(a)||e.format.includes("$"))&&(l=l.replace(a,"").trim()),n&&l.includes(n)&&A(l,r,n,i)&&(l=l.split(n).join("").trim()),i||(i=t.getNumericObject(r).decimal),"."!==i&&l.includes(i)&&(l=l.replace(i,".").trim()),fe(l))return{isNumber:!0,value:l};if(o&&2===l.split("/").length)try{var d=l.split(" ");return l=2===d.length&&1===d[0].split("/").length?ge(d[0])+ge(d[1]):ge(l),{isNumber:!0,value:l}}catch(e){return{isNumber:!1,value:l}}}else if(fe(l))return{isNumber:!0,value:l};return{isNumber:!1,value:l}}function A(e,r,n,i){for(var a=!1,o=123456..toLocaleString(r).split(n).reverse(),s=e.split(i)[0].split(n),l=0;l<s.length&&(a=l===s.length-1?s[l].length===o[0].length:!t.isUndefined(o[1])&&(0===l?s[l].length<=o[1].length:s[l].length===o[1].length));l++);return a}function k(e,t){return e&&"="===e[0]&&(e.length>1||t)}function O(e){var t=e;if((t=t.split("$").join("")).indexOf(":")>-1){var r=t.split(":");if(V(r[0])&&V(r[1]))return!0}else if(t.indexOf(":")<0&&V(t))return!0;return!1}function T(e){return e.charCodeAt(0)>=65&&e.charCodeAt(0)<=90||e.charCodeAt(0)>=97&&e.charCodeAt(0)<=122}function D(e,t){return 0===t[1]&&t[3]===e.colCount-1}function L(e,t){return 0===t[0]&&t[2]===e.rowCount-1}function P(e,t,r){return e&&t>=e[0]&&t<=e[2]&&r>=e[1]&&r<=e[3]}function M(e,t,r){for(var n,i,a=e.split(" "),o=0,s=a.length;o<s&&(n=c(a[o]),!(i=P(n,t,r)));o++);return i}function B(e,t,r){var n=e[0]<=t[0]&&e[2]>=t[2]&&e[1]<=t[1]&&e[3]>=t[3];if(n)return!0;if(r){if(t[0]<e[0]&&t[2]<e[0]||t[0]>e[2]&&t[2]>e[2])return!1;if(t[0]<e[0]&&t[2]>e[0]&&(t[0]=e[0],n=!0),t[2]>e[2]&&(t[2]=e[2],n=!0),t[1]<e[1]&&t[3]<e[1]||t[1]>e[3]&&t[3]>e[3])return!1;t[1]<e[1]&&t[3]>e[1]&&(t[1]=e[1],n=!0),t[3]>e[3]&&(t[3]=e[3],n=!0)}return n}function H(e,t,r){var n=v(r+1);return e?e.split(" ").forEach(function(r){var i=c(r);if(B(i,t))e=e.split(r).join(n+(i[0]+1)+":"+n+t[0]+" "+n+(t[2]+2)+":"+n+(i[2]+1));else if(B(i,t,!0)){var a=void 0;a=t[0]>i[0]?n+(i[0]+1)+":"+n+t[0]:n+(t[2]+2)+":"+n+(i[2]+1),e=e.split(r).join(a)}}):e=n+"1:"+n+t[0]+" "+n+(t[2]+2)+":"+n+"1048576",e}function U(e,t){return e||(e={}),!!e.isLocked||!1!==e.isLocked&&(!(!t||!t.isLocked)||!(e.isLocked||!t||!1===t.isLocked))}function V(e){for(var t=e,r=0,n="",i=t.length,a=0;a<i;a++)T(t[a])&&r++;var o=(n=t.substring(0,r)).length;if(o!==i&&o<4&&1!==i&&isNaN(parseInt(t,10))){if(z(n)>16384)return!1;var s=parseFloat(t.substring(r,i));if(s>0&&s<1048577)return!0}return!1}function z(e){var t=0,r=0;if(e=e.toUpperCase(),t<e.length&&"!"===e[t]){for(t++;t<e.length&&"!"!==e[t];)t++;t++}for(;t<e.length&&T(e[t]);)r=26*r+e[t].charCodeAt(0)-64,t++;return 0===r?-1:r}function j(e,t,r,n,i){void 0===n&&(n="rows");var a;if(r)for(o=t;o<1/0;o++)if((a=e[""+n])[t]&&a[t].hidden)t++;else{if(!i)break;i--,t++}else for(var o=t;o>-1&&((a=e[""+n])[t]&&a[t].hidden);o--)t--;return t}function _(e,t){var r=Object.keys(e);return(t?r.indexOf("fontSize")>-1:r.indexOf("fontSize")>-1&&Number(e.fontSize.split("pt")[0])>12)||r.indexOf("fontFamily")>-1||r.indexOf("borderTop")>-1||r.indexOf("borderBottom")>-1}function q(e,t,r,n,i,a){var o,s;if(t&&(o=(s=i||He(t[0],t[1],r,!1,!0)).formula||""),o){a&&n.notify(tn,{cellRef:g(t[0],t[1])}),0===o.indexOf("=")&&(o=o.slice(1));for(var l=["+","-","*","/",">=","<=","<>",">","<","=","%","&"],d=void 0,h=o=o.split("(").join(n.listSeparator).split(")").join(n.listSeparator),p=0;p<l.length;p++)h=(d=h.split(l[p])).join(n.listSeparator);d=h.split(n.listSeparator);for(var u=[],f=void 0,m=void 0,v=void 0,y=void 0,C=void 0,b=0;b<d.length;b++){if(v=d[b].includes("!")){var x=d[b].lastIndexOf("!");y=d[b].substring(0,x),C=d[b].substring(x+1).toUpperCase()}else C=d[b].toUpperCase();if(O(C.trim())&&!C.includes("$")){var S=W(C),w=G(C),I=c(C),E=[e[0]-(t[0]-I[0]),e[1]-(t[1]-I[1]),e[0]-(t[0]-I[2]),e[1]-(t[1]-I[3])];E[1]<0||E[2]<0||E[3]<0||!a&&E[0]<0?f="#REF!":(a&&E[0]<0&&(E[0]=E[2]),f=g(E[0],E[1]),C.includes(":")&&(f+=":"+g(E[2],E[3])),f=O(f)?f:"#REF!"),m={},v&&(f=y+"!"+f),m[d[b]]=""+S+f+w,d[b].includes(":")?u.splice(0,0,m):u.push(m)}}for(var R=void 0,N=void 0,F=o=s.formula,b=0;b<u.length;b++){R=Object.keys(u[b])[0],N=u[b][""+R];for(var A=R.length,k=F.indexOf(R),T="",D=0;D<N.length;D++)T+=" ";o=o.slice(0,k)+N+o.slice(k+A),F=F.slice(0,k)+T+F.slice(k+A)}return o}return null}function W(e){for(var t="",r=0;r<e.length&&" "===e[r];r++)t+=" ";return t}function G(e){for(var t="",r=e.length-1;r>=0&&" "===e[r];r--)t=" "+t;return t}function Y(e,t,r,n,i){var a={cell:r.cell,rowIndex:r.rowIdx,colIndex:r.colIdx,cancel:!1,sheet:t.name};if(r.preventEvt||e.trigger(Fn,a),!r.eventOnly&&!a.cancel)if(r.valChange){var o=He(a.rowIndex,a.colIndex,t),s=!r.preventEvt&&e.getDisplayText(o),l=!(!o||!o.formula);Ue(a.rowIndex,a.colIndex,t,a.cell,!r.pvtExtend);var d=He(a.rowIndex,a.colIndex,t,!1,!0);r.mergedCells&&(delete d.value,delete d.formula),d.formattedText&&delete d.formattedText;var h={action:"updateCellValue",address:[a.rowIndex,a.colIndex],sheetIndex:Se(e,t.name),value:l&&!d.formula?d.value||(0===d.value?"0":""):d.formula||d.value||(0===d.value?"0":""),skipFormatCheck:r.skipFormatCheck,isRandomFormula:r.isRandomFormula,isDelete:r.isDelete,deletedRange:r.deletedRange,fillType:r.fillType,cellInformation:n,isRedo:!i,actionName:r.fillType,isPaste:"paste"===r.requestType};if(e.notify($r,h),r.isFormulaDependent=h.isFormulaDependent,r.requestType&&null===a.cell&&Ue(a.rowIndex,a.colIndex,t,a.cell,!r.pvtExtend),r.cellDelete&&(delete d.value,delete d.formula,delete d.hyperlink),r.uiRefresh&&e.serviceLocator.getService("cell").refresh(a.rowIndex,a.colIndex,r.lastCell,r.td,r.checkCF,r.checkWrap,r.skipFormatCheck,r.isRandomFormula,r.fillType),!r.preventEvt){var p=e.getDisplayText(d);if(p!==s){var c=He(a.rowIndex,a.colIndex,t,!1,!0).value,u={value:c=c||(0===c?"0":""),oldValue:s,formula:d.formula||"",address:t.name+"!"+g(a.rowIndex,a.colIndex),displayText:p};r.requestType&&(u.requestType=r.requestType),e.trigger("cellSave",u)}}}else Ue(a.rowIndex,a.colIndex,t,a.cell,!r.pvtExtend);return a.cancel}function X(e,r,n){for(var i=e,a=e,o=r,s=r,l=n.usedRange.rowIndex,d=n.usedRange.colIndex,h=function(e){for(var r=0;r<=d;r++)if(!t.isUndefined(He(e,r,n,null,!0).value))return!1;return!0},p=function(e){for(var r=i;r<=a;r++)if(!t.isUndefined(He(r,e,n,null,!0).value))return!1;return!0},c=i;c<=l&&(!t.isUndefined(He(c,r,n,null,!0).value)||!h(c));c++)a=c;for(c=i;c>=0&&(!t.isUndefined(He(c,r,n,null,!0).value)||!h(c));c--)i=c;for(c=o;c<=d&&(!t.isUndefined(He(e,c,n,null,!0).value)||!p(c));c++)s=c;for(c=o;c>=0&&(!t.isUndefined(He(e,c,n,null,!0).value)||!p(c));c--)o=c;return[i,o,a,s]}function K(e,t,r){var n=c(e.model.selectedRange),i=0,a=0;if("Column"===e.modelType){if((r||"before"===e.insertType&&e.isUndoRedo)&&(n=[0,e.start,0,e.end]),"before"===e.insertType)t[1]<=n[1]&&t[3]>=n[1]?(i=0,a=n[3]-n[1]+1):n[1]<t[1]&&(i=a=n[3]-n[1]+1);else{if(e.isUndoRedo){o=e.end-e.start+1;n=[0,e.start-o,0,e.end-o]}t[1]<=n[3]&&t[3]>=n[3]?(i=0,a=n[3]-n[1]+1):n[3]<t[3]&&(i=a=n[3]-n[1]+1)}return[t[0],t[1]+i,t[2],t[3]+a]}if((r||"above"===e.insertType&&e.isUndoRedo)&&(n=[e.start,0,e.end,0]),"above"===e.insertType)t[0]<=n[0]&&t[2]>=n[0]?(i=0,a=n[2]-n[0]+1):n[0]<t[0]&&(i=a=n[2]-n[0]+1);else{if(e.isUndoRedo){var o=e.end-e.start+1;n=[e.start-o,0,e.end-o,0]}t[0]<=n[2]&&t[2]>=n[2]?(i=0,a=n[2]-n[0]+1):n[2]<t[2]&&(i=a=n[2]-n[0]+1)}return[t[0]+i,t[1],t[2]+a,t[3]]}function $(e,t){var r,n=0,i=0;return"Column"===e.modelType?(r=[0,e.start,e.model.usedRange.rowIndex,e.end],r[3]<t[1]?n=i=r[3]-r[1]+1:r[1]>=t[1]&&r[3]<=t[3]?i=r[3]-r[1]+1:r[1]>=t[1]&&r[1]<=t[3]?i=t[3]-r[1]+1:r[1]<t[1]&&r[3]>=t[1]?(n=t[1]-r[1],i=r[3]-r[1]+1):r[1]<t[1]&&r[3]<t[3]&&(n=r[3]-t[1]+(r[3]-r[1])+1,i=r[3]-r[1]+1),[t[0],t[1]-n,t[2],t[3]-i]):(r=[e.start,0,e.end,e.model.usedRange.colIndex],r[2]<t[0]?n=i=r[2]-r[0]+1:r[0]>=t[0]&&r[2]<=t[2]?i=r[2]-r[0]+1:r[0]>=t[0]&&r[0]<=t[2]?i=t[2]-r[0]+1:r[0]<t[0]&&r[2]>=t[0]?(n=t[0]-r[0],i=r[2]-r[0]+1):r[0]<t[0]&&r[2]<t[2]&&(n=r[2]-t[0]+(r[2]-r[0])+1,i=r[2]-r[0]+1),[t[0]-n,t[1],t[2]-i,t[3]])}function Z(e,t,r,n,i,a,o){for(var s,l,d=e.length-1;d>=0;d--){s=e[d].range.trim().split(",");for(var h=0;h<s.length;h++){if(l=c(s[h].includes(":")?s[h]:s[h]+":"+s[h]),r>=l[0]&&n>=l[1]&&r<=l[2]&&n<=l[3]){t.push(e[d]),e.splice(d,1);break}if(i&&i[0]>=l[0]&&i[1]>=l[1]&&i[0]<=l[2]&&i[1]<=l[3]){var p={action:"autofillWithCF",cFColor:e[d].cFColor,range:m(a),type:e[d].type,value:e[d].value};e.splice(d,1);for(var u=0,f=o.conditionalFormats;u<f.length&&("autofillWithCF"!==f[u].action||f[u].range!==p.range);u++)u===f.length-1&&(t.push(p),o.conditionalFormats.push(p));break}}}}function J(e,t){for(var r,n,i,a,o,s=t.trim().split(","),l=0;l<e.length;l++)if(function(e){for(var t=0;t<s.length;t++){if(o=c(s[t].includes(":")?s[t]:s[t]+":"+s[t]),e[0]<=o[0]&&e[1]<=o[1]&&e[2]>=o[2]&&e[3]>=o[3])return!0;if(i=e[0]>=o[0]&&e[0]<=o[2],a=e[2]>=o[0]&&e[2]<=o[2],r=e[1]>=o[1]&&e[1]<=o[3],n=e[3]>=o[1]&&e[3]<=o[3],i&&a){if(r||n||e[1]<o[1]&&e[3]>o[3]){if(e[0]-o[0]>0)return!0;if(o[2]-e[2]>0)return!0}if(r&&e[1]!==o[1])return!0;if(n&&e[3]!==o[3])return!0}else if(r&&n){if(i||a||e[0]<o[0]&&e[2]>o[2]){if(e[1]-o[1]>0)return!0;if(o[3]-e[3]>0)return!0}if(i){if(e[0]!==o[0])return!0}else if(a&&e[2]!==o[2])return!0}else if(i||a){if(r){if(e[1]!==o[1])return!0;if(e[0]-o[0]>0)return!0;if(o[2]-e[2]>0)return!0}else if(n){if(e[3]!==o[3])return!0;if(e[0]-o[0]>0)return!0;if(o[2]-e[2]>0)return!0}else if(e[1]<o[1]&&e[3]>o[3])return!0}else if((r||n)&&e[0]<o[0]&&e[2]>o[2])return!0}return!1}(e[l]))return!0;return!1}function Q(e,r,n){var i;n||(n=t.getNumericObject(r.locale));for(var a=0;a<e.length;a++)fe(e[a])?"."===n.group&&(e[a]=e[a].toString(),e[a].indexOf(".")&&A(e[a],r.locale,n.group,n.decimal)&&(e[a]=e[a].split(n.group).join(""))):(i={formattedText:e[a],value:e[a],format:"General",cell:{value:e[a],format:"General"},isEdit:!0},r.notify(Wr,i),fe(i.value)&&(e[a]=i.value.toString()));return e}function ee(e,t){var r=e.getActiveSheet(),n=[[t.topIndex+e.frozenRowCount(r),t.leftIndex+e.frozenColCount(r),t.bottomIndex,t.rightIndex]];if(r.frozenRows||r.frozenColumns){var i=e.frozenRowCount(r),a=e.frozenColCount(r),o=u(r.topLeftCell);if(i&&a){n.push([o[0],o[1],i-1,a-1]);var s=u(r.paneTopLeftCell);n.push([s[0],o[1],t.bottomIndex,a-1])}i&&n.push([o[0],t.leftIndex+a,i-1,t.rightIndex]),a&&n.push([t.topIndex+i,o[1],t.bottomIndex,a-1])}return n}function te(e){if(tt(e.sheet,e.rowIdx)&&(t=j(e.sheet,e.rowIdx,!0))<e.rowIdx+e.cell.rowSpan&&(e.rowIdx=t,e.isMergedHiddenCell=!0),ht(e.sheet,e.colIdx)){var t=j(e.sheet,e.colIdx,!0,"columns");t<e.colIdx+e.cell.colSpan&&(e.colIdx=t,e.isMergedHiddenCell=!0)}}function re(e){return e.workbookOpenModule&&e.workbookOpenModule.preventFormatCheck}function ne(e){var r=new t.Internationalization,n={intl:r,updateValue:!0,value:"",curSymbol:t.getNumberDependable(e.locale,t.defaultCurrencyCode)},i={args:n,intl:r},a=t.getNumericObject(e.locale);return function(t){if(!t.format&&t.value&&!fe(t.value)&&(n.cell=t,n.value=t.value,e.notify(Zr,n),!t.format)){var r=t.value.toString();r.includes(i.args.curSymbol)||r.includes(a.group)||r.includes("%")?(i.fResult=r,e.notify(Jr,i)):"."===a.decimal||fe(r)||r.includes(a.decimal)&&fe(r=r.replace(a.decimal,"."))&&(t.value=r)}}}function ie(e,t,n){var i=new r.Query;t.length&&i.where(r.Predicate.and(t));var a=e.executeLocal(i);if(n)for(var o=0,s=n.length;o<s&&a.length;o++)i=new r.Query,n[o].length&&i.where(r.Predicate.or(n[o])),a=new r.DataManager(a).executeLocal(i);return a}function ae(e,t,r){return e&&e.isReadOnly||r&&r.isReadOnly||t&&t.isReadOnly}function oe(e,r){for(var n,i=e.getActiveSheet(),a=t.isNullOrUndefined(r)?w(c(i.selectedRange)):r,o=a[0];o<=a[2];o++)for(var s=a[1];s<=a[3];s++)if(ae(He(o,s,i),ot(i,s),Qe(i,o))){n=!0;break}return n}function se(e,t){var r=t||e.selectedRange,n=c(r),i=e.colCount,a=e.rowCount;return n[2]===a-1&&0===n[0]?r=r.replace(/[0-9]/g,""):n[3]===i-1&&0===n[2]&&(r=r.replace(/\D/g,"")),r}function le(e,t,r){if(t.length){var n,i=e.getActiveSheet(),a=e,o=e.frozenColCount(i),s=r&&r[0]||(o?u(i.topLeftCell)[1]:a.viewport.leftIndex),l=r&&r[1]||a.viewport.rightIndex;t.forEach(function(t){for(var r=s;r<=l;r++){r===o&&(r+=a.viewport.leftIndex);var d=He(t-1,r,i,!1,!0);if(!(d.rowSpan&&1!==d.rowSpan&&d.colSpan&&1!==d.colSpan||d.style&&d.style.borderBottom&&"none"!==d.style.borderBottom)&&(n=He(t,r,i,!1,!0).style)&&n.borderTop){var h=e.getCell(t-1,r);if(h&&h.style.borderBottom){var p=e.getCell(t,r);p&&(h.style.borderBottom="",p.style.borderTop=n.borderTop)}}}})}}function de(e){var t=e.toString();if(e===parseInt(t,10))return parseInt(t,10)+"  ";var r=t.indexOf(".")>-1?t.split(".")[1]:0,n=Math.pow(10,r.toString().replace("-","").length),i=Math.abs(he(r,n));return r/i+"/"+n/i}function he(e,t){return e=Number(e),t=Number(t),t?he(t,e%t):e}function pe(e){(e=(e=Number(e))>0&&e<1?1+e:0===e?1:e)>60&&(e-=1);var t=new Date("01/01/1900"),r=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds());return new Date(new Date(864e5*(e-1)+r).toUTCString().replace(" GMT",""))}function ce(e,t,r){var n=new Date("01/01/1900"),i=ue(e)?e:new Date(e),a=Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()),o=(Date.UTC(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds())-a)/864e5;return(t?o:parseInt(o.toString(),10))+(r?0:o>60?2:1)}function ue(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.valueOf())}function fe(e){return e-parseFloat(e)>=0}function ge(e){return Function('"use strict";return ('+e+")")()}function me(e,r,n,i,a,o){var s,l=t.IntlBase.getDependables(t.cldrData,n,null).dateObject,d=l.dateTimeFormats.availableFormats,h={dateObj:null,isCustom:!1,type:""},p=function(){"time"===h.type&&(h.dateObj=new Date((s?s.toDateString():"01/01/1900")+" "+h.dateObj.toLocaleTimeString()))};if(i&&(h.dateObj=r.parseDate(e,{format:i}),h.dateObj&&(h.type=e.toString().indexOf(":")>-1?"time":"datetime",p(),h.isCustom=!0)),t.isNullOrUndefined(h.dateObj)){if((e=e.toString())&&e.indexOf("/")>-1||e.indexOf("-")>0){var c=a&&a.format||i;if(c){var u=c.toLowerCase().includes("dd-mm-yy");if((u||c.toLowerCase().includes("dd/mm/yy"))&&(c=u?"d-M-y":"d/M/y",h.dateObj=r.parseDate(e,{format:c,skeleton:"yMd"}),h.dateObj))return h.type="date",h}}var f=function(e){if(e.indexOf(":")<0)for(var n=0,i=Object.keys(l.dateFormats);n<i.length;n++){f=i[n];if(h.dateObj=r.parseDate(e,{format:l.dateFormats[""+f],skeleton:f}),h.dateObj){h.type="date",h.isCustom=!1;break}}if(t.isNullOrUndefined(h.dateObj))for(var a=void 0,o=0,s=Object.keys(d);o<s.length;o++){f=s[o];if(a=d[""+f],h.dateObj=r.parseDate(e,{format:a,skeleton:f}),!h.dateObj&&e.indexOf(":")>-1&&a.indexOf(":")>-1&&(h.dateObj=r.parseDate(e,{format:a.split(" ")[0]})),h.dateObj){h.type=e.toString().indexOf(":")>-1?"time":"datetime",p(),h.isCustom=!0;break}}if(t.isNullOrUndefined(h.dateObj))for(var c=0,u=Object.keys(l.timeFormats);c<u.length;c++){var f=u[c];if(h.dateObj=r.parseDate(e,{format:l.timeFormats[""+f],skeleton:f}),h.dateObj){h.type="time",p(),h.isCustom=!1;break}}};if(o){var g=e.split(" ");g.length>=2&&(f(g.shift()),h.dateObj&&(s=h.dateObj,h.dateObj=null,f(g.join(" ")),h.dateObj&&(h.type="datetime")))}else f(e)}return"#DIV/0!"===e||h.dateObj||"Invalid Date"===new Date(e).toString()||(h.dateObj=new Date(e),h.type="date"),h}function ve(e,t,r){if(e&&"."!==e&&"-"!==e){var n=e.toString(),i=Number.MAX_SAFE_INTEGER.toString().length;if(n.startsWith("-")&&(n=(n=n.slice(1)).includes("-")?e:n),/^\d*\.?\d*$/.test(n))return t&&(n.length>i||r&&(n.startsWith("0")||n.endsWith("0")))?e:parseFloat(e)}return e}function ye(e,r,n,i,a,o,s,l,d,h,p,u){return void 0===d&&(d=!0),new Promise(function(f){f(function(){var f,m=r.lastIndexOf("!");m>-1?(f=Se(e,r.substring(0,m)),r=r.substring(m+1)):f=e.activeSheetIndex;var C=Ae(e,f),b=y(h||r),x={sheet:C,indexes:b,formulaCellRef:s,sheetIndex:l,promise:new Promise(function(e){e(void 0)})};return e.notify(_r,x),x.promise.then(function(){var s,l,h,f=b[0],m=e.frozenRowCount(C),y=e.frozenColCount(C),x=!!u;if(n){h=[];var S,w,I,E,R,N,F,A;i?(N=t.getNumericObject(e.locale),F=new t.Internationalization(e.locale)):A=ne(e),r.split(",").forEach(function(r,n){for(b=c(r),S=0,f=b[0];f<=b[2];){for(w=h[S]||{},l=Qe(C,f),s=b[1];s<=b[3];)if(!d||!tt(C,f)||o&&rt(C,f)){E=v(s+1);var a=l?He(f,s,C):null;if(i)a&&(a.value||0===a.value)?(a.formattedText&&a.format&&!a.format.includes("*")?qe(a.format,!1)?w[E]=pe(a.value):w[E]=a.formattedText.toString().trim():w[E]=Ce(e,a,f,s,!1,F),"string"==typeof(R=a.value)&&("."!==N.decimal&&R.includes(N.decimal)?fe(I=R.replace(N.decimal,"."))&&(R=parseFloat(I)):fe(R)&&(R=parseFloat(R)))):(w[E]="",R=null),w[E+"_value"]=R;else if((a&&(a.formula||!t.isNullOrUndefined(a.value))||Object.keys(w).length)&&(s===p?((R={value:Ce(e,a,f,s,!0)}).value&&"string"==typeof R.value&&(fe(R.value)&&!a.value.toString().includes("\n")?a.format&&"@"===a.format||(R.value=parseFloat(R.value)):a.format||(A(a),fe(a.value)&&!a.value.toString().includes("\n")&&(R.value=parseFloat(a.value)))),w[E]=t.extend({},a,R)):w[E]=a),a&&(a.rowSpan&&1!==a.rowSpan||a.colSpan&&1!==a.colSpan))return void(h=[{throwMergeAlert:!0}]);s===b[3]&&Object.keys(w).length&&(w.__rowIndex=(f+1).toString(),h[S]=w,x&&0===n&&!rt(C,f)&&u.push(w),S++),s++}else f++;f++}})}else{h=new Map;for(var k=!(i||!a||!a.length);f<=b[2];)if(k&&f>=m&&f<a[0])f=a[0];else if(i||!tt(C,f)){for(l=Qe(C,f),s=b[1];s<=b[3];){var O={cell:He(f,s,C),address:g(f,s),rowIndex:f,colIndex:s};e.trigger(cn,O);var T=He(f,s,C,!1,!0);if(T.formula&&T.formula.toUpperCase().includes("UNIQUE")&&e.notify(Gr,{cell:T,rowIdx:f,colIdx:s,sheetIndex:e.activeSheetIndex,address:O.address}),T.colSpan>1&&T.rowSpan>1)for(var D=void 0,L=f,P=f+T.rowSpan;L<P;L++)for(var M=s,B=s+T.colSpan;M<B;M++)L===f&&M===s||(D=new Object,L!==f&&(D.rowSpan=f-L),M!==s&&(D.colSpan=s-M),C.rows[L]&&C.rows[L].cells&&C.rows[L].cells[M]&&(delete C.rows[L].cells[M].value,delete C.rows[L].cells[M].formula),Ue(L,M,C,D,!0));else if(T.colSpan>1)for(var L=s+1,P=s+T.colSpan;L<P;L++)Ue(f,L,C,{colSpan:s-L},!0),C.rows[f]&&C.rows[f].cells&&C.rows[f].cells[L]&&(delete C.rows[f].cells[L].value,delete C.rows[f].cells[L].formula);else if(T.rowSpan>1)for(var L=f+1,P=f+T.rowSpan;L<P;L++)Ue(L,s,C,{rowSpan:f-L},!0),C.rows[L]&&C.rows[L].cells&&C.rows[L].cells[s]&&(delete C.rows[L].cells[s].value,delete C.rows[L].cells[s].formula);if(i||!ht(C,s))if(k&&s>=y&&s<a[1])s=a[1];else{if(T.style){var H={};Object.assign(H,T.style),T.style=H}h.set(O.address,T),s++}else s++}f++}else f++}return h})}())})}function Ce(e,r,n,i,a,o){if(r){if(t.isNullOrUndefined(r.value))return"";if(r.format){var s={value:r.value,formattedText:r.value,cell:r,format:r.format,checkDate:!a,rowIndex:n,colIndex:i,dataUpdate:!0};return e.notify(Wr,s),s.dateObj&&"Invalid Date"!==s.dateObj.toString()?s.dateObj:a?s.value:s.formattedText.toString().trim()}if(a)return r.value;var l=r.value;if(fe(l)&&((l=Number(r.value).toString()).includes(".")||l.length>11)){var d={args:{value:l,updateValue:!0},fResult:l,cellVal:l,intl:o};e.notify(Qr,d),l=d.fResult}return l}return""}function be(e,r){var n,i,a;if(t.isUndefined(e[r])||!e[r]||e[r].index!==r)for(var o=0;o<=r;o++)if(e&&e[o]){if((n=e[o].index-o)>0){for(e.forEach(function(e,t){e&&e.index&&(a=e.index,i=1),e&&!e.index&&0!==t&&(e.index=a+i),i++});n--;)e.splice(o,0,null);o+=n}}else e?e[o]=null:e=[];return e[r]}function xe(e,r,n,i){var a,o,s=0,l=e.length;i&&e.length>0&&e.sort(function(e,r){return t.isNullOrUndefined(e)||t.isUndefined(e.index)||t.isNullOrUndefined(r)||t.isUndefined(r.index)?0:e.index-r.index});for(var d,h=0;h<l;h++)!function(i){if(t.isNullOrUndefined(e[i])||t.isUndefined(e[i].index)||(o=s=e[i].index-i,delete e[i].index),s>0){for(a=0;s--;)r?(n.createSheet(i+a),a++):e.splice(i,0,null);i+=o,l+=o}if(r){e[i].id<1&&(e[i].id=Oe(n.sheets),e[i].properties&&(e[i].properties.id=e[i].id)),e[i].name||n.setSheetPropertyOnMute(e[i],"name","Sheet"+ke(n));var h=0;e[i].rows.forEach(function(e){h=Math.max(h,e&&e.cells&&e.cells.length-1||0)}),n.setSheetPropertyOnMute(e[i],"usedRange",{rowIndex:e[i].rows.length?e[i].rows.length-1:0,colIndex:h})}d=i}(h),h=d}function Se(e,t){var r;t.startsWith("'")&&t.endsWith("'")&&(t=t.replace(/''/g,"'").replace(/^'|'$/g,""));for(var n=0;n<e.sheets.length;n++)if(e.sheets[n].name.toLowerCase()===t.toLowerCase()){r=n;break}return r}function we(e,t){for(var r,n=0;n<e.sheets.length;n++)if(e.sheets[n].id===t){r=n;break}return r}function Ie(e){var t=e.lastIndexOf("!");return t>-1?e.substring(0,t).replace(/'/gi,""):e.replace(/'/gi,"")}function Ee(e,t,r){for(var n=r.length,i=0;i<n;i++)if(r[i].sheet.toUpperCase()===t.toUpperCase())return r[i].index;return-1}function Re(e,t,r,n){void 0===r&&(r={}),e.setSheetPropertyOnMute(r,"selectedRange",n?r.selectedRange+" "+t:t)}function Ne(e){return e&&e.selectedRange||"A1"}function Fe(e){return e.selectedRange.split(" ")[0]}function Ae(e,t){return e.sheets[t]}function ke(e){var t=[];e.sheets.forEach(function(e){t.push(e.name.toLowerCase())});for(var r=0;r<t.length;r++){if(!(t.indexOf("sheet"+e.sheetNameCount)>-1))return e.sheetNameCount++;e.sheetNameCount++}return e.sheetNameCount++}function Oe(e){var t=0;return e.forEach(function(e){t=Math.max(e.id,t)}),t+1}function Te(e,r,n){var i=r||e.sheets;i.forEach(function(r){if(r.id=r.id||0,r.name=r.name||"",e.setSheetPropertyOnMute(r,"rowCount",r.rowCount||100),e.setSheetPropertyOnMute(r,"colCount",r.colCount||100),e.setSheetPropertyOnMute(r,"topLeftCell",r.topLeftCell||"A1"),e.setSheetPropertyOnMute(r,"activeCell",r.activeCell||"A1"),e.setSheetPropertyOnMute(r,"selectedRange",r.selectedRange||r.activeCell+":"+r.activeCell),e.setSheetPropertyOnMute(r,"usedRange",r.usedRange||{rowIndex:0,colIndex:0}),e.setSheetPropertyOnMute(r,"ranges",r.ranges?r.ranges:[]),e.setSheetPropertyOnMute(r,"rows",r.rows&&t.extend([],r.rows,null,!0)||[]),e.setSheetPropertyOnMute(r,"columns",r.columns||[]),e.setSheetPropertyOnMute(r,"showHeaders",!!t.isUndefined(r.showHeaders)||r.showHeaders),e.setSheetPropertyOnMute(r,"showGridLines",!!t.isUndefined(r.showGridLines)||r.showGridLines),e.setSheetPropertyOnMute(r,"state",r.state||"Visible"),r.maxHgts=r.maxHgts||[],r.isImportProtected=r.isProtected&&n,r.protectSettings=r.protectSettings||{selectCells:!1,formatCells:!1,formatRows:!1,formatColumns:!1,insertLink:!1},r.isProtected=r.isProtected||!1,!r.paneTopLeftCell||"A1"===r.paneTopLeftCell){r.frozenRows=r.frozenRows?r.frozenRows:0,r.frozenColumns=r.frozenColumns?r.frozenColumns:0;var i=u(r.topLeftCell);e.setSheetPropertyOnMute(r,"paneTopLeftCell",g(r.frozenRows?i[0]+r.frozenRows:i[0],r.frozenColumns?i[1]+r.frozenColumns:i[1]))}xe(r.columns),De(r.rows,n)}),xe(i,!0,e)}function De(e,t){e.forEach(function(e){e&&e.cells&&xe(e.cells,null,void 0,t)}),xe(e,null,void 0,t)}function Le(e,t){return void 0===t&&(t=e.activeSheetIndex),Ae(e,t).name}function Pe(e,t,r,n,i){var a=!!r;r=r||[e.activeSheetIndex];var o=Le(e),s={action:"moveSheet",eventArgs:{position:t=Be(e.sheets,t,e.activeSheetIndex>t),sheetIndexes:r,cancel:!1}};n&&e.trigger("actionBegin",s),s.eventArgs.cancel||(e.notify(On,{prevIndex:e.activeSheetIndex,currentIndex:t}),r.forEach(function(r,n){e.sheets.splice(t+n,0,e.sheets.splice(r+(t>r?-1*n:0),1)[0])}),e.setProperties({activeSheetIndex:i?Se(e,o):t>r[0]?t-(r.length-1):t},!0),e.notify(In,{refresh:a}),n&&(delete s.eventArgs.cancel,e.trigger("actionComplete",s)))}function Me(e,r,n,i){var a={action:"duplicateSheet",eventArgs:{sheetIndex:r=t.isUndefined(r)?e.activeSheetIndex:r,cancel:!1}};if(n&&e.trigger("actionBegin",a),!a.eventArgs.cancel){var o=Ae(e,r),s=t.extend({},o.properties?o.properties:o,{},!0);s.id=Oe(e.sheets);var l=s.name;/^\(\d+\)$/.test("("+l.split(" (")[1])&&(l=l.split(" (")[0]);var d=[];e.sheets.forEach(function(e){d.push(e.name)});for(var h=2;;h++)if(-1===d.indexOf(l+" ("+h+")")){s.name=l+" ("+h+")";break}e.notify(An,{sheetIndex:r,newSheetIndex:r+1}),e.notify(Tn,{isDuplicate:!0,curSheetIndex:r,newSheetIndex:r+1}),e.createSheet(r+1,[s]),e.notify(Kr,{action:"addSheet",sheetName:"Sheet"+s.id,visibleName:s.name,sheetId:s.id}),i||e.setProperties({activeSheetIndex:r+1},!0),e.notify(In,{refresh:!0,isDuplicate:!0}),n&&(delete a.eventArgs.cancel,e.trigger("actionComplete",a))}}function Be(e,t,r){for(var n=t;r?n>=0:n<e.length;r?n--:n++)if("Hidden"!==e[n].state&&"VeryHidden"!==e[n].state){t=n;break}return t}function He(e,t,r,n,i){var a=Qe(r,e);if(!a||!a.cells){if(!n)return i?{}:null;a?r.rows[e].cells=[]:r.rows[e]={cells:[]}}return r.rows[e].cells[t]||(i?{}:null)}function Ue(e,r,n,i,a,o){n.rows[e]?n.rows[e].cells||(n.rows[e].cells=[]):n.rows[e]={cells:[]},a&&n.rows[e].cells[r]&&!o?t.extend(n.rows[e].cells[r],i,null,!0):n.rows[e].cells[r]=i}function Ve(e,t){var r,n={fontFamily:"Calibri",verticalAlign:"bottom",textIndent:"0pt",backgroundColor:"#ffffff",color:"#000000",textAlign:"left",fontSize:"11pt",fontWeight:"normal",fontStyle:"normal",textDecoration:"none",border:"",borderLeft:"",borderTop:"",borderRight:"",borderBottom:""},i={};return Object.keys(t?n:e).forEach(function(t){(r=e[""+t])!==n[""+t]&&(i[""+t]=r)}),i}function ze(e,t,r,n,i){void 0===t&&(t=!0);for(var a=r.getAddressInfo(e),o=a.indices,s=Ae(r,a.sheetIndex),l=a.sheetIndex===r.activeSheetIndex,d=o[0];d<=o[2];d++)for(var h=o[1];h<=o[3];h++)!Y(r,s,{cell:{wrap:t},rowIdx:d,colIdx:h,preventEvt:n})&&l&&r.notify(an,{range:[d,h,d,h],wrap:t,sheet:s,initial:!0,isPublic:i});r.setProperties({sheets:r.sheets},!0)}function je(e){var t;if(e.indexOf("[")>-1){var r=e.split("[")[1].split("]")[0];["Black","Blue","Cyan","Green","Magenta","Red","White","Yellow"].indexOf(r)>-1&&(t=r)}return t}function _e(){return["Black","Blue","Cyan","Green","Magenta","Red","White","Yellow"]}function qe(e,t,r,n){var i;if(e.includes('"')){var a,o,s=e.split(";");s.forEach(function(e,t){for(var r=0;r<e.length;r++)if('"'===e[r]&&"\\"!==e[r-1]){a=r;do{a=e.indexOf('"',a+1),o=e[a-1]}while("\\"===o||"_"===o||"*"===o);if(-1===a)break;e=e.substring(0,r)+e.substring(a+1),r--}s[t]=e}),e=s.join(";")}return!e.includes("d")&&!e.includes("y")||e.includes("#")||je(e)||(r&&(r.type="date"),n&&e.includes(" ")&&2===e.split(" ").length?e=e.split(" ")[1]:t=!1,i=!0),t&&(e.includes("h")||e.includes("m")||e.includes("s"))&&!e.includes("#")&&!je(e)&&(r&&(r.type=r.type||"",r.type+="time"),i=!0),i}function We(e){return void 0===e}function Ge(e){switch(e){case"dd-MMM-yyyy":case"dd MMM yyyy":e="medium";break;case"MMM yyyy":e="yMMM";break;case"MM/dd/yyyy":case"dd/MM/yyyy":case"dd/MM/yy":e="short";break;case"dddd MMMM dd yyyy":case"dd MMMM yyyy":e="long";break;case"d MMMM yyyy":e="yMMMd";break;case"yyyy":e="y";break;case"h:mm":e="Hm";break;case"h:mm tt":e="hm";break;case"h":e="H";break;case"h tt":e="h";break;case"dddd":e="E";break;case"h:mm:ss tt":e="hms";break;case"h:mm:ss":e="Hms";break;case"d":e="d";break;case"d dddd":e="Ed";break;case"M":e="M";break;case"Md":e="Md";break;case"MMM":e="MMM";break;case"ddd MMM d":e="MMMEd";break;case"MMM d":e="MMMd";break;case"M/yyyy":e="yM";break;case"ddd":e="E";break;default:e=""}return e}function Ye(t){var r=!1;for(var n in e.ExcelFileFormats)if(t.indexOf("."+n+"]")>-1){r=!0;break}return r}function Xe(e){for(var t=[],r=0;e>0&&r<9;){e--;var n="A".charCodeAt(0);t[r]=String.fromCharCode(e%26+n),e=parseInt((e/26).toString(),10),r++}for(var i=[],a=0;a<r;a++)i[r-a-1]=t[a];return i.join("")}function Ke(e){var t=e.split(" ").join("");if(!zi)switch(t){case"Currency":return"$#,##0.00";case"Accounting":return'_($* #,##0.00_);_($* (#,##0.00);_($* "-"??_);_(@_)';case"Time":return"h:mm:ss AM/PM";default:return"General"}var r=function(e,t){return Vi&&Vi.has(t)?Vi.get(t):e},n="General";switch(t){case"Number":n=r("0.00",2);break;case"Currency":n=zi.currency[0];break;case"Accounting":n=zi.accounting[2];break;case"ShortDate":n=r("m/d/yyyy",14);break;case"LongDate":n="dddd, mmmm dd, yyyy";break;case"Time":n=zi.time;break;case"Percentage":n=r("0.00%",10);break;case"Fraction":n=r("# ?/?",12);break;case"Scientific":n=r("0.00E+00",11);break;case"Text":n=r("@",49);break;case"CurrencyWithColorCode":n=zi.currency[5]}return n}function $e(e,t){var r="General";switch(e){case"0":case"0.00":case"#,##0":case"#,##0.00":r="Number";break;case"$#,##0.00":case"$#,##0":case"$#,##0_);[Red]($#,##0)":case"$#,##0.00_);($#,##0.00)":case"$#,##0_);($#,##0)":case"$#,##0.00_);[Red]($#,##0.00)":r="Currency";break;case'_($* #,##0.00_);_($* (#,##0.00);_($* "-"??_);_(@_)':case'_ $ * #,##0.00_ ;_ $ * -#,##0.00_ ;_ $ * "-"??_ ;_ @_ ':case'_($* #,##0_);_($* (#,##0);_($* "-"_);_(@_)':r="Accounting";break;case"mm-dd-yyyy":case"m/d/yyyy":case"dd/MM/yyyy":r="ShortDate";break;case"dddd, mmmm dd, yyyy":r="LongDate";break;case"h:mm:ss AM/PM":r="Time";break;case"0.00%":case"0%":r="Percentage";break;case"0.00E+00":r="Scientific";break;case"@":r="Text";break;default:if(e){if(!zi)break;if(e===zi.time?r="Time":zi.currency.indexOf(e)>-1?r="Currency":zi.accounting.indexOf(e)>-1?t&&(r="Accounting"):(e.includes("?/?")||["2","4","8","16"].indexOf(e.split("?/")[1])>-1)&&(r="Fraction"),Vi&&"General"===r&&t){var n=function(t){return t.some(function(t){return Vi.has(t)&&Vi.get(t)===e})};n([1,2,3,4])?r="Number":n([14])?r="ShortDate":n([9,10])?r="Percentage":n([11])?r="Scientific":n([49])&&(r="Text")}t=!1}}return t&&zi&&("Currency"===r&&"$#,##0.00"!==zi.currency[0]||"Accounting"===r&&'_($* #,##0.00_);_($* (#,##0.00);_($* "-"??_);_(@_)'!==zi.accounting[2])&&(r="General"),r}function Ze(e,t){var r={action:"parseToDefaultFormat",format:t};return e.notify(kn,r),r.format}function Je(e,t,r){void 0===r&&(r=!0),r&&Vi&&(Vi.clear(),Vi=null),t&&t.length&&(Vi||(Vi=new Map),t.forEach(function(e){Vi.set(e.id,e.code)})),e&&e.notify(kn,{action:"mapNumberFormatId"})}function Qe(e,t){return e.rows[t]}function et(e,t,r){e.rows[t]||(e.rows[t]={}),Object.keys(r).forEach(function(n){e.rows[t][""+n]=r[""+n]})}function tt(e,t){return e.rows[t]&&e.rows[t].hidden}function rt(e,t){return e.rows[t]&&e.rows[t].isFiltered}function nt(e,t,r,n){var i,a;if(e&&e.standardHeight&&(a=e.standardHeight),e&&e.rows&&e.rows[t]){if(!n&&e.rows[t].hidden)return 0;i=void 0===e.rows[t].height?void 0===a?20:a:e.rows[t].height}else i=void 0===a?20:a;if(r&&window.devicePixelRatio%1>0){var o=i*window.devicePixelRatio%1;return i+(o?(o>.5?1-o:-1*o)/window.devicePixelRatio:0)}return i}function it(e,t,r){e&&e.rows&&(e.rows[t]||(e.rows[t]={}),e.rows[t].height=r)}function at(e,t,r,n,i){void 0===r&&(r=t);var a,o=0;t>r&&(a=t,t=r,r=a);for(var s=t;s<=r;s++)o+=nt(e,s,n,i);return o}function ot(e,t){return e.columns?e.columns[t]||(e.columns[t]={}):(e.columns=[],e.columns[t]={}),e.columns[t]}function st(e,t,r){var n=ot(e,t);Object.keys(r).forEach(function(e){n[""+e]=r[""+e]})}function lt(e,t,r,n){var i;if(e&&e.columns&&e.columns[t]){if(!r&&e.columns[t].hidden)return 0;i=e.columns[t].width||e.columns[t].customWidth?e.columns[t].width:64}else i=64;if(n&&window.devicePixelRatio%1>0){var a=i*window.devicePixelRatio%1;return i+(a?(a>.5?1-a:-1*a)/window.devicePixelRatio:0)}return i}function dt(e,t,r,n){void 0===r&&(r=t);var i=0;if(t>r){var a=t;t=r,r=a}for(var o=t;o<=r;o++)i+=lt(e,o,null,n);return i}function ht(e,t){return e.columns[t]&&e.columns[t].hidden}function pt(e,t,r){return e&&e.validation&&(!e.validation.address||M(e.validation.address,t,r))}function ct(e){var t=[];return ut(e,t),N(e,t),t}function ut(e,t){e.showRibbon&&t.push({member:"ribbon",args:[e]}),e.showFormulaBar&&t.push({member:"formulaBar",args:[e]}),e.showSheetTabs&&t.push({member:"sheetTabs",args:[e]}),e.allowEditing&&(t.push({member:"edit",args:[e]}),t.push({member:"formula",args:[e]})),e.allowOpen&&t.push({member:"open",args:[e]}),e.allowSave&&t.push({member:"save",args:[e]}),e.enableContextMenu&&t.push({member:"contextMenu",args:[e]}),e.allowAutoFill&&t.push({member:"autofill",args:[e]}),"None"!==e.selectionSettings.mode&&t.push({member:"selection",args:[e]}),e.enableKeyboardNavigation&&t.push({member:"keyboardNavigation",args:[e]}),e.allowNumberFormatting&&t.push({member:"numberFormat",args:[e]}),e.enableKeyboardShortcut&&t.push({member:"keyboardShortcut",args:[e]}),e.enableClipboard&&t.push({member:"clipboard",args:[e]}),e.allowCellFormatting&&t.push({member:"cellformat",args:[e]}),e.allowSorting&&t.push({member:"sort",args:[e]}),e.allowResizing&&t.push({member:"resize",args:[e]}),t.push({member:"protectSheet",args:[e]}),t.push({member:"workbookFormula",args:[e]}),t.push({member:"workbookEdit",args:[e]}),e.allowHyperlink&&t.push({member:"spreadsheetHyperlink",args:[e]}),e.enableNotes&&t.push({member:"spreadsheetNote",args:[e]}),e.allowUndoRedo&&t.push({member:"undoredo",args:[e]}),e.allowFiltering&&t.push({member:"filter",args:[e]}),e.allowWrap&&t.push({member:"wrapText",args:[e]}),e.allowInsert&&t.push({member:"insert",args:[e]}),e.allowDelete&&t.push({member:"delete",args:[e]}),e.allowDataValidation&&t.push({member:"dataValidation",args:[e]}),e.allowFindAndReplace&&t.push({member:"findAndReplace",args:[e]}),e.allowMerge&&t.push({member:"merge",args:[e]}),e.allowConditionalFormat&&t.push({member:"conditionalFormatting",args:[e]}),e.allowImage&&t.push({member:"spreadsheetImage",args:[e]}),e.allowChart&&t.push({member:"spreadsheetChart",args:[e]})}function ft(e){requestAnimationFrame(function(){e()})}function gt(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function mt(e){var t=30;return e.toString().length>3&&(t=10*e.toString().length),t}function vt(){if(null!==Da)return Da;var e=document.createElement("div"),t=0;return e.style.cssText="width:100px;height: 100px;overflow: scroll;position: absolute;top: -9999px;",document.body.appendChild(e),t=e.offsetWidth-e.clientWidth|0,document.body.removeChild(e),Da=t}function yt(e,t,r){return void 0===r&&(r=1),Ct(e,"previous",t=t||["e-ribbon","e-formula-bar-panel","e-sheet-tab-panel","e-header-toolbar"],r)+Ct(e,"next",t,r)}function Ct(e,t,r,n){for(var i=e[t+"ElementSibling"],a=0;i;)r.some(function(e){return i.classList.contains(e)})&&(a+=i.getBoundingClientRect().height*n),i=i[t+"ElementSibling"];return a}function bt(e,t,r){if(e.scrollSettings.enableVirtualization){var n=e.getActiveSheet(),i=e.frozenRowCount(n),a=e.frozenColCount(n),o=e.viewport.topIndex+i,s=e.viewport.leftIndex+a,l=e.viewport.bottomIndex,d=e.viewport.rightIndex;if(n.frozenRows||n.frozenColumns){if(e.insideViewport(t[0],t[1])||e.insideViewport(t[2],t[3]))return!0}else if(o<=t[0]&&l>=t[2]&&s<=t[1]&&d>=t[3])return!0;var h=!1;if(r){if(t[0]<o&&t[2]<o||t[0]>l&&t[2]>l)return!1;if(t[0]<o&&t[2]>o&&t[0]>=i&&(t[0]=o,h=!0),t[2]>l&&(t[2]=l,h=!0),t[1]<s&&t[3]<s||t[1]>d&&t[3]>d)return!1;t[1]<s&&t[3]>s&&t[1]>=a&&(t[1]=s,h=!0),t[3]>d&&(t[3]=d,h=!0)}return h}return!0}function xt(e,t,r,n,i,a,o,s){var l,d={left:{idx:0,size:0},top:{idx:0,size:0}},h=d.top.size,p=d.left.size;for(l=d.top.idx;l<t[0];l++)r&&r-1<t[0]&&l<r||(h+=nt(e,l,!s));for(l=d.left.idx;l<t[1];l++)n&&n-1<t[1]&&l<n||(p+=lt(e,l,null,!s));return r&&t[0]<r&&(e.showHeaders&&(h+=30),i&&(h-=i)),n&&t[1]<n&&(e.showHeaders&&(p+=o||30),a&&(p-=a)),{top:h,left:p}}function St(e,r,n,i,a,o,s){void 0===i&&(i="e-selection");var l=e.getActiveSheet();if(!l.frozenRows&&!l.frozenColumns){var d=It(e,r,n,l,e.enableRtl,0,0,a);return r&&!e.getMainContent().querySelector("."+i)&&e.getMainContent().appendChild(r),d}var h,p=e.frozenRowCount(l),c=e.frozenColCount(l);if("e-active-cell"===i)n[0]<p||n[1]<c?(r.style.display="none",(m=(h=n[0]<p&&n[1]<c?e.getSelectAllContent():n[0]<p?e.getColumnHeaderContent():e.getRowHeaderContent()).querySelector("."+i))||(m=r.cloneNode(!0),h.appendChild(m)),It(e,r=m,n,l,e.enableRtl,p,c,a,!0,e.viewport.beforeFreezeHeight,e.viewport.beforeFreezeWidth,e.sheetModule.colGroupWidth)):It(e,r,n,l,e.enableRtl,p,c,a),r.style.display&&(r.style.display=""),wt(e.getSelectAllContent(),h,"e-active-cell"),wt(e.getColumnHeaderContent(),h,"e-active-cell"),wt(e.getRowHeaderContent(),h,"e-active-cell");else if("e-autofill"===i){var u=void 0,f=e.frozenRowCount(l),g=e.frozenColCount(l);n[0]<f||n[1]<g?(r.style.display="none",(m=(u=n[0]<f&&n[1]<g?e.getSelectAllContent():n[0]<f?e.getColumnHeaderContent():e.getRowHeaderContent()).querySelector("."+i))||(m=r.cloneNode(!0),u.appendChild(m)),It(e,r=m,n,l,e.enableRtl,f,g,a,!0,e.viewport.beforeFreezeHeight,e.viewport.beforeFreezeWidth,e.sheetModule.colGroupWidth,"e-autofill")):It(e,r,n,l,e.enableRtl,f,g,a,!1,0,0,0,"e-autofill"),r.style.display&&(r.style.display=""),wt(e.getSelectAllContent(),u,"e-autofill"),wt(e.getColumnHeaderContent(),u,"e-autofill"),wt(e.getRowHeaderContent(),u,"e-autofill")}else if("e-filloption"===i){var u=void 0,f=e.frozenRowCount(l),g=e.frozenColCount(l);if(n[0]<f||n[1]<g)if(n[3]+1===g&&n[2]+1>f)It(e,e.getMainContent().querySelector(".e-filloption"),n,l,e.enableRtl,f,g,a,!1,0,0,0,"e-filloption",!0,{left:-4});else if(n[2]+1===f&&n[3]+1>g)It(e,e.getMainContent().querySelector(".e-filloption"),n,l,e.enableRtl,f,g,a,!1,0,0,0,"e-filloption",!0,{top:-4});else if(n[3]+1===g&&n[2]+1<f)(u=e.getColumnHeaderContent()).querySelector("."+i)||e.notify(Rn,{id:e.element.id+"_autofilloptionbtn",appendElem:u}),r=e.autofillModule.autoFillDropDown.element,It(e,r,n,l,e.enableRtl,f,g,a,!1,0,0,0,"e-filloption",!0,{left:-4});else if(n[2]+1===f&&n[3]+1===g)It(e,e.getMainContent().querySelector(".e-filloption"),n,l,e.enableRtl,f,g,a,!1,0,0,0,"e-filloption",!0,{top:-4,left:-4});else{var m=(u=n[0]<f&&n[1]<g?e.getSelectAllContent():n[0]<f?e.getColumnHeaderContent():e.getRowHeaderContent()).querySelector("."+i);m||e.notify(Rn,{id:e.element.id+"_autofilloptionbtn",appendElem:u}),r=e.autofillModule.autoFillDropDown.element,It(e,r,n,l,e.enableRtl,f,g,a,!0,e.viewport.beforeFreezeHeight,e.viewport.beforeFreezeWidth,e.sheetModule.colGroupWidth,"e-filloption",!0)}else It(e,e.getMainContent().querySelector(".e-filloption"),n,l,e.enableRtl,f,g,a,!1,0,0,0,"e-filloption",!0);r.style.display&&(r.style.display=""),wt(e.getSelectAllContent(),u,"e-filloption"),wt(e.getColumnHeaderContent(),u,"e-filloption"),wt(e.getRowHeaderContent(),u,"e-filloption")}else{var v=w(n);if(v[0]<p||v[1]<c){r&&!r.classList.contains("e-multi-range")&&r.classList.add("e-hide");var y=[];v[0]<p&&v[1]<c?v[2]<p&&v[3]<c?(y.push(n),o||(wt(e.getColumnHeaderContent(),h,i,!0),wt(e.getRowHeaderContent(),h,i,!0))):v[2]>p-1?v[3]<c?(o||wt(e.getColumnHeaderContent(),h,i,!0),y.push([v[0],v[1],p-1,v[3]]),y.push([p,v[1],v[2],v[3]])):(y.push([v[0],v[1],p-1,c-1]),y.push([p,v[1],v[2],c-1]),y.push([v[0],c,p-1,v[3]]),y.push([p,c,v[2],v[3]])):v[2]<p?(y.push([v[0],v[1],v[2],c-1]),y.push([v[0],c,v[2],v[3]]),o||wt(e.getRowHeaderContent(),h,i,!0)):(y.push([p,v[1],v[2],c-1]),y.push([v[0],v[1],p-1,c-1]),y.push([p,c,v[2],v[3]]),y.push([v[0],c,p-1,v[3]])):v[0]<p?v[2]<p?(y.push(n),o||wt(e.getRowHeaderContent(),h,i,!0)):(y.push([v[0],v[1],p-1,v[3]]),y.push([p,v[1],v[2],v[3]]),o||(wt(e.getSelectAllContent(),h,i,!0),wt(e.getRowHeaderContent(),h,i,!0))):v[3]<c?(y.push(n),o||wt(e.getSelectAllContent(),h,i,!0)):(y.push([v[0],v[1],v[2],c-1]),y.push([v[0],c,v[2],v[3]]),o||(wt(e.getSelectAllContent(),h,i,!0),wt(e.getColumnHeaderContent(),h,i,!0)));var C;y.forEach(function(n){var d;if(n[2]<p&&n[3]<c)h=e.getSelectAllContent();else{if(p||c){var u=e.getSelectAllContent();u&&(d=u.style.zIndex)}if(n[2]<p)h=e.getColumnHeaderContent();else if(n[3]<c)h=e.getRowHeaderContent();else{if(h=e.getMainContent(),p&&!d){var f=e.getColumnHeaderContent();f&&(d=f.style.zIndex)}if(c&&!d){var g=e.getRowHeaderContent();g&&(d=g.style.zIndex)}}}var m;"e-copy-indicator"===i||"e-range-indicator"===i?(m=r.cloneNode(!0),h.appendChild(m),p&&(n[2]+1===p&&y.forEach(function(e){e!==n&&(C=m.getElementsByClassName("e-bottom")[0])&&e[0]===p&&t.detach(C)}),n[0]===p&&h.parentElement.classList.contains("e-main-panel")&&y.forEach(function(e){e!==n&&(C=m.getElementsByClassName("e-top")[0])&&e[2]+1===p&&t.detach(C)})),c&&(n[3]+1===c&&y.forEach(function(e){e!==n&&(C=m.getElementsByClassName("e-right")[0])&&e[1]===c&&t.detach(C)}),n[1]===c&&(h.classList.contains("e-sheet-content")||h.classList.contains("e-column-header"))&&y.forEach(function(e){e!==n&&(C=m.getElementsByClassName("e-left")[0])&&e[3]+1===c&&t.detach(C)}))):((m=h.querySelector("."+i))||(m=r.cloneNode(!0),o&&!m.classList.contains("e-multi-range")&&m.classList.add("e-multi-range"),h.appendChild(m)),s&&m.classList.remove(i)),(p||c)&&(d?m.style.zIndex=d:m.style.zIndex&&(m.style.zIndex="")),It(e,m,n,l,e.enableRtl,p,c,a,!1,e.viewport.beforeFreezeHeight,e.viewport.beforeFreezeWidth,e.sheetModule.colGroupWidth),m.classList.contains("e-hide")&&m.classList.remove("e-hide")})}else o||(wt(e.getSelectAllContent(),null,i,!0),wt(e.getColumnHeaderContent(),null,i,!0),wt(e.getRowHeaderContent(),null,i,!0)),It(e,r,n,l,e.enableRtl,p,c,a),"e-range-indicator"!==i&&e.getMainContent().querySelector("."+i)||e.getMainContent().appendChild(r),r.classList.contains("e-hide")&&r.classList.remove("e-hide"),s&&r.classList.remove(i)}}function wt(e,r,n,i,a){if(i||e!==r)if(a)for(var o=e.querySelectorAll("."+n),s=0;s<o.length;)o[s].classList.remove(n),s++;else{var l=e.querySelector("."+n);l&&!l.classList.contains("e-multi-range")&&t.detach(l)}}function It(e,r,n,i,a,o,s,l,d,h,p,c,u,f,g){var m,v,y=w(n),C=xt(i,y,o,s,h,p,c),b=[j(i,0,!0),j(i,0,!0,"columns")];e.scrollSettings.isFinite?(m=y[0]>=i.rowCount?0:at(i,y[0],y[2]<i.rowCount?y[2]:i.rowCount-1,!0),v=y[1]>=i.colCount?0:dt(i,y[1],y[3]<i.colCount?y[3]:i.colCount-1,!0)):(m=at(i,y[0],y[2],!0),v=dt(i,y[1],y[3],!0));var x=0===y[1]&&y[3]===i.colCount-1,S=0===y[0]&&y[2]===i.rowCount-1,I=0,E=-5,R=-5,N=0,F=6,A=6;if(t.isNullOrUndefined(u)){if((k={top:(y[0]===b[0]?C.top:C.top-Vt(1))+"px",height:m&&m+(y[0]===b[0]?0:Vt(1))+"px",width:v&&v+(y[1]===b[1]?0:Vt(1))+(d&&s&&y[1]<s&&y[3]>=s?1:0)+"px"})[a?"right":"left"]=(y[1]===b[1]?C.left:C.left-1)+"px",r)return Et([{element:r,attrs:k}],l)}else{x&&(E=-5,R=-2,F=6,A=3),S&&(R=-5,E=0,F=1,A=6),S||(I+=m),x||(N+=v),I+=Math.round(C.top)+E,N+=Math.round(C.left)+R;var k={};f?(t.removeClass([r],"e-hide"),I=g&&g.top?g.top:I,N=g&&g.left?g.left:N,(k={top:I+F+"px"})[a?"right":"left"]=N+A+"px",r&&Et([{element:r,attrs:k}],l)):((k={top:I+"px"})[a?"right":"left"]=N+"px",r&&Et([{element:r,attrs:k}],l))}}function Et(e,r){return new Promise(function(n){var i=function(){e.forEach(function(e){t.setStyleAttribute(e.element,e.attrs),n()})};r?i():requestAnimationFrame(function(){return i()})})}function Rt(){return t.Browser.isPointer?"pointerdown":"mousedown touchstart"}function Nt(){return t.Browser.isPointer?"pointermove":"mousemove touchmove"}function Ft(){return t.Browser.isPointer?"pointerup":"mouseup touchend"}function At(e){return"touchstart"===e.type||"pointerdown"===e.type&&"touch"===e.pointerType}function kt(e){return"touchmove"===e.type||"pointermove"===e.type&&"touch"===e.pointerType}function Ot(e){return"touchend"===e.type||"pointerup"===e.type&&"touch"===e.pointerType}function Tt(e){return e&&("mousedown"===e.type||"pointerdown"===e.type)}function Dt(e){return e&&("mousemove"===e.type||"pointermove"===e.type)}function Lt(e){return e&&("mouseup"===e.type||"pointerup"===e.type)}function Pt(e){return e===Oa.UP||e===Oa.DOWN||e===Oa.LEFT||e===Oa.RIGHT}function Mt(e){return e.changedTouches?e.changedTouches[0].clientX:e.clientX}function Bt(e){return e.changedTouches?e.changedTouches[0].clientY:e.clientY}function Ht(e){return e.changedTouches?e.changedTouches[0].pageX:e.pageX}function Ut(e){return e.changedTouches?e.changedTouches[0].pageY:e.pageY}function Vt(e,t){if(window.devicePixelRatio%1>0){var r=e*window.devicePixelRatio%1;return e+(r?(r>.5||t?1-r:-1*r)/window.devicePixelRatio:0)}return e}function zt(e,t){Object.keys(t).forEach(function(r){e&&e.setAttribute(Pa[""+r],t[""+r])})}function jt(e,r){if(e){var n=t.getComponent(e,r);n&&n.destroy()}}function _t(e,t,r,n,i){var a,o,s,l,d,h,p,c,u,f=i.getActiveSheet(),g=i.frozenRowCount(f),m=i.frozenColCount(f);if(n){var v=e<m?i.getSelectAllContent():i.getColumnHeaderContent();a=v.getElementsByTagName("th")[t],o=v.getElementsByTagName("col")[t],s=(e<m?i.getRowHeaderContent():i.getMainContent()).getElementsByTagName("col")[t]}else{a=o=g||m?i.getRow(e,null,m-1):i.getRow(e,i.getRowHeaderTable()),o.style.height=parseInt(r,10)>0?Vt(parseInt(r,10))+"px":"2px",(s=i.getRow(e,null,m)).style.height=parseInt(r,10)>0?Vt(parseInt(r,10))+"px":"0px";var y=void 0;if(f.showHeaders){var C=i.getRowHeaderContent().getElementsByClassName("e-row"),b=[];b[0]=C[t].getElementsByTagName("td")[0].cloneNode(!0),y=Gt(i.getRowHeaderTable(),b,!1,i)+1}for(var x=i.getMainContent().getElementsByClassName("e-row"),S=[],w=0,I=0,E=e,R=0;R<x[t].getElementsByTagName("td").length;R++){var N=x[t].getElementsByTagName("td")[R];S[R]=N.cloneNode(!0);var F=He(E,R,f,!1,!0);if(w=F.value?$t(i,F.style):w,I=I<w?w:I,N.getElementsByClassName("e-cf-databar")[0]){var A=Number(s.style.height.split("px")[0]);i.notify(Cn,{indexes:[E,R],cell:F,ele:N,isRender:!0,resizedRowHeight:A})}}var k=I+1,O=y>=k?y:k;parseInt(s.style.height,10)<O||a&&a.classList.contains("e-reach-fntsize")&&parseInt(s.style.height,10)===O?(f.showHeaders&&(a.classList.add("e-reach-fntsize"),o.style.lineHeight=parseInt(r,10)>=4?parseInt(r,10)-4+"px":parseInt(r,10)>0?parseInt(r,10)-1+"px":"0px"),s.style.lineHeight=parseInt(r,10)>0?parseInt(r,10)-1+"px":"0px"):(o&&o.style.removeProperty("line-height"),s.style.removeProperty("line-height"),a&&a.classList.contains("e-reach-fntsize")&&a.classList.remove("e-reach-fntsize"))}if(h=s.previousElementSibling,u=s.nextElementSibling,h&&(f.showHeaders&&(l=a.previousElementSibling,d=o.previousElementSibling),h=s.previousElementSibling),u&&(f.showHeaders&&(p=a.nextElementSibling,c=o.nextElementSibling),u=s.nextElementSibling),parseInt(r,10)<=0&&!s.classList.contains("e-zero")&&!s.classList.contains("e-zero-start")){if(h&&u)if(n?(f.showHeaders&&(o.style.width="2px"),s.style.width="0px"):(f.showHeaders&&(o.style.height="2px"),s.style.height="0px"),h.classList.contains("e-zero-start")?(f.showHeaders&&a.classList.add("e-zero-start"),s.classList.add("e-zero-start")):(f.showHeaders&&a.classList.add("e-zero"),s.classList.add("e-zero")),!p||p.classList.contains("e-zero")||p.classList.contains("e-zero-last")||(f.showHeaders&&a.classList.add("e-zero-last"),s.classList.add("e-zero-last")),h.classList.contains("e-zero-last")&&(f.showHeaders&&l.classList.remove("e-zero-last"),h.classList.remove("e-zero-last")),f.showHeaders&&l.classList.contains("e-zero")?(a.classList.contains("e-zero-end"),qt(d,-2,n)):f.showHeaders&&qt(d,-1,n),f.showHeaders&&l.classList.contains("e-zero-start")&&qt(o,-1,n),f.showHeaders&&p.classList.contains("e-zero"))if(a.classList.contains("e-zero-start"))for(;p;){if(p.classList.contains("e-zero")&&0!==parseInt(c.style.height,10)&&!n||0!==parseInt(c.style.width,10)&&n){n?(o.style.width=parseInt(o.style.width,10)-1+"px",c.style.width=parseInt(c.style.width,10)-1+"px"):(o.style.height=parseInt(o.style.height,10)-1+"px",c.style.height=parseInt(c.style.height,10)-1+"px"),p.classList.remove("e-zero"),p.classList.add("e-zero-start");break}T=void 0;p.classList.remove("e-zero"),p.classList.add("e-zero-start"),n?(T=parseInt(p.getAttribute("aria-colindex"),10)-1,p=i.getColHeaderTable().getElementsByTagName("th")[T+1],c=i.getColHeaderTable().getElementsByTagName("col")[T+1]):(T=parseInt(p.getAttribute("aria-rowindex"),10)-1,p=i.getRowHeaderTable().getElementsByTagName("tr")[T+1],c=i.getRowHeaderTable().getElementsByTagName("tr")[T+1])}else qt(o,-2,n);else f.showHeaders&&(p.classList.contains("e-zero-end")?n?o.style.width="0px":o.style.height="0px":qt(c,-1,n));else if(h)n?(f.showHeaders&&(o.style.width="1px"),s.style.width="0px"):(f.showHeaders&&(o.style.height="1px"),s.style.height="0px"),f.showHeaders&&a.classList.add("e-zero-end"),s.classList.add("e-zero-end"),f.showHeaders&&a.classList.add("e-zero-last"),s.classList.add("e-zero-last"),f.showHeaders&&l.classList.contains("e-zero")?qt(d,-2,n):qt(d,-1,n);else if(p)if(a.classList.add("e-zero-start"),s.classList.add("e-zero-start"),p.classList.contains("e-zero")||(a.classList.add("e-zero-last"),s.classList.add("e-zero-last")),n?(o.style.width="1px",s.style.width="0px"):(o.style.height="1px",s.style.height="0px"),f.showHeaders&&p.classList.contains("e-zero"))for(;p;){if(p.classList.contains("e-zero")&&0!==parseInt(c.style.width,10)&&n||0!==parseInt(c.style.height,10)&&!n){n?(c.style.width=parseInt(c.style.width,10)-1+"px",o.style.width=parseInt(o.style.width,10)-1+"px"):(c.style.height=parseInt(c.style.height,10)-1+"px",o.style.height=parseInt(o.style.height,10)-1+"px"),p.classList.add("e-zero-start"),p.classList.remove("e-zero");break}var T=void 0;p.classList.add("e-zero-start"),p.classList.remove("e-zero"),n?(T=parseInt(p.getAttribute("aria-colindex"),10)-1,c=i.getColHeaderTable().getElementsByTagName("col")[T+1],p=i.getColHeaderTable().getElementsByTagName("th")[T+1]):(T=parseInt(p.getAttribute("aria-rowindex"),10)-1,c=i.getRowHeaderTable().getElementsByTagName("tr")[T+1],p=i.getRowHeaderTable().getElementsByTagName("tr")[T+1])}else f.showHeaders&&qt(c,-1,n)}else if(parseInt(r,10)>0){var D=Vt(parseInt(r,10))+"px";n?(o.style.width=D,s.style.width=D):(o.style.height=D,s.style.height=D),f.showHeaders&&l&&p?(l.classList.contains("e-zero")?a.classList.contains("e-zero")?n?(d.style.width=parseInt(d.style.width,10)+2+"px",o.style.width=parseInt(o.style.width,10)-1+"px"):(d.style.height=parseInt(d.style.height,10)+2+"px",o.style.height=parseInt(o.style.height,10)-1+"px"):qt(o,-1,n):a.classList.contains("e-zero")?qt(d,1,n):a.classList.contains("e-zero-start")&&(n?(d.style.width=parseInt(d.style.width,10)+1+"px",o.style.width=parseInt(o.style.width,10)-1+"px"):(d.style.height=parseInt(d.style.height,10)+1+"px",o.style.height=parseInt(o.style.height,10)-1+"px")),p.classList.contains("e-zero")?qt(o,-1,n):(a.classList.contains("e-zero")||a.classList.contains("e-zero-start"))&&qt(c,1,n),a.classList.contains("e-zero")&&a.classList.remove("e-zero"),a.classList.contains("e-zero-start")&&a.classList.remove("e-zero-start"),s.classList.contains("e-zero")&&s.classList.remove("e-zero"),s.classList.contains("e-zero-start")&&s.classList.remove("e-zero-start"),a.classList.contains("e-zero-last")&&a.classList.remove("e-zero-last"),s.classList.contains("e-zero-last")&&s.classList.remove("e-zero-last"),(l.classList.contains("e-zero")||l.classList.contains("e-zero-start"))&&(l.classList.add("e-zero-last"),h.classList.add("e-zero-last"))):f.showHeaders&&l?(l.classList.contains("e-zero")?a.classList.contains("e-zero")?n?(o.style.width=parseInt(o.style.width,10)-1+"px",d.style.width=parseInt(d.style.width,10)+2+"px"):(o.style.height=parseInt(o.style.height,10)-1+"px",d.style.height=parseInt(d.style.height,10)+2+"px"):qt(o,-1,n):a.classList.contains("e-zero")?qt(d,1,n):qt(o,-1,n),a.classList.contains("e-zero")&&a.classList.remove("e-zero"),a.classList.contains("e-zero-end")&&a.classList.remove("e-zero-end"),s.classList.contains("e-zero")&&s.classList.remove("e-zero"),s.classList.contains("e-zero-end")&&s.classList.remove("e-zero-end")):f.showHeaders&&p&&(p.classList.contains("e-zero")?qt(o,-1,n):a.classList.contains("e-zero-start")&&(qt(c,1,n),a.classList.remove("e-zero-start")),a.classList.contains("e-zero")&&a.classList.remove("e-zero"),s.classList.contains("e-zero")&&s.classList.remove("e-zero"),a.classList.contains("e-zero-start")&&a.classList.remove("e-zero-start"),s.classList.contains("e-zero-start")&&s.classList.remove("e-zero-start"))}}function qt(e,t,r){r?e.style.width=parseInt(e.style.width,10)+t+"px":e.style.height=parseInt(e.style.height,10)+t+"px"}function Wt(e){La=e}function Gt(e,t,r,n,i,a){var o=n.createElement("div",{className:n.element.className,styles:"display: block"}),s=n.createElement("table",{className:e.className+"e-resizetable",styles:"width: auto;height: auto"}),l=n.createElement("tr");r?t.forEach(function(e){var t=l.cloneNode();t.appendChild(e),s.appendChild(t)}):(t.forEach(function(e){l.appendChild(e.cloneNode(!0))}),s.appendChild(l)),o.appendChild(s),document.body.appendChild(o);var d,h,p=s.getBoundingClientRect().width,c=s.getBoundingClientRect().height;return a?(d=r&&parseInt(i,10)>p?p:parseInt(i,10),h=!r&&parseInt(i,10)>c?c:parseInt(i,10)):(h=c,d=p),document.body.removeChild(o),r?Math.ceil(d):Math.ceil(h)}function Yt(e,r,n,i,a,o){var s,l,d,h,p,c,u,f,g,m,v,C,b=e.eventArgs,w=e.isFromUpdateAction||t.isUndefined(n);if(e.isUndoRedo)return w=e.isFromUpdateAction=!0,delete e.isUndoRedo,void r.notify(hi,e);if(w&&!o){var I=b.address||b.range||b.pastedRange||b.addressCollection&&b.addressCollection[0]||b.dataRange,E=t.isUndefined(b.sheetIndex)?t.isUndefined(b.sheetIdx)?t.isUndefined(b.activeSheetIndex)?I?S(r,I):r.activeSheetIndex:b.activeSheetIndex:b.sheetIdx:b.sheetIndex;if(E!==r.activeSheetIndex){var R={sheet:Ae(r,E),resolveAfterFullDataLoaded:!0,indexes:[0,0,0,0],promise:new Promise(function(e){e(void 0)})};return r.notify(_r,R),void R.promise.then(function(){Yt(e,r,n,i,a,!0)})}}var N,F,A,k,O=we(r,b.index);switch(e.action){case"sorting":h={args:{range:e.eventArgs.range,sortOptions:e.eventArgs.sortOptions,cancel:!1},promise:d=new Promise(function(e){e(void 0)})},r.notify(rn,h),h.promise.then(function(e){r.serviceLocator.getService("cell").refreshRange(y(e.range))});break;case"cellSave":c=(N={element:(p=e.eventArgs).element,value:p.value,oldValue:p.oldValue,address:p.address,displayText:p.displayText,formula:p.formula,originalEvent:p.originalEvent,format:p.format}).formula?{formula:N.formula}:{value:N.value},r.updateCellInfo(c,N.address,!1,e.eventArgs,n),!0===n&&r.trigger("cellSave",N);break;case"addNote":case"editNote":case"deleteNote":k=y(e.eventArgs.address),n&&(Y(r,r.getActiveSheet(),{rowIdx:k[0],colIdx:k[1],preventEvt:!0,cell:{notes:e.eventArgs.notes}}),r.serviceLocator.getService("cell").refreshRange(y(b.address),!1,!1,!0,!0,re(r)));break;case"cellDelete":F=x(r,e.eventArgs.address),dr(r,F.indices,F.sheetIndex);break;case"format":if("CellFormat"===b.requestType){if(b.style&&b.style.border&&!t.isNullOrUndefined(b.borderType)){var T={};Object.assign(T,b.style,null,!0),b.style.border=void 0,r.notify(Yr,{style:b.style,refreshRibbon:!0,range:b.range,onActionUpdate:!0,isUndoRedo:!0}),b.style.border=T.border,r.setBorder(b.style,b.range,b.borderType),b.style=T}else r.notify(Yr,{style:b.style,refreshRibbon:!0,range:b.range,onActionUpdate:!0,isUndoRedo:!0});ft(function(){return r.selectRange(r.getActiveSheet().selectedRange)})}else r.numberFormat(b.format,b.range);break;case"clipboard":u=new Promise(function(e){e(void 0)}),C=r.getAddressInfo(b.copiedRange),r.notify(b.copiedInfo.isCut?Qn:ei,{range:C.indices,sId:Ae(r,C.sheetIndex).id,promise:d,invokeCopy:!0,isPublic:!0,isFromUpdateAction:!0}),u.then(function(){return r.notify(ti,{range:y(b.pastedRange),sIdx:Se(r,Ie(b.pastedRange)),type:b.type,isAction:!1,isInternal:!0,isFromUpdateAction:!0})});break;case"gridLines":r.setSheetPropertyOnMute(r.sheets[b.sheetIdx],"showGridLines",b.isShow),r.serviceLocator.getService("sheet").toggleGridlines(),r.notify(Sn,null);break;case"headers":r.setSheetPropertyOnMute(r.sheets[b.sheetIdx],"showHeaders",b.isShow),r.serviceLocator.getService("sheet").showHideHeaders(),r.notify(Sn,null);break;case"resize":case"resizeToFit":w&&(m=ot(g=r.sheets[b.sheetIndex],b.index),v=Qe(g,b.index),(b.isCol&&m&&m.hidden||v&&v.hidden)&&r.notify(vn,{startIndex:b.index,endIndex:b.index,hide:!1,isCol:b.isCol,sheetIndex:b.sheetIndex})),b.isCol?void 0===b.hide?r.setColWidth(w&&!t.isUndefined(n)?b.oldWidth:b.width,b.index,b.sheetIndex):r.hideColumn(b.index,b.index,b.hide):(void 0===b.hide?r.setRowHeight(w&&!t.isUndefined(n)?b.oldHeight:b.height,b.index,b.sheetIndex):r.hideRow(b.index,b.index,b.hide),r.notify(oi,{rowIndex:b.index}));break;case"renameSheet":r.setSheetPropertyOnMute(r.sheets[O],"name",b.value),r.notify(li,{items:r.element.querySelector(".e-sheet-tabs-items"),value:b.value,idx:O});break;case"hideSheet":r.notify(di,{sheetIndex:b.sheetIndex});break;case"showSheet":r.notify(xi,b);break;case"removeSheet":r.notify(Jn,{index:b.index,isAction:!0,count:b.sheetCount,clicked:!0});break;case"gotoSheet":r.notify(bi,{selectedIndex:b.currentSheetIndex,previousIndex:b.previousSheetIndex});break;case"moveSheet":Pe(r,b.position,b.sheetIndexes,null,w);break;case"wrap":ze(e.eventArgs.address,e.eventArgs.wrap,r);break;case"hideShow":b.isCol?r.notify(vn,{startIndex:b.startIndex,endIndex:b.endIndex,isCol:!0,hide:!1===n?!b.hide:b.hide,sheetIndex:b.sheetIndex,hiddenIndexes:b.hiddenIndexes}):r.notify(vn,{startIndex:b.startIndex,endIndex:b.endIndex,hide:!1===n?!b.hide:b.hide,sheetIndex:b.sheetIndex});break;case"replace":r.notify(hn,{value:b.compareValue,replaceValue:b.replaceValue,sheetIndex:b.sheetIndex,address:b.address});break;case"replaceAll":r.notify(pn,b);break;case"filter":d=new Promise(function(e){e(void 0)}),!1===n?r.notify(pi,{predicates:b.previousPredicates,range:b.range,sIdx:b.sheetIndex,promise:d,isInternal:!0}):r.notify(pi,{predicates:b.predicates,range:b.range,sIdx:b.sheetIndex,promise:d,isInternal:!0,useFilterRange:b.useFilterRange,allowHeaderFilter:b.allowHeaderFilter}),a&&!w&&d.then(function(){r.notify(ci,t.extend({isUndo:!n,isUndoRedo:!w},a))});break;case"insert":if("Sheet"===e.eventArgs.modelType)g=r;else if(!(g=Ae(r,e.eventArgs.activeSheetIndex)))break;!1===n?r.notify(sn,{model:g,start:e.eventArgs.index,isUndoRedo:!0,end:e.eventArgs.index+(e.eventArgs.model.length-1),modelType:e.eventArgs.modelType}):r.notify(on,{model:g,start:e.eventArgs.index,end:e.eventArgs.index+(e.eventArgs.model.length-1),modelType:e.eventArgs.modelType,checkCount:void 0===n?e.eventArgs.sheetCount:null,activeSheetIndex:e.eventArgs.activeSheetIndex,isUndoRedo:!0,insertType:e.eventArgs.insertType,isFromUpdateAction:w,isRedo:n});break;case"delete":if("Sheet"===e.eventArgs.modelType)g=r;else if(!(g=Ae(r,e.eventArgs.activeSheetIndex)))break;!1===n?r.notify(on,{model:g,start:e.eventArgs.deletedModel,modelType:e.eventArgs.modelType,columnCellsModel:e.eventArgs.deletedCellsModel,definedNames:e.eventArgs.definedNames,activeSheetIndex:e.eventArgs.activeSheetIndex,isUndoRedo:!0,insertType:"Row"===e.eventArgs.modelType?"above":"before",conditionalFormats:e.eventArgs.conditionalFormats,prevAction:e.action,freezePane:b.freezePane}):r.notify(sn,{model:g,start:e.eventArgs.startIndex,checkCount:e.eventArgs.sheetCount,end:e.eventArgs.endIndex,modelType:e.eventArgs.modelType,isUndoRedo:!0,insertType:"Row"===e.eventArgs.modelType?"above":"before"});break;case"validation":!1===n?r.notify(Ci,{range:b.range}):r.notify(ln,{rules:{type:b.type,operator:b.operator,value1:b.value1,value2:b.value2,ignoreBlank:b.ignoreBlank,inCellDropDown:b.inCellDropDown},range:b.range,isAction:!0});break;case"removeHighlight":case"addHighlight":r.notify(ui,{isRemoveHighlight:"removeHighlight"===e.action,isPublic:!0});break;case"merge":e.eventArgs.isAction=!1,f=[];for(var D=0,L=b.model.length;D<L;D++){f.push({cells:[]});for(var P=0,M=b.model[D].cells.length;P<M;P++)f[D].cells[P]={},Object.assign(f[D].cells[P],b.model[D].cells[P])}if(!1===n&&b.mergeCollection)for(var B=void 0,H=0;H<b.mergeCollection.length;H++)B={range:null},Object.assign(B,b),B.range=b.mergeCollection[H],r.notify(gn,B);else r.notify(gn,e.eventArgs);if("Manual"===r.calculationMode&&n&&r.getActiveSheet().isSheetCalculated)for(H=0;H<b.model.length;H++)for(var U=b.model[H].cells,V=0;V<U.length;V++){var z=b.model[H].cells[V].value;f[H].cells[V].value=t.isNullOrUndefined(z)||""===z?f[H].cells[V].value:z}b.model=f;break;case"clear":A={options:e.eventArgs,isFromUpdateAction:w},r.notify(Si,A),!w&&A.cfClearActionArgs&&(b.cfClearActionArgs.previousConditionalFormats=A.cfClearActionArgs.previousConditionalFormats,b.cfClearActionArgs.conditionalFormats=A.cfClearActionArgs.conditionalFormats);break;case"conditionalFormat":!1===n?r.notify(bn,{range:b.range,cfModel:{type:b.type,cFColor:b.cFColor,value:b.value},sheetIdx:b.sheetIdx,isUndoRedo:!b.cancel,isFromUpdateAction:w}):r.notify(yn,{cfModel:{type:b.type,cFColor:b.cFColor,value:b.value,range:b.range},sheetIdx:b.sheetIdx,isUndoRedo:!0,isFromUpdateAction:w});break;case"clearCF":if(!1===n)r.notify(bn,{oldCFModel:b.previousConditionalFormats,updatedCFModel:b.conditionalFormats,range:b.selectedRange,isUndo:!0,sheetIdx:b.sheetIdx});else{var j={range:b.selectedRange,sheetIdx:b.sheetIdx,isUndoRedo:!0,isFromUpdateAction:w};r.notify(bn,j),w||(b.previousConditionalFormats=j.oldCFModel,j.updatedCFModel.length?b.conditionalFormats=j.updatedCFModel:delete b.conditionalFormats)}break;case"insertImage":!1===n?r.notify(Fi,{id:e.eventArgs.id,sheetIdx:e.eventArgs.sheetIndex+1,range:e.eventArgs.range,preventEventTrigger:!0}):r.notify(Ni,{options:{src:e.eventArgs.imageData,height:e.eventArgs.imageHeight,width:e.eventArgs.imageWidth,id:e.eventArgs.id},range:e.eventArgs.range,isPublic:!1,isUndoRedo:!0});break;case"deleteImage":!1===n?r.notify(Ni,{options:{src:e.eventArgs.imageData,height:e.eventArgs.imageHeight,width:e.eventArgs.imageWidth,id:e.eventArgs.id},range:e.eventArgs.address,isPublic:!1,isUndoRedo:!0}):r.notify(Fi,{id:e.eventArgs.id,range:e.eventArgs.address,preventEventTrigger:!0});break;case"imageRefresh":l=document.getElementById(e.eventArgs.id),!1===n?r.notify(Ii,{prevTop:e.eventArgs.currentTop,prevLeft:e.eventArgs.currentLeft,currentTop:e.eventArgs.prevTop,currentLeft:e.eventArgs.prevLeft,id:e.eventArgs.id,currentHeight:e.eventArgs.prevHeight,currentWidth:e.eventArgs.prevWidth,requestType:"imageRefresh",prevHeight:e.eventArgs.currentHeight,prevWidth:e.eventArgs.currentWidth,isUndoRedo:!0}):(e.eventArgs.isUndoRedo=!0,r.notify(Ii,e.eventArgs)),l&&(l.style.height=!1===n?e.eventArgs.prevHeight+"px":e.eventArgs.currentHeight+"px",l.style.width=!1===n?e.eventArgs.prevWidth+"px":e.eventArgs.currentWidth+"px",l.style.top=!1===n?e.eventArgs.prevTop+"px":e.eventArgs.currentTop+"px",l.style.left=!1===n?e.eventArgs.prevLeft+"px":e.eventArgs.currentLeft+"px");break;case"insertChart":if(!1===n)r.notify(Ai,{id:b.id,range:b.posRange||b.range,isUndoRedo:!0});else{var _=[{type:b.type,theme:b.theme,markerSettings:b.markerSettings,isSeriesInRows:b.isSeriesInRows,range:b.range,id:b.id,height:b.height,width:b.width,top:b.top,left:b.left}];r.notify(xn,{chart:_,isUndoRedo:!1,range:b.posRange||b.range,isInitCell:!0,isRedo:!0})}break;case"deleteChart":if(!1===n){var q=[{type:b.type,theme:b.theme,markerSettings:b.markerSettings,dataLabelSettings:b.dataLabelSettings,title:b.title,legendSettings:b.legendSettings,primaryXAxis:b.primaryXAxis,primaryYAxis:b.primaryYAxis,isSeriesInRows:b.isSeriesInRows,range:b.range,id:b.id,height:b.height,width:b.width,top:b.top,left:b.left}];r.notify(xn,{chart:q,isUndoRedo:!1,range:b.posRange,isInitCell:!0,isUndo:!0})}else r.notify(Ai,{id:b.id,range:b.range,isUndoRedo:!0});break;case"chartRefresh":(s=document.getElementById(e.eventArgs.id))&&(s.style.height=!1===n?e.eventArgs.prevHeight+"px":e.eventArgs.currentHeight+"px",s.style.width=!1===n?e.eventArgs.prevWidth+"px":e.eventArgs.currentWidth+"px",s.style.top=!1===n?e.eventArgs.prevTop+"px":e.eventArgs.currentTop+"px",s.style.left=!1===n?e.eventArgs.prevLeft+"px":e.eventArgs.currentLeft+"px"),!1===n?(r.notify(ki,t.extend({},e.eventArgs,{currentColIdx:e.eventArgs.prevColIdx,currentHeight:e.eventArgs.prevHeight,currentLeft:e.eventArgs.prevLeft,currentRowIdx:e.eventArgs.prevRowIdx,currentTop:e.eventArgs.prevTop,currentWidth:e.eventArgs.prevWidth,prevColIdx:e.eventArgs.currentColIdx,prevHeight:e.eventArgs.currentHeight,prevLeft:e.eventArgs.currentLeft,prevRowIdx:e.eventArgs.currentRowIdx,prevTop:e.eventArgs.currentTop,prevWidth:e.eventArgs.currentWidth,isUndoRedo:!0})),r.notify(wn,{height:e.eventArgs.prevHeight.toString(),width:e.eventArgs.prevWidth.toString(),overlayEle:s})):(e.eventArgs.isUndoRedo=!0,r.notify(ki,e.eventArgs),r.notify(wn,{height:e.eventArgs.currentHeight.toString(),width:e.eventArgs.currentWidth.toString(),overlayEle:s}));break;case"chartDesign":r.notify(Oi,e.eventArgs);break;case"autofill":w&&b.undoArgs&&(b.undoArgs.isFromUpdateAction=b.undoArgs.isUndo=b.undoArgs.preventEvt=!0,b.undoArgs.isPublic=!0,r.notify(hi,b.undoArgs)),r.notify(En,{fillRange:e.eventArgs.fillRange,dataRange:e.eventArgs.dataRange,fillType:e.eventArgs.fillType,direction:e.eventArgs.direction,cells:e.eventArgs.beforeActionData});break;case"removeValidation":!1!==n&&r.notify(Ci,{range:b.range,isCol:b.isColSelected});break;case"addDefinedName":if(!1===n)r.notify(Kr,{action:"removeDefinedName",isRemoved:!1,definedName:b.name,scope:b.scope,isEventTrigger:!0});else{var W={name:b.name,refersTo:b.refersTo,scope:b.scope,comment:b.comment};r.notify(Kr,{action:"addDefinedName",isAdded:!1,definedName:W,isEventTrigger:!0})}break;case"hyperlink":r.notify(nn,{hyperlink:b.hyperlink,cell:b.address,displayText:b.displayText,isUndoRedo:!0}),r.serviceLocator.getService("cell").refreshRange(y(b.address),!1,!1,!1,!0,re(r));break;case"removeHyperlink":r.notify(si,{range:b.address,preventEventTrigger:!0});break;case"freezePanes":r.freezePanes(b.row,b.column,b.sheetIndex);break;case"duplicateSheet":Me(r,b.sheetIndex,null,w);break;case"protectSheet":b.isProtected?r.notify(un,b):(r.setSheetPropertyOnMute(Ae(r,b.sheetIndex),"password",""),r.notify(fi,{isActive:!0,sheetIndex:b.sheetIndex}));break;case"protectWorkbook":b.isProtected?r.notify(Ti,b):r.notify(Di,null);break;case"lockCells":r.notify(fn,b)}}function Xt(e,t,r,n){for(var i,a=e.sheets[n].ranges,o=0,s=a.length;o<s;o++)if(a[o].template&&(i=c(a[o].address.length?a[o].address:a[o].startCell))[0]<=t&&i[1]<=r&&i[2]>=t&&i[3]>=r)return!0;return!1}function Kt(e,t,r,n,i,a,o,s){void 0===o&&(o=!0);var l=nt(t,n,!0),d=Vt(r);if(!s){var h=e.frozenColCount(t);if((i=i||(t.frozenRows?e.getRow(n,null,h):e.getRow(n)))&&(i.style.height=d+"px"),t.frozenColumns)a=a||e.getRow(n,null,h-1);else{var p=e.frozenRowCount(t);a=a||e.getRow(n,n<p?e.sheetModule.getSelectAllTable():e.getRowHeaderTable())}a&&(a.style.height=d+"px")}it(t,n,r),e.setProperties({sheets:e.sheets},!0),o&&e.notify(ri,{rowIdx:n,threshold:d-l})}function $t(e,t,r,n){void 0===r&&(r=1);var i=t&&t.fontSize||e.cellStyle.fontSize,a=(i.indexOf("pt")>-1?parseInt(i,10)/.75:parseInt(i,10))*(n||Zt(t&&t.fontFamily?t:e.cellStyle))*r;return Math.ceil(a%1>.9?a+1:a)}function Zt(e){var t=La;return e&&("Arial Black"===e.fontFamily||"Comic Sans MS"===e.fontFamily?t=1.44:'"Segoe UI", sans-serif'===e.fontFamily&&(t=1.36)),t}function Jt(e,t,r,n){t||(t=r);var i=document.createElement("canvas").getContext("2d");return i.font=(t.fontStyle||r.fontStyle)+" "+(t.fontWeight||r.fontWeight)+" "+(t.fontSize||r.fontSize)+" "+(t.fontFamily||r.fontFamily),n?i.measureText(e).width:Vt(i.measureText(e).width,!0)}function Qt(e,t,r,n){var i,a,o,s,l,d,h=0,p=e.toString().split(" "),c=Jt(" ",r,n),u=0,f=0,g=0,m=function(e,a){h&&u++,i/t>=1&&(e.split("").forEach(function(e){s=Jt(e,r,n,!0),(o+=s)>t&&(u++,o=s)}),i=Vt(o,!0)),a||v(i),h=i},v=function(e){i+=(e+c)/t>=1?0:c};return p.forEach(function(e){if(o=0,s=0,i=Jt(e,r,n),(d=(h+i)/t)>1)if((a=e.split("-")).length>1){var c=a.length-1;a.forEach(function(a,u){o=0,s=0,l||(l=Jt("-",r,n)),i=Jt(a,r,n),u<c&&(i+=l),(d=(h+i)/t)>=1?m(a,u!==c):(u===c&&p[p.length-1]!==e&&v(h+i),h+=i)})}else m(e,!1);else v(h+i),h+=i}),h&&(f=(h-c)/t,g=parseFloat(f.toString().split(".")[0]),u+=f+.05>=g+1?Math.ceil(f)+1:Math.ceil(f)),u}function er(e,t,r){var n=0,i=He(e,t,r,null,!0),a=He(e,t+1,r,null,!0);return i.style&&(i.style.border?n=(0===t?2:1)*parseFloat(i.style.border.split("px")[0]):(0===t&&i.style.borderLeft&&(n=parseFloat(i.style.borderLeft.split("px")[0])),i.style.borderRight&&(n+=parseFloat(i.style.borderRight.split("px")[0])))),i.style&&(i.style.border||i.style.borderRight)||!a.style||!a.style.borderLeft||(n+=parseFloat(a.style.borderLeft.split("px")[0])),n>0&&n<1?1:n}function tr(e,t,r){var n=0,i=He(e,t,r,null,!0);i.style&&(i.style.border?n=(0===e?2:1)*parseFloat(i.style.border.split("px")[0]):(0===e&&i.style.borderTop&&(n=parseFloat(i.style.borderTop.split("px")[0])),i.style.borderBottom&&(n+=parseFloat(i.style.borderBottom.split("px")[0]))));var a=He(e+1,t,r,null,!0);return i.style&&(i.style.border||i.style.borderBottom)||!a.style||!a.style.borderTop||(n+=parseFloat(a.style.borderTop.split("px")[0])),Math.ceil(n)||1}function rr(e,t,r,n){return void 0===n&&(n=r),dt(e,r,n,!0)-Vt(4+(er(t,r,e)||1))}function nr(e,t,r,n,i,a,o){return $t(e,i,a,o)+tr(t,r,n)}function ir(e,t,r,n){e.maxHgts[t]||(e.maxHgts[t]={}),e.maxHgts[t][r]=n}function ar(e,t){var r=0,n=e.maxHgts[t];return n&&Object.keys(n).forEach(function(e){n[""+e]>r&&(r=n[""+e])}),r}function or(e){if(!document.activeElement.classList.contains("e-text-findNext-short"))if(t.Browser.isIE){var r=window.scrollX,n=window.scrollY;e.focus(),window.scrollTo(r,n)}else{if(e.classList.contains("e-input")){var i=e,a=i.value.length;i.setSelectionRange(a,a)}e.focus({preventScroll:!0})}}function sr(e,r){for(var n,i=e.getActiveSheet(),a=t.isNullOrUndefined(r)?w(c(i.selectedRange)):r,o=a[0];o<=a[2];o++)for(var s=a[1];s<=a[3];s++)if(U(He(o,s,i),ot(i,s))){n=!0;break}return n}function lr(e){return e.includes(" ")}function dr(e,r,n){for(var i,a,o,s,l,d,h=Ae(e,n),p=n===e.activeSheetIndex,c=h.conditionalFormats&&h.conditionalFormats.length&&[].slice.call(h.conditionalFormats),u=[],f=!1,g=r[0],m=r[2];g<=m;g++)if(!rt(h,g))for(var v=r[1],C=r[3];v<=C;v++){var b={cellIdx:[g,v],isUnique:!1,uniqueRange:""};if(e.notify(en,b),i=!1,""!==b.uniqueRange){var x=y(b.uniqueRange);i="#SPILL!"===He(x[0],x[1],h).value}var S=g===m&&v===C;if(!b.isUnique||i)if((a=He(g,v,h))&&0===a.value||a&&a.value&&(t.isNullOrUndefined(a.value)||""!==a.value)){f=!1,o={},a.formula&&(o.formula=""),(a.value||0===a.value)&&(o.value=""),a.hyperlink&&(o.hyperlink="");var w={sheet:h,cell:a,rowIdx:g,colIdx:v};if((a.colSpan>1||a.rowSpan>1)&&te(w),s=e.getCell(w.rowIdx,w.colIdx),l={cell:o,rowIdx:g,colIdx:v,valChange:!0,uiRefresh:p,td:s,cellDelete:!0,isDelete:!S,deletedRange:r},!Object.keys(o).length||Y(e,h,l))continue;c&&!d&&((d=l.isFormulaDependent)||Z(c,u,g,v)),s&&(s.querySelector(".e-cf-databar")&&s.removeChild(s.querySelector(".e-cf-databar")),s.querySelector(".e-iconsetspan")&&s.removeChild(s.querySelector(".e-iconsetspan")))}else if(!f&&l&&(f=S,l.isDelete=!S,!Object.keys(o).length||Y(e,h,l)))continue}(u.length||d)&&p&&e.notify(Cn,{cfModel:!d&&u,refreshAll:d,isAction:!0,isEdit:!0})}function hr(e,t){for(var r=0,n=e.getActiveSheet(),i=(n.frozenRows?e.viewport.height-e.sheetModule.getColHeaderHeight(n,!0):e.viewport.height)-17||20,a=t;;a++)if((r+=nt(n,a,!0))>=i)return{index:a,height:r}}function pr(e,t){for(var r=0,n=e.getActiveSheet(),i=e.getMainContent().parentElement.offsetWidth-e.sheetModule.getRowHeaderWidth(n)-e.sheetModule.getScrollSize(),a=t;;a++)if((r+=lt(n,a,null,!0))>=i)return a}function cr(e,t){e.renderModule.setSheetPanelSize(t)}function ur(e){if(window.devicePixelRatio%1>0){var t=e*window.devicePixelRatio%1;return e+(t?(t>.5?1-t:-1*t)/window.devicePixelRatio:0)}return e}function fr(e,t){var r=[];if(t){var n=Object.getPrototypeOf(new zn(e,"cells",{},!0)).constructor.prototype.propList,i=n.colPropNames.concat(n.complexPropNames).concat(n.propNames);i.push("formattedText");var a=(n=Object.getPrototypeOf(new wa(e,"rows",{},!0)).constructor.prototype.propList).colPropNames.concat(n.complexPropNames).concat(n.propNames),o=(n=Object.getPrototypeOf(new Ra(e,"columns",{},!0)).constructor.prototype.propList).colPropNames.concat(n.complexPropNames).concat(n.propNames),s=(n=Object.getPrototypeOf(new Hn(e,"sheets",{},!0)).constructor.prototype.propList).colPropNames.concat(n.complexPropNames).concat(n.propNames);s.splice(s.indexOf("rows"),1),s.splice(s.indexOf("columns"),1),s.splice(s.indexOf("cells"),1),a.splice(a.indexOf("cells"),1),r.push.apply(r,s),-1===t.indexOf("rows")&&r.push.apply(r,a),-1===t.indexOf("columns")&&r.push.apply(r,o),-1===t.indexOf("cells")&&r.push.apply(r,i);var l;t.forEach(function(e){l=r.indexOf(e),r.indexOf(e)>-1&&r.splice(l,1)})}else r.push("ranges");var d={skipProps:r};return e.notify("getStringifyObject",d),d.model}function gr(e){for(var t,r=[],n=e.getActiveSheet().name,i=0,a=e.chartColl.length;i<a;i++)if(t=e.chartColl[i],n===Ie(t.range)){var o={clientY:t.top,isImage:!0},s={clientX:t.left,isImage:!0};e.notify(Ei,o),e.notify(Ri,s),r.push({chart:t,chartRowIdx:o.clientY,chartColIdx:s.clientX})}return r}function mr(e){return/^[A-Za-z]+:[A-Za-z]+$/.test(e)}function vr(e){return/^[0-9]+:[0-9]+$/.test(e)}function yr(e,t,r){var n=e.sheets[t];n&&(n.standardHeight=r,e.dataBind())}function Cr(e,t){return e.sheets[t].standardHeight}function br(e){e.forEach(function(e){e&&e.parentNode&&e.parentNode.removeChild(e)})}var xr=function(){function e(e,t,r,n,i,a){this.preventCallback=!1,this.context=e,this.workerTask=t,this.defaultListener=r,this.workerData=n,this.parent=a,i&&(this.preventCallback=!0),this.initWorker()}return e.prototype.terminate=function(){this.worker.terminate(),URL.revokeObjectURL(this.workerUrl)},e.prototype.initWorker=function(){var e=new Blob([this.getFnCode()],{type:"text/javascript"});if(this.workerUrl=URL.createObjectURL(e),this.worker=new Worker(this.workerUrl),this.worker.onmessage=this.messageFromWorker.bind(this),this.worker.onerror=this.onError.bind(this),this.parent.isVue){var t=JSON.parse(JSON.stringify(this.workerData));this.worker.postMessage(t)}else this.worker.postMessage(this.workerData)},e.prototype.messageFromWorker=function(e){this.terminate(),this.defaultListener.apply(this.context,[e.data])},e.prototype.onError=function(e){if(this.terminate(),!e.message||!e.message.includes("FormData"))throw e.message||e;this.defaultListener.apply(this.context,[{isFormDataError:!0}])},e.prototype.getFnCode=function(){var e,t,r="",n="",i=!1;if("function"==typeof this.workerTask)this.workerTask.toString().indexOf("function")<0?n="function "+this.workerTask.toString():(n=this.workerTask.toString(),i=!0),r+="self.workerTask = "+n+"; \n";else if("object"==typeof this.workerTask)for(t=Object.keys(this.workerTask),e=0;e<t.length;e++)this.workerTask[t[e]].toString().indexOf("function")<0?n="function "+this.workerTask[t[e]].toString():(n=this.workerTask[t[e]].toString(),i=!0),r+=(0===e?"self.workerTask":t[e])+"= "+n+"; \n";return r+="self.onmessage = "+(i?"":" function ")+(this.preventCallback?this.getMessageFn.toString():this.getCallbackMessageFn.toString())+"; \n"},e.prototype.getCallbackMessageFn=function(e){postMessage(this.workerTask.apply(this,e.data))},e.prototype.getMessageFn=function(e){this.workerTask.apply(this,e.data)},e}(),Sr=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),wr=function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},Ir=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Sr(r,e),wr([t.Property("Calibri")],r.prototype,"fontFamily",void 0),wr([t.Property("bottom")],r.prototype,"verticalAlign",void 0),wr([t.Property("left")],r.prototype,"textAlign",void 0),wr([t.Property("0pt")],r.prototype,"textIndent",void 0),wr([t.Property("#000000")],r.prototype,"color",void 0),wr([t.Property("#ffffff")],r.prototype,"backgroundColor",void 0),wr([t.Property("normal")],r.prototype,"fontWeight",void 0),wr([t.Property("normal")],r.prototype,"fontStyle",void 0),wr([t.Property("11pt")],r.prototype,"fontSize",void 0),wr([t.Property("none")],r.prototype,"textDecoration",void 0),wr([t.Property("")],r.prototype,"border",void 0),wr([t.Property("")],r.prototype,"borderTop",void 0),wr([t.Property("")],r.prototype,"borderBottom",void 0),wr([t.Property("")],r.prototype,"borderLeft",void 0),wr([t.Property("")],r.prototype,"borderRight",void 0),r}(t.ChildProperty),Er=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Sr(r,e),wr([t.Property()],r.prototype,"sheetIndex",void 0),wr([t.Property()],r.prototype,"filterRange",void 0),wr([t.Property(!1)],r.prototype,"hasFilter",void 0),wr([t.Property()],r.prototype,"column",void 0),wr([t.Property()],r.prototype,"criteria",void 0),wr([t.Property()],r.prototype,"value",void 0),wr([t.Property()],r.prototype,"dataType",void 0),wr([t.Property()],r.prototype,"predicates",void 0),r}(t.ChildProperty),Rr=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Sr(r,e),wr([t.Property()],r.prototype,"sortRange",void 0),wr([t.Property()],r.prototype,"columnIndex",void 0),wr([t.Property()],r.prototype,"order",void 0),wr([t.Property()],r.prototype,"sheetIndex",void 0),r}(t.ChildProperty),Nr=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Sr(r,e),wr([t.Property("")],r.prototype,"name",void 0),wr([t.Property("")],r.prototype,"scope",void 0),wr([t.Property("")],r.prototype,"comment",void 0),wr([t.Property("")],r.prototype,"refersTo",void 0),r}(t.ChildProperty),Fr=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Sr(r,e),wr([t.Property(!1)],r.prototype,"selectCells",void 0),wr([t.Property(!1)],r.prototype,"selectUnLockedCells",void 0),wr([t.Property(!1)],r.prototype,"formatCells",void 0),wr([t.Property(!1)],r.prototype,"formatRows",void 0),wr([t.Property(!1)],r.prototype,"formatColumns",void 0),wr([t.Property(!1)],r.prototype,"insertLink",void 0),r}(t.ChildProperty),Ar=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Sr(r,e),wr([t.Property("")],r.prototype,"address",void 0),r}(t.ChildProperty),kr=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Sr(r,e),wr([t.Property("WholeNumber")],r.prototype,"type",void 0),wr([t.Property("Between")],r.prototype,"operator",void 0),wr([t.Property("0")],r.prototype,"value1",void 0),wr([t.Property("0")],r.prototype,"value2",void 0),wr([t.Property(!0)],r.prototype,"ignoreBlank",void 0),wr([t.Property(!0)],r.prototype,"inCellDropDown",void 0),wr([t.Property(!1)],r.prototype,"isHighlighted",void 0),wr([t.Property("")],r.prototype,"address",void 0),r}(t.ChildProperty),Or=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Sr(r,e),wr([t.Property("General")],r.prototype,"format",void 0),wr([t.Complex({},Ir)],r.prototype,"style",void 0),wr([t.Property(!0)],r.prototype,"isLocked",void 0),r}(t.ChildProperty),Tr=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Sr(r,e),wr([t.Property("GreaterThan")],r.prototype,"type",void 0),wr([t.Complex({},Or)],r.prototype,"format",void 0),wr([t.Property("RedFT")],r.prototype,"cFColor",void 0),wr([t.Property("")],r.prototype,"value",void 0),wr([t.Property("")],r.prototype,"range",void 0),wr([t.Property("")],r.prototype,"action",void 0),r}(t.ChildProperty),Dr=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Sr(r,e),wr([t.Property(!0)],r.prototype,"visible",void 0),wr([t.Property("Auto")],r.prototype,"position",void 0),r}(t.ChildProperty),Lr=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Sr(r,e),wr([t.Property(!1)],r.prototype,"visible",void 0),wr([t.Property("Auto")],r.prototype,"position",void 0),r}(t.ChildProperty),Pr=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Sr(r,e),wr([t.Property("")],r.prototype,"color",void 0),wr([t.Property(1)],r.prototype,"width",void 0),r}(t.ChildProperty),Mr=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Sr(r,e),wr([t.Property(!1)],r.prototype,"visible",void 0),wr([t.Property("Circle")],r.prototype,"shape",void 0),wr([t.Property(5)],r.prototype,"size",void 0),wr([t.Property(null)],r.prototype,"fill",void 0),wr([t.Property(!0)],r.prototype,"isFilled",void 0),wr([t.Complex({},Pr)],r.prototype,"border",void 0),r}(t.ChildProperty),Br=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Sr(r,e),wr([t.Property(0)],r.prototype,"width",void 0),r}(t.ChildProperty),Hr=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Sr(r,e),wr([t.Property(0)],r.prototype,"width",void 0),r}(t.ChildProperty),Ur=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Sr(r,e),wr([t.Property("")],r.prototype,"title",void 0),wr([t.Complex({},Br)],r.prototype,"majorGridLines",void 0),wr([t.Complex({},Hr)],r.prototype,"minorGridLines",void 0),wr([t.Property(!0)],r.prototype,"visible",void 0),r}(t.ChildProperty),Vr=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Sr(r,e),wr([t.Property("Line")],r.prototype,"type",void 0),wr([t.Property("Material")],r.prototype,"theme",void 0),wr([t.Property(!1)],r.prototype,"isSeriesInRows",void 0),wr([t.Complex({},Mr)],r.prototype,"markerSettings",void 0),wr([t.Property("")],r.prototype,"range",void 0),wr([t.Property("")],r.prototype,"id",void 0),wr([t.Property("")],r.prototype,"title",void 0),wr([t.Property(290)],r.prototype,"height",void 0),wr([t.Property(480)],r.prototype,"width",void 0),wr([t.Property(0)],r.prototype,"top",void 0),wr([t.Property(0)],r.prototype,"left",void 0),wr([t.Complex({},Dr)],r.prototype,"legendSettings",void 0),wr([t.Complex({},Ur)],r.prototype,"primaryXAxis",void 0),wr([t.Complex({},Ur)],r.prototype,"primaryYAxis",void 0),wr([t.Complex({},Lr)],r.prototype,"dataLabelSettings",void 0),r}(t.ChildProperty),zr=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Sr(r,e),wr([t.Property("")],r.prototype,"src",void 0),wr([t.Property("")],r.prototype,"id",void 0),wr([t.Property(300)],r.prototype,"height",void 0),wr([t.Property(400)],r.prototype,"width",void 0),wr([t.Property(0)],r.prototype,"top",void 0),wr([t.Property(0)],r.prototype,"left",void 0),r}(t.ChildProperty),jr=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Sr(r,e),wr([t.Property("FillSeries")],r.prototype,"fillType",void 0),wr([t.Property(!0)],r.prototype,"showFillOptions",void 0),r}(t.ChildProperty),_r="updateSheetFromDataSource",qr="actionBegin",Wr="getFormattedCell",Gr="calculateFormula",Yr="setCellFormat",Xr="applyCellFormat",Kr="workbookFormulaOperation",$r="workbookEditOperation",Zr="checkDateFormat",Jr="checkNumberFormat",Qr="parseDecimalNumber",en="checkUniqueRange",tn="clearFormulaDependentCells",rn="initiateSort",nn="setLinkModel",an="wrapText",on="insertModel",sn="deleteModel",ln="cellValidation",dn="gotoHandler",hn="replace",pn="replaceAll",cn="queryCellInfo",un="protectsheetHandler",fn="setLockCells",gn="setMerge",mn="activeCellMergedRange",vn="hideShow",yn="setCFRule",Cn="applyCF",bn="clearCFRule",xn="setChart",Sn="refreshRibbonIcons",wn="refreshChartSize",In="moveOrDuplicateSheet",En="setAutoFill",Rn="getautofillDDB",Nn="updateView",Fn="beforeCellUpdate",An="duplicateSheetFilterHandler",kn="localizedFormatAction",On="moveSheetHandler",Tn="updateSortCollection",Dn={SortOutOfRangeError:"Select a cell or range inside the used range and try again."},Ln=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Pn=function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},Mn=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Ln(r,e),r.prototype.setProperties=function(t,r){var n=this;if(this.parentObj.isComplexArraySetter&&this.controlParent&&this.controlParent.isAngular)if(Object.keys(t).length){void 0===this.parentObj.currRangeIdx?this.parentObj.currRangeIdx=0:this.parentObj.currRangeIdx+=1;var i=this.parentObj.ranges[this.parentObj.currRangeIdx];i&&i.info&&(this.info=i.info),setTimeout(function(){void 0!==n.parentObj.currRangeIdx&&delete n.parentObj.currRangeIdx})}else if(this.controlParent.tagObjects[0].instance&&this.controlParent.tagObjects[0].instance.hasChanges&&!this.controlParent.tagObjects[0].instance.isInitChanges){var a=this.controlParent.sheets.indexOf(this.parentObj);if(void 0===this.parentObj.changedRangeIdx){for(var o,s=this.controlParent.tagObjects[0].instance.list[a].tagObjects,l=0;l<s.length;l++)if("ranges"===s[l].name){s[l].instance.list.forEach(function(e,t){e.hasChanges&&(o=t)});break}this.parentObj.changedRangeIdx=o}}e.prototype.setProperties.call(this,t,r)},Pn([t.Property(null)],r.prototype,"dataSource",void 0),Pn([t.Property("A1")],r.prototype,"startCell",void 0),Pn([t.Property(null)],r.prototype,"query",void 0),Pn([t.Property(null)],r.prototype,"fieldsOrder",void 0),Pn([t.Property(!0)],r.prototype,"showFieldAsHeader",void 0),Pn([t.Property("")],r.prototype,"template",void 0),Pn([t.Property("A1")],r.prototype,"address",void 0),r}(t.ChildProperty),Bn=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Ln(r,e),Pn([t.Property(0)],r.prototype,"rowIndex",void 0),Pn([t.Property(0)],r.prototype,"colIndex",void 0),r}(t.ChildProperty),Hn=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Ln(r,e),Pn([t.Property(null)],r.prototype,"rows",void 0),Pn([t.Property(null)],r.prototype,"columns",void 0),Pn([t.Complex({},Fr)],r.prototype,"protectSettings",void 0),Pn([t.Collection([],Mn)],r.prototype,"ranges",void 0),Pn([t.Collection([],Tr)],r.prototype,"conditionalFormats",void 0),Pn([t.Property(0)],r.prototype,"index",void 0),Pn([t.Property("")],r.prototype,"name",void 0),Pn([t.Property(100)],r.prototype,"rowCount",void 0),Pn([t.Property(100)],r.prototype,"colCount",void 0),Pn([t.Property("A1:A1")],r.prototype,"selectedRange",void 0),Pn([t.Property("A1")],r.prototype,"activeCell",void 0),Pn([t.Complex({},Bn)],r.prototype,"usedRange",void 0),Pn([t.Property("A1")],r.prototype,"topLeftCell",void 0),Pn([t.Property(!0)],r.prototype,"showHeaders",void 0),Pn([t.Property(!0)],r.prototype,"showGridLines",void 0),Pn([t.Property(!1)],r.prototype,"isProtected",void 0),Pn([t.Property("Visible")],r.prototype,"state",void 0),Pn([t.Property(0)],r.prototype,"frozenRows",void 0),Pn([t.Property(0)],r.prototype,"frozenColumns",void 0),Pn([t.Property("A1")],r.prototype,"paneTopLeftCell",void 0),Pn([t.Property("")],r.prototype,"password",void 0),Pn([t.Property(null)],r.prototype,"standardHeight",void 0),Pn([t.Property(!1)],r.prototype,"isSheetCalculated",void 0),r}(t.ChildProperty),Un=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Vn=function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},zn=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Un(r,e),Vn([t.Property("")],r.prototype,"notes",void 0),Vn([t.Collection([],zr)],r.prototype,"image",void 0),Vn([t.Collection([],Vr)],r.prototype,"chart",void 0),Vn([t.Property("")],r.prototype,"value",void 0),Vn([t.Property("")],r.prototype,"formula",void 0),Vn([t.Property(0)],r.prototype,"index",void 0),Vn([t.Property("General")],r.prototype,"format",void 0),Vn([t.Complex({},Ir)],r.prototype,"style",void 0),Vn([t.Property("")],r.prototype,"hyperlink",void 0),Vn([t.Property(!1)],r.prototype,"wrap",void 0),Vn([t.Property(!0)],r.prototype,"isLocked",void 0),Vn([t.Property("")],r.prototype,"validation",void 0),Vn([t.Property(1)],r.prototype,"colSpan",void 0),Vn([t.Property(1)],r.prototype,"rowSpan",void 0),Vn([t.Property(!1)],r.prototype,"isReadOnly",void 0),r}(t.ChildProperty),jn=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Un(r,e),Vn([t.Property(0)],r.prototype,"chunkSize",void 0),Vn([t.Property(3)],r.prototype,"retryCount",void 0),Vn([t.Property(500)],r.prototype,"retryAfterDelay",void 0),r}(t.ChildProperty),_n=function(){function e(e){this.parent=e,this.requestedInfo=[],this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on(_r,this.updateSheetFromDataSourceHandler,this),this.parent.on("dataSourceChanged",this.dataSourceChangedHandler,this),this.parent.on("dataChanged",this.dataChangedHandler,this),this.parent.on("triggerDataChange",this.triggerDataChangeHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(_r,this.updateSheetFromDataSourceHandler),this.parent.off("dataSourceChanged",this.dataSourceChangedHandler),this.parent.off("dataChanged",this.dataChangedHandler),this.parent.off("triggerDataChange",this.triggerDataChangeHandler))},e.prototype.updateSheetFromDataSourceHandler=function(e){var t,n,i,a,o,s,l,d,h,p,u,f=this,g=[],m=[],v=new r.Deferred;e.promise=v.promise;var y,C=e.autoDetectFormat,b=C&&ne(this.parent);if(e.sheet&&e.sheet.ranges.length)for(var x,S=this,w=e.sheet.ranges.length-1;w>=0;w--)!function(w){var I=e.sheet.ranges[w];y=c(I.startCell),e.loadFromStartCell&&(e.indexes=y);var E=e.indexes[0],R=e.indexes[2];h=y[0],s=I.dataSource instanceof r.DataManager?I.dataSource:I.dataSource?new r.DataManager(I.dataSource):new r.DataManager,o=o||s.dataSource.url,e.sheet.isLocalData=!s.dataSource.url,h<=E?E-=h:h<=R?(R-=h,E=0):E=-1,I.showFieldAsHeader&&0!==E&&(E-=1);var N=!1,F=0;S.initRangeInfo(I);var A=S.getMaxCount(I);if(u=S.getLoadedInfo(E,R,I),E=u.unloadedRange[0],R=u.unloadedRange[1],I.info.insertRowRange&&(I.info.insertRowRange.forEach(function(e){F+=e[1]-e[0]+1}),E-=F,R-=F),E>=A?N=!0:R>A&&(R=A),e.loadComplete||S.requestedInfo.push({deferred:v,indexes:e.indexes,isNotLoaded:u.isNotLoaded}),E>=0&&u.isNotLoaded&&!N){m[w]=E,g[w]=!1;var k;I.fieldsOrder&&(k=[].slice.call(I.fieldsOrder));var O=(I.query?I.query:new r.Query).clone();e.loadFullData||(O=O.range(E,R>=A?R:R+1)),s.executeQuery(O.requiresCount()).then(function(r){if(f.parent&&!f.parent.isDestroyed){if(a=r.result&&r.result.result?r.result.result:r.result,i=c(I.startCell),h=i[0],p=i[1],a&&a.length){if(I.info.count||(A=r.count,I.info.count=r.count),n=I.info.flds||k||Object.keys(a[0]),I.info.fldLen||(I.info.fldLen=n.length,I.info.flds=n),I.info.insertColumnRange){var o=0;I.info.insertColumnRange.forEach(function(e){for(var t=e[0];t<=e[1];t++)t<=p?n.splice(0,0,"emptyCell"+o):n.splice(t-p,0,"emptyCell"+o),o++})}0===m[w]&&I.showFieldAsHeader&&(l=h+m[w]+F,n.forEach(function(r,n){(t=He(l,p+n,e.sheet,!0))?r.includes("emptyCell")||(t.value=r):e.sheet.rows[h+m[w]].cells[p+n]=r.includes("emptyCell")?{}:{value:r}})),a.forEach(function(r,i){l=h+m[w]+i+(I.showFieldAsHeader?1:0)+F,n.forEach(function(n,i){(t=He(l,d=p+i,e.sheet,!0))?(x=t.value,n.includes("emptyCell")||Ue(l,d,e.sheet,f.getCellDataFromProp(r[n]),!0)):(x=void 0,t=e.sheet.rows[l].cells[d]=n.includes("emptyCell")?{}:f.getCellDataFromProp(r[n])),C&&b(t),e.updateDependentCellsCallback&&x!==t.value&&e.updateDependentCellsCallback(l,d)})})}else n=[];var s;s=h+(A||r.count)>0?h+(A||r.count)+(I.showFieldAsHeader?1:0)+F-1:e.sheet.usedRange.rowIndex;var v=p+n.length-1<0?e.sheet.usedRange.colIndex:p+n.length-1;e.loadFullData&&(R=s);var y={rowIndex:s,colIndex:v};if(f.parent.scrollSettings&&f.parent.scrollSettings.isFinite&&(y.rowIndex=s<e.sheet.rowCount?s:e.sheet.rowCount-1,y.colIndex=v<e.sheet.colCount?v:e.sheet.colCount-1),e.sheet.usedRange.rowIndex<y.rowIndex&&f.parent.setSheetPropertyOnMute(e.sheet,"usedRange",{rowIndex:y.rowIndex,colIndex:e.sheet.usedRange.colIndex}),e.sheet.usedRange.colIndex<y.colIndex&&f.parent.setSheetPropertyOnMute(e.sheet,"usedRange",{rowIndex:e.sheet.usedRange.rowIndex,colIndex:y.colIndex}),F?(u=f.getLoadedInfo(E,R,I),E=u.unloadedRange[0],R=u.unloadedRange[1],E>A&&(u.isNotLoaded=!1),u.isNotLoaded&&(R>A&&(R=A),I.info.loadedRange.push([E,R]))):I.info.loadedRange.push([E,R]),g[w]=!0,-1===g.indexOf(!1)){var S=void 0;if(R+h<h+I.info.count){e.rangeSettingCount||(e.rangeSettingCount=[]),e.rangeSettingCount.push(w),S=!0;var N={sheet:e.sheet,indexes:[0,0,s,v],promise:new Promise(function(e){e(void 0)}),rangeSettingCount:e.rangeSettingCount,loadComplete:e.loadComplete,autoDetectFormat:e.autoDetectFormat,resolveAfterFullDataLoaded:e.resolveAfterFullDataLoaded};f.updateSheetFromDataSourceHandler(N),N.promise.then(function(){"workbook"!==f.parent.getModuleName()&&(e.rangeSettingCount.pop(),e.rangeSettingCount.length||f.parent.notify("created",null),e.formulaCellRef?f.notfyFormulaCellRefresh(e.formulaCellRef,e.sheetIndex):e.loadComplete&&e.loadComplete())})}else e.formulaCellRef?f.notfyFormulaCellRefresh(e.formulaCellRef,e.sheetIndex):e.loadComplete&&e.loadComplete();S&&e.resolveAfterFullDataLoaded||(f.checkResolve(e.indexes),e.resolveAfterFullDataLoaded&&f.checkResolve([0,0,0,0]))}}})}else 0===w&&-1===g.indexOf(!1)&&(e.loadComplete&&e.loadComplete(),S.checkResolve(e.indexes))}(w);else v.resolve()},e.prototype.notfyFormulaCellRefresh=function(e,t){this.parent.formulaRefCell=null,this.parent.notify(Nn,{indexes:c(e),sheetIndex:t,refreshing:!0})},e.prototype.checkResolve=function(e){var t,r,n=0;this.requestedInfo.forEach(function(i,a){((r=JSON.stringify(i.indexes)===JSON.stringify(e))||t)&&(0===a?(i.deferred.resolve(),n++,t=!0):!t||!i.isLoaded&&i.isNotLoaded?r&&t?(i.deferred.resolve(),n++):r?i.isLoaded=!0:t=!1:(i.deferred.resolve(),n++))}),this.requestedInfo.splice(0,n)},e.prototype.getCellDataFromProp=function(e){var r={};return"[object Object]"===Object.prototype.toString.call(e)?e.formula?r.formula=e.formula:t.isNullOrUndefined(e.value)||("string"==typeof e.value&&(0===e.value.indexOf("http://")||0===e.value.indexOf("https://")||0===e.value.indexOf("ftp://")||0===e.value.indexOf("www."))?(r.hyperlink=e.value,r.style={textDecoration:"underline",color:"#00e"}):r.value=e.value):k(e)?r.formula=e:"string"==typeof e&&(0===e.indexOf("http://")||0===e.indexOf("https://")||0===e.indexOf("ftp://")||0===e.indexOf("www."))?(r.hyperlink=e,r.style={textDecoration:"underline",color:"#00e"}):r.value=e,r},e.prototype.getLoadedInfo=function(e,t,r){var n=!0;return r.info.loadedRange.forEach(function(r){r[0]<=e&&e<=r[1]?r[0]<=t&&t<=r[1]?n=!1:e=r[1]+1:r[0]<=t&&t<=r[1]&&(t=r[0]-1)}),{isNotLoaded:n,unloadedRange:[e,t]}},e.prototype.getMaxCount=function(e){if(e.query)for(var t=e.query.queries,r=0;r<t.length;r++)if("onTake"===t[r].fn)return Math.min(t[r].e.nos,e.info.count||t[r].e.nos);return e.info.count},e.prototype.initRangeInfo=function(e){e.info||(e.info={loadedRange:[]})},e.prototype.dataSourceChangedHandler=function(e){var t,r=this,n=this.parent.sheets[e.sheetIdx],i=n.ranges[e.rangeIdx];if(i&&(this.checkRangeHasChanges(n,e.rangeIdx)||!i.info)){var a=i.showFieldAsHeader,o=u(i.startCell);i.info&&(i.info.loadedRange.forEach(function(e){for(var r=e[0];r<=e[1]&&r<i.info.count+(a?1:0);r++)if(t=n.rows[r+o[0]])for(var s=o[1];s<o[1]+i.info.fldLen;s++)t.cells&&t.cells[s]&&delete t.cells[s]}),i.info=null);var s={sheet:n,indexes:[0,0,n.rowCount-1,n.colCount-1],loadFullData:!0,promise:new Promise(function(e){e(void 0)})};this.updateSheetFromDataSourceHandler(s),s.promise.then(function(){r.parent.trigger("dataSourceChanged",{data:e.changedData,action:"dataSourceChanged",rangeIndex:e.rangeIdx,sheetIndex:e.sheetIdx}),r.parent.notify(Nn,{sheetIndex:e.sheetIdx,checkWrap:!0,checkCF:!0})})}},e.prototype.checkRangeHasChanges=function(e,t){return!this.parent.isAngular||e.changedRangeIdx===t&&(delete e.changedRangeIdx,!0)},e.prototype.dataChangedHandler=function(e){var t,r,n,i,a,o,s,l,d,h=this,p=[{}],f=void 0===e.sheetIdx?this.parent.activeSheetIndex:e.sheetIdx,m=this.parent.sheets[f];m.ranges.forEach(function(v,y){if(v.dataSource){var C=void 0;if(i=u(v.startCell),n=i.concat([i[0]+v.info.count+(v.showFieldAsHeader?0:-1),i[1]+v.info.fldLen-1]),"Row"===e.modelType||"Column"===e.modelType){if("Column"===e.modelType){if(e.insertType)a=n[1]<e.index&&n[3]>=e.index,l=[e.index],a?(e.model.forEach(function(){v.info.flds.splice(e.index-i[1],0,"")}),v.info.fldLen+=e.model.length):n[3]+1===e.index&&"after"===e.insertType?(e.model.forEach(function(){v.info.flds.splice(e.index-i[1],0,"")}),v.info.fldLen+=e.model.length):n[1]>=e.index&&(v.startCell=g(i[0],i[1]+e.model.length));else if(a=n[1]<=e.startIndex&&n[3]>=e.startIndex)for(E=e.startIndex;E<=e.endIndex;E++)E<=n[3]&&(v.info.flds.splice(e.startIndex,1),v.info.fldLen-=1);return}if(e.insertType){if(a=(v.showFieldAsHeader||"above"!==e.insertType&&!e.isMethod?n[0]<e.index:n[0]<=e.index)&&n[2]>=e.index,l=[e.index],a?(C=!0,v.info.count+=e.model.length):n[2]+1===e.index&&"below"===e.insertType?(C=!0,v.info.count+=e.model.length):n[0]>=e.index&&(v.startCell=g(i[0]+e.model.length,i[1])),e.isMethod)return}else a=n[0]<=e.startIndex&&n[2]>=e.startIndex,e.isDataRequest?l=[e.startIndex,n[1],e.startIndex,n[1]]:t="delete"}else{var b=e.address||e.range||e.fillRange;l=c(e.requestType&&e.requestType.toLowerCase().includes("paste")?e.pastedRange.substring(e.pastedRange.lastIndexOf("!")+1):e.sheetIdx>-1?e.address:b.substring(b.lastIndexOf("!")+1));var x=[v.showFieldAsHeader?n[0]+1:n[0]].concat(n.slice(1,4));if(v.showFieldAsHeader&&l[0]===i[0])for(E=l[1];E<=l[3];E++)E>=x[1]&&E<=x[3]&&(v.info.flds[E-i[1]]=He(i[0],E,m,!1,!0).value||"");if(a=B(x,l,!0),"paste"===e.requestType&&e.copiedInfo.isCut){if(d=[].slice.call(e.copiedInfo.range),v.showFieldAsHeader&&d[0]===i[0]){for(E=d[1];E<=d[3];E++)E>=x[1]&&E<=x[3]&&(v.info.flds[E-i[1]]="");a=!1}o=B(x,d,!0)}}if(a||C||o){if("Row"!==e.modelType||e.insertType||e.isDataRequest){t=C?"add":"edit";var S=0;if(o){S=d[2]-d[0]+1;for(E=0;E<S;E++)!function(e){p[e]={},v.info.flds.forEach(function(t,n){t&&(r=He(d[0]+e,i[1]+n,m),p[e][""+t]=h.getFormattedValue(r))})}(E)}if(a||C)for(var w,I=!(e.isDataRequest||o||C||e.skipFilterCheck),E=0,R=0;E<(C?e.model.length:l[2]-l[0]+1||1);E++)!function(e,t){if(I&&rt(m,l[0]+e))return w=t,"continue";p[t+S]={},v.info.flds.forEach(function(n,a){n&&(r=He(l[0]+e,i[1]+a,m),p[t+S][""+n]=h.getFormattedValue(r))}),w=++t}(E,R),R=w}else{if(e.deletedModel.forEach(function(e,t){p[t]={},v.info.flds.forEach(function(n,a){e.cells?(r=e.cells[i[1]+a],p[t][""+n]=h.getFormattedValue(r)):p[t][""+n]=null}),v.info.count-=1}),e.isMethod)return;s={count:e.deletedModel.length,index:e.endIndex}}e.isDataRequest?e.data=p:h.parent.trigger("dataSourceChanged",{data:p,action:t,rangeIndex:y,sheetIndex:f})}else s&&s.count&&n[0]>s.index&&(v.startCell=g(i[0]-s.count,i[1]))}})},e.prototype.getFormattedValue=function(e){var t=this.parent.getDisplayText(e);return""===t?null:e&&!e.format&&"number"==typeof e.value?e.value:t},e.prototype.triggerDataChangeHandler=function(e){var r=["insert","delete","edit","cellDelete","cellSave","autofill","clipboard","clear"],n=!0;if(("delete"===e.action||"insert"===e.action)&&["Sheet"].indexOf(e.eventArgs.modelType)>-1?n=!1:"clear"===e.action&&["Clear Formats","Clear Hyperlinks"].indexOf(e.eventArgs.type)>-1?n=!1:"clipboard"===e.action&&"Formats"===e.eventArgs.requestType&&(n=!1),n&&r.indexOf(e.action)>-1){var i=void 0;!e.isUndo||"delete"!==e.action&&"insert"!==e.action?i=e.eventArgs:(i=t.extend({},e.eventArgs),"delete"===e.action?(i.index=i.startIndex,i.model=i.deletedModel,i.insertType="below"):(i.startIndex=i.index,i.endIndex=e.eventArgs.index+e.eventArgs.model.length-1,i.deletedModel=i.model,delete i.insertType)),this.parent.notify("dataChanged",i)}},e.prototype.getModuleName=function(){return"dataBind"},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null,this.requestedInfo=[]},e}(),qn="ribbon",Wn="contentLoaded",Gn="spreadsheetDestroyed",Yn="editOperation",Xn="click",Kn="keyUp",$n="keyDown",Zn="contextmenuBeforeOpen",Jn="removeSheetTab",Qn="cut",ei="copy",ti="paste",ri="rowHeightChanged",ni="colWidthChanged",ii="deInitProperties",ai="autoFitRowsColumns",oi="refreshFilterCellsOnResize",si="removeHyperlink",li="sheetNameUpdate",di="hideSheet",hi="performUndoRedo",pi="initiateFilterUI",ci="actionComplete",ui="invalidData",fi="applyProtect",gi="renderGotoDlgt",mi="renderFindDlg",vi="editAlert",yi="readonlyAlert",Ci="removeDataValidation",bi="goToSheet",xi="showSheet",Si="clearViewer",wi="refreshOverlayElem",Ii="refreshImgCellObj",Ei="getRowIdxFromClientY",Ri="getColIdxFromClientX",Ni="createImageElement",Fi="deleteImage",Ai="deleteChart",ki="refreshChartCellObj",Oi="chartDesignTab",Ti="setProtectWorkbook",Di="removeWorkbookProtection",Li="selectionStatus",Pi=function(){function e(e){this.loopIndex=0,this.processedLoopIndex=0,this.retryCount=0,this.currentDocumentId=null,this.parent=e,this.addEventListener()}return e.prototype.open=function(e){this.load(e)},e.prototype.load=function(e,r){var n=this;if(this.parent.allowOpen){if(e.jsonObject)return void this.fetchSuccess(e.jsonObject,e,null,!0,!0);var i=new FormData;if(e.file)i.append("file",e.file);else{if(!(e.sheetIndex>=0))return void(this.parent.isOpen=!1);i.append("sheetPassword",e.sheetPassword),i.append("sheetIndex",e.sheetIndex.toString())}var a={passWord:""};e.password&&e.password.length&&(a.passWord=e.password),a.passWord&&a.passWord.length&&(e.password=a.passWord),e.password&&i.append("password",e.password),i.append("IsManualCalculationEnabled",("Manual"===this.parent.calculationMode).toString());var o={file:e.file||null,cancel:!1,requestData:{method:"POST",body:i},password:a.passWord},s=e.guid;if(t.isNullOrUndefined(e.sheetPassword)&&!s&&t.isNullOrUndefined(r)?(this.parent.trigger("beforeOpen",o),this.parent.notify(qr,{eventArgs:o,action:"beforeOpen"})):s&&i.append("guid",s),o.cancel)return void(this.parent.isOpen=!1);var l={chunkSize:null,documentId:null};this.parent.openSettings.chunkSize>0&&t.isNullOrUndefined(e.sheetPassword)&&(this.setToDefaults(r),t.isNullOrUndefined(this.parent.openSettings.chunkSize)||0===this.parent.openSettings.chunkSize||(l.chunkSize=this.parent.openSettings.chunkSize.toString()),t.isNullOrUndefined(this.currentDocumentId)||(l.documentId=this.currentDocumentId),t.isNullOrUndefined(l)||i.append("chunkPayload",JSON.stringify(l))),fetch(this.parent.openUrl,o.requestData).then(function(e){return e.ok?e.json():Promise.reject({status:e.status,statusText:e.statusText,url:e.url})}).then(function(t){return n.fetchSuccess(t,o,e.orginalFile,void 0,!0)}).catch(function(t){-1===t.toString().indexOf("Unexpected end of JSON input")&&n.parent.openSettings.chunkSize>0&&n.retryCount<n.parent.openSettings.retryCount?setTimeout(function(){n.retryCount++,n.load(e,!0)},n.parent.openSettings.retryAfterDelay):(n.retryCount>=n.parent.openSettings.retryCount&&(n.retryCount=0),n.fetchFailure(t))})}},e.prototype.fetchFailure=function(e){t.isUndefined(e.status)&&t.isUndefined(e.statusText)&&(e.statusText="Improper response"),this.parent.notify("openFailure",e),this.parent.isOpen=!1},e.prototype.fetchSuccess=function(e,r,n,i,a){var o=["UnsupportedFile","InvalidUrl","NeedPassword","InCorrectPassword","InCorrectSheetPassword","CorrectSheetPassword","DataLimitExceeded","FileSizeLimitExceeded","ExternalWorkbook"],s="string"==typeof e?JSON.parse(e):e,l=s.Workbook;if(t.isNullOrUndefined(l)){var d=s.chunkTotalCount;this.currentDocumentId=s.documentId,this.chunkList=new Array(d);var h=0,p=d>this.parent.openSettings.chunkSize?this.parent.openSettings.chunkSize:d,c=0;this.processedLoopIndex=0;var u=this;if(!t.isNullOrUndefined(d))for(;h<d;)u.processChunk(h,p,c,"",r,n,i,a),p=(h+=u.parent.openSettings.chunkSize)+u.parent.openSettings.chunkSize<d?u.parent.openSettings.chunkSize:d-h,c++,u.processedLoopIndex++}else{if(o.indexOf(l)>-1)return n&&(r.file=n),void this.parent.notify("openSuccess",{context:this,data:l,guid:s.Guid,eventArgs:r,isOpenFromJson:i});this.updateModel(l,i,a),this.parent.notify("openSuccess",{context:this,data:l,isOpenFromJson:i,eventArgs:r}),this.parent.isOpen=!1,r&&r.password&&r.password.length>0&&(this.parent.showSheetTabs&&(this.parent.element.querySelector(".e-add-sheet-tab").removeAttribute("disabled"),this.parent.element.querySelector(".e-add-sheet-tab").classList.remove("e-disabled")),this.parent.password="")}},e.prototype.processChunk=function(e,r,n,i,a,o,s,l){var d=this,h={currentChunk:e.toString(),chunkSize:r.toString(),loopIndex:n.toString(),documentId:this.currentDocumentId},p=new FormData;p.append("chunkPayload",JSON.stringify(h));var c={file:o||null,cancel:!1,requestData:{method:"POST",body:p},password:a.password};fetch(this.parent.openUrl,c.requestData).then(function(e){return e.ok?e.json():Promise.reject({status:e.status,statusText:e.statusText,url:e.url})}).then(function(e){if(""!==e){for(var t=atob(e.chunk),r=new Uint8Array(t.length),n=0;n<t.length;n++)r[n]=t.charCodeAt(n);if(t=new TextDecoder("utf-8").decode(r),d.chunkList[e.loopIndex]=t,++d.loopIndex===d.processedLoopIndex){for(var h=d.chunkList.splice(0,d.loopIndex),p=0;p<h.length;p++)i+=h.slice(p,p+1).join("");e=JSON.parse(i),d.setToDefaults(),d.fetchSuccess(e,a,o,s,l)}}}).catch(function(h){if(t.isNullOrUndefined(d.currentFailedChunkIndex)||d.currentFailedChunkIndex===e){if(d.currentFailedChunkIndex=e,!(d.retryCount<d.parent.openSettings.retryCount))return d.retryCount=0,d.fetchFailure(h);setTimeout(function(){d.processedLoopIndex=n,d.processChunk(e,r,n,i,a,o,s,l),d.retryCount++},d.parent.openSettings.retryAfterDelay)}})},e.prototype.setToDefaults=function(e){this.currentFailedChunkIndex=null,e||(this.retryCount=0),this.loopIndex=0,this.processedLoopIndex=0,this.chunkList=[]},e.prototype.updateModel=function(e,r,n){this.parent.notify(Kr,{action:"unRegisterSheet"}),this.setSelectAllRange(e.sheets,r),this.parent.sheetNameCount=1,this.parent.sheets=[],this.parent.notify("sheetsDestroyed",{}),this.parent.notify("clearUndoRedoCollection",null),e.activeSheetIndex=e.activeSheetIndex||e.sheets.findIndex(function(e){return"Hidden"!==e.state}),this.parent.setProperties({isProtected:e.isProtected||!1,password:e.password||"",sheets:e.sheets,activeSheetIndex:e.activeSheetIndex,definedNames:e.definedNames||[],filterCollection:e.filterCollection||[],sortCollection:e.sortCollection||[],listSeparator:e.listSeparator||this.parent.listSeparator},!0),t.isNullOrUndefined(e.showSheetTabs)||(this.parent.showSheetTabs=e.showSheetTabs),Te(this.parent,void 0,n),this.parent.notify("sheetCreated",null),this.parent.notify(Kr,{action:"registerSheet",isImport:!0}),this.parent.notify(Kr,{action:"initiateDefinedNames"}),this.parent.notify("protectSheet",null)},e.prototype.setSelectAllRange=function(e,r){var n,i,a=this;e.forEach(function(e){if(e.selectedRange){var o=c(e.selectedRange),s=(t.isUndefined(e.rowCount)?100:e.rowCount)-1,l=(t.isUndefined(e.colCount)?100:e.colCount)-1;65535===o[2]&&(o[2]=s),255===o[3]&&(o[3]=l),65535===o[0]&&(o[0]=s),255===o[1]&&(o[1]=l),e.selectedRange=m(o)}if(r&&a.parent.isAngular)for(var d=0;d<a.parent.sheets.length;d++)if(n=Ae(a.parent,d),e.name===n.name){e.ranges&&e.ranges.forEach(function(e,t){(i=n.ranges[t])&&i.template&&(e.template=i.template)});break}})},e.prototype.sheetsDestroyHandler=function(e){t.isNullOrUndefined(e.sheetIndex)&&(this.preventFormatCheck=null)},e.prototype.addEventListener=function(){this.parent.on("workbookOpen",this.open.bind(this)),this.parent.on("sheetsDestroyed",this.sheetsDestroyHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("workbookOpen",this.open.bind(this)),this.parent.off("sheetsDestroyed",this.sheetsDestroyHandler))},e.prototype.destroy=function(){this.removeEventListener(),this.parent.refreshing||(this.preventFormatCheck=null),this.parent=null},e.prototype.getModuleName=function(){return"workbookOpen"},e}(),Mi=function(){function e(e){this.parent=e}return e.prototype.processSheet=function(e,t){return[t,JSON.parse(e,function(e,t){if(!Array.isArray(t)&&"string"!=typeof t||t.length)return t})]},e.prototype.processSave=function(e,t,r,n,i){var a,o=this,s=new FormData,l=Object.keys(t);for(s.append("JSONData",JSON.stringify(e)),a=0;a<l.length;a++)s.append(l[a],t[l[a]]);for(l=Object.keys(r),a=0;a<l.length;a++)s.append(l[a],r[l[a]]);s.append("pdfLayoutSettings",JSON.stringify(n)),fetch(t.url,{method:"POST",body:s}).then(function(e){return e.ok?e.blob():Promise.reject({message:e.statusText})}).then(function(e){new Promise(function(t){var n=new FileReader;n.onload=function(){var a=n.result.toString(),s=r.customParams&&"string"==typeof r.customParams&&"saveashtml"===r.customParams.toLowerCase();if(a.indexOf("data:text/plain;base64,")>-1||!s&&a.indexOf("data:text/html;base64,")>-1||a.indexOf("data:application/json;base64,")>-1){var l=void 0;if(a=a.replace("data:text/plain;base64,",""),a=a.replace("data:text/html;base64,",""),a.indexOf("data:application/json;base64,")>-1?(a=a.replace("data:application/json;base64,",""),l=atob(a).split(".")):l=atob(a).split(/(\r\n|\n|\r)/gm),l.length){var d=l[0].length>1&&'"'===l[0][0]?l[0].split('"')[1]+".":l[0];i?i.apply(o,[{dialog:d}]):postMessage({dialog:d})}}else i?i.apply(o,[e]):postMessage(e);t(n.result)},n.readAsDataURL(e)})}).catch(function(e){i?i.apply(o,[{error:e.message}]):postMessage({error:e.message})})},e}(),Bi=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Hi=function(){return(Hi=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}).apply(this,arguments)},Ui=function(e){function r(t){var r=e.call(this,t)||this;return r.isProcessCompleted=!1,r.saveJSON={},r.isFullPost=!1,r.needBlobData=!1,r.customParams=null,r.pdfLayoutSettings={fitSheetOnOnePage:!1},r.addEventListener(),r}return Bi(r,e),r.prototype.getModuleName=function(){return"workbookSave"},r.prototype.destroy=function(){this.removeEventListener(),this.parent=null},r.prototype.addEventListener=function(){this.parent.on("beginSave",this.initiateSave,this),this.parent.on("getStringifyObject",this.performStringifyAction,this)},r.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("beginSave",this.initiateSave),this.parent.off("getStringifyObject",this.performStringifyAction))},r.prototype.initiateSave=function(e){var t=e.saveSettings;this.saveSettings={saveType:t.saveType,url:t.url,fileName:t.fileName||"Sample"},this.isFullPost=e.isFullPost,this.needBlobData=e.needBlobData,this.needBlobData&&(this.isFullPost=!1),this.customParams=e.customParams,this.pdfLayoutSettings=e.pdfLayoutSettings,this.updateBasicSettings(),this.processSheets(t.autoDetectFormat,e.jsonConfig)},r.prototype.updateBasicSettings=function(){var e=this.getStringifyObject(this.parent,["sheets","_isScalar","observers","closed","isStopped","hasError","__isAsync","beforeCellFormat","beforeCellRender","beforeDataBound","beforeOpen","beforeSave","beforeSelect","beforeSort","cellEdit","cellEdited","cellEditing","cellSave","beforeCellSave","contextMenuItemSelect","contextMenuBeforeClose","contextMenuBeforeOpen","created","dataBound","fileMenuItemSelect","fileMenuBeforeClose","fileMenuBeforeOpen","saveComplete","sortComplete","select","actionBegin","actionComplete","afterHyperlinkClick","afterHyperlinkCreate","beforeHyperlinkClick","beforeHyperlinkCreate","openComplete","openFailure","queryCellInfo","dialogBeforeOpen","dataSourceChanged","beforeConditionalFormat","beforeCellUpdate"]),t=JSON.parse(e);this.parent.sheets.length&&(t.sheets=[]),this.saveJSON=t,this.saveJSON.filterCollection=[]},r.prototype.processSheets=function(e,t){var r=this,n=["dataSource","startCell","query","showFieldAsHeader","result"];if(this.parent.isAngular&&n.push("template"),t)if(t.onlyValues)n.push.apply(n,["style","formula","format","conditionalFormats","validation","hyperlink","wrap","chart","image","notes"]);else{var i={style:t.ignoreStyle,formula:t.ignoreFormula,format:t.ignoreFormat,conditionalFormats:t.ignoreConditionalFormat,validation:t.ignoreValidation,wrap:t.ignoreWrap,chart:t.ignoreChart,image:t.ignoreImage,notes:t.ignoreNote};t.ignoreFreezePane&&n.push.apply(n,["frozenColumns","frozenRows"]);for(var a in i)i[a]&&n.push(a)}for(var o,s,l,d,h=0,p=this.parent.sheets.length;h<p;h++){o=!1,s=!1;for(var c=0,u=(l=this.parent.sheets[h]).ranges.length;c<u;c++)if((d=l.ranges[c]).dataSource&&(s=!0,!d.info||!d.info.loadedRange||!d.info.loadedRange.length)){o=!0;break}if(o){var f=function(e){R(r,r.processSheet,r.updateSheet,[r.getStringifyObject(r.parent.sheets[e],n,e,!1,!0),e],null,r.parent)};this.parent.notify(_r,{sheet:l,sheetIndex:h,loadComplete:f.bind(this,h),loadFromStartCell:!0,autoDetectFormat:e})}else R(this,this.processSheet,this.updateSheet,[this.getStringifyObject(l,n,h,e&&s,!0),h],null,this.parent)}},r.prototype.updateSheet=function(e){this.saveJSON.sheets[e[0]]=e[1],this.isProcessCompleted=this.getSheetLength(this.saveJSON.sheets)===this.parent.sheets.length,this.isProcessCompleted&&this.save(this.saveSettings)},r.prototype.getSheetLength=function(e){var t=0;return e.forEach(function(e){e&&t++}),t},r.prototype.save=function(e){var t={cancel:!1,jsonObject:this.saveJSON};this.parent.notify("onSave",t),t.cancel||(this.isFullPost?(this.initiateFullPostSave(),this.saveJSON={}):R(this,{workerTask:this.processSave},this.updateSaveResult,[this.saveJSON,e,this.customParams,this.pdfLayoutSettings],!0,this.parent))},r.prototype.updateSaveResult=function(e){if(e.isFormDataError)return void this.processSave(this.saveJSON,this.saveSettings,this.customParams,this.pdfLayoutSettings,this.updateSaveResult);this.saveJSON={};var t={status:"Success",message:"",url:this.saveSettings.url,fileName:this.saveSettings.fileName,saveType:this.saveSettings.saveType,blobData:null};"object"==typeof e&&e.error?(t.status="Failure",t.message=e.error.toString()):"object"==typeof e&&e.dialog?this.parent.notify("saveError",{content:e.dialog}):this.needBlobData?t.blobData=e:this.ClientFileDownload(e),this.parent.trigger("saveComplete",t),this.parent.notify("saveCompleted",t)},r.prototype.ClientFileDownload=function(e){var t=this.parent.createElement("a",{attrs:{download:this.getFileNameWithExtension()}}),r=URL.createObjectURL(e);t.href=r,document.body.appendChild(t),t.click(),URL.revokeObjectURL(r),document.body.removeChild(t)},r.prototype.initiateFullPostSave=function(){var e,r=Object.keys(this.saveSettings),n=this.parent.createElement("form",{attrs:{method:"POST",action:this.saveSettings.url}}),i=this.parent.createElement("input",{attrs:{type:"hidden",name:"JSONData"}});for(i.value=JSON.stringify(this.saveJSON),n.appendChild(i),e=0;e<r.length;e++)(i=this.parent.createElement("input",{attrs:{type:"hidden",name:r[e]}})).value=this.saveSettings[r[e]],n.appendChild(i);for(r=Object.keys(this.customParams),e=0;e<r.length;e++)(i=this.parent.createElement("input",{attrs:{type:"hidden",name:r[e]}})).value=this.customParams[r[e]],n.appendChild(i);(i=this.parent.createElement("input",{attrs:{type:"hidden",name:"pdfLayoutSettings"}})).value=JSON.stringify(this.pdfLayoutSettings),n.appendChild(i),document.body.appendChild(n),n.submit(),t.detach(n),this.parent.notify("saveCompleted",{})},r.prototype.performStringifyAction=function(e){e.model='{"jsonObject":{"Workbook":{"sheets":[';for(var t=0,r=this.parent.sheets.length-1;t<=r;t++)e.model+=this.getStringifyObject(this.parent.sheets[t],e.skipProps,t)+(t<r?",":"]}}}")},r.prototype.getStringifyObject=function(e,t,r,n,i){var a=this;void 0===t&&(t=[]),0===r&&this.parent.notify("removeUniquecol",{clearAll:!0}),i&&this.parent.notify("setFilteredCollection",{sheetIdx:r,isSaveAction:!0,saveJson:this.saveJSON});var o,s=[],l=n&&ne(this.parent),d=JSON.stringify(e,function(i,d){if(!(t.indexOf(i)>-1)){if("cellStyle"===i)return a.parent.commonCellStyle;if(d&&d.cells)for(var h=0,p=d.cells.length;h<p;h++){var c=d.cells[h],u=[Number(i),h];if(c&&(c.value?n&&!c.formula&&l(c):c.formula&&c.formula.indexOf("=UNIQUE(")<0&&("Automatic"===a.parent.calculationMode&&a.parent.notify(Kr,{action:"refreshCalculate",value:c.formula,rowIndex:u[0],colIndex:h,isFormula:k(c.formula),sheetIndex:r,isRefreshing:!0}),c.value=He(u[0],h,e).value),c.chart)){s.push({index:u,chart:c.chart}),o=[];for(var f=0,g=c.chart.length;f<g;f++){var m=Object.assign({},c.chart[f]);delete m.id,o.push(m)}c.chart=o}}if("validation"===i&&d&&"string"==typeof d.type&&"Time"===d.type&&["value1","value2"].forEach(function(e){var t=d[e]&&d[e].toString();t&&!fe(Number(t))&&(d[e]=a.getDateAsNumber({range:[],cell:{value:t}},t))}),d&&d.properties&&d.maxHgts&&(d.properties=Hi({},d.properties,{maxHgts:d.maxHgts})),d&&"object"==typeof d&&d.hasOwnProperty("properties")){if(d.propName&&"conditionalFormats"===d.propName.toString()){var v=d.properties;if(v.format&&v.format.style){var y=v.format.style;y&&"#ffffff"===y.backgroundColor&&"#000000"===y.color&&"bold"!==y.fontWeight&&"italic"!==y.fontStyle&&"underline"!==y.textDecoration&&delete v.format}}return d.properties}return null!==d?d:void 0}}),h=Ae(this.parent,r);return s.forEach(function(e){Ue(e.index[0],e.index[1],h,{chart:e.chart},!0)}),d},r.prototype.getDateAsNumber=function(e,t){var r={value:t,rowIndex:e.range[0],cell:e.cell,colIndex:e.range[1],sheetIndex:e.sheetIdx,updatedVal:""};return this.parent.notify(Zr,r),r.updatedVal||t},r.prototype.getFileNameWithExtension=function(e){e||(e=this.saveSettings.fileName);var t=this.getFileExtension(),r=e.lastIndexOf(".");return r>-1&&(e=e.substr(0,r)),e+t},r.prototype.getFileExtension=function(){return"."+this.saveSettings.saveType.toLowerCase()},r}(Mi);!function(e){e[e.NA=0]="NA",e[e.Value=1]="Value",e[e.Ref=2]="Ref",e[e.DivZero=3]="DivZero",e[e.Num=4]="Num",e[e.Name=5]="Name",e[e.Null=6]="Null",e[e.Calc=7]="Calc"}(e.CommonErrors||(e.CommonErrors={})),function(e){e[e.OperatorsCannotStartWithExpression=0]="OperatorsCannotStartWithExpression",e[e.ReservedWordAND=1]="ReservedWordAND",e[e.ReservedWordXOR=2]="ReservedWordXOR",e[e.ReservedWordIf=3]="ReservedWordIf",e[e.NumberContains2DecimalPoints=4]="NumberContains2DecimalPoints",e[e.ReservedWordElse=5]="ReservedWordElse",e[e.ReservedWordNOT=6]="ReservedWordNOT",e[e.InvalidCharInNumber=7]="InvalidCharInNumber",e[e.InvalidCharactersFollowingWithOperator=6]="InvalidCharactersFollowingWithOperator",e[e.MismatchedParentheses=8]="MismatchedParentheses",e[e.UnknownFormulaName=9]="UnknownFormulaName",e[e.RequiresASingleArgument=10]="RequiresASingleArgument",e[e.Requires3Args=11]="Requires3Args",e[e.InvalidMathArgument=12]="InvalidMathArgument",e[e.Requires2Args=13]="Requires2Args",e[e.BadIndex=14]="BadIndex",e[e.TooComplex=15]="TooComplex",e[e.CircularReference=16]="CircularReference",e[e.MissingFormula=17]="MissingFormula",e[e.ImproperFormula=18]="ImproperFormula",e[e.InvalidExpression=19]="InvalidExpression",e[e.CellEmpty=20]="CellEmpty",e[e.BadFormula=21]="BadFormula",e[e.EmptyExpression=22]="EmptyExpression",e[e.VirtualModeRequired=23]="VirtualModeRequired",e[e.MismatchedTics=24]="MismatchedTics",e[e.WrongNumberArguments=25]="WrongNumberArguments",e[e.InvalidArguments=26]="InvalidArguments",e[e.IterationsDoNotConverge=27]="IterationsDoNotConverge",e[e.CalculationOverflow=29]="CalculationOverflow",e[e.AlreadyRegistered=28]="AlreadyRegistered",e[e.MissingSheet=30]="MissingSheet",e[e.CannotParse=31]="CannotParse",e[e.ExpressionCannotEndWithAnOperator=32]="ExpressionCannotEndWithAnOperator",e[e.Spill=33]="Spill",e[e.Div=34]="Div"}(e.FormulasErrorsStrings||(e.FormulasErrorsStrings={})),function(e){e.xlsx="xlsx",e.xlsm="xlsm",e.xlsb="xlsb",e.xltx="xltx",e.xltm="xltm",e.xls="xls",e.xml="xml",e.xlam="xlam",e.xla="xla",e.xlw="xlw",e.xlr="xlr",e.prn="prn",e.txt="txt",e.csv="csv",e.dif="dif",e.slk="slk"}(e.ExcelFileFormats||(e.ExcelFileFormats={}));var Vi,zi,ji=function(){function e(e){this.parent=e}return e.prototype.getModuleName=function(){return"calc-common"},e}(),_i=function(){function n(e){this.formulas=[{formulaName:"SUM",category:"Math & Trig",description:"Sums individual values, cell references or ranges."},{formulaName:"SUMIFS",category:"Math & Trig",description:"Sums the cells specified by a given set of conditionsor criteria."},{formulaName:"SUMPRODUCT",category:"Math & Trig",description:"Returns sum of the product of given ranges of arrays."},{formulaName:"ABS",category:"Math & Trig",description:"Returns the absolute value of a number."},{formulaName:"RAND",category:"Math & Trig",description:"Return a random number between 0 and 1."},{formulaName:"FLOOR",category:"Math & Trig",description:"Returns the round a number down to the nearest integer."},{formulaName:"CEILING",category:"Math & Trig",description:"Returns a number rounded up to a multiple of another number."},{formulaName:"SUMIF",category:"Math & Trig",description:"It will sum up cells that meet the given criteria."},{formulaName:"PRODUCT",category:"Math & Trig",description:"Multiplies all the numbers given as arguments and returns the product."},{formulaName:"AVERAGE",category:"Statistical",description:"The sum of the numbers divided by how many numbers are being averaged."},{formulaName:"AVERAGEIF",category:"Statistical",description:"Computes the average of the numbers in a range that meet the supplied criteria."},{formulaName:"COUNT",category:"Statistical",description:"Counts the numbers in the list of arguments, exclude text entries."},{formulaName:"COUNTA",category:"Statistical",description:"Counts the non-empty values in the list of arguments."},{formulaName:"COUNTIF",category:"Statistical",description:"Counts the number of cells in a range that meet a specified condition."},{formulaName:"COUNTIFS",category:"Statistical",description:"Counts the number of times each cells in all the ranges that meet the specific conditions."},{formulaName:"AVERAGEA",category:"Statistical",description:"Calculates the average of values in the list of arguments.Arguments can be numbers, names, arrays or references."},{formulaName:"AVERAGEIFS",category:"Statistical",description:"Conditionally returns the average of the contents of cells for the set of ranges."},{formulaName:"MIN",category:"Statistical",description:"Returns the smaller number in set of arguments."},{formulaName:"MAX",category:"Statistical",description:"Returns the largest number in set of arguments."},{formulaName:"DATE",category:"Date",description:"Returns the date, given the year, month and day of the month."},{formulaName:"DAY",category:"Date",description:"Returns the day of a given date."},{formulaName:"TODAY",category:"Date",description:"Returns the current date as date value."},{formulaName:"DAYS",category:"Date",description:"Returns the number of days between two dates."},{formulaName:"WEEKDAY",category:"Date",description:"Returns the day of the week corresponding to a date."},{formulaName:"IF",category:"Logical",description:"Returns one value if a logical expression is TRUE and another if it is FALSE"},{formulaName:"AND",category:"Logical",description:"Returns TRUE if all the arguments are considered TRUE, and FALSE otherwise."},{formulaName:"IFS",category:"Logical",description:"Checks multiple conditions and returns a value corresponding to the first TRUE result."},{formulaName:"IFERROR",category:"Logical",description:"Returns a value you specify if a formula evaluates to an error; otherwise, it returns the result of the formula."},{formulaName:"CHOOSE",category:"Lookup & Reference",description:"Returns a value from a list, given an index number."},{formulaName:"INDEX",category:"Lookup & Reference",description:"Returns a value from a table, given a row and column number."},{formulaName:"FIND",category:"Text",description:"Returns the position of a string of text within another string."},{formulaName:"CONCATENATE",category:"Text",description:" Used to join two or more strings together."},{formulaName:"CONCAT",category:"Text",description:"Concatenates a list or range of text strings."},{formulaName:"SUBTOTAL",category:"Lookup & Reference",description:"Returns a subtotal in a list or database."},{formulaName:"RADIANS",category:"Math & Trig",description:"Converts degrees to radians."},{formulaName:"OR",category:"Logical",description:"Returns TRUE if any arguments considered TRUE, and all the arguments are FALSE it will return FALSE."},{formulaName:"NOT",category:"Logical",description:"Returns the inverse of a given logical expression."},{formulaName:"MATCH",category:"Lookup & Reference",description:"Returns the relative position of an checked item in range that matches a specified value in a specified order"},{formulaName:"RANDBETWEEN",category:"Math & Trig",description:"Returns an integer random number in a specified range."},{formulaName:"SLOPE",category:"Statistical",description:"Returns the slope of the line from linear regression of the data points."},{formulaName:"INTERCEPT",category:"Statistical",description:"Calculates the point of the Y-intercept line via linear regression."},{formulaName:"RSQ",category:"Statistical",description:"Returns the square of the Pearson product moment correlation coefficient based on data points in known_ys and known_xs"},{formulaName:"UNIQUE",category:"Lookup & Reference",description:"Returns a unique values from a range or array."},{formulaName:"ROUNDUP",category:"Math & Trig",description:"Rounds a number away from zero."},{formulaName:"ROUNDDOWN",category:"Math & Trig",description:"Rounds a number down, toward zero."},{formulaName:"INT",category:"Math & Trig",description:"Returns a number to the nearest integer."},{formulaName:"LN",category:"Math & Trig",description:"Returns the natural logarithm of a number."},{formulaName:"ISNUMBER",category:"Information",description:"Returns TRUE, if the argument is number and FALSE otherwise."},{formulaName:"ROUND",category:"Math & Trig",description:"Rounds a number to a specified number of digits."},{formulaName:"LOG",category:"Math & Trig",description:"Returns the logarithm of a number to the base that you specify."},{formulaName:"POWER",category:"Math & Trig",description:"Returns the result of a number raised to power."},{formulaName:"SQRT",category:"Math & Trig",description:"Returns the square root of a positive number."},{formulaName:"TRUNC",category:"Math & Trig",description:"Returns the truncated value of a number to a specified number of decimal places."},{formulaName:"EXP",category:"Math & Trig",description:"Returns e raised to the power of the given number."},{formulaName:"GEOMEAN",category:"Statistical",description:"Returns the geometric mean of an array or range of positive data."},{formulaName:"TEXT",category:"Lookup & Reference",description:"Converts a value to text in specified number format."},{formulaName:"SORT",category:"Lookup & Reference",description:"Sorts a range of an array."},{formulaName:"LOOKUP",category:"Lookup & Reference",description:"Looks for a value in a one-row or one-column range, then returns a value from the same position in a second one-row or one-column range."},{formulaName:"VLOOKUP",category:"Lookup & Reference",description:"Looks for a specific value in the first column of a lookup range and returns a corresponding value from a different column within the same row."},{formulaName:"HLOOKUP",category:"Lookup & Reference",description:"Looks for a value in the top row of the array of values and then returns a value in the same column from a row in the array that you specify."},{formulaName:"T",category:"Text",description:"Checks whether a value is text or not and returns the text."},{formulaName:"EXACT",category:"Text",description:"Checks whether a two text strings are exactly same and returns TRUE or FALSE."},{formulaName:"LEN",category:"Text",description:"Returns a number of characters in a given string."},{formulaName:"MOD",category:"Math & Trig",description:"Returns a remainder after a number is divided by divisor."},{formulaName:"ODD",category:"Math & Trig",description:"Rounds a positive number up and negative number down to the nearest odd integer."},{formulaName:"PI",category:"Math & Trig",description:"Returns the value of pi."},{formulaName:"COUNTBLANK",category:"Statistical",description:"Returns the number of empty cells in a specified range of cells."},{formulaName:"EVEN",category:"Math & Trig",description:"Rounds a positive number up and negative number down to the nearest even integer."},{formulaName:"FACT",category:"Math & Trig",description:"Returns the factorial of a number."},{formulaName:"DECIMAL",category:"Math & Trig",description:"Converts a text representation of a number in a given base into a decimal number."},{formulaName:"DEGREES",category:"Math & Trig",description:"Converts radians to degrees."},{formulaName:"ADDRESS",category:"Lookup & Reference",description:"Returns a cell reference as text, given specified row and column numbers."},{formulaName:"TIME",category:"Date & Time",description:"Converts hours, minutes, seconds to the time formatted text."},{formulaName:"CHAR",category:"Text",description:"Returns the character from the specified number."},{formulaName:"CODE",category:"Text",description:"Returns the numeric code for the first character in a given string."},{formulaName:"DOLLAR",category:"Text",description:"Converts the number to currency formatted text."},{formulaName:"SMALL",category:"Statistical",description:"Returns the k-th smallest value in a given array."},{formulaName:"LARGE",category:"Statistical",description:"Returns the k-th largest value in a given array."},{formulaName:"MEDIAN",category:"Statistical",description:"Returns the median of the given set of numbers."},{formulaName:"EDATE",category:"Date & Time",description:"Returns a date with given number of months before or after the specified date."},{formulaName:"EOMONTH",category:"Date & Time",description:"Returns the last day of the month that is a specified number of months before or after an initially supplied start date."},{formulaName:"DATEVALUE",category:"Date & Time",description:"Converts a date string into date value."},{formulaName:"HOUR",category:"Date & Time",description:"Returns the number of hours in a specified time string."},{formulaName:"MINUTE",category:"Date & Time",description:"Returns the number of minutes in a specified time string."},{formulaName:"SECOND",category:"Date & Time",description:"Returns the number of seconds in a specified time string."},{formulaName:"NOW",category:"Date & Time",description:"Returns the current date and time."},{formulaName:"MONTH",category:"Date & Time",description:"Returns the number of months in a specified date string."},{formulaName:"PROPER",category:"Text",description:"Converts a text to proper case; first letter to uppercase and other letters to lowercase."}],this.isConcat=!1,this.parent=e,this.init()}return n.prototype.init=function(){for(var e,r=0;r<this.formulas.length;r++)e=t.getValue("Compute"+this.formulas[r].formulaName,this).bind(this),this.addFormulaCollection(this.formulas[r].formulaName.toUpperCase(),e,this.formulas[r].category,this.formulas[r].description)},n.prototype.addFormulaCollection=function(e,t,r,n){this.parent.libraryFormulas={fName:e,handler:t,category:r,description:n}},n.prototype.ComputeSUM=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i,a,o=!1;if(r.length){var s=r[r.length-1];"isSubtotal"===s?(o=!0,r.pop()):"isAggregate"===s&&(a=this.parent.parentObject.getActiveSheet(),i=!0,r.pop())}if(t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];var l,d,h,p=0,c=0;if(!t.isNullOrUndefined(r))for(var f=r,g=function(e){e.toString().indexOf(".")>-1&&(c=Math.max(c,e.split(".")[1].length))},m=0;m<f.length;m++){var v=f[m].toString();if(v.indexOf(":")>-1&&this.parent.isCellReference(v)){for(var y=this.parent.getCellCollection(v.split(this.parent.tic).join("")),C=0;C<y.length;C++)if(!(i&&(h=u(y[C]),tt(a,h[0])||ht(a,h[1]))||(l=o?this.parent.getValueFromArg(y[C],null,null,!0):this.parent.getValueFromArg(y[C]),o&&l.includes("SUBTOTAL(")))){if(this.parent.getErrorStrings().indexOf(l)>-1)return l;t.isNullOrUndefined(l[0])||isNaN(this.parent.parseFloat(l))||(g(l),p+=this.parent.parseFloat(l))}}else{if(f[m].indexOf(this.parent.tic)>-1&&(isNaN(this.parent.parseFloat(f[m].split(this.parent.tic).join("")))||""===f[m].split(this.parent.tic).join("").trim()))return this.parent.getErrorStrings()[e.CommonErrors.Value];if(f[m].split(this.parent.tic).join("")===this.parent.trueValue&&(f[m]="1"),f[m].split(this.parent.tic).join("")===this.parent.falseValue&&(f[m]="0"),d=o?this.parent.getValueFromArg(f[m].split(this.parent.tic).join(""),null,null,!0):this.parent.getValueFromArg(f[m].split(this.parent.tic).join("")),o&&d.includes("SUBTOTAL("))continue;if(this.parent.getErrorStrings().indexOf(d)>-1)return d;if(t.isNullOrUndefined(d)||isNaN(this.parent.parseFloat(d)))continue;d.length>0&&(g(d),p+=this.parent.parseFloat(d+""))}}return p.toString().indexOf(".")>-1?p.toFixed(c):p},n.prototype.ComputeINT=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n,i=this.parent.getErrorStrings();return""===t[0]&&1===t.length?this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments]:t.length>1?this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments]:(n=this.parent.getValueFromArg(t[0]),i.indexOf(n)>-1?n:(n.toUpperCase()===this.parent.trueValue?n="1":n.toUpperCase()===this.parent.falseValue&&(n="0"),this.parent.isCellReference(t[0])||(-1===t[0].indexOf(this.parent.tic+this.parent.tic)&&(n=n.split(this.parent.tic).join("")),""!==n.trim())?(n.indexOf("%")>-1&&(n=(.01*Number(n.split("%")[0])).toString()),isNaN(this.parent.parseFloat(n))?i[e.CommonErrors.Value]:(n=this.parent.parseFloat(n),n=Math.floor(n))):i[e.CommonErrors.Value]))},n.prototype.ComputeTODAY=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n;if(1!==t.length||""!==t[0])n=this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];else{var i=new Date(Date.now());"spreadsheet"===this.parent.parentObject.getModuleName()?(n=this.parent.parentObject.dateToInt(i),0===this.parent.parser.storedStringText.toUpperCase().indexOf("TODAY")&&""!==this.parent.cell&&this.parent.parentObject.setDateFormat(this.parent.getSheetId(this.parent.grid),this.parent.rowIndex(this.parent.cell)-1,this.parent.colIndex(this.parent.cell)-1)):n=i.getFullYear()+"/"+this.parent.calculateDate((i.getMonth()+1).toString())+"/"+this.parent.calculateDate(i.getDate().toString())}return n},n.prototype.ComputeWEEKDAY=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(""===r[0]&&t.isNullOrUndefined(r[1])||r.length>2)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];if(""===r[0]&&""===r[1]||""===r[1])return this.parent.getErrorStrings()[e.CommonErrors.Num].toString();if(1===r.length&&r.push("1"),r[0].indexOf(this.parent.tic)>-1&&""===r[0].split(this.parent.tic).join("").trim()||""===r[1].split(this.parent.tic).join("").trim()||r[1].indexOf(this.parent.tic)>-1&&isNaN(this.parent.parseFloat(r[1].split(this.parent.tic).join(""))))return this.parent.getErrorStrings()[e.CommonErrors.Value];var i,a,o;if(this.parent.isCellReference(r[0])){if((i=this.parent.getValueFromArg(r[0].split(this.parent.tic).join(""))||"0").indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[e.CommonErrors.Value]}else i=r[0].indexOf(this.parent.tic)>-1&&isNaN(this.parent.parseFloat(r[0].split(this.parent.tic).join("")))?this.parent.getValueFromArg(r[0]):this.parent.getValueFromArg(r[0].split(this.parent.tic).join(""))||"0";if(a=this.parent.isCellReference(r[1])?this.parent.getValueFromArg(r[1].split(this.parent.tic).join(""))||"0":this.parent.getValueFromArg(r[1].split(this.parent.tic).join("")),this.parent.getErrorStrings().indexOf(i)>-1)return i;if(this.parent.getErrorStrings().indexOf(a)>-1)return a;if(i=i===this.parent.trueValue?"1":i===this.parent.falseValue?"0":i,a=a===this.parent.trueValue?"1":a===this.parent.falseValue?"0":a,o=this.parent.parseFloat(i),a=this.parent.parseFloat(a),isNaN(a)||isNaN(o))return this.parent.getErrorStrings()[e.CommonErrors.Value];if(o<0||o>2958465)return this.parent.getErrorStrings()[e.CommonErrors.Num].toString();switch(a=parseInt(a.toString(),10),o=o<1?0:Math.floor(o)%7,a){case 1:case 17:o=o<=0?o+7:o;break;case 2:case 11:o=(o-=1)<=0?o+7:o;break;case 3:o=(o-=2)<0?o+7:o;break;case 12:o=(o+=5)>7?o-7:o;break;case 13:o=(o+=4)>7?o-7:o;break;case 14:o=(o+=3)>7?o-7:o;break;case 15:o=(o+=2)>7?o-7:o;break;case 16:o=(o+=1)>7?o-7:o;break;default:o=this.parent.getErrorStrings()[e.CommonErrors.Num].toString()}return o},n.prototype.ComputePROPER=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i,a,o=this.parent.getErrorStrings();return r.length&&"nestedFormulaTrue"===r[r.length-1]&&(a=!0,r.pop()),t.isNullOrUndefined(r)||""===r[0].trim()&&1===r.length?this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments]:r.length>1?this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments]:(i=this.parent.getValueFromArg(r[0]).trim(),o.indexOf(i)>-1?i:(r[0].indexOf(this.parent.tic)>-1?r[0]!==i&&r[0].startsWith("n")?i=this.parent.removeTics(i.trim()):(i=this.parent.removeTics(r[0].trim())).indexOf(this.parent.tic+this.parent.tic)>-1&&(i=i.replace(/""/g,this.parent.tic)):!r[0].startsWith("n")&&2===i.split("%").length&&this.parent.isNumber(i.split("%")[0])&&(i=(Number(i.split("%")[0])/100).toString()),i=i.toLowerCase().replace(/\b\w/g,function(e){return e.toUpperCase()}).replace(/(\d)([a-z])/g,function(e,t,r){return t+r.toUpperCase()}),a&&(i=this.parent.tic+i+this.parent.tic),i))},n.prototype.ComputeSUMPRODUCT=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i,a;if(t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];for(var o,s=0,l=0,d=null,h=r,p=[],c=0;c<h.length;c++)p.push(this.parent.getCellCollection(h[c]).length);for(var u=0;u<p.length;u++)if(p[u]&&p[u+1]&&p[u]!==p[u+1])return this.parent.getErrorStrings()[e.CommonErrors.Value];for(var f=0;f<h.length;++f){var g=h[f];if(g.startsWith(this.parent.tic)||!this.parent.isCellReference(g)){var m=this.parent.getValueFromArg(g);return o=m.indexOf('"'),this.parent.getErrorStrings().indexOf(m)>-1?m:o>-1?0:this.parent.getErrorStrings()[e.CommonErrors.Value]}var c=g.indexOf(":"),v=this.parent.rowIndex(g.substr(0,c)),y=this.parent.rowIndex(g.substr(c+1));if(!(-1!==v||-1===y)==(-1===v||-1!==y))return this.parent.getErrorStrings()[e.CommonErrors.Name];v>y&&(v=(i=[y,v])[0],y=i[1]);var C=this.parent.colIndex(g.substr(0,c)),b=this.parent.colIndex(g.substr(c+1));if(C>b&&(C=(a=[b,C])[0],b=a[1]),null===d)for(l=(y-v+1)*(b-C+1),d=[],c=0;c<l;++c)d[c]=1;c=0;for(var x=v;x<=y;++x)for(var S=C;S<=b;++S){var w=this.getSheetReference(g)+this.parent.convertAlpha(S)+x,I=this.parent.getValueFromArg(w);if(this.parent.getErrorStrings().indexOf(I)>-1)return I;if(isNaN(this.parent.parseFloat(I)))d[c]=0;else{if(isNaN(d[c]))return this.parent.getErrorStrings()[e.CommonErrors.Name];d[c]=d[c]*this.parent.parseFloat(I)}c++}}for(c=0;c<l;++c)s+=d[c];return s},n.prototype.ComputeROUNDUP=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i,a,o,s,l,d=r.length;if(!t.isNullOrUndefined(r)&&d>2&&(i=this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments]),1===d&&""!==r[0])s=r[0].indexOf('"'),a="TRUE"===(a=(a=r[0].indexOf('"')>-1?r[0].replace('"',""):r[0]).indexOf('"')>-1?a.replace('"',""):a).toUpperCase()?"1":"FALSE"===a?"0":a,a=this.parent.getValueFromArg(a),(l=this.parent.parseFloat(a))>0?l+=.4999999999:l<0&&(l-=.4999999999),i=(l=this.parent.parseFloat(l.toFixed(0))).toString();else if(2===d){if(s=r[0].indexOf('"')>-1?r[0].indexOf('"'):r[1].indexOf('"')>-1?r[1].indexOf('"'):-1,this.parent.isCellReference(r[0]))a=this.parent.getValueFromArg(r[0])||"0";else{if(r[0].indexOf(this.parent.tic)>-1&&(r[0].split(this.parent.tic).join("")===this.parent.trueValue||r[0].split(this.parent.tic).join("")===this.parent.falseValue))return this.parent.getErrorStrings()[e.CommonErrors.Value];a=this.parent.getValueFromArg(r[0]).split(this.parent.tic).join("")}if(this.parent.getErrorStrings().indexOf(a)>-1)return a;if(this.parent.isCellReference(r[1]))o=this.parent.getValueFromArg(r[1])||"0";else{if(r[1].indexOf(this.parent.tic)>-1&&(r[1].split(this.parent.tic).join("")===this.parent.trueValue||r[1].split(this.parent.tic).join("")===this.parent.falseValue))return this.parent.getErrorStrings()[e.CommonErrors.Value];o=this.parent.getValueFromArg(r[1]).split(this.parent.tic).join("")}if(this.parent.getErrorStrings().indexOf(o)>-1)return o;a="TRUE"===a.toUpperCase()?"1":"FALSE"===a?"0":a,o="TRUE"===o.toUpperCase()?"1":"FALSE"===o?"0":o;var h=isNaN(Number(a))||""===a.trim(),p=isNaN(Number(o))||""===o.trim();if((r[0].indexOf('"')>-1||this.parent.isCellReference(r[0]))&&h||(r[1].indexOf('"')>-1||this.parent.isCellReference(r[1]))&&p)return this.parent.getErrorStrings()[e.CommonErrors.Value];var c=Math.ceil(this.parent.parseFloat(o));if(l=this.parent.parseFloat(a),c>0){var u=a.split("."),f=2===u.length?u[1].length>=c?c:u[1].length:0;i=(l=this.parent.parseFloat(this.preciseRound(l,f,"ROUNDUP"))).toString(),isNaN(l)&&(i=c.toString().indexOf('"')>-1?this.parent.getErrorStrings()[e.CommonErrors.Value]:this.parent.getErrorStrings()[e.CommonErrors.Name])}else l>0?l=l/Math.pow(10,-c)+.49999:l<0&&(l=l/Math.pow(10,-c)-.49999),i=(l=l>0&&c<-9?1*Math.pow(10,-c):this.parent.parseFloat(l.toFixed(0))*Math.pow(10,-c)).toString(),isNaN(l)&&(i=c.toString().indexOf('"')>-1?this.parent.getErrorStrings()[e.CommonErrors.Value]:i=this.parent.getErrorStrings()[e.CommonErrors.Name])}else i=s>-1?this.parent.getErrorStrings()[e.CommonErrors.Value]:this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];return i},n.prototype.ComputeROUNDDOWN=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i,a,o,s,l,d=r.length;if(!t.isNullOrUndefined(r)&&d>2&&(i=this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments]),1===d&&""!==r[0])s=r[0].indexOf('"'),a="TRUE"===(a=(a=r[0].indexOf('"')>-1?r[0].replace('"',""):r[0]).indexOf('"')>-1?a.replace('"',""):a).toUpperCase()?"1":"FALSE"===a?"0":a,a=this.parent.getValueFromArg(a),(l=this.parent.parseFloat(a))>0?l-=.4999999999:l<0&&(l+=.4999999999),i=(l=this.parent.parseFloat(l.toFixed(0))).toString();else if(2===d){if(s=r[0].indexOf('"')>-1?r[0].indexOf('"'):r[1].indexOf('"')>-1?r[1].indexOf('"'):-1,this.parent.isCellReference(r[0]))a=this.parent.getValueFromArg(r[0])||"0";else{if(r[0].indexOf(this.parent.tic)>-1&&(r[0].split(this.parent.tic).join("")===this.parent.trueValue||r[0].split(this.parent.tic).join("")===this.parent.falseValue))return this.parent.getErrorStrings()[e.CommonErrors.Value];a=this.parent.getValueFromArg(r[0]).split(this.parent.tic).join("")}if(this.parent.getErrorStrings().indexOf(a)>-1)return a;if(this.parent.isCellReference(r[1]))o=this.parent.getValueFromArg(r[1])||"0";else{if(r[1].indexOf(this.parent.tic)>-1&&(r[1].split(this.parent.tic).join("")===this.parent.trueValue||r[1].split(this.parent.tic).join("")===this.parent.falseValue))return this.parent.getErrorStrings()[e.CommonErrors.Value];o=this.parent.getValueFromArg(r[1]).split(this.parent.tic).join("")}if(this.parent.getErrorStrings().indexOf(o)>-1)return o;a="TRUE"===a.toUpperCase()?"1":"FALSE"===a?"0":a,o="TRUE"===o.toUpperCase()?"1":"FALSE"===o?"0":o;var h=isNaN(Number(a))||""===a.trim(),p=isNaN(Number(o))||""===o.trim();if((r[0].indexOf('"')>-1||this.parent.isCellReference(r[0]))&&h||(r[1].indexOf('"')>-1||this.parent.isCellReference(r[1]))&&p)return this.parent.getErrorStrings()[e.CommonErrors.Value];var c=Math.ceil(this.parent.parseFloat(o));if(l=this.parent.parseFloat(a),c>0){var u=a.indexOf("."),f=0;-1!==u&&(f=(f=a.length-u-1)>=c?c:f),i=(l=this.parent.parseFloat(this.preciseRound(l,f,"ROUNDDOWN"))).toString(),isNaN(l)&&(i=c.toString().indexOf('"')>-1?this.parent.getErrorStrings()[e.CommonErrors.Value]:this.parent.getErrorStrings()[e.CommonErrors.Name])}else l>0?l=l/Math.pow(10,-c)-.49999:l<0&&(l=l/Math.pow(10,-c)+.49999),i=(l=l>0&&c<-9?1*Math.pow(10,-c):this.parent.parseFloat(l.toFixed(0))*Math.pow(10,-c)).toString(),isNaN(l)&&(i=c.toString().indexOf('"')>-1?this.parent.getErrorStrings()[e.CommonErrors.Value]:i=this.parent.getErrorStrings()[e.CommonErrors.Name])}else i=s>-1?this.parent.getErrorStrings()[e.CommonErrors.Value]:this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];return i},n.prototype.ComputeCOUNT=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=!1;if(r.length&&"isSubtotal"===r[r.length-1]&&(i=!0,r.pop()),t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];for(var a,o,s,l,d=r,h=0,p=0;p<d.length;p++)if(a=d[p],this.parent.isCellReference(a))if(a.indexOf(":")>-1){o=this.parent.getCellCollection(a.split(this.parent.tic).join(""));for(var c=0;c<o.length;c++)s=i?this.parent.getValueFromArg(o[c],null,null,!0):this.parent.getValueFromArg(o[c]),i&&s.includes("SUBTOTAL(")||isNaN(this.parent.parseFloat(s))||a.length>0&&""!==s.trim()&&h++}else{if(s=i?this.parent.getValueFromArg(a,null,null,!0):this.parent.getValueFromArg(a),i&&s.includes("SUBTOTAL("))continue;isNaN(this.parent.parseFloat(s))||a.length>0&&""!==s.trim()&&h++}else l=this.parent.getValueFromArg(a).split(this.parent.tic).join(""),0===a.length&&""===l.trim()?h++:isNaN(this.parent.parseFloat(l))&&a!==this.parent.trueValue&&a!==this.parent.falseValue||a.length>0&&""!==a.trim()&&""!==l.trim()&&h++;return h},n.prototype.ComputeDATE=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i;if(r.length&&"nestedFormulaTrue"===r[r.length-1]&&(i=!0,r.pop()),t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];if(3!==r.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];for(var a=[],o=0;o<r.length;++o)a[o]=this.parent.getValueFromArg(r[o]);a[0]=a[0]===this.parent.trueValue?"1":a[0]===this.parent.falseValue?"0":a[0],a[1]=a[1]===this.parent.trueValue?"1":a[1]===this.parent.falseValue?"0":a[1],a[2]=a[2]===this.parent.trueValue?"1":a[2]===this.parent.falseValue?"0":a[2];for(var s=0;s<a.length;s++){var l=a[s];if(this.parent.getErrorStrings().indexOf(l)>-1)return l;if('""'===l||'"0"'===l&&'"0"'!==r[s]||'"TRUE"'===l||'"FALSE"'===l)return this.parent.getErrorStrings()[e.CommonErrors.Value].toString()}var d=Math.floor(this.parent.parseFloat(a[0].split(this.parent.tic).join(""))),h=Math.floor(this.parent.parseFloat(a[1].split(this.parent.tic).join(""))),p=Math.floor(this.parent.parseFloat(a[2].split(this.parent.tic).join(""))),c=0;if(isNaN(d)||isNaN(h)||isNaN(p))return this.parent.getErrorStrings()[e.CommonErrors.Value].toString();if(d<0&&h<=12||d>=1e4&&h>0)return this.parent.getErrorStrings()[e.CommonErrors.Num].toString();for(;h>12;)h-=12,d++;if(0===(c=this.parent.getSerialDateFromDate(d,h,p)))return this.parent.getErrorStrings()[e.CommonErrors.Num].toString();var u=this.parent.fromOADate(c);if("Invalid Date"!==u.toString()){if(u.getFullYear()<1900||1e4<=u.getFullYear())return this.parent.getErrorStrings()[e.CommonErrors.Num].toString();if(!i)return new t.Internationalization(this.parent.parentObject.locale||"en-US").formatDate(u,{type:"date",skeleton:"yMd"})}return c.toString()},n.prototype.ComputeFLOOR=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];var i,a=r;if(2!==a.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];if(""===a[0]&&""===a[1]||""===a[0]&&!a[1].includes('"'))return 0;""!==a[1]||a[0].includes('"')||(a[1]="0");for(var o=0;o<a.length;o++){var s=a[o].split(this.parent.tic).join("").trim();if(""===s||a[o].indexOf(this.parent.tic)>-1&&isNaN(this.parent.parseFloat(s)))return this.parent.getErrorStrings()[e.CommonErrors.Value];if(O(a[o])){if(i=this.parent.getValueFromArg(a[o])||"0",(i=i===this.parent.trueValue?"1":i===this.parent.falseValue?"0":i).toUpperCase().match(/[A-Z]/)||i.includes('"')||!this.parent.isNumber(i))return this.parent.getErrorStrings()[e.CommonErrors.Value]}else if(i=this.parent.getValueFromArg(a[o].split(this.parent.tic).join("")),(i=i===this.parent.trueValue?"1":i===this.parent.falseValue?"0":i).toUpperCase().match(/[A-Z]/)||i.includes('"')||!this.parent.isNumber(i))return this.parent.getErrorStrings()[e.CommonErrors.Value];a[o]=i}var l=this.parent.parseFloat(a[0]),d=this.parent.parseFloat(a[1]);return l>0&&d<0?this.parent.getErrorStrings()[e.CommonErrors.Num]:(l>0||l<0)&&0===d?this.parent.getErrorStrings()[e.CommonErrors.DivZero]:isNaN(l)?this.parent.getErrorStrings()[e.CommonErrors.Name]:0===l&&0===d?0:Math.floor(l/d)*d},n.prototype.ComputeCEILING=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];var i,a=r;if(2!==a.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];if(""===a[0]&&""===a[1]||""===a[0]&&!a[1].includes('"'))return 0;""!==a[1]||a[0].includes('"')||(a[1]="0");for(var o=0;o<a.length;o++){var s=a[o].split(this.parent.tic).join("").trim();if(""===s||a[o].indexOf(this.parent.tic)>-1&&isNaN(this.parent.parseFloat(s)))return this.parent.getErrorStrings()[e.CommonErrors.Value];if(O(a[o])){if(i=this.parent.getValueFromArg(a[o])||"0",(i=i===this.parent.trueValue?"1":i===this.parent.falseValue?"0":i).toUpperCase().match(/[A-Z]/)||i.includes('"')||!this.parent.isNumber(i))return this.parent.getErrorStrings()[e.CommonErrors.Value]}else if(i=this.parent.getValueFromArg(a[o].split(this.parent.tic).join("")),(i=i===this.parent.trueValue?"1":i===this.parent.falseValue?"0":i).toUpperCase().match(/[A-Z]/)||i.includes('"')||!this.parent.isNumber(i))return this.parent.getErrorStrings()[e.CommonErrors.Value];a[o]=i}var l=this.parent.parseFloat(a[0]),d=this.parent.parseFloat(a[1]);return l>0&&d<0?this.parent.getErrorStrings()[e.CommonErrors.Num]:isNaN(l)?this.parent.getErrorStrings()[e.CommonErrors.Name]:(l>0||0===l)&&0===d?0:Math.ceil(l/d)*d},n.prototype.ComputeDAY=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i,a,o=this.parent.getErrorStrings();if(t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];if(r.length>1)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];if(r[0].startsWith(this.parent.tic)){if(""===(a=r[0].split(this.parent.tic).join(""))||a===this.parent.trueValue||a===this.parent.falseValue)return o[e.CommonErrors.Value]}else if(a=this.parent.getValueFromArg(r[0].split(this.parent.tic).join("")),this.parent.isCellReference(r[0])&&a.indexOf(this.parent.tic)>-1)return o[e.CommonErrors.Value];return o.indexOf(a)>-1?a:Number(a)<0?o[e.CommonErrors.Num]:0===Math.floor(Number(a))||a===this.parent.falseValue?0:a===this.parent.trueValue?1:(i=this.parent.isNaN(Number(a))?this.parent.parseDate(a):this.parent.intToDate(a),"[object Date]"===Object.prototype.toString.call(i)&&(i=new Date(i).getFullYear()<1900||new Date(i).getFullYear()>9999?this.parent.isNumber(a)?"Num":"NaN":i.getDate()),"NaN"===i.toString()?o[e.CommonErrors.Value]:"Num"===i.toString()?o[e.CommonErrors.Num]:i)},n.prototype.ComputeIF=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i;if(r.length&&"nestedFormulaTrue"===r[r.length-1]&&(i=!0,r.pop()),t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];if(this.parent.getErrorStrings().indexOf(r[0])>0)return r[0];var a,o=r;4===o.length&&"nestedFormulaTrue"===o[3]&&(a=!0,o.pop());var s,l;if(o.length>3||1===o.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];if(o.length<=3){var d=void 0,h=void 0,p="";if(s=this.parent.getValueFromArg(o[0]),this.parent.getErrorStrings().indexOf(s)>-1)return s;var c=s.toUpperCase(),u=this.parent.parseFloat(s);if(c===this.parent.trueValue||u<0||u>0){if(i&&o[1].includes(":")){d=this.parent.getCellCollection(o[1]);for(f=0;f<d.length;f++)h=this.parent.getValueFromArg(d[f]),isNaN(this.parent.parseFloat(h))||(p+=h+",");return p.slice(0,p.length-1)}l=""===o[1]?"0":this.parent.getValueFromArg(o[1])}else{if(c!==this.parent.falseValue&&0!==u)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.Requires3Args];if(t.isNullOrUndefined(o[2]))return this.parent.falseValue;if(i&&o[2].includes(":")){d=this.parent.getCellCollection(o[2]);for(var f=0;f<d.length;f++)h=this.parent.getValueFromArg(d[f]),isNaN(this.parent.parseFloat(h))||(p+=h+",");return p.slice(0,p.length-1)}l=""===o[2]?"0":this.parent.getValueFromArg(o[2])}}return!a&&l.indexOf(this.parent.tic)>-1?l.split(this.parent.tic).join(""):""===l?"0":l},n.prototype.ComputeIFERROR=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];var i,a=r;if(2!==a.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];if(this.parent.isCellReference(a[0])){if(i=this.parent.getValueFromArg(a[0])||"0",-1===this.parent.getErrorStrings().indexOf(i)&&"NaN"!==i)return i}else if(i=this.parent.getValueFromArg(a[0],null,!0)||"0",-1===this.parent.getErrorStrings().indexOf(i)&&"NaN"!==i)return i=i.split(this.parent.tic).join("").trim();return i=this.parent.isCellReference(a[1])?this.parent.getValueFromArg(a[1])||"0":(i=this.parent.getValueFromArg(a[1])||"0").split(this.parent.tic).join("").trim()},n.prototype.ComputePRODUCT=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=!1;if(r.length&&"isSubtotal"===r[r.length-1]&&(i=!0,r.pop()),t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];var a,o,s,l=1,d=!0;if(!t.isNullOrUndefined(r))for(var h=r,p=0;p<h.length;p++){var c=h[p];if(c.indexOf(":")>-1&&this.parent.isCellReference(c)){for(var u=this.parent.getCellCollection(c),f=0;f<u.length;f++)if(a=i?this.parent.getValueFromArg(u[f],null,null,!0):this.parent.getValueFromArg(u[f]),(!i||!a.includes("SUBTOTAL("))&&fe(a)){if(this.parent.getErrorStrings().indexOf(a)>-1)return a;s=this.parent.parseFloat(a),isNaN(s)||a.length>0&&(l*=s,d=!1)}}else if(-1===c.indexOf(":")&&this.parent.isCellReference(c)){if(o=i?this.parent.getValueFromArg(h[p],null,null,!0):this.parent.getValueFromArg(h[p]),i&&o.includes("SUBTOTAL("))continue;if(!fe(o))continue;if(this.parent.getErrorStrings().indexOf(o)>-1)return o}else{if((o=h[p]).indexOf(this.parent.tic)>-1&&""===o.split(this.parent.tic).join("").trim()||h[p].indexOf(this.parent.tic)>-1&&isNaN(this.parent.parseFloat(o.split(this.parent.tic).join(""))))return this.parent.getErrorStrings()[e.CommonErrors.Value];if(o=this.parent.getValueFromArg(h[p].split(this.parent.tic).join("")),o=o===this.parent.trueValue?"1":o===this.parent.falseValue?"0":o.split(this.parent.tic).join(""),this.parent.getErrorStrings().indexOf(o)>-1)return o}s=this.parent.parseFloat(o),isNaN(s)||o.length>0&&(l*=s,d=!1)}return d?"0":l.toString()},n.prototype.ComputeDAYS=function(){for(var r=this,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var a=this.parent.getErrorStrings();if(t.isNullOrUndefined(n)&&1===n.length&&""===n[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];if(2!==n.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];var o=function(t){var n=r.parent.getValueFromArg(t).trim();if(n.indexOf(r.parent.tic)>-1&&(""===(n=n.split(r.parent.tic).join("").trim())||r.parent.isCellReference(t)||n.toUpperCase()===r.parent.trueValue||n.toUpperCase()===r.parent.falseValue))return a[e.CommonErrors.Value];if((n=n.split(r.parent.tic).join("")).toUpperCase()===r.parent.trueValue)n="1";else if(""===n||n.toUpperCase()===r.parent.falseValue)n="0";else if(Number(n)<0)return a[e.CommonErrors.Num];var i={value:n.toString()};return r.parent.parentObject.notify(Zr,i),(i.isDate||i.isTime)&&(n=(r.parent.parseDate(n).getTime()/864e5).toString()),n},s=o(n[0]);if(a.indexOf(s)>-1)return s;var l=o(n[1]);if(a.indexOf(l)>-1)return l;var d=Math.floor(Number(s))-Math.floor(Number(l));return isNaN(d)?a[e.CommonErrors.Value]:d},n.prototype.ComputeUNIQUE=function(){for(var r=this,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var a,o,s=this.parent.getErrorStrings();if("isComputeExp"===n[n.length-1]&&(o=!0,n.pop()),t.isNullOrUndefined(n)||""===n[0]&&1===n.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];if(n.length>3)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];var l=function(n){if(t.isNullOrUndefined(n))return r.parent.falseValue;var i=r.parent.getValueFromArg(n);return s.indexOf(i)>-1?i:0===Number(i)?r.parent.falseValue:Number(i)<0||Number(i)>0?r.parent.trueValue:(r.parent.isCellReference(n)||(i=r.parent.removeTics(i)),i.toUpperCase()===r.parent.trueValue||i.toUpperCase()===r.parent.falseValue?i.toUpperCase():i.indexOf(r.parent.tic)>-1||n.indexOf(r.parent.tic)>-1?s[e.CommonErrors.Value]:s[e.CommonErrors.Name])},d=l(n[1]);if(s.indexOf(d)>-1)return d;var h=l(n[2]);if(s.indexOf(h)>-1)return h;var p=[];if(n[0].indexOf(":")>-1){if(t.isNullOrUndefined(n[0].match(/[0-9]/))){c=n[0].split(":");n[0]=c[0]+"1:"+c[1]+(this.parent.spreadSheetUsedRange[0]+1)}else if(t.isNullOrUndefined(n[0].toUpperCase().match(/[A-Z]/))){var c=n[0].split(":");n[0]="A"+c[0]+":"+Xe(this.parent.spreadSheetUsedRange[1]+1)+c[1]}var u=n[0].split(":");if(this.parent.isCellReference(u[0])&&this.parent.isCellReference(u[1])){for(var f=this.parent.dependencyCollection,g=0;g<f.length&&!o;g++)f[g].split(":")[0]===n[0].split(":")[0]&&this.clearDependency(f[g]);-1===this.parent.dependencyCollection.indexOf(n[0])?o||this.parent.dependencyCollection.push(n[0]):this.clearDependency(n[0]);var m=n[0].indexOf(":"),v=void 0,y=this.parent.rowIndex(this.parent.substring(n[0],0,m)),C=this.parent.colIndex(this.parent.substring(n[0],0,m)),b=this.parent.rowIndex(this.parent.substring(n[0],m+1,m+n[0].length-m-1)),x=this.parent.colIndex(this.parent.substring(n[0],m+1,m+n[0].length-m-1));y>b&&(v=b,b=y,y=v),C>x&&(v=x,x=C,C=v);var S="";0===n[0].indexOf("!")&&(S=n[0].substring(0,n[0].replace("!","").indexOf("!")+2)),n[0]=S+Xe(C)+y+":"+Xe(x)+b;var w=x-C,I=this.parent.getCellCollection(n[0]),E=void 0,R=void 0;if(E=R=this.parent.actCell,d===this.parent.falseValue)if(0===w)for(g=0;g<I.length;g++)O=""===(O=this.parent.getValueFromArg(I[g]))?"0":O,p.push(O);else for(var N="",F=w,g=0;g<I.length;g++)g===I.length-1&&(N=N+(O=""===(O=this.parent.getValueFromArg(I[g]))?"0":O)+"++",p.push(N.substring(0,N.length-2))),g<=F?N=N+(O=""===(O=this.parent.getValueFromArg(I[g]))?"0":O)+"++":(p.push(N.substring(0,N.length-2)),F=w+g,N=(O=""===(O=this.parent.getValueFromArg(I[g]))?"0":O)+"++");else for(var N="",F=w+1,A=b-y,g=0;g<F;g++){for(var k=0;k<=A;k++){var O=this.parent.getValueFromArg(I[k*F+g]);N=N+(O=""===O?"0":O)+"++"}p.push(N.substring(0,N.length-2)),N=""}for(var T=[],D=[],L=[],P=[],g=0;g<p.length;g++)-1===T.indexOf(p[g].toLowerCase())?(T.push(p[g].toLowerCase()),L.push(p[g])):(-1===D.indexOf(p[g].toLowerCase())&&D.push(p[g].toLowerCase()),P.push(p[g]));if(h===this.parent.trueValue){for(var M=[],g=0;g<L.length;g++)-1===D.indexOf(L[g].toLowerCase())&&M.push(L[g]);if(0===(L=M).length)return s[e.CommonErrors.Calc]}if(o){var B;return 0!==w?(B=[],L.forEach(function(e){B=B.concat(e.split("++"))})):B=d===this.parent.falseValue?L:L[0].split("++"),B}E.indexOf("!")>-1&&(E=E.substring(E.lastIndexOf("!")+1));var H=this.parent.rowIndex(E),U=this.parent.colIndex(E);if(0===this.parent.dependencyLevel){var V=!1;if(d===this.parent.falseValue)for(var g=H,F=L.length+H;g<F;g++)for(var z=U,j=(X=L[0].split("++")).length+U;z<j;z++)g===F-1&&z===j-1&&-1===this.parent.uniqueRange.indexOf(R+":"+Xe(z)+g)&&this.parent.uniqueRange.push(R+":"+Xe(z)+g),this.checkSpill(z,g)&&(V=!0);else for(var g=U,F=L.length+U;g<F;g++)for(var _=H,j=(X=L[0].split("++")).length+H;_<j;_++)g===F-1&&_===j-1&&-1===this.parent.uniqueRange.indexOf(this.parent.actCell+":"+Xe(g)+_)&&this.parent.uniqueRange.push(this.parent.actCell+":"+Xe(g)+_),this.checkSpill(g,_)&&(V=!0);if(V)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.Spill]}else if(this.parent.dependencyLevel>0&&this.parent.getValueFromArg(Xe(U)+H,!0).indexOf("#SPILL!")>-1)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.Spill];if(d===this.parent.falseValue){var q=this.parent.getSheetFamilyItem(this.parent.grid),W="",G=void 0;null!==q.sheetNameToParentObject&&q.sheetNameToParentObject.size>0&&(G=(W=q.parentObjectToToken.get(this.parent.grid))+E);for(g=0;g<L.length;g++){X=L[g].split("++");g>0&&(H++,U=this.parent.colIndex(E));for(var Y=0;Y<X.length;Y++)this.setValueRefresh(X[Y],H,U),(g>0||Y>0)&&this.parent.refresh(W+Xe(U)+H.toString(),G),X[Y+1]&&U++}a=L[0].split("++")[0]}else{for(g=0;g<L.length;g++)for(var X=L[g].split("++"),K=0;K<X.length;K++)this.setValueRefresh(X[K],H,U),X[K+1]?H++:(U++,H=this.parent.rowIndex(E));a=L[0].split("++")[0]}}}else if(this.parent.isCellReference(n[0]))-1===this.parent.dependencyCollection.indexOf(n[0])?o||this.parent.dependencyCollection.push(n[0]):this.clearDependency(n[0]),a=this.parent.getValueFromArg(n[0]);else{if(a=this.parent.getValueFromArg(n[0].trim()),s.indexOf(a)>-1)return a;a=this.parent.removeTics(a)}return a},n.prototype.setValueRefresh=function(e,t,r){this.parent.parentObject.setValueRowCol(this.parent.getSheetId(this.parent.grid),e,t,r)},n.prototype.checkSpill=function(t,r){var n,i=!1,a=this.parent.getValueFromArg(Xe(t)+r,!0),o="!"+this.parent.getSheetID(this.parent.grid)+"!"+Xe(t)+r;return this.parent.getFormulaInfoTable().get(o)&&(n=this.parent.getFormulaInfoTable().get(o).formulaText),a&&(a.toUpperCase().indexOf("UNIQUE")<0||n&&!n.toUpperCase().includes("UNIQUE"))&&a!==this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments]&&(i=!0),i},n.prototype.clearDependency=function(e){var t=this.parent.actCell,r="";if(t.lastIndexOf("!")>-1){var n=t;t=n.substring(n.lastIndexOf("!")+1),r=n.substring(0,n.lastIndexOf("!"))+"!"}for(var i=this.parent.rowIndex(t),a=this.parent.colIndex(t),o=e.indexOf(":"),s=this.parent.rowIndex(this.parent.substring(e,0,o)),l=this.parent.colIndex(this.parent.substring(e,0,o)),d=this.parent.rowIndex(this.parent.substring(e,o+1,o+e.length-o-1))-s+i,h=this.parent.colIndex(this.parent.substring(e,o+1,o+e.length-o-1))-l+a,p=this.parent.getFormulaInfoTable().get("!"+this.parent.getSheetID(this.parent.grid)+"!"+t)?this.parent.getFormulaInfoTable().get("!"+this.parent.getSheetID(this.parent.grid)+"!"+t).getFormulaText():"",c=i;c<=d;c++)for(var u=a;u<=h;u++)if(this.parent.dependencyLevel>0||p.indexOf("UNIQUE")>-1){if(this.parent.getValueFromArg("!"+this.parent.getSheetID(this.parent.grid)+"!"+Xe(a)+i,!0).indexOf("#SPILL!")>-1)return;this.parent.parentObject.setValueRowCol(this.parent.getSheetID(this.parent.grid)+1,"",c,u),this.parent.refresh("!"+this.parent.getSheetID(this.parent.grid)+"!"+Xe(u)+c,t),this.parent.actCell=r+t}},n.prototype.ComputeT=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i,a,o=this.parent.getErrorStrings();if(r.length&&"nestedFormulaTrue"===r[r.length-1]&&(a=!0,r.pop()),t.isNullOrUndefined(r)||1===r.length&&""===r[0].trim())return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];if(r.length>1)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];if(i=this.parent.getValueFromArg(r[0]).trim(),o.indexOf(i)>-1)return i;if(r[0].indexOf(this.parent.tic)>-1)(i=this.parent.removeTics(r[0].trim())).indexOf(this.parent.tic+this.parent.tic)>-1&&(i=i.replace(/""/g,this.parent.tic));else if(2===i.split("%").length&&this.parent.isNumber(i.split("%")[0])&&(i=(Number(i.split("%")[0])/100).toString()),this.parent.isNumber(i)||i.toUpperCase()===this.parent.trueValue||i.toUpperCase()===this.parent.falseValue)return"";return a&&(i=this.parent.tic+i+this.parent.tic),i},n.prototype.ComputeHOUR=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(1!==r.length||t.isNullOrUndefined(r)||""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];if(""===r[0].split(this.parent.tic).join("").trim())return this.parent.getErrorStrings()[e.CommonErrors.Value];var i;if(this.parent.isCellReference(r[0])){if((i=this.parent.getValueFromArg(r[0].split(this.parent.tic).join(""))||"0").indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[e.CommonErrors.Value]}else{if(r[0].indexOf(this.parent.tic)>-1&&(r[0].split(this.parent.tic).join("")===this.parent.trueValue||r[0].split(this.parent.tic).join("")===this.parent.falseValue))return this.parent.getErrorStrings()[e.CommonErrors.Value];i=this.parent.getValueFromArg(r[0]).split(this.parent.tic).join("")}if(this.parent.getErrorStrings().indexOf(i)>-1)return i;i=i===this.parent.trueValue?"1":i===this.parent.falseValue?"0":i;var a;if(this.parent.isNumber(i)){if(this.parent.parseFloat(i)<0||this.parent.parseFloat(i)>2958465)return this.parent.getErrorStrings()[e.CommonErrors.Num];a=this.parent.intToTime(i)}else{var o={value:i.toString()};if(this.parent.parentObject.notify(Zr,o),!o.isDate&&!o.isTime)return this.parent.getErrorStrings()[e.CommonErrors.Value];a=o.dateObj}if("Invalid Date"===a.toString()&&(a=new Date(Date.parse(i))),"Invalid Date"===a.toString()){var s=new Date(Date.now()).toLocaleDateString()+" "+i;a=new Date(Date.parse(s))}return"Invalid Date"===a.toString()&&(a=this.parent.fromOADate(this.parent.parseFloat(i))),"Invalid Date"===a.toString()?this.parent.getErrorStrings()[e.CommonErrors.Value]:a.getFullYear()<1900||a.getFullYear()>9999?this.parent.getErrorStrings()[e.CommonErrors.Value]:a.getHours()},n.prototype.ComputeMINUTE=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(1!==r.length||t.isNullOrUndefined(r)||""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];if(""===r[0].split(this.parent.tic).join("").trim())return this.parent.getErrorStrings()[e.CommonErrors.Value];var i;if(this.parent.isCellReference(r[0])){if((i=this.parent.getValueFromArg(r[0].split(this.parent.tic).join(""))||"0").indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[e.CommonErrors.Value]}else{if(r[0].indexOf(this.parent.tic)>-1&&(r[0].split(this.parent.tic).join("")===this.parent.trueValue||r[0].split(this.parent.tic).join("")===this.parent.falseValue))return this.parent.getErrorStrings()[e.CommonErrors.Value];i=this.parent.getValueFromArg(r[0]).split(this.parent.tic).join("")}if(this.parent.getErrorStrings().indexOf(i)>-1)return i;i=i===this.parent.trueValue?"1":i===this.parent.falseValue?"0":i;var a;if(this.parent.isNumber(i)){if(this.parent.parseFloat(i)<0||this.parent.parseFloat(i)>2958465)return this.parent.getErrorStrings()[e.CommonErrors.Num];a=this.parent.intToTime(i)}else{var o={value:i.toString()};if(this.parent.parentObject.notify(Zr,o),!o.isDate&&!o.isTime)return this.parent.getErrorStrings()[e.CommonErrors.Value];a=o.dateObj}if("Invalid Date"===a.toString()&&(a=new Date(Date.parse(i))),"Invalid Date"===a.toString()){var s=new Date(Date.now()).toLocaleDateString()+" "+i;a=new Date(Date.parse(s))}return"Invalid Date"===a.toString()&&(a=this.parent.fromOADate(this.parent.parseFloat(i))),"Invalid Date"===a.toString()?this.parent.getErrorStrings()[e.CommonErrors.Value]:a.getFullYear()<1900||a.getFullYear()>9999?this.parent.getErrorStrings()[e.CommonErrors.Value]:a.getMinutes()},n.prototype.ComputeSECOND=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(1!==r.length||t.isNullOrUndefined(r)||""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];if(""===r[0].split(this.parent.tic).join("").trim())return this.parent.getErrorStrings()[e.CommonErrors.Value];var i;if(this.parent.isCellReference(r[0])){if((i=this.parent.getValueFromArg(r[0].split(this.parent.tic).join(""))||"0").indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[e.CommonErrors.Value]}else{if(r[0].indexOf(this.parent.tic)>-1&&(r[0].split(this.parent.tic).join("")===this.parent.trueValue||r[0].split(this.parent.tic).join("")===this.parent.falseValue))return this.parent.getErrorStrings()[e.CommonErrors.Value];i=this.parent.getValueFromArg(r[0]).split(this.parent.tic).join("")}if(this.parent.getErrorStrings().indexOf(i)>-1)return i;i=i===this.parent.trueValue?"1":i===this.parent.falseValue?"0":i;var a;if(this.parent.isNumber(i)){if(this.parent.parseFloat(i)<0||this.parent.parseFloat(i)>2958465)return this.parent.getErrorStrings()[e.CommonErrors.Num];a=this.parent.intToTime(i)}else{var o={value:i.toString()};if(this.parent.parentObject.notify(Zr,o),!o.isDate&&!o.isTime)return this.parent.getErrorStrings()[e.CommonErrors.Value];a=o.dateObj}if("Invalid Date"===a.toString()&&(a=new Date(Date.parse(i))),"Invalid Date"===a.toString()){var s=new Date(Date.now()).toLocaleDateString()+" "+i;a=new Date(Date.parse(s))}return"Invalid Date"===a.toString()&&(a=this.parent.fromOADate(this.parent.parseFloat(i))),"Invalid Date"===a.toString()?this.parent.getErrorStrings()[e.CommonErrors.Value]:a.getFullYear()<1900||a.getFullYear()>9999?this.parent.getErrorStrings()[e.CommonErrors.Value]:a.getSeconds()},n.prototype.ComputeMONTH=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=this.parent.getErrorStrings();if(1===t.length&&""===t[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];if(1!==t.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];var i=this.parent.getValueFromArg(t[0]).trim();if(n.indexOf(i)>-1)return i;if(this.parent.isCellReference(t[0])){if(i.indexOf(this.parent.tic)>-1)return n[e.CommonErrors.Value];if(""===i)return 1}else{if('"TRUE"'===i.toUpperCase()||'"FALSE"'===i.toUpperCase())return n[e.CommonErrors.Value];i=i.split(this.parent.tic).join("")}if(""===i)return n[e.CommonErrors.Value];if(i===this.parent.trueValue||i===this.parent.falseValue||Number(i)>-1&&Number(i)<32)return 1;if(Number(i)<0)return n[e.CommonErrors.Num];i.indexOf("%")>-1&&(i=(.01*Number(i.split("%")[0])).toString()),this.parent.isNumber(i)&&(i=parseInt(Math.floor(Number(i)).toString(),10));var a=this.parent.parseDate(i);return"Invalid Date"===a.toString()?this.parent.isNumber(i)?n[e.CommonErrors.Num]:n[e.CommonErrors.Value]:a.getFullYear()<1900||1e4<=a.getFullYear()?n[e.CommonErrors.Num]:(a.getMonth()+1).toString()},n.prototype.ComputeNOW=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(1!==r.length||""!==r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];var i=new Date(Date.now()),a=(new t.Internationalization).getDateFormat({format:"M/d/yyyy h:mm:ss a"});return this.parent.parentObject.dateToInt(a(i),!0).toString()},n.prototype.ComputeEXACT=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=!1,i=t.length&&"nestedFormulaTrue"===t[t.length-1],a=this.parent.getErrorStrings();if(i&&t.pop(),!t||!t[0]&&1===t.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];if(2!==t.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];var o,s,l;if(t[0]){if(o=this.parent.getValueFromArg(t[0]),a.indexOf(o)>-1)return o;-1===o.indexOf(this.parent.tic)&&o.includes("%")&&(o=(Number(o.split("%")[0])/100).toString()),this.parent.isCellReference(t[0])?l=!0:o=o.split(this.parent.tic).join("")}if(t[1]){if(s=this.parent.getValueFromArg(t[1]),a.indexOf(s)>-1)return s;-1===s.indexOf(this.parent.tic)&&s.includes("%")&&(s=(Number(s.split("%")[0])/100).toString()),this.parent.isCellReference(t[1])?l||0!==o.trim().length||0!==s.trim().length||(n=!1):(s=s.split(this.parent.tic).join(""),l&&0===o.trim().length&&0===s.trim().length&&(n=!1))}return o===s&&(n=!0,i&&(n=this.parent.tic+n+this.parent.tic)),n},n.prototype.ComputeLEN=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i,a=this.parent.getErrorStrings();return t.isNullOrUndefined(r)||""===r[0].trim()&&1===r.length?this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments]:r.length>1?this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments]:(i=this.parent.getValueFromArg(r[0]).trim(),a.indexOf(i)>-1?i:(r[0].indexOf(this.parent.tic)>-1?r[0]!==i&&r[0].startsWith("n")?i=this.parent.removeTics(i.trim()):(i=this.parent.removeTics(r[0].trim())).indexOf(this.parent.tic+this.parent.tic)>-1&&(i=i.replace(/""/g,this.parent.tic)):!r[0].startsWith("n")&&2===i.split("%").length&&this.parent.isNumber(i.split("%")[0])&&(i=(Number(i.split("%")[0])/100).toString()),i.length))},n.prototype.ComputeMOD=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i;if(t.isNullOrUndefined(r)||2!==r.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];if(""===r[1]&&!r[0].includes('"'))return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.Div];if(""===r[0]&&!r[1].includes('"'))return 0;for(var a=0;a<r.length;a++){var o=r[a].split(this.parent.tic).join("").trim();if(""===o||r[a].indexOf(this.parent.tic)>-1&&isNaN(this.parent.parseFloat(o)))return this.parent.getErrorStrings()[e.CommonErrors.Value];if(O(r[a])){if(i=this.parent.getValueFromArg(r[a])||"0",(i=i===this.parent.trueValue?"1":i===this.parent.falseValue?"0":i).toUpperCase().match(/[A-Z]/)||i.includes('"')||!this.parent.isNumber(i))return this.parent.getErrorStrings()[e.CommonErrors.Value]}else if(i=this.parent.getValueFromArg(r[a].split(this.parent.tic).join("")),i=i===this.parent.trueValue?"1":i===this.parent.falseValue?"0":i,this.parent.getErrorStrings().indexOf(i)>-1)return i;r[a]=i}var s=r[0],l=r[1];if("0"===l||""===l)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.Div];if("0"===s||""===s)return 0;var d=((s=parseFloat(s))%(l=parseFloat(l))+l)%l;return isNaN(d)?this.parent.getErrorStrings()[e.CommonErrors.Name]:d},n.prototype.ComputeODD=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||1!==r.length||""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];var i=r[0].split(this.parent.tic).join("").trim();if(""===i||r[0].indexOf(this.parent.tic)>-1&&isNaN(this.parent.parseFloat(i)))return this.parent.getErrorStrings()[e.CommonErrors.Value];var a;if(O(r[0])){if((a=this.parent.getValueFromArg(r[0]))===this.parent.trueValue)a="1";else if(""===a||a===this.parent.falseValue)a="0";else if(a.toUpperCase().match(/[A-Z]/)||a.includes('"')||!this.parent.isNumber(a))return this.parent.getErrorStrings()[e.CommonErrors.Value]}else{if("#NAME?"===(a=this.parent.getValueFromArg(r[0].split(this.parent.tic).join(""))))return this.parent.getErrorStrings()[e.CommonErrors.Name];if(a===this.parent.trueValue)a="1";else if(""===a||a===this.parent.falseValue)a="0";else if(a.toUpperCase().match(/[A-Z]/)||!this.parent.isNumber(a))return this.parent.getErrorStrings()[e.CommonErrors.Value]}var o=Math.ceil(parseInt(a,10)),s=0===o;return o=o%2==0?o>0?o+1:o-1:o,Math.ceil(parseInt(a,10))%2!=0&&(parseInt(a,10)>0&&parseFloat(a)>parseInt(a,10)?o+=2:parseInt(a,10)<0&&parseFloat(a)<parseInt(a,10)&&(o-=2)),isNaN(o)?this.parent.getErrorStrings()[e.CommonErrors.Name]:s?1:o},n.prototype.ComputeEVEN=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||1!==r.length||""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];var i=r[0].split(this.parent.tic).join("").trim();if(""===i||r[0].indexOf(this.parent.tic)>-1&&isNaN(this.parent.parseFloat(i)))return this.parent.getErrorStrings()[e.CommonErrors.Value];var a;if(O(r[0])){if((a=this.parent.getValueFromArg(r[0]))===this.parent.trueValue)a="1";else if(""===a||a===this.parent.falseValue)a="0";else if(a.toUpperCase().match(/[A-Z]/)||a.includes('"')||!this.parent.isNumber(a))return this.parent.getErrorStrings()[e.CommonErrors.Value]}else{if("#NAME?"===(a=this.parent.getValueFromArg(r[0].split(this.parent.tic).join(""))))return this.parent.getErrorStrings()[e.CommonErrors.Name];if(a===this.parent.trueValue)a="1";else if(""===a||a===this.parent.falseValue)a="0";else if(a.toUpperCase().match(/[A-Z]/)||!this.parent.isNumber(a))return this.parent.getErrorStrings()[e.CommonErrors.Value]}var o=Math.ceil(parseInt(a,10));return o=o%2==0?o:o>0?o+1:o-1,Math.ceil(parseInt(a,10))%2==0&&(parseInt(a,10)>0&&parseFloat(a)>parseInt(a,10)?o+=2:parseInt(a,10)<0&&parseFloat(a)<parseInt(a,10)&&(o-=2)),isNaN(o)?this.parent.getErrorStrings()[e.CommonErrors.Name]:o},n.prototype.ComputePI=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return t&&""!==t[0]?this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments]:Math.PI},n.prototype.ComputeMEDIAN=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i,a=[];if(t.isNullOrUndefined(r)||""===r[0]&&1===r.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];for(var o=0;o<r.length;o++)if(this.parent.isCellReference(r[o]))if(r[o].indexOf(":")>-1)for(var s=this.parent.getCellCollection(r[o]),l=0;l<s.length;l++){var d=this.parent.getValueFromArg(s[l]);if(this.parent.getErrorStrings().indexOf(d)>-1)return d;""!==d.trim()&&a.push(this.parent.parseFloat(d))}else{var h=this.parent.getValueFromArg(r[o]);if(this.parent.getErrorStrings().indexOf(h)>-1)return h;""!==h.trim()&&a.push(this.parent.parseFloat(h))}else if(""===r[o]||r[o]===this.parent.falseValue&&!this.parent.isCellReference(r[o]))a.push(0);else if(r[o]!==this.parent.trueValue||this.parent.isCellReference(r[o])){if(r[o].indexOf(this.parent.tic)>-1&&isNaN(parseFloat(r[o].split(this.parent.tic).join(""))))return this.parent.getErrorStrings()[e.CommonErrors.Value];var p=this.parent.getValueFromArg(r[o]).split(this.parent.tic).join("");if(this.parent.getErrorStrings().indexOf(p)>-1)return p;a.push(this.parent.parseFloat(p))}else a.push(1);for(var c=(a=a.sort(function(e,t){return e-t})).length,u=0;u<c&&(!isNaN(a[u])||(a.splice(u,1),c=a.length,u--,0!==a.length));u++);if(a.length%2==0||isNaN(a[parseInt((a.length/2).toString(),10)])){if(isNaN(a[a.length/2])||isNaN(a[a.length/2-1]))return this.parent.getErrorStrings()[e.CommonErrors.Num];i=(a[a.length/2]+a[a.length/2-1])/2}else i=a[parseInt((a.length/2).toString(),10)];return i},n.prototype.ComputeEDATE=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(2!==r.length||t.isNullOrUndefined(r))return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];if(""===r[0]||""===r[1])return this.parent.getErrorStrings()[e.CommonErrors.NA];if(""===r[0].split(this.parent.tic).join("")||""===r[1].split(this.parent.tic).join("")||r[1].indexOf(this.parent.tic)>-1&&isNaN(this.parent.parseFloat(r[1].split(this.parent.tic).join(""))))return this.parent.getErrorStrings()[e.CommonErrors.Value];var i,a;if(this.parent.isCellReference(r[0])){if(r[0].indexOf(":")>-1)return this.parent.getErrorStrings()[e.CommonErrors.Value];if((i=this.parent.getValueFromArg(r[0].split(this.parent.tic).join(""))||"0").indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[e.CommonErrors.Value]}else i=this.parent.getValueFromArg(r[0].split(this.parent.tic).join(""));if(this.parent.isCellReference(r[1])){if(r[1].indexOf(":")>-1)return this.parent.getErrorStrings()[e.CommonErrors.Value];a=this.parent.getValueFromArg(r[1].split(this.parent.tic).join(""))||"0"}else a=this.parent.getValueFromArg(r[1].split(this.parent.tic).join(""));if(this.parent.getErrorStrings().indexOf(a)>-1)return a;a=parseInt(a,10);var o;if(this.parent.isNumber(i)){if((i=parseInt(i,10))<0||i>2958465)return this.parent.getErrorStrings()[e.CommonErrors.Num];o=this.parent.fromOADate(i)}else o=this.parent.checkDateFormat(i);if(isNaN(a)||t.isNullOrUndefined(this.parent.isDate(o))||o.getFullYear()>9999)return this.parent.getErrorStrings()[e.CommonErrors.Value];var s=o.getDate();o.setMonth(o.getMonth()+a),s!==o.getDate()&&o.setDate(0);var l=this.parent.parentObject.dateToInt(o);return"0"===i.toString()&&(l-=1),l<0||l>2958465?this.parent.getErrorStrings()[e.CommonErrors.Num]:l.toString()},n.prototype.ComputeEOMONTH=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(2!==r.length||t.isNullOrUndefined(r))return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];if(""===r[0]||""===r[1])return this.parent.getErrorStrings()[e.CommonErrors.NA];if(""===r[0].split(this.parent.tic).join("")||""===r[1].split(this.parent.tic).join("")||r[1].indexOf(this.parent.tic)>-1&&isNaN(this.parent.parseFloat(r[1].split(this.parent.tic).join(""))))return this.parent.getErrorStrings()[e.CommonErrors.Value];var i,a;if(this.parent.isCellReference(r[0])){if(r[0].indexOf(":")>-1)return this.parent.getErrorStrings()[e.CommonErrors.Value];if((i=this.parent.getValueFromArg(r[0].split(this.parent.tic).join(""))||"0").indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[e.CommonErrors.Value]}else i=this.parent.getValueFromArg(r[0]).split(this.parent.tic).join("");if(this.parent.getErrorStrings().indexOf(i)>-1)return i;if(this.parent.isCellReference(r[1])){if(r[1].indexOf(":")>-1)return this.parent.getErrorStrings()[e.CommonErrors.Value];a=this.parent.getValueFromArg(r[1].split(this.parent.tic).join(""))||"0"}else a=this.parent.getValueFromArg(r[1].split(this.parent.tic).join(""));if(this.parent.getErrorStrings().indexOf(a)>-1)return a;a=parseInt(a,10);var o;if(this.parent.isNumber(i)){if((i=parseInt(i,10))<0||i>2958465)return this.parent.getErrorStrings()[e.CommonErrors.Num];o=this.parent.fromOADate(i)}else o=this.parent.checkDateFormat(i);if(isNaN(a)||t.isNullOrUndefined(this.parent.isDate(o))||o.getFullYear()>9999)return this.parent.getErrorStrings()[e.CommonErrors.Value];o=new Date(o.getFullYear(),o.getMonth()+(a+1),0);var s=this.parent.parentObject.dateToInt(o);return s<0||s>2958465||o.getFullYear()<1900?this.parent.getErrorStrings()[e.CommonErrors.Num]:s.toString()},n.prototype.ComputeDATEVALUE=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i,a=this.parent.getErrorStrings();if(""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];if(r.length>1)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];if(i=this.parent.getValueFromArg(r[0])||"0",a.indexOf(i)>-1)return i;if(this.parent.isCellReference(r[0])){if(r[0].indexOf(":")>-1||i.startsWith(this.parent.tic))return a[e.CommonErrors.Value]}else i=r[0].split(this.parent.tic).join("")||"0";if(this.parent.isNumber(i)||t.isNullOrUndefined(this.parent.isDate(i)))return a[e.CommonErrors.Value];var o=this.parent.parseDate(i);return a.indexOf(i)>-1?i:t.isNullOrUndefined(o)||"Invalid Date"===o.toString()||o.getFullYear()<1900||o.getFullYear()>9999?this.parent.getErrorStrings()[e.CommonErrors.Value]:(i=this.parent.toOADate(o).toString(),parseFloat(i).toFixed(0).toString())},n.prototype.ComputeCOUNTBLANK=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=0;if(1!==r.length||t.isNullOrUndefined(r)||!this.parent.isCellReference(r[0]))return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];if(""===r[0])return this.parent.getErrorStrings()[e.CommonErrors.Value];for(var a=this.parent.getCellCollection(r[0]),o=0;o<a.length;o++)""===this.parent.getValueFromArg(a[o])&&i++;return i},n.prototype.ComputeFACT=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=1,i=this.parent.getErrorStrings();if(""===t[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];if(1!==t.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];var a=t[0];if(this.parent.isCellReference(t[0])||isNaN(Number(a.split(this.parent.tic).join("")))){if(a=this.parent.getValueFromArg(t[0]),i.indexOf(a)>-1)return a;if(a.startsWith(this.parent.tic)||a.match(/^(\d*\.\d+|\d+)\s*[+\-*/]\s*(\d*\.\d+|\d+)$/))return i[e.CommonErrors.Value];if(""===a)return 1}if(a=a.split(this.parent.tic).join("").trim(),i.indexOf(a)>-1)return a;if(a.toUpperCase()===this.parent.trueValue||a.toUpperCase()===this.parent.falseValue)return 1;a.indexOf("%")>-1&&(a=(Number(a.split("%")[0])/100).toString());var o=parseInt(a,10);if(o<0||o>170)return i[e.CommonErrors.Num];if(a.toUpperCase().match(/[A-Z]/)||""===a)return i[e.CommonErrors.Value];if(a.indexOf(":")>-1)return 0;for(var s=1;s<=o;s++)n*=s;return n},n.prototype.ComputeDECIMAL=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i;if(t.isNullOrUndefined(r)||2!==r.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];if(r[0].match(/[@#$%^&*()?:{}|<>+-]/g))return this.parent.getErrorStrings()[e.CommonErrors.Num];if(r[1].indexOf(this.parent.tic)>-1&&isNaN(this.parent.parseFloat(r[1].split(this.parent.tic).join(""))))return this.parent.getErrorStrings()[e.CommonErrors.Value];var a=void 0,o=void 0;a=this.parent.isCellReference(r[0].toString())?this.parent.getValueFromArg(r[0]):this.parent.getValueFromArg(r[0]).split(this.parent.tic).join(""),o=this.parent.isCellReference(r[1].toString())?this.parent.getValueFromArg(r[1]):this.parent.getValueFromArg(r[1]).split(this.parent.tic).join("");var s=parseInt(a,10),l=parseInt(o,10);return this.parent.getErrorStrings().indexOf(a)>-1?a:this.parent.getErrorStrings().indexOf(o)>-1?o:""===a&&""!==o?0:""===a||s<0||!isNaN(s)&&!Number.isInteger(parseFloat(a))?this.parent.getErrorStrings()[e.CommonErrors.Num]:""===o||l<2||l>36||isNaN(l)?this.parent.getErrorStrings()[e.CommonErrors.Num]:isNaN(this.parent.parseFloat(a))&&this.parent.parseFloat(o)<=10?this.parent.getErrorStrings()[e.CommonErrors.Num]:(i=parseInt(a,parseInt(o,10)),isNaN(i)?this.parent.getErrorStrings()[e.CommonErrors.Num]:i)},n.prototype.ComputeDEGREES=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=this.parent.getErrorStrings();if(t.isNullOrUndefined(r)||""===r[0]&&1===r.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];if(1!==r.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];var a=this.parent.getValueFromArg(r[0]).trim();if(i.indexOf(a)>-1)return a;if(this.parent.isCellReference(r[0])){if(""===a||a.indexOf(":")>-1)return 0;if(a.indexOf(this.parent.tic)>-1||isNaN(Number(a))&&!isNaN(parseInt(a,10)))return i[e.CommonErrors.Value]}else if(a.indexOf('"TRUE"')>-1)return i[e.CommonErrors.Value];if((a=a.split(this.parent.tic).join("")).toUpperCase()===this.parent.trueValue)a="1";else if(a.toUpperCase()===this.parent.falseValue)a="0";else if(a.indexOf("%")>-1)a=(Number(a.split("%")[0])/100).toString();else if(a.toUpperCase().match(/[A-Z]/)||isNaN(parseInt(a,10)))return i[e.CommonErrors.Value];return parseFloat(a)*(180/Math.PI)},n.prototype.ComputeADDRESS=function(){for(var r=this,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var a,o=this.parent.getErrorStrings();if(t.isNullOrUndefined(n)||1===n.length&&""===n[0].trim())return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];if(n.length<2||n.length>5)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];if(""===n[0].split(this.parent.tic).join("").trim()||""===n[1].split(this.parent.tic).join("").trim())return o[e.CommonErrors.Value];var s=function(t){var n=r.parent.getValueFromArg(t).trim();return o.indexOf(n)>0?n:(n.toUpperCase()===r.parent.trueValue?n="1":n.toUpperCase()===r.parent.falseValue&&(n="0"),r.parent.isCellReference(t)&&n.indexOf(r.parent.tic)>-1?o[e.CommonErrors.Value]:(2===(n=r.parent.removeTics(n)).split("%").length&&r.parent.isNumber(n.split("%")[0])&&(n=(Number(n.split("%")[0])/100).toString()),n))},l=s(n[0]);if(o.indexOf(l)>0)return l;if(l=Number(l),isNaN(l)||l<1)return o[e.CommonErrors.Value];l=l.toString();var d=s(n[1]);if(o.indexOf(d)>0)return d;if(d=Number(d),isNaN(d)||d<1)return o[e.CommonErrors.Value];d=d.toString();var h,p;if(t.isNullOrUndefined(n[2])||""===n[2].trim())h="1";else{if(h=s(n[2]),o.indexOf(h)>0)return h;if(h=Number(h),isNaN(h)||h<1||h>4)return o[e.CommonErrors.Value];h=h.toString()}if(t.isNullOrUndefined(n[3])||""===n[3].trim())p="1";else{if(p=s(n[3]),o.indexOf(p)>0)return p;p.toUpperCase()===this.parent.trueValue||Number(p)>1?p="1":""!==p&&p.toUpperCase()!==this.parent.falseValue||(p="0")}if("1"===p)"1"===h?a="$"+Xe(parseInt(d,10))+"$"+parseInt(l,10):"2"===h?a=Xe(parseInt(d,10))+"$"+parseInt(l,10):"3"===h?a="$"+Xe(parseInt(d,10))+parseInt(l,10):"4"===h&&(a=Xe(parseInt(d,10))+parseInt(l,10));else{if("0"!==p)return o[e.CommonErrors.Name];"1"===h?a="R"+parseInt(l,10)+"C"+parseInt(d,10):"2"===h?a="R"+parseInt(l,10)+"C["+parseInt(d,10)+"]":"3"===h?a="R["+parseInt(l,10)+"]C"+parseInt(d,10):"4"===h&&(a="R["+parseInt(l,10)+"]C["+parseInt(d,10)+"]")}var c;return!t.isNullOrUndefined(n[4])&&""!==n[4]&&(c=this.parent.getValueFromArg(n[4]).split(this.parent.tic).join(""),o.indexOf(c)>0)?c:(t.isNullOrUndefined(c)||(a=c+"!"+a),a)},n.prototype.ComputeTIME=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i;if(t.isNullOrUndefined(r)||3!==r.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];if(r[0].indexOf(this.parent.tic)>-1&&""===r[0].split(this.parent.tic).join("").trim())return this.parent.getErrorStrings()[e.CommonErrors.Value];if(r[1].indexOf(this.parent.tic)>-1&&""===r[1].split(this.parent.tic).join("").trim())return this.parent.getErrorStrings()[e.CommonErrors.Value];if(r[2].indexOf(this.parent.tic)>-1&&""===r[2].split(this.parent.tic).join("").trim())return this.parent.getErrorStrings()[e.CommonErrors.Value];var a,o,s;if(this.parent.isCellReference(r[0])){if((a=this.parent.getValueFromArg(r[0].split(this.parent.tic).join(""))||"0").indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[e.CommonErrors.Value]}else{if(r[0].indexOf(this.parent.tic)>-1&&(r[0].split(this.parent.tic).join("")===this.parent.trueValue||r[0].split(this.parent.tic).join("")===this.parent.falseValue))return this.parent.getErrorStrings()[e.CommonErrors.Value];a=this.parent.getValueFromArg(r[0]).split(this.parent.tic).join("")||"0"}if(this.parent.getErrorStrings().indexOf(a)>-1)return a;if(isNaN(this.parent.parseFloat(a))&&a!==this.parent.trueValue&&a!==this.parent.falseValue)return this.parent.getErrorStrings()[e.CommonErrors.Value];if(this.parent.isCellReference(r[1])){if((o=this.parent.getValueFromArg(r[1].split(this.parent.tic).join(""))||"0").indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[e.CommonErrors.Value]}else{if(r[1].indexOf(this.parent.tic)>-1&&(r[1].split(this.parent.tic).join("")===this.parent.trueValue||r[1].split(this.parent.tic).join("")===this.parent.falseValue))return this.parent.getErrorStrings()[e.CommonErrors.Value];o=this.parent.getValueFromArg(r[1]).split(this.parent.tic).join("")||"0"}if(this.parent.getErrorStrings().indexOf(o)>-1)return o;if(isNaN(this.parent.parseFloat(o))&&o!==this.parent.trueValue&&o!==this.parent.falseValue)return this.parent.getErrorStrings()[e.CommonErrors.Value];if(this.parent.isCellReference(r[2])){if((s=this.parent.getValueFromArg(r[2].split(this.parent.tic).join(""))||"0").indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[e.CommonErrors.Value]}else{if(r[2].indexOf(this.parent.tic)>-1&&(r[2].split(this.parent.tic).join("")===this.parent.trueValue||r[2].split(this.parent.tic).join("")===this.parent.falseValue))return this.parent.getErrorStrings()[e.CommonErrors.Value];s=this.parent.getValueFromArg(r[2]).split(this.parent.tic).join("")||"0"}if(this.parent.getErrorStrings().indexOf(s)>-1)return s;if(isNaN(this.parent.parseFloat(s))&&s!==this.parent.trueValue&&s!==this.parent.falseValue)return this.parent.getErrorStrings()[e.CommonErrors.Value];if(a=a===this.parent.trueValue?"1":a===this.parent.falseValue?"0":a,o=o===this.parent.trueValue?"1":o===this.parent.falseValue?"0":o,s=s===this.parent.trueValue?"1":s===this.parent.falseValue?"0":s,a=parseInt(this.parent.parseFloat(a).toString(),10),o=parseInt(this.parent.parseFloat(o).toString(),10),s=parseInt(this.parent.parseFloat(s).toString(),10),isNaN(a)||isNaN(o)||isNaN(s))return this.parent.getErrorStrings()[e.CommonErrors.Value];if(a>32767||o>32767||s>32767)return this.parent.getErrorStrings()[e.CommonErrors.Num];var l=new Date(1900,0,1,a,o,s);if(l.getFullYear()<1900)return this.parent.getErrorStrings()[e.CommonErrors.Num];var d=l.getHours(),h=l.getMinutes(),p=l.getSeconds(),c="AM",u=d;u>=12&&(u=d-12,c="PM"),0===u&&(u=12),h=h<10?"0"+h:h,p=p<10?"0"+p:p;var f={value:(i=(u=u<10?"0"+u:u)+":"+h+":"+p+" "+c).toString()};return this.parent.parentObject.notify(Zr,f),f.isTime&&(i=f.updatedVal),i},n.prototype.ComputeCHAR=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=this.parent.getErrorStrings();if(t.isNullOrUndefined(r)||""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];if(1!==r.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];var a=this.parent.getValueFromArg(r[0]).trim();if(i.indexOf(a)>-1)return a;if(a.indexOf('"TRUE"')>-1||this.parent.isCellReference(r[0])&&a.startsWith(this.parent.tic))return i[e.CommonErrors.Value];if(a=a.split(this.parent.tic).join(""),this.parent.isNumber(a)?a=Math.floor(Number(a)).toString():a.indexOf("%")>-1?a=Math.floor(Number(a.split("%")[0])/100).toString():a===this.parent.trueValue&&(a="1"),!a.toUpperCase().match(/^[0-9]+$/))return i[e.CommonErrors.Value];var o=parseInt(a,10);return o>255||o<=0?i[e.CommonErrors.Value]:String.fromCharCode(o)},n.prototype.ComputeCODE=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i,a=this.parent.getErrorStrings();return t.isNullOrUndefined(r)||1===r.length&&""===r[0].trim()?this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments]:r.length>1?this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments]:(i=this.parent.getValueFromArg(r[0]).trim(),a.indexOf(i)>-1?i:(r[0].indexOf(this.parent.tic)>-1?i=r[0]!==i&&r[0].startsWith("n")?this.parent.removeTics(i.trim()):this.parent.removeTics(r[0].trim()):!r[0].startsWith("n")&&2===i.split("%").length&&this.parent.isNumber(i.split("%")[0])&&(i=(Number(i.split("%")[0])/100).toString()),""===i?a[e.CommonErrors.Value]:i=i.charCodeAt(0)))},n.prototype.ComputeDOLLAR=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i,a,o;if(r.length&&"nestedFormulaTrue"===r[r.length-1]&&(o=!0,r.pop()),1===r.length&&(""===r[0]&&(a=!0),r.push("2")),t.isNullOrUndefined(r)||2!==r.length||a)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];for(var s=0;s<r.length;s++)if(r[s].indexOf(this.parent.tic)>-1&&isNaN(this.parent.parseFloat(r[s])))return this.parent.getErrorStrings()[e.CommonErrors.Value];var l=this.parent.getValueFromArg(r[0]).split(this.parent.tic).join(""),d=this.parent.getValueFromArg(r[1]).split(this.parent.tic).join("");if(l=""===l||l===this.parent.falseValue?"0":l===this.parent.trueValue?"1":l,d=""===d||d===this.parent.falseValue?"0":d===this.parent.trueValue?"1":d,"#NAME?"===l||"#NAME?"===d)return this.parent.getErrorStrings()[e.CommonErrors.Name];if(!l.toUpperCase().match(/^[-]?[0-9.]+$/)||!d.toUpperCase().match(/^[-]?[0-9.]+$/))return this.parent.getErrorStrings()[e.CommonErrors.Value];for(var h=new t.Internationalization,p=parseInt(d,10),c=Math.pow(10,-1*p),u="",f=1;f<=p;f++)u+="0";var g=Math.round(this.parent.parseFloat(l)/c)*c;return i=isNaN(g)?this.parent.getErrorStrings()[e.CommonErrors.Value]:h.formatNumber(g,{format:"$#,##0."+u+";($#,##0."+u+");$0."+u}),o&&(i=this.parent.tic+i+this.parent.tic),i},n.prototype.ComputeSMALL=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=this.parent.getErrorStrings();if(t.isNullOrUndefined(r)||1===r.length||""===r[0])return""===r[0]&&""===r[1]?i[e.CommonErrors.Num]:this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];if(r.length>2)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];var a=[],o=[],s=[];if(!t.isNullOrUndefined(r[0])){var l=void 0;if(this.parent.isCellReference(r[0])){a=this.parent.getCellCollection(r[0]);for(d=0;d<a.length;d++){if(l=this.parent.getValueFromArg(a[d]),i.indexOf(l)>-1)return l;o.push(l)}}else{if(l=this.parent.getValueFromArg(r[0]).split(this.parent.tic).join(""),i.indexOf(l)>-1)return l;o.push(l)}for(var d=0;d<o.length;d++)""===o[d]||isNaN(this.parent.parseFloat(o[d]))||s.push(this.parent.parseFloat(o[d]));if(0===s.length&&(t.isNullOrUndefined(o[0])||r[0].indexOf(this.parent.tic)>-1))return i[e.CommonErrors.Value]}s=s.sort(function(e,t){return e-t});var h;if(!t.isNullOrUndefined(r[1])){if(this.parent.isCellReference(r[1])){if(""===(h=this.parent.getValueFromArg(r[1])))return i[e.CommonErrors.Num];if(""===h.trim())return i[e.CommonErrors.Value];h.toUpperCase()===this.parent.trueValue?h="1":h.toUpperCase()===this.parent.falseValue&&(h="0")}else h=this.parent.getValueFromArg(r[1]).split(this.parent.tic).join("");if(i.indexOf(h)>-1)return h;if(""===h.trim())return r[1].length>0?i[e.CommonErrors.Value]:i[e.CommonErrors.Num];if(isNaN(this.parent.parseFloat(h)))if(r[1].toUpperCase()===this.parent.trueValue)h="1";else{if(r[1].toUpperCase()!==this.parent.falseValue)return i[e.CommonErrors.Value];h="0"}}var p=Number(h)<1?0:Math.floor(Number(h));return t.isNullOrUndefined(s[p-1])&&!isNaN(Number(p))?i[e.CommonErrors.Num]:s[p-1]},n.prototype.ComputeLARGE=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=this.parent.getErrorStrings();if(t.isNullOrUndefined(r)||1===r.length||""===r[0])return""===r[0]&&""===r[1]?i[e.CommonErrors.Num]:this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];if(r.length>2)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];var a=[],o=[],s=[];if(!t.isNullOrUndefined(r[0])){var l=void 0;if(this.parent.isCellReference(r[0])){a=this.parent.getCellCollection(r[0]);for(d=0;d<a.length;d++){if(l=this.parent.getValueFromArg(a[d]),i.indexOf(l)>-1)return l;o.push(l)}}else{if(l=this.parent.getValueFromArg(r[0]).split(this.parent.tic).join(""),i.indexOf(l)>-1)return l;o.push(l)}for(var d=0;d<o.length;d++)""===o[d]||isNaN(this.parent.parseFloat(o[d]))||s.push(this.parent.parseFloat(o[d]));if(0===s.length&&(t.isNullOrUndefined(o[0])||r[0].indexOf(this.parent.tic)>-1))return i[e.CommonErrors.Value]}s=s.sort(function(e,t){return t-e});var h;if(!t.isNullOrUndefined(r[1])){if(this.parent.isCellReference(r[1])){if(""===(h=this.parent.getValueFromArg(r[1])))return i[e.CommonErrors.Num];if(""===h.trim())return i[e.CommonErrors.Value];h.toUpperCase()===this.parent.trueValue?h="1":h.toUpperCase()===this.parent.falseValue&&(h="0")}else h=this.parent.getValueFromArg(r[1]).split(this.parent.tic).join("");if(i.indexOf(h)>-1)return h;if(""===h.trim())return r[1].length>0?i[e.CommonErrors.Value]:i[e.CommonErrors.Num];if(isNaN(this.parent.parseFloat(h)))if(r[1].toUpperCase()===this.parent.trueValue)h="1";else{if(r[1].toUpperCase()!==this.parent.falseValue)return i[e.CommonErrors.Value];h="0"}}var p=Number(h)<1?0:Math.ceil(Number(h));return t.isNullOrUndefined(s[p-1])&&!isNaN(Number(p))?i[e.CommonErrors.Num]:s[p-1]},n.prototype.ComputeCHOOSE=function(){for(var r=this,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];if(t.isNullOrUndefined(n)||""===n[0]&&1===n.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];if(n.length<2)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];var a,o=this.parent.getErrorStrings();if(a=function(e){return e=r.parent.getValueFromArg(e),e.toUpperCase()===r.parent.trueValue?e="1":e.toUpperCase()===r.parent.falseValue&&(e="0"),e}(n[0]),o.indexOf(a)>-1)return a;if(this.parent.isCellReference(n[0])){if(n[0].indexOf(":")>-1)return o[e.CommonErrors.Value]}else 2===(a=this.parent.removeTics(a)).split("%").length&&this.parent.isNumber(a.split("%")[0])&&(a=(.01*Number(a.split("%")[0])).toString());return(a=Math.floor(this.parent.parseFloat(a)))<1||isNaN(a)||t.isNullOrUndefined(n[a])?o[e.CommonErrors.Value]:(""===(a=n[a])&&(a="0"),this.parent.isCellReference(a)?a.indexOf(":")>-1?o[e.CommonErrors.Value]:this.parent.getValueFromArg(a):(a.indexOf(this.parent.tic)>-1&&(o.indexOf(a.split(this.parent.tic).join(""))>-1||this.parent.removeTics(a).match(/^(\d*\.\d+|\d+)\s*[-*/]\s*(\d*\.\d+|\d+)$/))&&(a=this.parent.removeTics(a)),(a=this.parent.removeTics(this.parent.getValueFromArg(a))).indexOf(this.parent.tic+this.parent.tic)>-1?a.replace(/""/g,this.parent.tic):(2===a.split("%").length&&this.parent.isNumber(a.split("%")[0])&&(a=(.01*Number(a.split("%")[0])).toString()),a)))},n.prototype.ComputeSUMIF=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t;if(n[0].indexOf(":")<0&&!this.parent.isCellReference(n[0])||n[2]&&n[2].indexOf(":")<0&&!this.parent.isCellReference(n[2]))return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.ImproperFormula];if(n.length>3||n.length<2)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];var i=this.parent.computeSumIfAndAvgIf(t,!1);return"string"==typeof i&&(this.parent.formulaErrorStrings.indexOf(i)||this.parent.getErrorStrings().indexOf(i))?i:i[0]},n.prototype.ComputeABS=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n,i=t,a="";if(0===t.length||t.length>1)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];if(""===i[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];var o=i[0].split(this.parent.tic).join("").trim();if(""===o||i[0].indexOf(this.parent.tic)>-1&&isNaN(this.parent.parseFloat(o)))return this.parent.getErrorStrings()[e.CommonErrors.Value];if(this.parent.isCellReference(i[0])){if(a=this.parent.getValueFromArg(i[0]),this.parent.getErrorStrings().indexOf(a)>-1)return this.parent.getErrorStrings()[e.CommonErrors.Value];if(a===this.parent.trueValue&&(a="1"),""!==a&&a!==this.parent.falseValue||(a="0"),n=this.parent.parseFloat(a),isNaN(n)&&!this.parent.isNumber(a))return this.parent.getErrorStrings()[e.CommonErrors.Value]}else{if((a=this.parent.getValueFromArg(i[0]).split(this.parent.tic).join())===this.parent.trueValue&&(a="1"),a===this.parent.falseValue&&(a="0"),this.parent.getErrorStrings().indexOf(a)>-1)return a;if(n=this.parent.parseFloat(a),isNaN(n)&&!this.parent.isNumber(a))return this.parent.getErrorStrings()[e.CommonErrors.Value]}return Math.abs(n)},n.prototype.ComputeAVERAGE=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i,a=!1;if(r.length){var o=r[r.length-1];"isSubtotal"===o?(a=!0,r.pop()):"isAggregate"===o&&(i=!0,r.pop())}if(t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];for(var s=r,l=0;l<s.length;l++)if(s[l].indexOf(":")>-1&&s[l].indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[e.CommonErrors.Value];return this.parent.calculateAvg(s,a,i)},n.prototype.ComputeAVERAGEIF=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t;if(n[0].indexOf(":")<0&&!this.parent.isCellReference(n[0]))return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.ImproperFormula];var i=this.parent.computeSumIfAndAvgIf(t,!0);return 0===i[1]||"NaN"===i[0].toString()?this.parent.formulaErrorStrings[e.FormulasErrorsStrings.Div]:"string"==typeof i&&(this.parent.formulaErrorStrings.indexOf(i)||this.parent.getErrorStrings().indexOf(i))?i:this.parent.parseFloat(i[0])/this.parent.parseFloat(i[1])},n.prototype.ComputeCONCATENATE=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=this.parent.getErrorStrings();if(t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];for(var a=r,o="",s="",l=0;l<a.length;l++){var d=a[l];if(this.parent.isCellReference(d)){if(d.indexOf(":")>-1){if(!this.isConcat)return i[e.CommonErrors.Value];for(var h=this.parent.getCellCollection(d),p=0;p<h.length;p++)o+=this.parent.getValueFromArg(h[p])}else{if(1===a.length&&a[0].indexOf(this.parent.tic)<0&&!V(a[0]))return i[e.CommonErrors.Name];s=this.parent.getValueFromArg(d)}if(i.indexOf(s)>-1)return s}else if(d.startsWith(this.parent.tic)&&d.endsWith(this.parent.tic)&&d.indexOf('""')>-1?s=(s=d.substring(1,d.length-1)).replace(/""/g,'"'):(s=d.split(this.parent.tic).join(""),(this.parent.isNumber(s)||t.isNullOrUndefined(this.parent.isDate(s))||d.startsWith(" n"))&&(s=this.parent.getValueFromArg(d).split(this.parent.tic).join(""))),i.indexOf(s)>-1)return s;o+=s}return this.isConcat=!1,o},n.prototype.ComputeCONCAT=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.isConcat=!0,this.ComputeCONCATENATE.apply(this,e)},n.prototype.ComputeMAX=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.parent.computeMinMax(e,"max")},n.prototype.ComputeMIN=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.parent.computeMinMax(e,"min")},n.prototype.ComputeRAND=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return 1===t.length&&""===t[0]&&(t.length=0),t.length>0?this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments]:Math.random().toString()},n.prototype.ComputeAND=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=r;return t.isNullOrUndefined(r)||1===i.length&&""===i[0]?this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments]:this.parent.computeAndOrNot(i,"and")},n.prototype.ComputeOR=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=r;return t.isNullOrUndefined(r)||1===i.length&&""===i[0]?this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments]:this.parent.computeAndOrNot(i,"or")},n.prototype.ComputeNOT=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=r;return t.isNullOrUndefined(r)||r.length>1||""===r[0]?this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments]:this.parent.computeAndOrNot(i,"not")},n.prototype.ComputeFIND=function(){for(var r=this,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var a=this.parent.getErrorStrings();if(t.isNullOrUndefined(n)||1===n.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];if(n.length>3)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];var o,s=function(e){var t=r.parent.getValueFromArg(e);return a.indexOf(t)>-1?t:(r.parent.isCellReference(e)||(2===t.split("%").length&&r.parent.isNumber(t.split("%")[0])?t=(.01*Number(t.split("%")[0])).toString():e.indexOf(r.parent.tic)>-1&&(r.parent.removeTics(e).match(/^(\d*\.\d+|\d+)\s*[-*/]\s*(\d*\.\d+|\d+)$/)?t=r.parent.getValueFromArg(r.parent.removeTics(e)):t.indexOf(r.parent.tic+r.parent.tic)>-1&&(t=t.replace(/""/g,r.parent.tic)))),t)};if(!t.isNullOrUndefined(n[0])){if(o=s(n[0]),a.indexOf(o)>-1)return o;this.parent.isCellReference(n[0])||(o=this.parent.removeTics(o))}var l;if(!t.isNullOrUndefined(n[1])){if(l=s(n[1]),a.indexOf(l)>-1)return l;this.parent.isCellReference(n[1])||(l=this.parent.removeTics(l))}var d=1;if(!t.isNullOrUndefined(n[2])){if(d=s(n[2]),a.indexOf(d)>-1)return d;if(d.toUpperCase()===this.parent.trueValue?d="1":d.toUpperCase()===this.parent.falseValue&&(d="0"),this.parent.isCellReference(n[2])||(d=this.parent.removeTics(d)),d=this.parent.parseFloat(d),isNaN(d)||d<=0)return a[e.CommonErrors.Value]}return d=l.indexOf(o,d-1),d<0?a[e.CommonErrors.Value]:(Number(d)+Number(1)).toString()},n.prototype.ComputeINDEX=function(){for(var r=this,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var a,o,s=this.parent.getErrorStrings();if(n.length&&"nestedFormulaTrue"===n[n.length-1]&&(a=!0,n.pop()),t.isNullOrUndefined(n)||1===n.length&&""===n[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];if(n.length<2||n.length>4)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];if(""===n[0])return s[e.CommonErrors.Value];if(-1===n[0].indexOf(":"))return s[e.CommonErrors.Ref];var l,d,h=function(n){if(t.isNullOrUndefined(n)||""===n)return 1;var i=r.parent.getValueFromArg(n);return s.indexOf(i)>-1?i:(i.toUpperCase()===r.parent.trueValue?i="1":i.toUpperCase()===r.parent.falseValue&&(i="0"),i.indexOf(r.parent.tic)>-1&&(i=r.parent.removeTics(i),-1===n.indexOf(r.parent.tic)||""===i.trim())?s[e.CommonErrors.Value]:(2===i.split("%").length&&r.parent.isNumber(i.split("%")[0])&&(i=(Number(i.split("%")[0])/100).toString()),i=parseInt(Number(i).toString(),10),isNaN(i)||i<0?s[e.CommonErrors.Value]:(0===i&&(i=1),i)))};if(o=n[0],l=h(n[1]),s.indexOf(l.toString())>-1)return l.toString();if(d=h(n[2]),s.indexOf(d.toString())>-1)return d.toString();var p=o.indexOf(":"),c=this.parent.rowIndex(o.substring(0,p)),u=this.parent.rowIndex(o.substring(p+1)),f=this.parent.colIndex(o.substring(0,p)),g=this.parent.colIndex(o.substring(p+1));return l>u-c+1||d>g-f+1?s[e.CommonErrors.Ref]:(l=c+l-1,d=f+d-1,o=this.parent.getValueFromArg(this.getSheetReference(o)+this.parent.convertAlpha(d)+l),""===o?0:a&&-1===s.indexOf(o)&&!this.parent.isNumber(o)&&o!==this.parent.trueValue&&o!==this.parent.falseValue?this.parent.tic+o+this.parent.tic:o)},n.prototype.getSheetReference=function(e){return 0===e.indexOf(this.parent.sheetToken)&&e.lastIndexOf(this.parent.sheetToken)>e.indexOf(this.parent.sheetToken)?e.substring(0,e.lastIndexOf(this.parent.sheetToken)+1):""},n.prototype.ComputeIFS=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=r;if(t.isNullOrUndefined(r)||1===i.length&&""===i[0]||i.length%2!=0)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];for(var a="",o="",s=0;s<i.length;s++){if(a=this.parent.getValueFromArg(i[s]),""===i[s])return this.parent.getErrorStrings()[e.CommonErrors.NA];if(this.parent.getErrorStrings().indexOf(a)>-1)return a;if(a!==this.parent.trueValue&&a!==this.parent.falseValue)return this.parent.getErrorStrings()[e.CommonErrors.Value];if(a===this.parent.trueValue)return this.parent.isCellReference(i[s+1].split(this.parent.tic).join(""))||i[s+1].includes(this.parent.arithMarker)?o=""===(o=this.parent.getValueFromArg(i[s+1]))?"0":o:(o=""===i[s+1]?"0":this.parent.getValueFromArg(i[s+1])).indexOf(this.parent.tic)>-1&&(o=o.split(this.parent.tic).join("")),s+=1,o;a===this.parent.falseValue&&(s+=1)}return this.parent.getErrorStrings()[e.CommonErrors.NA]},n.prototype.ComputeCOUNTA=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i,a,o=!1;if(r.length){var s=r[r.length-1];"isSubtotal"===s?(o=!0,r.pop()):"isAggregate"===s&&(a=this.parent.parentObject.getActiveSheet(),i=!0,r.pop())}if(t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];for(var l,d,h,p,c=r,f=0,g=0;g<c.length;g++)if(this.parent.isCellReference(c[g]))if(c[g].indexOf(":")>-1){l=this.parent.getCellCollection(c[g].split(this.parent.tic).join(""));for(var m=0;m<l.length;m++)i&&(p=u(l[m]),tt(a,p[0])||ht(a,p[1]))||(d=o?this.parent.getValueFromArg(l[m],null,null,!0):this.parent.getValueFromArg(l[m]),o&&d.includes("SUBTOTAL(")||d.length>0&&f++)}else{if(d=o?this.parent.getValueFromArg(c[g],null,null,!0):this.parent.getValueFromArg(c[g]),o&&d.includes("SUBTOTAL("))continue;d.length>0&&f++}else(h=this.parent.getValueFromArg(c[g]).split(this.parent.tic).join("")).length>0?f++:0===h.length&&""===h.trim()&&f++;return f},n.prototype.ComputeAVERAGEA=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];for(var i,a,o,s,l=r,d=0,h=0,p=0;p<l.length;p++)if(this.parent.isCellReference(l[p]))if(l[p].indexOf(":")>-1){i=this.parent.getCellCollection(l[p].split(this.parent.tic).join(""));for(var c=0;c<i.length;c++){if(a=this.parent.getValueFromArg(i[c]),a=this.processLogicalCellValue(a),this.parent.getErrorStrings().indexOf(a)>-1)return a;t.isNullOrUndefined(a)||""===a||(s=this.parent.parseFloat(a),d+=a=isNaN(s)?0:s,h+=1)}}else{if(a=this.parent.getValueFromArg(l[p]),a=this.processLogicalCellValue(a),this.parent.getErrorStrings().indexOf(a)>-1)return a;if(t.isNullOrUndefined(a)||""===a)continue;s=this.parent.parseFloat(a),d+=a=isNaN(s)?0:s,h+=1}else{if(l[p].indexOf(this.parent.tic)>-1&&(isNaN(this.parent.parseFloat(l[p].split(this.parent.tic).join("")))||""===l[p].split(this.parent.tic).join("").trim()))return this.parent.getErrorStrings()[e.CommonErrors.Value];if(l[p]=this.processLogicalCellValue(l[p]),o=this.parent.getValueFromArg(l[p].split(this.parent.tic).join("")),this.parent.getErrorStrings().indexOf(o)>-1)return o;d+=this.parent.parseFloat(o),h+=1}return 0===h?this.parent.getErrorStrings()[e.CommonErrors.DivZero]:d/h},n.prototype.processLogicalCellValue=function(e){var t=e;return t.toUpperCase()===this.parent.trueValue?t="1":t.toUpperCase()===this.parent.falseValue&&(t="0"),t},n.prototype.ComputeSORT=function(){for(var n=this,i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];var o,s;i.length&&"nestedFormulaTrue"===i[i.length-1]&&(o=!0,i.pop());var l,d=i,h=[];if(t.isNullOrUndefined(i)||""===i[0]||d.length>4)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];d[1]=d[1]?d[1]:"1",d[2]=d[2]?d[2]:"1",d[3]=d[3]?d[3]:"FALSE",d[0]=d[0].split("$").join("");var p,c=[];if(d[0].indexOf(":")>-1){var u=d[0].split(":");if(this.parent.isCellReference(u[0])&&this.parent.isCellReference(u[1])){var f=d[0].indexOf(":"),g=void 0,m=this.parent.rowIndex(this.parent.substring(d[0],0,f)),v=this.parent.colIndex(this.parent.substring(d[0],0,f)),y=this.parent.rowIndex(this.parent.substring(d[0],f+1,f+d[0].length-f-1)),C=this.parent.colIndex(this.parent.substring(d[0],f+1,f+d[0].length-f-1));if(m>y&&(g=y,y=m,m=g),v>C&&(g=C,C=v,v=g),this.parent.isCellReference(d[3])){if(d[3]=this.parent.getValueFromArg(d[3]).toUpperCase(),d[3]!==this.parent.trueValue&&d[3]!==this.parent.falseValue)if(fe(d[3]))d[3]=0===Number(d[3])?this.parent.falseValue:this.parent.trueValue;else{if(""!==d[3])return this.parent.getErrorStrings()[e.CommonErrors.Value];d[3]=this.parent.falseValue}}else if(s=d[3].startsWith(this.parent.tic)&&d[3].endsWith(this.parent.tic),d[3]=this.parent.getValueFromArg(d[3]),d[3]=fe(d[3])?0===Number(d[3])?this.parent.falseValue:this.parent.trueValue:d[3].split(this.parent.tic).join("").toUpperCase(),d[3]!==this.parent.trueValue&&d[3]!==this.parent.falseValue)return this.parent.getErrorStrings()[s?e.CommonErrors.Value:e.CommonErrors.Name];if(this.parent.isCellReference(d[2])?(d[2]=this.parent.getValueFromArg(d[2]),d[2]=d[2]===this.parent.trueValue?"1":d[2]):(d[2]=this.parent.getValueFromArg(d[2]),d[2]=d[2]===this.parent.trueValue?"1":d[2].split(this.parent.tic).join("")),d[2]=fe(d[2])?Math.floor(Number(d[2])).toString():d[2],"1"!==d[2]&&"-1"!==d[2])return this.parent.getErrorStrings().indexOf(d[2])>-1?this.parent.getErrorStrings()[e.CommonErrors.Name]:this.parent.getErrorStrings()[e.CommonErrors.Value];var b="1"===d[2]?"Ascending":"Descending";if(this.parent.isCellReference(d[1])){if(d[1]=this.parent.getValueFromArg(d[1]),d[1]=fe(d[1])?Math.floor(Number(d[1])).toString():d[1]===this.parent.trueValue?"1":d[1]===this.parent.falseValue?"0":d[1],isNaN(this.parseDouble(d[1]))||(this.parseDouble(d[1])<1||(d[3]===this.parent.trueValue?y-m+1<this.parseDouble(d[1]):C-v+1<this.parseDouble(d[1]))))return this.parent.getErrorStrings()[e.CommonErrors.Value]}else if(s=d[1].startsWith(this.parent.tic)&&d[1].endsWith(this.parent.tic),d[1]=this.parent.getValueFromArg(d[1]),d[1]=fe(d[1])?Math.floor(Number(d[1])).toString():d[1]===this.parent.trueValue?"1":d[1]===this.parent.falseValue?"0":d[1].split(this.parent.tic).join(""),isNaN(this.parseDouble(d[1]))?s:this.parseDouble(d[1])<1||(d[3]===this.parent.trueValue?y-m+1<this.parseDouble(d[1]):C-v+1<this.parseDouble(d[1])))return this.parent.getErrorStrings()[e.CommonErrors.Value];var x="";0===d[0].indexOf("!")&&(x=(x=(x=d[0]).replace("!","")).indexOf("!"),x=d[0].substring(0,x+2)),d[0]=x+Xe(v)+m+":"+Xe(C)+y,p=this.parent.getCellCollection(d[0]);for(A=0;A<p.length;A++)c.push(this.parent.getValueFromArg(p[A]));var S=[],w=[],I=[],E=[],R=[],N=C-v+1,F=function(e){e?"TRUE"===e.toUpperCase()||"FALSE"===e.toUpperCase()?(E.push(e),S.push(e)):isNaN(n.parseDouble(e))?(I.push(e),S.push(e)):(w.push(n.parseDouble(e)),S.push(n.parseDouble(e))):""===e&&(R.push(n.parseDouble(e).toString()),S.push(n.parseDouble(e).toString()))};if("TRUE"===d[3])for(A=0;A<N;A++)F(c[A+(this.parseDouble(d[1])-1)*N]);if("FALSE"===d[3])for(var A=0;A<c.length;A++)F(c[A*N+this.parseDouble(d[1])-1]);for(var k=w.length>0?r.DataUtil.sort(w,null,r.DataUtil.fnSort(b)):[],O=I.length>0?r.DataUtil.sort(I,null,r.DataUtil.fnSort(b)):[],T=E.length>0?r.DataUtil.sort(E,null,r.DataUtil.fnSort(b)):[],D="Ascending"===b?k.concat(O,T,R):T.concat(O,k,R),L=[],P=0;P<D.length;P++)for(var M=0;M<S.length;M++)JSON.stringify(D[P])===JSON.stringify(S[M])&&-1===L.indexOf(M)&&L.push(M);if("TRUE"===d[3]){for(var B=m,H=0;B<=y;B++,H++)for(var P=0,U=0;P<L.length;P++,U++){var V=this.parent.getValueFromArg(x+Xe(L[P]+v)+B);if(o&&""!==V)h.push(V);else{V=""===V?"0":V,W=(W=this.parent.actCell).indexOf("!")>-1?W.substring(W.lastIndexOf("!")+1):W;var z=this.parent.rowIndex(W),j=this.parent.colIndex(W);this.parent.parentObject.setValueRowCol(this.parent.getSheetID(this.parent.grid)+1,V,z+H,j+U)}}l=this.parent.getValueFromArg(x+Xe(L[0]+v)+m)}if("FALSE"===d[3]){for(var P=0,H=0;P<L.length;P++,H++)for(var _=v,U=0;_<=C;_++,U++){var q=this.parent.getValueFromArg(x+Xe(_)+(L[P]+m));if(o&&""!==q)h.push(q);else{q=""===q?"0":q;var W=this.parent.actCell;W=W.indexOf("!")>-1?W.substring(W.lastIndexOf("!")+1):W;var j=this.parent.colIndex(W),z=this.parent.rowIndex(W);this.parent.parentObject.setValueRowCol(this.parent.getSheetID(this.parent.grid)+1,q,z+H,j+U)}}l=this.parent.getValueFromArg(x+Xe(v)+(L[0]+m))}}}return o?h.join(","):""===l?"0":l},n.prototype.ComputeCOUNTIF=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=r;if(t.isNullOrUndefined(r)||""===r[0]||2!==i.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];if(i[0].indexOf(":")<0&&!this.parent.isCellReference(i[0]))return this.parent.getErrorStrings()[e.CommonErrors.Name];var a,o,s=0,l=[],d="equal";if(""===i[1])return 0;var h=i[1].startsWith(this.parent.tic)&&i[1].endsWith(this.parent.tic),p=i[1].split(this.parent.tic).join(""),c=p.includes("*"),u="*"===p||"<>*"===p,f=c&&!u?p.replace(/\*/g,"").trim():p,g=!1;if(!h&&this.parent.isCellReference(f)&&(f=this.parent.getValueFromArg(f),g=!0),c&&!u){var m=p.indexOf("*");"*"===p[0]&&(f="*"+f),"*"===p[p.length-1]&&(f+="*"),m>0&&m<p.length-1&&(f=p.substring(0,m)+"*"+p.substring(m+1))}(p=f).startsWith("<=")?(d="lessEq",p=p.substring(2)):p.startsWith(">=")?(d="greaterEq",p=p.substring(2)):p.startsWith("<>")?(d="notEq",p=p.substring(2)):p.startsWith("<")?(d="less",p=p.substring(1)):p.startsWith(">")?(d="greater",p=p.substring(1)):p.startsWith("=")&&(d="equal",p=p.substring(1));var v=p.indexOf("*")>-1||p.indexOf("?")>-1;if((!h&&this.parent.isCellReference(p)&&!g||p.includes(this.parent.arithMarker)||p.includes(this.parent.getParseDecimalSeparator())&&!v)&&(p=this.parent.getValueFromArg(p)),i[0].indexOf(":")>-1&&this.parent.isCellReference(i[0])){a=this.parent.getCellCollection(i[0].split(this.parent.tic).join(""));for(var y=0;y<a.length;y++)o=this.parent.getValueFromArg(a[y]),v&&(o=this.parent.findWildCardValue(p.toLowerCase(),o.toLowerCase())),l.push(o),l.push(p),this.parent.processLogical(l,d)===this.parent.trueValue&&s++}return s},n.prototype.ComputeSUMIFS=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.calculateIFS(e)},n.prototype.calculateIFS=function(r,n){var i=this;if(t.isNullOrUndefined(r)||""===r[0]||r.length<2||r.length>127)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];if(3===r.length&&r[2].includes(this.parent.tic+this.parent.tic)){var a,o="",s=this.parent.getParseArgumentSeparator();return r[2].split(this.parent.tic+this.parent.tic).forEach(function(e){(e=e.trim().split(i.parent.tic).join(""))&&(a=i.parent.computeIfsFormulas([r[0],r[1],e],i.parent.falseValue,n).toString(),o+=(o?s:"")+a)}),o}return this.parent.computeIfsFormulas(r,this.parent.falseValue,n)},n.prototype.ComputeTEXT=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i;r.length&&"nestedFormulaTrue"===r[r.length-1]&&(i=!0,r.pop());var a=r.length,o=r[0],s=r[1];if(2!==a)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];var l=o,d=s;if(""===s)return this.parent.getValueFromArg(l);var h=new Date(1900,0,1,0,0,0),p=l+","+d,c=new t.Internationalization;if(this.parent.getErrorStrings().indexOf(p)>-1)return p;if(l=this.parent.getValueFromArg(l),fe(l.split(this.parent.tic).join(""))&&(l=l.split(this.parent.tic).join("")),""===(d=s.startsWith('"')&&s.endsWith('"')?d.split(this.parent.tic).join(""):this.parent.getValueFromArg(d)))return"";""===l&&(d.length>0&&(d.toUpperCase().indexOf("M")>-1||d.toUpperCase().indexOf("D")>-1||d.toUpperCase().indexOf("Y")>-1||d.toUpperCase().indexOf("S")>-1||d.toUpperCase().indexOf("T")>-1)||d.toUpperCase().indexOf("H")>-1)&&(l=h.toString());var u=this.parseDouble(l);if(isNaN(u)&&null!==this.parent.isDate(new Date(l))&&(u=this.parent.toOADate(new Date(l))),h=Date.parse(l.split(this.parent.tic).join("")),!isNaN(u)||!isNaN(h))if(d.length>0&&-1===d.indexOf("#")&&(d.toUpperCase().indexOf("M")>-1||d.toUpperCase().indexOf("D")>-1||d.toUpperCase().indexOf("Y")>-1||d.toUpperCase().indexOf("S")>-1||d.toUpperCase().indexOf("T")>-1)||d.toUpperCase().indexOf("H")>-1){var f=(d=(d=d.split("Y").join("y").split("D").join("d").split("H").join("h")).split("S").join("s").split("m").join("M").split("AM/PM").join("tt")).split(""),g=!1,m=!1,v=0,y=0;for(v=0;v<f.length;){var C=f[v];"s"===C&&"M"===f[y]&&(f[y]="m","M"===f[y-1]&&(f[y-1]="m")),this.parent.isChar(C)&&(y=v),"M"===C&&g&&(f[v]="m",m=!0),"h"===C?g=!0:this.parent.isChar(C)&&"M"!==C&&"h"!==C&&!m&&(g=!1,m=!1),v++}d=(d=String(f)).split(",").join("").split("\n").join(" ");var b=this.parent.fromOADate(u);0===u&&(b=h);var x=Ge(d);if(""===x){var S=ce(b);return this.parent.parentObject.getDisplayText({format:d,value:S})}l=c.getDateFormat({skeleton:x,type:"date"})(new Date(b.toString()))}else l=this.parent.parentObject.getDisplayText({format:d,value:u});return i?this.parent.tic+l+this.parent.tic:l},n.prototype.ComputeCOUNTIFS=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.parent.computeIfsFormulas(e,this.parent.trueValue)},n.prototype.ComputeAVERAGEIFS=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.calculateIFS(e,this.parent.trueValue)},n.prototype.ComputeMATCH=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=r.slice(),a=this.parent.getErrorStrings();if(t.isNullOrUndefined(i)||1===i.length&&""===i[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];if(i.length<2||i.length>3)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];i[0]=this.parent.getValueFromArg(r[0]);var o=i[0].indexOf(this.parent.tic)>-1;if(i[0]=i[0].split(this.parent.tic).join(""),a.indexOf(i[0])>-1)return i[0];if(""===i[0])return a[e.CommonErrors.NA];isNaN(Number(i[0]))&&(o=!0);var s;if(t.isNullOrUndefined(r[2]))i[2]="1";else{if(i[2]=this.parent.getValueFromArg(i[2]),i[2].indexOf(this.parent.tic)>-1&&isNaN(Number(i[2].split(this.parent.tic).join(""))))return a[e.CommonErrors.Value];i[2].toUpperCase()===this.parent.trueValue?i[2]="1":i[2].toUpperCase()===this.parent.falseValue&&(i[2]="0")}s=parseFloat(i[2]),-1===[-1,0,1].indexOf(s)&&(s=0);var l,d=[],h=!1;if(i[1].indexOf(":")>-1||this.parent.isCellReference(i[1])){l=this.parent.getCellCollection(i[1]);for(var p=0;p<l.length;p++){var c=this.parent.getValueFromArg(l[p]);(c.indexOf(this.parent.tic)>-1||isNaN(Number(c)))&&(h=!0),d[p]=c.split(this.parent.tic).join("")}if(o&&!h||!o&&h)return a[e.CommonErrors.NA]}for(var u=0,f="",g=!1,m=isNaN(Number(i[0]))?i[0]:Number(i[0]),v=0;v<d.length;v++)if(""!==d[v]){if(-1===s&&(o||h))break;var y=isNaN(Number(d[v]))?d[v]:Number(d[v]);if(1===s)m===y?(u=v+1,g=!0,isNaN(Number(i[0]))&&(o=!1)):m>y&&!o&&!g&&(!f||y>(isNaN(Number(f))?f:Number(f)))&&(u=v+1,f=d[v]);else if(0===s){if((i[0].indexOf("*")>-1||i[0].indexOf("?")>-1)&&(d[v]=this.parent.findWildCardValue(i[0],d[v])),i[0]===d[v])return v+1}else if(-1===s){if(!(Number(d[v])>Number(d[v+1])||v===d.length-1))return a[e.CommonErrors.NA];m===y?(u=v+1,m=void 0):m<y&&(!f||y<(isNaN(Number(f))?f:Number(f)))&&(u=v+1,f=d[v])}}else v===d.length-1&&d.pop();return o&&h&&1===s?d.length:u||a[e.CommonErrors.NA]},n.prototype.ComputeLOOKUP=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=r;return t.isNullOrUndefined(i)||1===i.length&&""===i[0]?this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments]:this.parent.computeLookup(i)},n.prototype.ComputeVLOOKUP=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e;return this.parent.computeVHLookup(r,!0)},n.prototype.ComputeHLOOKUP=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e;return this.parent.computeVHLookup(r)},n.prototype.ComputeSUBTOTAL=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i,a=this.parent.getErrorStrings();if(t.isNullOrUndefined(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];if(r.length<2)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];if(i=this.parent.getValueFromArg(r[0]).trim(),a.indexOf(i)>-1)return i;if(""===i.split(this.parent.tic).join("").trim())return a[e.CommonErrors.Value];if(this.parent.isCellReference(r[0])||(i=this.parent.removeTics(i)),i.toUpperCase()===this.parent.trueValue?i="1":i.toUpperCase()===this.parent.falseValue?i="0":2===i.split("%").length&&this.parent.isNumber(i.split("%")[0])&&(i=(Number(i.split("%")[0])/100).toString()),i=this.parent.parseFloat(i),isNaN(i)||(1>i||i>11)&&(101>i||i>111))return a[e.CommonErrors.Value];var o=r.slice(1,r.length);switch(i){case 1:case 101:i=this.ComputeAVERAGE.apply(this,o.concat(["isSubtotal"]));break;case 2:case 102:i=this.ComputeCOUNT.apply(this,o.concat(["isSubtotal"]));break;case 3:case 103:i=this.ComputeCOUNTA.apply(this,o.concat(["isSubtotal"]));break;case 4:case 104:i=this.ComputeMAX.apply(this,o.concat(["isSubtotal"]));break;case 5:case 105:i=this.ComputeMIN.apply(this,o.concat(["isSubtotal"]));break;case 6:case 106:i=this.ComputePRODUCT.apply(this,o.concat(["isSubtotal"]));break;case 7:case 107:i=this.ComputeDAY.apply(this,o);break;case 8:case 108:i=this.ComputeCONCAT.apply(this,o);break;case 9:case 109:i=this.ComputeSUM.apply(this,o.concat(["isSubtotal"]));break;case 10:case 110:i=this.ComputeAVERAGEA.apply(this,o);break;case 11:case 111:i=this.ComputeABS.apply(this,o);break;default:i=a[e.CommonErrors.Value]}return i},n.prototype.ComputeRADIANS=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i,a=this.parent.getErrorStrings();return t.isNullOrUndefined(r)||""===r[0]&&1===r.length||2===r[0].split("!").length&&-1===r[0].indexOf(this.parent.tic)?this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments]:r.length>1?this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments]:r[0].indexOf(":")>-1||""===r[0].split(this.parent.tic).join("").trim()||"!"===r[0].split(this.parent.tic).join("").trim()||2===r[0].split("!").length?a[e.CommonErrors.Value]:(i=this.parent.getValueFromArg(r[0]).trim(),a.indexOf(i)>-1?i:i.indexOf(this.parent.tic)>-1&&-1===r[0].indexOf(this.parent.tic)||i.split(this.parent.tic).length>3?a[e.CommonErrors.Value]:(i.toUpperCase()===this.parent.trueValue?i="1":i.toUpperCase()===this.parent.falseValue?i="0":2===i.split("%").length&&this.parent.isNumber(i.split("%")[0])&&(i=(Number(i.split("%")[0])/100).toString()),i=this.parent.parseFloat(i.split(this.parent.tic).join("")),isNaN(i)?this.parent.isCellReference(r[0])||r[0].indexOf(this.parent.tic)>-1?a[e.CommonErrors.Value]:a[e.CommonErrors.Name]:i=Math.PI*i/180))},n.prototype.ComputeRANDBETWEEN=function(){for(var t=this,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i,a;if(1===r.length&&""===r[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];if(2!==r.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];var o=this.parent.getErrorStrings(),s=function(r){var n;if(n=t.parent.getValueFromArg(r),o.indexOf(n)>-1)return n;if(t.parent.isCellReference(r)){if(""===n)n="0";else if(r.indexOf(":")>-1||n.match(/^(\d*\.\d+|\d+)\s*[+\-*/]\s*(\d*\.\d+|\d+)$/))return o[e.CommonErrors.Value]}else{if(""===n)return o[e.CommonErrors.NA];if(r.indexOf(t.parent.tic)>-1&&t.parent.removeTics(r).match(/^(\d*\.\d+|\d+)\s*[+*]\s*(\d*\.\d+|\d+)$/))return o[e.CommonErrors.Value];if(n.indexOf(t.parent.tic)>-1&&(n=t.parent.removeTics(n)).indexOf(":")>-1){var i=n.split(":");if(!(i.length<=3))return o[e.CommonErrors.Value];if(!t.parent.isNumber(i[0])||!t.parent.isNumber(i[1]))return o[e.CommonErrors.Value];var a=Number(i[0])+Number(Number(i[1])/60);if(3===i.length){if(!t.parent.isNumber(i[2]))return o[e.CommonErrors.Value];a+=Number(Number(i[2])/3600)}n=(a/24).toString()}2===n.split("%").length&&t.parent.isNumber(n.split("%")[0])&&(n=(.01*Number(n.split("%")[0])).toString())}return n=parseFloat(n),isNaN(n)?o[e.CommonErrors.Value]:n};return a=s(r[1]),o.indexOf(a)>-1?a:(i=s(r[0]),o.indexOf(i)>-1?i:0===i&&0===a?"0":a<i?o[e.CommonErrors.Num]:(i=Math.ceil(i),a=Math.floor(a),Math.floor(Math.random()*(a-i+1)+i)))},n.prototype.ComputeSLOPE=function(){for(var r=this,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var a=this.parent.getErrorStrings();if(t.isNullOrUndefined(n)||1===n.length&&""===n[0].trim())return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];if(2!==n.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];if(""===n[0]||""===n[1])return a[e.CommonErrors.Value];var o=function(e){return e=-1===e.indexOf(r.parent.tic)?r.parent.getCellCollection(e.split(r.parent.tic).join("")):void 0},s=o(n[0].trim()),l=o(n[1].trim());if(t.isNullOrUndefined(s)||t.isNullOrUndefined(l)||s.length<2&&l.length<2)return a[e.CommonErrors.DivZero];if(s.length!==l.length)return a[e.CommonErrors.NA];var d=function(e){e=r.getDataCollection(e);for(var t=0;t<e.length;t++)if(a.indexOf(e[t])>-1)return e[t].toString();return e};if(s=d(s),a.indexOf(s.toString())>-1)return s.toString();if(l=d(l),a.indexOf(l.toString())>-1)return l.toString();for(var h=0,p=0,c=0,u=0,f=0,g=0,m=l.length;g<m;++g)""!==l[g]&&"NaN"!==Number(l[g]).toString()&&""!==s[g]&&"NaN"!==Number(s[g]).toString()&&(h+=Number(l[g])*Number(s[g]),c+=Number(l[g]),u+=Number(s[g]),p+=Number(l[g])*Number(l[g]),f++);var v=((h-c*u/f)/(p-c*c/f)).toString();return"NaN"===v?a[e.CommonErrors.DivZero]:v},n.prototype.ComputeINTERCEPT=function(){for(var r=this,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var a=this.parent.getErrorStrings();if(t.isNullOrUndefined(n)||1===n.length&&""===n[0].trim())return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];if(2!==n.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];if(""===n[0]||""===n[1])return a[e.CommonErrors.Value];var o=function(e){return e=-1===e.indexOf(r.parent.tic)?r.parent.getCellCollection(e.split(r.parent.tic).join("")):void 0},s=o(n[0].trim()),l=o(n[1].trim());if(t.isNullOrUndefined(s)||t.isNullOrUndefined(l)||s.length<2&&l.length<2)return a[e.CommonErrors.DivZero];if(s.length!==l.length)return a[e.CommonErrors.NA];var d=function(e){e=r.getDataCollection(e);for(var t=0;t<e.length;t++)if(a.indexOf(e[t])>-1)return e[t];return e};if(s=d(s),a.indexOf(s.toString())>-1)return s.toString();if(l=d(l),a.indexOf(l.toString())>-1)return l.toString();var h,p=0,c=0,u=0,f=0,g=0,m=function(e){for(var t=0,r=l.length;t<r;++t)""!==s[t]&&"NaN"!==Number(s[t]).toString()&&""!==l[t]&&"NaN"!==Number(l[t]).toString()&&(e?(p+=Number(s[t]),c+=Number(l[t]),u++):(h=Number(l[t])-c,f+=h*(Number(s[t])-p),g+=h*h))};m(!0),p/=u,c/=u,m(!1);var v=(p-f/g*c).toString();return"NaN"===v?a[e.CommonErrors.DivZero]:v},n.prototype.ComputeLN=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i,a=this.parent.getErrorStrings();return t.isNullOrUndefined(r)||""===r[0]&&1===r.length?this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments]:0===r.length||r.length>1?this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments]:(i=this.parent.getValueFromArg(r[0]),a.indexOf(i)>-1?i:(i.toUpperCase()===this.parent.trueValue?i="1":i.toUpperCase()===this.parent.falseValue&&(i="0"),this.parent.isCellReference(r[0])||""!==(i=this.parent.removeTics(i)).trim()?(2===i.split("%").length&&this.parent.isNumber(i.split("%")[0])&&(i=(.01*Number(i.split("%")[0])).toString()),i=this.parent.parseFloat(i),i<=0?a[e.CommonErrors.Num]:isNaN(i)?a[e.CommonErrors.Value]:Math.log(i)):a[e.CommonErrors.Value]))},n.prototype.ComputeISNUMBER=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t;if(1===t.length&&""===t[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];if(1!==t.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];var i=this.parent.isCellReference(n[0])?this.parent.getValueFromArg(n[0]):this.parent.getValueFromArg(n[0].split(this.parent.tic).join(""));if(""===i.toString()||t.toString().startsWith(this.parent.tic))return!1;var a=this.parent.parseFloat(i);return!isNaN(a)},n.prototype.ComputeROUND=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if(!t.length||1===t.length||t.length>2)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];var n=t;if(1===t.length){var i="TRUE"===n[0].split(this.parent.tic).join("")?"1":"FALSE"===n[0].split(this.parent.tic).join("")?"0":n[0];return isNaN(this.parent.parseFloat(i))?this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments]:Math.round(this.parent.parseFloat(i)).toString()}var a=this.parent.getValueFromArg(n[0]);if(this.parent.getErrorStrings().indexOf(a)>-1)return a;var o=this.parent.getValueFromArg(n[1]);if(this.parent.getErrorStrings().indexOf(o)>-1)return o;a="TRUE"===a?"1":"FALSE"===a?"0":a,o="TRUE"===o?"1":"FALSE"===o?"0":o,a=a.split(this.parent.tic).join(""),o=o.split(this.parent.tic).join("");var s=isNaN(Number(a))||""===a.trim(),l=isNaN(Number(o))||""===o.trim();if((n[0].indexOf('"')>-1||this.parent.isCellReference(n[0]))&&s||(n[1].indexOf('"')>-1||this.parent.isCellReference(n[1]))&&l)return this.parent.getErrorStrings()[e.CommonErrors.Value];if(""===a&&""===o||""===a)return 0;var d,h=this.parent.parseFloat(a),p=this.parent.parseFloat(o);if(!isNaN(p)&&!isNaN(h)&&p>0)d=this.parent.parseFloat(this.preciseRound(h,p,"ROUND"));else{var c=Math.pow(10,-p);d=Math.round(h/c)*c}return d.toString()},n.prototype.preciseRound=function(e,t,r){var n=Math.pow(10,t),i=Math.abs(e)*n;return((e>=0?1:-1)*(("ROUND"===r?Math.round(i):"ROUNDDOWN"===r?Math.floor(i):Math.ceil(i))/n)).toFixed(t)},n.prototype.ComputePOWER=function(){for(var r=this,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var a,o=this.parent.getErrorStrings();if(t.isNullOrUndefined(n)||1===n.length&&""===n[0].trim())return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];if(n.length>2)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];if(""===n[0].trim()&&""===n[1].trim())return o[e.CommonErrors.Num];var s=function(t){var n=r.parent.getValueFromArg(t);if(o.indexOf(n)>-1)return n;if(n.toUpperCase()===r.parent.trueValue?n="1":n.toUpperCase()===r.parent.falseValue&&(n="0"),n.indexOf(r.parent.tic)>-1&&(n=r.parent.removeTics(n),-1===t.indexOf(r.parent.tic)||""===n.trim()))return o[e.CommonErrors.Value];if(2===n.split("%").length&&r.parent.isNumber(n.split("%")[0]))n=(Number(n.split("%")[0])/100).toString();else if(n.indexOf("/")>-1&&r.parent.isNumber(n.split("/").join("")))return o[e.CommonErrors.Num];return n=r.parent.parseFloat(n),isNaN(n)?o[e.CommonErrors.Value]:n},l=s(n[0]);if(o.indexOf(l)>-1)return l;var d=s(n[1]);return o.indexOf(d)>-1?d:isNaN(l)||isNaN(d)?o[e.CommonErrors.Value]:0===l&&d<0?o[e.CommonErrors.DivZero]:0===l&&0===d?o[e.CommonErrors.Num]:(a=Math.pow(l,d),isNaN(a)||a===1/0?o[e.CommonErrors.Num]:a.toString())},n.prototype.ComputeSQRT=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n,i=t[0];if(0===t.length||t.length>1||""===i)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];if(""===i.split(this.parent.tic).join("").trim())return this.parent.getErrorStrings()[e.CommonErrors.Value];if(this.parent.isCellReference(i)){if((n=this.parent.getValueFromArg(i)||"0").indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[e.CommonErrors.Value]}else{if(i.indexOf(this.parent.tic)>-1&&(i.split(this.parent.tic).join("")===this.parent.trueValue||i.split(this.parent.tic).join("")===this.parent.falseValue))return this.parent.getErrorStrings()[e.CommonErrors.Value];n=this.parent.getValueFromArg(i).split(this.parent.tic).join("")}if(this.parent.getErrorStrings().indexOf(n)>-1)return n;if(n=n===this.parent.trueValue?"1":n===this.parent.falseValue?"0":n,this.parent.parseFloat(n)<0)return this.parent.getErrorStrings()[e.CommonErrors.Num];if(isNaN(this.parent.parseFloat(n))){var a={value:n};if(this.parent.parentObject.notify(Zr,a),!a.isDate&&!a.isTime)return this.parent.getErrorStrings()[e.CommonErrors.Value];n=a.updatedVal}return Math.sqrt(this.parent.parseFloat(n))},n.prototype.ComputeLOG=function(){for(var r=this,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var a,o,s=this.parent.getErrorStrings();if(t.isNullOrUndefined(n)||1===n.length&&""===n[0])return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];if(n.length>2)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];var l=function(t){var n=r.parent.getValueFromArg(t);if(n===r.parent.trueValue?n="1":n===r.parent.falseValue&&(n="0"),!r.parent.isCellReference(t)&&""!==n){if(n.indexOf(r.parent.tic)>-1&&-1===s.indexOf(n.split(r.parent.tic).join(""))){if(""===(n=r.parent.removeTics(n)).trim())return s[e.CommonErrors.Value];if(n.indexOf(":")>-1){var i=n.split(":");if(!(i.length<=3))return s[e.CommonErrors.Value];if(!r.parent.isNumber(i[0])||!r.parent.isNumber(i[1]))return s[e.CommonErrors.Value];var a=Number(i[0])+Number(Number(i[1])/60);if(3===i.length){if(!r.parent.isNumber(i[2]))return s[e.CommonErrors.Value];a+=Number(Number(i[2])/3600)}n=(a/24).toString()}}2===n.split("%").length&&r.parent.isNumber(n.split("%")[0])&&(n=(.01*Number(n.split("%")[0])).toString())}return n};if(!t.isNullOrUndefined(n[0])){if(a=l(n[0]),s.indexOf(a)>-1)return a;a=this.parent.parseFloat(a)}if(o=10,!t.isNullOrUndefined(n[1])){if(o=l(n[1]),s.indexOf(o)>-1)return o;o=this.parent.parseFloat(o)}return a=Number(a),isNaN(a)||isNaN(o)?s[e.CommonErrors.Value]:a<=0||o<=0?s[e.CommonErrors.Num]:1===o?s[e.CommonErrors.DivZero]:(Math.log(a)/Math.LN10/(Math.log(o)/Math.LN10)).toString()},n.prototype.ComputeTRUNC=function(){for(var r=this,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var a,o=0,s=this.parent.getErrorStrings();if(t.isNullOrUndefined(n)||""===n[0]&&1===n.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];if(0===n.length||n.length>2)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];var l=function(t){var n=r.parent.getValueFromArg(t);if(s.indexOf(n)>-1)return n;if(n===r.parent.trueValue)n="1";else if(n===r.parent.falseValue)n="0";else if(!r.parent.isCellReference(t)){if(t.indexOf(r.parent.tic)>-1&&r.parent.removeTics(t).match(/^(\d*\.\d+|\d+)\s*[*]\s*(\d*\.\d+|\d+)$/))n=r.parent.getValueFromArg(r.parent.removeTics(t));else if(n.indexOf(r.parent.tic)>-1){if(""===(n=r.parent.removeTics(n)).trim())return s[e.CommonErrors.Value];if(n.indexOf(":")>-1){var i=n.split(":");if(!(i.length<=3))return s[e.CommonErrors.Value];if(!r.parent.isNumber(i[0])||!r.parent.isNumber(i[1]))return s[e.CommonErrors.Value];var a=Number(i[0])+Number(Number(i[1])/60);if(3===i.length){if(!r.parent.isNumber(i[2]))return s[e.CommonErrors.Value];a+=Number(Number(i[2])/3600)}n=(a/24).toString()}}2===n.split("%").length&&r.parent.isNumber(n.split("%")[0])&&(n=(.01*Number(n.split("%")[0])).toString())}return n};if(!t.isNullOrUndefined(n[0])){if(a=l(n[0]),s.indexOf(a)>-1)return a;if(a=this.parent.parseFloat(a),isNaN(a))return s[e.CommonErrors.Value]}if(!t.isNullOrUndefined(n[1])){if(o=l(n[1]),s.indexOf(o)>-1)return o;if(o=this.parent.parseFloat(o),isNaN(o))return s[e.CommonErrors.Value]}return o=Math.pow(10,Math.floor(o)),a=Number(a),((a<0?-1:1)*Math.floor(o*Math.abs(a))/o).toString()},n.prototype.ComputeEXP=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n,i=this.parent.getErrorStrings();if(""===t[0]&&1===t.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidArguments];if(1!==t.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];if(""===t[0].split(this.parent.tic).join("").trim())return i[e.CommonErrors.Value];if(n=this.parent.getValueFromArg(t[0]),i.indexOf(n)>-1)return n;if(n.indexOf(this.parent.tic)>-1&&(this.parent.isCellReference(t[0])||isNaN(Number(n.split(this.parent.tic).join("")))))return i[e.CommonErrors.Value];if((n=n.split(this.parent.tic).join(""))===this.parent.trueValue)n="1";else if(n===this.parent.falseValue||""===n)n="0";else if(n.indexOf("%")>-1)n=(Number(n.split("%")[0])/100).toString();else if(n.indexOf(":")>-1)return"0";var a=this.parent.parseFloat(n);return isNaN(a)?i[e.CommonErrors.Value]:a>709?i[e.CommonErrors.Num]:Math.exp(a).toString()},n.prototype.ComputeGEOMEAN=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n,i,a,o,s=t,l=1,d=0,h=0,p=0;if(0===t.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];if(1===s.length&&""===s[0])return l.toString();var c;for(i=0;i<s.length;i++)if(s[i].indexOf(":")>-1){if(s[0]===this.parent.tic)return this.parent.getErrorStrings()[e.CommonErrors.Value];for(o=this.parent.getCellCollection(s[i].split(this.parent.tic).join("")),a=0;a<o.length;a++){if(h=this.parent.getValueFromArg(o[a]),p=h.split(this.parent.tic).join(""),c=p===this.parent.trueValue||p===this.parent.falseValue,(n=this.parent.parseFloat(h))<=0)return this.parent.getErrorStrings()[e.CommonErrors.Num];c||this.parent.getErrorStrings().indexOf(h)>-1||(isNaN(n)||(d++,l*=n))}}else{if(h=this.parent.getValueFromArg(s[i]),this.parent.getErrorStrings().indexOf(h)>-1)return h;var u=h.split(this.parent.tic).join("");if(h.indexOf('"')>-1&&isNaN(this.parent.parseFloat(u)))return this.parent.getErrorStrings()[e.CommonErrors.Value];if(s[i]=s[i].startsWith("n")?s[i].slice(1):s[i],""===h&&""===s[i])return this.parent.getErrorStrings()[e.CommonErrors.Num];if(("TRUE"===u||"FALSE"===u)&&this.parent.isCellReference(s[i]))continue;if(h.length>0){if(h=h.indexOf('"')>-1?u:h,h="TRUE"===h.split(this.parent.tic).join("")?"1":"FALSE"===h.split(this.parent.tic).join("")?"0":h,!this.parent.isCellReference(s[i])&&isNaN(this.parent.parseFloat(h)))return this.parent.getErrorStrings()[e.CommonErrors.Value];if((n=this.parent.parseFloat(h))<=0)return this.parent.getErrorStrings()[e.CommonErrors.Num];isNaN(n)||(d++,l*=n)}}return d>0&&(l=Math.pow(l,1/d)),l.toString()},n.prototype.ComputeRSQ=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=0,i=t;if(2!==i.length)return this.parent.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];if(""===i[0]||""===i[1])return this.parent.getErrorStrings()[e.CommonErrors.Value];if(i[0].includes('"')||i[1].includes('"'))return this.parent.getErrorStrings()[e.CommonErrors.NA];if(-1===i[0].indexOf(":")&&O(i[0])&&-1===i[1].indexOf(":")&&O(i[1]))return this.parent.getErrorStrings()[e.CommonErrors.DivZero];var a=this.parent.getCellCollection(i[0]),o=this.parent.getCellCollection(i[1]);if(a.length!==o.length)return this.parent.getErrorStrings()[e.CommonErrors.NA];for(var s=this.getDataCollection(o),l=0;l<s.length;l++)if(this.parent.getErrorStrings().indexOf(s[l])>-1)return s[l];for(var d=this.getDataCollection(a),h=0;h<d.length;h++)if(this.parent.getErrorStrings().indexOf(d[h])>-1)return d[h];for(var p,c,u=0;u<s.length;u++)p=Number(s[u]),c=Number(d[u]),fe(p)&&fe(c)&&n++;if(n<=1)return this.parent.getErrorStrings()[e.CommonErrors.DivZero];if(2===n)return 1;var f=this.getMeanArray(s,d),g=f[0],m=f[1],v=this.getCorrelation(s,d,g,m);return Math.pow(v,2)},n.prototype.getCorrelation=function(e,t,r,n){for(var i,a,o=0,s=0,l=0,d=0;d<e.length;d++)fe(e[d])&&fe(t[d])&&(o+=(a=Number(e[d])-r)*(i=Number(t[d])-n),s+=Math.pow(a,2),l+=Math.pow(i,2));return o/Math.sqrt(s*l)},n.prototype.getMeanArray=function(e,t){for(var r=0,n=0,i=0,a=0,o=0,s=0;s<e.length;s++)fe(e[s])&&fe(t[s])&&(n+=Number(e[s]),i+=Number(t[s]),r++);return a=n/r,o=i/r,[a,o]},n.prototype.getDataCollection=function(e){for(var t=[],r=0,n=e.length;r<n;r++)t.push(this.parent.getValueFromArg(e[r]));return t},n.prototype.parseDouble=function(e){var t=this.parent.parseFloat(e.toString());return isNaN(t)?NaN:t},n.prototype.spreadsheetDisplayText=function(e){if(this.parent.parentObject&&this.parent.parentObject.element&&this.parent.parentObject.element.classList.contains("e-spreadsheet")&&this.parent.isCellReference(e)){var t=this.parent.parentObject.getIndexes(e);e=this.parent.parentObject.getDisplayText(this.parent.parentObject.getActiveSheet().rows[t.startIdx].cells[t.endIdx])}return e},n.prototype.spreadsheetFormat=function(e){if(this.parent.parentObject&&this.parent.parentObject.element&&this.parent.parentObject.element.classList.contains("e-spreadsheet")&&this.parent.isCellReference(e)){var t=this.parent.parentObject.getIndexes(e);e=this.parent.parentObject.getActiveSheet().rows[t.startIdx].cells[t.endIdx].format}return e},n}(),qi=function(){function r(e){this.emptyStr="",this.storedStringText=this.emptyStr,this.sheetToken="!",this.tokenAdd="a",this.tokenSubtract="s",this.tokenMultiply="m",this.tokenDivide="d",this.tokenLess="l",this.charEm="r",this.charEp="x",this.tokenGreater="g",this.tokenEqual="e",this.tokenLessEq="k",this.tokenGreaterEq="j",this.tokenNotEqual="o",this.tokenAnd="c",this.tokenEm="v",this.tokenEp="t",this.tokenOr=String.fromCharCode(126),this.charAnd="i",this.charLess="<",this.charGreater=">",this.charEqual="=",this.charLessEq="f",this.charGreaterEq="h",this.charNoEqual="z",this.stringGreaterEq=">=",this.stringLessEq="<=",this.stringNoEqual="<>",this.stringAnd="&",this.stringOr="^",this.charOr="w",this.charAdd="+",this.charSubtract="-",this.charMultiply="*",this.charDivide="/",this.fixedReference="$",this.spaceString=" ",this.ignoreBracet=!1,this.isError=!1,this.isFormulaParsed=!1,this.findNamedRange=!1,this.stringsColl=new Map,this.tokens=[this.tokenAdd,this.tokenSubtract,this.tokenMultiply,this.tokenDivide,this.tokenLess,this.tokenGreater,this.tokenEqual,this.tokenLessEq,this.tokenGreaterEq,this.tokenNotEqual,this.tokenAnd,this.tokenOr],this.charNOTop=String.fromCharCode(167),this.specialSym=["~","@","#","?"],this.isFailureTriggered=!1,this.parent=e}return r.prototype.parse=function(r,n){var i=this;if(this.parent.isTextEmpty(r))return r;if(Ye(r))return this.parent.getErrorStrings()[e.CommonErrors.Ref];this.parent.getFormulaCharacter()!==String.fromCharCode(0)&&this.parent.getFormulaCharacter()===r[0]&&(r=r.substring(1)),(this.parent.namedRanges.size>0||this.parent.storedData.size>0)&&(r=this.checkForNamedRangeAndKeyValue(r),this.findNamedRange=!1),r=(r=r.replace(/[-+*/&^]+/g,function(t){for(var r="";1<t.length;)switch(t.substring(0,2)){case"++":case"--":t="+"+t.substring(2);break;case"+-":case"-+":t="-"+t.substring(2);break;case"*+":t="*"+t.substring(2);break;case"/+":t="/"+t.substring(2);break;case"^+":t="^"+t.substring(2);break;case"&+":t="&"+t.substring(2);break;case"*-":case"/-":case"^-":case"&-":r=t.substring(0,1),t=t.substring(1);break;default:throw new Xi(i.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidExpression],!0)}return r+t})).split("-(-").join("(");var a=this.storeStrings(r);r=this.storedStringText;var o=0;if(t.isNullOrUndefined(a)&&(r=r.split(" ").join("")),r=r.split("=>").join(">="),(r=r.split("=<").join("<="))[r.length-1]===this.parent.arithMarker&&this.indexOfAny(r,this.tokens)===r.length-2||(r=r.toUpperCase()),r.indexOf(this.sheetToken)>-1){var s=this.parent.getSheetFamilyItem(this.parent.grid);if(null!=s.sheetNameToParentObject&&s.sheetNameToParentObject.size>0){r[0]!==this.sheetToken.toString()&&(r=this.parent.setTokensForSheets(r));var l=this.parent.getSheetToken(r.split(this.parent.tic).join(this.emptyStr)),d=this.checkScopedRange(r.split('"').join(this.emptyStr).split(this.sheetToken).join(""));t.isNullOrUndefined(l)&&""!==l&&this.parent.namedRanges.size>0&&""!==d&&(r=d)}}r=this.markLibraryFormulas(r);try{r=this.formulaAutoCorrection(r)}catch(t){if(!(c={message:t.message,exception:t,isForceCalculable:t.formulaCorrection,computeForceCalculate:!1}).isForceCalculable)throw this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidExpression];if(this.isFailureTriggered||(this.parent.trigger("onFailure",c),this.isFailureTriggered=!0),!c.isForceCalculable||!c.computeForceCalculate)throw this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidExpression];r=this.formulaAutoCorrection(r,c),this.parent.storedData.get(n).formulaText="="+r}if(!this.ignoreBracet)for(o=r.indexOf(")");o>-1;){var h=r.substring(0,o).lastIndexOf("(");if(-1===h)throw new Xi(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.MismatchedParentheses]);if(h===o-1)throw new Xi(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.EmptyExpression]);var p=this.emptyStr;p=this.ignoreBracet?this.parent.substring(r,h,o-h+1):this.parent.substring(r,h+1,o-h-1);try{r=r.substring(0,h)+this.parseSimple(p)+r.substring(o+1)}catch(t){if(t===this.parent.formulaErrorStrings[e.FormulasErrorsStrings.CircularReference])throw t;var c=this.exceptionArgs(t);this.isFailureTriggered||(this.parent.trigger("onFailure",c),this.isFailureTriggered=!0);var u="string"==typeof c.exception?c.exception:c.message;return(this.parent.getErrorLine(t)?"":"#"+this.parent.getErrorLine(t)+": ")+u}o=r.indexOf(")")}if(!this.ignoreBracet&&r.indexOf("(")>-1)throw new Xi(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.MismatchedParentheses]);return r=this.parseSimple(r),null!==a&&a.size>0&&(r=this.setStrings(r,a)),r},r.prototype.exceptionArgs=function(e){return{message:e.message,exception:e,isForceCalculable:e.formulaCorrection,computeForceCalculate:!1}},r.prototype.formulaAutoCorrection=function(r,n){var i=["*","+","-","/","^","&"],a=[">","=","<"],o=0,s="",l="",d="",h="",p="",c="",u="",f=0;if(this.parent.formulaErrorStrings.indexOf(r)>-1)return r;if(this.indexOfAny(r,this.specialSym)>-1)throw new Xi(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.InvalidExpression],!1);for(;o<r.length;)if(r=r.split("-*").join("-").split("/*").join("/").split("*/").join("*").split("-/").join("-").split("*+").join("*").split("+*").join("+"),this.parent.isDigit(r[o])&&r.length>o+1&&this.indexOfAny(r[o+1],i)>-1&&r.length>o+2&&!t.isNullOrUndefined(r[o+2])&&this.indexOfAny(r[o+2],i)>-1&&("-"!==r[o+2]||"*"!==r[o+1]&&"/"!==r[o+1]&&"^"!==r[o+1]&&"&"!==r[o+1])){if(!n||!n.computeForceCalculate)throw this.parent.formulaErrorStrings[e.FormulasErrorsStrings.ImproperFormula];this.parent.isDigit(r[o])?(f<1?(c=r[o],d=r[o+1],t.isNullOrUndefined(d)&&(d=this.emptyStr),f+=1,s=s+c+(d="&"===d?"":d)):f<2&&(u=r[o],h=r[o-1],p=r[o+1],f=0,s="-"===h?s+h+u+(p="&"===(p=t.isNullOrUndefined(p)?this.emptyStr:p)?"":p):s+u+(p=t.isNullOrUndefined(p)?this.emptyStr:p)),o+=2):(s="-"===r[o]?s+r[o]:s,o+=1)}else if((this.parent.isDigit(r[o])||r[o]===this.parent.rightBracket||this.parent.storedData.has(r[o].toUpperCase()))&&(t.isNullOrUndefined(r[o+1])||this.indexOfAny(r[o+1],i)>-1))l="&"===(l=t.isNullOrUndefined(r[o+1])?this.emptyStr:r[o+1])&&"-"!==r[o+2]?"":l,s="-"===r[o-1]?s+r[o-1]+r[o]+l:s+r[o]+l,o+=2;else if(this.indexOfAny(r[o],a)>-1&&!t.isNullOrUndefined(r[o-1])&&!t.isNullOrUndefined(r[o+1]))s+=r[o],o+=1;else if("q"===r[o])for(;r[o]!==this.parent.leftBracket;)s+=r[o],o+=1;else r[o]===this.parent.leftBracket||r[o]===this.parent.rightBracket||"{"===r[o]||"}"===r[o]||"("===r[o]||")"===r[o]?(s+=r[o],o+=1):this.parent.isUpperChar(r[o])||r[o].indexOf(":")>-1||r[o]===this.parent.getParseArgumentSeparator()||"%"===r[o]&&this.parent.isDigit(r[o-1])?(s+=r[o],o+=1):r[o]===this.parent.tic||" "===r[o]||r[o]===this.parent.getParseDecimalSeparator()||r[o]===this.sheetToken||"$"===r[o]||"_"===r[o]?(s+=r[o],o+=1):(this.parent.isDigit(r[o])&&(s="-"===r[o-1]?s+r[o-1]+r[o]:s+r[o]),"-"!==r[o]&&"+"!==r[o]||(s=(s+=r[o]).split("++").join("+").split("+-").join("-").split("-+").join("-")),"/"!==r[o]&&"*"!==r[o]&&"^"!==r[o]||(s+=r[o]),o+=1);return s=s===this.emptyStr?r:s,this.indexOfAny(s[s.length-1],i)>-1&&(s=s.substring(0,s.length-1)),s=s.split("--").join("-").split("-+").join("-").split("+-").join("-")},r.prototype.checkScopedRange=function(e){var r=this,n=this.emptyStr,i="NaN",a=this.parent.getSheetID(this.parent.grid),o=this.parent.getSheetFamilyItem(this.parent.grid);if(e[0]===this.sheetToken.toString()){var s=e.indexOf(this.sheetToken,1),l=parseInt(e.substr(1,s-1),10);s>1&&!this.parent.isNaN(l)&&(e=e.substring(s+1),a=l)}var d="!"+a.toString();return null===o||null==o.sheetNameToToken?i:(o.sheetNameToToken.forEach(function(a,s){if(o.sheetNameToToken.get(s).toString()===d+"!"){var l=r.emptyStr;r.parent.namedRanges.forEach(function(a,s){l=t.isNullOrUndefined(r.parent.parentObject)?o.sheetNameToToken.get(s).toUpperCase():r.parent.parentObject.getActiveSheet().name+r.sheetToken+e.toUpperCase(),r.parent.getNamedRanges().has(l)&&(n=r.parent.getNamedRanges().get(l).toUpperCase(),i=n)})}}),i)},r.prototype.storeStrings=function(t){var r,n=0,i=0,a=0,o="",s=null;if(t.indexOf(this.parent.tic)>-1)for(n=t.indexOf(this.parent.tic);n>-1&&t.length>0;){if(null===s&&(s=this.stringsColl),-1===(i=n+1<t.length?t.indexOf(this.parent.tic,n+1):-1))throw new Xi(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.MismatchedTics]);r=this.parent.substring(t,n,i-n+1),o=this.parent.tic+this.spaceString+a.toString()+this.parent.tic,s=s.set(o,r),t=t.substring(0,n)+o+t.substring(i+1),(n+=o.length)<=t.length&&(n=t.indexOf(this.parent.tic,n)),a++}return this.storedStringText=t,s},r.prototype.setStrings=function(e,t){for(var r=0;r<t.size;r++)t.forEach(function(t,r){e=e.split(r).join(t)});return e},r.prototype.parseSimple=function(e){var t=e;if(t.length>0&&"+"===t[0]&&(t=t.substring(1)),"#DIV/0!"===t)return"#DIV/0!";if("#NAME?"===t)return"#NAME?";if(""===t)return t;if(this.parent.formulaErrorStrings.indexOf(t)>-1)return t;t=(t=(t=(t=(t=(t=t.split(this.stringLessEq).join(this.charLessEq)).split(this.stringGreaterEq).join(this.charGreaterEq)).split(this.stringNoEqual).join(this.charNoEqual)).split(this.stringAnd).join(this.charAnd)).split(this.stringOr).join(this.charOr)).split(this.fixedReference).join(this.emptyStr);var r=[this.tokenEp,this.tokenEm],n=[this.tokenMultiply,this.tokenDivide],i=[this.tokenAdd,this.tokenSubtract],a=[this.charMultiply,this.charDivide],o=[this.charAdd,this.charSubtract],s=[this.tokenLess,this.tokenGreater,this.tokenEqual,this.tokenLessEq,this.tokenGreaterEq,this.tokenNotEqual],l=[this.charLess,this.charGreater,this.charEqual,this.charLessEq,this.charGreaterEq,this.charNoEqual],d=[this.charEp,this.charEm],h=[this.tokenAnd],p=[this.charAnd],c=[this.charOr],u=[this.tokenOr];return t=this.parseSimpleOperators(t,r,d),t=this.parseSimpleOperators(t,u,c),t=this.parseSimpleOperators(t,n,a),t=this.parseSimpleOperators(t,i,o),t=this.parseSimpleOperators(t,s,l),t=this.parseSimpleOperators(t,h,p)},r.prototype.parseSimpleOperators=function(r,n,i){if(this.parent.getErrorStrings().indexOf(r)>-1)return r;for(var a=r,o=0,s="",l=0;l<i.length;l++)s+=i[l];(a=(a=(a=a.split("---").join("-").split("--").join("+").split(this.parent.getParseArgumentSeparator()+"-").join(this.parent.getParseArgumentSeparator()+"u").split(this.parent.leftBracket+"-").join(this.parent.leftBracket+"u").split("=-").join("=u")).split(",+").join(",").split(this.parent.leftBracket+"+").join(this.parent.leftBracket).split("=+").join("=").split(">+").join(">").split("<+").join("<").split("/+").join("/").split("*+").join("*").split("++").join("+").split("*-").join("*u").split("/-").join("/u").split("w-").join("wu").split("i-").join("iu").toString()).split(">-").join(">u").split("<-").join("<u").split("h-").join("hu").split("f-").join("fu").split("z-").join("zu")).length>0&&"-"===a[0]?(a="0-"+(a=a.substring(1).split("-").join(this.tokenOr)),a=(a=this.parseSimpleOperators(a,[this.tokenSubtract],[this.charSubtract])).split(this.tokenOr).join("-")):a.length>0&&"+"===a[0]?a=a.substring(1):a.length>0&&"+"===a[a.length-1]&&(a=a.substring(0,a.length-1));try{if(this.indexOfAny(a,i)>-1){if(a.includes(" ")){for(var d="",h=0;h<a.length;h++){var p=a[h];if(i.indexOf(p)>=0)d=d.trim()+p;else{if(" "===p&&i.indexOf(d[d.length-1])>=0)continue;d+=p}}a=d}o=this.indexOfAny(a,i);for(var c=this.parent.getParseDecimalSeparator();o>-1;){var u="",f="",g=0,m=0,v=!1,y=["*","+","-","/","w","=","<",">"],C=0;if(a[o]===this.charNOTop)g=o;else if(C=o-1,a[C]===this.parent.arithMarker){if((x=this.findLeftMarker(a.substring(0,C-1)))<0)throw new Xi(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.CannotParse]);u=this.parent.substring(a,x+1,C-x-1),g=x+1}else if(a[C]===this.parent.rightBracket){for(var b=0,x=C-1;x>0&&("q"!==a[x]||0!==b);)"q"===a[x]?b--:a[x]===this.parent.rightBracket&&b++,x--;if(x<0)throw new Xi(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.CannotParse]);u=this.parent.substring(a,x,C-x+1),g=x}else if(a[C]===this.parent.tic[0]){var S=a.substring(0,C-1).lastIndexOf(this.parent.tic);if(S<0)throw new Xi(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.CannotParse]);u=this.parent.substring(a,S,C-S+1),g=S}else{for(I=!1;C>-1&&(this.parent.isDigit(a[C])||!I&&(a[C]===c||"%"===a[C]));)this.parent.isDigit(a[C])||"%"===a[C]||(I=!0),C-=1;if(C>-1&&I&&a[C]===c)throw new Xi(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.NumberContains2DecimalPoints]);if(0===(C+=1)||C>0&&!this.parent.isUpperChar(a[C-1]))u="n"+this.parent.substring(a,C,o-C),g=C;else if(C>0&&"E"===a[C-1]&&("TRUE"===a.substring(C-4,C)&&(t.isNullOrUndefined(a[C-5])||y.indexOf(a[C-5])>-1)||"FALSE"===a.substring(C-5,C)&&(t.isNullOrUndefined(a[C-6])||y.indexOf(a[C-6])>-1))&&("TRUE"===a.substring(C+1,C+5)||"FALSE"===a.substring(C+1,C+6)))C="TRUE"===a.substring(C-4,C)?C-4:C-5,u="TRUE"===a.substring(C,o)?"n1":"FALSE"===a.substring(C,o)?"n0":u,g=C,v=!0;else{for(C-=1;C>-1&&(this.parent.isUpperChar(a[C])||this.parent.isDigit(a[C])||"_"===a[C]);)C-=1;if(C>-1&&a[C]===this.sheetToken){for(C-=1;C>-1&&a[C]!==this.sheetToken;)C-=1;C>-1&&a[C]===this.sheetToken&&(C-=1)}if(C>-1&&":"===a[C]){for(C-=1;C>-1&&this.parent.isDigit(a[C]);)C-=1;for(;C>-1&&this.parent.isUpperChar(a[C]);)C-=1;if(C>-1&&a[C]===this.sheetToken){for(C--;C>-1&&a[C]!==this.sheetToken;)C--;C>-1&&a[C]===this.sheetToken&&C--}C+=1,u=this.parent.substring(a,C,o-C),u=this.parent.getCellFrom(u)}else{var w=!1;C>0&&!this.parent.isUpperChar(a[C])&&(w="u"===a[C]&&a[C-1]===this.parent.getParseArgumentSeparator()),w||(C+=1),u=this.parent.substring(a,C,o-C)}this.parent.updateDependentCell(u),g=C}(this.parent.namedRanges.size>0&&this.parent.namedRanges.has(u.toUpperCase())||this.parent.storedData.has(u.toUpperCase()))&&(u="n"+this.checkForNamedRangeAndKeyValue(u))}if(o===a.length-1)throw new Xi(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.ExpressionCannotEndWithAnOperator]);if((w="u"===a[C=o+1])&&(C+=1),a[C]===this.parent.tic[0]){if((x=a.substring(C+1).indexOf(this.parent.tic))<0)throw this.parent.formulaErrorStrings[e.FormulasErrorsStrings.CannotParse];f=this.parent.substring(a,C,x+2),m=x+C+2}else if(a[C]===this.parent.arithMarker){if((x=this.findRightMarker(a.substring(C+1)))<0)throw new Xi(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.CannotParse]);f=this.parent.substring(a,C+1,x),m=x+C+2}else if("q"===a[C]){for(var b=0,x=C+1;x<a.length&&(a[x]!==this.parent.rightBracket||0!==b);)a[x]===this.parent.rightBracket?b++:"q"===a[x]&&b--,x++;if(x===a.length)throw this.parent.formulaErrorStrings[e.FormulasErrorsStrings.CannotParse];f=this.parent.substring(a,C,x-C+1),w&&(f="u"+f),m=x+1}else if(this.parent.isDigit(a[C])||a[C]===c){var I=a[C]===c;for(C+=1;C<a.length&&(this.parent.isDigit(a[C])||!I&&a[C]===c);)a[C]===c&&(I=!0),C+=1;if(C<a.length&&"%"===a[C]&&(C+=1),I&&C<a.length&&a[C]===c)throw this.parent.formulaErrorStrings[e.FormulasErrorsStrings.NumberContains2DecimalPoints];f="n"+this.parent.substring(a,o+1,C-o-1),m=C}else if(this.parent.isUpperChar(a[C])||a[C]===this.sheetToken||"u"===a[C]){if(a[C]===this.sheetToken)for(C+=1;C<a.length&&a[C]!==this.sheetToken;)C+=1;C+=1;for(var E=0,R=!1;C<a.length&&(this.parent.isUpperChar(a[C])||"_"===a[C]||a[C]===c||"["===a[C]||"]"===a[C]||"#"===a[C]||" "===a[C]||"%"===a[C]||a[C]===c&&R);)C!==a.length-1&&"["===a[C]&&"["===a[C+1]&&(R=!0),C!==a.length-1&&"]"===a[C]&&"]"===a[C+1]&&(R=!1),C++,E++;var N=C===a.length||!this.parent.isDigit(a[C]);if(E>1){for(;C<a.length&&(this.parent.isUpperChar(a[C])||this.parent.isDigit(a[C])||" "===a[C]||"_"===a[C]);)C++;N=!0}for(;C<a.length&&this.parent.isDigit(a[C]);)C+=1;if(C<a.length&&":"===a[C]){if((C+=1)<a.length&&a[C]===this.sheetToken){for(C++;C<a.length&&a[C]!==this.sheetToken;)C+=1;C<a.length&&a[C]===this.sheetToken&&C++}for(;C<a.length&&this.parent.isUpperChar(a[C]);)C+=1;for(;C<a.length&&this.parent.isDigit(a[C]);)C+=1;C-=1,f=this.parent.substring(a,o+1,C-o),f=this.parent.getCellFrom(f)}else C-=1,f=this.parent.substring(a,o+1,C-o),(w="u"===a[C])&&(f="u"+f);N&&f.startsWith(this.sheetToken)&&(N=!this.parent.isCellReference(f)),N||this.parent.updateDependentCell(f),(this.parent.namedRanges.size>0&&this.parent.namedRanges.has(f.toUpperCase())||this.parent.storedData.has(f.toUpperCase()))&&(f="n"+this.checkForNamedRangeAndKeyValue(f));var F=["*","+","-","/","w"].indexOf(a[C-f.length])>-1;f="TRUE"===f&&(v||F)?"n1":"FALSE"===f&&(v||F)?"n0":f,m=C+1}var A=s.indexOf(a[o]),k=this.parent.arithMarker+u+f+n[A]+this.parent.arithMarker;g>0&&(k=a.substring(0,g)+k),m<a.length&&(k+=a.substring(m)),a=k=k.split(this.parent.arithMarker2).join(this.parent.arithMarker.toString()),o=this.indexOfAny(a,i)}}else if(a.length>0&&(this.parent.isUpperChar(a[0])||a[0]===this.sheetToken)){for(var O=!0,T=!0,D=!1,L=a.length,x=0;x<L;++x)if(a[x]===this.sheetToken){if(x>0&&!D)throw this.parent.getErrorStrings()[e.CommonErrors.Ref];for(D=!0,x++;x<L&&this.parent.isDigit(a[x]);)x++;if(x===L||a[x]!==this.sheetToken){O=!1;break}}else{if(!T&&this.parent.isChar(a[x])){O=!1;break}if(!this.parent.isChar(a[x])&&!this.parent.isDigit(a[x])&&a[x]!==this.sheetToken){O=!1;break}T=this.parent.isUpperChar(a[x])}O&&this.parent.updateDependentCell(a)}return a}catch(t){if(t===this.parent.formulaErrorStrings[e.FormulasErrorsStrings.CircularReference])throw t;return t}},r.prototype.indexOfAny=function(e,t){for(var r=0;r<e.length;r++)if(t.indexOf(e[r])>-1)return r;return-1},r.prototype.findLeftMarker=function(e){var t=-1;if(e.indexOf(this.parent.arithMarker)>-1)for(var r=0,n=e.length-1;n>=0;--n)if(e[n]===this.parent.rightBracket)r--;else if(e[n]===this.parent.leftBracket)r++;else if(e[n]===this.parent.arithMarker&&0===r){t=n;break}return t},r.prototype.findRightMarker=function(e){var t=-1;if(e.indexOf(this.parent.arithMarker)>-1)for(var r=0,n=0;n<e.length;++n)if(e[n]===this.parent.rightBracket)r--;else if(e[n]===this.parent.leftBracket)r++;else if(e[n]===this.parent.arithMarker&&0===r){t=n;break}return t},r.prototype.parseFormula=function(r,n){if(r.length>0&&r[0]===this.parent.getFormulaCharacter()&&(r=r.substring(1)),r.indexOf("#REF!")>-1)return this.parent.getErrorStrings()[e.CommonErrors.Ref];r.length>0&&"+"===r[0]&&(r=r.substring(1));try{this.isFailureTriggered=!1,this.isError=!1,r=this.parse(r.trim(),n),this.isFormulaParsed=!0}catch(e){var i=this.exceptionArgs(e);this.isFailureTriggered||(this.parent.trigger("onFailure",i),this.isFailureTriggered=!0);var a="string"==typeof i.exception?i.exception:i.message;r=(t.isNullOrUndefined(this.parent.getErrorLine(e))?"":"#"+this.parent.getErrorLine(e)+": ")+a,this.isError=!0}return r},r.prototype.markLibraryFormulas=function(r){var n=0,i=r.indexOf(")");if(-1===i)r=this.markNamedRanges(r);else for(;i>-1;){for(var a=0,o=i-1;o>-1&&("("!==r[o]||0!==a);)")"===r[o]&&a++,o--;if(-1===o)throw new Xi(this.parent.formulaErrorStrings[e.FormulasErrorsStrings.MismatchedParentheses]);for(var s=o-1;s>-1&&this.parent.isChar(r[s]);)s--;var l=o-s-1,d=this.parent.substring(r,s+1,l);if(l>0&&!t.isNullOrUndefined(this.parent.getFunction(d))){var h=this.parent.substring(r,o,i-o+1),p=this.parent.getParseArgumentSeparator();if("AREAS"===d)this.ignoreBracet=!0;else if(this.ignoreBracet=!1,d.includes("IFS")&&"COUNTIFS"!==d&&h.includes("{")){var c=h.indexOf("{"),u=this.parent.substring(h,c,h.indexOf("}")-c+1);h=h.split(u).join(u.split(p).join(this.parent.tic+this.parent.tic))}try{var f=void 0;h=h.split("(").join("").split(")").join(""),h="("+this.formulaAutoCorrection(h,f)+")"}catch(t){if(!(f={message:t.message,exception:t,isForceCalculable:t.formulaCorrection,computeForceCalculate:!1}).isForceCalculable)throw this.parent.formulaErrorStrings[e.FormulasErrorsStrings.ImproperFormula];if(this.isFailureTriggered||(this.parent.trigger("onFailure",f),this.isFailureTriggered=!0,n+=1),f.computeForceCalculate=n>0||f.computeForceCalculate,!f.isForceCalculable)throw this.parent.formulaErrorStrings[e.FormulasErrorsStrings.ImproperFormula];if(!f.computeForceCalculate)throw this.parent.formulaErrorStrings[e.FormulasErrorsStrings.ImproperFormula];h=h.split("(").join("").split(")").join(""),h="("+this.formulaAutoCorrection(h,f)+")"}h=this.markNamedRanges(h),h=this.swapInnerParens(h),-1===(h=this.addParensToArgs(h)).lastIndexOf(p)&&h.length>2&&"("===h[0]&&")"===h[h.length-1]&&"{"!==h[1]&&"("!==h[1]&&(h=(h=h.substring(0,h.length-1)+"}"+h.substring(h.length-1))[0]+"{"+h.substring(1)),r=r.substring(0,s+1)+"q"+this.parent.substring(r,s+1,l)+h.split("(").join(this.parent.leftBracket).split(")").join(this.parent.rightBracket)+r.substring(i+1)}else{if(l>0)return this.parent.getErrorStrings()[e.CommonErrors.Name];var g=this.emptyStr;o>0&&(g=r.substring(0,o)),g=g+"{"+this.parent.substring(r,o+1,i-o-1)+"}",i<r.length&&(g+=r.substring(i+1)),r=g=this.markNamedRanges(g)}i=r.indexOf(")")}return r=r.split("{").join("(").split("}").join(")")},r.prototype.swapInnerParens=function(e){return e.length>2&&(e=e[0]+e.substr(1,e.length-2).split("(").join("{").split(")").join("}")+e[e.length-1]),e},r.prototype.addParensToArgs=function(e){if(0===e.length)return this.emptyStr;var t=[];t.push(this.parent.getParseArgumentSeparator()),t.push(this.parent.rightBracket);var r=e.lastIndexOf(this.parent.getParseArgumentSeparator()),n=0;if(-1===r){if(e.length>2&&"("===e[0]&&")"===e[e.length-1])if("{"!==e[1]&&"("!==e[1])e=(e=e.substring(0,e.length-1)+"}"+e.substring(e.length-1))[0]+"{"+e.substring(1);else{var i=["+","-","*","/"];r=this.lastIndexOfAny(e,i),0===n&&")"===e[e.length-1]&&(n=e.length-1),n>0&&"{"!==e[r+1]&&"}"===e[r-1]&&(e=(e=e.substr(0,n)+"}"+e.substr(n)).substr(0,r+1)+"{"+e.substr(r+1))}}else for(var a=!0;r>-1;){var o=this.indexOfAny(e.substring(r+1,e.length),t);o>=0?o=r+o+1:-1===o&&")"===e[e.length-1]&&(o=e.length-1),o>0&&"{"!==e[r+1]&&"}"!==e[o-1]&&""!==e[o-1]&&(e=(e=e.substr(0,o).trim()+"}"+e.substr(o)).substr(0,r+1)+"{"+e.substr(r+1).trim()),r=e.substr(0,r).lastIndexOf(this.parent.getParseArgumentSeparator()),a&&-1===r&&"("===e[0]&&(r=0,a=!1)}return e=e.split("{}").join(this.emptyStr)},r.prototype.lastIndexOfAny=function(e,t){for(var r=e.length-1;r>-1;r--)if(t.indexOf(e[r])>-1)return r;return-1},r.prototype.markNamedRanges=function(e){var r=[")",this.parent.getParseArgumentSeparator(),"}","+","-","*","/","<",">","=","&",":"],n=e.length>0&&("("===e[0]||"{"===e[0])?1:0;e.indexOf("#N/A")>-1&&(e=e.split("#N/A").join("#N~A")),e.indexOf("#DIV/0!")>-1&&(e=e.split("#DIV/0!").join("#DIV~0!"));for(var i=this.indexOfAny(e.substring(n),r);i>-1&&i+n<e.length;){var a=this.emptyStr,o=null;if(this.parent.substring(e,n,i).indexOf("[")>-1?o=this.getTableRange(this.parent.substring(e,n,i)):this.parent.storedData.has(this.parent.substring(e,n,i))?o=this.checkForNamedRangeAndKeyValue(this.parent.substring(e,n,i)):this.parent.namedRanges.has(this.parent.substring(e,n,i))&&(o=this.checkForNamedRangeAndKeyValue(this.parent.substring(e,n,i))),t.isNullOrUndefined(o)&&("NaN"!==(a=this.checkScopedRange(this.parent.substring(e,n,i)))?(this.findNamedRange=!0,o=a):this.parent.substring(e,n,i).startsWith(this.sheetToken.toString()),!t.isNullOrUndefined(o)&&this.findNamedRange&&o.indexOf(this.fixedReference)>-1&&(o=o.split(this.fixedReference).join(this.emptyStr))),t.isNullOrUndefined(o)||(o=o.toUpperCase(),o=this.parent.setTokensForSheets(o),o=this.markLibraryFormulas(o)),t.isNullOrUndefined(o)||o===this.emptyStr)for(n+=i+1;n<e.length&&!this.parent.isUpperChar(e[n])&&e[n]!==this.sheetToken;)n++;else e=e.substring(0,n)+o+e.substring(n+i),n+=o.length+1;for(i=n,n<e.length-1&&"{"===e[n]&&(n+=1),i=this.indexOfAny(e.substring(n),r);0===i&&n<e.length-1;)n++,i=this.indexOfAny(e.substring(n),r);if((-1===i||e.substring(n).indexOf("[")>-1)&&n<e.length){if(o=e.substring(n).indexOf("[")>-1?this.getTableRange(e.substring(n)):this.parent.storedData.has(e.substring(n))?this.parent.storedData.size>0?this.checkForNamedRangeAndKeyValue(e.substring(n)):o:this.parent.namedRanges.size>0?this.checkForNamedRangeAndKeyValue(e.substring(n)):o,t.isNullOrUndefined(o)&&"NaN"!==(a=this.checkScopedRange(e.substring(n)))&&(o=a),!t.isNullOrUndefined(o)&&o!==this.emptyStr&&(o=o.toUpperCase(),o=this.parent.setTokensForSheets(o),null!=(o=this.markLibraryFormulas(o)))){var s=e.substring(n);e=")"===s[s.length-1]?e.substring(0,n)+o+")":e.substring(0,n)+o,n+=o.toString().length+1}i=n<e.length?this.indexOfAny(e.substring(n),r):-1}}return e.indexOf("#N~A")>-1&&(e=e.split("#N~A").join("#N/A")),e.indexOf("#DIV~0!")>-1&&(e=e.split("#DIV~0!").join("#DIV/0!")),e},r.prototype.checkForNamedRangeAndKeyValue=function(e){var r=this.emptyStr;if(e.indexOf("[")>-1){var n=this.getTableRange(e);t.isNullOrUndefined(n)||(this.findNamedRange=!0,e=n)}if("NaN"!==(r=this.checkScopedRange(e)))this.findNamedRange=!0,e=r;else{if(e.indexOf(this.sheetToken)>-1){var i=this.parent.getSheetFamilyItem(this.parent.grid),a=e.split('"').join(this.emptyStr);if(a=a.substr(0,a.indexOf(this.sheetToken)),i.sheetNameToToken.has(a.toUpperCase()))parseInt(i.sheetNameToToken.get(a.toUpperCase()).split(this.sheetToken).join(this.emptyStr))}this.parent.storedData.size>0&&this.parent.storedData.has(e)&&(e="A"+this.parent.colIndex(e)),this.parent.namedRanges.size>0&&this.parent.namedRanges.has(e.toUpperCase())&&(t.isNullOrUndefined(this.parent.parentObject)?(e=this.parse(this.parent.namedRanges.get(e.toUpperCase())),(e=this.parent.setTokensForSheets(e)).indexOf(this.fixedReference)>-1&&e.split(this.fixedReference).join(this.emptyStr),this.findNamedRange=!0):e=this.parse(this.parent.namedRanges.get(e.toUpperCase()))),this.findNamedRange&&"!"!==e[0]&&"q"!==e[0]&&"bq"!==e[0]&&(e=this.parent.setTokensForSheets(e)).indexOf(this.fixedReference)>-1&&(e=e.split(this.fixedReference).join(this.emptyStr))}return e},r.prototype.getTableRange=function(e){var t=(e=e.replace(" ",this.emptyStr).toUpperCase()).replace("]",this.emptyStr).replace("#DATA",this.emptyStr);t.indexOf(this.parent.getParseArgumentSeparator())>-1&&(t.substring(0,t.indexOf(this.parent.getParseArgumentSeparator())).replace("[",this.emptyStr),t=t.replace("[",this.emptyStr).replace(this.parent.getParseArgumentSeparator(),"_"));this.emptyStr;return t.toUpperCase()},r.prototype.findNextEndIndex=function(e,t){for(var r=0,n=t,i=!1;!i&&t<e.length;)"["===e[n]?r++:"]"===e[n]&&0===--r&&(i=!0),t++;return t-=n},r}(),Wi=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Gi=function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},Yi=function(n){function i(e){var r=n.call(this,null,null)||this;return r.lFormulas=new Map,r.storedData=new Map,r.keyToRowsMap=new Map,r.rowsToKeyMap=new Map,r.rightBracket=String.fromCharCode(161),r.leftBracket=String.fromCharCode(162),r.sheetToken="!",r.emptyString="",r.leftBrace="{",r.rightBrace="}",r.cell=r.emptyString,r.cellPrefix="!0!A",r.treatEmptyStringAsZero=!1,r.tic='"',r.singleTic="'",r.trueValue="TRUE",r.falseValue="FALSE",r.parseDecimalSeparator=".",r.arithMarker=String.fromCharCode(180),r.arithMarker2=r.arithMarker+r.arithMarker,r.dependentCells=null,r.dependentFormulaCells=null,r.minValue=Number.MIN_SAFE_INTEGER,r.maxValue=Number.MAX_SAFE_INTEGER,r.categoryCollection=["All"],r.dependencyLevel=0,r.randomValues=new Map,r.isRandomVal=!1,r.randCollection=[],r.dependencyCollection=[],r.uniqueRange=[],r.formulaErrorStrings=["binary operators cannot start an expression","cannot parse","bad library","invalid char in front of","number contains 2 decimal points","expression cannot end with an operator","invalid characters following an operator","invalid character in number","mismatched parentheses","unknown formula name","requires a single argument","requires 3 arguments","invalid Math argument","requires 2 arguments","#NAME?","too complex","#CIRCULARREF!","missing formula","improper formula","invalid expression","cell empty","bad formula","empty expression","","mismatched string quotes","wrong number of arguments","invalid arguments","iterations do not converge","Control is already registered","Calculation overflow","Missing sheet","cannot_parse","expression_cannot_end_with_an_operator","#SPILL!","#DIV/0!"],r.errorStrings=null,r.parseArgumentSeparator=",",r.dateTime1900=new Date(1900,0,1,0,0,0),r.isParseDecimalSeparatorChanged=!1,r.isArgumentSeparatorChanged=!1,r.sheetFamilyID=0,r.defaultFamilyItem=null,r.sheetFamiliesList=null,r.modelToSheetID=null,r.tokenCount=0,r.sortedSheetNames=null,r.tempSheetPlaceHolder=String.fromCharCode(133),r.namedRanges=new Map,r.formulaInfoTable=null,r.millisecondsOfaDay=864e5,r.parseDateTimeSeparator="/",new _i(r),r.parentObject=t.isNullOrUndefined(e)?r:e,r.grid=r.parentObject,r.parser=new qi(r),r}return Wi(i,n),Object.defineProperty(i.prototype,"libraryFormulas",{get:function(){return this.lFormulas},set:function(e){this.lFormulas.set(e.fName,{handler:e.handler,category:e.category,description:e.description})},enumerable:!0,configurable:!0}),i.prototype.getParseArgumentSeparator=function(){return this.isArgumentSeparatorChanged||","===this.parseArgumentSeparator||(this.parseArgumentSeparator=","),this.parseArgumentSeparator},i.prototype.setParseArgumentSeparator=function(e){this.parseArgumentSeparator=e,this.isArgumentSeparatorChanged=!0},i.prototype.getParseDateTimeSeparator=function(){return this.parseDateTimeSeparator},i.prototype.setTreatEmptyStringAsZero=function(e){this.treatEmptyStringAsZero=e},i.prototype.getTreatEmptyStringAsZero=function(){return this.treatEmptyStringAsZero},i.prototype.setParseDateTimeSeparator=function(e){this.parseDateTimeSeparator=e},i.prototype.onPropertyChanged=function(e,t){},i.prototype.getModuleName=function(){return"calculate"},i.prototype.getFormulaCharacter=function(){return"="},i.prototype.isUpperChar=function(e){var t=e.charCodeAt(0);return t>64&&t<91},i.prototype.resetKeys=function(){this.storedData.clear(),this.keyToRowsMap.clear(),this.rowsToKeyMap.clear()},i.prototype.updateDependentCell=function(t){var r=this,n=this.cell;if(n!==this.emptyString){var i=this.getSheetFamilyItem(this.grid);if(i.sheetNameToParentObject&&(n.includes(this.sheetToken)||(n=i.parentObjectToToken.get(this.grid)+n),t.includes(this.sheetToken)||(t=i.parentObjectToToken.get(this.grid)+t)),n!==t){var a=this.getDependentCells();a.has(t)||a.set(t,[]);var o=a.get(t);if(-1===o.indexOf(n)){var s=this.getDependentFormulaCells(),l={},d=function(t){if(s.has(t)){var i=s.get(t);if(i.has(n))throw r.formulaErrorStrings[e.FormulasErrorsStrings.CircularReference];l[t]||(l[t]=!0,i.forEach(function(e){d(e)}))}};d(t),o.push(n),s.has(n)?s.get(n).has(t)||s.get(n).set(t,t):(s.set(n,new Map),s.get(n).set(t,t))}}}},i.prototype.getDependentCells=function(){return null==this.dependentCells&&(this.dependentCells=new Map),this.dependentCells},i.prototype.getDependentFormulaCells=function(){if(this.isSheetMember()){var e=this.getSheetFamilyItem(this.grid);return null==e.sheetDependentFormulaCells&&(e.sheetDependentFormulaCells=new Map),e.sheetDependentFormulaCells}return null==this.dependentFormulaCells&&(this.dependentFormulaCells=new Map),this.dependentFormulaCells},i.prototype.getLibraryFormulas=function(){return this.lFormulas},i.prototype.getFunction=function(e){return this.getLibraryFormulas().has(e.toUpperCase())?this.getLibraryFormulas().get(e.toUpperCase()).handler:null},i.prototype.intToDate=function(e){var t=Number(e);(t=t>0&&t<1?1+t:0===t?1:t)>60&&(t-=1);var r=new Date("01/01/1900"),n=Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds());return new Date(new Date(864e5*(t-1)+n).toUTCString().replace(" GMT",""))},i.prototype.getFormulaInfoTable=function(){if(this.isSheetMember()){var e=this.getSheetFamilyItem(this.grid);return null===e.sheetFormulaInfotable&&(e.sheetFormulaInfotable=new Map),e.sheetFormulaInfotable}return null===this.formulaInfoTable&&(this.formulaInfoTable=new Map),this.formulaInfoTable},i.prototype.getParseDecimalSeparator=function(){return this.isParseDecimalSeparatorChanged||"."===this.parseDecimalSeparator||(this.parseDecimalSeparator="."),this.parseDecimalSeparator},i.prototype.setParseDecimalSeparator=function(e){this.parseDecimalSeparator=e,this.isParseDecimalSeparatorChanged=!0},i.prototype.getSheetToken=function(t){var r=0,n=this.emptyString;if(r<t.length&&t[r]===this.sheetToken){for(r++;r<t.length&&t[r]!==this.sheetToken;)r++;n=t.substring(0,r+1)}if(r<t.length)return n;throw this.formulaErrorStrings[e.FormulasErrorsStrings.BadIndex]},i.prototype.getSheetID=function(e){var t=this.getSheetFamilyItem(e);if(null!=t.sheetNameToParentObject&&t.sheetNameToParentObject.size>0){var r=t.parentObjectToToken.get(e);if(r){r=r.split(this.sheetToken).join(this.emptyString);var n=this.parseFloat(r);if(!this.isNaN(n))return n}}return-1},i.prototype.parseFloat=function(e){var t=Number(e);return isNaN(t)&&"string"==typeof e&&e.includes(",")&&(t=Number(e.split(",").join(""))),t},i.prototype.rowIndex=function(t){var r=0,n=!1;if(r<t.length&&t[r]===this.sheetToken){for(r++;r<t.length&&t[r]!==this.sheetToken;)r++;r++}for(;r<t.length&&this.isChar(t[r]);)n=!0,r++;var i=parseInt(t.substring(r),10);if(r<t.length&&!this.isNaN(i))return i;if(n)return-1;throw this.formulaErrorStrings[e.FormulasErrorsStrings.BadIndex]},i.prototype.colIndex=function(e){var t=0,r=0;if(e=e.toUpperCase(),t<e.length&&e[t]===this.sheetToken){for(t++;t<e.length&&e[t]!==this.sheetToken;)t++;t++}for(;t<e.length&&this.isChar(e[t]);)r=26*r+e[t].charCodeAt(0)-64,t++;return 0===r?-1:r},i.prototype.getErrorStrings=function(){return null===this.errorStrings&&(this.errorStrings=["#N/A","#VALUE!","#REF!","#DIV/0!","#NUM!","#NAME?","#NULL!","#CALC!"]),this.errorStrings},i.prototype.substring=function(e,t,r){return e.substring(t,r+t)},i.prototype.isChar=function(e){return e.charCodeAt(0)>=65&&e.charCodeAt(0)<=90||e.charCodeAt(0)>=97&&e.charCodeAt(0)<=122},i.prototype.getSheetFamilyItem=function(e,t){return 0===this.sheetFamilyID?(null==this.defaultFamilyItem&&(this.defaultFamilyItem=new $i),this.defaultFamilyItem):(null==this.sheetFamiliesList&&(this.sheetFamiliesList=new Map),void 0===t&&(t=this.modelToSheetID.get(e)),this.sheetFamiliesList.has(t)||this.sheetFamiliesList.set(t,new $i),this.sheetFamiliesList.get(t))},i.prototype.setKeyValue=function(e,t){e=e.toUpperCase();var r=t.toString().trim();this.storedData.get(e)&&0!==r.indexOf(this.leftBrace)||(this.storedData.set(e,new Ki),this.keyToRowsMap.set(e,this.keyToRowsMap.size+1),this.rowsToKeyMap.set(this.rowsToKeyMap.size+1,e));var n=this.storedData.get(e);if(null!=n.getFormulaText()&&n.getFormulaText().length>0&&n.getFormulaText()!==r){var i=this.cellPrefix+this.keyToRowsMap.get(e).toString();null!=this.getDependentFormulaCells().get(i)&&this.clearFormulaDependentCells(i)}r.length>0&&r[0]===this.getFormulaCharacter()?n.setFormulaText(r):n.getFormulaValue()!==r&&(n.setFormulaText(""),n.setParsedFormula(""),n.setFormulaValue(r))},i.prototype.clearFormulaDependentCells=function(e){var t=this,r=this.getDependentFormulaCells().get(e);r&&(r.forEach(function(r,n){var i=n,a=t.getDependentCells().get(i);t.arrayRemove(a,e),0===a.length&&t.getDependentCells().delete(i)}),this.getDependentFormulaCells().delete(e))},i.prototype.arrayRemove=function(e,t){var r=e.indexOf(t);return-1!==r&&e.splice(r,1),e},i.prototype.getKeyValue=function(e){if(e=e.toUpperCase(),null!==this.storedData.has(e)){var r=this.storedData.get(e),n=r.getFormulaText();if(n.length>0&&n[0]===this.getFormulaCharacter()){this.cell=this.cellPrefix+this.keyToRowsMap.get(e).toString(),n=n.substring(1);try{r.setParsedFormula(this.parser.parseFormula(n,e))}catch(t){i={message:t.message,exception:t,isForceCalculable:!1,computeForceCalculate:!1};return this.trigger("onFailure",i),r.setFormulaValue(i.message),this.storedData.get(e).getFormulaValue()}try{r.setFormulaValue(this.computeFormula(r.getParsedFormula()))}catch(e){var i={message:e.message,exception:e,isForceCalculable:!1,computeForceCalculate:!1};this.trigger("onFailure",i);var a="string"==typeof i.exception?i.exception:i.message;return(t.isNullOrUndefined(this.getErrorLine(e))?"":"#"+this.getErrorLine(e)+": ")+a}}return this.storedData.get(e).getFormulaValue()}return this.emptyString},i.prototype.getNamedRanges=function(){return this.namedRanges},i.prototype.addNamedRange=function(e,t){var r=e.split(this.sheetToken);if(r.length>1){var n=this.getSheetId(this.grid).toString();if(!this.getSheetFamilyItem(n).parentObjectToToken.get(n))return!1;e=r[0]+this.sheetToken+r[1].toUpperCase()}else e=e.toUpperCase();return this.namedRanges.set(e,t),!0},i.prototype.updateNamedRange=function(e,t){var r=new Map;this.namedRanges.forEach(function(n,i){var a=i;if(i.includes(e)){var o=i.split("!");o[0]=t,a=o.join("!")}r.set(a,n)}),this.namedRanges=r},i.prototype.removeNamedRange=function(e){return e=e.toUpperCase(),null!=this.namedRanges.get(e)&&(this.namedRanges.delete(e),!0)},i.prototype.convertAlpha=function(e){for(var t=[],r=0;e>0;){e--;var n="A".charCodeAt(0);t[r]=String.fromCharCode(e%26+n),e=parseInt((e/26).toString(),10),r++}for(var i=[],a=0;a<r;a++)i[r-a-1]=t[a];return i.join("")},i.prototype.getCellCollection=function(e){if(e.indexOf(":")<0){if(!this.isCellReference(e))return e.split(this.getParseArgumentSeparator());e=e+":"+e}var t=this.emptyString,r=e.indexOf(this.sheetToken);if(r>-1)for(var n=r+1;n<e.length;){if(e[n]===this.sheetToken){t=e.substr(0,n+1);break}n++}var i,a,o,s,l=e.indexOf(":");if(l>0&&this.isChar(e[l-1]))for(var d=l-2;d>=0&&this.isDigit(e[d]);)d--;i=this.rowIndex(this.substring(e,0,l)),a=this.rowIndex(this.substring(e,l+1,l+e.length-l-1)),o=this.colIndex(this.substring(e,0,l)),s=this.colIndex(this.substring(e,l+1,l+e.length-l-1)),i>a&&(l=a,a=i,i=l),o>s&&(l=s,s=o,o=l);var h,p=[],c=0;for(l=i;l<=a;l++)for(h=o;h<=s;h++)p[c]=t+this.emptyString+this.convertAlpha(h)+l.toString(),c++;return p},i.prototype.computeFormula=function(e,t){return this.calculateFormula(e,!1,t)},i.prototype.calculateFormula=function(r,n,i){var a,o,s,l,d=this,h=!1;if(this.parser.isError)return r;a=this.parser.isFormulaParsed?r:this.parser.parseFormula(r),this.parser.isFormulaParsed=!1;try{if((o=this.findLastIndexOfq(a))>0&&(h=!0),a!==this.emptyString&&o>-1)for(var p=o+1,c=this;p>-1&&"break"!==function(){if(a[p]!==c.rightBracket)return p++,"continue";var r=a.substring(o,p+1),u=r.split(c.leftBracket)[0].split("q").join(c.emptyString),f=void 0;if(c.getLibraryFormulas().get(u.toUpperCase()).isCustom){f=r.substring(r.indexOf(c.leftBracket)+1,r.indexOf(c.rightBracket)).split(c.getParseArgumentSeparator());var g=0,m=[],v=void 0;for(g=0;g<f.length;g++)f[g].includes(":")&&c.isCellReference(f[g])&&(v=c.getCellCollection(f[g])).length>1?(m.push(f[g]),v.forEach(function(e){d.updateDependentCell(e)})):m.push(c.getValueFromArg(f[g]));f=m}else{var y=r.substring(r.indexOf(c.leftBracket)+1,r.indexOf(c.rightBracket));f=[];for(var C=c.getParseArgumentSeparator(),b="",x=void 0,S=0,w=y.length-1;S<=w;S++)'"'===y[S]&&(x=!x),y[S]!==C||x?(b+=y[S],S===w&&f.push(b)):(f.push(b),b="",S===w&&f.push(b));f.length||(f=[""]),h&&u&&(["IF","INDEX","SORT","T","EXACT","PROPER","DOLLAR","DATE","TEXT"].some(function(e){return e===u})&&f.push("nestedFormulaTrue"),"IF"===u&&f.push("nestedFormulaTrue")),i&&"UNIQUE"===u&&f.push("isComputeExp")}if(s=t.isNullOrUndefined(c.getFunction(u))?c.getErrorStrings()[e.CommonErrors.Name]:c.getFunction(u).apply(void 0,f),h){l=c.processNestedFormula(a,r,s);var I=c.findLastIndexOfq(l);return 0===I&&(h=!1),-1===I&&(s=c.computeValue(l,n)),o=p=I,a=l,"continue"}return"break"}(););else this.formulaErrorStrings.indexOf(a)>-1?s=a:a!==this.emptyString&&-1===o&&(s=this.computeValue(a,n))}catch(e){var u={message:e.message,exception:e,isForceCalculable:!1,computeForceCalculate:!1};this.trigger("onFailure",u);var f="string"==typeof u.exception?u.exception:u.message;s=(t.isNullOrUndefined(this.getErrorLine(e))?"":"#"+this.getErrorLine(e)+": ")+f}return s},i.prototype.computeSumIfAndAvgIf=function(r,n){if(t.isNullOrUndefined(r)||r[0]===this.emptyString||0===r.length)return this.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];for(var i=r,a=0;a<i.length;a++)if(this.isCellReference(i[a])&&t.isNullOrUndefined(i[a].match(/[0-9]/))&&i[a].indexOf("!")<0){var o=i[a].split(":");i[a]=o[0]+"1:"+o[1]+this.spreadSheetUsedRange[0]}var s=i.length;if(2!==s&&3!==s&&0===s)return this.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];if(""===i[1])return n?this.getErrorStrings()[e.CommonErrors.DivZero]:"0";var l=i[0],d=i[1].startsWith(this.tic)&&i[1].endsWith(this.tic),h=i[1].split(this.tic).join(this.emptyString);if(h.length>255)return this.getErrorStrings()[e.CommonErrors.Value];var p=h.includes("*"),c=h.includes("?"),u=p?h.replace(/\*/g,"").trim():h,f=!1;if(!d&&this.isCellReference(u)&&(u=this.getValueFromArg(u),f=!0),p){var g=h.indexOf("*");"*"===h[0]&&(u="*"+u),"*"===h[h.length-1]&&(u+="*"),g>0&&g<h.length-1&&(u=h.substring(0,g)+"*"+h.substring(g+1))}h=u;var m=this.parser.tokenEqual;h.startsWith("<=")?(m=this.parser.tokenLessEq,h=h.substring(2)):h.startsWith(">=")?(m=this.parser.tokenGreaterEq,h=h.substring(2)):h.startsWith("<>")?(m=this.parser.tokenNotEqual,h=h.substring(2)):h.startsWith("<")?(m=this.parser.tokenLess,h=h.substring(1)):h.startsWith(">")?(m=this.parser.tokenGreater,h=h.substring(1)):h.startsWith("=")&&(m=this.parser.tokenEqual,h=h.substring(1)),(!d&&this.isCellReference(h)&&!f||h.includes(this.arithMarker)||h.includes(this.getParseDecimalSeparator())&&!p&&!c)&&(h=this.getValueFromArg(h));var v=this.parseFloat(h),y=i[0],C=this.getCellCollection(s>2?i[2]:l),b=this.getCellCollection(y);if(b.length>C.length){var x=this.colIndex(C[C.length-1])+this.colIndex(b[b.length-1])-this.colIndex(b[0]),S=i[2].split(":");S[1]=(this.convertAlpha(x)+this.rowIndex(b[b.length-1])).toString(),C=this.getCellCollection(S.join(":"))}var w=this.getComputeSumIfValue(b,C,h.toLowerCase(),v,m,p,c);return[w[0],w[1]]},i.prototype.computeLookup=function(r){var n,i,a,o,s,l,d=[],h=[],p=[],u=[],f=[],g=r,m=g.length;if(1===m||m>3)return this.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];if(""===g[1]||""===g[2])return this.getErrorStrings()[e.CommonErrors.Value];if(s=this.getValueFromArg(g[0]),g[0].indexOf(this.tic)>-1&&g[0].toUpperCase().split(this.tic).join("")!==this.trueValue&&g[0].toUpperCase().split(this.tic).join("")!==this.falseValue&&this.isNaN(this.parseFloat(g[0].split(this.tic).join("")))&&(s=s.split(this.tic).join("")),this.getErrorStrings().indexOf(s)>-1)return s;var v=g[1].split(":");if(2===v.length&&this.isCellReference(v[0])&&this.isCellReference(v[1])&&2===m){var y=g[1].indexOf(":"),C=this.rowIndex(this.substring(g[1],0,y)),b=this.colIndex(this.substring(g[1],0,y)),x=this.rowIndex(this.substring(g[1],y+1,y+g[1].length-y-1)),S=this.colIndex(this.substring(g[1],y+1,y+g[1].length-y-1));C>x&&(C=(n=[x,C])[0],x=n[1]),b>S&&(b=(i=[S,b])[0],S=i[1]);var w="";0===g[1].indexOf("!")&&(w=(w=(w=g[1]).replace("!","")).indexOf("!"),w=g[1].substring(0,w+2));var I=S-b+1,E=x-C+1;E>I||E===I?(a=w+Xe(b)+C+":"+Xe(b)+x,o=w+Xe(S)+C+":"+Xe(S)+x):E<I&&(a=w+Xe(b)+C+":"+Xe(S)+C,o=w+Xe(b)+x+":"+Xe(S)+x),C===x&&b===S||(l=!0)}if(l)d=this.getCellCollection(a),h=this.getCellCollection(o);else{d=this.getCellCollection(g[1]);var R=2===m?g[1]:g[2];h=this.getCellCollection(R);var N=c(g[1]),F=c(R),A=N[1]===N[3]||N[0]===N[2],k=F[1]===F[3]||F[0]===F[2];if(!A||!k)return this.getErrorStrings()[e.CommonErrors.NA]}for(var O=0;O<d.length;O++)u.push(this.getValueFromArg(d[O]).split(this.tic).join(""));var T=u.map(function(e){return""===e?NaN:Number(e)}).sort(function(e,t){return e-t}),D=T[T.length-1],L=T[0],P=this.parseFloat(s);if(this.isNaN(P)){for(var M=0;M<d.length;M++)if(p[M]=this.getValueFromArg(d[M]).split(this.tic).join(""),!t.isNullOrUndefined(h[M])&&""!==s&&""!==p[M])if(s.toUpperCase()===p[M].toUpperCase())f.push(this.getValueFromArg(h[M]).split(this.tic).join("")||"0");else if(s.indexOf("*")>-1||s.indexOf("?")>-1){var B=s;if(s.indexOf("*")>-1){B=B.replace(/\*/g,"").trim(),this.isCellReference(B)&&(B=this.getValueFromArg(B));var H=s.indexOf("*");"*"===s[0]&&(B="*"+B),"*"===s[s.length-1]&&(B+="*"),H>0&&H<s.length-1&&(B=s.substring(0,H)+"*"+s.substring(H+1))}var U=[],V=this.findWildCardValue(B.toLowerCase(),p[M].toLowerCase());U.push(V),U.push(s),this.processLogical(U,"equal")===this.trueValue&&f.push(this.getValueFromArg(h[M]).split(this.tic).join("")||"0")}}else for(var z=0;z<T.length;z++)p[z]=T[z].toString().split(this.tic).join(""),t.isNullOrUndefined(h[z])||""===p[z]||P!==this.parseFloat(p[z])||f.push(this.getValueFromArg(h[z]).split(this.tic).join("")||"0");if(f.length>0)return f[f.length-1];if(P>D&&!t.isNullOrUndefined(h[d.length-1]))return this.getValueFromArg(h[d.length-1]).split(this.tic).join("")||"0";if(P<L)return this.getErrorStrings()[e.CommonErrors.NA];if(u.indexOf(s.split(this.tic).join(""))<0&&s!==this.trueValue&&s!==this.falseValue)if(this.isNaN(P)||this.isNaN(D)||this.isNaN(L)){if(this.isNaN(P)&&""!==s&&/^[a-zA-Z!@#$%^&*()_+{}[\]:;<>,.?~\\/-]/.test(s)){var j=u.sort(),y=this.findClosestMatch(s.split(this.tic).join(""),j);if(!t.isNullOrUndefined(h[y])&&y>=0)return this.getValueFromArg(h[y]).split(this.tic).join("")||"0"}}else{for(var _=[],q=0;q<T.length;q++)P>T[q]&&_.push(T[q]);y=_.length-1;if(!t.isNullOrUndefined(h[y])&&y>=0)return this.getValueFromArg(h[y]).split(this.tic).join("")||"0"}return this.getErrorStrings()[e.CommonErrors.NA]},i.prototype.computeVHLookup=function(n,i){var a,o,s=this,l=n;if(t.isNullOrUndefined(l)||l.length<3||l.length>4)return this.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];if(""===l[1])return this.getErrorStrings()[e.CommonErrors.NA];var d=this.getValueFromArg(l[0]);if(d){if(d.includes(this.tic)){var h=d.split(this.tic).join("");if(h&&!this.isNumber(h)){var p=h.toUpperCase();p!==this.trueValue&&p!==this.falseValue&&(d=h)}}}else d="0";var c=this.getErrorStrings();if(c.indexOf(d)>-1)return d;var u=(this.getValueFromArg(l[2])||"0").split(this.tic).join("").toUpperCase(),f=this.parseFloat(u===this.trueValue?"1":u);if(f<1)return c[e.CommonErrors.Value];var g;if(l[3]){if(l[3]=this.getValueFromArg(l[3]).split(this.tic).join(""),c.indexOf(l[3])>-1)return l[3];var m=l[3].toUpperCase();if(m===this.falseValue||"0"===l[3])g=!0;else if(m!==this.trueValue&&"1"!==l[3])return c[e.CommonErrors.Value]}var v,y,C,b,x,S,w=l[1].split(":");if(!this.isCellReference(w[0])||!this.isCellReference(w[1]))return c[e.CommonErrors.Value];var I=this.rowIndex(w[0]),E=this.colIndex(w[0]),R=this.rowIndex(w[1]),N=this.colIndex(w[1]);if(I>R&&(I=(a=[R,I])[0],R=a[1]),E>N&&(E=(o=[N,E])[0],N=o[1]),!(I>0&&R<=1048576&&E>0&&N<=16384))return this.getErrorStrings()[e.CommonErrors.Name];b=this.grid;var F="",A=this.getSheetFamilyItem(b);l[1].startsWith("!")?(F=l[1].substring(0,l[1].replace("!","").indexOf("!")+2),null!==A.tokenToParentObject&&(this.grid=A.tokenToParentObject.get(F))):null!==A.parentObjectToToken&&(F=A.parentObjectToToken.get(b));var k=this.getSheetId(this.grid),O={action:"getSheetInfo",sheetInfo:[]};if(this.parentObject.notify(Kr,O),-1===Ee(this.parentObject,"Sheet"+k,O.sheetInfo))return this.grid=b,c[e.CommonErrors.Ref];var T=this.getCellValueFn(b,this.cell,k,!0);if(i){var D=E+f-1;if(D>N)return c[e.CommonErrors.Ref];v=I,y=R;var L=F+Xe(E);x=function(e){return T(e,E,L+e)};var P=F+Xe(D);S=function(){return T(C,D,P+C)||"0"}}else{var M=I+f-1;if(M>R)return c[e.CommonErrors.Ref];v=E,y=N;var B;x=function(e){return B=F+Xe(e),T(I,e,B+I)},S=function(){return T(M,C,B+M)||"0"}}var H,U,V=[];if(g){var z=void 0;if(this.isNumber(d)){var j=this.parseFloat(d);z=function(){return j===s.parseFloat(U)}}else if(d.includes("*")||d.includes("?")){var _=d,q=d.indexOf("*");q>-1&&(_=_.replace(/\*/g,"").trim(),this.isCellReference(_)&&(_=this.getValueFromArg(_)),0===q?_="*"+_:q===d.length-1?_+="*":_=d.substring(0,q)+"*"+d.substring(q+1)),_=_.toLowerCase(),z=function(){return s.processLogical([s.findWildCardValue(_,U.toLowerCase()),d],"equal")===s.trueValue}}else{var W=d.toUpperCase();z=function(){return W===U.toUpperCase()}}for(C=v;C<=y;C++)(U=x(C))&&z()&&V.push(S());H=V.length?V[0]:c[e.CommonErrors.NA]}else if(d.indexOf("*")>-1||d.indexOf("?")>-1)H=c[e.CommonErrors.NA];else{var G,Y=void 0;if(this.isNumber(d)){var X=this.parseFloat(d),K=r.DataUtil.fnSort("");Y=function(){G=K(s.isNumber(U)?s.parseFloat(U):U||null,X)}}else{var $=new Intl.Collator(this.parentObject.locale||"en-US",{sensitivity:"base"});Y=function(){G=!U||s.isNumber(U)?null:$.compare(U,d)}}var Z=void 0;for(C=v;C<=y;C++)U=x(C),Z||(Y(),0===G?V.push(S()):G<0?V.push(S()):G>0&&V.length&&(Z=!0));H=V.length?V[V.length-1]:c[e.CommonErrors.NA]}return this.grid=b,H},i.prototype.findClosestMatch=function(e,t){for(var r=0,n=t.length-1;r<=n;){var i=Math.floor((r+n)/2),a=t[i],o=this.compareStrings(e.toLowerCase(),a.toLowerCase());if(0===o)return i;1===o?r=i+1:n=i-1}for(var s=r-1;s>=0;s--)if(-1!==this.compareStrings(e.toLowerCase(),t[s].toLowerCase()))return s;return-1},i.prototype.compareStrings=function(e,t){for(var r=Math.min(e.length,t.length),n=0;n<r;n++){var i=e.charCodeAt(n),a=t.charCodeAt(n);if(i<a)return-1;if(i>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0},i.prototype.findWildCardValue=function(e,t){var r="";if(e.indexOf("?")>-1){var n=RegExp(e.replace(/\?/g,"[\\s\\S]"));r=t.length===e.length&&this.isNaN(this.parseFloat(t))&&t.match(n)?e:t}else if(e.indexOf("*")>-1){for(var i=e.indexOf("*"),a="",o="",s=this.falseValue,l=this.falseValue,d=i-1;d>=0;d--)a+=e[d],l=this.trueValue;for(d=i+1;d<e.length;d++)o+=e[d],s=this.trueValue;var h=""===a?-1:t.indexOf(a.split("").reverse().join("")),p=""===o?-1:t.indexOf(o);if(h>-1||p>-1){var c=a.split("").reverse().join("")===t.substr(0,a.length),u=o===t.substring(t.length-o.length,t.length);l===this.trueValue&&s===this.trueValue&&this.isNaN(this.parseFloat(a))&&this.isNaN(this.parseFloat(o))?r=c&&u?e:t:l===this.trueValue&&this.isNaN(this.parseFloat(a))?r=c?e:t:s===this.trueValue&&this.isNaN(this.parseFloat(o))&&(r=u?e:t)}else r=t}return r},i.prototype.getComputeSumIfValue=function(e,t,r,n,i,a,o){var s=0,l=0;switch(i){case this.parser.tokenEqual:for(var d=a?r.replace(/\*/g,""):r,h=0;h<e.length;h++){var p=this.getValueFromRange(t,h),c=this.getValueFromArg(e[h].split(this.tic).join("")).toLowerCase(),u=this.parseFloat(c);if(c===r&&u===n){var f=this.getValueFromArg(t[h].split(this.tic).join("")),g=this.parseFloat(f);this.isNaN(g)||(s+=g,l+=1)}else if(c===r)this.isNaN(p)||(s+=p,l+=1);else if(a&&d&&c&&this.isNaN(this.parseFloat(c))){m=r.indexOf("*");"*"===r[0]&&d.length<=c.length&&d===c.slice(c.length-d.length,c.length)?this.isNaN(p)||(s+=p,l+=1):"*"===r[r.length-1]&&d.length<=c.length&&d===c.slice(0,d.length)?this.isNaN(p)||(s+=p,l+=1):m>-1&&c.startsWith(r.substr(0,m))&&c.endsWith(r.substr(m+1))&&(this.isNaN(p)||(s+=p,l+=1))}else if(a&&!d&&c&&this.isNaN(this.parseFloat(c)))this.isNaN(p)||(s+=p,l+=1);else if(o&&d&&c&&this.isNaN(this.parseFloat(c))){v=RegExp(d.replace(/\?/g,"[\\s\\S]"));c.length===r.length&&c.match(v)&&(this.isNaN(p)||(s+=p,l+=1))}}break;case this.parser.tokenLess:for(h=0;h<e.length;h++){c=this.getValueFromArg(e[h].split(this.tic).join(""));if((u=this.parseFloat(c))<n){var f=this.getValueFromArg(t[h].split(this.tic).join("")),g=this.parseFloat(f);this.isNaN(g)||(s+=g,l+=1)}}break;case this.parser.tokenGreater:for(h=0;h<e.length;h++){c=this.getValueFromArg(e[h].split(this.tic).join(""));if((u=this.parseFloat(c))>n){var f=this.getValueFromArg(t[h].split(this.tic).join("")),g=this.parseFloat(f);this.isNaN(g)||(s+=g,l+=1)}}break;case this.parser.tokenLessEq:for(h=0;h<e.length;h++){c=this.getValueFromArg(e[h].split(this.tic).join(""));if((u=this.parseFloat(c))<=n){var f=this.getValueFromArg(t[h].split(this.tic).join("")),g=this.parseFloat(f);this.isNaN(g)||(s+=g,l+=1)}}break;case this.parser.tokenGreaterEq:for(h=0;h<e.length;h++){c=this.getValueFromArg(e[h].split(this.tic).join(""));if((u=this.parseFloat(c))>=n){var f=this.getValueFromArg(t[h].split(this.tic).join("")),g=this.parseFloat(f);this.isNaN(g)||(s+=g,l+=1)}}break;case this.parser.tokenNotEqual:for(var d=a?r.replace(/\*/g,""):r,h=0;h<e.length;h++){var p=this.getValueFromRange(t,h),c=this.getValueFromArg(e[h].split(this.tic).join("")).toLowerCase(),u=this.parseFloat(c);if(c===r||u===n||a||o)if(a&&d&&c&&this.isNaN(this.parseFloat(c))){var m=r.indexOf("*");"*"===r[0]&&d.length<=c.length&&d!==c.slice(c.length-d.length,c.length)?this.isNaN(p)||(s+=p,l+=1):"*"===r[r.length-1]&&d.length<=c.length&&d!==c.slice(0,d.length)?this.isNaN(p)||(s+=p,l+=1):(m>-1&&!c.startsWith(r.substr(0,m))||!c.endsWith(r.substr(m+1)))&&(this.isNaN(p)||(s+=p,l+=1))}else if(!a||d||this.isNaN(this.parseFloat(c))){if(o&&d&&c&&this.isNaN(this.parseFloat(c))){var v=RegExp(d.replace(/\?/g,"[\\s\\S]"));c.length===r.length&&c.match(v)||this.isNaN(p)||(s+=p,l+=1)}}else this.isNaN(p)||(s+=p,l+=1);else{var f=this.getValueFromArg(t[h].split(this.tic).join("")),g=this.parseFloat(f);this.isNaN(g)||(s+=g,l+=1)}}}return[s,l]},i.prototype.getValueFromRange=function(e,t){var r=e[t];return r=this.getValueFromArg(r),this.parseFloat(r.toString())},i.prototype.computeAndOrNot=function(t,r){for(var n,i,a=this,o="and"===r,s="or"===r,l="not"===r,d=!(!o&&!l),h=[],p=t,c=0;c<p.length;c++){if(p[c]===this.tic)return this.getErrorStrings()[e.CommonErrors.Value];if(this.isCellReference(p[c]))for(var u=this.getCellCollection(p[c]),f=0;f<u.length;f++){if(this.getErrorStrings().indexOf(u[f])>-1)return u[f];if(u[f][0]===this.tic)return this.getErrorStrings()[e.CommonErrors.Name];if(n=this.getValueFromArg(u[f]),this.getErrorStrings().indexOf(n)>-1)return n;i=this.parseFloat(n),n===this.falseValue||""!==n&&0===i||l&&""===n?h.push(this.falseValue):n===this.trueValue||!isNaN(i)&&""!==n?h.push(this.trueValue):(""===n||isNaN(i))&&h.push(this.getErrorStrings()[e.CommonErrors.Value])}else{if(n=this.getValueFromArg(p[c]).split(this.tic).join("").toUpperCase(),this.getErrorStrings().indexOf(n)>-1)return n;i=this.parseFloat(n),n===this.falseValue||""===p[c]||""!==n&&0===i?h.push(this.falseValue):n===this.trueValue||!isNaN(i)&&""!==n?h.push(this.trueValue):(""===n||isNaN(i))&&h.push(this.getErrorStrings()[e.CommonErrors.Value])}}if(h.every(function(t){return t===a.getErrorStrings()[e.CommonErrors.Value]}))return this.getErrorStrings()[e.CommonErrors.Value];for(f=0;f<h.length;f++){if((o||l)&&h[f]===this.falseValue){d=!1;break}if(s&&h[f]===this.trueValue){d=!0;break}}return d=l?!d:d,d?this.trueValue:this.falseValue},i.prototype.removeTics=function(e){return e.length>1&&e[0]===this.tic[0]&&e[e.length-1]===this.tic[0]&&(e=this.substring(e,1,e.length-2)),e},i.prototype.getCellFrom=function(e){var t,r="",n=e.indexOf(":")>-1?e.split(":"):[e],i=n.length-1,a=this.rowIndex(n[0]);if(a===this.rowIndex(n[i])){var o=this.colIndex(n[0]),s=this.colIndex(n[i]),l=this.colIndex(this.cell);l>=o&&l<=s&&(r=Xe(l).toString()+a.toString())}else if(this.colIndex(n[0])===this.colIndex(n[i])){t=this.colIndex(n[0]);var d=this.rowIndex(n[i]),h=this.rowIndex(this.cell);h>=a&&h<=d&&(r=Xe(t).toString()+h.toString())}return r},i.prototype.computeValue=function(t,r,n){try{var i=[],a=0,o="";i.length=0;for(var s=this.getParseDecimalSeparator();a<t.length;){var l="u"===t[a];if(l&&(a+=1),t[a]!==this.arithMarker){if(this.isDigit(t[a])){for(d=this.emptyString;a<t.length&&(this.isDigit(t[a])||t[a]===s);)d+=t[a]===s?".":t[a],a+=1;if(i.push(d),!t[a])return i.toString()}if(t[a]===this.sheetToken){for(o=t[a],a+=1;a<t.length&&t[a]!==this.sheetToken;)o+=t[a],a+=1;a<t.length&&(o+=t[a],a+=1)}else if(this.isUpperChar(t[a])){for(var d=this.emptyString,h="";a<t.length&&this.isUpperChar(t[a]);)d+=t[a],a+=1;for(;a<t.length&&this.isDigit(t[a]);)d+=t[a],a+=1;if(a<t.length&&":"===t[a]){if(d+=t[a],(a+=1)<t.length&&t[a]===this.sheetToken)for(d+=t[a],a+=1;a<t.length&&t[a]!==this.sheetToken;)d+=t[a],a+=1;for(;a<t.length&&this.isUpperChar(t[a]);)d+=t[a],a+=1;for(;a<t.length&&this.isDigit(t[a]);)d+=t[a],a+=1;d=o+this.getCellFrom(d)}else d=o+d;if(h=this.getParentObjectCellValue(d,r).toString(),o="","string"==typeof h&&this.getErrorStrings().indexOf(h)>-1)return h;l&&(h=this.isNaN(this.parseFloat(h))?"-"+h:(-this.parseFloat(h)).toString()),i.push(h)}else if("q"===t[a]){var p=t.substring(a+1).indexOf(this.leftBracket),c=t.substring(a+p+1).indexOf(this.rightBracket);t=this.substring(t,a+p+2,c-1)}else if(t[a]===this.tic[0]){d=t[a].toString();for(a+=1;a<t.length&&t[a]!==this.tic[0];)d+=t[a],a+=1;(h=d.split(this.tic).join(this.emptyString))===this.trueValue||h===this.falseValue||!this.isNaN(this.parseFloat(h))&&""!==h?i.push(this.tic+h+this.tic):i.push(h),a+=1}else if("%"===t[a]&&i.length>0){var u=i[0],f=this.parseFloat(u);this.isNaN(f)||(i.pop(),i.push((f/100).toString())),a+=1}else if(0===t.substring(a).indexOf(this.trueValue))i.push(this.trueValue),a+=this.trueValue.length;else if(0===t.substring(a).indexOf(this.falseValue))i.push(this.falseValue),a+=this.falseValue.length;else if(t[a]===this.tic[0]||"|"===t[a]){d=t[a].toString();for(a++;a<t.length&&t[a]!==this.tic[0];)d+=t[a],a+=1;i.push(d+this.tic),a+=1}else{if(" "===t[a]&&a<t.length-1){a+=1;continue}switch(t[a]){case"#":var g=0;this.getErrorStrings().indexOf(t.substring(a))>-1?(g=-1===t.indexOf("!")||-1===t.substring(a).indexOf("!")?t.indexOf("#N/A")>-1?t.indexOf("#N/A")+4+a:t.indexOf("?")+1+a:t.indexOf("!")+1+a,i.push(this.substring(t,a,g-a))):(g=a+1,i.push(this.substring(t,a,g-a))),a=g;break;case"n":d="";if("n"===t[a+=1])continue;if(0===t.substring(a).indexOf("Infinity"))a+=(d="Infinity").length;else{for(("u"===t[a]||l||"-"===t[a])&&(d="-",l?l=!1:a+=1);a<t.length&&(this.isDigit(t[a])||t[a]===s||"."===t[a]);)d+=t[a]===s?".":t[a],a+=1;if(a<t.length&&"%"===t[a])if(a+=1,""===d){if(i.length>0){var u=i[0],f=this.parseFloat(u);this.isNaN(f)||(i.pop(),i.push((f/100).toString()))}}else d=(this.parseFloat(d)/100).toString()}d&&i.push(d);break;case this.parser.tokenAdd:this.getValArithmetic(i,"add",n),a+=1;break;case this.parser.tokenSubtract:this.getValArithmetic(i,"sub",n),a+=1;break;case this.parser.tokenMultiply:this.getValArithmetic(i,"mul",n),a+=1;break;case this.parser.tokenDivide:this.getValArithmetic(i,"div",n),a+=1;break;case this.parser.tokenLess:this.processLogical(i,"less"),a+=1;break;case this.parser.tokenGreater:this.processLogical(i,"greater"),a+=1;break;case this.parser.tokenGreaterEq:this.processLogical(i,"greaterEq"),a+=1;break;case this.parser.tokenLessEq:this.processLogical(i,"lessEq"),a+=1;break;case this.parser.tokenNotEqual:this.processLogical(i,"notEq"),a+=1;break;case this.parser.tokenOr:this.processLogical(i,"or"),a+=1;break;case this.parser.tokenAnd:this.processLogical(i,"and"),a+=1;break;case this.parser.tokenEqual:this.processLogical(i,"equal"),a+=1;break;default:return this.getErrorStrings()[e.CommonErrors.Value]}}}else a+=1}if(0===i.length)return this.emptyString;for(var d=this.emptyString,m=i.length;m>0;){var v=i.pop();if(this.getErrorStrings().indexOf(v)>-1)return v;if((d=v+d)===this.emptyString&&this.isCellReference(t)&&this.getTreatEmptyStringAsZero())return"0";m--}return d}catch(t){if(this.getErrorStrings().indexOf(t)>-1||this.formulaErrorStrings.indexOf(t)>-1)throw t;throw new Xi(this.formulaErrorStrings[e.FormulasErrorsStrings.InvalidExpression])}},i.prototype.getValArithmetic=function(t,r,n){var i=!1,a=t.pop(),o=-1!==a.indexOf(".")?a.split(".")[1].length:0,s=Math.pow(10,o),l=t.pop(),d=-1!==l.indexOf(".")?l.split(".")[1].length:0,h=Math.pow(10,d),p=s>=h?s:h,c=s*h;a=(a=a===this.trueValue?"1":a===this.falseValue?"0":a)===this.emptyString?"0":this.getErrorStrings().indexOf(a.toString())<0?this.parseFloat(a+"").toString():a;var u=Number(a);isNaN(u)&&!n&&(i=!0,a===this.getErrorStrings()[e.CommonErrors.DivZero]?t.push(this.getErrorStrings()[e.CommonErrors.DivZero]):t.push(this.getErrorStrings()[e.CommonErrors.Value])),l=(l=l===this.trueValue?"1":l===this.falseValue?"0":l)===this.emptyString?"0":this.getErrorStrings().indexOf(l.toString())<0?this.parseFloat(l+"").toString():l,u=Number(l),isNaN(u)&&!n&&(i=!0,l===this.getErrorStrings()[e.CommonErrors.DivZero]?t.push(this.getErrorStrings()[e.CommonErrors.DivZero]):t.push(this.getErrorStrings()[e.CommonErrors.Value])),"add"!==r||i||t.push(((Number(l)*p+Number(a)*p)/p).toString()),"sub"!==r||i||t.push(((Number(l)*p-Number(a)*p)/p).toString()),"mul"!==r||i||t.push((Number(l)*h*(Number(a)*s)/c).toString()),"div"!==r||i||(this.isNaN(this.parseFloat(a))||this.isNaN(this.parseFloat(l))?t.push(this.getErrorStrings()[e.CommonErrors.Value]):0===this.parseFloat(a)?t.push(this.getErrorStrings()[e.CommonErrors.DivZero]):t.push((Number(l)*c/(Number(a)*c)).toString()))},i.prototype.processLogical=function(r,n){var i,a,o,s,l,d,h=!1;return"and"!==n&&"equal"!==n&&(i=r.pop(),a=r.pop(),this.getErrorStrings().indexOf(i)>-1?(d=i,h=!0):this.getErrorStrings().indexOf(a)>-1&&(d=a,h=!0),this.isNaN(this.parseFloat(i))&&this.isNaN(this.parseFloat(a))&&(i=i.toString().toLowerCase(),a=a.toString().toLowerCase()),t.isNullOrUndefined(i)||(o=i.indexOf(this.tic)>-1?i:this.parseFloat(i)),t.isNullOrUndefined(a)||(s=a.indexOf(this.tic)>-1?a:this.parseFloat(a)),"*"===i&&this.isNaN(this.parseFloat(a))&&""!==a&&(l=!0)),"less"!==n||h||(d=this.isNaN(o)||this.isNaN(s)?a.toUpperCase().split(this.tic).join("").localeCompare(i.toUpperCase().split(this.tic).join(""))<0?this.trueValue:this.falseValue:s<o?this.trueValue:this.falseValue),"greater"!==n||h||(d=this.isNaN(o)||this.isNaN(s)?a.toUpperCase().split(this.tic).join("").localeCompare(i.toUpperCase().split(this.tic).join(""))>0?this.trueValue:this.falseValue:s>o?this.trueValue:this.falseValue),"lessEq"!==n||h||(d=this.isNaN(o)||this.isNaN(s)?a.toUpperCase().split(this.tic).join("").localeCompare(i.toUpperCase().split(this.tic).join(""))<=0?this.trueValue:this.falseValue:s<=o?this.trueValue:this.falseValue),"greaterEq"!==n||h||(d=this.isNaN(o)||this.isNaN(s)?a.toUpperCase().split(this.tic).join("").localeCompare(i.toUpperCase().split(this.tic).join(""))>=0?this.trueValue:this.falseValue:s>=o?this.trueValue:this.falseValue),"notEq"!==n||h||(d=a!==i?this.trueValue:this.falseValue,l&&(d=this.falseValue)),"and"!==n||h||(i=r.pop().toString(),a="",r.length>0&&(a=r.pop().toString()),d=this.getErrorStrings().indexOf(i)>-1?i:this.getErrorStrings().indexOf(a)>-1?a:(d=this.emptyString+a+i+this.emptyString).split(this.tic).join("")),"equal"!==n||h||(i=r.pop(),a=r.pop(),this.getErrorStrings().indexOf(i)>-1?d=i:this.getErrorStrings().indexOf(a)>-1?d=a:(this.isNaN(this.parseFloat(i))&&this.isNaN(this.parseFloat(a))&&(i=i.toString().toLowerCase(),a=a.toString().toLowerCase()),"*"===i&&this.isNaN(this.parseFloat(a))&&""!==a&&(l=!0),d=i===a||l?this.trueValue:this.falseValue)),"or"!==n||h||(d=Math.pow(this.parseFloat(s),this.parseFloat(o)).toString(),d=this.isNaN(this.parseFloat(d))?this.getErrorStrings()[e.CommonErrors.Value]:d),r.push(d),d},i.prototype.computeStoreCells=function(e){for(var t,r=e.cellValue,n=e.cellRange,i=e.criteria,a=e.argArray,o=e.isCriteria,s=e.storedCells,l=e.isCountIfS===this.trueValue,d=e.countVal||0,h=o===this.trueValue?s:r,p=[],f=0;f<h.length;f++){var m=[],v=this.getValueFromArg(r[f]),y=a[l?1+2*d:2+d],C=y.startsWith(this.tic)&&y.endsWith(this.tic),b=(t=y.trim().split(this.tic).join(this.emptyString)).includes("*"),x="*"===t||"<>*"===t,S=b&&!x?t.replace(/\*/g,"").trim():t,w=!1;if(!C&&this.isCellReference(S)&&(S=this.getValueFromArg(S),w=!0),b&&!x){var I=t.indexOf("*");"*"===t[0]&&(S="*"+S),"*"===t[t.length-1]&&(S+="*"),I>0&&I<t.length-1&&(S=t.substring(0,I)+"*"+t.substring(I+1))}t=S;var E="";if((o=l?this.trueValue:o)===this.trueValue){var R="",N=0,F=0,A=void 0,k=void 0,O=void 0,T=void 0;s[f]=l&&!d?r[f]:s[f],R=s[f],d&&(k=c((A=n[d-1]).indexOf("!")>-1?A.substring(A.lastIndexOf("!")+1):A),O=u(R.indexOf("!")>-1?R.substring(R.lastIndexOf("!")+1):R),T=c(n[d].indexOf("!")>-1?n[d].substring(n[d].lastIndexOf("!")+1):n[d]));var D=R.indexOf("!")>-1,L=void 0,P="",M="";for(D&&(M=R.substring(0,R.lastIndexOf("!")+1),R=R.substring(R.lastIndexOf("!")+1));!this.isDigit(R[N]);)N+=1;if(this.isCellReference(n[d])&&n[d].indexOf(":")>-1)for(E=l&&!d?h[f].indexOf("!")>-1?h[f].substring(h[f].lastIndexOf("!")+1):h[f]:g(T[0]+(O[0]-k[0]),T[1]+(O[1]-k[1])),(L=n[d].indexOf("!")>-1)&&(P=n[d].substring(0,n[d].lastIndexOf("!")+1));!this.isDigit(E[F]);)F+=1;var B=this.substring(R,N),H=this.substring(E,F),U=this.substring(R,N,R.length-N),V=this.substring(E,F,E.length-N);D&&(B=M+B,H=M+H),U!==V&&(s[f]=this.substring(s[f],D?M.length+N:N)+V),E=s[f].split(B).join(H),L?(E.indexOf("!")>-1&&(E=E.substring(E.lastIndexOf("!")+1)),E=P+E):E=E.substring(E.lastIndexOf("!")+1),v=this.getValueFromArg(E),t=l?t:i[d-1].split(this.tic).join(this.emptyString)}var z="equal";t.startsWith("<=")?(z="lessEq",t=t.substring(2)):t.startsWith(">=")?(z="greaterEq",t=t.substring(2)):t.startsWith("<>")?(z="notEq",t=t.substring(2)):t.startsWith("<")?(z="less",t=t.substring(1)):t.startsWith(">")?(z="greater",t=t.substring(1)):t.startsWith("=")&&(z="equal",t=t.substring(1)),(!C&&this.isCellReference(t)&&(!w||""!==E&&!l)||t.includes(this.arithMarker))&&(t=this.getValueFromArg(t)),(t.indexOf("*")>-1||t.indexOf("?")>-1)&&(v=this.findWildCardValue(t.toLowerCase(),v.toLowerCase())),m.push(v.toLowerCase()),m.push(t.toLowerCase()),this.processLogical(m,z)===this.trueValue&&(o===this.falseValue?p.push(r[f]):p.push(E))}return s=p,p=[],s},i.prototype.computeIfsFormulas=function(r,n,i){if(n===this.trueValue&&(t.isNullOrUndefined(r)||""===r[0]||r.length<2||r.length>127||r.length%2!=0))return this.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];for(var a=r,o=[],s=[],l=[],d=0,h=0;h<a.length;h++)a[h].indexOf(":")>-1&&this.isCellReference(a[h])?o.push(a[h].trim()):s.push(a[h].trim());for(var p=[],h=0;h<o.length;h++)p.push(this.getCellCollection(o[h]).length);for(w=0;w<p.length;w++)if(p[w]&&p[w+1]&&p[w]!==p[w+1])return this.getErrorStrings()[e.CommonErrors.Value];for(var f=0;f<s.length;f++)if(""===s[f])return i===this.trueValue?this.getErrorStrings()[e.CommonErrors.DivZero]:0;var m,v;if(n===this.falseValue){v=this.falseValue;y={cellValue:m=this.getCellCollection(o[1]),cellRange:o,criteria:s,argArray:a,isCriteria:v,storedCells:l,isCountIfS:n};if(l=this.computeStoreCells(y),0===l.length)return i===this.trueValue?this.getErrorStrings()[e.CommonErrors.DivZero]:0}for(h=n===this.trueValue?0:2;h<o.length;h++){v=this.trueValue,v=n===this.trueValue&&0===h?this.falseValue:this.trueValue;var y={cellValue:m=this.getCellCollection(o[h]),cellRange:o,criteria:s,argArray:a,isCriteria:v,storedCells:l,isCountIfS:n,countVal:h};if(l=this.computeStoreCells(y),0===l.length)return i===this.trueValue?this.getErrorStrings()[e.CommonErrors.DivZero]:0}for(var C=0,b=c(o[0].indexOf("!")>-1?o[0].substring(o[0].lastIndexOf("!")+1):o[0]),x=o[o.length-1],S=c(x.indexOf("!")>-1?x.substring(x.lastIndexOf("!")+1):x),w=0;w<l.length;w++){var I="",E="",R=0,N=0,F=(I=l[w]).indexOf("!")>-1,A=void 0,k="",O="";for(F&&(O=I.substring(0,I.lastIndexOf("!")+1),I=I.substring(I.lastIndexOf("!")+1));!this.isDigit(I[R]);)R+=1;if(this.isCellReference(o[0])&&o[0].indexOf(":")>-1)for(E=g(b[0]+(u(I)[0]-S[0]),b[1]+(u(I)[1]-S[1])),(A=o[0].indexOf("!")>-1)&&(k=o[0].substring(0,o[0].lastIndexOf("!")+1));!this.isDigit(E[N]);)N+=1;var T=this.substring(I,R),D=this.substring(E,N),L=this.substring(I,R,I.length-R),P=this.substring(E,N,E.length-R);if(F&&(T=O+T,D=O+D),L!==P&&(l[w]=this.substring(l[w],F?O.length+R:R)+P),m=l[w].split(T).join(D),A?(m.indexOf("!")>-1&&(m=m.substring(m.lastIndexOf("!")+1)),m=k+m):m=m.substring(m.lastIndexOf("!")+1),n===this.trueValue)d+=1;else{var M=this.getValueFromArg(m),B=parseFloat(""===M&&i!==this.trueValue?"0":M);this.isNumber(B)&&(C++,d+=B)}}return i===this.trueValue&&(d/=C),d},i.prototype.processNestedFormula=function(e,t,r){return r&&!r.toString().includes('"')&&'"'===e[e.indexOf(t)+t.length]&&this.getErrorStrings().indexOf(r.toString())<0&&!this.isNumber(r)&&r!==this.trueValue&&r!==this.falseValue?e.split(t).join('"'+r+'"'):e.split(t).join("n"+r)},i.prototype.isNaN=function(e){return"NaN"===e.toString()||"string"==typeof e},i.prototype.isNumber=function(e){return e-parseFloat(e)>=0},i.prototype.fromOADate=function(e){(e=e>0&&e<1?1+e:0===e?1:e)>60&&(e-=1);var t=new Date("01/01/1900"),r=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds());return new Date(new Date((e-1)*this.millisecondsOfaDay+r).toUTCString().replace(" GMT",""))},i.prototype.getSerialDateFromDate=function(e,t,r){var n=0;e<1900&&(e+=1900);for(var i=!1;!i;){for(;t>12;)e++,t-=12;for(;t<1;)t+=12,e--;i=!0;for(var a=new Date(e,t,1,-1).getDate();r>a;)a=new Date(e,t,1,-1).getDate(),t++,r-=a,i=!1;r<1&&(--t<1&&(t=12,e--),r=(a=new Date(e,t,1,-1).getDate())+r,i=!1)}var o=Date.parse(e+"/"+t+"/"+r);return this.isNaN(o)||(n=this.toOADate(new Date(o))),n},i.prototype.intToTime=function(e){var r=e.toString().split(".");return t.isNullOrUndefined(r[1])||(e=parseFloat(r[0]+1+"."+r[1])||e),this.intToDate(e.toString())},i.prototype.toOADate=function(e,t,r){var n=new Date("01/01/1900"),i=ue(e)?e:new Date(e),a=Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()),o=(Date.UTC(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds())-a)/864e5;return(t?o:parseInt(o.toString(),10))+(r?0:o>60?2:1)},i.prototype.calculateDate=function(e){return this.parseFloat(e)<10?"0"+e:e},i.prototype.isTextEmpty=function(e){return null===e||""===e},i.prototype.isDigit=function(e){var t=e.charCodeAt(0);return t>47&&t<58},i.prototype.findLastIndexOfq=function(e){for(var t=e.lastIndexOf("q"),r=e.lastIndexOf(this.leftBracket);r<t;)t=e.substring(0,t).lastIndexOf("q");return t},i.prototype.getValueFromArg=function(t,r,n,i){if(!(t=t.trim())||this.getErrorStrings().indexOf(t)>-1)return t;var a=t[0];if(a===this.tic||a===this.singleTic){l=t.split(this.tic).join("");if(this.isNaN(this.parseFloat(l))){var o=this.isDate(l);if(o&&!this.isNaN(o.getDate()))return this.toOADate(o,!0).toString()}return t.endsWith(this.tic)&&"."!==(s=this.getParseDecimalSeparator())&&l.includes(s)&&(l=l.replace(s,"."),this.isNumber(l)&&(t=l)),t}if("u"===a&&t.includes(this.arithMarker))t=this.parser.parseSimpleOperators(t.split("u").join("0-"),[this.parser.tokenSubtract],["-"]);else if(!this.isUpperChar(a)){var s=this.getParseDecimalSeparator();if(this.isDigit(a)||a===s||"-"===a||"n"===a){if("n"===a&&(t=t.substring(1)).indexOf('"n')>-1&&(t=t.replace('"n','"')),"."!==s&&t.includes(s)){var l=t.replace(s,".");this.isNumber(l)&&(t=l)}return t}}var d=a===this.sheetToken;if(d||this.isUpperChar(a)&&!["+","-","/","*",")",")","{"].some(function(e){return t.includes(e)})){var h=this.isCellReference(t);if(h&&!d){var p=this.getSheetFamilyItem(this.grid);null!==p.sheetNameToParentObject&&p.parentObjectToToken.has(this.grid)&&(t=p.parentObjectToToken.get(this.grid)+t)}if(t===this.cell){var c=this.getDependentCells().get(t);if(null!=c&&c.indexOf(t)>-1&&this.arrayRemove(c,t),this.getDependentFormulaCells().has(this.cell)||this.clearFormulaDependentCells(this.cell),!r)throw new Xi(this.formulaErrorStrings[e.FormulasErrorsStrings.CircularReference])}var u=this.getParentObjectCellValue(t,!1,r,i).toString();return h&&this.updateDependentCell(t),u}return this.computeValue(t,!1,n)},i.prototype.isDate=function(e){if("object"==typeof e||null!==Date.parse(e)){var t=void 0;return t="string"==typeof e?this.checkDateFormat(e):new Date(Date.parse(e)),t>=this.dateTime1900?t:null}return null},i.prototype.isValidCellReference=function(e){var r=0,n=0,i=[89,71,69],a=this.emptyString;if(this.namedRanges.has(e))return!1;for(var o=0;o<e.length;o++)this.isChar(e[o])&&r++;if((a=e.substring(0,r)).length<4){for(;n<a.length;){if(t.isNullOrUndefined(a[n])||!(a[n].charCodeAt(0)<i[n])){if(t.isNullOrUndefined(a[n])&&n>0)break;return!1}n++}if(this.parseFloat(e.substring(r,e.length))<1048576)return!0}return!1},i.prototype.parseDate=function(t){if(!this.isNaN(t)){if(t instanceof Date)return new Date(t);var r=parseInt(t,10);return r<0?this.getErrorStrings()[e.CommonErrors.Num]:r<=60?new Date(this.dateTime1900.getTime()+864e5*(r-1)):new Date(this.dateTime1900.getTime()+864e5*(r-2))}return"string"!=typeof t||(t=this.checkDateFormat(t,!0),this.isNaN(t))?this.getErrorStrings()[e.CommonErrors.Value]:t},i.prototype.checkDateFormat=function(e,t){if("spreadsheet"===this.parentObject.getModuleName()&&"en-US"!==this.parentObject.locale){var r={value:e,cell:{value:e}};if(this.parentObject.notify("checkDateFormat",r),r.isDate)return r.dateObj}return t?new Date(e):new Date(Date.parse(e))},i.prototype.isCellReference=function(e){if((e=e.trim())===this.emptyString)return!1;e=this.setTokensForSheets(e);var t=this.getSheetToken(e),r=!1;""!==t&&(e=e.split(t).join(this.emptyString));var n=!1,i=!1;if(e.indexOf(":")!==e.lastIndexOf(":"))return!1;for(var a=e.split("").join(this.getParseArgumentSeparator()).split(this.getParseArgumentSeparator()),o=0;o<a.length;o++)if(this.isChar(a[o]))n=!0;else if(this.isDigit(a[o]))i=!0;else{if(":"!==a[o])return!1;n&&i&&(r=!0),n=!1,i=!1}return e.indexOf(":")>-1&&-1===e.indexOf(this.tic)?!!(r&&n&&i)||!(!(n&&!i||!n&&i)||r):!!(n&&i&&-1===e.indexOf(this.tic)&&this.isValidCell(e))},i.prototype.setTokensForSheets=function(e){var t=this.getSheetFamilyItem(this.grid),r=this.getSortedSheetNames();if(null!=r)for(var n=0;n<r.length;n++){var i=t.sheetNameToToken.get(r[n]);i=i.split(this.sheetToken).join(this.tempSheetPlaceHolder);var a=this.singleTic+"SHEET"+r[n]+this.singleTic+this.sheetToken;-1===e.indexOf(a)&&(a="SHEET"+r[n]+this.sheetToken),e=e.split(a).join(i),a=r[n]+this.sheetToken,e=e.split(a).join(i)}if((e=e.split(this.tempSheetPlaceHolder).join(this.sheetToken)).indexOf("!!")>-1){var o=(e=e.replace("!!","!")).split("!");o[1]=(parseInt(o[1],10)+1).toString(),e=o.join("!")}return e},i.prototype.getParentObjectCellValue=function(t,r,n,i){if(t===this.trueValue||t===this.falseValue)return t;var a,o=t.lastIndexOf(this.sheetToken),s=this.grid;if(o>-1){if(null===(d=this.getSheetFamilyItem(s)).tokenToParentObject)return this.getErrorStrings()[e.CommonErrors.Value];this.grid=d.tokenToParentObject.get(t.substring(0,o+1)),a=t.substring(o+1)}else{for(var l=0;l<t.length&&this.isChar(t[l]);)l++;if(l===t.length)return""===t?this.getErrorStrings()[e.CommonErrors.Value]:this.getErrorStrings()[e.CommonErrors.Name];a=t;var d=this.getSheetFamilyItem(s);d.isSheetMember&&null!=d.parentObjectToToken&&(t=d.parentObjectToToken.get(this.grid)+t)}if(this.isDigit(a[0])){var h=a.search(/[a-zA-Z]/);h>0&&(a=a.substring(h,a.length)+a.substring(0,h))}var p,c=this.rowIndex(a),u=this.colIndex(a);if(c>0&&c<=1048576&&u>0&&u<=16384){var f=this.getSheetId(this.grid);if(this.parentObject.notify){var g={action:"getSheetInfo",sheetInfo:[]};if(this.parentObject.notify(Kr,g),-1===Ee(this.parentObject,"Sheet"+f,g.sheetInfo))return this.grid=s,this.getErrorStrings()[e.CommonErrors.Ref]}p=this.getCellValueFn(s,this.cell,f,!1,r,n,i)(c,u,t)}else p=this.getErrorStrings()[e.CommonErrors.Name];return this.grid=s,p},i.prototype.getCellValueFn=function(r,n,i,a,o,s,l){var d=this,h=n;h&&(h=r===this.grid?"":h+","+("string"==typeof r&&Number(r)>-1?r:this.getSheetID(r)));var p=this.parentObject.getValueRowCol.bind(this.parentObject)||this.getValueRowCol.bind(this);return function(r,c,u){if(n===u&&!s)throw d.formulaErrorStrings[e.FormulasErrorsStrings.CircularReference];d.cell=u;var f=p(i,r,c,h,o,s,l);if(t.isNullOrUndefined(f))f=d.emptyString;else{f=f.toString();var g=d.getParseDecimalSeparator();if("."!==g&&f.includes(g)){var m=f.replace(g,".");d.isNumber(m)&&(f=m)}}return d.cell=n,a&&d.updateDependentCell(u),f}},i.prototype.isValidCell=function(e){if(0===e.search(/\d/)){var t=e.search(/[a-zA-Z]/);e=e.substring(t,e.length)+e.substring(0,t)}var r=this.rowIndex(e),n=this.colIndex(e);return r>0&&r<=1048576&&n>0&&n<=16384},i.prototype.getSheetId=function(e){return e&&"string"==typeof e&&Number(e)>-1?Number(e):this.getSheetID(e)+1},i.prototype.getValueRowCol=function(e,t,r){var n=this.rowsToKeyMap.get(t).toString(),i=this.getKeyValue(n).toString();if(null!=i&&"%"===i[i.length-1]&&i.length>1){var a=this.parseFloat(i.substring(0,i.length-1));this.isNaN(a)&&(i=(Number(a)/100).toString())}return i},i.prototype.defineFunction=function(e,r,n){"string"==typeof r&&(r=t.getValue(r,window)),e=e.toUpperCase(),this.libraryFormulas.set(e,{handler:r,isCustom:!0,description:n})},i.prototype.valueChanged=function(r,n,i,a,o,s,l,d,h,p,c,u){var f=r;this.spreadSheetUsedRange=a,this.grid=r;var g=!0,m=!0,v=this.getSheetFamilyItem(f),y=Xe(n.getColIndex())+n.getRowIndex().toString();this.actCell=s+"!"+y,null!==v.sheetNameToParentObject&&v.sheetNameToParentObject.size>0&&(y=v.parentObjectToToken.get(f)+y);var C=n.getFormulaValue().toUpperCase();if(C.indexOf("=RAND()")>-1||C.indexOf("=NOW()")>-1||C.indexOf("NOW()")>-1||C.indexOf("RAND()")>-1||C.indexOf("=RANDBETWEEN(")>-1||C.indexOf("RANDBETWEEN(")>-1||this.randomValues.has(y)){var b=this.randCollection.toString();this.randomValues.has(y)?this.randomValues.has(y)&&(C.indexOf("=RAND()")>-1||C.indexOf("=NOW()")>-1||C.indexOf("NOW()")>-1||C.indexOf("RAND()")>-1||C.indexOf("=RANDBETWEEN(")>-1||C.indexOf("RANDBETWEEN(")>-1?this.randomValues.set(y,n.getFormulaValue()):n.getFormulaValue().toUpperCase()!==this.randomValues.get(y.toUpperCase())&&(this.randomValues.delete(y),b=b.split(y+this.parseArgumentSeparator).join("").split(this.parseArgumentSeparator+y).join("").split(y).join(""),this.randCollection=b.split(this.parseArgumentSeparator)),0===this.randomValues.size&&this.randCollection.length&&(this.isRandomVal=!1,this.randomValues.clear(),this.randCollection=[])):(this.randomValues.set(y,n.getFormulaValue()),this.randCollection.push(y),this.isRandomVal=!0)}if(n.getFormulaValue()&&n.getFormulaValue()[0]===this.getFormulaCharacter()){this.cell=y;var x=void 0;if(t.isNullOrUndefined(m)||(m=i),this.getFormulaInfoTable().has(y)){if(x=this.getFormulaInfoTable().get(y),n.getFormulaValue()!==x.getFormulaText()||null==x.getParsedFormula()){x.setFormulaText(n.getFormulaValue()),this.getDependentFormulaCells().has(this.cell)&&this.clearFormulaDependentCells(this.cell);try{x.setParsedFormula(this.parser.parseFormula(n.getFormulaValue()))}catch(e){x.setFormulaValue(e),m=!1}}else this.parser.isError=!1;m&&(this.parser.isFormulaParsed=!0,g=(S=this.calculateFormula(x.getParsedFormula(),o))!==x.getFormulaValue()&&(!this.parentObject.isEdit||S!==this.formulaErrorStrings[e.FormulasErrorsStrings.CircularReference]),x.setFormulaValue(S))}else{(x=new Ki).setFormulaText(n.getFormulaValue()),this.getDependentFormulaCells().has(y)||this.getDependentFormulaCells().set(y,new Map),this.getFormulaInfoTable().set(y,x);try{x.setParsedFormula(this.parser.parseFormula(n.getFormulaValue()))}catch(e){x.setFormulaValue(e),m=!1}if(m){var S=this.calculateFormula(x.getParsedFormula(),o);g=S!==this.formulaErrorStrings[e.FormulasErrorsStrings.CircularReference],x.setFormulaValue(S)}}m&&(void 0===this.parentObject.setValueRowCol?this.setValueRowCol(this.getSheetID(f)+1,x.getFormulaValue(),n.getRowIndex(),n.getColIndex()):this.parentObject.setValueRowCol(this.getSheetId(f),x.getFormulaValue(),n.getRowIndex(),n.getColIndex(),x.getFormulaText(),l))}else this.getFormulaInfoTable().has(y)&&(this.getFormulaInfoTable().delete(y),this.getDependentFormulaCells().has(y)&&this.clearFormulaDependentCells(y));m&&g&&this.getDependentCells().has(y)&&("Automatic"===this.parentObject.calculationMode||!this.parentObject.isEdit||c)&&this.getDependentCells().get(y).toString()!==y&&this.refresh(y,void 0,void 0,d,h,p,c,u)},i.prototype.setValueRowCol=function(e,t,r,n){},i.prototype.getSortedSheetNames=function(){var e=this.getSheetFamilyItem(this.grid);if(null!=e&&null!=e.sheetNameToToken){var t=[];e.sheetNameToToken.forEach(function(e,r){t.push(r),t.sort()}),this.sortedSheetNames=t,this.sortedSheetNames.sort(),this.sortedSheetNames.length>9&&this.sortedSheetNames[0].includes("1")&&this.sortedSheetNames[1].includes("10")&&(this.sortedSheetNames.splice(this.sortedSheetNames.indexOf("2"),0,this.sortedSheetNames[0]),this.sortedSheetNames.splice(0,1))}return this.sortedSheetNames},i.prototype.getErrorLine=function(e){var t=e.stack?e.stack.split("\n")[1].split(":"):null;return t?t[t.length-2]:null},i.prototype.createSheetFamilyID=function(){return this.sheetFamilyID===Number.MAX_SAFE_INTEGER&&(this.sheetFamilyID=Number.MIN_SAFE_INTEGER),this.sheetFamilyID++},i.prototype.computeMinMax=function(r,n){var i,a,o,s,l=!1;if(r.length){var d=r[r.length-1];"isSubtotal"===d?(l=!0,r.pop()):"isAggregate"===d&&(s=this.parentObject.getActiveSheet(),o=!0,r.pop())}if(t.isNullOrUndefined(r)||0===r.length)return this.formulaErrorStrings[e.FormulasErrorsStrings.WrongNumberArguments];i="max"===n?this.minValue:this.maxValue;for(var h=0,p=r.length;h<p;h++)r[h].split(this.tic).join("").trim()===this.emptyString&&(i=0);var c,f=r;if(f.length>255)return this.getErrorStrings()[e.CommonErrors.Value];for(var g=0;g<f.length;g++)if(f[g].indexOf(":")>-1&&this.isCellReference(f[g])){for(var m=this.getCellCollection(f[g]),v=0;v<m.length;v++)if(!(o&&(c=u(m[v]),tt(s,c[0])||ht(s,c[1]))||(a=l?this.getValueFromArg(m[v],null,null,!0):this.getValueFromArg(m[v]),l&&a.includes("SUBTOTAL(")))){C=this.parseFloat(a);""===a||this.isNaN(this.parseFloat(C))||this.getErrorStrings().indexOf(a)>-1||(i="max"===n?Math.max(i,C):Math.min(i,C))}}else{var y=l?this.getValueFromArg(f[g],null,null,!0):this.getValueFromArg(f[g]);if(l&&y.includes("SUBTOTAL("))continue;var C=0,b=this.isCellReference(f[g]),x=""===y&&b,S=this.isNaN(this.parseFloat(y))&&b,w=y===(this.trueValue||this.falseValue)&&b;if(f[g]=f[g].startsWith("n")?f[g].slice(1):f[g],this.getErrorStrings().indexOf(y)>-1)return y;if(y===this.trueValue&&f[g]===this.trueValue)y="1";else if(y===this.falseValue&&f[g]===this.falseValue)y="0";else if(x||S||w)continue;if(y.indexOf('"')>-1&&(y=y.split(this.tic).join("")),this.isNaN(this.parseFloat(y)))return this.getErrorStrings()[e.CommonErrors.Value];C=this.parseFloat(y),i="max"===n?Math.max(i,C):Math.min(i,C)}return i!==this.minValue&&i!==this.maxValue||(i=0),i.toString()},i.prototype.calculateAvg=function(r,n,i){var a,o,s,l,d=r,h=[],p=0,c=0;i&&(l=this.parentObject.getActiveSheet());for(var f=0;f<d.length;f++)if(this.isCellReference(d[f]))if(d[f].indexOf(":")>-1){h=this.getCellCollection(d[f]);for(var g=0;g<h.length;g++)if(!(i&&(s=u(h[g]),tt(l,s[0])||ht(l,s[1]))||(a=n?this.getValueFromArg(h[g],null,null,!0):this.getValueFromArg(h[g]),n&&a.includes("SUBTOTAL(")))){if(this.getErrorStrings().indexOf(a)>-1)return a;t.isNullOrUndefined(a)||isNaN(this.parseFloat(a))||""===a||(p+=this.parseFloat(a),c+=1)}}else{if(a=n?this.getValueFromArg(d[f],null,null,!0):this.getValueFromArg(d[f]),n&&a.includes("SUBTOTAL("))continue;if(this.getErrorStrings().indexOf(a)>-1)return a;if(t.isNullOrUndefined(a)||isNaN(this.parseFloat(a))||""===a)continue;p+=this.parseFloat(a),c+=1}else{if(d[f].indexOf(this.tic)>-1&&(isNaN(this.parseFloat(d[f].split(this.tic).join("")))||""===d[f].split(this.tic).join("").trim()))return this.getErrorStrings()[e.CommonErrors.Value];if(0!==d[f].length&&r[f]!==this.falseValue||(d[f]="0"),r[f]===this.trueValue&&(d[f]="1"),o=this.getValueFromArg(d[f].split(this.tic).join("")),this.getErrorStrings().indexOf(o)>-1)return o;p+=this.parseFloat(o),c+=1}return 0===c?this.getErrorStrings()[e.CommonErrors.DivZero]:(p/c).toString()},i.prototype.registerGridAsSheet=function(e,r,n){t.isNullOrUndefined(this.modelToSheetID)&&(this.modelToSheetID=new Map),t.isNullOrUndefined(this.modelToSheetID.get(r))&&this.modelToSheetID.set(r,n);var i=this.getSheetFamilyItem(r);i.isSheetMember=!0;var a=e.toUpperCase();if(0===i.parentObjectToToken.size&&(i.parentObjectToToken=new Map),0===i.sheetNameToParentObject.size&&(i.sheetNameToParentObject=new Map),0===i.sheetNameToToken.size&&(i.sheetNameToToken=new Map),0===i.tokenToParentObject.size&&(i.tokenToParentObject=new Map),t.isUndefined(i.sheetNameToParentObject.get(a))){o=this.sheetToken+this.tokenCount.toString()+this.sheetToken;this.tokenCount++,i.tokenToParentObject.set(o,r),i.parentObjectToToken.set(r,o),i.sheetNameToToken.set(a,o),i.sheetNameToParentObject.set(a,r)}else{var o=i.sheetNameToToken.get(a);i.tokenToParentObject.set(o,r),i.parentObjectToToken.set(r,o)}return e},i.prototype.unregisterGridAsSheet=function(e,r,n){var i=this,a=[r];n&&(a=[],t.isNullOrUndefined(this.modelToSheetID)||this.modelToSheetID.forEach(function(e,t){a.push(t)})),a.forEach(function(t){var r=i.getSheetFamilyItem(t),a=(n?t:e).toUpperCase();if(null!=r.sheetNameToParentObject&&r.sheetNameToParentObject.has(a)){r.sheetNameToParentObject.delete(a);var o=r.sheetNameToToken.get(a);r.sheetNameToToken.delete(a),r.tokenToParentObject.delete(o),r.parentObjectToToken.delete(t)}})},i.prototype.computeExpression=function(e,t){var r=this.parser.parseFormula(e);return this.computeFormula(r,t)},i.prototype.isSheetMember=function(){var e=this.getSheetFamilyItem(this.grid);return!t.isNullOrUndefined(e)&&e.isSheetMember},i.prototype.dispose=function(){this.resetKeys(),this.namedRanges.clear(),this.lFormulas.clear()},i.prototype.refreshRandValues=function(e){var t,r,n,i,a="";if(this.randomValues.has(e)){this.randomValues.delete(e);var o=this.randCollection.indexOf(e);o>-1&&this.randCollection.splice(o,1),0!==this.randomValues.size||this.randCollection.length||(this.randomValues.clear(),this.randCollection=[])}for(var s=0;s<this.randomValues.size;s++)t=this.rowIndex(this.randCollection[s]),r=this.colIndex(this.randCollection[s]),a=(parseFloat(this.getSheetToken(this.randCollection[s]).split(this.sheetToken).join(""))+1).toString(),i=this.getSheetFamilyItem(a),this.grid=i.sheetNameToParentObject.get(a),n=this.randomValues.get(this.randCollection[s]),n=this.computeFormula(n),void 0===this.parentObject.setValueRowCol?this.setValueRowCol(this.getSheetID(this.grid)+1,n,t,r):this.parentObject.setValueRowCol(this.getSheetId(this.grid),n,t,r)},i.prototype.refresh=function(e,t,r,n,i,a,o,s){var l,d=this;r||(l=!0,r=[]);var h=this.getSheetFamilyItem(this.grid);try{var p=this.getDependentCells().get(e);if(p&&0!==p.length&&("Automatic"===this.parentObject.calculationMode||o||"calculate"===s)){var c=void 0;for(c=0;c<p.length;c++){var u=p[c];if(!(t&&u.indexOf(t)>-1||u===e||r.indexOf(u)>-1)){var f=this.getSheetToken(u),m=this.parentObject.sheets,v=this.parentObject.activeSheetIndex;if(f.length){this.grid=h.tokenToParentObject.get(f);var y=Number(this.grid),C="";if(!this.isNaN(y)&&m)for(var b=0;b<m.length;b++)m[b].id===y&&(C=m[b].name,v=b);this.actCell=C+"!"+u.split(f)[1]}else this.actCell=u.split(f)[1];try{var x=function(e,t){t&&(d.cell=e,d.parser.isFormulaParsed=!0,t.setFormulaValue(d.calculateFormula(t.getParsedFormula(),!0)))},S=this.rowIndex(u),w=this.colIndex(u),I=this.getFormulaInfoTable().get(u);if(void 0===this.parentObject.setValueRowCol)x(u,I),this.setValueRowCol(this.getSheetID(this.grid)+1,I.getFormulaValue(),S,w);else{var E=void 0;if((O=m&&m[v].rows&&m[v].rows[S-1]&&m[v].rows[S-1].cells&&m[v].rows[S-1].cells[w-1])&&O.formula&&O.formula.toLowerCase().includes("unique")){if(this.uniqueCells&&-1!==this.uniqueCells.indexOf(u))continue;this.uniqueCells||(this.uniqueCells=[]),this.uniqueCells.push(u),x(u,I),E=I.getFormulaValue(),this.uniqueCells.splice(this.uniqueCells.indexOf(u),1),this.uniqueCells.length||(this.uniqueCells=null)}else-1===r.indexOf(u)&&r.push(u),E=null;this.parentObject.setValueRowCol(this.getSheetId(this.grid),E,S,w,I.getFormulaText())}this.refresh(u,null,r,null,i)}catch(e){continue}}}}if(l){if(!i&&a&&4===a.length){for(var f=this.getSheetToken(e),R=[],N=a[0],F=a[2];N<=F;N++)for(var A=a[1],k=a[3];A<=k&&(N!==F||A!==k);A++){var O=f+g(N,A);this.refresh(O,null,r,null,i),R.push(O)}var T=new Set(R);r&&(r=r.filter(function(e){return!T.has(e)}))}var D=this.parentObject.sheets;D||(r=[]),r.forEach(function(e){for(var t,r=d.getSheetId(h.tokenToParentObject.get(d.getSheetToken(e))),i=0;i<D.length;i++)if(D[i].id===r){t=i;break}var a=d.rowIndex(e)-1,o=d.colIndex(e)-1,l=D[t].rows[a]&&D[t].rows[a].cells[o];l&&d.parentObject.notify("calculateFormula",{cell:l,rowIdx:a,colIdx:o,sheetIndex:t,isDependentRefresh:!0,isRandomFormula:n,action:s})})}}finally{this.getDependentCells().has(e)&&(this.grid=h.tokenToParentObject.get(this.getSheetToken(e)))}},Gi([t.Event()],i.prototype,"onFailure",void 0),i=Gi([t.NotifyPropertyChanges],i)}(t.Base),Xi=function(){function e(e,t){this.formulaCorrection=!1,this.message=e,this.formulaCorrection=t}return e}(),Ki=function(){function e(){this.calcID=Number.MIN_VALUE+1,this.calcID1=Number.MIN_VALUE+1}return e.prototype.getFormulaText=function(){return this.formulaText},e.prototype.setFormulaText=function(e){this.formulaText=e},e.prototype.getFormulaValue=function(){return this.formulaValue},e.prototype.setFormulaValue=function(e){this.formulaValue=e},e.prototype.getParsedFormula=function(){return this.parsedFormula},e.prototype.setParsedFormula=function(e){this.parsedFormula=e},e}(),$i=function(){function e(){this.isSheetMember=!1,this.parentObjectToToken=new Map,this.sheetDependentFormulaCells=new Map,this.sheetNameToParentObject=new Map,this.sheetNameToToken=new Map,this.tokenToParentObject=new Map,this.sheetFormulaInfotable=new Map}return e}(),Zi=function(){function e(e,t,r){return this.row=e,this.col=t,this.value=r,this.getRowIndex=function(){return e},this.setRowIndex=function(t){e=t},this.getColIndex=function(){return t},this.setColIndex=function(e){t=e},this.getFormulaValue=function(){return r},this}return e}(),Ji=function(){function n(e){this.uniqueOBracket=String.fromCharCode(129),this.uniqueCBracket=String.fromCharCode(130),this.uniqueCSeparator=String.fromCharCode(131),this.uniqueCOperator=String.fromCharCode(132),this.uniquePOperator=String.fromCharCode(133),this.uniqueSOperator=String.fromCharCode(134),this.uniqueMOperator=String.fromCharCode(135),this.uniqueDOperator=String.fromCharCode(136),this.uniqueModOperator=String.fromCharCode(137),this.uniqueConcateOperator=String.fromCharCode(138),this.uniqueEqualOperator=String.fromCharCode(139),this.uniqueExpOperator=String.fromCharCode(140),this.uniqueGTOperator=String.fromCharCode(141),this.uniqueLTOperator=String.fromCharCode(142),this.sheetInfo=[],this.parent=e,this.init()}return n.prototype.init=function(){var e=this;this.addEventListener(),this.initCalculate(),this.registerSheet(),this.parent.customFormulaCollection.forEach(function(t,r){e.addCustomFunction(t.handler,r,t.description)})},n.prototype.destroy=function(){var e=this;this.removeEventListener(),this.parent.refreshing&&(this.clearAllUniqueFormulaValue(),this.calculateInstance.getLibraryFormulas().forEach(function(t,r){t.isCustom&&e.parent.customFormulaCollection.set(r,{handler:t.handler,description:t.description})})),this.calculateInstance.dispose(),this.calculateInstance=null,this.sheetInfo&&(this.sheetInfo=[]),this.parent=null},n.prototype.addEventListener=function(){this.parent.on(Kr,this.performFormulaOperation,this),this.parent.on("aggregateComputation",this.aggregateComputation,this),this.parent.on("getUniqueRange",this.getUniqueRange,this),this.parent.on("removeUniquecol",this.removeUniquecol,this),this.parent.on(tn,this.clearFormulaDependentCells,this),this.parent.on("formulaInValidation",this.formulaInValidation,this),this.parent.on("refreshInsertDelete",this.refreshInsertDelete,this),this.parent.on("getUpdatedFormulaOnInsertDelete",this.getUpdatedFormulaOnInsertDelete,this),this.parent.on("checkFormulaRef",this.autoCorrectCellRef,this),this.parent.on("parseFormulaArgument",this.parseFormulaArgument,this),this.parent.on("getCellRefValue",this.getCellRefValue,this),this.parent.on("commputeFormulaValue",this.commputeFormulaValue,this),this.parent.on("sheetRenameUpdate",this.renameUpdation,this)},n.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Kr,this.performFormulaOperation),this.parent.off("aggregateComputation",this.aggregateComputation),this.parent.off("getUniqueRange",this.getUniqueRange),this.parent.off("removeUniquecol",this.removeUniquecol),this.parent.off(tn,this.clearFormulaDependentCells),this.parent.off("formulaInValidation",this.formulaInValidation),this.parent.off("refreshInsertDelete",this.refreshInsertDelete),this.parent.off("getUpdatedFormulaOnInsertDelete",this.getUpdatedFormulaOnInsertDelete),this.parent.off("checkFormulaRef",this.autoCorrectCellRef),this.parent.off("parseFormulaArgument",this.parseFormulaArgument),this.parent.off("getCellRefValue",this.getCellRefValue),this.parent.off("commputeFormulaValue",this.commputeFormulaValue),this.parent.off("sheetRenameUpdate",this.renameUpdation))},n.prototype.getModuleName=function(){return"workbookFormula"},n.prototype.initCalculate=function(){this.calculateInstance=new Yi(this.parent),this.calcID=this.calculateInstance.createSheetFamilyID(),this.calculateInstance.setTreatEmptyStringAsZero(!0),this.calculateInstance.grid=this.parent.getActiveSheet().id.toString(),this.calculateInstance.setParseArgumentSeparator(this.parent.listSeparator);var e=t.getNumericObject(this.parent.locale).decimal;"."!==e&&this.parent.listSeparator!==e&&this.calculateInstance.setParseDecimalSeparator(e)},n.prototype.clearFormulaDependentCells=function(e){if(e.isOpen)return this.calculateInstance.getDependentCells().clear(),this.calculateInstance.getFormulaInfoTable().clear(),void this.calculateInstance.getDependentFormulaCells().clear();var r=e.cellRef.split(":")[0],n=this.parent.getActiveSheet().id.toString(),i=this.calculateInstance.getSheetFamilyItem(n);i.isSheetMember&&!t.isNullOrUndefined(i.parentObjectToToken)&&(r=i.parentObjectToToken.get(n)+r),e.clearFormulaInfo&&this.calculateInstance.getFormulaInfoTable().has(r)&&this.calculateInstance.getFormulaInfoTable().delete(r),this.calculateInstance.clearFormulaDependentCells(r)},n.prototype.formulaInValidation=function(e){var r=this.calculateInstance.getLibraryFormulas().get(e.value);e.skip=t.isNullOrUndefined(r)},n.prototype.performFormulaOperation=function(e){var r,n,i=e.action;"refreshCalculate"!==i&&(r=this.calculateInstance.getLibraryFormulas(),n=Array.from(r.values()));var a,o=this.calculateInstance.getSheetFamilyItem(e.sheetId);switch(i){case"getLibraryFormulas":e.formulaCollection=Array.from(r.keys());break;case"getFormulaCategory":a=["All"];for(s=1;s<Array.from(r.values()).length;s++)a.indexOf(n[s].category)<0&&a.push(n[s].category);e.categoryCollection=a;break;case"dropDownSelectFormulas":for(s=0;s<Array.from(r.values()).length;s++)e.selectCategory===n[s].category&&(e.formulaCollection[s]=Array.from(r.keys())[s]);break;case"getFormulaDescription":for(s=0;s<Array.from(r.values()).length;s++)e.selectedList===Array.from(r.keys())[s]&&(e.description=n[s].description,e.isCustom=n[s].isCustom);break;case"registerSheet":this.registerSheet(e.sheetIndex,e.sheetCount),e.isImport&&(this.calculateInstance.setParseArgumentSeparator(this.parent.listSeparator),this.updateSheetInfo());break;case"unRegisterSheet":this.unRegisterSheet(e.sheetIndex,e.sheetCount,e.propertyChange);break;case"initSheetInfo":this.updateSheetInfo();break;case"refreshCalculate":this.refreshCalculate(e);break;case"refreshRandomFormula":this.refreshRandomFormula(),this.calculateInstance.cell="";break;case"setArgumentSeparator":this.calculateInstance.setParseArgumentSeparator(this.parent.listSeparator);break;case"addDefinedName":e.isAdded=this.addDefinedName(e.definedName,!1,e.index,e.isEventTrigger);break;case"removeDefinedName":e.isRemoved=this.removeDefinedName(e.definedName,e.scope,e.isEventTrigger);break;case"initiateDefinedNames":this.initiateDefinedNames();break;case"addSheet":this.sheetInfo.push({visibleName:e.visibleName,sheet:e.sheetName,index:e.sheetId});break;case"getSheetInfo":e.sheetInfo=this.sheetInfo;break;case"deleteSheetTab":for(var s=0;s<this.sheetInfo.length;s++)if(this.sheetInfo[s].index===e.sheetId){var l=this.sheetInfo[s].visibleName,d=this.sheetInfo[s].sheet;this.sheetInfo.splice(s,1);var h=e.sheetId.toString();this.sheetDeletion(d,h),this.calculateInstance.unregisterGridAsSheet(h,h),this.definedNamesDeletion(l);break}break;case"getReferenceError":e.refError=this.referenceError();break;case"getAlpha":e.col=Xe(e.col);break;case"addCustomFunction":this.addCustomFunction(e.functionHandler,e.functionName,e.formulaDescription);break;case"computeExpression":e.calcValue=this.calculateInstance.computeExpression(e.formula,e.isFromComputeExpression);break;case"registerGridInCalc":this.calculateInstance.grid=e.sheetID;break;case"dependentCellsAvailable":case"checkFormulaAdded":o.isSheetMember&&!t.isNullOrUndefined(o.parentObjectToToken)&&(e.address=o.parentObjectToToken.get(e.sheetId)+e.address),"checkFormulaAdded"===i?e.added=this.calculateInstance.getFormulaInfoTable().has(e.address):e.isAvailable=this.calculateInstance.getDependentCells().has(e.address);break;case"calculateNow":this.calculateNow(e);break;case"ClearDependentCellCollection":this.calculateInstance.getDependentFormulaCells().clear(),this.calculateInstance.getDependentCells().clear(),this.calculateInstance.getFormulaInfoTable().clear()}},n.prototype.definedNamesDeletion=function(e){var t=this.parent.definedNames;if(t&&t.length>0)for(var r=t.length-1;r>=0;r--)t[r].refersTo.substring(1,t[r].refersTo.lastIndexOf("!")).split("'").join("")===e&&this.removeDefinedName(t[r].name,t[r].scope)},n.prototype.referenceError=function(){return this.calculateInstance.getErrorStrings()[e.CommonErrors.Ref]},n.prototype.getSheetInfo=function(){return this.sheetInfo},n.prototype.addCustomFunction=function(e,t,r){this.calculateInstance.defineFunction(t,e,r)},n.prototype.updateSheetInfo=function(){var e=this;this.sheetInfo=[],this.parent.sheets.forEach(function(t){e.sheetInfo.push({visibleName:t.name,sheet:"Sheet"+t.id,index:t.id})})},n.prototype.getSheetRefUpdateOnDelete=function(){var e,t,r,n=this,i=this.calculateInstance.namedRanges;return i&&i.size&&(r=!0,e=Array.from(i.keys()),t=Array.from(i.values())),function(i,a){var o;r&&!a.includes(i)&&(a=a.replace(/\w+/g,function(r){var n=e.indexOf(r);return-1!==n?(o=!0,t[n]):r}));for(var s=i.toUpperCase(),l=(a=a.toUpperCase()).indexOf(s);l>-1;)l=(a=a.split(("'"===a[l-1]&&"'"===a[l+s.length]?"'"+s+"'":s)+n.calculateInstance.sheetToken).join(n.referenceError())).indexOf(s);return{value:a,isNamedRange:o}}},n.prototype.sheetDeletion=function(e,r){var n,i,a,o=this,s=this.calculateInstance.getDependentCells(),l=this.calculateInstance.getSheetFamilyItem(r),d=this.getSheetRefUpdateOnDelete();s.forEach(function(s,h){s.forEach(function(s){n=o.calculateInstance.getFormulaInfoTable().get(s),t.isNullOrUndefined(n)||(a=d(e,n.formulaText)).value!==n.formulaText&&(i=s.slice(0,s.lastIndexOf(o.calculateInstance.sheetToken)+1),a.sheetId=l.tokenToParentObject.has(i)?Number(l.tokenToParentObject.get(i)):parseInt(s.split("!")[1],10)+1,o.updateDataContainer([o.calculateInstance.rowIndex(s)-1,o.calculateInstance.colIndex(s)-1],a),o.calculateInstance.refresh(n.getParsedFormula())),i=h.slice(0,h.lastIndexOf(o.calculateInstance.sheetToken)+1),r===(l.tokenToParentObject.has(i)?l.tokenToParentObject.get(i):h.split("!")[1])&&(o.calculateInstance.getFormulaInfoTable().delete(h),o.calculateInstance.clearFormulaDependentCells(h))})})},n.prototype.renameUpdation=function(e){var t,r,n=this,i=e.value,a=e.pName,o=e.pName.toUpperCase(),s=new RegExp("[!@#$%^&()+=';,.{}|\\\":<>~_-]","g"),l=new RegExp(a.replace(s,"\\$&")+'(?=[\'!])(?=[^"]*(?:"[^"]*"[^"]*)*$)',"gi"),d=function(e){k(e.value1)&&e.value1.toUpperCase().includes(o)&&e.value1.match(l)&&(e.value1=e.value1.replace(l,i)),k(e.value2)&&e.value2.toUpperCase().includes(o)&&e.value2.match(l)&&(e.value2=e.value2.replace(l,i))};this.sheetInfo.forEach(function(e,s){if((t=Ae(n.parent,s))&&t.rows&&t.rows.length)for(var h=0,p=t.rows.length;h<p;h++)if(t.rows[h]&&t.rows[h].cells)for(var c=0,u=t.rows[h].cells.length;c<u;c++)(r=He(h,c,t,!1,!0)).formula&&k(r.formula)&&r.formula.toUpperCase().includes(o)&&r.formula.match(l)&&(r.formula=r.formula.replace(l,i)),r.validation&&d(r.validation);if(t&&t.columns&&t.columns.length)for(var f=void 0,h=0,g=t.columns.length;h<g;h++)(f=t.columns[h])&&f.validation&&d(f.validation);for(var m=n.parent.definedNames,h=0;h<m.length;h++)k(m[h].refersTo)&&m[h].refersTo.includes(a)&&m[h].refersTo.match(l)&&(m[h].refersTo=m[h].refersTo.replace(l,i),m[h].scope.includes(a)&&(m[h].scope=i));n.calculateInstance.updateNamedRange(a,i),e.visibleName===a&&(e.visibleName=i)})},n.prototype.updateDataContainer=function(e,t){for(var r,n,i,a=0,o=this.parent.sheets.length;a<o;a++)if((r=Ae(this.parent,a)).id===t.sheetId){e[0]in r.rows?(n=r.rows[e[0]],e[1]in n.cells?((i=n.cells[e[1]]).formula=t.isNamedRange?i.formula:t.value,t.visible?a===this.parent.activeSheetIndex&&r.activeCell===g(e[0],e[1])&&this.parent.notify("selectionComplete",{}):"Automatic"===this.parent.calculationMode&&(i.value=this.referenceError())):n.cells[e[1]]=i={}):(n=r.rows[e[0]]={})[e[1]]=i={};break}},n.prototype.parseSheetRef=function(e,t){var r,n=new RegExp("[!@#$%^&()+=';,.{}|\":<>~_-]","g"),i=0,a=this.getSheetInfo(),o=a.length,s=[];s.length=0;var l,d,h,p,c,u='(?=[\'!])(?=[^"]*(?:"[^"]*"[^"]*)*$)',f=RegExp;for(i=0;i<o;i++)if(a[i].sheet!==a[i].visibleName&&(r=new f(a[i].visibleName.replace(n,"\\$&")+u,"gi"),h=i,e.match(r))){for(var g=i+1;g<o;g++)a[g].visibleName.includes(a[i].visibleName)&&(l=new f(a[g].visibleName.replace(n,"\\$&")+u,"gi"),d=e.search(l),p=e.search(r),d>-1&&(d<p||d===p&&a[g].visibleName.length>a[i].visibleName.length)&&(c=new RegExp("Sheet","gi"),0!==a[g].visibleName.search(c)&&(r=l,h=g)));e=e.replace(r,h+"/"),s.push(h)}i=0;for(var m;i<s.length;)r=new f(s[i]+"/"+u,"gi"),m=t?"`"+a[s[i]].sheet+"`":a[s[i]].sheet,e=e.replace(r,m),i++;return e},n.prototype.registerSheet=function(e,t){void 0===e&&(e=0),void 0===t&&(t=this.parent.sheets.length);for(var r;e<t;)r=Ae(this.parent,e).id+"",this.calculateInstance.registerGridAsSheet(r,r,this.calcID),e++},n.prototype.unRegisterSheet=function(e,t,r){void 0===e&&(e=0),void 0===t&&(t=this.parent.sheets.length);var n;if(this.calculateInstance.tokenCount=0,r)this.calculateInstance.unregisterGridAsSheet(n,n,r);else for(;e<t;)n=Ae(this.parent,e).id+"",this.calculateInstance.unregisterGridAsSheet(n,n),e++},n.prototype.getUniqueRange=function(e){e.range=this.calculateInstance.uniqueRange},n.prototype.removeUniquecol=function(e){if(e&&e.clearAll)return void this.clearAllUniqueFormulaValue();for(var t=this.parent.getActiveSheet(),r=0;r<this.calculateInstance.uniqueRange.length;r++){var n=this.calculateInstance.uniqueRange[r].split(":")[0].split("!");if(n[0]===t.name&&n[1]===t.activeCell){var i=c(this.calculateInstance.uniqueRange[r]);this.calculateInstance.uniqueRange.splice(r,1);for(var a=i[0];a<=i[2];a++)for(var o=i[1];o<=i[3];o++)He(a,o,this.parent.getActiveSheet()).formula="",this.parent.updateCellDetails({value:"",formula:""},m([a,o]),void 0,void 0,!0)}}},n.prototype.refreshCalculate=function(e){e.sheet=t.isNullOrUndefined(e.sheetIndex)?this.parent.getActiveSheet():Ae(this.parent,e.sheetIndex);var r=e.sheet.id+"",n=this.calculateInstance.getSheetFamilyItem(r),i=v(e.colIndex+1)+(e.rowIndex+1);n.isSheetMember&&!t.isNullOrUndefined(n.parentObjectToToken)&&(i=n.parentObjectToToken.get(r)+i),e.isFormula?this.calculateFormula(e,i):(this.calculateInstance.getFormulaInfoTable().has(i)&&(this.calculateInstance.getFormulaInfoTable().delete(i),this.calculateInstance.clearFormulaDependentCells(i)),this.calculateInstance.refresh(i,null,null,null,e.isDelete,e.deletedRange),"Automatic"===this.parent.calculationMode&&this.calculateInstance.refreshRandValues(i)),this.calculateInstance.cell="",e.isFormulaDependent=this.calculateInstance.getDependentCells().has(i),e.value&&(e.value=e.value.toString().split("^+").join("^").split("&+").join("&"))},n.prototype.calculateFormula=function(e,t){var r=this,n=e.sheet;this.autoCorrectFormula(e,n);var i=e.value;e.isClipboard&&i.toUpperCase().includes("UNIQUE")&&Ue(e.rowIndex,e.colIndex,n,{value:""},!0);var a=i;i=this.parseSheetRef(i);var o=new Zi(e.rowIndex+1,e.colIndex+1,i),s=[n.usedRange.rowIndex,n.usedRange.colIndex];this.calculateInstance.valueChanged(n.id.toString(),o,!0,s,e.isRefreshing,n.name,e.isRandomFormula,null,e.isDelete,e.deletedRange,e.isDependentRefresh,e.action),!0!==this.calculateInstance.isRandomVal||e.isRandomFormula||"Automatic"!==this.parent.calculationMode||this.refreshRandomFormula();var l=He(e.rowIndex,e.colIndex,n);if(l&&a&&!e.isDependentRefresh){var d=void 0;if(0===(a=a.toUpperCase()).indexOf("=SUM(")?d="=SUM(":0===a.indexOf("=AVERAGE(")?d="=AVERAGE(":0===a.indexOf("=ROUNDDOWN(")?d="=ROUNDDOWN(":0===a.indexOf("=ROUNDUP(")?d="=ROUNDUP(":0===a.indexOf("=MOD(")&&(d="=MOD("),d){if((a=a.replace(d,"")).includes(")")){a=a.slice(0,a.lastIndexOf(")"));for(var h=void 0,p=void 0;a.includes("(")&&a.includes(")");)p=a.indexOf("("),h=a.slice(p+1),a=a.slice(0,p)+(h.includes(")")?h.slice(h.indexOf(")")+1):h)}for(var u,f=a.split(this.calculateInstance.getParseArgumentSeparator()),g=void 0,m=void 0,v=void 0,y=void 0,C=void 0,b=this,p=0;p<f.length&&"break"!==function(t){if(u=f[t].split(":")[0],u.includes("!")?(y=u.substring(0,u.lastIndexOf("!")).split("'").join(""),u=u.substring(u.lastIndexOf("!")+1)):y="",O(u)){y?(v=Se(b.parent,y),m=void 0!==v?Ae(b.parent,v):n):m=n,C=c(u),g=He(C[0],C[1],m);var r=$e(l.format),i=["Number","Currency","LongDate","Time"];if(g&&g.format&&(!l.format||!e.fillType&&i.every(function(e){return r!==e})&&"Number"!==$e(g.format)))return l.format=g.format,"break"}}(p);p++);}else{var x=this.calculateInstance.getDependentFormulaCells().get(t);if(x&&x.size&&this.calculateInstance.getFormulaInfoTable().has(t)&&-1===this.calculateInstance.getFormulaInfoTable().get(t).getParsedFormula().lastIndexOf("q")&&!l.format){var S,w,I,E,R,N,F=this.calculateInstance.getSheetFamilyItem(null,this.calcID);x.forEach(function(e){S||(I=e.slice(0,e.lastIndexOf("!")+1),O(e=e.replace(I,""))&&(N=c(e),F.tokenToParentObject.has(I)?(R=we(r.parent,Number(F.tokenToParentObject.get(I))),E=void 0!==R?Ae(r.parent,R):n):E=n,(w=He(N[0],N[1],E))&&w.format&&(S=w.format)))}),S&&(l.format=S)}}}},n.prototype.refreshRandomFormula=function(){var e,t,r="",n=this.calculateInstance.randCollection;if(this.calculateInstance.randomValues.size>1&&this.calculateInstance.randomValues.size===n.length)for(var i=0;i<this.calculateInstance.randomValues.size;i++){e=this.calculateInstance.rowIndex(n[i]),t=this.calculateInstance.colIndex(n[i]),r=this.calculateInstance.randomValues.get(n[i]);var a=(parseFloat(this.calculateInstance.getSheetToken(n[i]).split(this.calculateInstance.sheetToken).join(""))+1).toString(),o=Ae(this.parent,we(this.parent,Number(a)));if(o&&He(e-1,t-1,o).formula){var s=new Zi(e,t,r);this.calculateInstance.valueChanged(a,s,!0,void 0,void 0,void 0,!1,!0)}}},n.prototype.autoCorrectFormula=function(e,r){if(!t.isNullOrUndefined(e.value)){var n=e.value;2===(n=(n=this.autoCorrectCellRef({formula:e.value})).toString()).split("(").length&&n.indexOf(")")<0&&(n+=")");var i=void 0;0===n.indexOf("=")&&(n=n.slice(1),i=!0);var a=n.match(/</g),o=n.match(/>/g),s=n.match(/=/g);if(a){for(var l="",d=0;d<a.length;d++)l+=a[d];n=n.replace(l,"<")}if(o){for(var h="",p=0;p<o.length;p++)h+=o[p];n=n.replace(h,">")}if(s){for(var c="",u=0;u<s.length;u++)c+=s[u];n=n.split(c).join("=")}n=i?"="+n:n,(a||o||s)&&(He(e.rowIndex,e.colIndex,r).formula=n),e.value=n}},n.prototype.correctCellReference=function(e){var t,r,n,i,a,o=this,s=e.split(":");return s.forEach(function(l,d){if(r=l.split("!"),e=r[1]||l,a=null,e.includes("&"))t=e.split("&"),o.calculateInstance.isCellReference(t[1].split("$").join(""))&&(t[1]=o.getUpdatedCellRef(t[1]),a=t.join("&"));else if(o.calculateInstance.isCellReference(e.split("$").join("")))a=o.getUpdatedCellRef(e),r.length>1&&(a=r[0]+"!"+a);else if(n=l.match(/[/+\-*^><>=<=<>]+/g)){t=l.split(n[0]);for(var h=0;h<t.length;h++)r=t[h].split("!"),e=r[1]||r[0],o.calculateInstance.isCellReference(e.split("$").join(""))&&(t[h]=o.getUpdatedCellRef(e),r.length>1&&(t[h]=r[0]+"!"+t[h]));a=t.join(n[0])}a&&a!==l&&(i=!0,s[d]=a)}),{isInvalid:i,ref:s.join(":")}},n.prototype.autoCorrectCellRef=function(e){var t,r=e.formula.lastIndexOf(")");if(r>-1&&2===e.formula.split(")").length){for(var n=r-1;n>-1&&"("!==e.formula[n];){if(")"===e.formula[n])return e.formula;n--}if(n>-1){for(var i=e.formula.substring(n+1,r),a=this.calculateInstance.getParseArgumentSeparator(),o=i.split(a),s=void 0,l=0;l<o.length;l++)(t=this.correctCellReference(o[l])).isInvalid&&(s=!0,o[l]=t.ref);s&&(e.formula=e.formula.split(i).join(o.join(a)),e.isInvalid=!0)}}else e.formula.startsWith("=")&&!e.formula.includes(")")&&(t=this.correctCellReference(e.formula.substring(1,e.formula.length))).isInvalid&&(e.formula="="+t.ref,e.isInvalid=!0);return e.formula},n.prototype.getUpdatedCellRef=function(e){var t=e,r=0===(e=e.trim()).indexOf("$"),n=e.search(/[a-zA-Z]/),i=e.search(/\d/);return n=r?n-1:n,(r?i>1:i>0)&&fe(e.substring(i,e.length))?t:e.substring(n,e.length)+e.substring(0,n)},n.prototype.initiateDefinedNames=function(){for(var e=this.parent.definedNames,t=0;t<e.length;){var r=e[t],n=this.parseSheetRef(r.refersTo),i=C(n),a=!1,o=n.indexOf("http:")>-1||n.indexOf("https:")>-1;if(i=i.split("$").join(""),(i=i.split("=").join("")).indexOf(":")>-1){var s=i.split(":");(O(s[0])&&O(s[1])||s[0].match(/[0-9]/)&&s[1].match(/[0-9]/)||s[0].toUpperCase().match(/[A-Z]/)&&s[1].toUpperCase().match(/[A-Z]/))&&(a=!0)}else i.indexOf(":")<0&&O(i)&&(a=!0);o&&(a=!1),a?this.addDefinedName(r,!0,void 0,!0):(this.removeDefinedName(r.name,r.scope,!0),t--),t++}},n.prototype.addDefinedName=function(e,t,r,n){(void 0===r||r<-1)&&(r=this.parent.definedNames.length);var i,a=!0,o=e.name;if(e.refersTo.indexOf("!")<0){var s=Le(this.parent);s=-1!==s.indexOf(" ")?"'"+s+"'":s,e.refersTo=s+"!"+(e.refersTo.indexOf("=")<0?e.refersTo:e.refersTo.split("=")[1])}var l=e.refersTo,d=this.parseSheetRef(e.refersTo);e.scope?(i=Se(this.parent,e.scope))>-1&&(o=Le(this.parent,i)+"!"+o):e.scope="Workbook",e.comment||(e.comment=""),!t&&this.checkIsNameExist(e.name,e.scope)?a=!1:(this.calculateInstance.addNamedRange(o,"="===d[0]?d.substr(1):d),"="!==d[0]&&(e.refersTo="="+l),this.parent.definedNames.indexOf(e)<0&&(this.parent.definedNames.splice(r,0,e),this.parent.notify("formulaBarOperation",{action:"setNameBoxValue",definedName:e})));var h={name:e.name,scope:e.scope,comment:e.comment,refersTo:e.refersTo,cancel:!1};return n||this.parent.notify("actionComplete",{eventArgs:h,action:"addDefinedName"}),a},n.prototype.removeDefinedName=function(e,t,r){var n=!1,i=t||"Workbook",a=this.getIndexFromNameColl(e,i);if(a>-1){var o=e;if(t){var s=Se(this.parent,t);s>-1&&(o=Le(this.parent,s)+"!"+e)}this.calculateInstance.removeNamedRange(o);var l=this.parent.definedNames.splice(a,1);if(this.parent.notify("formulaBarOperation",{action:"setNameBoxValue",definedName:l[0],isRemove:!0}),!r){var d={name:e,scope:i,cancel:!1};this.parent.notify("actionComplete",{eventArgs:d,action:"removeDefinedName"})}n=!0}return n},n.prototype.checkIsNameExist=function(e,t){return this.parent.definedNames.some(function(r){return r.name===e&&(t?r.scope===t:""===r.scope)})},n.prototype.getIndexFromNameColl=function(e,t){void 0===t&&(t="");var r=-1;return this.parent.definedNames.filter(function(n,i){n.name===e&&n.scope===t&&(r=i)}),r},n.prototype.calculateNow=function(e){var t=this,n=new r.Deferred;e.promise=n.promise;var i,a=function(){var r,a,o,s,l={isRefreshing:!0,action:"calculate"},d=t.calculateInstance.getFormulaInfoTable();e.sheets.forEach(function(e){o=e.id.toString(),r=t.calculateInstance.getSheetFamilyItem(o),a=r.isSheetMember?r.parentObjectToToken.get(o):"",t.parent.setSheetPropertyOnMute(e,"isSheetCalculated",!0),l.sheet=e,e.rows.forEach(function(e,r){l.rowIndex=r,e&&e.cells&&e.cells.forEach(function(e,n){e&&k(e.formula)&&(s=a+v(n+1)+(r+1),(void 0===e.value||null===e.value||!d.has(s)||i&&i[s])&&(l.colIndex=n,l.value=e.formula,t.calculateFormula(l,s)))})})}),n.resolve(),t.calculateInstance.cell=""},o=e.sheets.length,s=function(){if(!--o){a(),"Automatic"===t.parent.calculationMode&&"CalculateWorkbook"===e.scope&&t.parent.setProperties({calculationMode:"Manual"},!0);var r=t.parent.getActiveSheet();r.conditionalFormats&&r.conditionalFormats.length&&t.parent.notify(Cn,{indexes:[],isAction:!0,refreshAll:!0,isEdit:!0})}},l=function(e){var r=e.id.toString(),n=t.calculateInstance.getSheetFamilyItem(r),a=n.isSheetMember?n.parentObjectToToken.get(r):"";i={};var o=t.calculateInstance.getDependentCells();return function(e,t){var r=a+g(e,t);o.has(r)&&o.get(r).forEach(function(e){i[e]||(i[e]=!0)})}};e.sheets.forEach(function(e){e.ranges.some(function(e){return e.dataSource&&(!e.info||!e.info.loadedRange||!e.info.loadedRange.length)})?t.parent.notify(_r,{sheet:e,autoDetectFormat:!0,loadFromStartCell:!0,updateDependentCellsCallback:l(e),loadComplete:s}):s()})},n.prototype.toFixed=function(e){var t=Number(e);return Math.round(t)!==t&&(e=t.toFixed(2)),e},n.prototype.commputeFormulaValue=function(e){var t=this.parseSheetRef(e.value);e.value=this.calculateInstance.computeExpression(t).toString()},n.prototype.getCellRefValue=function(e){var t,r=this.getSheetInfo(),n=r.length,i=this.calculateInstance.sheetToken,a=e.value,o=a.lastIndexOf(i);if(-1!==o){var s=a.substring(0,o);s.length>0&&s[0]===this.calculateInstance.getFormulaCharacter()&&(s=s.substring(1,e.value.length));for(var l=0;l<n;l++)if(s.toUpperCase()===r[l].visibleName.toUpperCase()){t=l;break}e.value=this.calculateInstance.getValueFromArg(i+t+i+a.substring(o+1).toUpperCase())}else a.length>0&&a[0]===this.calculateInstance.getFormulaCharacter()&&(e.value=this.calculateInstance.getValueFromArg(a.substring(1,e.value.length).toUpperCase()))},n.prototype.aggregateComputation=function(e){var t=this.parent.getActiveSheet(),r=Fe(t),n=c(r.split(":")[1]);n[0]+1===t.rowCount&&n[1]+1===t.colCount&&(r="A1:"+g(t.usedRange.rowIndex,t.usedRange.colIndex));var i,a,o=this.calculateInstance.getCellCollection(r);for(a=0;a<o.length;a++)if(i=this.calculateInstance.getValueFromArg(o[a]),fe(i)){e.countOnly=!1;break}if(e.Count=this.calculateInstance.getFunction("COUNTA")(r,"isAggregate"),e.Count&&!e.countOnly){var s=["SUM","AVERAGE","MIN","MAX"],l=[],d=c(t.activeCell),h=He(d[0],d[1],t,!1,!0);for(a=0;a<4;a++){if(i=this.toFixed(this.calculateInstance.getFunction(s[a])(r,"isAggregate")),h.format){var p={formattedText:i,value:i,format:h.format,cell:{value:i,format:h.format}};this.parent.notify(Wr,p),i=p.formattedText}l.push(i)}e.Sum=l[0],e.Avg=l[1],e.Min=l[2],e.Max=l[3]}},n.prototype.refreshInsertDelete=function(e){var t=this;if("Sheet"!==e.modelType){var r,n=this.calculateInstance.getDependentFormulaCells(),i=we(this.parent,e.sheet.id);this.parent.sheets.forEach(function(n,a){for(var o=0,s=n.usedRange.rowIndex;o<=s;o++)for(var l=0,d=n.usedRange.colIndex;l<=d;l++)(r=He(o,l,n,!1,!0)).formula&&k(r.formula)&&(a===i?!e.isInsert&&("Row"===e.modelType?o>=e.startIndex&&o<=e.endIndex:l>=e.startIndex&&l<=e.endIndex)||t.updateFormula(e,r,o,l,i):r.formula.includes(e.sheet.name)&&t.updateFormula(e,r,o,l,i,!0,n))}),n.clear(),this.calculateInstance.getDependentCells().clear(),this.calculateInstance.getFormulaInfoTable().clear(),this.refreshNamedRange(e)}},n.prototype.getUpdatedFormulaOnInsertDelete=function(e){if(e.sheetNames){e.updateSheetRef||(e.updateSheetRef=this.getSheetRefUpdateOnDelete());var t=this.parseSheetRef(e.cell.formula,!1),r=t;e.sheetNames.forEach(function(t){r=e.updateSheetRef(t,r).value}),r!==t&&(e.cell.formula=r)}else this.updateFormula(e.insertDeleteArgs,e.cell,e.row,e.col,e.sheetIdx,e.otherSheet,e.formulaSheet)},n.prototype.updateFormula=function(r,n,i,a,o,s,l){var d,h,p,u,f,g,y=new RegExp(/^(?=.*[a-zA-Z])(?=.*\d)/g);n.formula&&n.formula.includes("UNIQUE")&&void 0!==i&&this.clearUniqueRange(i,a,l||r.sheet);for(var C,b,x,S=this.parseFormulaArgument({formula:this.parseSheetRef(n.formula,!0),rangeRef:!0}),I=this.getSheetInfo(),E=!n.formula.includes(this.parent.listSeparator),R=0;R<S.length;R++)if(d=S[R].trim(),(x=d.includes("$"))&&(d=d.replace(/[$]/g,"")),f=!0,this.calculateInstance.isCellReference(d)){if(u=d.includes(":"),(h=R&&S[R-1].trim())&&"!"===h[h.length-1]){if(h=h.replace(/['!]/g,""),C=I[o].sheet===I[o].visibleName?r.sheet.name:"`"+I[o].sheet+"`",h!==C)continue}else if(s)continue;!y.test(d)&&d.indexOf(":")>-1&&(f=!1,g=!!t.isNullOrUndefined(d.match(/[0-9]/))),p=w(c(d)),this.parent.updateRangeOnInsertDelete(r,p,u,i,a,x,E)&&(S[R]=p[2]<p[0]||p[3]<p[1]?this.calculateInstance.getErrorStrings()[e.CommonErrors.Ref]:f?function(){var e=(x?"$":"")+v(p[1]+1)+(x?"$":"")+(p[0]+1);return p[0]===p[2]&&p[1]===p[3]||(e+=":"+(x?"$":"")+v(p[3]+1)+(x?"$":"")+(p[2]+1)),e}():g?m(p).replace(/\d/g,""):m(p).replace(/[a-zA-Z]/g,""),b=!0)}var N="="+S.join("");if(b){var F,A=RegExp;I.forEach(function(e){N.includes("`"+e.sheet+"`")&&(F=new A("`"+e.sheet+"`","gi"),N=N.replace(F,e.visibleName))}),n.formula!==N&&(n.formula=N,"Manual"===this.parent.calculationMode&&(r.isInsert||r.isDelete)||(n.value=null))}},n.prototype.clearUniqueRange=function(e,t,r){var n={cellIdx:[e,t,e,t],isUnique:!1,uniqueRange:"",sheetName:r.name};this.parent.notify(en,n);for(var i=c(n.uniqueRange),a=i[0];a<=i[2];a++)for(var o=i[1];o<=i[3];o++)delete He(a,o,r,!1,!0).value},n.prototype.clearAllUniqueFormulaValue=function(){for(var e,t,r,n=this.calculateInstance.uniqueRange,i=0;i<n.length;i++){var a=n[i].lastIndexOf("!");if(t=Ae(this.parent,Se(this.parent,n[i].substring(0,a))),r=c(n[i].substring(a+1)),!(e=He(r[0],r[1],t))||"#SPILL!"!==e.value)for(var o=r[0];o<=r[2];o++)for(var s=r[1];s<=r[3];s++)(e=He(o,s,t))&&e.value&&delete e.value}},n.prototype.parseFormulaArgument=function(e){for(var t,r,n=0,i=[],a=this.markSpecialChar(e.formula.replace("=",""),e.rangeRef),o=RegExp,s=new o(e.rangeRef?/\(|\)|=|\^|>|<|\+|-|\*|\/|%|&/g:/\(|\)|=|\^|>|<|:|\+|-|\*|\/|%|&/g),l=new o(this.parent.listSeparator,"g"),d=(a=a.split(new o(s.source+"|"+l.source,"g"))).length;n<d;)(t=a[n])?(1===t.length?i.push(this.isUniqueChar(t)?this.getUniqueCharVal(t):t):(r=t[0],t.indexOf("!")>0?(this.isUniqueChar(r)&&(i.push(this.getUniqueCharVal(r)),t=t.substr(1)),r=t.indexOf("!")+1,i.push(t.substring(0,r)),(r=(t=t.substring(r)).indexOf(":"))>-1&&t.indexOf("!")>r?(i.push(t.substring(0,r)),i.push(":"),r=(t=t.substring(r+1)).indexOf("!")+1,i.push(t.substring(0,r)),i.push(t.substring(r))):i.push(t)):this.isUniqueChar(r)?(i.push(this.getUniqueCharVal(r)),i.push(t.substr(1))):i.push(t)),n++):n++;return e.formulaArr=i,i},n.prototype.getUniqueCharVal=function(e){switch(e){case this.uniqueOBracket:return"(";case this.uniqueCBracket:return")";case this.uniqueCSeparator:return this.parent.listSeparator;case this.uniqueCOperator:return":";case this.uniquePOperator:return"+";case this.uniqueSOperator:return"-";case this.uniqueMOperator:return"*";case this.uniqueDOperator:return"/";case this.uniqueModOperator:return"%";case this.uniqueConcateOperator:return"&";case this.uniqueEqualOperator:return"=";case this.uniqueExpOperator:return"^";case this.uniqueGTOperator:return">";case this.uniqueLTOperator:return"<"}return""},n.prototype.isUniqueChar=function(e){var t=e.charCodeAt(e);return t>=129&&t<=142},n.prototype.markSpecialChar=function(e,t){e=e.replace(/\(/g,"("+this.uniqueOBracket).replace(/\)/g,")"+this.uniqueCBracket);var r=RegExp;return e=t?e.replace(new r(this.parent.listSeparator,"g"),this.parent.listSeparator+this.uniqueCSeparator):e.replace(new r(this.parent.listSeparator,"g"),this.parent.listSeparator+this.uniqueCSeparator).replace(/:/g,":"+this.uniqueCOperator),e=e.replace(/\+/g,"+"+this.uniquePOperator).replace(/-/g,"-"+this.uniqueSOperator),e=e.replace(/\*/g,"*"+this.uniqueMOperator).replace(/\//g,"/"+this.uniqueDOperator),e=e.replace(/&/g,"&"+this.uniqueConcateOperator),e=e.replace(/=/g,"="+this.uniqueEqualOperator),e=e.replace(/\^/g,"^"+this.uniqueExpOperator),(e=e.replace(/>/g,">"+this.uniqueGTOperator).replace(/</g,"<"+this.uniqueLTOperator)).replace(/%/g,"%"+this.uniqueModOperator)},n.prototype.refreshNamedRange=function(e){var r=this;if(e.definedNames&&e.definedNames.length)return void e.definedNames.forEach(function(e){r.parent.removeDefinedName(e.name,e.scope),r.parent.addDefinedName(e)});var n=this.parent.definedNames.length;if(n)for(var i,a,o,s,l,d,h,p,u,f=Object.assign({},this.parent.definedNames),g=new RegExp(/^(?=.*[a-zA-Z])(?=.*\d)/g),v=0;v<n;v++){p=!0;var y=(s=f[v]).refersTo.lastIndexOf("!");o=s.refersTo.substring(y+1),(d=a=s.refersTo.substring(1,y)).match(/'/g)&&(d=d.slice(1,-1)),d===e.sheet.name&&(!g.test(o)&&o.indexOf(":")>-1&&(p=!1,u=!!t.isNullOrUndefined(o.match(/[0-9]/))),i=c(o),l=this.parent.updateRangeOnInsertDelete(e,i),h=p?m(i):u?m(i).replace(/\d/g,""):m(i).replace(/[a-zA-Z]/g,""),e.isInsert?this.updateDefinedNames(s,a,h,l):"Row"===e.modelType?this.updateDefinedNames(s,a,h,l,[i[0],i[2]],e):"Column"===e.modelType&&this.updateDefinedNames(s,a,h,l,[i[1],i[3]],e))}},n.prototype.updateDefinedNames=function(e,t,r,n,i,a){if(n){var o=this.parent.definedNames.indexOf(e),s={action:"removeDefinedName",isRemoved:!1,definedName:e.name,scope:e.scope,isEventTrigger:!0};if(this.parent.notify(Kr,s),i){var l={name:e.name,comment:e.comment,refersTo:e.refersTo,scope:e.scope};if(l=new Nr(this.parent,"definedNames",l,!0),a.definedNames?a.definedNames.push(l):a.definedNames=[l],i[1]<i[0])return}e.refersTo=t+"!"+r,this.parent.notify(Kr,{action:"addDefinedName",definedName:e,isAdded:!1,index:o,isEventTrigger:!0});var d={name:e.name,scope:e.scope,comment:e.comment,refersTo:e.refersTo,cancel:!1};this.parent.notify("actionComplete",{eventArgs:d,action:"refreshNamedRange"})}},n}(),Qi=function(){function e(e){this.parent=e,this.localeObj=t.getNumericObject(this.parent.locale);var r=t.IntlBase.getDependables(t.cldrData,this.parent.locale,null).dateObject;r.dayPeriods&&r.dayPeriods&&r.dayPeriods.format&&r.dayPeriods.format.wide?(this.localeObj.am=r.dayPeriods.format.wide.am||"AM",this.localeObj.pm=r.dayPeriods.format.wide.pm||"PM"):(this.localeObj.am="AM",this.localeObj.pm="PM"),this.updateLocalizedFormats(r),this.addEventListener()}return e.prototype.numberFormatting=function(e){var r=this.parent.activeSheetIndex,n=!0;e.range&&e.range.indexOf("!")>-1&&(n=(r=Se(this.parent,e.range.substring(0,e.range.lastIndexOf("!"))))===this.parent.activeSheetIndex);var i=Ae(this.parent,r),a=w(c(e.range?e.range.lastIndexOf("!")>-1?e.range.substring(e.range.lastIndexOf("!")+1):e.range:i.selectedRange));e.curSym=t.getNumberDependable(this.parent.locale,t.defaultCurrencyCode);for(var o,s,l,d,h,p=a[0];p<=a[2];p++){d=Qe(i,p),h=n&&!tt(i,p);for(var u=a[1];u<=a[3];u++)l=(s=He(p,u,i,!1,!0)).format,ae(s,i.columns[u],d)||Y(this.parent,i,{cell:{format:e.format},rowIdx:p,colIdx:u})||((s=He(p,u,i)).rowSpan<0||s.colSpan<0||(o={value:s.value,format:s.format,rowIndex:p,colIndex:u,sheetIndex:r,cell:s,refresh:n,curSymbol:e.curSym},this.getFormattedCell(o),h&&(this.setCell(o),o.td&&(this.parent.notify("refreshCellElem",o),!s.wrap||d&&d.customHeight||l===e.format||this.parent.notify(an,{range:[p,u,p,u],wrap:!0,sheet:i,initial:!0,td:o.td,isOtherAction:!0})),l&&l!==e.format&&l.includes("[")&&-1===["Black","Blue","Cyan","Green","Magenta","Red","White","Yellow"].indexOf(je(e.format))&&this.removeFormatColor(o,{format:l,style:s.style}))),this.parent.setUsedRange(p,u))}i.conditionalFormats&&i.conditionalFormats.length&&this.parent.notify(Cn,{indexes:a,isAction:!0,isEdit:!0}),this.parent.chartColl&&this.parent.chartColl.length&&this.parent.notify("refreshChart",{range:a})},e.prototype.isDigitPlaceHolder=function(e){return"#"===e||"0"===e||"?"===e||"."===e},e.prototype.parseToLocalizedFormat=function(e){if(e.decimalGroupSepsChanged&&(e.format.includes(".")||e.format.includes(","))){for(var t,r=void 0,n=void 0,i=e.format.split(""),a=0;a<i.length;a++)'"'===(r=i[a])?(n=e.format.indexOf('"',a+1))>-1&&(a=n):"_"===r||"*"===r||"\\"===r?a++:"["===r?(n=e.format.indexOf("]",a+1))>-1&&(a=n):","===r?this.isDigitPlaceHolder(i[a-1])&&(i[a]=this.localeObj.group):"."===r&&(i[a-1]?(t=i[a-1].toLowerCase(),["d","m","y","h"].some(function(e){return t===e})||(i[a]=this.localeObj.decimal)):i[a]=this.localeObj.decimal);e.format=i.join("")}e.curChanged&&e.format.includes('"'+e.curSym+'"')&&(e.format=e.format.split('"'+e.curSym+'"').join(e.curSym))},e.prototype.updateLocalizedFormats=function(e,r){var n,i=this;zi={currency:["$#,##0.00","$#,##0","$#,##0_);($#,##0)","$#,##0_);[Red]($#,##0)","$#,##0.00_);($#,##0.00)","$#,##0.00_);[Red]($#,##0.00)"],accounting:['_($* #,##0_);_($* (#,##0);_($* "-"_);_(@_)','_(* #,##0_);_(* (#,##0);_(* "-"_);_(@_)','_($* #,##0.00_);_($* (#,##0.00);_($* "-"??_);_(@_)','_(* #,##0.00_);_(* (#,##0.00);_(* "-"??_);_(@_)'],time:e.timeFormats&&"HH:mm:ss"===e.timeFormats.medium?"HH:mm:ss":"h:mm:ss AM/PM"};var a=t.getNumberDependable(this.parent.locale,t.defaultCurrencyCode),o={curChanged:"$"!==a,curSym:a,decimalGroupSepsChanged:"."!==this.localeObj.decimal&&","!==this.localeObj.group};if(o.curChanged){var s=new t.Internationalization(this.parent.locale).getNumberPattern({currency:"$",useGrouping:!0,format:"c0"},!0);if(s&&s.endsWith("$")){var l=s[s.indexOf("$")-1].trim().length?"":" ";zi.currency.forEach(function(e,t){if(e.includes("$#,##0")){var r="",n=e.split("$#,##0.")[1];if(n)for(var i=0;"0"===n[i];)r+="0",i++;r&&(r="."+r),zi.currency[t]=e.split("$#,##0"+r).join("#,##0"+r+l+'"'+a+'"')}}),zi.accounting.forEach(function(e,t){if(e.slice(0,e.indexOf("#")).includes("$")){var r,n=e.split(";");n.forEach(function(e,t){e.includes("$")&&(e=e.replace("$",""),(r=e.includes("0)")?e.indexOf("0)")+2:e.lastIndexOf(e.includes("0")?"0":e.includes("?")?"?":e.includes('"-"')?'"':"#")+1)>0&&(n[t]=e.slice(0,r)+l+'"'+a+'"'+e.slice(r)))}),zi.accounting[t]=n.join(";")}})}else{var d=function(e,t,r){return r[t]=e.split("$").join('"'+a+'"')};zi.currency.forEach(d),zi.accounting.forEach(d)}}var h=["General","0","0.00","#,##0","#,##0.00","#,##0_);(#,##0)","#,##0_);[Red](#,##0)","#,##0.00_);(#,##0.00)","#,##0.00_);[Red](#,##0.00)",zi.currency[2],zi.currency[3],zi.currency[4],zi.currency[5],"0%","0.00%","0.00E+00","##0.0E+0","# ?/?","# ??/??","m/d/yyyy","d-mmm-yy","d-mmm","mmm-yy","h:mm AM/PM","h:mm:ss AM/PM","h:mm","h:mm:ss","m/d/yyyy h:mm","mm:ss","mm:ss.0","@","[h]:mm:ss"].concat(zi.accounting);r?(n=this.customFormats).splice.apply(n,[0,h.length].concat(h)):(this.customFormats=h,this.localizedFormats=[]);var p,c=[0,1,2,3,4,37,38,39,40,5,6,7,8,9,10,11,48,12,13,14,15,16,17,18,19,20,21,22,45,47,49,46,42,41,44,43];c.forEach(function(e,t){Vi&&Vi.has(e)&&(i.customFormats[t]=Vi.get(e),(p=[5,6,7,8].indexOf(e))>-1?zi.currency[p+2]=i.customFormats[t]:(p=[42,41,44,43].indexOf(e))>-1&&(zi.accounting[p]=i.customFormats[t])),o.format=i.customFormats[t],i.parseToLocalizedFormat(o),i.localizedFormats[t]=o.format});for(var u,f=this,g=c.length;g<this.localizedFormats.length;g++)!function(e){f.localizedFormats.findIndex(function(t,r){return t===i.localizedFormats[e]&&r<c.length})>-1&&(f.localizedFormats.splice(e,1),f.customFormats.splice(e,1),e--),u=e}(g),g=u},e.prototype.localizedFormatAction=function(e){"getLocalizedFormats"===e.action?(e.defaultFormats=this.customFormats,e.localizedFormats=this.localizedFormats):"mapNumberFormatId"===e.action?this.updateLocalizedFormats(t.IntlBase.getDependables(t.cldrData,this.parent.locale,null).dateObject,!0):(e.curSym=t.getNumberDependable(this.parent.locale,t.defaultCurrencyCode),"parseToDefaultFormat"===e.action?this.parseToDefaultFormat(e):(e.decimalGroupSepsChanged="."!==this.localeObj.decimal&&","!==this.localeObj.group,e.curChanged="$"!==e.curSym,e.defaultFormat||(e.defaultFormat=e.format,this.parseToLocalizedFormat(e)),-1===this.localizedFormats.indexOf(e.format)&&(this.localizedFormats.push(e.format),this.customFormats.push(e.defaultFormat))))},e.prototype.parseToDefaultFormat=function(e){var t=this,r="."!==this.localeObj.decimal&&e.format.includes(this.localeObj.decimal),n=","!==this.localeObj.group&&e.format.includes(this.localeObj.group),i="$"!==e.curSym&&e.format.includes(e.curSym);if(r||n||i){var a,o,s,l=e.format.split(";");l.forEach(function(d,h){for(var p=d.split(""),c=0;c<p.length;c++)'"'===(s=p[c])?c=d.indexOf('"',c+1):"_"===s||"*"===s||"\\"===s?c++:"["===s?(a=d.indexOf("]",c+1))>-1&&(c=a):r&&s===t.localeObj.decimal?(o=p[c-1])?(o=o.toLowerCase(),["d","m","y","h"].some(function(e){return o===e})||(p[c]=".")):p[c]=".":n&&s===t.localeObj.group?t.isDigitPlaceHolder(p[c-1])&&(p[c]=","):i&&(s===e.curSym?p[c]='"'+e.curSym+'"':e.curSym.startsWith(s)&&d.substring(c,c+e.curSym.length)===e.curSym&&p.splice(c,e.curSym.length,'"'+e.curSym+'"'));l[h]=p.join("")}),e.format=l.join(";")}},e.prototype.getFormattedCell=function(e){var r=void 0===e.value||null===e.value?"":e.value;e.sheetIndex=void 0===e.sheetIndex?this.parent.activeSheetIndex:e.sheetIndex;var n=Ae(this.parent,e.sheetIndex),i=e.cell||He(e.rowIndex,e.colIndex,n,!1,!0),a=!1,o=new t.Internationalization;if(e.curSymbol||(e.curSymbol=t.getNumberDependable(this.parent.locale,t.defaultCurrencyCode)),e.format&&"General"!==e.format||e.skipFormatCheck||i.formula&&i.formula.toLowerCase().startsWith("=text("))e.type=$e(e.format),e.skipFormatCheck&&!e.format&&"General"===e.type&&(e.format="General");else if(e.type=e.format="General",!i.formula||i.formula&&-1===i.formula.indexOf("&-")){var s={value:r,updatedVal:r,cell:i,isEdit:e.isEdit,intl:o};this.checkDateFormat(s),(s.isDate||s.isTime)&&(a=!0,i.value=e.value=s.updatedVal,i.format&&"General"!==i.format?(e.format=i.format,e.type=$e(e.format)):i.format=e.format=Ke(s.isDate?"ShortDate":"Time"))}if(i.format&&this.isCustomType(i)){e.type="Custom";var l=i.format.indexOf("@")>-1;""!==r&&!l&&this.isPercentageValue(r.toString(),e,i)&&(r=e.value.toString());var d=void 0,h={};Vi&&re(this.parent)&&(i.format=e.format=this.getMatchingCustomFormat(i.format));var p=i.format;i.format=i.format.split("\\").join("");var c=i.format.split(";");if(qe(c[0],!0,h,!0))""!==r&&(e.result=this.processCustomDateTime(e,i,"time"!==h.type,c),d=!e.formatApplied),e.result=e.result||i.value;else if(c.length>1)i.format.indexOf("<")>-1||i.format.indexOf(">")>-1?e.result=this.processCustomConditions(i,e):(u=F(i,this.parent.locale,this.localeObj.group,this.localeObj.decimal,e.curSymbol)).isNumber?(i.value=u.value,this.processCustomAccounting(i,e,c,c[0]),d=!1):(e.result=this.processCustomText(i,e,c),d=!0),i.format=p;else if(l)d=!0,e.result=this.processCustomText(i,e);else{var u=F({value:r},this.parent.locale,this.localeObj.group,this.localeObj.decimal);if(u.isNumber)if(i.value=e.value=u.value,i.format.includes("E+0")){e.format!==i.format&&(e.format=i.format),this.checkAndSetColor(e);var f=e.format.split("E")[0],g=f.split(".");"."!==this.localeObj.decimal&&1===g.length&&(g=f.split(this.localeObj.decimal)),e.result=g[0].length>1?this.scientificHashFormat(e,g):this.scientificFormat(e)}else e.result=this.processCustomNumberFormat(i,e),d=!fe(i.value);else i.format&&i.format.includes("[")&&this.removeFormatColor(e,{format:i.format,style:i.style}),d=e.dataUpdate=!0}e.dataUpdate?e.formattedText=e.result||(t.isNullOrUndefined(e.value)?"":e.value.toString()):(e.value=e.result,e.formattedText=t.isNullOrUndefined(e.value)?"":e.value.toString()),e.isRightAlign=!d&&!t.isNullOrUndefined(e.value)}else{var m=this.processFormats(e,r,a,i,o,n);e.formattedText=m.fResult||(void 0===e.value||null===e.value?"":e.value.toString()),e.isRightAlign=m.rightAlign}return void 0!==e.rowIndex&&(i.format&&e.formattedText&&e.formattedText!==i.value&&"General"!==i.format?i.formattedText=e.formattedText:i.formattedText&&delete i.formattedText),e.formattedText},e.prototype.isCustomType=function(e){var t=$e(e.format);return"General"===t&&"General"!==e.format||"Time"===t&&this.parent.isEdit},e.prototype.processCustomFill=function(e,t,r,n){var i=e[e.indexOf("*")+1],a=e.split("*"+i);if(void 0===r.rowIndex||r.dataUpdate)n=n||this.processCustomNumberFormat({format:a.join(""),value:t.value},r);else{var o=void 0;if(a[1]){var s=parseFloat(t.value);s<0?(o=this.processCustomNumberFormat({format:a[1],value:Math.abs(s).toString()},r),n="-"+a[0].split("'").join("")):(o=this.processCustomNumberFormat({format:a[1],value:t.value},r),n=a[0].split("'").join("")),0===s&&(o=o.split("0").join(""))}else n=n||this.processCustomNumberFormat({format:a[0],value:t.value},r);r.isRowFill=!0,this.setCell(r),this.parent.notify("rowFillHandler",{cell:t,cellEle:r.td,rowIdx:r.rowIndex,colIdx:r.colIndex,beforeFillText:n,repeatChar:i,afterFillText:o}),n=this.parent.isPrintingProcessing?n+o:n}return n},e.prototype.processCustomDateTime=function(e,r,n,i){var a=this;if("."!==this.localeObj.decimal&&r.value&&r.value.toString().includes(this.localeObj.decimal)){var o=r.value.replace(this.localeObj.decimal,".");fe(o)&&(r.value=e.value=o)}var s;if(fe(r.value)){if(i.length>1&&parseFloat(r.value)<=0&&(e.formatApplied=this.processCustomAccounting(r,e,i),e.formatApplied))return e.result}else if(!(s=function(){var e=r.value.toString();if(e.includes(a.localeObj.dateSeparator)||e.indexOf("-")>0||e.includes(a.localeObj.timeSeparator))return!0;var n=t.IntlBase.getDependables(t.cldrData,a.parent.locale,null).dateObject,i=n.months["stand-alone"]&&n.months["stand-alone"].abbreviated;return i&&!!Object.keys(i).find(function(t){return e.includes(i[""+t])})}()))return this.processCustomText(r,e,i);var l,d=i[0],h=new t.Internationalization,p=function(i){var o,p;if(s){var u=void 0;if(r.format.includes("[h]")){var f=r.value.toString().split(":");f.length>1&&Number(f[0])>=24&&(u=Number(f[0])/24,f[0]="24",r.value=f.join(":"))}if(p=me(r.value,new t.Internationalization,a.parent.locale,d,r),o=p.dateObj&&"Invalid Date"!==p.dateObj.toString()){if(p.dateObj.getFullYear()<1900)return"";var g=ce(p.dateObj,r.value.toString().includes(":"),"time"===p.type);u>=1&&(g+=u,p.dateObj=pe(g)),r.value=g.toString()}}else{if(a.checkAndProcessNegativeValue(e,r.value))return e.formatApplied=!0,e.formattedText;o=(p={dateObj:pe(parseFloat(r.value))}).dateObj&&"Invalid Date"!==p.dateObj.toString()}if(o){i&&n&&(e.dateObj=p.dateObj),e.formatApplied=!0;var m=void 0;return d.startsWith("MM-dd-yyyy ")?(d=d.split(" ").splice(1).join(" "),m=h.formatDate(p.dateObj,{type:"date",skeleton:"yMd"})+(d?" "+h.formatDate(p.dateObj,{type:l,format:d}):"")):(m=h.formatDate(p.dateObj,{type:l,format:d}),(d=d.toLowerCase()).startsWith("[h]")?m=(24*Number(r.value.toString().split(".")[0])+p.dateObj.getHours()).toString()+m.slice(m.indexOf("]")+1):d.startsWith("[m")?m=(1440*Number(r.value.toString().split(".")[0])+60*p.dateObj.getHours()+p.dateObj.getMinutes()).toString()+m.slice(m.indexOf("]")+1):d.startsWith("[s")&&(m=(86400*Number(r.value.toString().split(".")[0])+60*(60*p.dateObj.getHours()+p.dateObj.getMinutes())+p.dateObj.getSeconds()).toString())),c?m.replace(a.localeObj.am,"A").replace(a.localeObj.pm,"P"):m}return""};d=d.split("_(").join(" ").split("_)").join(" "),r.format.indexOf("h")>-1&&(d=d.split("h").join("H"),l="time"),r.format.indexOf("s")>-1&&(l="time");var c=r.format.indexOf("A/P")>-1;if((r.format.indexOf("AM/PM")>-1||c)&&(d=d.split("H").join("h"),d=d.split("A/P").join("AM/PM").split("AM/PM").join("a"),l="time"),r.format.indexOf("d")>-1){l="date";for(var u=d.split(" "),f=void 0,g=void 0,m=void 0,v=void 0,y=0;y<u.length;y++){v=u[y].includes(this.localeObj.dateSeparator)?this.localeObj.dateSeparator:"-",g=u[y].split(v);for(var C=0;C<g.length;C++)(f=(m=g[C]).match(/d/g))&&f.length>2&&(g[C]=m.split("d").join("E"));u[y]=g.join(v)}d=u.join(" ")}if(r.format.indexOf("m")>-1)if(r.format.indexOf("s")>-1||r.format.indexOf("h")>-1)l="time",r.format.includes(" ")&&((u=d.split(" "))[0].includes("d")||u[0].includes("y"))&&(u[0]=u[0].split("m").join("M"),d=u.join(" "));else if(l="date",(d=d.split("m").join("M")).includes("MMMMM")){var b=d;d="MMMM";var x=p()[0];return d=b.split("MMMMM").join("p"),p(e.checkDate).split("p").join(x)}return p(e.checkDate)},e.prototype.processCustomConditions=function(e,t){if(fe(e.value)){for(var r=e.format.split(";"),n=Number(e.value),i=void 0,a=void 0,o=void 0,s=0;s<r.length;s++){if(e.format=r[s],(o=je(e.format))&&(e.format=e.format.split("["+o+"]").join("")),!e.format.includes("[")){e.format=r[s],a=!1;break}var l=(i=e.format.split("[")[1].split("]")[0]).split("<="),d=i.split(">="),h=i.split("<"),p=i.split(">");if(2===l.length&&n<=Number(l[1])||2===d.length&&n>=Number(d[1])||2===h.length&&n<Number(h[1])||2===p.length&&n>Number(p[1])){e.format=r[s].split("["+i+"]").join(""),a=!1;break}a=2===i.split(/<=|>=|<|>/).length}return a?(this.removeFormatColor(t,{format:r.join(""),style:e.style}),this.processCustomFill("*#",e,t,"#####")):this.processCustomNumberFormat(e,t)}return e.value},e.prototype.processCustomAccounting=function(e,t,r,n){var i=parseFloat(e.value);return i<0?r[1].includes("@")||(n=r[1]):0===i&&r[2]&&!r[2].includes("@")&&(n=r[2].includes(t.curSymbol+"0")?r[2].split("0").join("#"):r[2]),!!n&&(t.result=this.processCustomNumberFormat({format:e.format,value:i<0?Math.abs(i).toString():e.value,style:e.style},t,n),!0)},e.prototype.processCustomText=function(e,t,r){var n,i=e.value||e.value?e.value.toString():"";if(r)if(r[3])n=r[3];else{if(!r[1]||!r[1].includes("@"))return i;n=r[1]}else n=e.format;var a=this.processCustomNumberFormat({format:n.split("@").join("#"),value:i.split(i).join("1")},t);return a&&(a=a.split("1").join(i),"."!==this.localeObj.decimal&&fe(a)&&a.includes(".")&&(a=a.replace(".",this.localeObj.decimal))),a},e.prototype.thousandSeparator=function(e,t){for(;e;)t/=1e3,e--;return t},e.prototype.getSeparatorCount=function(e){for(var t=0,r=["#","0"],n=0;n<e.format.length;n++)'"'===e.format[n]&&"\\"!==e.format[n-1]?n=e.format.indexOf('"',n+1):","!==e.format[n]||r.indexOf(e.format[n+1])>-1||t++;return t},e.prototype.processDigits=function(e,t){t=t.split("?").join("0");var r=e.value.toString();if((r=this.getFormattedNumber(t,parseFloat(r)))&&r.includes(this.localeObj.decimal)){var n=r.split(this.localeObj.decimal);r=n[0]+this.localeObj.decimal+n[1].split("0").join("  ")}return r||e.value},e.prototype.processFormatWithSpace=function(e,t,r){var n={cell:t,char:" ",width:0};this.parent.notify("getTextSpace",n);for(var i,a=n.width,o={format:e,formattedText:""},s=0;s<e.length;s++)if("_"===e[s]){n.char=e[s+1],this.parent.notify("getTextSpace",n);var l=n.width;i=Math.round(l/a),e=e.replace(e[s]+e[s+1]," ".repeat(i))}var d=e.length-e.trim().length;if(d>0){if(o.formattedText=this.getFormattedNumber(e.trim(),r)," "===e[0]){for(var h=1,p=1;" "===e[p];)h++,p++;d-=h,o.formattedText=" ".repeat(h)+o.formattedText}o.formattedText+=" ".repeat(d)}else o.formattedText=this.getFormattedNumber(e,r);return o.format=e,o},e.prototype.removeFormatColor=function(e,t){["Black","Blue","Cyan","Green","Magenta","Red","White","Yellow"].indexOf(je(t.format))>-1&&(e.color=t.style&&t.style.color?t.style.color:"",this.applyColor(e))},e.prototype.processCustomNumberFormat=function(e,t,r){if(!e.format)return"";var n=e.value,i=F(e,this.parent.locale,this.localeObj.group,this.localeObj.decimal);if(i.isNumber){var a=void 0,o=void 0;e.value=i.value;var s=parseFloat(e.value.toString()),l=r||e.format;if(e.format.indexOf("[")>-1){var d=je(l);d?(l=l.split("["+d+"]").join(""),t.color=d.toLowerCase(),this.applyColor(t)):this.removeFormatColor(t,e)}(l.indexOf('"')>-1||l.indexOf("\\")>-1)&&(l=this.processText(l),(o=0===s&&!l.includes("#")&&!l.includes("0"))&&(l+="#"));var h=this.getSeparatorCount(e);if(h){a=!0;var p=this.thousandSeparator(h,s);-1===l.indexOf(".")&&(p=Math.round(p)),n=this.getFormattedNumber(l.split(",").join(""),p),0===p&&(n=n.replace("0",""))}if(l.indexOf("?")>-1&&(a=!0,n=this.processDigits(e,l),l=l.split("?").join("")),l.indexOf("_")>-1&&(a=!0,l=(p=this.processFormatWithSpace(l,e,s)).format,n=p.formattedText),n&&l.indexOf("?")>-1&&(n=n.replace("?"," ")),l.indexOf("*")>-1&&(a=!0,n=this.processCustomFill(l,e,t)),"General"===l&&(a=!0,n=s.toString()),a||(n=this.getFormattedNumber(l,s)),o&&n&&(n=n.replace("0","")),"#"===l[0]&&s>=0&&s<1){var c=l.split("#").join("").split(".");if(!c[0].includes("0")){0!==s||!l.includes(".")||c[1]&&c[1].includes("0")||(n=(n=this.getFormattedNumber(l,.1)).replace("1",""));var u=n.split(this.localeObj.decimal);u[0]=u[0].toString().replace(/^0+/,""),n=u.join(this.localeObj.decimal)}}"-0"===n&&(n="0")}return n},e.prototype.processText=function(e){var t=e;return t.indexOf('"')>-1?t=t.split('"').join("'"):t.indexOf("\\")>-1&&(t=t.split("\\").join("")),t},e.prototype.processFormats=function(e,t,r,n,i,a){var o;if(this.parent.isEdit&&"Scientific"===e.type&&!fe(e.value)&&(e.type="General"),""!==t){var s=void 0;switch("General"!==e.type&&"Text"!==e.type&&this.isPercentageValue(t.toString(),e,n)&&(t=e.value.toString()),e.type){case"General":(o={args:e,fResult:t,intl:i,isRightAlign:r,cell:n,rowIdx:Number(e.rowIndex),colIdx:Number(e.colIndex),sheet:a}).fResult.toString().startsWith("\n")||o.fResult.toString().endsWith("\n ")||this.autoDetectGeneralFormat(o),t=o.fResult,r=o.isRightAlign;break;case"Number":(s=F({value:t},this.parent.locale,this.localeObj.group,this.localeObj.decimal,e.curSymbol,!0,!0)).isNumber&&(n.value=e.value=s.value,t=this.applyNumberFormat(e,i),r=!0);break;case"Currency":(s=F({value:t,format:e.format},this.parent.locale,this.localeObj.group,this.localeObj.decimal,e.curSymbol)).isNumber&&(n.value=e.value=s.value,t=this.currencyFormat(e,i,n),r=!0);break;case"Percentage":(s=F({value:t},this.parent.locale,this.localeObj.group,this.localeObj.decimal,e.curSymbol,!0,!0)).isNumber&&(n.value=e.value=s.value,t=this.percentageFormat(e,i),r=!0);break;case"Accounting":t=this.accountingFormat(e,t,i,n),r=e.formatApplied;break;case"ShortDate":r=!!(t=this.checkAndProcessNegativeValue(e,e.value)?e.formattedText:this.shortDateFormat(e,i,n));break;case"LongDate":r=!!(t=this.checkAndProcessNegativeValue(e,e.value)?e.formattedText:this.longDateFormat(e,i));break;case"Time":r=!!(t=this.checkAndProcessNegativeValue(e,e.value)?e.formattedText:this.timeFormat(e,i,n));break;case"Fraction":(s=F({value:t},this.parent.locale,this.localeObj.group,this.localeObj.decimal,null,!0)).isNumber&&(n.value=e.value=s.value,t=this.fractionFormat(e),r=!0);break;case"Scientific":(s=F({value:t},this.parent.locale,this.localeObj.group,this.localeObj.decimal)).isNumber&&(n.value=e.value=s.value,t=this.scientificFormat(e),r=!0);break;case"Text":"."!==this.localeObj.decimal&&fe(t)&&t.toString().includes(".")&&(t=t.toString().replace(".",this.localeObj.decimal)),r=!1}}return{fResult:t,rightAlign:r}},e.prototype.autoDetectGeneralFormat=function(e){var r,n=e.fResult,i=e.args.cell&&e.args.cell.formula&&e.args.cell.formula.indexOf("ADDRESS(")>0,a=e.args.cell&&e.args.cell.formula&&e.args.cell.formula.indexOf("DOLLAR(")>0,o=e.args.cell&&e.args.cell.formula&&e.args.cell.formula.indexOf("TEXT(")>0;if(!(a&&e.fResult&&e.fResult.toString().includes(e.args.curSymbol)||o)){if(e.fResult&&"."!==this.localeObj.decimal&&(r=s=e.fResult.toString(),s.includes(this.localeObj.decimal)&&fe(s=s.replace(this.localeObj.decimal,"."))&&(s.includes("E")?e.fResult=s:(e.fResult=e.args.value=s=Number(s).toString(),Ue(e.rowIdx,e.colIdx,e.sheet,{value:s},!0)),r=s.replace(".",this.localeObj.decimal))),fe(e.fResult)){var s=Number(e.fResult).toString();if(e.fResult.toString().includes("E")?(e.args.format=Ke("Scientific"),Ue(e.rowIdx,e.colIdx,e.sheet,{value:s,format:e.args.format},!0),e.args.value=s,e.fResult=this.scientificFormat(e.args)):e.args.format&&(e.args.format.indexOf("%")>-1?e.fResult=this.percentageFormat(e.args,e.intl):e.args.format.indexOf(e.args.curSymbol)>-1?e.fResult=this.currencyFormat(e.args,e.intl,e.args.cell):e.fResult=this.applyNumberFormat(e.args,e.intl)),"General"===e.args.format){if(e.args.cell&&e.args.cell.formula&&s.includes(".")&&s.length>11){var l=s.indexOf(".")+1;r=null,e.args.cell.formula.includes("RANDBETWEEN")&&(e.fResult=s=l<7?s:parseFloat(s).toFixed(0))}e.cellVal=s,e.prevVal=r,this.parseDecimalNumber(e),t.isNullOrUndefined(e.fResult)&&!t.isNullOrUndefined(e.cellVal)&&(e.fResult=e.cellVal)}e.isRightAlign=!0}e.fResult&&this.updateAutoDetectNumberFormat(e),i&&(e.isRightAlign=!1,e.fResult=n)}},e.prototype.parseDecimalNumber=function(e){var t=e.cellVal.split(".");if(t[0].length>11)e.cellVal=Math.abs(Number(t[0])).toString().substring(0,6).replace(/0+$/,""),(i=e.cellVal.length-1)>-1&&(e.fResult=this.scientificFormat(e.args,i>5?5:i));else if(t[1])if(e.cellVal.length>11){var r=10-(t[0].length-(Math.sign(Number(e.cellVal))<0?1:0));e.fResult=Number(Number(e.cellVal).toFixed(r>0?r:0)).toString()}else if(e.cellVal.includes("e-")){var n=e.cellVal.split("e-"),i=Number(n[1])+(n[0].includes(".")?n[0].split(".")[1].length:0);n[0]=n[0].replace(".",this.localeObj.decimal),1===n[1].length&&(n[1]="0"+n[1]),e.args.updateValue||Ue(e.rowIdx,e.colIdx,e.sheet,{value:Number(e.cellVal).toFixed(i)},!0),e.fResult=n.join("E-")}else e.prevVal?e.fResult=e.prevVal:e.args.updateValue&&"."!==this.localeObj.decimal&&(e.fResult=e.cellVal.replace(".",this.localeObj.decimal))},e.prototype.updateAutoDetectNumberFormat=function(e){var t=e.fResult.toString(),r=e.args.cell||e.cell;if(this.isPercentageValue(t,e.args,r))r.format=t.includes(this.localeObj.decimal)?Ke("Percentage"):"0%",e.args.updateValue||(e.args.format=r.format,e.fResult=this.percentageFormat(e.args,e.intl),e.isRightAlign=!0);else{var n=t?t.toString().split("/"):[],i=this.parent.isEdit&&"Scientific"===$e(r.format)&&2===n.length&&fe(n[0])&&fe(n[1]);if(t.includes(" ")||i){var a=i?n:t.split(" ");if(i||a[1].includes("/")&&fe(a[0])&&Number(a[0])%1==0){var o=i?n:a[1].split("/");if(fe(o[0])&&Number(o[0])%1==0&&fe(o[1])&&Number(o[1])%1==0)return r.format="# "+(o[0].length>1||o[1].length>1?"??/??":"?/?"),r.value=i?(Number(o[0])/Number(o[1])).toString():(Number(a[0])+Number(o[0])/Number(o[1])).toString(),void(e.args.updateValue||(e.args.value=r.value,e.args.format=r.format,e.fResult=this.fractionFormat(e.args),e.isRightAlign=!0))}}var s="";t.includes(e.args.curSymbol)&&(s=t.includes(this.localeObj.decimal)?zi.currency[0]:zi.currency[1],t=t.replace(e.args.curSymbol,"")),("."===this.localeObj.decimal||e.args.isEdit&&!r.formula)&&t.includes(this.localeObj.group)&&A(t,this.parent.locale,this.localeObj.group,this.localeObj.decimal)&&(t=t.split(this.localeObj.group).join(""),s||(s=t.includes(this.localeObj.decimal)?"#,##0.00":"#,##0")),s?fe(t=t.replace(this.localeObj.decimal,"."))&&(e.args.value=Number(t).toString(),e.args.updateValue?(e.args.cell.value=e.args.value,e.args.cell.format=s):(e.args.format=s,Ue(e.rowIdx,e.colIdx,e.sheet,{value:e.args.value,format:s},!0),s.includes('"')&&(s=this.processText(s)),e.fResult=this.getFormattedNumber(s,Number(e.args.value)),e.isRightAlign=!0)):"."!==this.localeObj.decimal&&"General"===e.args.format&&fe(t)&&t.includes(".")&&(e.fResult=Number(t).toString().replace(".",this.localeObj.decimal))}},e.prototype.isPercentageValue=function(e,t,r){if(e.includes("%")){var n=e.split("%");if(""!==n[0]&&""===n[1].trim()){var i=F({value:n[0]},this.parent.locale,this.localeObj.group,this.localeObj.decimal);if(i.isNumber)return t.value=Number(i.value)/100,r.value=t.value.toString(),!0}}return!1},e.prototype.findSuffix=function(e,t){var r=e.length-t.length;return e.substr(0,r<0?0:r)+t},e.prototype.applyNumberFormat=function(e,r){e.format=this.isCustomFormat(e.format);var n=e.format.split(";");if(Number(e.value)>0)e.format=n[0];else if(0===Number(e.value)){if(e.format=n[2]?n[2]:n[0],e.format.indexOf('"')>-1&&-1===e.format.indexOf("#"))return e.format=e.format.split("_").join(" ").split("*").join(" ").split("?").join(" ").split('"').join(""),e.format}else if(Number(e.value)<0)e.format=t.isNullOrUndefined(n[1])?n[0]:n[1].split("*").join(" "),e.format.indexOf("-")>-1&&(e.value=e.value.toString().split("-").join(""));else if(e.format=n[3]?n[3]:n[0],e.format=e.format.split("_").join(" ").split("*").join(" ").split("?").join(" "),e.format.indexOf("@")>-1)return e.format.split("@").join(e.value.toString());if(e.format=e.format.split("_").join(" ").split("*").join(" ").split('"').join(""),e.format.indexOf("?")>-1&&e.format.indexOf(this.localeObj.decimal)>-1){var i=e.format.split(this.localeObj.decimal)[1].length,a="";Number(e.value)%1&&(a=i>e.value.toString().split(".")[1].length?" ":"0"),e.format=e.format.split("?").join(a)}else e.format=e.format.split("?").join(" ");return Number(e.value)<0&&e.cell&&e.cell.format&&(e.format=e.cell.format),r.formatNumber(Number(e.value),{format:e.format})},e.prototype.isCustomFormat=function(e){return'_-* #,##0.00_-;-* #,##0.00_-;_-* "-"_-;_-@_-'!==e&&'_-* #,##0_-;-* #,##0_-;_-* "-"_-;_-@_-'!==e||(e=""),e=""===e?Ke("Number"):e,e=e.toString().split("_)").join(" ").split("_(").join(" ").split("[Red]").join("")},e.prototype.currencyFormat=function(e,r,n){e.format=e.format||Ke("Currency"),e.format=e.format.split("_(").join(" ").split("_)").join(" ");var i=e.format.split(";"),a=je(e.format),o=Number(e.value);return o>=0||t.isNullOrUndefined(i[1])?(a&&(e.color=n.style&&n.style.color?n.style.color:"",this.applyColor(e)),e.format=i[0]):(o=Math.abs(o),e.format=i[1].split("["+a+"]").join("").split("*").join(" "),a&&(e.color=a.toLowerCase(),this.applyColor(e))),e.format=this.getFormatForOtherCurrency(e.format),e.format.includes('"')&&(e.format=this.processText(e.format)),r.formatNumber(o,{format:e.format,currency:t.defaultCurrencyCode})},e.prototype.applyColor=function(e){e.refresh&&(this.setCell(e),e.td&&e.td.style.color!==e.color&&this.parent.notify(Xr,{style:{color:e.color},rowIdx:e.rowIndex,colIdx:e.colIndex,td:e.td}))},e.prototype.setCell=function(e){if(!e.td){var t={sheet:Ae(this.parent,e.sheetIndex),cell:e.cell,rowIdx:e.rowIndex,colIdx:e.colIndex};(e.cell.rowSpan>1||e.cell.colSpan>1)&&te(t),e.td=this.parent.getCell(t.rowIdx,t.colIdx)}},e.prototype.percentageFormat=function(e,t){return e.format=""===e.format?Ke("Percentage"):e.format,t.formatNumber(Number(e.value),{format:e.format})},e.prototype.accountingFormat=function(e,r,n,i){e.format=e.format||Ke("Accounting"),e.format=e.format.split("_(").join(" ").split("_)").join(" ").split("[Red]").join("").split("_").join("");var a=e.format.split(";"),o=F({value:r},this.parent.locale,this.localeObj.group,this.localeObj.decimal,e.curSymbol,!1,!0);if(o.isNumber){i.value=e.value=o.value;var s=Number(e.value);if(s>=0?e.format=0===s&&a[2]?a[2]:a[0]:(e.format=a[1].split("*").join(" "),s=Math.abs(s)),e.format.includes(e.curSymbol)&&e.format.includes('"')&&(e.format=this.processText(e.format)),e.format=this.getFormatForOtherCurrency(e.format),e.formatApplied=!0,0===s){if(e.format=this.processText(e.format.split("*").join(" ").split("?").join(" ")),!e.format.includes("#")&&!e.format.includes("0")){e.format+="#";var l=n.formatNumber(s,{format:e.format,currency:t.defaultCurrencyCode});return l.includes("0")&&(l=l.replace("0","")),e.dataUpdate?l.split(" ").join(""):l}d=n.formatNumber(s,{format:e.format,currency:t.defaultCurrencyCode});return e.dataUpdate?d.split(" ").join(""):d}var d=n.formatNumber(s,{format:e.format,currency:t.defaultCurrencyCode});return e.dataUpdate?d.split(" ").join(""):d}return a[3]?this.processCustomText(i,e,a):r},e.prototype.getFormatForOtherCurrency=function(e){if(e.indexOf("[$")>-1){var t=e.split("]")[0].split("[$")[1].split("-")[0];e=e.indexOf("0")>e.indexOf("[$")?t+e.slice(e.indexOf("]")+1,e.length):e.slice(0,e.indexOf("[$"))+t}return e},e.prototype.checkAndProcessNegativeValue=function(e,t){if(t&&fe(t)&&Number(t)<0){if(void 0===e.rowIndex||e.dataUpdate)return e.formattedText="#".repeat(e.dataUpdate?7:10),!0;e.isRowFill=!0,this.setCell(e);var r={cell:e.cell,cellEle:e.td,rowIdx:e.rowIndex,colIdx:e.colIndex,repeatChar:"#"};return this.parent.notify("rowFillHandler",r),e.formattedText=r.formattedText,!0}return!1},e.prototype.shortDateFormat=function(e,t,r){var n;Vi&&re(this.parent)&&r&&"m/d/yyyy"===r.format&&Vi.has(14)&&(r.format=e.format=Vi.get(14));var i;""===e.format||"General"===e.format||"mm-dd-yyyy"===e.format||"m/d/yyyy"===e.format?(i="MM-dd-yyyy",n={type:"date",skeleton:"yMd"}):(i=e.format,n=e.format===Ke("ShortDate")?{type:"date",skeleton:"yMd"}:{type:"date",format:e.format});var a;e.value=e.value.toString();var o=this.checkForDateFormat(e,r);if(e.value&&r&&(!fe(e.value)||o)){var s={value:e.value,updatedVal:e.value,cell:r,isEdit:e.isEdit,intl:t,skipCellFormat:!0,format:i};if(this.checkDateFormat(s),s.isDate||s.isTime)r.value=e.value=s.updatedVal,a=s.dateObj;else{if(!o)return"";a=pe(e.value)}}else a=pe(e.value);return a&&"Invalid Date"!==a.toString()?a.getFullYear()<1900||a.getFullYear()>9999?fe(e.value)?e.value.toString():"":(e.checkDate&&(e.dateObj=a),t.formatDate(a,n)):""},e.prototype.longDateFormat=function(e,t){e.value=e.value.toString();var r,n=this.checkForDateFormat(e,e.cell);if(!(e.value.includes(this.localeObj.dateSeparator)||e.value.indexOf("-")>0)||fe(e.value)&&!n)r=pe(e.value);else if(n){var i={value:e.value,updatedVal:e.value,cell:e.cell,isEdit:e.isEdit,intl:t};this.checkDateFormat(i),i.isDate||i.isTime?(r=i.dateObj,e.cell.value=e.value=ce(r).toString()):r=pe(e.value)}else{if(!((r=me(e.value,t,this.parent.locale,"",e.cell).dateObj)&&"Invalid Date"!==r.toString()&&r.getFullYear()>=1900))return fe(e.value)?e.value:"";e.cell.value=e.value=ce(r).toString()}return r&&"Invalid Date"!==r.toString()?r.getFullYear()<1900||r.getFullYear()>9999?fe(e.value)?e.value.toString():"":(e.checkDate&&(e.dateObj=r),t.formatDate(r,{type:"date",skeleton:"full"})):""},e.prototype.checkForDateFormat=function(e,t){var r,n=e.value;if("."===this.localeObj.decimal||e.isEdit&&!t.formula){if(n.includes(this.localeObj.group)&&A(n,this.parent.locale,this.localeObj.group,this.localeObj.decimal))return n=n.replace(this.localeObj.group,""),"."!==this.localeObj.decimal&&n.includes(this.localeObj.decimal)&&(n=n.replace(this.localeObj.decimal,".")),fe(n)&&t&&(t.value=e.value=n),!1;r="."===this.localeObj.dateSeparator&&n.includes("."),"."!==this.localeObj.decimal&&!fe(n)&&n.includes(this.localeObj.decimal)&&fe(n=n.replace(this.localeObj.decimal,"."))&&t&&(t.value=e.value=n)}return r},e.prototype.timeFormat=function(e,r,n){if(t.isNullOrUndefined(e.value))return"";var i,a=Ke("Time");""!==e.format&&"General"!==e.format||(i=a),i="h:mm:ss AM/PM"===e.format?"h:mm:ss a":e.format;var o=e.value.toString();if(!fe(o)&&n){var s={value:o,updatedVal:o,cell:n,isEdit:e.isEdit,intl:r,skipCellFormat:!0};if(this.checkDateFormat(s),!s.isDate&&!s.isTime)return"";n.value=o=s.updatedVal}var l=o.split(".");return t.isNullOrUndefined(l[1])||(o=parseFloat(l[0]+1+"."+l[1])||o),r.formatDate(pe(o),{type:"time",skeleton:"medium",format:i})},e.prototype.scientificHashFormat=function(e,t){var r,n=this.findDecimalPlaces(e.format),i=t[0].split("0").length-1+(t[0].split("#").length-1),a=Number(e.value).toExponential(n+i);if(a.includes("e+"))r="e+";else{if(!a.includes("e-"))return a;r="e-"}var o,s=a.split(r),l=s[0].split("."),d=Number(s[1]);if("e-"===r){var h=d+Math.abs(d-i*(d>i?2:1));o=h-d,s[1]=h.toString()}else o=d%i,s[1]=(d-o).toString();o>0&&(l[0]+=l[1].substring(0,o),l[1]=l[1].slice(o),s[0]=l.join("."));var p=Number("1"+"0".repeat(n));return this.getFormattedNumber(t.join("."),Number((Math.round(Number(s[0])*p)/p).toFixed(n)))+r.toUpperCase()+this.findSuffix(e.format.split("+")[1],s[1])},e.prototype.scientificFormat=function(e,t){e.format||(e.format=Ke("Scientific"));var r=e.format.split("+")[1]||"00";void 0===t&&(t=this.findDecimalPlaces(e.format));var n=Number(e.value).toExponential(t);return n.indexOf("e+")>-1?n=n.split("e+")[0]+"E+"+this.findSuffix(r,n.split("e+")[1]):n.indexOf("e-")>-1&&(n=n.split("e-")[0]+"E-"+this.findSuffix(r,n.split("e-")[1])),n.replace(".",this.localeObj.decimal)},e.prototype.fractionFormat=function(e){var t,r,n;e.format=e.format||Ke("Fraction"),this.checkAndSetColor(e);var i=e.value.toString().split("."),a=e.format.split("?").length/2,o=e.format.split(" "),s=o[1]?o[1].split("/"):[];if(/^\?{1,3}\/\?{1,3}$|^\?\/[248]$|^\?\?\/16$/.test(o[1])){if(2===i.length&&!i[1].startsWith("0".repeat(s[1].trim().length||0))){for(var l=[0,1,Number.MAX_VALUE],d=l[0],h=l[1],p=l[2],c=s[1].includes("?")?Number("9".repeat(s[1].split("?").length-1)):Number(s[1]),u=parseFloat("0."+i[1]),f=1;f<=c;f++){var g=Math.round(u*f),m=Math.abs(u-g/f);m<p&&(d=(t=[g,f,m])[0],h=t[1],p=t[2])}var v=he(d,h);(d=(r=[d/v,h/v])[0])===(h=r[1])?i[0]=""+(parseInt(i[0],10)+1):0!==d&&(n=d+"/"+h)}}else 2!==i.length||i[1].startsWith("0".repeat(a))||(n=de(Number(e.value)));var y=this.getFormattedNumber(o[0],Math.abs(Number(i[0])));return n?(y="0"===y?"":y,(Number(e.value)<0?"-":"")+y+" "+n):(Number(e.value)<0?"-":"")+y+" "+"  ".repeat(2*a)},e.prototype.checkAndSetColor=function(e){var t=je(e.format);t&&(e.format=e.format.split("["+t+"]").join(""),e.color=t.toLowerCase(),this.applyColor(e))},e.prototype.findDecimalPlaces=function(e){var t=e.toUpperCase().indexOf("E");if(t>-1){var r=e.indexOf(this.localeObj.decimal);return-1===r&&"."!==this.localeObj.decimal&&(r=e.indexOf(".")),r>0?e.substring(r+1,t).length:0}return 2},e.prototype.checkDateFormat=function(e){if(!t.isNullOrUndefined(e.value)){var r=e.cell||He(e.rowIndex,e.colIndex,Ae(this.parent,t.isNullOrUndefined(e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex),!1,!0),n=r.format;this.parent.isEdit&&"Scientific"===$e(r.format)&&(r.format="");var i=this.checkCustomDateFormat(e.value.toString(),r,e.isEdit);if("Invalid"!==i.val){var a=void 0;if(i.format.startsWith("[h]")){var o=i.val.split(":");o.length>1&&Number(o[0])>=24&&(a=Number(o[0])/24,o[0]="24",i.val=o.join(":"))}var s=me(i.val,e.intl||new t.Internationalization(this.parent.locale),this.parent.locale,i.format||e.format,e.skipCellFormat&&r,i.isDateTime);if(s.dateObj&&"Invalid Date"!==s.dateObj.toString()){var l=s.dateObj.getFullYear();if(l>=1900&&l<=9999){e.isTime="time"===s.type;var d=ce(s.dateObj,i.val.includes(":"),e.isTime);if(a>=1&&(d+=a,s.dateObj=pe(d)),i.val=d.toString(),(!r.format||"General"===r.format)&&(e.isTime?r.format=Ke("Time"):r.format=Ke("ShortDate"),e.updateValue))return void(r.value=i.val);e.isDate="date"===s.type||"datetime"===s.type,e.dateObj=s.dateObj}e.updatedVal=i.val}}else n&&(r.format=n)}},e.prototype.checkCustomTimeFormat=function(e,t){var r=this,n=[],i=" "+this.localeObj.am,a=" "+this.localeObj.pm,o=e.includes(i)||e.includes(a);o||(e.includes(i.toLowerCase())||e.includes(a.toLowerCase()))&&(e=e.replace(i.toLowerCase(),i).replace(a.toLowerCase(),a),o=!0);var s,l=e.split(this.localeObj.timeSeparator),d=3===l.length&&o;if(l.length<=3){var h,p,c=o?12:23;l.forEach(function(t,o){t=t.trim(),l[o]=t,t.includes(i)||t.includes(a)?(s=" AM/PM",t=t.replace(i,"").replace(a,"")):s="",fe(h=Number(t))&&h>=0?h>=24&&0===o&&l.length>1?n.push("[h]"):h<=c&&0===o?(n.push("h"+s),1===l.length&&(s?((p=e.split(" "))[0]+=r.localeObj.timeSeparator+"00",l[0]=p.join(" ")):(n=[],e="Invalid"))):h<=60&&(1===n.length||2===n.length)?(1===n.length?(n.push("mm"+s),2===l.length&&"[h]"===n[0]&&n.push("ss")):n.push("ss"),1===t.length&&(l[o]="0"+l[o])):(n=[],e="Invalid"):(n=[],e="Invalid")})}else e="Invalid";if(n.length){e=l.join(this.localeObj.timeSeparator);var u=void 0;if(d?u=this.customFormats[24]:(u=n.join(":"),Vi&&(u=this.getMatchingCustomFormat(u))),!t.format||"General"===t.format)return t.format=u,{val:e,format:u}}return{val:e,format:""}},e.prototype.checkCustomDateFormat=function(e,r,n){var i,a,o=this,s=r.format;if(e.includes(this.localeObj.dateSeparator)&&(!e.includes(" "+this.localeObj.am)&&!e.includes(" "+this.localeObj.pm)||e.replace(" "+this.localeObj.am,"").replace(" "+this.localeObj.pm,"").includes(this.localeObj.dateSeparator)))i=this.localeObj.dateSeparator;else{if(!(e.indexOf("-")>0)){if(e.indexOf(",")>0){var l=new t.Internationalization(this.parent.locale).parseDate(e,{skeleton:"full"});return l&&!isNaN(l.getTime())?{val:e,format:"",isDateTime:!1}:{val:"Invalid",format:""}}return e.includes(this.localeObj.timeSeparator)||e.includes(" "+this.localeObj.am)||e.includes(" "+this.localeObj.pm)?this.checkCustomTimeFormat(e,r):{val:"Invalid",format:""}}i="-"}if(e.includes(this.localeObj.timeSeparator)&&e.includes(" ")){var d=e.split(" ");if(e=d.shift(),"Invalid"===(a=this.checkCustomTimeFormat(d.join(" "),r)).val)return{val:"Invalid",format:""}}var h,p=e.split(i),c="",u=[],f=function(e){c=u.join(i),s&&"General"!==s||(r.format=e)},g=t.IntlBase.getDependables(t.cldrData,this.parent.locale,null).dateObject,m=g.months["stand-alone"]?g.months["stand-alone"].wide:{},v=g.months["stand-alone"]?g.months["stand-alone"].abbreviated:{1:""},y=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],C=function(e,t,r,n){if(v[""+t]&&v[""+t].toLowerCase()===r)return void(h=y[Number(t)-1]);e.substring(0,n)===r&&(h=y[Number(t)-1])};if(2===p.length){var b=function(t){e=h,u[0]="MMM",Number(t)<=31&&Number(t)>0?(e=t+i+e,"/"!==o.localeObj.dateSeparator&&"-"!==i&&(e+=i+(new Date).getFullYear()),u.splice(0,0,"dd"),f(o.customFormats[21])):(2===t.length&&fe(t)&&Number(t)>-1&&(t=(Number(t)<30?(new Date).getFullYear().toString().slice(0,2):"19")+t),Number(t)>=1900&&Number(t)<=9999?(e="1"+i+e+i+t,u[1]="yyyy",f(o.customFormats[22])):e="Invalid")};p[0]=p[0].toLowerCase().trim(),p[1]=p[1].toLowerCase().trim(),!Number(p[0])&&p[0].length>=v[1].length?(Object.keys(m).find(function(e){return C(m[""+e].toLowerCase(),e,p[0],p[0].length)}),t.isNullOrUndefined(h)||p[0].includes(",")||b(p[1])):!Number(p[1])&&p[1].length>=v[1].length?(Object.keys(m).find(function(e){return C(m[""+e].toLowerCase(),e,p[1],p[1].length)}),t.isNullOrUndefined(h)||b(p[0])):Number(p[0])&&Number(p[0])<=12&&Number(p[1])&&("/"===this.localeObj.dateSeparator||"-"===i||n&&!r.formula)&&(h=y[Number(p[0])-1],b(p[1])),u.length||(e="Invalid")}else if(p.length>2)for(var x=this,S=0;S<p.length;S++)!function(r){fe(p[r])?4!==p[r].length&&2!==p[r].length&&1!==p[r].length&&(e="Invalid"):(p[r]=p[r].trim(),Object.keys(m).find(function(e){return C(m[""+e].toLowerCase(),e,p[r].trim().toLowerCase(),p[r].length)}),t.isNullOrUndefined(h)?e="Invalid":1===r&&(u[1]="MMM",p[2]=p[2].trim(),2===p[2].length&&fe(p[2])&&Number(p[2])>-1&&(p[2]=(Number(p[2])<30?(new Date).getFullYear().toString().slice(0,2):"19")+p[2]),Number(p[0])<=31&&Number(p[2])>=1900&&Number(p[2])<=9999&&(e=p[0]+i+h,e+=i+p[2],u[0]="d",u[2]="yy",f(x.customFormats[20]),u[2]="yyyy",c=u.join(i))))}(S);var w;return a&&"Invalid"!==e&&(s&&"General"!==s||(r.format=this.customFormats[27]),c&&a.format&&(c+=" "+a.format),e+=" "+a.val,w=!0),{val:e,format:c,isDateTime:w}},e.prototype.formattedBarText=function(e){var r=this;if(""!==e.value&&!t.isNullOrUndefined(e.value)){var n={},i=e.cell&&e.cell.format||"",a=e.type||(i&&qe(i,!0,n,!0)?n.type:""),o=new t.Internationalization,s=e.value,l=!e.showFormattedText||"dd-MM-yyyy"!==i&&"dd/MM/yyyy"!==i?Ke("ShortDate"):i,d=Ke("Time");"h:mm:ss AM/PM"===d&&(d="h:mm:ss a");var h=i.toLowerCase(),p=function(){"."!==r.localeObj.decimal&&e.value&&(e.value=e.value.toString(),fe(e.value)&&e.value.includes(".")&&(e.value=e.value.replace(".",r.localeObj.decimal)))};if("time"!==a||!h.includes("m")||h.includes(":m")||h.includes("m:")||h.includes("[m")||h.includes("am")||(a="date"),"date"===a){var c=e.value.toString();e.value=this.shortDateFormat({type:a,value:e.value,format:l},o,e.cell),e.value&&c.includes(".")&&(e.value+=" "+this.timeFormat({type:a,value:c,format:d},o))}else a.includes("time")?s&&Number(s)>=1||"datetime"===a?e.value=this.shortDateFormat({type:a,value:e.value,format:l},o)+" "+this.timeFormat({type:a,value:e.value,format:d},o):e.value=this.timeFormat({type:a,value:e.value,format:d},o):e.cell.format&&e.cell.format.includes("%")&&fe(e.cell.value)?(e.value=this.parent.getDisplayText(e.cell),e.value.includes("%")||(e.value=s,p())):p();(!e.value||e.value&&e.value.toString().indexOf("null")>-1)&&(e.value=s)}},e.prototype.getFormattedNumber=function(e,r){return(new t.Internationalization).formatNumber(Number(r),{format:e})||""},e.prototype.getMatchingCustomFormat=function(e){return"#,##0_);(#,##0)"===e&&Vi.has(37)?Vi.get(37):"#,##0_);[Red](#,##0)"===e&&Vi.has(38)?Vi.get(38):"#,##0.00_);(#,##0.00)"===e&&Vi.has(39)?Vi.get(39):"#,##0.00_);[Red](#,##0.00)"===e&&Vi.has(40)?Vi.get(40):"d-mmm-yy"===e&&Vi.has(15)?Vi.get(15):"d-mmm"===e&&Vi.has(16)?Vi.get(16):"mmm-yy"===e&&Vi.has(17)?Vi.get(17):"h:mm AM/PM"===e&&Vi.has(18)?Vi.get(18):"h:mm:ss AM/PM"===e&&Vi.has(19)?Vi.get(19):"h:mm"===e&&Vi.has(20)?Vi.get(20):"h:mm:ss"===e&&Vi.has(21)?Vi.get(21):"m/d/yyyy h:mm"===e&&Vi.has(22)?Vi.get(22):"mm:ss"===e&&Vi.has(45)?Vi.get(45):e},e.prototype.addEventListener=function(){this.parent.on("applyNumber",this.numberFormatting,this),this.parent.on(Wr,this.getFormattedCell,this),this.parent.on(Zr,this.checkDateFormat,this),this.parent.on("getFormattedBarText",this.formattedBarText,this),this.parent.on(Jr,this.updateAutoDetectNumberFormat,this),this.parent.on(Qr,this.parseDecimalNumber,this),this.parent.on(kn,this.localizedFormatAction,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("applyNumber",this.numberFormatting),this.parent.off(Wr,this.getFormattedCell),this.parent.off(Zr,this.checkDateFormat),this.parent.off("getFormattedBarText",this.formattedBarText),this.parent.off(Jr,this.updateAutoDetectNumberFormat),this.parent.off(Qr,this.parseDecimalNumber),this.parent.off(kn,this.localizedFormatAction))},e.prototype.destroy=function(){this.removeEventListener(),Vi&&!this.parent.refreshing&&(Vi.clear(),Vi=null),zi=this.parent=this.localeObj=this.customFormats=this.localizedFormats=null},e.prototype.getModuleName=function(){return"workbookNumberFormat"},e}(),ea=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on(rn,this.initiateSortHandler,this),this.parent.on("updateSortedDataOnCell",this.updateSortedDataOnCell,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(rn,this.initiateSortHandler),this.parent.off("updateSortedDataOnCell",this.updateSortedDataOnCell))},e.prototype.initiateSortHandler=function(e){var n=this,i=e.args,a=new r.Deferred,o=this.parent.getAddressInfo(i.range),s=Ae(this.parent,o.sheetIndex),l=w(o.indices),d=i.sortOptions||{sortDescriptors:{},containsHeader:!0},h=!1;if(e.promise=a.promise,l[0]>s.usedRange.rowIndex||l[1]>s.usedRange.colIndex)return void a.reject(this.parent.serviceLocator.getService("spreadsheetLocale").getConstant("SortOutOfRangeError"));var p=d.containsHeader,c=i.checkForHeader;if((l[0]===l[2]||c)&&(c||(l=X(l[0],l[1],s)),h=!0,t.isNullOrUndefined(d.containsHeader)&&(p=typeof He(l[0],l[1],s,null,!0).value!=typeof He(l[0]+1,l[1],s,null,!0).value||(!this.isSameStyle(He(l[0],l[1],s,null,!0).style,He(l[0]+1,l[1],s,null,!0).style)||this.isHeaderRow(s,l)))),(t.isNullOrUndefined(i.sortOptions)||t.isNullOrUndefined(i.sortOptions.containsHeader))&&!h){var g=He(l[0],l[1],s),y=He(l[0]+1,l[1],s);g&&y&&(p=typeof g.value!=typeof y.value||(!this.isSameStyle(g.style,y.style)||this.isHeaderRow(s,l)))}l[0]=p?l[0]+1:l[0];var C=v(u(s.activeCell)[1]+1);delete d.containsHeader;var b=d.sortDescriptors,x=new r.Query;if(Array.isArray(b)){b&&0!==b.length||(b=[{field:C}]);for(var S=b.length,I=S-1;I>-1;I--)if(b[S-1].field||(b[S-1].field=C),b[I].field){E=b[I].sortComparer||this.sortComparer.bind(this,b[I],d.caseSensitive);x.sortBy(b[I].field,E),C=b[I].field}}else{b||(b={field:C}),b.field||(b.field=C);var E=b.sortComparer||this.sortComparer.bind(this,b,d.caseSensitive);x.sortBy(b.field,E),C=b.field}var R=m(l);ye(this.parent,s.name+"!"+R,!0,null,null,null,null,null,void 0,null,f(C)).then(function(t){var o=new r.DataManager(t);if(1===t.length&&t[0].throwMergeAlert){var d=n.parent.sortCollection&&n.parent.sortCollection[n.parent.sortCollection.length-1];if(d){var h=void 0;if(e.previousSort&&e.previousSort.length)for(var p=0;p<e.previousSort.length;p++){var c=e.previousSort[p];d.sheetIndex===c.sheetIndex&&(h=c)}h?(d.columnIndex=h.columnIndex,d.order=h.order,d.sortRange=h.sortRange):n.parent.sortCollection.pop(),n.parent.notify("refreshFilterRange",null)}return void a.reject(n.parent.serviceLocator.getService("spreadsheetLocale").getConstant("AutoFillMergeAlertMsg"))}o.executeQuery(x).then(function(r){n.parent.notify("setActionData",{args:{action:"beforeSort",eventArgs:{range:R,cellDetails:t,sortedCellDetails:r.result}}}),n.updateSortedDataOnCell({result:r.result,range:l,sheet:s,jsonData:t});var o={range:s.name+"!"+R,sortOptions:i.sortOptions};e.previousSort&&(o.previousSort=e.previousSort),a.resolve(o)})})},e.prototype.isHeaderRow=function(e,t){return!(!e.ranges||!e.ranges.length)&&e.ranges.some(function(e){if(!e.dataSource||!e.showFieldAsHeader)return!1;var r=u(e.startCell);return r[0]===t[0]&&r[1]>=t[1]&&r[1]<=t[3]})},e.prototype.updateSortedDataOnCell=function(e){for(var r,n,i,a=this,o=[],s=function(n,i){for(var s=e.range[1],l=0;s<=e.range[3];s++,l++){if(o[l]||(o[l]=v(s+1)),i[o[l]])r=t.extend({},i[o[l]],null,!0);else{if(!He(n,s,e.sheet))continue;r=null}(r=a.skipBorderOnSorting(n,s,e.sheet,r))&&r.validation&&delete r.validation;var d=He(n,s,e.sheet);d&&(d.validation&&(r=Object.assign({},r,{validation:d.validation})),d.wrap&&ze(g(n,s),!1,a.parent)),r&&r.formula&&(r.formula=q([n,s],[parseInt(i.__rowIndex,10)-1,s],e.sheet,a.parent,r,!0)),Ue(n,s,e.sheet,r)}},l=e.isUndo&&{},d=e.range[0],h=0;d<=e.range[2];d++,h++)if(tt(e.sheet,d))h--;else if(i=e.result[h],e.isUndo){if(i&&(n=parseInt(i.__rowIndex,10)-1,l[n]=!0,s(n,i),d===n))continue;!l[d]&&e.sheet.rows[d]&&s(d,{})}else s(d,i||{})},e.prototype.skipBorderOnSorting=function(e,t,r,n){var i=He(e,t,r),a=["borderBottom","borderTop","borderRight","borderLeft","border"];if(n&&n.style)for(var o=0,s=a;o<s.length;o++){h=s[o];delete n.style[""+h]}if(i&&i.style)for(var l=0,d=a;l<d.length;l++){var h=d[l];i.style[""+h]&&(n||(n={}),n.style||(n.style={}),n.style[""+h]=i.style[""+h])}return n},e.prototype.isSameStyle=function(e,t){e||(e={}),t||(t={});for(var r=!0,n=Object.keys(e),i=0;i<n.length;i++){if(e[n[i]]!==t[n[i]]&&this.parent.cellStyle[n[i]]!==e[n[i]]){r=!1;break}r=!0}return r},e.prototype.sortComparer=function(e,n,i,a){var o=e.order||"",s=r.DataUtil.fnSort(o),l=i?i.value:i,d=a?a.value:a;if(i&&a&&("string"==typeof l||"string"==typeof d)&&""!==l&&""!==d){var h=void 0,p=void 0;if(fe(i.value)&&(l=ve(i.value),"@"!==i.format&&(i.value=l),h=!0),fe(a.value)&&(d=ve(a.value),"@"!==a.format&&(a.value=d),p=!0),!h&&!p){var c={sensitivity:n?"case":"base"},u=new Intl.Collator(this.parent.locale,c);return o&&"ascending"!==o.toLowerCase()?-1*u.compare(l,d):u.compare(l,d)}}return t.isNullOrUndefined(d)||""===d?-1:t.isNullOrUndefined(l)||""===l?1:s(l,d)},e.prototype.getModuleName=function(){return"workbookSort"},e}(),ta=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on("initiateFilter",this.initiateFilterHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off("initiateFilter",this.initiateFilterHandler)},e.prototype.initiateFilterHandler=function(e){var t=this,n=e.args,i=new r.Deferred,a=Ae(this.parent,S(this.parent,n.range)),o=n.filterOptions||{};if(e.promise=i.promise,o.datasource){this.setFilter(o.datasource,o.predicates,n.range,e.refresh,o.equalOrPredicates);var s={range:n.range,filterOptions:o};i.resolve(s)}else{var l=w(y(n.range));if(l[0]>a.usedRange.rowIndex||l[1]>a.usedRange.colIndex)return void i.reject("Select a cell or range inside the used range and try again.");l[0]===l[2]&&l[2]-l[0]==0&&(l[0]=0,l[1]=0,l[3]=a.usedRange.colIndex),l[2]=a.usedRange.rowIndex,l[0]=l[0]+1;var d=m(l);ye(this.parent,a.name+"!"+d,!0,!0,null,null,null,null,!1).then(function(a){var s=new r.DataManager(a);t.setFilter(s,o.predicates,n.range,e.refresh);var l={range:d,filterOptions:o};i.resolve(l)})}},e.prototype.setFilter=function(e,t,r,n,i){var a=this;if(e&&t){var o,s,l=e.dataSource.json,d=ie(e,t,i);if(r.indexOf("!")>-1?(s=Se(this.parent,r.substring(0,r.lastIndexOf("!"))),o=Ae(this.parent,s)):(o=this.parent.getActiveSheet(),s=Se(this.parent,o.name)),"spreadsheet"===this.parent.getModuleName()){var h,p,u=this.parent;if(u.scrollSettings.enableVirtualization&&(o.rows||l).length>u.viewport.rowCount+2*u.getThreshold("row")||o.frozenRows||o.frozenColumns||n){l.forEach(function(e){h=d.indexOf(e)<0,et(o,Number(e.__rowIndex)-1,{hidden:h,isFiltered:h})}),p=s===u.activeSheetIndex;var f=c(o.paneTopLeftCell);this.parent.updateTopLeftCell(j(o,f[0],!0)-this.parent.frozenRowCount(o),null,"col")}else l.forEach(function(e){if(h=d.indexOf(e)<0,p)et(o,Number(e.__rowIndex)-1,{hidden:h,isFiltered:h});else{var t={startIndex:Number(e.__rowIndex)-1,hide:h,isFiltering:!0,sheetIndex:s};t.endIndex=t.startIndex,a.parent.notify(vn,t),p=t.refreshUI}});p&&u.renderModule.refreshSheet(!1,!1,document.activeElement.id!==this.parent.element.id+"_SearchBox")}else{var g;l.forEach(function(e){g=d.indexOf(e)<0,et(o,Number(e.__rowIndex)-1,{hidden:g,isFiltered:g})})}}},e.prototype.getModuleName=function(){return"workbookFilter"},e}(),ra=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.setImage=function(e){var r,n=e.range?e.range.lastIndexOf("!"):-1,i=e.range?n>-1?e.range.substring(n+1):e.range:this.parent.getActiveSheet().selectedRange,a=e.range&&n>-1?Se(this.parent,e.range.substring(0,n)):this.parent.activeSheetIndex,o=c(i),s=t.isUndefined(a)?this.parent.getActiveSheet():Ae(this.parent,a),l=He(o[0],o[1],s),d=e.options;if(l&&l.image)if(r=l.image,e.isPositionChanged)for(p=0;p<r.length;p++)for(var h=0;h<d.length;h++)r[p].id===d[h].id&&(r[p]=d[h],document.getElementById(d[h].id)&&(e.isElementRemoved=!0,document.getElementById(d[h].id).remove()));else{r=l.image;for(var p=0;p<d.length;p++)r.push(d[p])}return Ue(o[0],o[1],s,{image:l&&l.image?r:d},!0,!0),e.isElementRemoved},e.prototype.addEventListener=function(){this.parent.on("setImage",this.setImage,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off("setImage",this.setImage)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"workbookImage"},e}(),na=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on(xn,this.setChartHandler,this),this.parent.on("deleteChartColl",this.deleteChartColl,this),this.parent.on(wn,this.refreshChartSize,this),this.parent.on("focusChartBorder",this.focusChartBorder,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(xn,this.setChartHandler),this.parent.off("deleteChartColl",this.deleteChartColl),this.parent.off(wn,this.refreshChartSize),this.parent.off("focusChartBorder",this.focusChartBorder))},e.prototype.setChartHandler=function(e){var r=0,n=[];e.isInitCell=!t.isNullOrUndefined(e.isInitCell)&&e.isInitCell,e.isUndoRedo=!!t.isNullOrUndefined(e.isUndoRedo)||e.isUndoRedo,e.isPaste=!t.isNullOrUndefined(e.isPaste)&&e.isPaste;var i,a,o=e.chart;if(o.length>0)for(;r<o.length;){if(!1===e.isCut&&document.getElementById(e.chart[r].id)&&(o[r]={range:o[r].range,id:t.getUniqueID("e_spreadsheet_chart"),theme:o[r].theme,isSeriesInRows:o[r].isSeriesInRows,type:o[r].type,markerSettings:o[r].markerSettings,title:o[r].title,legendSettings:o[r].legendSettings,primaryXAxis:o[r].primaryXAxis,primaryYAxis:o[r].primaryYAxis,dataLabelSettings:o[r].dataLabelSettings}),document.getElementById(e.chart[r].id))return;if(i=o[r],i.theme=i.theme||"Material",i.type=i.type||"Line",i.isSeriesInRows=i.isSeriesInRows||!1,t.isNullOrUndefined(i.range)){var s=this.parent.getActiveSheet();i.range=s.selectedRange,0===(n=w(c(i.range)))[0]&&n[2]===s.rowCount-1&&n[2]>s.usedRange.rowIndex&&(n[2]=s.usedRange.rowIndex),0===n[1]&&n[3]===s.colCount-1&&n[3]>s.usedRange.colIndex&&(n[3]=s.usedRange.colIndex)}else n=w(c(i.range));var l=m(n);if(i.range.indexOf("!")>0?i.range=i.range.substring(0,i.range.lastIndexOf("!"))+"!"+l:i.range=this.parent.getActiveSheet().name+"!"+l,t.isNullOrUndefined(i.id)&&(i.id=t.getUniqueID("e_spreadsheet_chart")),i.markerSettings&&i.markerSettings.visible&&(void 0===i.markerSettings.isFilled&&(i.markerSettings.isFilled=!0),void 0===i.markerSettings.shape&&(i.markerSettings.shape="Circle")),i.height=i.height||290,i.width=i.width||480,this.parent.notify("initiateChart",{option:i,isInitCell:e.isInitCell,triggerEvent:e.isUndoRedo,dataSheetIdx:e.dataSheetIdx,range:e.range,isPaste:e.isPaste}),this.parent.chartColl.push(i),!e.isInitCell||e.isPaste||e.isUndo||e.isRedo){var d=void 0,h=void 0,p=void 0;if(e.range&&(e.isUndo||e.isRedo)){d=Se(this.parent,e.range.substring(0,e.range.lastIndexOf("!")));var u=w(c(e.range));h=u[0],p=u[1]}else{d=void 0===e.sheetId?i.range&&i.range.lastIndexOf("!")>0?Se(this.parent,i.range.substring(0,i.range.lastIndexOf("!"))):this.parent.activeSheetIndex:we(this.parent,e.sheetId);var f={clientY:i.top,isImage:!0},g={clientX:i.left,isImage:!0};this.parent.notify("getChartRowIdxFromClientY",f),this.parent.notify("getChartColIdxFromClientX",g),h=f.clientY,p=g.clientX}var v=He(h,p,s=t.isUndefined(d)?this.parent.getActiveSheet():this.parent.sheets[d]);this.parent.isPrintingProcessing||(v&&v.chart?v.chart.push(i):Ue(h,p,s,{chart:[i]},!0))}else{var y=c(e.range),f={clientY:i.top,isImage:!0},g={clientX:i.left,isImage:!0};this.parent.notify("getChartRowIdxFromClientY",f),this.parent.notify("getChartColIdxFromClientX",g);var C={prevTop:i.top,prevLeft:i.left,prevRowIdx:y[0],prevColIdx:y[1],prevHeight:i.height,prevWidth:i.width,currentTop:i.top,currentLeft:i.left,currentRowIdx:f.clientY,currentColIdx:g.clientX,currentHeight:i.height,currentWidth:i.width,id:i.id,requestType:"chartRefreshOnInit"};y[0]===f.clientY&&y[1]===g.clientX||(a=o.length,this.parent.notify("refreshChartCellOnInit",C),r-=a-o.length)}r++}},e.prototype.refreshChartSize=function(e){for(var r,n=1,i=this.parent.sheets.length+1;n<i;){var a=this.parent.chartColl;if(r=a?a.length:0)for(;r--;){var o=this.parent.chartColl[r];if(!t.isNullOrUndefined(e.overlayEle.querySelector("#"+o.id))){var s=this.parent.element.querySelector("."+o.id),l=t.getComponent(s,"chart")||t.getComponent(s,"accumulationchart");l&&(l.height=e.height,l.width=e.width)}}n++}},e.prototype.focusChartBorder=function(e){for(var r=0;r<this.parent.chartColl.length;r++){var n=document.getElementById(e.id),i=document.getElementById(this.parent.chartColl[r].id);n&&i&&t.closest(i,"."+n.classList[1])===n&&this.parent.notify("initiateChart",{option:this.parent.chartColl[r],isRefresh:!0})}},e.prototype.deleteChartColl=function(e){for(var t=0;t<this.parent.chartColl.length;t++)this.parent.chartColl[t].id+"_overlay"===e.id&&this.parent.chartColl.splice(t,1)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"workbookChart"},e}(),ia=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.format=function(e){var t,r=this,n=e.range;if(n&&"string"==typeof n&&n.indexOf("!")>-1){var i=n.lastIndexOf("!");n=n.substring(i+1),t=this.parent.sheets[Se(this.parent,e.range.substring(0,i))]}else t=this.parent.getActiveSheet();void 0===n&&(n=t.selectedRange);var a="object"!=typeof n&&e.onActionUpdate&&!e.isUndoRedo,o={range:n,style:Object.assign({},e.style),requestType:"CellFormat"};e.borderType&&(o.borderType=e.borderType);var s={},l="object"==typeof o.range?o.range:w(c(o.range)),d=[];if(oe(this.parent,l))return void(e.onActionUpdate&&this.parent.notify("readonlyAlert",null));if(Object.assign(s,o.style,null,!0),a&&(this.parent.trigger("beforeCellFormat",o),this.parent.notify("actionBegin",{eventArgs:o,action:"format"}),o.cancel))return void(e.cancel=!0);e.borderType&&(this.setTypedBorder(t,e.style.border,l,e.borderType,e.onActionUpdate,d),delete e.style.border,delete o.style.border);var h,p,u={cell:null,rowIdx:0,colIdx:0,eventOnly:!0,preventEvt:!a},f=function(e){return u.cell={style:e},u.rowIdx=h,u.colIdx=p,Y(r.parent,t,u)};if(void 0!==o.style.borderTop){for(p=l[1];p<=l[3];p++)h=l[0],f({borderTop:o.style.borderTop})||(e.isUndoRedo||(this.checkAdjacentBorder(t,"borderBottom",h-1,p),this.checkFullBorder(t,"borderBottom",h-1,p)),this.checkFullBorder(t,"borderTop",h,p),this.setCellBorder(t,u.cell.style,h,p,e.onActionUpdate,p===l[3],null,null,e.isUndoRedo,d));delete o.style.borderTop}if(void 0!==o.style.borderBottom){var g=void 0,m=void 0;for(p=l[1];p<=l[3];p++){m=(g=He(h=l[0],p,t,!1,!0)).rowSpan>0?He(l[2],l[1],t,!1,!0):He(l[2],l[3],t,!1,!0),g.rowSpan>1&&m.rowSpan<0||(h=l[2]);C={range:[h,p,h,p]};this.parent.notify(mn,C),h=C.range[0],f({borderBottom:o.style.borderBottom})||(e.isUndoRedo||(this.checkAdjacentBorder(t,"borderTop",l[2]+1,p),this.checkFullBorder(t,"borderTop",l[2]+1,p)),this.checkFullBorder(t,"borderBottom",l[2],p),this.setCellBorder(t,u.cell.style,h,p,e.onActionUpdate,p===l[3],null,null,e.isUndoRedo),this.setBottomBorderPriority(t,l[2],p))}delete o.style.borderBottom}if(void 0!==o.style.borderLeft){for(var v=l[0];v<=l[2];v++)p=l[1],f({borderLeft:o.style.borderLeft})||(e.isUndoRedo||(this.checkAdjacentBorder(t,"borderRight",v,p-1),this.checkFullBorder(t,"borderRight",v,p-1)),this.checkFullBorder(t,"borderLeft",v,p),this.setCellBorder(t,u.cell.style,v,p,e.onActionUpdate,null,null,null,e.isUndoRedo));delete o.style.borderLeft}if(void 0!==o.style.borderRight){for(var y=l[0];y<=l[2];y++){var C={range:[y,p=l[3],y,p]};this.parent.notify(mn,C),p=C.range[1],f({borderRight:o.style.borderRight})||(e.isUndoRedo||(this.checkAdjacentBorder(t,"borderLeft",y,p+1),this.checkFullBorder(t,"borderLeft",y,p+1)),this.checkFullBorder(t,"borderRight",y,p),this.setCellBorder(t,u.cell.style,y,p,e.onActionUpdate,null,null,null,e.isUndoRedo))}delete o.style.borderRight}var b,x,S=Object.keys(o.style);if(S.length){var I=void 0,E=void 0,R=void 0,N=this.parent,F=N.viewport&&this.parent.getActiveSheet().id===t.id,A=this.parent.frozenRowCount(t),k=this.parent.frozenColCount(t),O=[A+N.viewport.topIndex,k+N.viewport.leftIndex,N.viewport.bottomIndex,N.viewport.rightIndex],T=void 0,D=void 0,L=void 0,P=void 0,M=S.indexOf("color")>-1,B=M||S.indexOf("backgroundColor")>-1;for(h=l[0];h<=l[2];h++)if(!(D=Qe(t,h)||{}).isFiltered)for(T=h>=O[0]&&h<=O[2]||h<A,L=!1,p=l[1];p<=l[3];p++)if(!f(o.style)){if(void 0===x&&(void 0!==o.style.border?(b=o.style.border,delete o.style.border,x=!0):x=!1),I=He(h,p,t,!1,!0),R=t.columns[p],I.rowSpan>1||I.colSpan>1)for(var H=h,U=I.rowSpan>1?h+(I.rowSpan-1):h;H<=U;H++)for(var V=p,z=I.colSpan>1?p+(I.colSpan-1):p;V<=z;V++)x&&this.setFullBorder(t,b,l,H,V,e.onActionUpdate,!0),this.setCellStyle(t,H,V,o.style);if(x&&this.setFullBorder(t,b,l,h,p,e.onActionUpdate,void 0,d),this.setCellStyle(t,h,p,o.style),F)if(T&&(p>=O[1]&&p<=O[3]||p<k)){if(P=null,M&&I.format&&I.format.includes("[")){var j=je(I.format);j&&(P=j.toLowerCase())}this.parent.notify(Xr,{style:o.style,rowIdx:h,colIdx:p,lastCell:p===l[3],isHeightCheckNeeded:!0,manualUpdate:!0,onActionUpdate:e.onActionUpdate,formatColor:P}),B&&(E=I.validation||pt(R,h,p)&&R.validation)&&E.isHighlighted&&this.parent.notify("updateHighlight",{rowIdx:h,colIdx:p,cell:I,validation:E,col:I.validation&&R})}else D.customHeight||(L=L||_(o.style,e.onActionUpdate))&&this.parent.notify(Xr,{rowIdx:h,colIdx:p,lastCell:p===l[3],checkHeight:!0,outsideViewport:!T,onActionUpdate:e.onActionUpdate})}}x&&(o.style.border=b),le(this.parent,d,[l[1],l[3]]),this.parent.setUsedRange(l[2],l[3]),e.refreshRibbon&&this.parent.notify("activeCellChanged",null),t.conditionalFormats&&t.conditionalFormats.length&&this.parent.notify(Cn,{indexes:l}),a&&(o.style=s,o.range=t.name+"!"+n,this.parent.notify("actionComplete",{eventArgs:o,action:"format"}))},e.prototype.setBottomBorderPriority=function(e,t,r){if(tt(e,t+1)){var n=this.skipHiddenRows(e,t+1);""!==this.parent.getCellStyleValue(["borderTop"],[n,r]).borderTop&&(e.rows[t].cells[r].style.bottomPriority=!0)}},e.prototype.setFullBorder=function(e,t,r,n,i,a,o,s){var l={};n===r[0]&&(this.checkAdjacentBorder(e,"borderBottom",n-1,i),this.checkFullBorder(e,"borderBottom",n-1,i)),i===r[1]&&(this.checkAdjacentBorder(e,"borderRight",n,i-1),this.checkFullBorder(e,"borderRight",n,i-1)),i===r[3]?(this.checkAdjacentBorder(e,"borderLeft",n,i+1),this.checkFullBorder(e,"borderLeft",n,i+1)):this.checkAdjacentBorder(e,"border",n,i+1),l.borderRight=t,l.borderTop=t,l.borderLeft=t,l.borderBottom=t,this.setCellBorder(e,l,n,i,a,i===r[3],null,o,void 0,s),n===r[2]?(this.checkAdjacentBorder(e,"borderTop",n+1,i),this.checkFullBorder(e,"borderTop",n+1,i),this.setBottomBorderPriority(e,n,i)):this.checkAdjacentBorder(e,"border",n+1,i)},e.prototype.checkAdjacentBorder=function(e,t,r,n){var i={};""!==this.parent.getCellStyleValue([t],[r,n])[""+t]&&(i[""+t]=void 0,this.setCellStyle(e,r,n,i))},e.prototype.checkFullBorder=function(e,t,r,n){var i=this.parent.getCellStyleValue(["border"],[r,n]).border;if(""!==i){var a={border:void 0};["borderBottom","borderTop","borderLeft","borderRight"].forEach(function(e){e!==t&&(a[""+e]=i)}),this.setCellStyle(e,r,n,a)}},e.prototype.textDecorationActionUpdate=function(e){var t=this.parent.getActiveSheet(),r={range:t.selectedRange,style:e.style,requestType:"CellFormat"},n=w(c(t.selectedRange));if(oe(this.parent,n))return void this.parent.notify("readonlyAlert",null);if(this.parent.trigger("beforeCellFormat",r),this.parent.notify("actionBegin",{eventArgs:r,action:"format"}),r.cancel)return void(e.cancel=!0);var i=e.style.textDecoration.toLowerCase(),a=i,o=c(t.activeCell),s=this.parent.getCellStyleValue(["textDecoration"],o).textDecoration.toLowerCase(),l=!1;"underline"===s?a="underline"===i?"none":"underline line-through":"line-through"===s?a="line-through"===i?"none":"underline line-through":"underline line-through"===s&&(a="underline"===i?"line-through":"underline",l=!0),"none"===a&&(l=!0);var d={textDecoration:a};this.format({style:d,range:o,refreshRibbon:e.refreshRibbon,onActionUpdate:!0});for(var h=n[0];h<=n[2];h++)for(var p=n[1];p<=n[3];p++)if(h!==o[0]||p!==o[1]){if(d={},"none"===(s=this.parent.getCellStyleValue(["textDecoration"],[h,p]).textDecoration.toLowerCase())){if(l)continue;d.textDecoration=i}else if("underline"===s||"line-through"===s)if(l){if(i!==s)continue;d.textDecoration="none"}else d.textDecoration=i!==s?"underline line-through":i;else if("underline line-through"===s){if(!l)continue;d.textDecoration="underline"===i?"line-through":"underline"}this.format({style:d,range:[h,p,h,p],refreshRibbon:e.refreshRibbon,onActionUpdate:!0})}r.range=t.name+"!"+r.range,r.style.textDecoration=a,this.parent.notify("actionComplete",{eventArgs:r,action:"format"})},e.prototype.setTypedBorder=function(e,t,r,n,i,a){var o;if("Outer"===n){for(var s=r[1];s<=r[3];s++)this.checkAdjacentBorder(e,"borderBottom",r[0]-1,s),this.checkFullBorder(e,"borderBottom",r[0]-1,s),this.setCellBorder(e,{borderTop:t},r[0],s,i,s===r[3],void 0,void 0,void 0,a),this.checkAdjacentBorder(e,"borderTop",r[2]+1,s),this.checkFullBorder(e,"borderTop",r[2]+1,s),this.setCellBorder(e,{borderBottom:t},r[2],s,i,s===r[3],n),this.setBottomBorderPriority(e,r[2],s);for(var l=r[0];l<=r[2];l++)this.checkAdjacentBorder(e,"borderRight",l,r[1]-1),this.checkFullBorder(e,"borderRight",l,r[1]-1),this.setCellBorder(e,{borderLeft:t},l,r[1],i),this.checkAdjacentBorder(e,"borderLeft",l,r[3]+1),this.checkFullBorder(e,"borderLeft",l,r[3]+1),this.setCellBorder(e,{borderRight:t},l,r[3],i,null,n)}else if("Inner"===n){var d={range:[r[0],r[1],r[0],r[1]]};if(this.parent.notify("mergedRange",d),d.range[0]===r[0]&&d.range[1]===r[1]&&d.range[2]===r[2]&&d.range[3]===r[3])return;for(h=r[0];h<=r[2];h++)for(p=r[1];p<=r[3];p++){c={};""!==(o=this.parent.getCellStyleValue(["border"],[h,p]).border)&&(c.border=void 0,p!==r[3]&&p!==r[1]&&h!==r[0]&&h!==r[2]||(h===r[0]&&(c.borderTop=o),h===r[2]&&(c.borderBottom=o),p===r[3]&&(c.borderRight=o),p===r[1]&&(c.borderLeft=o))),p!==r[3]&&(c.borderRight=t),h!==r[0]&&(c.borderTop=t),h!==r[2]&&(c.borderBottom=t),p!==r[1]&&(c.borderLeft=t),this.setCellBorder(e,c,h,p,i,p===r[3],void 0,void 0,void 0,a)}}else if("Vertical"===n)for(h=r[0];h<=r[2];h++)for(p=r[1];p<=r[3];p++){c={borderRight:t,borderLeft:t};p===r[1]&&(this.checkAdjacentBorder(e,"borderRight",h,p-1),this.checkFullBorder(e,"borderRight",h,p-1)),p===r[3]&&(this.checkAdjacentBorder(e,"borderLeft",h,p+1),this.checkFullBorder(e,"borderLeft",h,p+1)),this.setCellBorder(e,c,h,p,i)}else for(var h=r[0];h<=r[2];h++)for(var p=r[1];p<=r[3];p++){var c={borderTop:t,borderBottom:t};h===r[0]&&(this.checkAdjacentBorder(e,"borderBottom",h-1,p),this.checkFullBorder(e,"borderBottom",h-1,p)),this.setCellBorder(e,c,h,p,i,p===r[3]),h===r[2]&&(this.checkAdjacentBorder(e,"borderTop",h+1,p),this.checkFullBorder(e,"borderTop",h+1,p),this.setBottomBorderPriority(e,h,p))}},e.prototype.setCellBorder=function(e,t,r,n,i,a,o,s,l,d){var h=He(r,n,e),p=ot(e,n),c=Qe(e,r);if(!(h&&h.isReadOnly||p&&p.isReadOnly||c&&c.isReadOnly||(this.setCellStyle(e,r,n,t),s||this.parent.getActiveSheet().id!==e.id))){if("Outer"===o&&(t.borderBottom||t.borderRight)){var u={range:[r,n,r,n]};this.parent.notify(mn,u),r=u.range[0],n=u.range[1]}l&&(""===t.borderTop&&""!==this.parent.getCellStyleValue(["borderBottom"],[r-1,n]).borderBottom&&(t.borderTop=this.parent.getCellStyleValue(["borderBottom"],[r-1,n]).borderBottom),""===t.borderLeft&&""!==this.parent.getCellStyleValue(["borderRight"],[r,n-1]).borderRight&&(t.borderLeft=this.parent.getCellStyleValue(["borderRight"],[r,n-1]).borderRight),""===t.borderRight&&""!==this.parent.getCellStyleValue(["borderLeft"],[r,n+1]).borderLeft&&(t.borderRight=this.parent.getCellStyleValue(["borderLeft"],[r,n+1]).borderLeft)),this.parent.notify(Xr,{style:t,rowIdx:r,colIdx:n,onActionUpdate:i,first:"",lastCell:a,isHeightCheckNeeded:!0,manualUpdate:!0,mergeBorderRows:d})}},e.prototype.setCellStyle=function(e,t,r,n){e.rows[t]?e.rows[t].cells||(e.rows[t].cells=[]):e.rows[t]={cells:[]},e.rows[t].cells[r]||(e.rows[t].cells[r]={}),e.rows[t].cells[r].style||(e.rows[t].cells[r].style={}),Object.assign(e.rows[t].cells[r].style,n,null,!0)},e.prototype.skipHiddenRows=function(e,t){return t++,tt(e,t)&&(t=this.skipHiddenRows(e,t)),t},e.prototype.addEventListener=function(){this.parent.on(Yr,this.format,this),this.parent.on("textDecorationUpdate",this.textDecorationActionUpdate,this),this.parent.on("clear",this.clearCellObj,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Yr,this.format),this.parent.off("textDecorationUpdate",this.textDecorationActionUpdate),this.parent.off("clear",this.clearCellObj))},e.prototype.clearCellObj=function(e){var t,r,n,i,a,o=e.range?e.range.lastIndexOf("!"):0,s=e.range?o>0?e.range.substring(o+1):e.range:this.parent.getActiveSheet().selectedRange,l=e.range&&o>0?Se(this.parent,e.range.substring(0,o)):this.parent.activeSheetIndex,d=Ae(this.parent,l),h=w(y(s)),p=h[0],c=h[2],u=d.conditionalFormats&&d.conditionalFormats.length&&[].slice.call(d.conditionalFormats),f=[];for(p;p<=c;p++)for(n=h[1],i=h[3],n;n<=i;n++){var g=He(p,n,d),m=ae(g,ot(d,n),Qe(d,p));if(g&&("Clear All"===e.type||"Clear Formats"===e.type)){if(g.rowSpan>1||g.colSpan>1){var v={range:[p,n,p,n]};this.parent.notify("mergedRange",v);var C=v.range;h[0]<=C[0]&&h[1]<=C[1]&&h[2]>=C[2]&&h[3]>=C[3]&&this.parent.notify(gn,{merge:!1,range:C,type:"All",sheetIndex:l,preventRefresh:l!==this.parent.activeSheetIndex})}if(g.rowSpan&&1!==g.rowSpan||g.colSpan&&1!==g.colSpan)continue}if(g&&!m)switch(e.type){case"Clear Formats":delete g.format,delete g.rowSpan,delete g.style,delete g.wrap,delete g.colSpan,delete g.formattedText,g.hyperlink&&(g.style={textDecoration:"none",color:"inherit"});break;case"Clear Contents":g.hyperlink&&(this.parent.notify("deleteHyperlink",{sheet:d,rowIdx:p,colIdx:n,preventRefresh:!0}),g.style={textDecoration:"underline",color:"#00e"}),a=!(!g.value&&!g.formula),delete g.value,delete g.formula,delete g.formattedText,a&&(r={action:"refreshCalculate",rowIndex:p,colIndex:n,sheetIndex:l},this.parent.notify(Kr,r),u&&!t&&((t=r.isFormulaDependent)||Z(u,f,p,n)));break;case"Clear Hyperlinks":delete g.hyperlink;break;case"Clear All":a=!(!g.value&&!g.formula),Ue(p,n,d,{},!1),a&&(r={action:"refreshCalculate",rowIndex:p,colIndex:n,sheetIndex:l},this.parent.notify(Kr,r),u&&!t&&(t=r.isFormulaDependent))}}(f.length||t)&&l===this.parent.activeSheetIndex&&this.parent.notify(Cn,{cfModel:!t&&f,refreshAll:t,isAction:!0})},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"workbookcellformat"},e}(),aa=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on($r,this.performEditOperation,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off($r,this.performEditOperation)},e.prototype.getModuleName=function(){return"workbookEdit"},e.prototype.performEditOperation=function(e){switch(e.action){case"updateCellValue":e.isFormulaDependent=this.updateCellValue(e.address,e.value,e.sheetIndex,e.isValueOnly,e.skipFormatCheck,e.isRandomFormula,e.skipCellFormat,e.isDelete,e.deletedRange,e.fillType,e.cellInformation,e.isRedo,e.isDependentUpdate,e.actionName,e.isPaste)}},e.prototype.updateCellValue=function(e,r,n,i,a,o,s,l,d,h,p,u,f,m,v){void 0===n&&(n=this.parent.activeSheetIndex);var y,C;y="string"==typeof e?c(e):e;var b=Ae(this.parent,n),x=He(y[0],y[1],b,!0);if(x||(x=b.rows[y[0]].cells[y[1]]={}),i)x.value=r,x.formattedText&&delete x.formattedText;else{var S=k(r);S="#SPILL!"===r||S;var w=!1;x.formula&&x.formula.indexOf("UNIQUE")>-1&&""===r&&(w=!0);var I=!("Text"===$e(x.format)||S&&r.toLowerCase().startsWith("=text("));(S="Text"!==$e(x.format)&&S)||w||(x.formula&&(x.formula=""),x.value=I?ve(r,v):r);var E={action:"refreshCalculate",value:r,rowIndex:y[0],colIndex:y[1],sheetIndex:n,isFormula:S,isRandomFormula:o,isDelete:l,deletedRange:d,fillType:h,isDependentRefresh:f};if(I&&!a){var R={value:r,rowIndex:y[0],colIndex:y[1],sheetIndex:n,updatedVal:"",skipCellFormat:s};if(S)!t.isNullOrUndefined(r)&&r.toLowerCase().includes("unique(")&&r.length>0&&(x.value=r);else{var N=$e(x.format),F=r?r.toString().split("/"):[];if(("Number"!==N&&"Percentage"!==N&&"Fraction"!==N&&("Scientific"!==N||2!==F.length)||"Fraction"===N&&2!==F.length)&&this.parent.notify(Zr,R),!t.isNullOrUndefined(R.updatedVal)&&R.updatedVal.length>0)x.value=R.updatedVal;else if(this.parent.isEdit&&r&&!fe(r)){var A=t.getNumberDependable(this.parent.locale,t.defaultCurrencyCode);if(x.format)if((r.includes("%")||r.includes(A))&&qe(x.format)){var O={formattedText:r,value:r,format:"General",cell:{value:r,format:"General"},isEdit:!0};this.parent.notify(Wr,O),"General"!==O.format&&["Currency","Percentage"].indexOf($e(O.format))>-1&&(x.format=O.format,x.value=O.value)}else{var T={value:x.value,format:x.format,formattedText:x.value,type:"General",cell:x,rowIndex:y[0],colIndex:y[1]};this.parent.notify(Wr,T)}else if(r.includes(A)||r.includes("%")||r.includes(t.getNumericObject(this.parent.locale).group)){var D=new t.Internationalization,L={intl:D,updateValue:!0,value:"",curSymbol:A,cell:x};this.parent.notify(Jr,{args:L,intl:D,fResult:r,cell:x})}}}}if("#SPILL!"===r)x.value=r;else{var P={cellIdx:y,isUnique:!1};if(this.parent.notify(en,P),"Manual"===this.parent.calculationMode&&S&&t.isNullOrUndefined(f)&&("autofill"!==m||""!==x.formula)&&!this.parent.isEdit&&t.isNullOrUndefined(this.parent.element.querySelector(".e-text-replaceInp"))&&(w=!0,u||void 0!==x.value||(w=!1)),w||l?r=x.value:(this.parent.notify(Kr,E),C=E.isFormulaDependent),S){if(x.formula=E.value,!("Manual"===this.parent.calculationMode&&w&&u&&!this.parent.isEdit&&p&&p.cellDetails&&p.cellDetails.length>0&&0===p.cutCellDetails.length)||t.isNullOrUndefined(p.cellDetails[0].autoFillText)&&t.isNullOrUndefined(p.cellDetails[0].copyCellValue))r=x.value,"Manual"===this.parent.calculationMode&&p&&u&&p.displayText&&(r=x.value=p.displayText);else for(var M=0;M<p.cellDetails.length;M++)if(p.cellDetails[M].rowIndex===e[0]&&p.cellDetails[M].colIndex===e[1]){r=p.cellDetails[M].copyCellValue?x.value=p.cellDetails[M].copyCellValue:x.value=p.cellDetails[M].autoFillText;break}var B=x.formula.toLowerCase(),H="Scientific"===$e(x.format)&&!a&&this.parent.isEdit;"=now()"!==B||x.format&&"General"!==x.format&&!H?!B.includes("=time(")||x.format&&!H?B.includes("=date(")&&H&&(x.format=Ke("ShortDate")):x.format="h:mm AM/PM":x.format=Ke("ShortDate")+" h:mm"}else!x.value||"string"!=typeof x.value||0!==x.value.indexOf("www.")&&0!==x.value.indexOf("https://")&&0!==x.value.indexOf("http://")&&0!==x.value.indexOf("ftp://")||this.parent.notify(nn,{hyperlink:x.value,cell:b.name+"!"+g(y[0],y[1])})}}return this.parent.setUsedRange(y[0],y[1],b),!this.parent.chartColl.length||this.parent.isEdit||o||this.parent.notify("refreshChart",{cell:x,rIdx:y[0],cIdx:y[1],sheetIdx:n,isRefreshChart:!0}),C},e}(),oa=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on(nn,this.setLinkHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(nn,this.setLinkHandler)},e.prototype.setLinkHandler=function(e){var r,n=e.hyperlink,i=e.cell;if(i&&-1!==i.indexOf("!")){var a=i.lastIndexOf("!");if(r=Ae(this.parent,Se(this.parent,i.substring(0,a))),i=i.substring(a+1),!r)return}else r=this.parent.getActiveSheet(),i=i||r.selectedRange;var o=!e.triggerEvt&&r.isProtected;if(!o||r.protectSettings.insertLink){var s=w(c(i));"string"==typeof n?0===n.toLowerCase().indexOf("www.")&&(n="http://"+n):0===n.address.toLowerCase().indexOf("www.")&&(n.address="http://"+n.address);for(var l,d=c(r.activeCell),h=s[0];h<=s[2];h++)for(var p=s[1];p<=s[3];p++)o&&U(He(h,p,r),ot(r,p))||(l={hyperlink:n},t.isNullOrUndefined(e.displayText)||(e.triggerEvt||e.isUndoRedo?h===d[0]&&p===d[1]&&(l.value=e.displayText,delete l.formattedText):(l.value=e.displayText,delete l.formattedText)),l.style={textDecoration:"underline",color:"#00e"},Y(this.parent,r,{cell:l,rowIdx:h,colIdx:p,preventEvt:!e.triggerEvt}))}},e.prototype.getModuleName=function(){return"workbookHyperlink"},e}(),sa=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.insertModel=function(e){var t,r,n,i,a=this;if(e.model){var o,s,l,d,h=[];if("number"==typeof e.start){o=e.start,e.end=e.end||o,o>e.end&&(o=e.end,e.end=e.start),"Row"===e.modelType&&o<e.model.maxHgts.length&&(d=[]);for(w=o;w<=e.end;w++)h.push({}),d&&d.push(null)}else e.start?(o=e.start[0].index||0,h=e.start,l=!0):(o=0,h.push({})),"Row"===e.modelType&&o<e.model.maxHgts.length&&(d=[],h.forEach(function(){d.push(null)}));var p={model:h,index:o,modelType:e.modelType,insertType:e.insertType,cancel:!1,isUndoRedo:e.isUndoRedo},c={eventArgs:p,action:"insert"};if(e.isAction){if(this.parent.notify(qr,c),p.cancel)return;delete p.cancel,p.isAction=e.isAction}var u={startIndex:o,endIndex:o+h.length-1,modelType:e.modelType,sheet:e.model,isInsert:!0};if("Row"===e.modelType){if(void 0!==e.checkCount&&e.model.rows&&e.checkCount===e.model.rows.length)return;if(this.parent.notify("refreshInsertDelete",u),e.model=e.model,e.model.rows||(e.model.rows=[]),l&&e.model.usedRange.rowIndex>-1&&o>e.model.usedRange.rowIndex)for(w=e.model.usedRange.rowIndex;w<o-1;w++)h.splice(0,0,{});var f=this.parent.frozenRowCount(e.model);if(o<f||o<=f&&e.freezePane){var g=e.model.frozenRows+h.length-(o===f&&f>0?1:0);this.parent.setSheetPropertyOnMute(e.model,"frozenRows",g),p.freezePane=!0}(t=e.model.rows).splice.apply(t,[o,0].concat(h)),d&&(r=e.model.maxHgts).splice.apply(r,[o,0].concat(d)),this.setRowColCount(u.startIndex,u.endIndex,e.model,"row"),o>e.model.usedRange.rowIndex?this.parent.setUsedRange(o+(h.length-1),e.model.usedRange.colIndex,e.model,!0):this.parent.setUsedRange(e.model.usedRange.rowIndex+h.length,e.model.usedRange.colIndex,e.model,!0);for(var m,v,y,C=o+h.length,b=void 0,x=void 0,S=this,w=0;w<=e.model.usedRange.colIndex;w++)!function(t){e.model.rows[C]&&e.model.rows[C].cells&&e.model.rows[C].cells[t]&&void 0!==(b=e.model.rows[C].cells[t]).rowSpan&&b.rowSpan<0&&void 0===b.colSpan&&(x={range:[C,t,C,t],insertCount:h.length,insertModel:"Row"},S.parent.notify("insertMerge",x),!p.freezePane&&x.range[0]<f&&x.range[2]>f&&(p.freezePane=!0)),y=He(o-1,t,e.model,!1,!0),m=y.style,b=He(o+1,t,e.model,!1,!0),(m||y.wrap)&&(m&&(v={},Object.keys(m).forEach(function(e){"borderLeft"!==e&&"borderRight"!==e&&"borderTop"!==e&&"borderBottom"!==e&&(v[e]=m[e])}),b.style&&S.checkBorder(b.style,e.model.rows[o-1].cells[t].style,v)),e.isUndoRedo&&!e.isRedo||h.forEach(function(e){e.cells||(e.cells=[]),e.cells[t]||(e.cells[t]={}),m&&(e.cells[t].style||(e.cells[t].style={}),Object.assign(e.cells[t].style,v)),y.wrap&&(e.cells[t].wrap=!0)}))}(w);p.sheetCount=e.model.rows.length}else if("Column"===e.modelType){if(void 0!==e.checkCount&&e.model.columns&&e.checkCount===e.model.columns.length)return;this.parent.notify("refreshInsertDelete",u),e.model=e.model,e.model.columns||(e.model.columns=[]),o&&!e.model.columns[o-1]&&(e.model.columns[o-1]={}),(n=e.model.columns).splice.apply(n,[o,0].concat(h));var I=this.parent.frozenColCount(e.model);if(o<I||o<=I&&e.freezePane){var E=e.model.frozenColumns+h.length-(o===I&&I>0?1:0);this.parent.setSheetPropertyOnMute(e.model,"frozenColumns",E),p.freezePane=!0}this.setRowColCount(u.startIndex,u.endIndex,e.model,"col"),o>e.model.usedRange.colIndex?this.parent.setUsedRange(e.model.usedRange.rowIndex,o+(h.length-1),e.model,!0):this.parent.setUsedRange(e.model.usedRange.rowIndex,e.model.usedRange.colIndex+h.length,e.model,!0),e.model.rows||(e.model.rows=[]);var R=[];e.columnCellsModel||(e.columnCellsModel=[]);for(w=0;w<h.length;w++)R.push(null);s=[];for(var N,F,b=void 0,A=void 0,w=0;w<=e.model.usedRange.rowIndex;w++){e.model.rows[w]?e.model.rows[w].cells||(e.model.rows[w].cells=[]):e.model.rows[w]={cells:[]},o&&!e.model.rows[w].cells[o-1]&&(e.model.rows[w].cells[o-1]={}),(i=e.model.rows[w].cells).splice.apply(i,[o,0].concat(e.columnCellsModel[w]&&e.columnCellsModel[w].cells?e.columnCellsModel[w].cells:R));C=o+h.length;if(e.model.rows[w].cells[C]&&void 0!==(b=e.model.rows[w].cells[C]).colSpan&&b.colSpan<0&&void 0===b.rowSpan&&s.push({range:[w,C,w,C],insertCount:R.length,insertModel:"Column"}),A=He(w,o-1,e.model,!1,!0),N=A.style,b=He(w,o+1,e.model,!1,!0),(N||A.wrap)&&(N&&(F={},Object.keys(N).forEach(function(e){"borderLeft"!==e&&"borderRight"!==e&&"borderTop"!==e&&"borderBottom"!==e&&(F[e]=N[e])}),b.style&&this.checkBorder(b.style,e.model.rows[w].cells[o-1].style,F)),!e.isUndoRedo||e.isRedo))for(D=o;D<C;D++)e.model.rows[w].cells[D]||(e.model.rows[w].cells[D]={}),N&&(e.model.rows[w].cells[D].style||(e.model.rows[w].cells[D].style={}),Object.assign(e.model.rows[w].cells[D].style,F)),A.wrap&&(e.model.rows[w].cells[D].wrap=!0)}s.forEach(function(e){a.parent.notify("insertMerge",e),!p.freezePane&&e.range[1]<I&&e.range[3]>I&&(p.freezePane=!0)}),p.sheetCount=e.model.columns.length}else{if(void 0!==e.checkCount&&e.checkCount===this.parent.sheets.length)return;for(var k=h,O=Le(this.parent),T=e.isFromUpdateAction,w=0;w<k.length;w++)if(k[w].name)for(var D=0;D<this.parent.sheets.length;D++)if(k[w].name===this.parent.sheets[D].name){k.splice(w,1),w--;break}if(!k.length)return;delete h[0].index,this.parent.createSheet(o,h);var L;e.activeSheetIndex?(p.activeSheetIndex=e.activeSheetIndex,this.parent.setProperties({activeSheetIndex:e.activeSheetIndex},!0)):!e.isAction&&e.start<this.parent.activeSheetIndex&&this.parent.setProperties({activeSheetIndex:this.parent.skipHiddenSheets(this.parent.activeSheetIndex)},!0),T&&this.parent.setProperties({activeSheetIndex:Se(this.parent,O)},!0),h.forEach(function(e){l&&a.updateRangeModel(e.ranges);var t=a.parent.viewport,r={sheet:e,resolveAfterFullDataLoaded:!0,indexes:[t.topIndex,t.leftIndex,t.bottomIndex,t.rightIndex],promise:new Promise(function(e){e(void 0)})};a.parent.notify(_r,r),L=e.id,a.parent.notify(Kr,{action:"addSheet",visibleName:e.name,sheetName:"Sheet"+L,sheetId:L})}),p.activeSheetIndex=e.activeSheetIndex,p.sheetCount=this.parent.sheets.length}"Sheet"!==e.modelType&&(this.insertConditionalFormats(e),this.parent.notify("refreshClipboard",{start:o,end:o+h.length-1,modelType:e.modelType,model:e.model,isInsert:!0}),p.activeSheetIndex=Se(this.parent,e.model.name)),this.parent.notify("insert",c)}},e.prototype.setRowColCount=function(e,t,r,n){var i=n+"Count";this.parent.setSheetPropertyOnMute(r,i,r[""+i]+(t-e+1)),r.id===this.parent.getActiveSheet().id&&this.parent.notify("updateRowColCount",{index:r[""+i]-1,update:n,isInsert:!0,start:e,end:t})},e.prototype.updateRangeModel=function(e){e.forEach(function(e){e.dataSource&&(e.startCell=e.startCell||"A1",e.showFieldAsHeader=void 0===e.showFieldAsHeader||e.showFieldAsHeader,e.template=e.template||"",e.address=e.address||"A1")})},e.prototype.checkBorder=function(e,t,r){e.borderLeft&&e.borderLeft===t.borderLeft&&(r.borderLeft=e.borderLeft),e.borderRight&&e.borderRight===t.borderRight&&(r.borderRight=e.borderRight),e.borderTop&&e.borderTop===t.borderTop&&(r.borderTop=e.borderTop),e.borderBottom&&e.borderBottom===t.borderBottom&&(r.borderBottom=e.borderBottom)},e.prototype.setInsertInfo=function(e,t,r,n,i){void 0===i&&(i="Row");var a=r=t+(r-1);e.ranges.forEach(function(e){e.info&&t<e.info[""+n]&&(e.info["insert"+i+"Range"]?e.info["insert"+i+"Range"].push([t,a]):e.info["insert"+i+"Range"]=[[t,a]],e.info[""+n]+=a-t+1)})},e.prototype.insertConditionalFormats=function(e){var t=e.model.conditionalFormats;if("delete"===e.prevAction)this.parent.setSheetPropertyOnMute(e.model,"conditionalFormats",e.conditionalFormats);else if(t)for(var r=0,n=t.length;r<n;r++)t[r].range=m(K(e,c(t[r].range),!e.isAction&&!e.isUndoRedo))},e.prototype.addEventListener=function(){this.parent.on(on,this.insertModel,this)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(on,this.insertModel)},e.prototype.getModuleName=function(){return"workbookinsert"},e}(),la=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.deleteModel=function(e){var t=this,r=this.parent.sheets.length;if("Sheet"!==e.modelType||1!==r){var n=e.modelType.toLowerCase()+"s";if(e.start=e.start,e.start>e.end){var i=e.start;e.start=e.end,e.end=i}var a={startIndex:e.start,endIndex:e.end,modelType:e.modelType,cancel:!1,isUndoRedo:e.isUndoRedo},o={eventArgs:a,action:"delete"};if(!e.isAction||(this.parent.notify(qr,o),!a.cancel)){var s,l,d=[],h=e.end-e.start+1,p={startIndex:e.start,endIndex:e.end,modelType:e.modelType,sheet:e.model,isDelete:!0},c=this.parent.scrollSettings.isFinite;if("Row"===e.modelType){if(void 0!==e.checkCount&&e.checkCount===e.model.usedRange.rowIndex)return;if(this.parent.notify("refreshInsertDelete",p),e.model=e.model,c){if(e.start>=e.model.rowCount)return;e.end>=e.model.rowCount&&(e.end=e.model.rowCount-1)}else{if(e.start>e.model.usedRange.rowIndex)return;e.end>e.model.usedRange.rowIndex&&(e.end-=e.end-e.model.usedRange.rowIndex)}this.setRowColCount(e.start,e.end,e.model,"row"),e.start<=e.model.usedRange.rowIndex&&(this.parent.setSheetPropertyOnMute(e.model,"usedRange",{rowIndex:e.model.usedRange.rowIndex-(e.end-e.start+1),colIndex:e.model.usedRange.colIndex}),e.model.usedRange.rowIndex<0&&this.parent.setSheetPropertyOnMute(e.model,"usedRange",{rowIndex:0,colIndex:e.model.usedRange.colIndex}));var u=this.parent.frozenRowCount(e.model);e.start<u&&(u=e.end<u?e.end-e.start+1:u-e.start,u=e.model.frozenRows-u,this.parent.setSheetPropertyOnMute(e.model,"frozenRows",u),a.freezePane=!0);var f=e.end+1,g=void 0,m=void 0;if(e.model.rows[e.start]&&e.model.rows[e.start].cells)for(y=0;y<=e.model.usedRange.colIndex;y++)e.model.rows[e.start].cells[y]&&void 0!==e.model.rows[e.start].cells[y].rowSpan&&e.model.rows[e.start].cells[y].rowSpan<0&&void 0===e.model.rows[e.start].cells[y].colSpan&&(m={range:[e.start,y,e.start,y]},this.parent.notify(mn,m),m.range=m.range,m.range[2]<=e.end&&((l=He(m.range[0],y,e.model))&&l.rowSpan>1&&(l.rowSpan-(m.range[2]-e.start+1)>1?Ue(m.range[0],y,e.model,{colSpan:l.rowSpan-(m.range[2]-e.start+1)},!0):delete e.model.rows[m.range[0]].cells[y].rowSpan),m=null)),e.model.rows[f]&&e.model.rows[f].cells&&e.model.rows[f].cells[y]&&void 0!==e.model.rows[f].cells[y].rowSpan&&e.model.rows[f].cells[y].rowSpan<0&&void 0===e.model.rows[f].cells[y].colSpan&&(m||(m={range:[f,y,f,y]},this.parent.notify(mn,m)),g=new Object,m.range=m.range,Object.assign(g,He(m.range[0],m.range[1],e.model)),g&&g.rowSpan&&(g.rowSpan>1||g.colSpan>1)&&((b=[])[1]=y,b[3]=g.colSpan>1?y+(g.colSpan-1):y,m.range=m.range,m.range[0]<e.start?(b[0]=b[2]=m.range[0],g.rowSpan-h>1&&(b[2]+=g.rowSpan-h-1)):(b[0]=b[2]=e.start,g.rowSpan-(e.end-m.range[0]+1)>1&&(b[2]+=g.rowSpan-(e.end-m.range[0]+1)-1)),d.push({range:b,isAction:!1,preventRefresh:!0,merge:!0,type:"All",skipChecking:!0}))),m=null;a.sheetCount=e.model.usedRange.rowIndex}else if("Column"===e.modelType){if(void 0!==e.checkCount&&e.checkCount===e.model.usedRange.colIndex)return;if(this.parent.notify("refreshInsertDelete",p),e.model=e.model,c){if(e.start>=e.model.colCount)return;e.end>=e.model.colCount&&(e.end=e.model.colCount-1)}else{if(e.start>e.model.usedRange.colIndex)return;e.end>e.model.usedRange.colIndex&&(e.end-=e.end-e.model.usedRange.colIndex)}this.setRowColCount(e.start,e.end,e.model,"col"),e.start<=e.model.usedRange.colIndex&&(this.parent.setSheetPropertyOnMute(e.model,"usedRange",{rowIndex:e.model.usedRange.rowIndex,colIndex:e.model.usedRange.colIndex-h}),e.model.usedRange.colIndex<0&&this.parent.setSheetPropertyOnMute(e.model,"usedRange",{rowIndex:e.model.usedRange.rowIndex,colIndex:0}));var v=this.parent.frozenColCount(e.model);e.start<v&&(v=e.end<v?e.end-e.start+1:v-e.start,v=e.model.frozenColumns-v,this.parent.setSheetPropertyOnMute(e.model,"frozenColumns",v),this.parent.updateTopLeftCell(),a.freezePane=!0),s=[];for(var f=e.end+1,g=void 0,m=void 0,y=0;y<=e.model.usedRange.rowIndex;y++)if(s.push({}),e.model.rows[y]&&e.model.rows[y].cells){if(e.model.rows[y].cells[e.start]&&void 0!==e.model.rows[y].cells[e.start].colSpan&&e.model.rows[y].cells[e.start].colSpan<0&&void 0===e.model.rows[y].cells[e.start].rowSpan&&(m={range:[y,e.start,y,e.start]},this.parent.notify(mn,m),m.range=m.range,m.range[3]<=e.end)){var C=He(y,m.range[1],e.model);C&&C.colSpan>1&&(C.colSpan-(m.range[3]-e.start+1)>1?Ue(y,m.range[1],e.model,{colSpan:C.colSpan-(m.range[3]-e.start+1)},!0):delete e.model.rows[y].cells[m.range[1]].colSpan),m=null}if(e.model.rows[y].cells[f]&&void 0!==e.model.rows[y].cells[f].colSpan&&e.model.rows[y].cells[f].colSpan<0&&void 0===e.model.rows[y].cells[f].rowSpan&&(m||(m={range:[y,f,y,f]},this.parent.notify(mn,m)),g=new Object,m.range=m.range,Object.assign(g,He(m.range[0],m.range[1],e.model)),g&&g.colSpan&&(g.colSpan>1||g.rowSpan>1))){var b=[];b[0]=y,b[2]=g.rowSpan>1?y+(g.rowSpan-1):y,m.range=m.range,m.range[1]<e.start?(b[1]=b[3]=m.range[1],g.colSpan-h>1&&(b[3]+=g.colSpan-h-1)):(b[1]=b[3]=e.start,g.colSpan-(e.end-m.range[1]+1)>1&&(b[3]+=g.colSpan-(e.end-m.range[1]+1)-1)),d.push({range:b,isAction:!1,preventRefresh:!0,merge:!0,type:"All",skipChecking:!0})}s[y].cells=e.model.rows[y].cells.splice(e.start,h),m=null}a.sheetCount=e.model.usedRange.colIndex,a.deletedCellsModel=s}else{if(e.end-e.start==this.parent.sheets.length-1||void 0!==e.checkCount&&e.checkCount===this.parent.sheets.length)return;this.parent.notify("refreshInsertDelete",p),a.sheetCount=this.parent.sheets.length,a.activeSheetIndex=this.parent.activeSheetIndex}for(var x=[],S="Row"===e.modelType&&e.start<e.model.maxHgts.length,w=e.model[""+n],y=e.start;y<=e.end;y++)"Sheet"===e.modelType&&w[y]&&this.parent.notify(Kr,{action:"deleteSheetTab",sheetId:w[y].id}),w[e.start]||e.start<w.length?(x.push(w[e.start]||{}),w.splice(e.start,1)):x.push({}),y===e.start&&(x[0].index=e.start),S&&e.model.maxHgts.splice(e.start,1);d.forEach(function(e){return t.parent.notify(gn,e)}),this.parent.notify("beforeDelete",e),"Sheet"!==e.modelType&&(this.parent.notify("refreshClipboard",e),a.refreshSheet=e.refreshSheet,a.activeSheetIndex=Se(this.parent,e.model.name),a.conditionalFormats=[],this.deleteConditionalFormats(e,a)),a.definedNames=p.definedNames,a.isAction=e.isAction,a.deletedModel=x,delete a.cancel,this.parent.notify("delete",o)}}},e.prototype.setRowColCount=function(e,t,r,n){var i=n+"Count",a=r[""+i];t>=a&&(t=a-1),t<e||(this.parent.setSheetPropertyOnMute(r,i,a-(t-e+1)),r.id===this.parent.getActiveSheet().id&&this.parent.notify("updateRowColCount",{index:a-1,update:n,isDelete:!0,start:e,end:t}))},e.prototype.deleteConditionalFormats=function(e,r){var n=e.model.conditionalFormats;if(n)for(var i=0;i<n.length;i++){r.conditionalFormats.push(t.extend({},n[i],null,!0));var a=c(n[i].range),o=c(e.model.selectedRange);"Column"===e.modelType&&o[1]<=a[1]&&o[3]>=a[3]||"Row"===e.modelType&&o[0]<=a[0]&&o[2]>=a[2]?(n.splice(n.indexOf(n[i]),1),i--):n[i].range=m($(e,a))}},e.prototype.addEventListener=function(){this.parent.on(sn,this.deleteModel,this)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(sn,this.deleteModel)},e.prototype.getModuleName=function(){return"workbookdelete"},e}(),da=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.highlightInvalidData=null,this.parent=null},e.prototype.addEventListener=function(){this.parent.on(ln,this.updateValidationHandler,this),this.parent.on("addHighlight",this.addHighlightHandler,this),this.parent.on("removeHighlight",this.removeHighlightHandler,this),this.parent.on("beforeInsert",this.beforeInsertDeleteHandler,this),this.parent.on("beforeDelete",this.beforeInsertDeleteHandler,this),this.parent.on("refreshInsertDelete",this.beforeInsertDeleteHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(ln,this.updateValidationHandler),this.parent.off("addHighlight",this.addHighlightHandler),this.parent.off("removeHighlight",this.removeHighlightHandler),this.parent.off("beforeInsert",this.beforeInsertDeleteHandler),this.parent.off("beforeDelete",this.beforeInsertDeleteHandler),this.parent.off("refreshInsertDelete",this.beforeInsertDeleteHandler))},e.prototype.updateValidationHandler=function(e){var r,n,i,a=this,o=e.range.lastIndexOf("!");if(o>-1){r=e.range.substring(0,o),e.range=e.range.substring(o+1);var s=Se(this.parent,r);n=Ae(this.parent,s),i=s===this.parent.activeSheetIndex}else n=this.parent.getActiveSheet(),i=!0;var l=this.getRangeWhenColumnSelected(e.range,n);r&&(e.range=r+"!"+l.range);var d,h,p,u,f,g,m,v=w(c(l.range)),y={colIdx:v[1]};if(i){p=this.parent.frozenRowCount(n);var C=this.parent.frozenColCount(n),b=this.parent,x=b.viewport||{};if(f=b.scrollSettings&&b.scrollSettings.enableVirtualization?[p+x.topIndex,C+x.leftIndex,x.bottomIndex,x.rightIndex]:[0,0,n.rowCount-1,n.colCount-1],l.isFullCol){var S=[[f[0],f[2]]];p&&S.push([c(n.topLeftCell)[0],p-1]),m=function(e){e.isHighlighted&&(y.colIdx>=f[1]&&y.colIdx<=f[3]||y.colIdx<C)&&!ht(n,y.colIdx)&&S.forEach(function(t){for(y.rowIdx=t[0];y.rowIdx<=t[1];y.rowIdx++)tt(n,y.rowIdx)||(y.cell=He(y.rowIdx,y.colIdx,n,!1,!0),y.validation=y.cell.validation?y.cell.validation:e,a.parent.notify("updateHighlight",y))})}}g=function(e){e.isHighlighted&&u&&(y.colIdx>=f[1]&&y.colIdx<=f[3]||y.colIdx<C)&&!ht(n,y.colIdx)&&a.parent.notify("updateHighlight",y)}}var I,E,R,N;if(e.isRemoveValidation)i&&((R=c(n.activeCell))[0]>=v[0]&&R[1]>=v[1]&&R[0]<=v[2]&&R[1]<=v[3]&&(E=(O=He(R[0],R[1],n,!1,!0).validation||pt(n.columns[v[1]],R[0],R[1])&&n.columns[R[1]].validation)&&"List"===O.type),y.isRemoveValidation=!0,y.isRemoveHighlightedData=!0);else{e.isAction&&this.highlightInvalidData&&(I={isHighlighted:this.highlightInvalidData}),"List"===e.rules.type?(R=c(n.activeCell),E=i&&R[0]>=v[0]&&R[1]>=v[1]&&R[0]<=v[2]&&R[1]<=v[3],e.rules.value1&&(e.rules.value1=e.rules.value1.trim(),e.rules.value1[e.rules.value1.length-1]===this.parent.listSeparator&&(e.rules.value1=e.rules.value1.substring(0,e.rules.value1.length-1)))):"Custom"!==e.rules.type||t.isNullOrUndefined(e.rules.value2)||delete e.rules.value2,i&&(y.removeOnValidData=!0);var F=k(e.rules.value1),A=k(e.rules.value2);N=function(t){F&&(y.validation.value1=q([t,y.colIdx,t,y.colIdx],v,n,a.parent,{formula:e.rules.value1})),A&&(y.validation.value2=q([t,y.colIdx,t,y.colIdx],v,n,a.parent,{formula:e.rules.value2}))}}for(y.colIdx;y.colIdx<=v[3];y.colIdx++){if(l.isFullCol){if(!e.isRemoveValidation){y.validation=Object.assign({},e.rules,I),N(0),n.columns[y.colIdx]||(n.columns[y.colIdx]={}),n.columns[y.colIdx].validation=y.validation,i&&m(y.validation);continue}(d=n.columns[y.colIdx])&&d.validation&&(i&&m(d.validation),delete d.validation)}for(y.rowIdx=v[0];y.rowIdx<=v[2];y.rowIdx++)u=i&&(y.rowIdx>=f[0]&&y.rowIdx<=f[2]||y.rowIdx<p)&&!tt(n,y.rowIdx),e.isRemoveValidation?((d=n.columns[y.colIdx])&&d.validation&&(y.rowIdx===v[2]&&(d.validation.address=H(d.validation.address,[v[0],y.colIdx,v[2],y.colIdx],y.colIdx)),i&&g(d.validation)),(h=He(y.rowIdx,y.colIdx,n))&&h.validation&&!Y(this.parent,n,{cell:{validation:{}},rowIdx:y.rowIdx,colIdx:y.colIdx})&&(i&&g(h.validation),delete h.validation)):(y.validation=Object.assign({},e.rules,I),N(y.rowIdx),Y(this.parent,n,{cell:{validation:y.validation},rowIdx:y.rowIdx,colIdx:y.colIdx})||i&&(y.cell=He(y.rowIdx,y.colIdx,n),g(y.validation)))}if(E){var O=(h=He(R[0],R[1],n,!1,!0)).validation;O||(O=pt(n.columns[R[1]],R[0],R[1])?n.columns[R[1]].validation:{}),this.parent.notify("addListValidationDropdown",{validation:O,cell:h,rowIdx:R[0],colIdx:R[1],isRefresh:!0})}},e.prototype.addHighlightHandler=function(e){e.isAction&&(this.highlightInvalidData=!0),this.invalidDataHandler(e.range)},e.prototype.removeHighlightHandler=function(e){e.isAction&&(this.highlightInvalidData=null),this.invalidDataHandler(e.range,!0)},e.prototype.invalidDataHandler=function(e,t){var r,n,i,a,o,s,l,d,h,p,u,f=this,g=this.parent,m=this.parent.getActiveSheet(),v=this.parent.frozenRowCount(m),y=this.parent.frozenColCount(m),b=g.scrollSettings&&g.scrollSettings.enableVirtualization?g.viewport?[v+g.viewport.topIndex,y+g.viewport.leftIndex,g.viewport.bottomIndex,g.viewport.rightIndex]:[]:[0,0,m.rowCount-1,m.colCount-1],x=function(e,n){s&&(a>=b[1]&&a<=b[3]||a<y)&&!ht(m,a)&&f.parent.notify("updateHighlight",{isRemoveHighlightedData:t,rowIdx:i,colIdx:a,cell:r,validation:e,removeOnValidData:!0,col:n})};u=t?function(e,t){e.isHighlighted&&(t&&delete e.isHighlighted,x(e))}:function(e,t,r){t&&(e.isHighlighted=!0),x(e,r)};var I=function(){for(i=o[0];i<=o[2];i++)for(s=l&&(i>=b[0]&&i<=b[2]||i<v)&&!tt(m,i),d&&(p=Qe(m,i),h=Math.max(p&&p.cells?p.cells.length-1:null,m.columns.length-1,o[3])),a=o[1];a<=h;a++)r=He(i,a,m,!1,!0),n=m.columns[a],r.validation?u(r.validation,!0,n):pt(n,i,a)&&u(n.validation,i===o[2])};if(e){if(e.includes("!")){var E=S(this.parent,e);m=Ae(this.parent,E),e=C(e),l=E===this.parent.activeSheetIndex}else l=!0;o=w(c(this.getRangeWhenColumnSelected(se(m,e),m).range)),h=o[3],I()}else d=!0,this.parent.sheets.forEach(function(e,t){m=e,o=[0,0,Math.max(m.rows.length-1,b[2]),Math.max(m.usedRange.colIndex,b[3])],l=t===f.parent.activeSheetIndex,I()})},e.prototype.beforeInsertDeleteHandler=function(e){var r,n=this;if("Sheet"===e.modelType){if("refreshInsertDelete"!==e.name)return;r=!0}else if("refreshInsertDelete"===e.name)return;var i,a,o,s,l="beforeInsert"===e.name;if(l)o=Ae(this.parent,e.activeSheetIndex),a=e.index+(e.model.length-1),i={insertDeleteArgs:{startIndex:e.index,endIndex:a,modelType:e.modelType,isInsert:!0,sheet:o},sheetIdx:e.activeSheetIndex},s=e.index-1;else if(r){var d=[],h=void 0,p={action:"getSheetInfo",sheetInfo:[]};this.parent.notify(Kr,p);for(var c=e.startIndex;c<=e.endIndex;c++){h=this.parent.sheets[c].id;for(var u=0;u<p.sheetInfo.length;u++)if(p.sheetInfo[u].index===h){d.push(p.sheetInfo[u].sheet);break}}i={sheetNames:d}}else o=e.model,i={insertDeleteArgs:{startIndex:e.start,modelType:e.modelType,endIndex:e.end,sheet:o},sheetIdx:we(this.parent,o.id)};var f,g,m,v,y,C,b,x=function(e){!k(e.value1)||i.otherSheet&&!e.value1.includes(o.name)||(i.cell={formula:e.value1},n.parent.notify("getUpdatedFormulaOnInsertDelete",i),e.value1=i.cell.formula),!k(e.value2)||i.otherSheet&&!e.value2.includes(o.name)||(i.cell={formula:e.value2},n.parent.notify("getUpdatedFormulaOnInsertDelete",i),e.value2=i.cell.formula)},S="Column"===e.modelType,w=function(r,n){if(r){i.insertDeleteArgs.forceUpdate=!0;for(var s=e.index;s<=a;s++)r=t.extend({},r),x(r),n?st(o,s,{validation:r}):S?Ue(y,s,o,{validation:r},!0):Ue(s,C,o,{validation:r},!0);delete i.insertDeleteArgs.forceUpdate}};this.parent.sheets.forEach(function(t,n){if(r){if(n>=e.startIndex&&n<=e.endIndex)return}else n===i.sheetIdx?(b=l,delete i.otherSheet,delete i.formulaSheet):(i.otherSheet=!0,i.formulaSheet=t,b=!1);for(m=t.usedRange.rowIndex+1,C=0,v=t.usedRange.colIndex+1;C<v;C++)if(!(b&&S&&C>=e.index&&C<=a))for((g=t.columns&&t.columns[C])&&g.validation&&(x(g.validation),b&&S&&s===C&&w(g.validation,!0)),y=0;y<m;y++)(f=He(y,C,t,!1,!0)).validation&&(!b||S||y<e.index||y>a)&&(x(f.validation),b&&s===(S?C:y)&&w(f.validation))})},e.prototype.getRangeWhenColumnSelected=function(e,t){var r,n=e.split(":");return e.match(/\D/g)&&!e.match(/[0-9]/g)?(n[0]+=1,n[1]+=t.rowCount,e=n[0]+":"+n[1],r=!0):!e.match(/\D/g)&&e.match(/[0-9]/g)&&(n[0]="A"+n[0],n[1]=g(0,t.colCount-1).replace(/[0-9]/g,"")+n[1],e=n[0]+":"+n[1]),{range:e,isFullCol:r}},e.prototype.getModuleName=function(){return"workbookDataValidation"},e}(),ha=function(){return(ha=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}).apply(this,arguments)},pa=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on("find",this.find,this),this.parent.on(hn,this.replace,this),this.parent.on(pn,this.replaceAll,this),this.parent.on("count",this.totalCount,this),this.parent.on("findAllValues",this.findAllValues,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("find",this.find),this.parent.off(hn,this.replace),this.parent.off(pn,this.replaceAll),this.parent.off("count",this.totalCount),this.parent.off("findAllValues",this.findAllValues))},e.prototype.find=function(e){e.sheetIndex=t.isUndefined(e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex;var r=this.parent.sheets[e.sheetIndex],n=c(r.activeCell),i={startRow:n[0],startCol:n[1],findVal:e.isCSen?e.value:e.value.toLowerCase(),activeCell:n};("By Row"===e.searchBy?i.startRow>r.usedRange.rowIndex:i.startCol>r.usedRange.colIndex)?"next"===e.findOpt?i.startRow=i.startCol=0:(i.startRow=r.usedRange.rowIndex,i.startCol=r.usedRange.colIndex):"By Row"===e.searchBy?i.startCol>r.usedRange.colIndex&&("next"===e.findOpt?(++i.startRow>r.usedRange.rowIndex&&(i.startRow=0),i.startCol=0):(--i.startRow<0&&(i.startRow=r.usedRange.rowIndex),i.startCol=r.usedRange.colIndex)):i.startRow>r.usedRange.rowIndex&&("next"===e.findOpt?(++i.startCol>r.usedRange.colIndex&&(i.startRow=0),i.startRow=0):(--i.startCol<0&&(i.startCol=r.usedRange.colIndex),i.startRow=r.usedRange.colIndex)),"Workbook"===e.mode?(i.sheets=this.parent.sheets,i.sheetIdx=e.sheetIndex):(i.sheets=[r],i.sheetIdx=0);var a,o=e.showDialog&&this.parent.element&&this.parent.element.querySelector(".e-header-panel");o&&(a=(o.offsetHeight||(r.showHeaders?30:0))+1),e.localeObj=t.getNumericObject(this.parent.locale),"next"===e.findOpt?this.findNext(e,i):this.findPrevious(e,i),e.showDialog&&this.parent.notify("findToolDlg",{findValue:e.value,isPublic:!0,headerHgt:a})},e.prototype.findNext=function(e,t){var r=this,n=function(n,i,a){for(var o,s,l=n;l<=i&&(o=t.sheets[l],!(s=l===t.sheetIdx?a?r.findNextOnSheet(e,t.startRow,t.startCol,t.findVal,o,void 0,t.activeCell):r.findNextOnSheet(e,0,0,t.findVal,o,"By Row"===e.searchBy?t.startRow:t.startCol):r.findNextOnSheet(e,0,0,t.findVal,o)));l++);return s},i=n(t.sheetIdx,t.sheets.length-1,!0);i||(i=n(0,t.sheetIdx)),i?this.parent.notify(dn,{address:i}):this.parent.notify("showFindAlert",null)},e.prototype.findNextOnSheet=function(e,t,r,n,i,a,o){var s,l,d;if("By Row"===e.searchBy){void 0===a&&(a=i.rows.length-1);var h=void 0;for(l=t;l<=a;l++)if(!tt(i,l))for(d=o&&l===t?r:0,h=i.rows[l]&&i.rows[l].cells&&i.rows[l].cells.length,d;d<h;d++)if(!ht(i,d)&&(s=this.checkMatch(e,n,l,d,i,o)))return s}else{void 0===a&&(a=i.usedRange.colIndex);var p=i.rows&&i.rows.length-1;for(d=r;d<=a;d++)if(!ht(i,d))for(l=o&&d===r?t:0;l<=p;l++)if(!tt(i,l)&&(s=this.checkMatch(e,n,l,d,i,o)))return s}return s},e.prototype.findPrevious=function(e,t){var r,n=this,i=function(r,i,a){for(var o,s,l=r;l>=i&&(o=t.sheets[l],!(s=l===t.sheetIdx?a?n.findPrevOnSheet(e,t.startRow,t.startCol,0,0,t.findVal,o,t.activeCell):"By Row"===e.searchBy?n.findPrevOnSheet(e,o.usedRange.rowIndex,o.usedRange.colIndex,t.startRow,0,t.findVal,o):n.findPrevOnSheet(e,o.usedRange.rowIndex,o.usedRange.colIndex,0,t.startCol,t.findVal,o):n.findPrevOnSheet(e,o.usedRange.rowIndex,o.usedRange.colIndex,0,0,t.findVal,o)));l--);return s};(r=i(t.sheetIdx,0,!0))||(r=i(t.sheets.length-1,t.sheetIdx)),r?this.parent.notify(dn,{address:r}):this.parent.notify("showFindAlert",null)},e.prototype.findPrevOnSheet=function(e,t,r,n,i,a,o,s){var l,d,h;if("By Row"===e.searchBy){for(h=t;h>=n;h--)if(!tt(o,h))for(d=s&&h===t?r:o.rows[h]&&o.rows[h].cells&&o.rows[h].cells.length-1;d>=i;d--)if(!ht(o,d)&&(l=this.checkMatch(e,a,h,d,o,s)))return l}else for(d=r;d>=i;d--)if(!ht(o,d))for(h=s&&d===r?t:o.rows&&o.rows.length-1;h>=n;h--)if(!tt(o,h)&&(l=this.checkMatch(e,a,h,d,o,s)))return l;return l},e.prototype.checkMatch=function(e,t,r,n,i,a){if(a&&r===a[0]&&n===a[1])return null;var o=He(r,n,i,!1,!0);if(i.isProtected&&!i.protectSettings.selectCells&&i.protectSettings.selectUnLockedCells&&U(o,ot(i,n)))return null;var s=function(a){if(a)if(e.isCSen||(a=a.toLowerCase()),e.isEMatch){if(a===t)return i.name+"!"+g(r,n)}else if(a.includes(t))return i.name+"!"+g(r,n);return null},l=this.getDisplayText(o,r,n,e.localeObj),d=s(l);return d||!(o=He(r,n,i,!1,!0)).format||qe(o.format,!0)||l.includes("%")||(d=s(this.getCellVal(o,e.localeObj))),d},e.prototype.replace=function(e){var r=this,n=t.isUndefined(e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex,i=Ae(this.parent,e.sheetIndex);if(i.isProtected)return void this.parent.notify("editAlert",null);var a,o=c(e.address||i.activeCell),s=He(o[0],o[1],i,!1,!0),l=this.parent.getDisplayText(s).toString();e.value=e.value.toString(),e.isCSen||(a=e.value.toLowerCase());var d=t.getNumericObject(this.parent.locale),h=function(t){var n;if(e.isCSen)n=e.isEMatch?l===e.value&&e.replaceValue:l.indexOf(e.value)>-1&&l.replace(e.value,e.replaceValue);else if(e.isEMatch)n=l.toLowerCase()===a&&e.replaceValue;else{var i=RegExp;n=l.toLowerCase().includes(a)&&l.replace(new i(e.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"ig"),e.replaceValue)}return t||p||!s.format||qe(s.format,!0)||l.includes("%")||(l=r.getCellVal(s,d))&&(n=h(!0)),n},p=h();if(p||(e.findOpt="next",this.find(e),o=u(i.activeCell),s=He(o[0],o[1],i,!1,!0),l=this.parent.getDisplayText(s).toString(),p=h())){if(ae(He(o[0],o[1],i),ot(i,o[1]),Qe(i,o[0])))return void this.parent.notify("readonlyAlert",null);var f={address:i.name+"!"+g(o[0],o[1]),cancel:!1,compareValue:e.value,replaceValue:e.replaceValue,sheetIndex:n};if(e.isAction){if(this.parent.notify(qr,{action:"beforeReplace",eventArgs:f}),f.cancel)return;delete f.cancel}Y(this.parent,i,{cell:{value:p},rowIdx:o[0],colIdx:o[1],uiRefresh:!0,checkCF:!0,valChange:!0}),e.isAction&&this.parent.notify("actionComplete",{action:"replace",eventArgs:f})}},e.prototype.replaceAll=function(e){var r,n,i,a,o=this,s="Sheet"===e.mode?e.sheetIndex:0,l=this.parent.sheets[s],d=l.usedRange.rowIndex,h=0,p=l.usedRange.colIndex,c=0,f=[],m=e.isAction,v=u(l.activeCell),y=ha({addressCollection:f,cancel:!1},e),C=0,b=function(t,r,n){requestAnimationFrame?requestAnimationFrame(function(){if(!y.cancel&&y.addressCollection[r]){var n=u(y.addressCollection[r].substring(y.addressCollection[r].lastIndexOf("!")+1)),i=S(o.parent,y.addressCollection[r]);Y(o.parent,o.parent.sheets[i],{cell:{value:t},rowIdx:n[0],uiRefresh:!0,checkCF:!0,colIdx:n[1],valChange:!0,skipFormatCheck:e.skipFormatCheck}),v[0]===n[0]&&v[1]===n[1]&&o.parent.notify("formulaBarOperation",{action:"refreshFormulabar",cell:He(n[0],n[1],o.parent.sheets[i],!1,!0)}),r===y.addressCollection.length-1&&m&&o.parent.notify("actionComplete",{action:"replaceAll",eventArgs:y})}}):o.parent.updateCellDetails({value:t},y.addressCollection[r],void 0,void 0,!0),n.formula||C++},x=function(t,r){var n;if(t)if(e.isCSen)e.isEMatch?t===e.value&&(b(e.replaceValue,f.length,r),f.push(l.name+"!"+g(h,c)),n=!0):t.indexOf(e.value)>-1&&(b(t.replace(e.value,e.replaceValue),f.length,r),f.push(l.name+"!"+g(h,c)),n=!0);else if(e.isEMatch)t.toLowerCase()===e.value&&(b(e.replaceValue,f.length,r),f.push(l.name+"!"+g(h,c)),n=!0);else{var a=t.toLowerCase();if(t===e.value||a.indexOf(e.value.toString().toLowerCase())>-1||a===e.value||t===e.value||a.indexOf(e.value)>-1){var o=RegExp;i=new o(e.value.toString().replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"ig"),b(t.replace(i,e.replaceValue),f.length,r),f.push(l.name+"!"+g(h,c)),n=!0}}return n},w=t.getNumericObject(this.parent.locale);for(h;h<=d+1;h++){if(c>p&&h>d&&"Workbook"===e.mode){if(s++,!(l=this.parent.sheets[s]))break;c=0,h=0,p=l.usedRange.colIndex,d=l.usedRange.rowIndex}if(n=l.rows[h])for(c===p+1&&(c=0),c;c<=p;c++)if(n&&(a=n.cells&&n.cells[c])){if(ae(a,ot(l,c),n))continue;x(r=this.getDisplayText(a,h,c,w).toString(),a)||!a.format||qe(a.format,!0)||r.includes("%")||x(this.getCellVal(n.cells[c],w),a)}}f.length&&m?(this.parent.notify("actionBegin",{action:"beforeReplaceAll",eventArgs:y}),y.cancel||this.parent.notify("replaceAllDialog",{count:C,replaceValue:y.replaceValue})):this.parent.notify("replaceAllDialog",{count:C,replaceValue:y.replaceValue})},e.prototype.getDisplayText=function(e,t,r,n){if(!e)return"";if(!e.value&&0!==e.value)return e.hyperlink?"string"==typeof e.hyperlink?e.hyperlink:e.hyperlink.address||"":"";var i=e.value.toString();if(e.format||i.includes(n.dateSeparator)){var a={value:e.value,format:e.format,formattedText:e.value,cell:e,rowIndex:t,colIndex:r};return this.parent.notify(Wr,a),a.formattedText}return i},e.prototype.getCellVal=function(e,t){return fe(e.value)?"."!==t.decimal?e.value.toString().split(".").join(t.decimal):e.value.toString():e.value?e.value.toString().toLowerCase():""},e.prototype.totalCount=function(e){var r,n=this,i=this.parent.sheets[e.sheetIndex],a=u(i.activeCell),o=0,s=0,l=e.value.toLowerCase(),d=t.getNumericObject(this.parent.locale);i.rows.filter(function(e,t){return e&&e.cells&&!e.isFiltered&&!e.hidden&&e.cells.filter(function(e,h){!e||!e.value&&0!==e.value||ht(i,h)||i.isProtected&&!i.protectSettings.selectCells&&U(e,ot(i,h))||((r=n.getDisplayText(e,t,h,d).toLowerCase()).includes(l)||e.format&&!qe(e.format,!0)&&!r.includes("%")&&n.getCellVal(e,d).includes(l))&&(o++,(t===a[0]&&h>=a[1]||t>a[0])&&s++)})});var h=o;(o=h-(s-=1))>h&&(o=h),0===o||this.parent.getDisplayText(He(a[0],a[1],i)).toLowerCase().includes(l)||(o-=1),e.findCount=o+" of "+h},e.prototype.findAllValues=function(e){var r,n=e.sheetIndex,i=this.parent.sheets[n],a=i.usedRange.rowIndex,o=0,s=0,l=i.usedRange.colIndex,d=0,h=this.parent.sheets.length,p=e.sheetIndex;for(o;o<=a+1;o++){if(1!==p&&e.sheetIndex===h&&(n=1),o>a&&d>l&&"Workbook"===e.mode){if(++n>h-1&&(n=0),p===n)return void 0;(i=this.parent.sheets[n])&&(o=0,d=0,l=i.usedRange.colIndex,a=i.usedRange.rowIndex)}if(!t.isNullOrUndefined(i)&&i.rows[o]){var c=i.rows[o];for(d===l+2&&(d=0),d;d<=l+1;d++)if(c&&c.cells&&c.cells[d]){var u=i.rows[o].cells[d];if(u&&!t.isNullOrUndefined(u.value)&&""!==u.value&&(!i.isProtected||i.protectSettings.selectCells||i.protectSettings.selectUnLockedCells&&!U(u,ot(i,d)))){var f=void 0;if(f=u.format?this.parent.getDisplayText(i.rows[o].cells[d]).toString():u.value.toString(),e.isCSen&&e.isEMatch)f===e.value&&(r=i.name+"!"+g(o,d),e.findCollection.push(r),s++);else if(e.isCSen&&!e.isEMatch){v=f.indexOf(e.value)>-1;(f===e.value||v)&&(r=i.name+"!"+g(o,d),e.findCollection.push(r),s++)}else if(!e.isCSen&&e.isEMatch)(m=f.toString().toLowerCase())===e.value.toLowerCase()&&(r=i.name+"!"+g(o,d),e.findCollection.push(r),s++);else if(!e.isCSen&&!e.isEMatch){var m=f.toString().toLowerCase(),v=m.indexOf(e.value.toLowerCase())>-1;(m===e.value||f===e.value||v||f===e.value)&&(r=i.name+"!"+g(o,d),e.findCollection.push(r),s++)}}}}}},e.prototype.getModuleName=function(){return"workbookfindAndReplace"},e}(),ca=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.protectsheetHandler=function(e){var r=t.isNullOrUndefined(e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex,n=Ae(this.parent,r);this.parent.setSheetPropertyOnMute(n,"isProtected",!0),this.parent.setSheetPropertyOnMute(n,"protectSettings",{selectCells:e.protectSettings.selectCells,formatCells:e.protectSettings.formatCells,formatColumns:e.protectSettings.formatColumns,formatRows:e.protectSettings.formatRows,insertLink:e.protectSettings.insertLink,selectUnLockedCells:e.protectSettings.selectUnLockedCells}),this.parent.notify("protectSheet",{sheetIndex:r,triggerEvent:e.triggerEvent}),this.parent.notify("updateToggleItem",{props:"Protect"}),n.password=e.password?e.password:"",n.columns.forEach(function(e){e&&t.isUndefined(e.isLocked)&&(e.isLocked=!0)})},e.prototype.unprotectsheetHandler=function(e){var r=this.parent.getActiveSheet();t.isNullOrUndefined(e.sheet)||(r=this.parent.sheets[e.sheet]),r.isImportProtected&&(r.isImportProtected=!1),r.protectSettings.formatCells=r.protectSettings.formatColumns=!1,r.protectSettings.formatRows=r.protectSettings.selectCells=!1,this.parent.setSheetPropertyOnMute(r,"isProtected",!1),this.parent.notify("protectSheet",r.protectSettings),this.parent.notify("updateToggleItem",{props:"Protect"})},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on(un,this.protectsheetHandler,this),this.parent.on("unprotectsheetHandler",this.unprotectsheetHandler,this),this.parent.on(fn,this.lockCells,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(un,this.protectsheetHandler),this.parent.off(fn,this.lockCells),this.parent.off(un,this.unprotectsheetHandler))},e.prototype.lockCells=function(e){var t=this.parent.getAddressInfo(e.range),r=w(t.indices),n=Ae(this.parent,t.sheetIndex),i=!!e.isLocked&&e.isLocked;if(0===r[0]&&r[2]===n.rowCount-1)for(a=r[1];a<=r[3];a++)st(n,a,{isLocked:e.isLocked});for(var a=r[0];a<=r[2];a++)for(var o=r[1];o<=r[3];o++)Ue(a,o,n,{isLocked:i},!0);e.triggerEvent&&this.parent.notify("actionComplete",{action:"lockCells",eventArgs:e})},e.prototype.getModuleName=function(){return"workbookProtectSheet"},e}(),ua=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.merge=function(e){e.sheetIndex=t.isUndefined(e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex,e.isAction&&(this.parent.notify("actionBegin",{eventArgs:e,action:"merge"}),e.model||(e.model=[])),"string"==typeof e.range&&(e.range=c(e.range));var r=e.range=w(e.range);if(e.skipChecking||this.mergedRange(e),e.merge&&"All"!==e.type){if("Horizontally"===e.type)for(var n=e.range[0],i=e.range[2];n<=i;n++)e.range=[n,r[1],n,r[3]],this.mergeAll(e,n-r[0]);else if("Vertically"===e.type)for(var a=e.range[1],i=e.range[3];a<=i;a++)e.range=[r[0],a,r[2],a],this.mergeAll(e,0,a-r[1])}else this.mergeAll(e),e.refreshRibbon&&this.parent.notify("activeCellChanged",null);e.range=r,this.parent.setUsedRange(e.range[2],e.range[3]),e.isAction&&this.parent.notify("actionComplete",{eventArgs:e,action:"merge"}),e.sheetIndex===this.parent.activeSheetIndex&&(this.parent.notify("selectRange",{address:Ae(this.parent,e.sheetIndex).selectedRange,skipChecking:!0}),this.parent.chartColl&&this.parent.chartColl.length&&this.parent.notify("refreshChart",{range:e.range}))},e.prototype.mergeAll=function(e,r,n){void 0===r&&(r=0),void 0===n&&(n=0);var i,a=0;e.range=e.range;for(var o,s,l,d,h,p=t.isUndefined(e.sheetIndex)?this.parent.getActiveSheet():Ae(this.parent,e.sheetIndex),c={cell:new Object,rowIdx:e.range[0],colIdx:e.range[1],valChange:!e.merge,preventEvt:!0,uiRefresh:!e.preventRefresh,skipFormatCheck:!0},u=e.range[0],f=r;u<=e.range[2];u++,f++){o=0,e.isAction&&!e.model[f]&&e.model.push({cells:[]});for(var g=e.range[1],m=n;g<=e.range[3];g++,m++){if((i=He(u,g,p))&&(i.value||0===i.value||i.formula)&&!s&&(s=i.formula||i.value,d=i.format),e.isAction&&e.merge&&(h=e.model[f].cells[m]={},t.extend(h,i,null,!0)),i){delete i.rowSpan,delete i.colSpan,h=!e.merge&&!e.isAction&&e.model&&e.model[f]&&e.model[f].cells[m];var v="Manual"===this.parent.calculationMode&&this.parent.getActiveSheet().isSheetCalculated&&!t.isNullOrUndefined(i.value)&&""!==i.value;h?(v&&(h.value=i.value),Ue(u,g,p,h)):e.model&&e.model[f].cells[m]&&v&&(e.model[f].cells[m].value=i.value)}if(u===e.range[0]&&g===e.range[1]){if(e.merge){e.range[3]-e.range[1]>0&&(c.cell.colSpan=e.range[3]-e.range[1]+1),e.range[2]-e.range[0]>0&&(c.cell.rowSpan=e.range[2]-e.range[0]+1),Y(this.parent,p,c),c.valChange=c.mergedCells=!0;continue}}else c.rowIdx=u,c.colIdx=g,c.cell={},e.merge&&(u!==e.range[0]&&(c.cell.rowSpan=-a),g!==e.range[1]&&(o++,c.cell.colSpan=-o));Y(this.parent,p,c),l||(l=c.isFormulaDependent)}a++}if(e.merge)if(s||0===s){delete c.mergedCells,c.cell={};var y=He(e.range[0],e.range[1],p);y&&(y.value||y.formula)||(k(s)?c.cell.formula=s:c.cell.value=s,d&&(c.cell.format=d)),c.rowIdx=e.range[0],c.colIdx=e.range[1],Y(this.parent,p,c)}else e.preventRefresh||this.parent.notify("applyMerge",{rowIdx:e.range[0],colIdx:e.range[1]});e.preventRefresh||this.refreshCF(p,e.range.slice(),l,e.merge)},e.prototype.refreshCF=function(e,t,r,n){e.conditionalFormats&&e.conditionalFormats.length&&(n?this.parent.notify(Cn,{indexes:[t[0],t[1]],refreshAll:r,isAction:!0}):this.parent.notify(Cn,{indexes:t,refreshAll:r,isAction:!0}))},e.prototype.activeCellRange=function(e){e.range=e.range;var r=this.parent.getActiveSheet(),n=He(e.range[0],e.range[1],r);n&&(!t.isNullOrUndefined(n.rowSpan)&&n.rowSpan<0&&(e.range[0]+=n.rowSpan,e.insertCount&&(e.range[0]-=e.insertCount)),!t.isNullOrUndefined(n.colSpan)&&n.colSpan<0&&(e.range[1]+=n.colSpan,e.insertCount&&(e.range[1]-=e.insertCount)),(n=He(e.range[0],e.range[1],r))&&(n.rowSpan>1&&(e.range[0]+(n.rowSpan-1)>=e.range[2]||e.insertCount)&&(e.range[2]=e.range[0]+(n.rowSpan-1)),n.colSpan>1&&(e.range[1]+(n.colSpan-1)>=e.range[3]||e.insertCount)&&(e.range[3]=e.range[1]+(n.colSpan-1))))},e.prototype.mergedRange=function(e){"string"==typeof e.range&&(e.range=c(e.range)),e.range[0]<=e.range[2]&&e.range[1]<=e.range[3]?this.forward(e):e.range[0]>=e.range[2]&&e.range[1]>=e.range[3]?this.reverse(e):e.range[0]<e.range[2]&&e.range[1]>e.range[3]?this.forwardReverse(e):e.range[0]>e.range[2]&&e.range[1]<e.range[3]&&this.reverseForward(e)},e.prototype.forward=function(e){e.range=e.range;var r,n,i=t.isUndefined(e.sheetIndex)?this.parent.getActiveSheet():Ae(this.parent,e.sheetIndex),a=He(e.range[0],e.range[1],i),o=r=e.range[0],s=n=e.range[1];if(a&&(!t.isNullOrUndefined(a.rowSpan)&&a.rowSpan<0&&(o=r=e.range[0]+a.rowSpan),!t.isNullOrUndefined(a.colSpan)&&a.colSpan<0&&(s=n=e.range[1]+a.colSpan),(a=He(o,s,i))&&(a.rowSpan>1&&(r+=a.rowSpan-1,o+(a.rowSpan-1)>=e.range[2]&&(e.range[2]=e.range[0],e.range[2]=o+(a.rowSpan-1))),a.colSpan>1&&(n+=a.colSpan-1,s+(a.colSpan-1)>=e.range[3]&&(e.range[3]=e.range[1],e.range[3]=s+(a.colSpan-1))))),e.range[0]=o,e.range[1]=s,e.range[0]===o&&e.range[1]===s&&e.range[2]===r&&e.range[3]===n&&(e.isActiveCell=!0),!e.skipChecking){for(h=e.range[1];h<=e.range[3];h++)(a=He(e.range[2],h,i))&&(o=e.range[2],s=h,!t.isNullOrUndefined(a.colSpan)&&a.colSpan<0&&(s+=a.colSpan)<e.range[1]&&(e.range[1]=s),!t.isNullOrUndefined(a.rowSpan)&&a.rowSpan<0&&(o+=a.rowSpan)<e.range[0]&&(e.range[0]=o),(a=He(o,s,i))&&(a.colSpan>1&&s+(a.colSpan-1)>e.range[3]&&(e.range[3]=s,e.range[3]=s+(a.colSpan-1)),a.rowSpan>1&&o+(a.rowSpan-1)>e.range[2]&&(e.range[2]=o,e.range[2]=o+(a.rowSpan-1))));for(var l,d,h=e.range[1];h<=e.range[3];h++)(a=He(e.range[0],h,i))&&(d=h,l=e.range[0],!t.isNullOrUndefined(a.colSpan)&&a.colSpan<0&&(d+=a.colSpan)<e.range[1]&&(e.range[1]=d),!t.isNullOrUndefined(a.rowSpan)&&a.rowSpan<0&&(l+=a.rowSpan)<e.range[0]&&(e.range[0]=l));for(h=e.range[0];h<=e.range[2];h++)(a=He(h,e.range[3],i))&&(o=h,s=e.range[3],!t.isNullOrUndefined(a.rowSpan)&&a.rowSpan<0&&(o+=a.rowSpan)<e.range[0]&&(e.range[0]=o),!t.isNullOrUndefined(a.colSpan)&&a.colSpan<0&&(s+=a.colSpan)<e.range[1]&&(e.range[1]=s),(a=He(o,s,i))&&(a.rowSpan>1&&o+(a.rowSpan-1)>e.range[2]&&(e.range[2]=o,e.range[2]=o+(a.rowSpan-1)),a.colSpan>1&&s+(a.colSpan-1)>e.range[3]&&(e.range[3]=s,e.range[3]=s+(a.colSpan-1))))}},e.prototype.forwardReverse=function(e){var r=this.parent.getActiveSheet();e.range=e.range;var n=e.range[1],i=He(e.range[0],e.range[1],r),a=e.range[0];if(i&&(!t.isNullOrUndefined(i.colSpan)&&i.colSpan<0&&(n+=i.colSpan,e.range[3]>=n&&(e.range[3]=n)),!t.isNullOrUndefined(i.rowSpan)&&i.rowSpan<0&&(a+=i.rowSpan)<e.range[0]&&(e.range[0]=a),(i=He(a,n,r))&&(i.rowSpan>1&&a+(i.rowSpan-1)>=e.range[2]&&(e.range[2]=a+(i.rowSpan-1)),i.colSpan>1&&n+(i.colSpan-1)>=e.range[1]&&(e.range[1]=n+(i.colSpan-1)))),e.range[0]=a,!e.skipChecking){for(var o,s,l=e.range[3];l<=e.range[1];l++)(i=He(e.range[2],l,r))&&(s=l,o=e.range[2],!t.isNullOrUndefined(i.rowSpan)&&i.rowSpan<0&&(o+=i.rowSpan)<e.range[0]&&(e.range[0]=o),!t.isNullOrUndefined(i.colSpan)&&i.colSpan<0&&(s+=i.colSpan)<e.range[3]&&(e.range[3]=s),(i=He(o,s,r))&&(i.rowSpan>1&&o+(i.rowSpan-1)>e.range[2]&&(e.range[2]=o+(i.rowSpan-1)),i.colSpan>1&&s+(i.colSpan-1)>e.range[1]&&(e.range[1]=s+(i.colSpan-1))));for(var d,l=e.range[3];l<=e.range[1];l++)(i=He(e.range[0],l,r))&&(s=l,d=e.range[0],!t.isNullOrUndefined(i.rowSpan)&&i.rowSpan<0&&(d+=i.rowSpan)<e.range[0]&&(e.range[0]=d),!t.isNullOrUndefined(i.colSpan)&&i.colSpan<0&&(s+=i.colSpan),(i=He(d,s,r))&&(i.rowSpan>1&&d+(i.rowSpan-1)>e.range[2]&&(e.range[2]=d+(i.rowSpan-1)),i.colSpan>1&&s+(i.colSpan-1)>e.range[1]&&(e.range[1]=s,e.range[1]=s+(i.colSpan-1))));for(var h,l=e.range[0];l<=e.range[2];l++)(i=He(l,e.range[3],r))&&(d=l,h=e.range[3],!t.isNullOrUndefined(i.rowSpan)&&i.rowSpan<0&&(d+=i.rowSpan)<e.range[0]&&(e.range[0]=d),!t.isNullOrUndefined(i.colSpan)&&i.colSpan<0&&(h+=i.colSpan)<e.range[3]&&(e.range[3]=h),(i=He(d,h,r))&&(i.rowSpan>1&&d+(i.rowSpan-1)>e.range[2]&&(e.range[2]=d,e.range[2]=d+(i.rowSpan-1)),i.colSpan>1&&h+(i.colSpan-1)>e.range[1]&&(e.range[1]=h,e.range[1]=h+(i.colSpan-1))))}},e.prototype.reverse=function(e){e.range=e.range;var r=e.range[1],n=t.isUndefined(e.sheetIndex)?this.parent.getActiveSheet():Ae(this.parent,e.sheetIndex),i=He(e.range[0],e.range[1],n),a=e.range[0];i&&(!t.isNullOrUndefined(i.colSpan)&&i.colSpan<0&&(r+=i.colSpan),!t.isNullOrUndefined(i.rowSpan)&&i.rowSpan<0&&(a+=i.rowSpan),e.range[2]>=a&&(e.range[2]=a,e.isActiveCell=!0),e.range[3]>=r?(e.range[3]=r,e.range[2]===a&&(e.isActiveCell=!0)):e.isActiveCell&&(e.isActiveCell=!1),(i=He(a,r,n))&&(i.rowSpan>1&&a+(i.rowSpan-1)>=e.range[0]&&(e.range[0]=a,e.range[0]=a+(i.rowSpan-1)),i.colSpan>1&&r+(i.colSpan-1)>=e.range[1]&&(e.range[1]=r,e.range[1]=r+(i.colSpan-1))));var o=e.range[3];if(!e.skipChecking){for(d=e.range[3];d<=e.range[1];d++)(i=He(e.range[2],d,n))&&(o=d,a=e.range[2],!t.isNullOrUndefined(i.rowSpan)&&i.rowSpan<0&&(a+=i.rowSpan)<e.range[2]&&(e.range[2]=a),!t.isNullOrUndefined(i.colSpan)&&i.colSpan<0&&(o+=i.colSpan)<e.range[3]&&(e.range[3]=o),(i=He(a,o,n))&&(i.rowSpan>1&&a+(i.rowSpan-1)>e.range[0]&&(e.range[0]=a,e.range[0]=a+(i.rowSpan-1)),i.colSpan>1&&o+(i.colSpan-1)>e.range[1]&&(e.range[1]=o,e.range[1]=o+(i.colSpan-1))));o=e.range[3];for(d=e.range[3];d<=e.range[1];d++)(i=He(e.range[0],d,n))&&(o=d,a=e.range[0],!t.isNullOrUndefined(i.colSpan)&&i.colSpan<0&&(o+=i.colSpan),!t.isNullOrUndefined(i.rowSpan)&&i.rowSpan<0&&(a+=i.rowSpan),(i=He(a,o,n))&&(i.colSpan>1&&o+(i.colSpan-1)>e.range[1]&&(e.range[1]=o,e.range[1]=o+(i.colSpan-1)),i.rowSpan>1&&a+(i.rowSpan-1)>e.range[0]&&(e.range[0]=a,e.range[0]=a+(i.rowSpan-1))));for(var s,l,d=e.range[2];d<=e.range[0];d++)(i=He(d,e.range[3],n))&&(l=d,s=e.range[3],!t.isNullOrUndefined(i.rowSpan)&&i.rowSpan<0&&(l+=i.rowSpan)<e.range[2]&&(e.range[2]=l),!t.isNullOrUndefined(i.colSpan)&&i.colSpan<0&&(s+=i.colSpan)<e.range[3]&&(e.range[3]=s),(i=He(l,s,n))&&(i.rowSpan>1&&l+(i.rowSpan-1)>e.range[0]&&(e.range[0]=l,e.range[0]=l+(i.rowSpan-1)),i.colSpan>1&&s+(i.colSpan-1)>e.range[1]&&(e.range[1]=s,e.range[1]=s+(i.colSpan-1))))}},e.prototype.reverseForward=function(e){e.range=e.range;var r=t.isUndefined(e.sheetIndex)?this.parent.getActiveSheet():Ae(this.parent,e.sheetIndex),n=e.range[0],i=e.range[1],a=He(e.range[0],e.range[1],r);if(a&&(!t.isNullOrUndefined(a.rowSpan)&&a.rowSpan<0&&(n+=a.rowSpan,e.range[2]>=n&&(e.range[2]=n)),!t.isNullOrUndefined(a.colSpan)&&a.colSpan<0&&(i+=a.colSpan),(a=He(n,i,r))&&(a.rowSpan>1&&n+(a.rowSpan-1)>=e.range[0]&&(e.range[0]=n,e.range[0]=n+(a.rowSpan-1)),a.colSpan>1&&i+(a.colSpan-1)>=e.range[3]&&(e.range[3]=e.range[1],e.range[3]=i+(a.colSpan-1)))),!e.skipChecking){for(var o,s=e.range[3],l=e.range[1];l<=e.range[3];l++)(a=He(e.range[2],l,r))&&(o=e.range[2],s=l,!t.isNullOrUndefined(a.rowSpan)&&a.rowSpan<0&&(o+=a.rowSpan)<e.range[2]&&(e.range[2]=o),!t.isNullOrUndefined(a.colSpan)&&a.colSpan<0&&(s+=a.colSpan)<e.range[1]&&(e.range[1]=s),(a=He(o,s,r))&&(a.colSpan>1&&s+(a.colSpan-1)>e.range[3]&&(e.range[3]=s+(a.colSpan-1)),a.rowSpan>1&&a.rowSpan-1+o>e.range[0]&&(e.range[0]=a.rowSpan-1+o)));for(var d,h,l=e.range[1];l<=e.range[3];l++)(a=He(e.range[0],l,r))&&(h=l,d=e.range[0],!t.isNullOrUndefined(a.colSpan)&&a.colSpan<0&&(h+=a.colSpan)<e.range[1]&&(e.range[1]=h),!t.isNullOrUndefined(a.rowSpan)&&a.rowSpan<0&&(d+=a.rowSpan),(a=He(d,h,r))&&a.rowSpan>1&&d+(a.rowSpan-1)>e.range[0]&&(e.range[0]=d+(a.rowSpan-1)));for(var p,l=e.range[2];l<=e.range[0];l++)(a=He(l,e.range[3],r))&&(o=l,p=e.range[3],!t.isNullOrUndefined(a.rowSpan)&&a.rowSpan<0&&(o+=a.rowSpan)<e.range[2]&&(e.range[2]=o),!t.isNullOrUndefined(a.colSpan)&&a.colSpan<0&&(p+=a.colSpan)<e.range[1]&&(e.range[1]=p),(a=He(o,p,r))&&(a.rowSpan>1&&a.rowSpan-1+o>e.range[0]&&(e.range[0]=a.rowSpan-1+o),a.colSpan>1&&a.colSpan-1+p>e.range[3]&&(e.range[3]=p,e.range[3]=a.colSpan-1+p)))}},e.prototype.insertHandler=function(e){this.activeCellRange(e),e.range=e.range,"Row"===e.insertModel?e.range[2]+=e.insertCount:e.range[3]+=e.insertCount,e.preventRefresh=!0,e.merge=!0,this.mergeAll(e)},e.prototype.addEventListener=function(){this.parent.on(gn,this.merge,this),this.parent.on("mergedRange",this.mergedRange,this),this.parent.on(mn,this.activeCellRange,this),this.parent.on("insertMerge",this.insertHandler,this)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(gn,this.merge),this.parent.off("mergedRange",this.mergedRange),this.parent.off(mn,this.activeCellRange),this.parent.off("insertMerge",this.insertHandler))},e.prototype.getModuleName=function(){return"workbookmerge"},e}(),fa=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on(yn,this.setCFRule,this),this.parent.on(bn,this.clearCFRule,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(yn,this.setCFRule),this.parent.off(bn,this.clearCFRule))},e.prototype.setCFRule=function(e){var t=e.cfModel,r=void 0===e.sheetIdx?S(this.parent,t.range):e.sheetIdx,n=Ae(this.parent,r),i=w(c(t.range||n.selectedRange));if(t.range=m(i),e.isAction){var a={range:t.range,type:t.type,cancel:!1,cFColor:t.cFColor,value:t.value,sheetIdx:r};if(this.parent.notify(qr,{eventArgs:a,action:"conditionalFormat"}),a.cancel)return;t.type=a.type,t.cFColor=a.cFColor,t.value=a.value,a.range!==t.range&&(t.range=a.range,i=w(c(a.range))),delete a.cancel}n.conditionalFormats||this.parent.setSheetPropertyOnMute(n,"conditionalFormats",[]),n.conditionalFormats.push(t),r!==this.parent.activeSheetIndex?e.isUndoRedo&&!e.isFromUpdateAction&&this.parent.notify(dn,{address:n.name+"!"+t.range}):this.parent.notify(Cn,{cfModel:[t],isAction:!0}),this.parent.setUsedRange(i[2],i[3]),e.isAction&&this.parent.notify("actionComplete",{eventArgs:{range:t.range,type:t.type,cFColor:t.cFColor,value:t.value,sheetIdx:r},action:"conditionalFormat"})},e.prototype.clearCFRule=function(e){void 0===e.sheetIdx&&(e.sheetIdx=this.parent.activeSheetIndex);var t=Ae(this.parent,e.sheetIdx),r=t.conditionalFormats,n=r&&r[r.length-1]&&"autofillWithCF"!==r[r.length-1].action;if(e.isUndo)return e.updatedCFModel&&e.updatedCFModel.forEach(function(e){for(var t=0;t<r.length;t++)if(r[t].type===e.type&&r[t].cFColor===e.cFColor&&r[t].range===e.range&&r[t].value===e.value){r.splice(t,1);break}}),r.push.apply(r,e.oldCFModel.map(function(e){return Object.assign({},e)})),this.parent.notify(Cn,{cfModel:e.oldCFModel,isAction:!0}),void(e.sheetIdx!==this.parent.activeSheetIndex&&this.parent.notify(dn,{address:t.name+"!"+e.range}));if(r&&r.length){var i,a,o,s,l,d,h,p,u,f=e.range&&("string"==typeof e.range?c(e.range):e.range);f=f?w(f):f,e.oldCFModel=[],e.updatedCFModel=[];for(var g=[],v=[],y=[],C=0;C<r.length;C++){a=(i=r[C]).range.split(",");for(var b=0;b<a.length;b++){if(o=c(a[b]),e.range)if(f[0]<=o[0]&&f[1]<=o[1]&&f[2]>=o[2]&&f[3]>=o[3])a.splice(b,1),b--;else{if(h=f[0]>=o[0]&&f[0]<=o[2],p=f[2]>=o[0]&&f[2]<=o[2],l=f[1]>=o[1]&&f[1]<=o[3],d=f[3]>=o[1]&&f[3]<=o[3],s=[],h&&p?((l||d||f[1]<o[1]&&f[3]>o[3])&&(f[0]-o[0]>0&&s.push(m([o[0],o[1],f[0]-1,o[3]])),o[2]-f[2]>0&&s.push(m([f[2]+1,o[1],o[2],o[3]]))),l&&f[1]!==o[1]&&s.push(m([f[0],o[1],f[2],f[1]-1])),d&&f[3]!==o[3]&&s.push(m([f[0],f[3]+1,f[2],o[3]]))):l&&d?((h||p||f[0]<o[0]&&f[2]>o[2])&&(f[1]-o[1]>0&&s.push(m([o[0],o[1],o[2],f[1]-1])),o[3]-f[3]>0&&s.push(m([o[0],f[3]+1,o[2],o[3]]))),h?f[0]!==o[0]&&s.push(m([o[0],f[1],f[0]-1,f[3]])):p&&f[2]!==o[2]&&s.push(m([f[2]+1,f[1],o[2],f[3]]))):(h||p)&&(l?(f[1]!==o[1]&&s.push(m([o[0],o[1],o[2],f[1]-1])),f[0]-o[0]>0?s.push(m([o[0],f[1],f[0]-1,o[3]])):o[2]-f[2]>0&&s.push(m([f[2]+1,f[1],o[2],o[3]]))):d&&(f[3]!==o[3]&&s.push(m([o[0],f[3]+1,o[2],o[3]])),f[0]-o[0]>0?s.push(m([o[0],o[1],f[0]-1,f[3]])):o[2]-f[2]>0&&s.push(m([f[2]+1,o[1],o[2],f[3]])))),!s.length)continue;a[b]=s.join(",")}else f=o,a.splice(b,1),b--;e.sheetIdx===this.parent.activeSheetIndex&&this.parent.notify("clearCF",{indexes:f.slice()})}if((u=a.join(","))!==i.range){if(e.cfModel&&(e.cfModel.cFColor!==i.cFColor||e.cfModel.type!==i.type||e.cfModel.value!==i.value)){y.push(i);continue}v.push(i.range),u?(e.oldCFModel.push({type:i.type,cFColor:i.cFColor,format:i.format,range:i.range,value:i.value}),i.range=u,i.result&&(delete i.result,this.parent.notify(Cn,{cfModel:[i],isAction:!0})),e.updatedCFModel.push(i),g.push(i)):(e.oldCFModel.push(i),g.concat(r.splice(C,1)),C--)}}if(e.sheetIdx!==this.parent.activeSheetIndex?e.isUndoRedo&&!e.isFromUpdateAction&&this.parent.notify(dn,{address:t.name+"!"+e.range}):y.length&&this.parent.notify(Cn,{cfModel:y,isAction:!0}),(e.isAction||e.isClear)&&e.oldCFModel.length){var x={cFormats:g,oldRange:v,previousConditionalFormats:e.oldCFModel,sheetIdx:e.sheetIdx,selectedRange:e.range};e.updatedCFModel.length&&(x.conditionalFormats=e.updatedCFModel),e.isClear?e.cfClearActionArgs=x:n&&this.parent.notify("actionComplete",{eventArgs:x,action:"clearCF"})}}},e.prototype.getModuleName=function(){return"workbookConditionalFormatting"},e}(),ga=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.getFillInfo=function(e){for(var r=this.parent.serviceLocator.getService("spreadsheetLocale"),n="",i=!0,a="CopyCells",o=[],s=["Down","Up"].indexOf(e.direction)>-1,l=this.getRangeData({range:e.dataRange,sheetIdx:this.parent.activeSheetIndex}),d=l.join().replace(/,/g,"").length,h=this.isRange(e.dataRange)&&d?l.length:1;h--;)if(n=l[h]&&!t.isNullOrUndefined(l[h].value)?l[h].value:"",fe(n)||k(n)||fe(n[n.length-1])){i=!1,a=this.parent.autoFillSettings.fillType;break}return d&&!i||(o.push(r.getConstant("FillSeries")),a="FillSeries"===e.fillType?a:e.fillType),(!s||s&&e.dataRange[1]!==e.dataRange[3])&&o.push("Flash Fill"),{fillType:a,disableItems:o}},e.prototype.isRange=function(e){return e&&(e[0]!==e[2]||e[1]!==e[3])},e.prototype.autoFill=function(e){if(e.dataRange&&e.fillRange&&e.direction&&this.parent.allowEditing&&(!this.parent.getActiveSheet().isProtected||!e.isLockedCell)){var t=w(c(e.dataRange)),r=w(c(e.fillRange)),n={dataRange:t,fillRange:r,direction:e.direction,fillType:e.fillType||this.fillInfo.fillType,dataSheetIndex:S(this.parent,e.dataRange),fillSheetIndex:S(this.parent,e.fillRange),cells:e.cells};switch(this.fillInfo=this.getFillInfo({dataRange:t,fillRange:r,fillType:e.fillType,direction:e.direction}),this.fillInfo.fillType=e.isFillOptClick?e.fillType:this.fillInfo.fillType,e.fillType){case"FillSeries":case"FillWithoutFormatting":this.fillSeries(n);break;case"CopyCells":case"FillFormattingOnly":this.copyCells(n)}}},e.prototype.fillSeries=function(e){var r,n,i,a,o,s,l,d,h,p,c,u,f,g,m,y,C,b,x,S,w,I,E,R,N,F,A={},O=0,T=t.isUndefined(e.dataSheetIndex)?this.parent.activeSheetIndex:e.dataSheetIndex,D=Ae(this.parent,T);t.isUndefined(e.fillSheetIndex)?(N=this.parent.activeSheetIndex,F=!0):F=(N=e.fillSheetIndex)===this.parent.activeSheetIndex;for(var L,P,M=Ae(this.parent,N),B=e.dataRange[0],H=e.dataRange[1],U=e.dataRange[2],V=e.dataRange[3],z=e.fillRange[0],j=e.fillRange[1],W=e.fillRange[2],G=e.fillRange[3],X=["Down","Up"].indexOf(e.direction)>-1,K=["Up","Left"].indexOf(e.direction)>-1,$=X?V-H:U-B,J="FillSeries"===e.fillType,Q=D.conditionalFormats&&D.conditionalFormats.length&&[].slice.call(D.conditionalFormats),ee=[],te=F&&this.applyWrapToOuterCells(M),re="FillWithoutFormatting"!==e.fillType&&F&&X;O<=$;){s=(o=this.updateFillValues(X,B,H,U,V,z,j,W,G,O)).patternRange,l=o.fillRange,i=this.getPattern(s,{isReverseFill:K,isVFill:X},T),d=this.getRangeData({range:s,sheetIdx:T}),X||(d=this.getRangeData({range:s,sheetIdx:T},!0));var ne=!1;d[0]&&d[0].formula&&d[0].formula.match(/=[A-Za-z]+\(([^:]+):([^:]+)\)/)&&(ne=!0),u=d.length;for(var ie=0;ie<u;ie++)if(d[ie]&&d[ie].isReadOnly)return void this.parent.notify("readonlyAlert",null);if(!i||!i.length)return;for(n=i.length,S=(x=this.getSelectedRange(M,{rowIndex:l[0],colIndex:l[1]},{rowIndex:l[2],colIndex:l[3]})).length,K&&(x=x.reverse(),i=i.reverse(),i=this.ensurePattern(i),d=d.reverse()),f=0;f<S;){switch(w=x[f],a=i[f%n],fe(a)&&(a=i[a]),m=f%u,a.type){case"number":case"date":if(a=a,a.isStartWithMonth&&1===u?(E=pe(a.regVal.a),R=new Date(E),E.setMonth(E.getMonth()+a.regVal.b*a.i),R.getDate()>28&&R.getDate()!==E.getDate()&&(R.setDate(1),R.setMonth(R.getMonth()+a.regVal.b*a.i),R.setDate(new Date(R.getFullYear(),R.getMonth()+1,0).getDate()),E=R),r=ce(E).toString()):(r=this.round(a.regVal.a+a.regVal.b*a.i,5).toString(),a.val&&(p="string"==typeof a.val[0]&&a.val[0].match(/^0+/))&&(h=this.getNextFormattedValue(a.val[0],Number(r)))),a.dataVal){if(void 0===a.copy&&!p&&(a.copy=a.val.length>2,a.copy))for(var ae=2;ae<a.val.length&&(a.copy=Math.abs(this.round(a.regVal.a+a.regVal.b*ae,5))!==a.val[ae],!a.copy);ae++);r=a.copy?d[m]&&!t.isNullOrUndefined(d[m].value)?d[m].value:"":a.start?Math.abs(Number(r))+a.dataVal:p?a.dataVal+h:a.dataVal+Math.abs(Number(r))}K?a.i--:a.i++;break;case"string":var oe=a.i%a.val.length;r=a.val[oe],a.i++;break;case"formula":for(b=!1,r="=",g=0,y=a.val.length;g<y;)"object"==typeof(c=a.val[g])?(b=!0,(C=this.round(c.a+c.b*a.i,5))<1?(r+="#REF!",ne&&(g=y-1,r+=a.val[g])):r+=X?c.c+(c.b?C:"$"+C):(c.b?v(C):c.c.substring(0,c.c.search(/\d/))+"$"+v(C))+c.c.trim()):r+=c,g++;b&&K?a.i--:a.i++;break;case"time":r=(a.regVal.a+a.regVal.b*a.i).toString(),Number(r)<0&&K&&(r=(a.regVal.a+Math.ceil(Math.abs(a.i/24))+a.regVal.b*a.i).toString()),K?a.i--:a.i++}if((I=He(w.rowIndex,w.colIndex,M,!1,!0))&&I.isReadOnly)return void this.parent.notify("readonlyAlert",null);if(J?Object.assign(A,d[m],null,!0):("FillWithoutFormatting"===e.fillType&&d[m]&&d[m].hyperlink?(A.hyperlink=d[m].hyperlink,A.style={textDecoration:"none",color:"inherit"}):A.style=I.style,A.format=I.format,A.wrap=I.wrap,A.rowSpan=I.rowSpan,A.colSpan=I.colSpan),d[m]&&d[m].validation){A.validation=Object.assign({},d[m].validation);var se=[w.rowIndex,w.colIndex,w.rowIndex,w.colIndex],le=[e.dataRange[0],e.dataRange[1],e.dataRange[2],e.dataRange[3]],de=this.parent.sheets[this.parent.activeSheetIndex],he=q(se,le,de,this.parent,{formula:A.validation.value1});A.validation.value1=he,""!==A.validation.value2&&(he=q(se,le,de,this.parent,{formula:A.validation.value2}),A.validation.value2=he)}var ue=k(r);ue&&(A.formula=r),("0"!==r||"0"===r&&"FillWithoutFormatting"!==e.fillType)&&(A.value=ue&&"Manual"===this.parent.calculationMode?d[m]?d[m].value:"0":r),t.isNullOrUndefined(A.notes)||delete A.notes,L={cell:A,rowIdx:w.rowIndex,colIdx:w.colIndex,valChange:!0,uiRefresh:F,pvtExtend:!0,skipFormatCheck:!0,fillType:e.fillType},!F||tt(M,w.rowIndex)||ht(M,w.colIndex)||(L.td=this.parent.getCell(w.rowIndex,w.colIndex),L.td&&(L.uiRefresh=!0)),Y(this.parent,M,L,e.cells)||(F&&te(L),Q&&!P&&((P=L.isFormulaDependent)||Z(Q,ee,w.rowIndex,w.colIndex,e.dataRange,e.fillRange,D)),re&&A.style&&_(A.style)&&this.parent.notify(Xr,{rowIdx:w.rowIndex,colIdx:w.colIndex,style:A.style,lastCell:!0,isHeightCheckNeeded:!0,onActionUpdate:!0,manualUpdate:!0})),A={},f++}O++}(ee.length||P)&&this.parent.notify(Cn,{cfModel:!P&&ee,refreshAll:P,isAction:!0,isEdit:!0})},e.prototype.copyCells=function(e){var r,n,i,a,o,s,l,d,h,p,c,u,f=0,g={},m=e.dataRange[0],v=e.dataRange[1],y=e.dataRange[2],C=e.dataRange[3],b=e.fillRange[0],x=e.fillRange[1],S=e.fillRange[2],w=e.fillRange[3],I=["Down","Up"].indexOf(e.direction)>-1,E=["Up","Left"].indexOf(e.direction)>-1,R=I?C-v:y-m,N=t.isUndefined(e.dataSheetIndex)?this.parent.activeSheetIndex:e.dataSheetIndex,F=Ae(this.parent,N);t.isUndefined(e.fillSheetIndex)?(u=!0,c=this.parent.activeSheetIndex):(u=e.fillSheetIndex===this.parent.activeSheetIndex,c=e.fillSheetIndex);for(var A,k,O,T=Ae(this.parent,c),D="FillFormattingOnly"===e.fillType,L=F.conditionalFormats&&F.conditionalFormats.length&&[].slice.call(F.conditionalFormats),P=u&&this.applyWrapToOuterCells(T),M=[],B=u&&I;f<=R;){i=(o=this.updateFillValues(I,m,v,y,C,b,x,S,w,f)).patternRange,a=o.fillRange,l=(s=this.getRangeData({range:i,sheetIdx:N})).length;for(var H=0;H<l;H++)if(s[H]&&s[H].isReadOnly)return void this.parent.notify("readonlyAlert",null);for(h=(d=this.getSelectedRange(T,{rowIndex:a[0],colIndex:a[1]},{rowIndex:a[2],colIndex:a[3]})).length,r=0,E&&(d=d.reverse());r<h;){if(n=r%l,p=d[r],D&&(A=He(p.rowIndex,p.colIndex,T)),Object.assign(g,s[n],null,!0),D&&(g.value=A.value,g.formula=A.formula,t.isNullOrUndefined(g.notes)||delete g.notes,g.validation&&delete g.validation),g&&g.isReadOnly)return void this.parent.notify("readonlyAlert",null);t.isNullOrUndefined(g.notes)||t.isNullOrUndefined(g.isNoteEditable)||(delete g.notes,delete g.isNoteEditable),O={cell:g,rowIdx:p.rowIndex,colIdx:p.colIndex,valChange:!0,pvtExtend:!0,fillType:e.fillType},!u||tt(T,p.rowIndex)||ht(T,p.colIndex)||(O.td=this.parent.getCell(p.rowIndex,p.colIndex),O.uiRefresh=!!O.td),Y(this.parent,T,O,e.cells)||(u&&P(O),L&&!k&&((k=O.isFormulaDependent)||Z(L,M,p.rowIndex,p.colIndex,e.dataRange,e.fillRange,F)),B&&g.style&&_(g.style)&&this.parent.notify(Xr,{rowIdx:p.rowIndex,colIdx:p.colIndex,style:g.style,lastCell:!0,isHeightCheckNeeded:!0,onActionUpdate:!0,manualUpdate:!0})),g={},r++}f++}(M.length||k)&&this.parent.notify(Cn,{cfModel:!k&&M,refreshAll:k,isAction:!0,isEdit:!0})},e.prototype.applyWrapToOuterCells=function(e){var t,r,n=this,i=this.parent.frozenRowCount(e),a=this.parent.frozenColCount(e),o=this.parent.viewport;o&&(t=o.topIndex+i,r=o.leftIndex+a);var s;return function(o){!o.td&&He(o.rowIdx,o.colIdx,e,!1,!0).wrap&&(o.rowIdx>=i&&o.rowIdx<t||o.colIdx>=a&&o.colIdx<r)&&(s||(s={range:null,wrap:!0,sheet:e,initial:!0,outsideViewport:!0}),s.range=[o.rowIdx,o.colIdx,o.rowIdx,o.colIdx],n.parent.notify(an,s))}},e.prototype.updateFillValues=function(e,t,r,n,i,a,o,s,l,d){var h,p,c,u;return e?(h={rowIndex:t,colIndex:r+d},p={rowIndex:n,colIndex:r+d},c={rowIndex:a,colIndex:o+d},u={rowIndex:s,colIndex:o+d}):(h={rowIndex:t+d,colIndex:r},p={rowIndex:t+d,colIndex:i},c={rowIndex:a+d,colIndex:o},u={rowIndex:a+d,colIndex:l}),{patternRange:[h.rowIndex,h.colIndex,p.rowIndex,p.colIndex],fillRange:[c.rowIndex,c.colIndex,u.rowIndex,u.colIndex]}},e.prototype.getDataPattern=function(e,r){var n,i,a,o,s,l=0,d={val:null,type:null},h=[],p=this.getRangeData({range:e,sheetIdx:t.isUndefined(r)?this.parent.activeSheetIndex:r}),c=p.length;if(c){for(var u=void 0,f=void 0,g=void 0,m=void 0,v=function(e){return!o&&e&&"-"===e[e.length-1]?e.slice(0,e.length-1):e};l<c;){if(s=!1,p[l])if(p[l].formula&&k(p[l].formula))n=p[l].formula,a="formula";else{n=t.isNullOrUndefined(p[l].value)?"":p[l].value;var y={};if(g=p[l].format,m=fe(n),g&&qe(g,!0,y)){if(a=y.type,n&&!m){var C={value:n,updatedVal:n,cell:p[l]};this.parent.notify(Zr,C),C.isDate||C.isTime?p[l].value=n=C.updatedVal:a="string"}s="date"===a&&g.toLowerCase().startsWith("mmm")}else a=m?"number":"string"}else n="",a="string";if(f="","string"===a){if(o=!1,fe(n[0])){u=0;do{u++}while(fe(n[u]));" "===n[u]&&(o=!0,a="number",f=n.slice(u,n.length),n=Number(n.slice(0,u)))}if(n=n,!o&&fe(n[n.length-1])){u=1;do{u++}while(fe(n[n.length-u]));a="number",u-=1,f=n.slice(0,n.length-u),n=(i=n.slice(n.length-u,n.length)).match(/^0+/)?i:Number(i),d.dataVal&&d.dataVal!==f&&d.dataVal===v(f)&&(f=d.dataVal)}}0===l?(d={val:[n],type:a,isStartWithMonth:s},f&&(d.dataVal=f,d.start=o)):a!==d.type||d.dataVal&&v(d.dataVal)!==v(f)?(h.push(d),d={val:[n],type:a},f&&(d.dataVal=f,d.start=o)):d.val.push(n),l++}return h.push(d),h}return[{val:null,type:null}]},e.prototype.getPredictionValue=function(e,t){for(var r=0,n=0,i=0,a=0,o=0,s=0,l=0,d=e.length;r<d;)n+=r,i+=Number(e[r]),a+=r*Number(e[r]),o+=r*r,r++;return t?(s=(i*o-n*a)/(d*o-n*n),l=(d*a-n*i)/(d*o-n*n)):(s=this.round((i*o-n*a)/(d*o-n*n),5),l=this.round((d*a-n*i)/(d*o-n*n),5)),{a:s,b:l}},e.prototype.getPattern=function(e,t,r){var n,i,a,o,s,l,d=0,h=[],p=this.getDataPattern(e,r),c=p.length;if(p){for(;d<c;){switch((l=p[d]).type){case"number":case"date":if(i=h.length,s=l.val.length,o=t.isReverseFill?-1:s,1===s){var u=parseFloat(l.val[0])+1;"string"==typeof l.val[0]&&l.val[0].match(/^0+/)?l.val.push(this.getNextFormattedValue(l.val[0],u)):l.val.push(u)}for(a={regVal:this.getPredictionValue(l.dataVal?l.val.slice(0,2):l.val),type:l.type,i:o,isStartWithMonth:l.isStartWithMonth},l.dataVal&&(a.dataVal=l.dataVal,a.val=l.val,a.start=l.start),h.push(a),n=1;n<s;)h.push(i),n++;break;case"string":for(i=h.length,a={val:l.val,type:l.type,i:0},h.push(a),n=1,s=l.val.length;n<s;)h.push(i),n++;break;case"formula":if(s=l.val.length,l=this.getFormulaPattern(l.val,t),o=t.isReverseFill?-1:s,l.isInPattern)for(i=h.length,a={val:l.val,type:"formula",i:o},h.push(a),n=1;n<s;)h.push(i),n++;else for(n=0,o=t.isReverseFill?-1:1;n<s;)h.push({val:l.val[n],type:"formula",i:o}),n++;break;case"time":if(i=h.length,s=l.val.length,o=t.isReverseFill?-1:s,1===s){var f=pe(l.val[0]),g=Number(l.val[0]),m=g>=0&&g<1,v=ce(new Date(f.getTime()+36e5),!0,m);l.val.push(v)}for(a={regVal:this.getPredictionValue(l.val,!0),type:l.type,i:o},h.push(a),n=1;n<s;)h.push(i),n++}d++}return h}return[{regVal:null}]},e.prototype.getNextFormattedValue=function(e,r){var n=(new t.Internationalization).formatNumber(Math.abs(r),{minimumIntegerDigits:e.length,useGrouping:!1}),i=F({value:n},this.parent.locale);return i.isNumber?i.value:n},e.prototype.isCellReference=function(e){return/^[a-z]{1,3}\d{1,7}$/gi.test(e)?"relative":/^\$[a-z]{1,3}\$\d{1,7}$/gi.test(e)?"absolute":!!/^((\$[a-z]{1,3})\d{1,7}|[a-z]{1,3}(\$\d{1,7}))$/gi.test(e)&&"mixed"},e.prototype.round=function(e,t){return Number(Math.round(parseFloat(e+"e"+t))+"e-"+t)||Number(e)},e.prototype.getRangeData=function(e,r){for(var n,i,a=[],o=t.isUndefined(e.sheetIdx)?this.parent.getActiveSheet():Ae(this.parent,e.sheetIdx),s=e.range[0],l=e.range[1],d=e.range[2],h=e.range[3],p=l;s<=d;)if(tt(o,s))s++;else{for(l=p;l<=h;)if(ht(o,l))l++;else{if(n=He(s,l,o),r&&(n=Object.assign({},He(s,l,o)),i=Object.assign({},ot(o,l)),n&&!n.validation&&i&&i.validation)){n.validation=Object.assign({},ot(o,l).validation);var c=[s,l,s,l],u=[0,l,0,l],f=q(c,u,o,this.parent,{formula:i.validation.value1});n.validation.value1=f,""!==n.validation.value2&&(f=q(c,u,o,this.parent,{formula:i.validation.value2}),n.validation.value2=f)}a.push(n),l++}s++}return a},e.prototype.getFormulaPattern=function(e,t){for(var r,n,i,a,o=[],s=0,l=e.length,d={};s<l;)d.formula=e[s],this.parent.notify("parseFormulaArgument",d),o.push(d.formulaArr),s++;var h=this.isInPattern(o,t.isVFill);if(h){for(s=(i=o[0]).length;s--;)n=i[s],(a=this.isCellReference(n))&&"absolute"!==a&&(i[s]=this.getCellRefPrediction(n,t,null,a));return{isInPattern:h,val:i}}for(s=0;s<l;){for(r=(i=o[s]).length;r--;)n=i[r],(a=this.isCellReference(n.trim()))&&"absolute"!==a&&(o[s][r]=this.getCellRefPrediction(n,t,l,a));s++}return{isInPattern:h,val:o}},e.prototype.generateColCount=function(e){for(var t=0,r=0;r<e.length;r++)t=26*t+(e.charCodeAt(r)-64);return t},e.prototype.getCellRefPrediction=function(e,t,r,n){e=e.toUpperCase();var i=new RegExp("[a-z$]","gi"),a=new RegExp("[0-9$]","g"),o=t.isVFill?e.replace(a,""):e.replace(i,""),s=t.isVFill?Number(e.replace(i,"")):this.generateColCount(e.replace(a,"").trim()),l=null,d=[s],h="$"===e[0];if(!h&&e.includes("$")&&"$"===e.trim()[0])for(var p=1;p<e.length;p++)if("$"===e[p]){l=p,h=!0;break}return r&&1!==r?d.push(s+r):d.push(s+1),s=this.getPredictionValue(d),n&&"mixed"===n&&(h===t.isVFill?o=l?o.substring(0,l)+"$"+o.substring(l):"$"+o:s.b=0),s.c=o,s},e.prototype.isInPattern=function(e,t){var r,n,i,a,o,s,l,d,h=0,p=1,c=e.length,u=new RegExp("[0-9$]","g"),f=new RegExp("[a-z$]","gi");if(1===c)return!1;for(;p<c;){if(r=e[h],i=e[p],n=r.length,a=i.length,n!==a)return!1;for(;n--;)if(o=r[n],s=i[n],this.isCellReference(o)===this.isCellReference(s)){if(t?(l=Number(o.replace(f,"")),d=Number(s.replace(f,""))):(l=this.generateColCount(o.replace(u,"")),d=this.generateColCount(s.replace(u,""))),l!==d-1)return!1}else if(o!==s)return!1;h++,p++}return!0},e.prototype.ensurePattern=function(e){for(var t,r=-1,n=e.length;n--;)"object"==typeof(t=e[n])?(r=n,"string"===t.type&&(t.val=t.val.reverse())):e[n]=r;return e},e.prototype.getSelectedRange=function(e,t,r){var n,i,a,o=[],s=w([t.rowIndex,t.colIndex,r.rowIndex,r.colIndex]);n=s[0];for(var l=s[2];n<=l;)if(rt(e,n))n++;else{for(i=s[1],a=s[3];i<=a;)o.push({rowIndex:n,colIndex:i}),i++;n++}return o},e.prototype.getFillType=function(e){return e.fillType=this.fillInfo.fillType,e.disableItems=this.fillInfo.disableItems,e},e.prototype.addEventListener=function(){this.parent.on(En,this.autoFill,this),this.parent.on("getFillInfo",this.getFillType,this)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(En,this.autoFill),this.parent.off("getFillInfo",this.getFillType))},e.prototype.getModuleName=function(){return"workbookautofill"},e}(),ma=function(){function e(){this.services={}}return e.prototype.getService=function(e){if(t.isNullOrUndefined(this.services[""+e]))throw"The service "+e+" is not registered";return this.services[""+e]},e.prototype.register=function(e,r){t.isNullOrUndefined(this.services[""+e])&&(this.services[""+e]=r)},e}(),va=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ya=function(){return(ya=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}).apply(this,arguments)},Ca=function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},ba=function(e){function r(t){var r=e.call(this,t)||this;return r.isEdit=!1,r.sheetNameCount=1,r.dataValidationRange="",r.isOpen=!1,r.chartColl=[],r.isPrintingProcessing=!1,r.currentPrintSheetIndex=0,r.customFormulaCollection=new Map,n.Inject(_n,Ui,Pi,Qi,ia,aa,Ji,ea,oa,ta,sa,pa,da,ca,ua,fa,ra,na,ga),r.commonCellStyle={},t&&t.cellStyle&&(r.commonCellStyle=t.cellStyle),"workbook"===r.getModuleName()&&(r.serviceLocator=new ma,r.initWorkbookServices(),r.dataBind(),r.initEmptySheet()),r}va(r,e),n=r,r.prototype.preRender=function(){Object.keys(this.commonCellStyle).length||(this.commonCellStyle=Ve(this.cellStyle,!0)),"spreadsheet"!==this.getModuleName()||this.refreshing||this.initEmptySheet()},r.prototype.initWorkbookServices=function(){this.serviceLocator.register("spreadsheetLocale",new t.L10n(this.getModuleName(),Dn,this.locale))},r.prototype.render=function(){},r.prototype.requiredModules=function(){return N(this)},r.prototype.getPersistData=function(){return this.addOnPersist([])},r.prototype.cellFormat=function(e,t){var r=this.getActiveSheet();!r||r.isProtected&&!r.protectSettings.formatCells||(t=t||r.selectedRange,this.notify(Yr,{style:e,range:t,refreshRibbon:t.indexOf(r.activeCell)>-1}))},r.prototype.lockCells=function(e,t){var r=this.getActiveSheet();e=e||r.selectedRange,this.notify(fn,{range:e,isLocked:t,triggerEvent:!0})},r.prototype.getCellStyleValue=function(e,t){var r=this,n=He(t[0],t[1],this.getActiveSheet()),i={};return e.forEach(function(e){i[""+e]=r.cellStyle[""+e],n&&n.style&&n.style[""+e]&&(i[""+e]=n.style[""+e])}),i},r.prototype.numberFormat=function(e,t){this.notify("applyNumber",{format:e,range:t}),this.notify(kn,{action:"addToCustomFormats",format:e})},r.prototype.createSheet=function(e,t){void 0===e&&(e=this.sheets.length),void 0===t&&(t=[{}]);var r;(r=this.sheets).splice.apply(r,[e,0].concat(t)),Te(this,t),this.notify("sheetCreated",{sheetIndex:e||0,sheets:t}),this.notify(Kr,{action:"registerSheet",sheetIndex:e||0,sheetCount:e+t.length})},r.prototype.removeSheet=function(e){this.sheets.splice(e,1)},r.prototype.destroy=function(){this.notify("workbookDestroyed",null),e.prototype.destroy.call(this)},r.prototype.onPropertyChanged=function(e,r){for(var n=0,i=Object.keys(e);n<i.length;n++)switch(i[n]){case"cellStyle":t.merge(this.commonCellStyle,e.cellStyle);break;case"sheets":e.sheets===this.sheets?(this.notify(Kr,{action:"unRegisterSheet",propertyChange:!0}),this.sheetNameCount=1,this.notify("sheetsDestroyed",{}),Te(this),this.notify("sheetCreated",null),this.notify(Kr,{action:"registerSheet"})):Te(this);break;case"listSeparator":this.notify(Kr,{action:"setArgumentSeparator"})}},r.prototype.appendTo=function(t){e.prototype.appendTo.call(this,t)},r.prototype.hideRow=function(e,t,r){void 0===t&&(t=e),void 0===r&&(r=!0);for(var n=this.getActiveSheet(),i=e;i<=t;i++)et(n,i,{hidden:r})},r.prototype.hideColumn=function(e,t,r){void 0===t&&(t=e),void 0===r&&(r=!0);for(var n=this.getActiveSheet(),i=e;i<=t;i++)st(n,i,{hidden:r})},r.prototype.setBorder=function(e,t,r,n){this.notify(Yr,{style:e,borderType:r,range:t||this.getActiveSheet().selectedRange,isUndoRedo:n})},r.prototype.insertRow=function(e,t,r){this.notify(on,{model:this.getSheetModel(r),start:e,end:t,modelType:"Row",insertType:"below"})},r.prototype.insertColumn=function(e,t,r){this.notify(on,{model:this.getSheetModel(r),start:e,end:t,modelType:"Column",insertType:"after"})},r.prototype.insertSheet=function(e,t){this.isProtected||this.notify(on,{model:this,start:e,end:t,modelType:"Sheet"})},r.prototype.delete=function(e,r,n,i){if(!this.isProtected){e=e||0;var a;if(r=t.isNullOrUndefined(r)?e:r,n&&"Sheet"!==n){if(!(a=this.getSheetModel(i)))return}else if(a=this,Math.abs(r-e)>=this.sheets.length)return;this.notify(sn,{model:a,start:e,end:r,modelType:n||"Sheet"})}},r.prototype.moveSheet=function(e,t){this.isProtected||Pe(this,e,t)},r.prototype.duplicateSheet=function(e){this.isProtected||Me(this,e)},r.prototype.getSheetModel=function(e){if(t.isNullOrUndefined(e))return this.getActiveSheet();var r="string"==typeof e?Se(this,e):e;return t.isNullOrUndefined(r)||r>=this.sheets.length?null:this.sheets[r]},r.prototype.merge=function(e,t){var r,n;e?n=Ae(this,r=this.isPrintingProcessing?this.currentPrintSheetIndex:S(this,e)):(e=(n=this.getActiveSheet()).selectedRange,r=this.activeSheetIndex),this.notify(gn,{merge:!0,range:e,type:t||"All",sheetIndex:r,refreshRibbon:e.indexOf(n.activeCell)>-1,preventRefresh:this.activeSheetIndex!==r})},r.prototype.unMerge=function(e){var t,r;e?r=Ae(this,t=S(this,e)):(e=(r=this.getActiveSheet()).selectedRange,t=this.activeSheetIndex),this.notify(gn,{merge:!1,range:e,sheetIndex:t,type:"All",refreshRibbon:e.indexOf(r.activeCell)>-1,preventRefresh:this.activeSheetIndex!==t})},r.prototype.computeExpression=function(e){var t={action:"computeExpression",formula:e,isFromComputeExpression:!0};return this.notify(Kr,t),t.calcValue},r.prototype.initEmptySheet=function(){this.sheets.length?Te(this):this.createSheet()},r.prototype.getActiveSheet=function(){return this.sheets[this.activeSheetIndex]},r.prototype.skipHiddenSheets=function(e,t,r){return void 0===r&&(r=0),this.sheets[e]&&"Visible"!==this.sheets[e].state&&(void 0===t&&(t=e),e=e&&e+1===this.sheets.length?t-1:e<t?--e:++e,e=this.skipHiddenSheets(e,t,++r)),r===this.sheets.length?(this.setSheetPropertyOnMute(this.sheets[0],"state","Visible"),0):e},r.prototype.setUsedRange=function(e,t,r,n,i){if(void 0===r&&(r=this.getActiveSheet()),i)return void this.setSheetPropertyOnMute(r,"usedRange",{rowIndex:e,colIndex:t});e>r.usedRange.rowIndex&&(this.setSheetPropertyOnMute(r,"usedRange",{rowIndex:e,colIndex:r.usedRange.colIndex}),r!==this.getActiveSheet()||n||this.notify("updateRowColCount",{index:e,update:"row"})),t>r.usedRange.colIndex&&(this.setSheetPropertyOnMute(r,"usedRange",{rowIndex:r.usedRange.rowIndex,colIndex:t}),r!==this.getActiveSheet()||n||this.notify("updateRowColCount",{index:t,update:"col"}))},r.prototype.getData=function(e){return ye(this,e)},r.prototype.getModuleName=function(){return"workbook"},r.prototype.goTo=function(e){},r.prototype.getValueRowCol=function(e,r,n,i,a,o,s){var l=we(this,e),d=Ae(this,l),h=He(r-1,n-1,d);if(i&&i.includes("!")&&!h&&d.ranges&&d.ranges.length){var p;if(this.formulaRefCell&&this.formulaRefCell===i)return h&&h.value;if(d.ranges.forEach(function(e){if(!e.info||!e.info.loadedRange||!e.info.loadedRange.length)return void(p=!0)}),p){if(this.formulaRefCell=i,l=we(this,Number(i.substring(i.lastIndexOf(",")+1,i.length))),t.isNullOrUndefined(l))return h&&h.value;i=i.substring(i.lastIndexOf("!")+1,i.lastIndexOf(",")),ye(this,d.name+"!A1:"+g(r-1,n-1),null,null,null,null,i,l)}}else h&&h.formula&&(a||t.isNullOrUndefined(h.value))&&!o&&"Automatic"===this.calculationMode&&this.notify(Gr,{cell:h,rowIdx:r-1,colIdx:n-1,sheetIndex:l,formulaRefresh:!0});if(h&&!fe(h.value)&&!this.isEdit){var c={formattedText:h.value,value:h.value,format:h.format,cell:h,skipFormatCheck:!1};this.notify(Wr,c),h=c.cell}return s&&h&&h.formula&&h.formula.includes("SUBTOTAL(")?h.formula:h&&h.value},r.prototype.setValueRowCol=function(e,t,r,n,i,a){this.notify($r,{action:"updateCellValue",address:[r-1,n-1],value:t,sheetIndex:we(this,e),isValueOnly:!0,formula:i,isRandomFormula:a})},r.prototype.open=function(e){this.notify("workbookOpen",e)},r.prototype.openFromJson=function(e,t){this.isOpen=!0;var r="object"==typeof e.file?JSON.stringify(e.file):e.file;if(""!==r&&t){var n=[];if(t.onlyValues)n.push.apply(n,["style","formula","format","conditionalFormats","validation","hyperlink","wrap","chart","image","notes"]);else{var i={style:t.ignoreStyle,formula:t.ignoreFormula,format:t.ignoreFormat,conditionalFormats:t.ignoreConditionalFormat,validation:t.ignoreValidation,wrap:t.ignoreWrap,chart:t.ignoreChart,image:t.ignoreImage,notes:t.ignoreNote};t.ignoreFreezePane&&n.push.apply(n,["frozenColumns","frozenRows"]);for(var a in i)i[a]&&n.push(a)}r=JSON.stringify(JSON.parse(r),function(e,t){if(!(n.indexOf(e)>-1))return t})}this.notify("workbookOpen",{jsonObject:r,triggerEvent:e.triggerEvent})},r.prototype.save=function(e,t){if(void 0===e&&(e={}),this.allowSave){var r={url:this.saveUrl,fileName:e.fileName||"Sample",saveType:"Xlsx"},n=ya({},r,e,{customParams:{},isFullPost:!0,needBlobData:!1,cancel:!1,autoDetectFormat:!1,pdfLayoutSettings:{fitSheetOnOnePage:!1,orientation:"Portrait"}});this.trigger("beforeSave",n),this.notify(qr,{eventArgs:n,action:"beforeSave"}),n.cancel||this.notify("beginSave",{saveSettings:n,isFullPost:n.isFullPost,needBlobData:n.needBlobData,customParams:n.customParams,pdfLayoutSettings:n.pdfLayoutSettings,jsonConfig:t})}},r.prototype.saveAsJson=function(e){var t=this;return new Promise(function(r){t.on("onSave",function(e){e.cancel=!0,t.off("onSave"),r({jsonObject:{Workbook:e.jsonObject}}),t.notify("saveCompleted",e)}),t.save({},e)})},r.prototype.addHyperlink=function(e,t){var r={hyperlink:e,cell:t};this.notify(nn,r)},r.prototype.findHandler=function(e){this.notify("find",e)},r.prototype.replaceHandler=function(e){"replace"===e.replaceBy?this.notify(hn,e):this.notify(pn,e)},r.prototype.protectSheet=function(e,r,n){t.isNullOrUndefined(e)?e=this.activeSheetIndex:"string"==typeof e&&(e=Se(this,e));var i=this.sheets[e];i&&(this.setSheetPropertyOnMute(i,"isProtected",!0),this.setSheetPropertyOnMute(i,"password",n||""),this.setSheetPropertyOnMute(i,"protectSettings",r||{}),this.notify(un,{protectSettings:i.protectSettings,password:i.password,sheetIndex:e}))},r.prototype.unprotectSheet=function(e){if(t.isNullOrUndefined(e)?e=this.activeSheetIndex:"string"==typeof e&&(e=Se(this,e)),this.sheets[e]){var r={sheet:e};this.notify("unprotectsheetHandler",r)}},r.prototype.sort=function(e,t,r){if(!this.allowSorting)return Promise.reject();var n={args:{range:t||this.getActiveSheet().selectedRange,sortOptions:e||{sortDescriptors:{}},cancel:!1},promise:new Promise(function(e){e(void 0)}),previousSort:r};return this.notify(rn,n),n.promise},r.prototype.addDataValidation=function(e,r){t.isNullOrUndefined(e.value1)||("List"===e.type?e.value1.length>256&&(e.value1=e.value1.substring(0,255)):(e.value1=Q([e.value1],this)[0],e.value2&&(e.value2=Q([e.value2],this)[0])),this.notify(ln,{rules:e,range:r||se(this.getActiveSheet())}))},r.prototype.removeDataValidation=function(e){this.notify(ln,{range:e||se(this.getActiveSheet()),isRemoveValidation:!0})},r.prototype.addInvalidHighlight=function(e){this.notify("addHighlight",{range:e})},r.prototype.removeInvalidHighlight=function(e){this.notify("removeHighlight",{range:e})},r.prototype.isValidCell=function(e){var t,r,n;if(e){var i=x(this,e);r=i.sheetIndex,n=i.indices,t=Ae(this,r)}else n=u((t=this.getActiveSheet()).activeCell),r=this.activeSheetIndex;var a=He(n[0],n[1],t,!1,!0);if(a.validation||pt(t.columns[n[1]],n[0],n[1])){var o={value:a.value?a.value:"",range:n,sheetIdx:r,td:null,isValid:!0};return this.notify("isValidation",o),o.isValid}return!0},r.prototype.conditionalFormat=function(e){var t=this;if(e.range?","!==this.listSeparator&&e.range.includes(this.listSeparator)&&(e.range=e.range.split(this.listSeparator).join(",")):e.range=this.getActiveSheet().selectedRange,e.value){var r=void 0;if("Between"===e.type)if(","!==this.listSeparator&&e.value.includes(this.listSeparator))r=(n=e.value.split('"').filter(function(e){return e.trim()&&e.trim()!==t.listSeparator})).length>1?n:e.value.split(this.listSeparator);else{var n=e.value.split('"').filter(function(e){return e.trim()&&","!==e.trim()});r=n.length>1?n:e.value.split(",")}else r=[e.value];Q(r,this),e.value=r.join(",")}this.notify(yn,{cfModel:e})},r.prototype.clearConditionalFormat=function(e){var t={};if(e&&e.includes("!")){var r=e.lastIndexOf("!");t.range=e.substring(r+1),t.sheetIdx=Se(this,e.substring(0,r))}else t.range=e||this.getActiveSheet().selectedRange,t.sheetIdx=this.activeSheetIndex;this.notify(bn,t)},r.prototype.updateCell=function(e,r,n){t.isNullOrUndefined(n)&&(n=!0),this.updateCellDetails(e,r,void 0,void 0,n)},r.prototype.updateCellDetails=function(e,r,n,i,a,o,s){var l,d;if(r||(r=this.getActiveSheet().activeCell),r.includes("!")){if(l=y(r),void 0===(d=Se(this,r.substring(0,r.lastIndexOf("!")))))return}else l=c(r),d=this.activeSheetIndex;var h=Ae(this,d);if(o&&!(h.rowCount>l[0]&&h.rowCount>l[2]&&h.colCount>l[1]&&h.colCount>l[3]))return void this.notify("finiteAlert",null);Y(this,h,{cell:e,rowIdx:l[0],colIdx:l[1],preventEvt:!0});var p=s?e.formula||(t.isNullOrUndefined(e.value)?null:e.value):t.isNullOrUndefined(e.value)?e.formula||null:e.value,f=null!==p,g=He(l[0],l[1],h,!1,!0);if(n&&n.format&&i&&(g.format=n.format),f?(delete g.formattedText,this.notify($r,{action:"updateCellValue",address:l,value:p,sheetIndex:d,cellInformation:n,isRedo:i,isDependentUpdate:a}),this.isEdit&&"#CIRCULARREF!"===g.value&&(g.value="0")):!t.isNullOrUndefined(e.format)&&g.formattedText&&delete g.formattedText,d===this.activeSheetIndex){var m={sheet:h,cell:g,rowIdx:l[0],colIdx:l[1]};(g.rowSpan>1||g.colSpan>1)&&te(m);var v=!tt(h,m.rowIdx)&&!ht(h,m.colIdx)&&this.getCell(m.rowIdx,m.colIdx);v&&this.serviceLocator.getService("cell").refresh(m.rowIdx,m.colIdx,!0,v,f,f);var C=u(h.activeCell);l[0]===C[0]&&l[1]===C[1]&&(this.notify(Sn,null),this.notify("formulaBarOperation",{action:"refreshFormulabar",cell:g}),v&&e.validation&&(m.validation=g.validation,m.td=v,m.isRefresh=!0,this.notify("addListValidationDropdown",m)))}},r.prototype.getRowData=function(e,r){t.isNullOrUndefined(e)&&(e=0),t.isNullOrUndefined(r)&&(r=this.activeSheetIndex);var n={sheetIdx:r,startIndex:e,modelType:"Row",isDataRequest:!0};return this.notify("dataChanged",n),n.data},r.prototype.updateRange=function(e,t){void 0===t&&(t=this.activeSheetIndex);var r=Ae(this,t);r&&(e.startCell||(e.startCell="A1"),void 0===e.showFieldAsHeader&&(e.showFieldAsHeader=!0),e.template&&!e.address&&(e.address=e.startCell),r.ranges.push(e),this.setSheetPropertyOnMute(r,"ranges",r.ranges),e.dataSource&&this.notify("dataSourceChanged",{sheetIdx:t,rangeIdx:r.ranges.length-1,changedData:e.dataSource}))},r.prototype.wrap=function(e,t){void 0===t&&(t=!0),ze(e,t,this,null,!0)},r.prototype.addDefinedName=function(e){var t={action:"addDefinedName",isAdded:!1,definedName:e};return this.notify(Kr,t),t.isAdded},r.prototype.removeDefinedName=function(e,t){void 0===t&&(t="");var r={action:"removeDefinedName",isRemoved:!1,definedName:e,scope:t};return this.notify(Kr,r),r.isRemoved},r.prototype.insertImage=function(e,t){this.notify("setImage",{options:e,range:t||this.getActiveSheet().selectedRange})},r.prototype.autoFill=function(e,t,r,n){var i={dataRange:t||this.getActiveSheet().selectedRange,fillRange:e,direction:r||"Down",fillType:n||"FillSeries"};this.notify(En,i)},r.prototype.insertChart=function(e){this.notify(xn,{chart:e})},r.prototype.deleteChart=function(e){this.notify(Ai,{id:e})},r.prototype.filter=function(e,t){if(!this.allowFiltering)return Promise.reject();var r={args:{range:t||this.getActiveSheet().selectedRange,filterOptions:e,cancel:!1},promise:new Promise(function(e){e(void 0)})};return this.notify("initiateFilter",r),r.promise},r.prototype.addCustomFunction=function(e,t,r){var n={action:"addCustomFunction",functionHandler:e,functionName:t=t||("string"==typeof e?e:e.name.replace("bound ","")),formulaDescription:r};this.notify(Kr,n)},r.prototype.clear=function(e){this.notify("clear",e)},r.prototype.getDisplayText=function(e){if(!e)return"";if(e.format&&!t.isNullOrUndefined(e.value)){var r={formattedText:e.value,value:e.value,format:e.format,cell:e,skipFormatCheck:!0};return this.notify(Wr,r),r.formattedText}return!e.value&&e.hyperlink?"string"==typeof e.hyperlink?e.hyperlink:e.hyperlink.address:e.value||"number"==typeof e.value?e.value.toString():""},r.prototype.freezePanes=function(e,t,r){void 0===e&&(e=1),void 0===t&&(t=1);var n=this.getSheetModel(r);!this.allowFreezePane||n.frozenRows===e&&n.frozenColumns===t||(this.setSheetPropertyOnMute(n,"frozenRows",e),this.setSheetPropertyOnMute(n,"frozenColumns",t),this.updateTopLeftCell(),n.id===this.getActiveSheet().id&&"spreadsheet"===this.getModuleName()&&this.renderModule.refreshSheet())},r.prototype.Unfreeze=function(e){this.freezePanes(0,0,e)},r.prototype.unfreezePanes=function(e){this.freezePanes(0,0,e)},r.prototype.calculateNow=function(e,r){var n;"Workbook"===e&&"Manual"===this.calculationMode&&(e="CalculateWorkbook",this.setProperties({calculationMode:"Automatic"},!0));var i={action:"calculateNow",scope:e,sheets:n="Workbook"===e||"CalculateWorkbook"===e?this.sheets:[Ae(this,r="string"==typeof r?Se(this,r):t.isNullOrUndefined(r)?this.activeSheetIndex:r)],promise:new Promise(function(e){e(void 0)})};return this.notify(Kr,i),i.promise},r.prototype.updateTopLeftCell=function(e,r,n,i){i||(i=this.getActiveSheet());var a=u(i.topLeftCell);i.frozenRows||i.frozenColumns?((t.isNullOrUndefined(e)||e<0)&&(e=i.frozenRows?0:a[0]),(t.isNullOrUndefined(r)||r<0)&&(r=i.frozenColumns?0:a[1]),e+=this.frozenRowCount(i),r+=this.frozenColCount(i),n&&("row"===n?e=u(i.paneTopLeftCell)[0]:r=u(i.paneTopLeftCell)[1]),this.setSheetPropertyOnMute(i,"paneTopLeftCell",g(e,r)),i.frozenRows&&(e=a[0]),i.frozenColumns&&(r=a[1])):(t.isNullOrUndefined(e)&&(e=a[0]),t.isNullOrUndefined(r)&&(r=a[1]),this.setSheetPropertyOnMute(i,"paneTopLeftCell",g(e,r))),this.setSheetPropertyOnMute(i,"topLeftCell",g(e,r))},r.prototype.getAddressInfo=function(e){return x(this,e)},r.prototype.setSheetPropertyOnMute=function(e,t,r){this.isProtectedOnChange=!0,e[""+t]=r,this.isProtectedOnChange=!1},r.prototype.frozenRowCount=function(e){return e.frozenRows?"A1"===e.topLeftCell?e.frozenRows:u(e.topLeftCell)[0]+e.frozenRows:0},r.prototype.frozenColCount=function(e){return e.frozenColumns?"A1"===e.topLeftCell?e.frozenColumns:u(e.topLeftCell)[1]+e.frozenColumns:0},r.prototype.updateRangeOnInsertDelete=function(e,t,r,n,i,a,o){var s,l=!1;if(e.isInsert)if(s=e.endIndex-e.startIndex+1,"Row"===e.modelType)if(e.forceUpdate)t[0]+=1,t[2]+=1,l=!0;else{d=!a&&o&&t[2]===e.startIndex-1&&n===e.startIndex&&t[1]===t[3];e.startIndex<=t[0]&&(t[0]+=s,l=!0),(e.startIndex<=t[2]||r&&e.startIndex===t[2]+1&&d)&&(t[2]+=s,l=!0)}else if(e.forceUpdate)t[1]+=1,t[3]+=1,l=!0;else{var d=!a&&o&&t[3]===e.startIndex-1&&i===e.startIndex&&t[0]===t[2];e.startIndex<=t[1]&&(t[1]+=s,l=!0),(e.startIndex<=t[3]||r&&e.startIndex===t[3]+1&&d)&&(t[3]+=s,l=!0)}else"Row"===e.modelType?((s=t[0]-e.startIndex)>0&&(t[0]>e.endIndex?(s=e.endIndex-e.startIndex+1)>0&&(t[0]-=s,l=!0):(t[0]-=s,l=!0)),e.startIndex<=t[2]&&(e.endIndex<=t[2]?t[2]-=e.endIndex-e.startIndex+1:t[2]-=t[2]-e.startIndex+1,l=!0)):((s=t[1]-e.startIndex)>0&&(t[1]>e.endIndex?(s=e.endIndex-e.startIndex+1)>0&&(t[1]-=s,l=!0):(t[1]-=s,l=!0)),e.startIndex<=t[3]&&(e.endIndex<=t[3]?t[3]-=e.endIndex-e.startIndex+1:t[3]-=t[3]-e.startIndex+1,l=!0));return l},r.prototype.getCell=function(e,t,r){return null},r.prototype.dateToInt=function(e,t){return ce(e,t)},r.prototype.setDateFormat=function(e,t,r){var n=Ae(this,we(this,e)),i=He(t,r,n,null,!0).format;i&&"General"!==i||Ue(t,r,n,{format:Ke("ShortDate")},!0)};var n;return Ca([t.Collection([],Hn)],r.prototype,"sheets",void 0),Ca([t.Property(0)],r.prototype,"activeSheetIndex",void 0),Ca([t.Property("100%")],r.prototype,"height",void 0),Ca([t.Property(!0)],r.prototype,"allowFindAndReplace",void 0),Ca([t.Property()],r.prototype,"filterCollection",void 0),Ca([t.Property()],r.prototype,"sortCollection",void 0),Ca([t.Property("100%")],r.prototype,"width",void 0),Ca([t.Property(!0)],r.prototype,"showRibbon",void 0),Ca([t.Property(!0)],r.prototype,"showFormulaBar",void 0),Ca([t.Property(!0)],r.prototype,"showSheetTabs",void 0),Ca([t.Property(!0)],r.prototype,"allowEditing",void 0),Ca([t.Property(!0)],r.prototype,"allowOpen",void 0),Ca([t.Property(!0)],r.prototype,"allowSave",void 0),Ca([t.Property(!0)],r.prototype,"allowSorting",void 0),Ca([t.Property(!0)],r.prototype,"allowFiltering",void 0),Ca([t.Property(!0)],r.prototype,"allowNumberFormatting",void 0),Ca([t.Property(!0)],r.prototype,"allowCellFormatting",void 0),Ca([t.Property(!0)],r.prototype,"allowHyperlink",void 0),Ca([t.Property(!0)],r.prototype,"enableNotes",void 0),Ca([t.Property(!0)],r.prototype,"allowInsert",void 0),Ca([t.Property(!0)],r.prototype,"allowDelete",void 0),Ca([t.Property(!0)],r.prototype,"allowMerge",void 0),Ca([t.Property(!0)],r.prototype,"allowDataValidation",void 0),Ca([t.Property(!0)],r.prototype,"allowImage",void 0),Ca([t.Property(!0)],r.prototype,"allowChart",void 0),Ca([t.Property(!0)],r.prototype,"allowAutoFill",void 0),Ca([t.Property(!0)],r.prototype,"allowPrint",void 0),Ca([t.Property("Automatic")],r.prototype,"calculationMode",void 0),Ca([t.Complex({},jr)],r.prototype,"autoFillSettings",void 0),Ca([t.Property(!0)],r.prototype,"allowConditionalFormat",void 0),Ca([t.Complex({},Ir)],r.prototype,"cellStyle",void 0),Ca([t.Property("")],r.prototype,"openUrl",void 0),Ca([t.Complex({},jn)],r.prototype,"openSettings",void 0),Ca([t.Property("")],r.prototype,"saveUrl",void 0),Ca([t.Property("")],r.prototype,"password",void 0),Ca([t.Property(!1)],r.prototype,"isProtected",void 0),Ca([t.Collection([],Nr)],r.prototype,"definedNames",void 0),Ca([t.Event()],r.prototype,"beforeOpen",void 0),Ca([t.Event()],r.prototype,"openFailure",void 0),Ca([t.Event()],r.prototype,"beforeSave",void 0),Ca([t.Event()],r.prototype,"saveComplete",void 0),Ca([t.Event()],r.prototype,"beforeCellFormat",void 0),Ca([t.Event()],r.prototype,"queryCellInfo",void 0),Ca([t.Event()],r.prototype,"beforeCellUpdate",void 0),Ca([t.Property(!0)],r.prototype,"allowFreezePane",void 0),Ca([t.Property(",")],r.prototype,"listSeparator",void 0),r=n=Ca([t.NotifyPropertyChanges],r)}(t.Component),xa=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Sa=function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},wa=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return xa(r,e),Sa([t.Collection([],zn)],r.prototype,"cells",void 0),Sa([t.Property(0)],r.prototype,"index",void 0),Sa([t.Property(20)],r.prototype,"height",void 0),Sa([t.Property(!1)],r.prototype,"customHeight",void 0),Sa([t.Property(!1)],r.prototype,"hidden",void 0),Sa([t.Complex({},Or)],r.prototype,"format",void 0),Sa([t.Property(!1)],r.prototype,"isReadOnly",void 0),r}(t.ChildProperty),Ia=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ea=function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},Ra=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Ia(r,e),Ea([t.Property(0)],r.prototype,"index",void 0),Ea([t.Property(64)],r.prototype,"width",void 0),Ea([t.Property(!1)],r.prototype,"customWidth",void 0),Ea([t.Property(!1)],r.prototype,"hidden",void 0),Ea([t.Complex({},Or)],r.prototype,"format",void 0),Ea([t.Property(!0)],r.prototype,"isLocked",void 0),Ea([t.Property("")],r.prototype,"validation",void 0),Ea([t.Property(!1)],r.prototype,"isReadOnly",void 0),r}(t.ChildProperty),Na="spreadsheetLocale",Fa="dialog",Aa={Custom:["#ffffff","#000000","#e7e6e6","#44546a","#4472c4","#ed7d31","#a5a5a5","#ffc000","#70ad47","#ff0000","#f2f2f2","#808080","#cfcdcd","#d5dce4","#d9e2f3","#fbe4d5","#ededed","#fff2cc","#e2efd9","#ffcccc","#d9d9d9","#595959","#aeaaaa","#acb9ca","#b4c6e7","#f7caac","#dbdbdb","#ffe599","#c5e0b3","#ff8080","#bfbfbf","#404040","#747070","#8496b0","#8eaadb","#f4b083","#c9c9c9","#ffd966","#a8d08d","#ff3333","#a6a6a6","#262626","#3b3838","#323e4f","#2f5496","#c45911","#7b7b7b","#bf8f00","#538135","#b30000","#7f7f7f","#0d0d0d","#161616","#212934","#1f3763","#823b0b","#525252","#7f5f00","#375623","#660000"]},ka={Custom:["#ffffff","#000000","#ffff00","#00ff00","#00ffff","#0000ff","#ff0000","#000080","#800080","#996633","#f2f2f2","#808080","#ffffcc","#b3ffb3","#ccffff","#ccccff","#ffcccc","#ccccff","#ff80ff","#f2e6d9","#d9d9d9","#595959","#ffff80","#80ff80","#b3ffff","#8080ff","#ff8080","#8080ff","#ff00ff","#dfbf9f","#bfbfbf","#404040","#ffff33","#33ff33","#33ffff","#3333ff","#ff3333","#0000b3","#b300b3","#c68c53","#a6a6a6","#262626","#e6e600","#00b300","#009999","#000099","#b30000","#000066","#660066","#86592d","#7f7f7f","#0d0d0d","#999900","#006600","#006666","#000066","#660000","#00004d","#4d004d","#734d26"]},Oa={UP:38,DOWN:40,LEFT:37,RIGHT:39,FIRSTALPHABET:65,LASTALPHABET:90,SPACE:32,BACKSPACE:8,TAB:9,DELETE:46,ENTER:13,ESC:27},Ta={FindValue:"Find value",ReplaceValue:"Replace value",FindReplaceTooltip:"Find & Replace",InsertingEmptyValue:"Reference value is not valid.",ReplaceAllEnd:" matches replaced with ",ByRow:"By Rows",ByColumn:"By Columns",MatchCase:"Match case",MatchExactCellElements:"Match entire cell contents",EnterCellAddress:"Enter cell address",FindAndReplace:"Find and Replace",FindNextBtn:"Find Next",FindPreviousBtn:"Find Previous",ReplaceBtn:"Replace",ReplaceAllBtn:"Replace All",GotoHeader:"Go To",Sheet:"Sheet",Workbook:"Workbook",NoElements:"We couldn't find what you were looking for.",FindWhat:"Find what",ReplaceWith:"Replace with",Cut:"Cut",Copy:"Copy",Paste:"Paste",PasteSpecial:"Paste Special",Link:"Link",Spreadsheet:"Spreadsheet",AddNote:"Add Note",EditNote:"Edit Note",DeleteNote:"Delete Note",Hyperlink:"Hyperlink",EditHyperlink:"Edit Hyperlink",OpenHyperlink:"Open Hyperlink",RemoveHyperlink:"Remove Hyperlink",InvalidHyperlinkAlert:"The address of this site is not valid. Check the address and try again.",InsertLink:"Insert Link",EditLink:"Edit Link",All:"All",Values:"Values",Formats:"Formats",Bold:"Bold",Font:"Font",FontSize:"Font Size",Italic:"Italic",Underline:"Underline",Strikethrough:"Strikethrough",TextColor:"Text Color",FillColor:"Fill Color",HorizontalAlignment:"Horizontal Alignment",AlignLeft:"Align Left",AlignCenter:"Center",AlignRight:"Align Right",VerticalAlignment:"Vertical Alignment",AlignTop:"Align Top",AlignMiddle:"Align Middle",AlignBottom:"Align Bottom",WrapText:"Wrap Text",MergeCells:"Merge Cells",MergeAll:"Merge All",MergeHorizontally:"Merge Horizontally",MergeVertically:"Merge Vertically",Unmerge:"Unmerge",UnmergeCells:"Unmerge Cells",SelectMergeType:"Select Merge Type",MergeCellsAlert:"Merging cells will only preserve the top-leftmost(Uppermost) value. Merge anyway?",Borders:"Borders",TopBorders:"Top Borders",LeftBorders:"Left Borders",RightBorders:"Right Borders",BottomBorders:"Bottom Borders",AllBorders:"All Borders",HorizontalBorders:"Horizontal Borders",VerticalBorders:"Vertical Borders",OutsideBorders:"Outside Borders",InsideBorders:"Inside Borders",NoBorders:"No Borders",BorderColor:"Border Color",BorderStyle:"Border Style",InsertFunction:"Insert Function",CalcOptions:"Calculation Options",CalcOptionsTip:"Choose to calculate formulas either automatically or manually",CalcActiveSheet:"Calculate Sheet",CalcWorkbook:"Calculate Workbook",Automatic:"Automatic",Manual:"Manual",CalcSheetTip:"Calculate the active sheet",CalcWorkbookTip:"Calculate the entire workbook",Insert:"Insert",Delete:"Delete",DuplicateSheet:"Duplicate",MoveRight:"Move Right",MoveLeft:"Move Left",Rename:"Rename",Hide:"Hide",FileName:"File Name",PROPER:"Converts a text to proper case; first letter to uppercase and other letters to lowercase.",NameBox:"Name Box",ShowHeaders:"Show Headers",HideHeaders:"Hide Headers",ShowGridLines:"Show Gridlines",ExtendValidation:"The selection contains some cells without data validation. Do you want to extend validation to these cells?",Yes:"Yes",No:"No",HideGridLines:"Hide Gridlines",FreezePanes:"Freeze Panes",FreezeRows:"Freeze Rows",FreezeColumns:"Freeze Columns",UnfreezePanes:"Unfreeze Panes",UnfreezeRows:"Unfreeze Rows",UnfreezeColumns:"Unfreeze Columns",AddSheet:"Add Sheet",ListAllSheets:"List All Sheets",CollapseToolbar:"Collapse Toolbar",ExpandToolbar:"Expand Toolbar",CollapseFormulaBar:"Collapse Formula Bar",ExpandFormulaBar:"Expand Formula Bar",File:"File",Home:"Home",Formulas:"Formulas",View:"View",New:"New",Open:"Open",SaveAs:"Save As",Print:"Print",Update:"Update",ExcelXlsx:"Microsoft Excel",ExcelXls:"Microsoft Excel 97-2003",CSV:"Comma-separated values",FormulaBar:"Formula Bar",Sort:"Sort",SortAscending:"Ascending",SortDescending:"Descending",CustomSort:"Custom Sort",AddColumn:"Add Column",ContainsHeader:"Data contains header",CaseSensitive:"Case sensitive",SortBy:"Sort by",ThenBy:"Then by",SelectAColumn:"Select a column",SortEmptyFieldError:"All sort criteria must have a column specified. Check the selected sort criteria and try again.",SortDuplicateFieldError:"  is being sorted by values more than once. Delete the duplicate sort criteria and try again.",SortOutOfRangeError:"Select a cell or range inside the used range and try again.",MultiRangeSortError:"This can't be done on a multiple range selection. Select a single range and try again.",SortAndFilter:"Sort & Filter",Filter:"Filter",ClearAllFilter:"Clear",ClearFilterFrom:"Clear Filter From ",ReapplyFilter:"Reapply",FilterCellValue:"Filter by Value of Selected Cell",FilterOutOfRangeError:"Select a cell or range inside the used range and try again.",HideRow:"Hide Row",HideRows:"Hide Rows",UnhideRows:"Unhide Rows",HideColumn:"Hide Column",HideColumns:"Hide Columns",UnhideColumns:"Unhide Columns",InsertRow:"Insert Row",InsertRows:"Insert Rows",Above:"Above",Below:"Below",InsertColumn:"Insert Column",InsertColumns:"Insert Columns",Before:"Before",After:"After",DeleteRow:"Delete Row",DeleteRows:"Delete Rows",DeleteColumn:"Delete Column",DeleteColumns:"Delete Columns",Ok:"OK",Close:"Close",MoreOptions:"More Options",Cancel:"Cancel",Apply:"Apply",MoreColors:"More Colors",StandardColors:"Standard Colors",General:"General",Number:"Number",Currency:"Currency",Accounting:"Accounting",ShortDate:"Short Date",LongDate:"Long Date",Time:"Time",Percentage:"Percentage",Fraction:"Fraction",Scientific:"Scientific",Text:"Text",Custom:"Custom",MobileFormulaBarPlaceHolder:"Enter value or Formula",NumberFormat:"Number Format",PasteAlert:"You can't paste this here, because the copy area and paste area aren't in the same size. Please try pasting in a different range.",DestroyAlert:"Are you sure you want to destroy the current workbook without saving and create a new workbook?",SheetRenameInvalidAlert:"Sheet name contains invalid character.",SheetRenameEmptyAlert:"Sheet name cannot be empty.",SheetRenameAlreadyExistsAlert:"Sheet name already exists. Please enter another name.",DeleteSheetAlert:"You can't undo deleting sheets, and you might be removing some data. If you don't need it, click OK to delete.",DeleteSingleLastSheetAlert:"A Workbook must contain at least one visible worksheet.",PickACategory:"Pick a category",Description:"Description",UnsupportedFile:"Unsupported File",DataLimitExceeded:"File data is too large and it takes more time to process, do you want to continue?",FileSizeLimitExceeded:"File size is too large and it takes more time to process, do you want to continue?",InvalidUrl:"Invalid URL",SUM:"Adds a series of numbers and/or cells.",SUMIF:"Adds the cells based on specified condition.",SUMIFS:"Adds the cells based on specified conditions.",ABS:"Returns the value of a number without its sign.",RAND:"Returns a random number between 0 and 1.",RANDBETWEEN:"Returns a random integer based on specified values.",FLOOR:"Rounds a number down to the nearest multiple of a given factor.",CEILING:"Rounds a number up to the nearest multiple of a given factor.",PRODUCT:"Multiplies a series of numbers and/or cells.",INT:"Returns a number to the nearest integer.",ROUNDUP:"Rounds a number away from zero.",SUMPRODUCT:"Returns sum of the product of given ranges of arrays.",SORT:"Sorts a range of an array",T:"Checks whether a value is text or not and returns the text.",EXACT:"Checks whether a two text strings are exactly same and returns TRUE or FALSE.",LEN:"Returns a number of characters in a given string.",MOD:"Returns a remainder after a number is divided by divisor.",ODD:"Rounds a positive number up and negative number down to the nearest odd integer.",PI:"Returns the value of pi.",COUNTBLANK:"Returns the number of empty cells in a specified range of cells.",EVEN:"Rounds a positive number up and negative number down to the nearest even integer.",DECIMAL:"Converts a text representation of a number in a given base into a decimal number.",DEGREES:"Converts radians to degrees.",ADDRESS:"Returns a cell reference as text, given specified row and column numbers.",TIME:"Converts hours, minutes, seconds to the time formatted text.",CHAR:"Returns the character from the specified number.",CODE:"Returns the numeric code for the first character in a given string.",DOLLAR:"Converts the number to currency formatted text.",SMALL:"Returns the k-th smallest value in a given array.",LARGE:"Returns the k-th largest value in a given array.",FACT:"Returns the factorial of a number.",MEDIAN:"Returns the median of the given set of numbers.",EDATE:"Returns a date with given number of months before or after the specified date.",DATEVALUE:"Converts a date string into date value.",HOUR:"Returns the number of hours in a specified time string.",SECOND:"Returns the number of seconds in a specified time string.",MINUTE:"Returns the number of minutes in a specified time string.",NOW:"Returns the current date and time.",MONTH:"Returns the number of months in a specified date string.",TODAY:"Returns the current date as date value.",WEEKDAY:"Returns the day of the week corresponding to a date.",AVERAGE:"Calculates average for the series of numbers and/or cells excluding text.",AVERAGEIF:"Calculates average for the cells based on specified criterion.",AVERAGEIFS:"Calculates average for the cells based on specified conditions.",AVERAGEA:"Calculates the average for the cells evaluating TRUE as 1, text and FALSE as 0.",COUNT:"Counts the cells that contain numeric values in a range.",COUNTIF:"Counts the cells based on specified condition.",COUNTIFS:"Counts the cells based on specified conditions.",COUNTA:"Counts the cells that contains values in a range.",MIN:"Returns the smallest number of the given arguments.",MAX:"Returns the largest number of the given arguments.",DATE:"Returns the date based on given year, month, and day.",DAY:"Returns the day from the given date.",DAYS:"Returns the number of days between two dates.",IF:"Returns value based on the given expression.",IFS:"Returns value based on the given multiple expressions.",CalculateAND:"Returns TRUE if all the arguments are TRUE, otherwise returns FALSE.",CalculateOR:"Returns TRUE if any of the arguments are TRUE, otherwise returns FALSE.",IFERROR:"Returns value if no error found else it will return specified value.",CHOOSE:"Returns a value from list of values, based on index number.",INDEX:"Returns a value of the cell in a given range based on row and column number.",FIND:"Returns the position of a string within another string, which is case sensitive.",TEXT:"Converts a value to text in specified number format.",CONCATENATE:"Combines two or more strings together.",CONCAT:"Concatenates a list or a range of text strings.",SUBTOTAL:"Returns subtotal for a range using the given function number.",RADIANS:"Converts degrees into radians.",MATCH:"Returns the relative position of a specified value in given range.",LN:"Returns the natural logarithm of a number.",INTERCEPT:"Calculates the point of the Y-intercept line via linear regression.",UNIQUE:"Returns a unique values from a range or array",SLOPE:"Returns the slope of the line from linear regression of the data points.",LOOKUP:"Looks for a value in a one-row or one-column range, then returns a value from the same position in a second one-row or one-column range.",HLOOKUP:"Looks for a value in the top row of the array of values and then returns a value in the same column from a row in the array that you specify.",VLOOKUP:"Looks for a specific value in the first column of a lookup range and returns a corresponding value from a different column within the same row.",NOT:"Returns the inverse of a given logical expression.",EOMONTH:"Returns the last day of the month that is a specified number of months before or after an initially supplied start date.",SQRT:"Returns the square root of a positive number.",ROUNDDOWN:"Rounds a number down, toward zero.",RSQ:"Returns the square of the Pearson product moment correlation coefficient based on data points in known_y's and known_x's.",DefineNameExists:"This name already exists, try different name.",DefineNameInValid:"The name that you entered is not valid.",CircularReference:"When a formula refers to one or more circular references, this may result in an incorrect calculation.",OR:"OR",AND:"AND",CustomFilterDatePlaceHolder:"Choose a date",CustomFilterPlaceHolder:"Enter the value",CustomFilter:"Custom Filter",Between:"Between",DateTimeFilter:"DateTime Filters",Undo:"Undo",Redo:"Redo",DateFilter:"Date Filters",TextFilter:"Text Filters",NumberFilter:"Number Filters",ClearFilter:"Clear Filter",NoResult:"No Matches Found",FilterFalse:"False",FilterTrue:"True",Blanks:"Blanks",SelectAll:"Select All",GreaterThanOrEqual:"Greater Than Or Equal",GreaterThan:"Greater Than",LessThanOrEqual:"Less Than Or Equal",LessThan:"Less Than",NotEqual:"Not Equal",Equal:"Equal",Contains:"Contains",NotContains:"Does Not Contains",EndsWith:"Ends With",NotEndsWith:"Does Not End With",StartsWith:"Starts With",NotStartsWith:"Does Not Start With",IsEmpty:"Empty",IsNotEmpty:"Not Empty",ClearButton:"Clear",FilterButton:"Filter",CancelButton:"Cancel",OKButton:"OK",Search:"Search",ProtectSheet:"Protect Sheet",UnprotectSheet:"Unprotect Sheet",SelectCells:"Select locked cells",SelectUnlockedCells:"Select unlocked cells",FormatCells:"Format cells",FormatRows:"Format rows",FormatColumns:"Format columns",InsertLinks:"Insert links",ProtectContent:"Protect the contents of locked cells",ProtectAllowUser:" Allow all users of this worksheet to:",EditAlert:"The cell you're trying to change is protected. To make change, unprotect the sheet.",ReadonlyAlert:"You are trying to modify a cell that is in read-only mode. To make changes, please disable the read-only status.",FiniteAlert:"Finite mode is active: Cannot access the specified cell range outside the defined limits.",Alert:"Alert",SearchWithin:"Search within",SearchBy:"Search by",Reference:"Reference",DataValidation:"Data Validation",CellRange:"Cell Range",Allow:"Allow",Data:"Data",Minimum:"Minimum",Maximum:"Maximum",IgnoreBlank:"Ignore blank",WholeNumber:"Whole Number",Decimal:"Decimal",Date:"Date",TextLength:"Text Length",List:"List",NotBetween:"Not Between",EqualTo:"Equal To",NotEqualTo:"Not Equal To",GreaterThanOrEqualTo:"Greater Than Or Equal To",LessThanOrEqualTo:"Less Than Or Equal To",InCellDropDown:"In-cell-dropdown",Sources:"Sources",Value:"Value",Formula:"Formula",Retry:"Retry",DialogError:"The list source must be a reference to single row or column.",NamedRangeError:"A named range you specified cannot be found.",MinMaxError:"The Maximum must be greater than or equal to the Minimum.",InvalidNumberError:"Please enter a valid number.",InvalidFormula:"Please enter a valid formula.",MoreValidation:"This selection contains more than one validation. \n Erase current settings and continue?",FileNameError:"A file name can't contain characters like \\ / : * ? \" < > [ ] |",ListLengthError:"The list values allows only upto 256 characters",ValidationError:"This value doesn't match the data validation restrictions defined for the cell.",EmptyError:"You must enter a value",ClearHighlight:"Clear Highlight",HighlightInvalidData:"Highlight Invalid Data",ClearValidation:"Clear Validation",HighlightCellsRules:"Highlight Cells Rules",CFEqualTo:"Equal To",TextThatContains:"Text that Contains",Save:"Save",EmptyFileName:"File name cannot be empty.",LargeName:"The name is too long.",ADateOccuring:"A Date Occuring",DuplicateValues:"Duplicate Values",TopBottomRules:"Top/Bottom Rules",Directional:"Directional",Shapes:"Shapes",Indicators:"Indicators",Ratings:"Ratings",Top10Items:"Top 10 Items",Top10:"Top 10",Bottom10Items:"Bottom 10 Items",Bottom10:"Bottom 10",AboveAverage:"Above Average",BelowAverage:"Below Average",FormatCellsGreaterThan:"Format cells that are GREATER THAN:",FormatCellsLessThan:"Format cells that are LESS THAN:",FormatCellsBetween:"Format cells that are BETWEEN:",FormatCellsEqualTo:"Format cells that are EQUAL TO:",FormatCellsThatContainTheText:"Format cells that contain the text:",FormatCellsThatContainADateOccurring:"Format cells that contain a date occurring:",FormatCellsDuplicate:"Format cells that contain:",FormatCellsTop:"Format cells that rank in the TOP:",FormatCellsBottom:"Format cells that rank in the BOTTOM:",FormatCellsAbove:"Format cells that are ABOVE AVERAGE:",FormatCellsBelow:"Format cells that are BELOW AVERAGE:",With:"with",DataBars:"Data Bars",ColorScales:"Color Scales",IconSets:"Icon Sets",ClearRules:"Clear Rules",SelectedCells:"Clear Rules from Selected Cells",EntireSheet:"Clear Rules from Entire Sheet",ISNUMBER:"Returns true when the value parses as a numeric value.",ROUND:"Rounds a number to a specified number of digits.",GEOMEAN:"Returns the geometric mean of an array or range of positive data.",POWER:"Returns the result of a number raised to power",LOG:"Returns the logarithm of a number to the base that you specify.",TRUNC:"Returns the truncated value of a number to a specified number of decimal places.",EXP:"Returns e raised to the power of the given number.",Clear:"Clear",ClearContents:"Clear Contents",ClearAll:"Clear All",ClearFormats:"Clear Formats",ClearHyperlinks:"Clear Hyperlinks",LightRedFillWithDarkRedText:"Light Red Fill with Dark Red Text",YellowFillWithDarkYellowText:"Yellow Fill with Dark Yellow Text",GreenFillWithDarkGreenText:"Green Fill with Dark Green Text",RedFill:"Red Fill",RedText:"Red Text",Duplicate:"Duplicate",Unique:"Unique",And:"and",WebPage:"Web Page",ThisDocument:"This Document",DisplayText:"Display Text",Url:"URL",CellReference:"Cell Reference",DefinedNames:"Defined Names",EnterTheTextToDisplay:"Enter the text to display",EnterTheUrl:"Enter the URL",Image:"Image",ConditionalFormatting:"Conditional Formatting",BlueDataBar:"Blue Data Bar",GreenDataBar:"Green Data Bar",RedDataBar:"Red Data Bar",OrangeDataBar:"Orange Data Bar",LightBlueDataBar:"Light blue Data Bar",PurpleDataBar:"Purple Data Bar",GYRColorScale:"Green - Yellow - Red Color Scale",RYGColorScale:"Red - Yellow - Green Color Scale",GWRColorScale:"Green - White - Red Color Scale",RWGColorScale:"Red - White - Green Color Scale",BWRColorScale:"Blue - White - Red Color Scale",RWBColorScale:"Red - White - Blue Color Scale",WRColorScale:"White - Red Color Scale",RWColorScale:"Red - White Color Scale",GWColorScale:"Green - White Color Scale",WGColorScale:"White - Green Color Scale",GYColorScale:"Green - Yellow Color Scale",YGColorScale:"Yellow - Green Color Scale",ThreeArrowsColor:"3 Arrows (Colored)",ThreeArrowsGray:"3 Arrows (Gray)",ThreeTriangles:"3 Triangles",FourArrowsColor:"4 Arrows (Gray)",FourArrowsGray:"4 Arrows (Colored)",FiveArrowsColor:"5 Arrows (Gray)",FiveArrowsGray:"5 Arrows (Colored)",ThreeTrafficLights1:"3 Traffic Lights (Unrimmed)",ThreeTrafficLights2:"3 Traffic Lights (Rimmed)",ThreeSigns:"3 Signs",FourTrafficLights:"4 Traffic Lights",RedToBlack:"Red To Black",ThreeSymbols1:"3 Symbols (Circled)",ThreeSymbols2:"3 Symbols (Uncircled)",ThreeFlags:"3 Flags",ThreeStars:"3 Stars",FourRatings:"4 Ratings",FiveQuarters:"5 Quarters",FiveRatings:"5 Ratings",FiveBoxes:"5 Boxes",Chart:"Chart",Column:"Column",Bar:"Bar",Area:"Area",Pie:"Pie",Doughnut:"Doughnut",PieAndDoughnut:"Pie/Doughnut",Line:"Line",LineMarker:"Line with Markers",Radar:"Radar",Scatter:"Scatter",ChartDesign:"Chart Design",ClusteredColumn:"Clustered Column",StackedColumn:"Stacked Column",StackedColumn100:"100% Stacked Column",ClusteredBar:"Clustered Bar",StackedBar:"Stacked Bar",StackedBar100:"100% Stacked Bar",StackedArea:"Stacked Area",StackedArea100:"100% Stacked Area",StackedLine:"Stacked Line",StackedLineMarker:"Stacked Line with Markers",StackedLine100:"100% Stacked Line",StackedLine100Marker:"100% Stacked Line with Markers",AddChartElement:"Add Chart Element",Axes:"Axes",AxisTitle:"Axis Title",ChartTitle:"Chart Title",DataLabels:"Data Labels",Gridlines:"Gridlines",Legends:"Legends",PrimaryHorizontal:"Primary Horizontal",PrimaryVertical:"Primary Vertical",None:"None",AboveChart:"Above Chart",Center:"Center",InsideEnd:"Inside End",InsideBase:"Inside Base",OutsideEnd:"OutSide End",PrimaryMajorHorizontal:"Primary Major Horizontal",PrimaryMajorVertical:"Primary Major Vertical",PrimaryMinorHorizontal:"Primary Minor Horizontal",PrimaryMinorVertical:"Primary Minor Vertical",Right:"Right",Left:"Left",Bottom:"Bottom",Top:"Top",SwitchRowColumn:"Switch Row/Column",ChartTheme:"Chart Theme",ChartType:"Chart Type",Material:"Material",Fabric:"Fabric",Bootstrap:"Bootstrap",HighContrastLight:"HighContrast Light",MaterialDark:"Material Dark",FabricDark:"Fabric Dark",HighContrast:"HighContrast",BootstrapDark:"Bootstrap Dark",Bootstrap4:"Bootstrap4",Bootstrap5Dark:"Bootstrap5 Dark",Bootstrap5:"Bootstrap5",Tailwind:"Tailwind",TailwindDark:"Tailwind Dark",Tailwind3:"Tailwind 3",Tailwind3Dark:"Tailwind 3 Dark",VerticalAxisTitle:"Vertical Axis Title",HorizontalAxisTitle:"Horizontal Axis Title",EnterTitle:"Enter Title",ProtectWorkbook:"Protect Workbook",Password:"Password (optional):",EnterThePassword:"Enter the password",ConfirmPassword:"Confirm Password",EnterTheConfirmPassword:"Re-enter your password",PasswordAlert:"Confirmation password is not identical",UnprotectWorkbook:"Unprotect Workbook",UnprotectPasswordAlert:"The password you supplied is not correct.",IncorrectPassword:"Unable to open the file or worksheet with the given password",PasswordAlertMsg:"Please enter the password",ConfirmPasswordAlertMsg:"Please enter the confirm password",IsProtected:"is protected",PDF:"PDF Document",AutoFillMergeAlertMsg:"To do this, all the merged cells need to be the same size.",FillSeries:"Fill Series",CopyCells:"Copy Cells",FillFormattingOnly:"Fill Formatting Only",FillWithoutFormatting:"Fill Without Formatting",CustomFormat:"Custom Number Formats",CustomFormatPlaceholder:"Type or Select a custom format",CustomFormatTypeList:"Type",UnprotectWorksheet:"Unprotect Sheet",ReEnterPassword:"Re-enter password to proceed",SheetPassword:"Password to unprotect sheet:",Fluent:"Fluent",FluentDark:"Fluent Dark",Fluent2:"Fluent 2",Fluent2Dark:"Fluent 2 Dark",Fluent2HighContrast:"Fluent 2 HighContrast",Material3:"Material 3",Material3Dark:"Material 3 Dark",CellReferenceTypoError:"We found a typo in your cell reference. Do you want to correct this reference as follows?",InvalidFormulaError:"We found that you typed a formula which is invalid.",InvalidArguments:"We found that you typed a formula with an invalid arguments.",EmptyExpression:"We found that you typed a formula with an empty expression.",MismatchedParenthesis:"We found that you typed a formula with one or more missing opening or closing parenthesis.",ImproperFormula:"We found that you typed a formula which is improper.",WrongNumberOfArguments:"We found that you typed a formula with a wrong number of arguments.",Requires3Arguments:"We found that you typed a formula which requires 3 arguments.",MismatchedStringQuotes:"We found that you typed a formula with a mismatched quotes.",FormulaCircularRef:"We found that you typed a formula with a circular reference.",AddCurrentSelection:"Add current selection to filter",ExternalWorkbook:"An imported excel file contains an external workbook reference. Do you want to import that file?"},Da=null,La=1.24,Pa={role:"role",selected:"aria-selected",multiselectable:"aria-multiselectable",busy:"aria-busy",colcount:"aria-colcount"},Ma=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ba=function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},Ha=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Ma(r,e),Ba([t.Property(!1)],r.prototype,"isFinite",void 0),Ba([t.Property(!0)],r.prototype,"enableVirtualization",void 0),r}(t.ChildProperty),Ua=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Ma(r,e),Ba([t.Property("Multiple")],r.prototype,"mode",void 0),r}(t.ChildProperty),Va=function(){function e(e){this.colGroupWidth=30,this.parent=e,this.col=e.createElement("col"),this.rowRenderer=e.serviceLocator.getService("row"),this.cellRenderer=e.serviceLocator.getService("cell"),this.addEventListener()}return e.prototype.refreshSelectALLContent=function(){var e,t=this.parent.getActiveSheet();if(t.frozenColumns||t.frozenRows){var r=this.getSelectAllTable().querySelector("thead"),n=this.rowRenderer.render();r.appendChild(n),e=this.parent.createElement("th",{className:"e-select-all-cell"}),n.appendChild(e)}else(e=this.headerPanel.firstElementChild).classList.add("e-select-all-cell");e.appendChild(this.parent.createElement("button",{className:"e-selectall",id:this.parent.element.id+"_select_all",attrs:{"aria-label":this.parent.serviceLocator.getService(Na).getConstant("SelectAll"),type:"button"}}))},e.prototype.updateLeftColGroup=function(e,t){e&&(this.colGroupWidth=e),t||(t=this.getRowHeaderPanel());var r,n=t.querySelector("table"),i=this.parent.getActiveSheet(),a=document.createDocumentFragment();if(e)n.querySelector("colgroup").firstElementChild.style.width=this.colGroupWidth+"px";else{r=this.parent.createElement("colgroup");var o=this.col.cloneNode();o.style.width=this.colGroupWidth+"px",a.appendChild(o),r.appendChild(a),n.insertBefore(r,n.querySelector("tbody"))}(i.frozenRows||i.frozenColumns)&&(n=this.getSelectAllTable(),e?n.querySelector("colgroup").firstElementChild.style.width=this.colGroupWidth+"px":n.insertBefore(r.cloneNode(!0),n.querySelector("thead"))),this.setPanelWidth(i,t),this.setPanelHeight(i)},e.prototype.setPanelWidth=function(e,r,n){var i,a=this.getScrollSize(!0),o=this.getRowHeaderWidth(e),s=this.parent.enableRtl,l=s?"right":"left",d=this.getColHeaderPanel(),h=this.getContentPanel();if(n&&(i=s?"left":"right",h.style[""+i]=d.style[""+i]=""),e.frozenColumns){var p=document.getElementById(this.parent.element.id+"_sheet").getElementsByClassName("e-frozen-column")[0];p.style.height="calc(100% - "+a+"px)",n&&(p.style[""+i]=""),p.style[""+l]=o-Vt(1)+"Px",p.style.display=""}var c="calc(100% - "+o+"px)";this.setHeaderPanelWidth(this.getSelectAllContent(),o),d.style.width=c,d.style[""+l]=o+"px",this.setHeaderPanelWidth(r,o),h.style.width=c,h.style[""+l]=o+"px";var u=this.contentPanel.nextElementSibling?this.contentPanel.nextElementSibling:null;u&&(a?u.style.height=a+1+"px":(u.style.height="1px",u.style.borderTopWidth="0px"),u=u.firstElementChild,n&&(u.style[""+i]=""),u.style[""+l]=o+"px",u.style.width=c,t.Browser.userAgent.indexOf("Mac OS")>-1&&"safari"===t.Browser.info.name&&(u.style.height="7px",u.style.top="-7px"))},e.prototype.getScrollSize=function(e){var t=parseInt(this.headerPanel.style[this.parent.enableRtl?"margin-left":"margin-right"],10);return t?t+(e?1:0):0},e.prototype.setHeaderPanelWidth=function(e,t){[].slice.call(e.querySelectorAll("col.e-empty")).forEach(function(e){t+=parseInt(e.style.width,10)}),e.style.width=t+"px"},e.prototype.setPanelHeight=function(e){var r=this.getScrollSize(!0),n=this.contentPanel,i=this.headerPanel;if(e.frozenRows){var a=this.getColHeaderHeight(e);e.showHeaders||e.frozenColumns?i.style.height="":i.style.height=a+"px",n.style.height="calc(100% - "+(a+r)+"px)";var o=document.getElementById(this.parent.element.id+"_sheet").getElementsByClassName("e-frozen-row")[0];o.style.width=t.Browser.isDevice?"100%":"calc(100% - "+r+"px)",o.style.top=a-1-(e.showHeaders?1:0)+"px",o.style.display=""}else n.style.height="calc(100% - "+((e.showHeaders?Vt(31):0)+r)+"px)"},e.prototype.renderPanel=function(){this.contentPanel=this.parent.createElement("div",{className:"e-main-panel",attrs:{tabindex:"0"}});var e=this.parent.getActiveSheet(),r=this.parent.element.id,n=document.createDocumentFragment(),i=this.parent.createElement("div",{className:"e-row-header",id:r+"_row_header"});n.appendChild(i),this.initHeaderPanel(),this.parent.allowScrolling&&this.parent.scrollModule.setPadding();var a=document.getElementById(this.parent.element.id+"_sheet");e.frozenColumns&&a.classList.add("e-frozen-columns"),e.frozenRows&&a.classList.add("e-frozen-rows"),this.updateHideHeaders(e,a),e.showGridLines||a.classList.add("e-hide-gridlines");var o=this.parent.createElement("div",{className:"e-sheet-content",id:r+"_main_content"});n.appendChild(o),this.parent.allowScrolling||(o.style.overflow="hidden"),e.frozenRows&&a.appendChild(this.parent.createElement("div",{className:"e-frozen-row",styles:"display: none"})),e.frozenColumns&&a.appendChild(this.parent.createElement("div",{className:"e-frozen-column",styles:"display: none"})),t.Browser.userAgent.indexOf("Mac OS")>-1&&"safari"===t.Browser.info.name&&a.classList.add("e-mac-safari"),this.contentPanel.appendChild(n)},e.prototype.initHeaderPanel=function(){var e=this.parent.element.id,t=document.createDocumentFragment();this.headerPanel=this.parent.createElement("div",{className:"e-header-panel"});var r=this.parent.createElement("div",{className:"e-selectall-container",id:e+"_selectall"});t.appendChild(r);var n=this.parent.createElement("div",{className:"e-column-header",id:e+"_col_header"});t.appendChild(n),this.headerPanel.appendChild(t)},e.prototype.createHeaderTable=function(){var e=this.contentPanel.querySelector(".e-row-header"),t=this.parent.getActiveSheet();(t.frozenRows||t.frozenColumns)&&this.updateTable(t.frozenRows?["thead","tbody"]:["thead"],"selectall",this.headerPanel.querySelector(".e-selectall-container")),this.updateTable(t.frozenRows?["thead","tbody"]:["thead"],"colhdr",this.headerPanel.querySelector(".e-column-header")),this.updateTable(["tbody"],"rowhdr",e),this.updateLeftColGroup(null,e)},e.prototype.updateTable=function(e,t,r){var n=this,i=document.createDocumentFragment(),a=this.parent.createElement("table",{className:"e-table e-"+t+"-table",attrs:{role:"grid"}});e.forEach(function(e){i.appendChild(n.parent.createElement(e))}),a.appendChild(i),r.appendChild(a)},e.prototype.renderTable=function(e){var r,n,i,a,o,s=this,l=this.parent.getActiveSheet(),d=[],h=document.createDocumentFragment();if(h.appendChild(this.headerPanel),h.appendChild(this.contentPanel),this.parent.allowScrolling){var p=this.parent.createElement("div",{className:"e-scrollbar"});p.appendChild(this.parent.createElement("div",{className:"e-scroller"})),h.appendChild(p)}this.createHeaderTable(),this.updateTable(["tbody"],"content",this.contentPanel.lastElementChild);var u,f=this.parent.createElement("colgroup"),g=this.contentPanel.querySelector(".e-sheet-content tbody");this.refreshSelectALLContent();var m=this.getSelectAllContent().querySelector("colgroup"),v=this.getRowHeaderPanel().querySelector("colgroup"),y=this.getSelectAllContent().querySelector("thead .e-header-row"),C=this.contentPanel.querySelector(".e-row-header tbody"),b=this.getSelectAllContent().querySelector("tbody"),x=this.headerPanel.querySelector(".e-column-header thead"),S=this.headerPanel.querySelector(".e-column-header tbody"),w=this.rowRenderer.render();x.appendChild(w),this.getColHeaderTable().insertBefore(f,x);var I=this.parent.frozenRowCount(l),E=this.parent.frozenColCount(l),R=j(l,E-1,!1,"columns");this.parent.notify("beforeContentLoaded",{top:e.top,left:e.left});var N=l.colCount.toString(),F=l.colCount.toString(),A=e.top&&e.left?"RowColumn":e.top?"Row":e.left?"Column":"";this.parent.getColHeaderTable().setAttribute("aria-colcount",N),this.parent.getRowHeaderTable().setAttribute("aria-rowcount",F);var k;t.attributes(this.parent.getContentTable(),{"aria-rowcount":F,"aria-colcount":N}),e.cells.forEach(function(t,h){(r=c(h))[1]!==e.indexes[1]&&n||(r[1]===e.indexes[1]&&(i=s.rowRenderer.render(r[0],!0)),E&&I&&r[1]<E&&r[0]<I?((k=b.querySelector(".e-empty"))?b.insertBefore(i,k):b.appendChild(i),n=i):E&&r[1]<E?(C.appendChild(i),n=i):(n=s.rowRenderer.render(r[0]),I&&r[0]<I?(k=S.querySelector(".e-empty"))?S.insertBefore(n,k):S.appendChild(n):g.appendChild(n),r[1]===e.indexes[1]&&(I&&r[0]<I?b.appendChild(i):C.appendChild(i))),r[1]===e.indexes[1]&&s.cellRenderer.renderRowHeader(r[0],i)),o={colIdx:r[1],rowIdx:r[0],cell:t,mergeBorderRows:d,address:h,lastCell:r[1]===e.indexes[3],isHeightCheckNeeded:!0,row:n,hRow:i,pRow:n.previousSibling,pHRow:i.previousSibling,isRefreshing:e.isRefreshing,first:A?A.includes("Row")?r[0]===e.indexes[0]?"Row":A.includes("Column")&&r[1]===e.indexes[1]?"Column":"":r[1]===e.indexes[1]?"Column":"":""},a=s.cellRenderer.render(o);var p=s.parent.scrollSettings.enableVirtualization&&s.parent.viewport.topIndex!==j(l,0,!0),x=s.parent.scrollSettings.enableVirtualization&&s.parent.viewport.leftIndex!==j(l,0,!0,"columns");if(p&&s.checkRowMerge(r,e.indexes,a,t,l),x&&s.checkColMerge(r,e.indexes,a,t,l),E&&r[1]===R&&(n=null),r[0]===e.indexes[0])if(E&&r[1]<E){u=s.updateCol(l,r[1],m);var N=v.querySelector(".e-empty");N?v.insertBefore(u.cloneNode(!0),N):v.appendChild(u.cloneNode(!0)),s.cellRenderer.renderColHeader(r[1],y)}else s.updateCol(l,r[1],f),s.cellRenderer.renderColHeader(r[1],w)}),this.parent.isReact&&this.parent.renderReactTemplates(),le(this.parent,d),g.parentElement.insertBefore(f.cloneNode(!0),g),ft(function(){if(s.parent){var t=s.parent.getMainContent(),r=document.getElementById(s.parent.element.id+"_sheet");if(r.childElementCount&&r.querySelector(".e-header-panel")!==s.headerPanel)for(var n=r.children,i=0;i<n.length;i++)n[i].classList.contains("e-frozen-row")||n[i].classList.contains("e-frozen-column")||n[i].classList.contains("e-ss-overlay")||r.removeChild(n[i]);if(r.appendChild(h),r.style.backgroundColor="",l.conditionalFormats&&l.conditionalFormats.length&&s.parent.notify(Cn,{indexes:e.indexes}),s.checkRowHeightChanged(e,l),e.top&&(t.parentElement.scrollTop=e.top),e.left&&(t.scrollLeft=e.left,s.parent.getColumnHeaderContent().scrollLeft=e.left),s.parent.notify(Wn,e),s.checkTableWidth(l),s.parent.notify(Yn,{action:"renderEditor",initLoad:e.initLoad&&!s.parent.isOpen}),e.initLoad||s.parent.isOpen||s.parent.hideSpinner(),zt(t,{busy:!1}),s.parent.trigger("dataBound",{}),s.parent.isEdit&&s.parent.notify("initiateEdit",null),e.openOptions&&e.openOptions.eventArgs&&e.openOptions.eventArgs.triggerEvent&&s.parent.trigger("openComplete",{response:e.openOptions}),e.initLoad){var a=!0;if(s.parent.scrollSettings.enableVirtualization)for(i=0;i<l.ranges.length;i++)if(l.ranges[i].info.count-1>s.parent.viewport.bottomIndex){a=!1;break}a?s.parent.isReact?setTimeout(function(){s.parent&&s.triggerCreatedEvent()}):s.triggerCreatedEvent():s.parent.isOpen||s.parent.hideSpinner()}}})},e.prototype.triggerCreatedEvent=function(){this.parent.isOpen||this.parent.hideSpinner(),this.parent.createdHandler&&(this.parent.createdHandler.observers?(this.parent.created.observers=this.parent.createdHandler.observers,this.parent.isAngular&&this.parent.createdHandler.currentObservers&&(this.parent.created.currentObservers=this.parent.createdHandler.currentObservers)):this.parent.setProperties({created:this.parent.createdHandler},!0),this.parent.createdHandler=void 0,this.parent.trigger("created",null),this.parent&&this.parent.notify("clearUndoRedoCollection",null)),this.parent&&this.parent.notify("spreadsheetCreated",null)},e.prototype.checkRowHeightChanged=function(e,t){var r={top:e.top,left:e.left,sheet:t};this.parent.notify("getUpdatedScrollPosition",r),e.top!==r.top&&(this.parent.scrollModule&&this.parent.scrollModule.offset.top.idx&&r.top-e.top<nt(t,this.parent.scrollModule.offset.top.idx)&&(this.parent.scrollModule.offset.top.size=r.top),e.top=r.top),e.left!==r.left&&(this.parent.scrollModule&&this.parent.scrollModule.offset.left.idx&&r.left-e.left<lt(t,this.parent.scrollModule.offset.left.idx)&&(this.parent.scrollModule.offset.left.size=r.left),e.left=r.left)},e.prototype.checkTableWidth=function(e){if(this.parent.scrollSettings.isFinite&&!this.parent.scrollSettings.enableVirtualization&&e.colCount-1===this.parent.viewport.rightIndex){var t=dt(e,this.parent.viewport.leftIndex+this.parent.frozenColCount(e),this.parent.viewport.rightIndex),r=this.getRowHeaderWidth(e),n=this.getScrollSize();t<this.contentPanel.getBoundingClientRect().width-r-n?(this.getContentPanel().style.width=t+"px",this.getColHeaderPanel().style.width=t+"px"):this.getContentPanel().style.width.includes("calc")||(this.getContentPanel().style.width="calc(100% - "+r+"px)",this.getColHeaderPanel().style.width="calc(100% - "+r+"px)")}},e.prototype.clearCFResult=function(e){e.conditionalFormats&&e.conditionalFormats.length&&e.conditionalFormats.forEach(function(e){delete e.result})},e.prototype.refreshColumnContent=function(e){var t,r,n=this,i=0,a=this.parent.getActiveSheet(),o=[],s=document.createDocumentFragment(),l=document.createDocumentFragment(),d=this.parent.element.querySelector(".e-sheet-content tbody"),h=this.parent.element.querySelector(".e-column-header tbody"),p=this.parent.element.querySelector(".e-sheet-content colgroup");p=p.cloneNode(),s.appendChild(p),d=s.appendChild(d.cloneNode(!0));var u=p.cloneNode();l.appendChild(u);var f=this.parent.element.querySelector(".e-column-header thead"),g=(f=l.appendChild(f.cloneNode(!0))).querySelector("tr");g.innerText="";var m=this.parent.frozenRowCount(a),v=this.parent.frozenColCount(a);m&&(h=l.appendChild(h.cloneNode(!0)));var y=j(a,m-1,!1),C=this.parent.scrollSettings.enableVirtualization&&this.parent.viewport.topIndex!==j(a,0,!0);this.clearCFResult(a),e.cells.forEach(function(s,l){var f=c(l);if(f[0]===e.indexes[0]){var b=n.updateCol(a,f[1],u);p.appendChild(b.cloneNode()),n.cellRenderer.renderColHeader(f[1],g)}if(f[1]-v===e.indexes[1]){if(!(t=f[0]<m?h.children[i]:d.children[i]))return;t.innerText="",i++}if(t){r={colIdx:f[1],rowIdx:f[0],cell:s,address:l,row:t,pRow:t.previousSibling,first:e.skipUpdateOnFirst||f[1]!==e.indexes[1]?C&&f[0]===e.indexes[0]?"Row":"":"Column",isRefreshing:!0,mergeBorderRows:o};var x=n.cellRenderer.render(r);n.checkColMerge(f,e.indexes,x,s,a),m&&f[0]===y&&(i=0)}});var b=function(){var t=n.getColHeaderTable();gt(t),t.appendChild(l),gt(t=n.getContentTable()),t.appendChild(s),n.parent.notify("virtualContentLoaded",{refresh:"Column",prevRowColCnt:e.prevRowColCnt}),le(n.parent,o),a.conditionalFormats&&a.conditionalFormats.length&&n.parent.notify(Cn,{indexes:e.indexes,isRender:!0}),n.parent.isEdit&&n.parent.notify("forRefSelRender",{}),n.parent.allowChart&&n.parent.notify("chartRangeSelection",null),n.parent.isOpen||n.parent.hideSpinner(),zt(n.parent.getMainContent(),{busy:!1})};e.insertDelete?b():ft(function(){return b()})},e.prototype.refreshRowContent=function(e){var r,n,i,a,o=this,s=this.colGroupWidth,l=this.parent.getActiveSheet(),d=[],h=document.createDocumentFragment(),p=document.createDocumentFragment(),u=this.parent.createElement("tbody"),f=u.cloneNode();p.appendChild(f),h.appendChild(u);var g=this.parent.frozenColCount(l),m=j(l,g-1,!1,"columns"),v=this.parent.scrollSettings.enableVirtualization&&this.parent.viewport.leftIndex!==j(l,0,!0,"columns");this.clearCFResult(l),e.cells.forEach(function(t,h){var p=c(h);p[1]!==e.indexes[1]&&r||(p[1]===e.indexes[1]&&(n=o.rowRenderer.render(p[0],!0)),g&&p[1]<g?(f.appendChild(n),r=n):(p[1]===e.indexes[1]&&f.appendChild(n),r=o.rowRenderer.render(p[0]),u.appendChild(r)),p[1]===e.indexes[1]&&(o.cellRenderer.renderRowHeader(p[0],n),s=mt(p[0]+1))),g&&(n=f.lastElementChild||n),a={rowIdx:p[0],colIdx:p[1],cell:t,address:h,lastCell:p[1]===e.indexes[3],row:r,hRow:n,pRow:r.previousSibling,pHRow:n.previousSibling,isHeightCheckNeeded:!0,first:e.skipUpdateOnFirst||p[0]!==e.indexes[0]?v&&p[1]===e.indexes[1]?"Column":"":"Row",isRefreshing:!0,mergeBorderRows:d},i=o.cellRenderer.render(a),o.checkRowMerge(p,e.indexes,i,t,l),g&&p[1]===m&&(r=null)}),this.colGroupWidth!==s&&this.updateLeftColGroup(s);var y=this.contentPanel.querySelector(".e-row-header tbody");y&&(t.detach(y),this.getRowHeaderTable().appendChild(p));var C=this.contentPanel.querySelector(".e-sheet-content tbody");C&&(t.detach(C),this.getContentTable().appendChild(h)),this.parent.notify("virtualContentLoaded",{refresh:"Row",prevRowColCnt:e.prevRowColCnt}),le(this.parent,d),l.conditionalFormats&&l.conditionalFormats.length&&this.parent.notify(Cn,{indexes:e.indexes,isRender:!0}),this.parent.allowChart&&this.parent.notify("chartRangeSelection",{}),this.parent.isEdit&&this.parent.notify("forRefSelRender",null),this.parent.isOpen||this.parent.hideSpinner(),zt(this.parent.getMainContent(),{busy:!1})},e.prototype.updateCol=function(e,r,n){var i=this.col.cloneNode();if(i.style.width=t.formatUnit(lt(e,r,null,!0)),n){var a=n.querySelector(".e-empty");return a?n.insertBefore(i,a):n.appendChild(i)}return i},e.prototype.updateColContent=function(e){var r=this;ft(function(){var n,i,a,o,s,l,d=0,h=r.parent.getActiveSheet(),p=[],u=r.parent.element.querySelector(".e-column-header .e-header-row"),f=r.parent.element.querySelector(".e-sheet-content colgroup"),g=r.parent.element.querySelector(".e-column-header colgroup"),m=u.firstElementChild,v=f.firstElementChild,y=g.firstElementChild,C=r.parent.element.querySelector(".e-sheet-content tbody"),b=r.parent.element.querySelector(".e-column-header tbody"),x=r.parent.frozenRowCount(h),S=r.parent.frozenColCount(h),w=j(h,x-1,!1),I=j(h,e.indexes[0],!0);r.clearCFResult(h),e.cells.forEach(function(E,R){if(!s){var N=c(R);if("first"===e.direction&&N[1]===e.indexes[1]&&r.checkColMerge([N[0],r.parent.viewport.leftIndex+S],e.indexes,((N[0]<x?b:C).rows[d]||{cells:[]}).cells[e.indexes[3]-e.indexes[1]+1],He(N[0],r.parent.viewport.leftIndex+S,h)||{},h),N[0]===I&&("last"===e.direction?((o=r.col.cloneNode()).style.width=t.formatUnit(lt(h,N[1],null,!0)),f.insertBefore(o,v),g.insertBefore(o.cloneNode(),y),r.cellRenderer.renderColHeader(N[1],u,m)):(o=r.updateCol(h,N[1],f),g.appendChild(o.cloneNode()),r.cellRenderer.renderColHeader(N[1],u)),r.parent.scrollSettings.enableVirtualization&&e.direction&&(t.detach(f[e.direction+"ElementChild"]),t.detach(g[e.direction+"ElementChild"]),t.detach(u[e.direction+"ElementChild"]))),N[1]===e.indexes[1]){if(N[0]<x)n=b.children[d];else if(!(n=C.children[d]))return void(s=!0);d++,i=n.firstElementChild}l={colIdx:N[1],rowIdx:N[0],cell:E,address:R,row:n,pRow:n.previousSibling,lastCell:N[1]===e.indexes[3],isHeightCheckNeeded:"first"===e.direction,first:"last"!==e.direction||e.skipUpdateOnFirst||N[1]!==e.indexes[1]?"":"Column",checkNextBorder:"last"===e.direction&&N[3]===e.indexes[3]?"Column":"",isRefreshing:"first"===e.direction,mergeBorderRows:p},"last"===e.direction?(l.refChild=i,a=r.cellRenderer.render(l),r.checkColMerge(N,e.indexes,a,E,h,((N[0]<x?b:C).rows[d-1]||{cells:[]}).cells[1])):a=r.cellRenderer.render(l),r.parent.scrollSettings.enableVirtualization&&e.direction&&t.detach(n[e.direction+"ElementChild"]),x&&N[0]===w&&(d=0)}}),r.parent.notify("virtualContentLoaded",{refresh:"Column",prevRowColCnt:e.prevRowColCnt}),le(r.parent,p),h.conditionalFormats&&h.conditionalFormats.length&&r.parent.notify(Cn,{indexes:e.indexes,isRender:!0}),r.parent.allowChart&&r.parent.notify("chartRangeSelection",null),r.parent.isEdit&&r.parent.notify("forRefSelRender",{}),r.parent.isOpen||r.parent.hideSpinner(),zt(r.parent.getMainContent(),{busy:!1})})},e.prototype.updateRowContent=function(e){var r=this,n=this.parent.getMainContent();if(""!==e.direction||n.children.length){var i,a,o,s,l,d=[],h=0,p=this.colGroupWidth,u=this.parent.getActiveSheet(),f=n.querySelector("tbody"),g=this.parent.getRowHeaderContent().querySelector("tbody"),m=document.createDocumentFragment(),v=document.createDocumentFragment();this.parent.showSpinner();var y=this.parent.frozenColCount(u),C=this.parent.frozenRowCount(u),b=j(u,e.indexes[1],!0,"columns"),x=j(u,y-1,!1,"columns");this.clearCFResult(u),e.cells.forEach(function(n,S){var w,I,E=c(S);"first"===e.direction&&E[0]===e.indexes[0]&&(w=g.rows[g.rows.length-1],I=f.rows[f.rows.length-1],void 0===s&&(s=(E[1]<y?g:f).rows[e.indexes[2]-e.indexes[0]+1]||null),r.checkRowMerge([r.parent.viewport.topIndex+C,E[1]],e.indexes,(s||{cells:[]}).cells[E[1]<y?h+1:h],He(r.parent.viewport.topIndex+C,E[1],u)||{},u)),E[1]!==b&&i||(E[1]===b&&(a=r.rowRenderer.render(E[0],!0)),y&&E[1]<y?(m.appendChild(a),i=a):(i=r.rowRenderer.render(E[0]),v.appendChild(i),E[1]===b&&m.appendChild(a),r.parent.scrollSettings.enableVirtualization&&e.direction&&t.detach(f[e.direction+"ElementChild"])),E[1]===b&&(r.cellRenderer.renderRowHeader(E[0],a),p=mt(E[0]+1),r.parent.scrollSettings.enableVirtualization&&e.direction&&t.detach(g[e.direction+"ElementChild"]))),y&&(a=m.lastElementChild||a),l={colIdx:E[1],rowIdx:E[2],cell:n,address:S,row:i,lastCell:E[1]===e.indexes[3],pHRow:a.previousSibling||w,checkNextBorder:"last"===e.direction&&E[2]===e.indexes[2]?"Row":"",pRow:i.previousSibling||I,isHeightCheckNeeded:"first"===e.direction||""===e.direction,hRow:a,first:"last"!==e.direction||e.skipUpdateOnFirst||E[0]!==e.indexes[0]?"":"Row",isRefreshing:"first"===e.direction,mergeBorderRows:d},o=r.cellRenderer.render(l),"last"===e.direction&&f.rows.length&&r.checkRowMerge(E,e.indexes,o,n,u,(E[1]<y?g:f).rows[0].cells[E[1]<y?h+1:h]),h++,y&&E[1]===x&&(i=null,s=void 0,h=0)}),this.colGroupWidth!==p&&this.updateLeftColGroup(p),"last"===e.direction?(g.insertBefore(m,g.firstElementChild),f.insertBefore(v,f.firstElementChild)):(g.appendChild(m),f.appendChild(v)),this.parent.scrollSettings.enableVirtualization&&this.parent.notify("virtualContentLoaded",{refresh:"Row",prevRowColCnt:e.prevRowColCnt}),le(this.parent,d),u.conditionalFormats&&u.conditionalFormats.length&&this.parent.notify(Cn,{indexes:e.indexes,isRender:!0}),this.parent.isEdit&&this.parent.notify("forRefSelRender",null),this.parent.allowChart&&this.parent.notify("chartRangeSelection",{}),this.parent.isOpen||this.parent.hideSpinner(),zt(this.parent.getMainContent(),{busy:!1})}},e.prototype.checkRowMerge=function(e,r,n,i,a,o){if(this.parent.scrollSettings.enableVirtualization&&n&&(!t.isNullOrUndefined(i.rowSpan)||!t.isNullOrUndefined(i.colSpan))){var s=this.parent.frozenRowCount(a),l=this.parent.viewport.topIndex+s;if(e[0]===l){if(i.rowSpan<0){var d={td:n,rowIdx:e[0],colIdx:e[1],isRow:!0,isFreezePane:!0};if(this.parent.notify("checkMerge",d),d.insideFreezePane)return;l>=r[2]&&this.refreshPrevMerge(r[2]+1,e[1])}o&&this.refreshFirstCell(e[0]+(r[2]-r[0])+1,e[1],a,o)}else if(i.rowSpan>1){var h=r[2]+1;e[0]+i.rowSpan-1>=h&&e[0]<h&&this.refreshPrevMerge(h,e[1],l)}}},e.prototype.refreshPrevMerge=function(e,t,r){var n=this.parent.getCell(e,t,this.parent.getRow(r||0,null,t));n&&this.cellRenderer.refresh(e,t,null,n)},e.prototype.refreshFirstCell=function(e,t,r,n){var i=He(e,t,r,!1,!0);(i.rowSpan<0||i.colSpan<0)&&this.cellRenderer.refresh(e,t,null,n)},e.prototype.checkColMerge=function(e,r,n,i,a,o){if(this.parent.scrollSettings.enableVirtualization&&n&&(!t.isNullOrUndefined(i.rowSpan)||!t.isNullOrUndefined(i.colSpan))){var s=this.parent.frozenColCount(a),l=this.parent.viewport.leftIndex+s;if(e[1]===l){if(i.colSpan<0){var d={td:n,colIdx:e[1],rowIdx:e[0],isFreezePane:!0};if(this.parent.notify("checkMerge",d),d.insideFreezePane)return;l>=r[3]&&(h=this.parent.getCell(e[0],e[3]+1,this.parent.getRow(e[0],null,e[3]+1)))&&this.cellRenderer.refresh(e[0],r[3]+1,null,h)}o&&this.refreshFirstCell(e[0],e[1]+(r[3]-r[1])+1,a,o)}else if(i.colSpan>1&&e[1]+i.colSpan-1>=r[3]+1&&e[1]<r[3]+1){var h=this.parent.getCell(e[0],e[3]+1,this.parent.getRow(e[0],null,e[3]+1));h&&this.cellRenderer.refresh(e[0],r[3]+1,null,h)}}},e.prototype.toggleGridlines=function(){var e=document.getElementById(this.parent.element.id+"_sheet");this.parent.getActiveSheet().showGridLines?e.classList.remove("e-hide-gridlines"):e.classList.add("e-hide-gridlines")},e.prototype.showHideHeaders=function(){var e=this,t=this.parent.getActiveSheet();ft(function(){if(t.showHeaders){var r=e.getContentPanel();e.setPanelWidth(t,e.getRowHeaderPanel()),e.setPanelHeight(t),document.getElementById(e.parent.element.id+"_sheet").classList.remove("e-hide-headers"),e.getColHeaderPanel().scrollLeft=r.scrollLeft,e.parent.selectRange(t.selectedRange)}else e.updateHideHeaders(t,document.getElementById(e.parent.element.id+"_sheet")),e.setPanelHeight(t),e.parent.frozenColCount(t)||e.parent.frozenRowCount(t)?(e.setPanelWidth(t,e.getRowHeaderPanel()),e.parent.selectRange(t.selectedRange)):(e.getContentPanel().style.width="",e.getContentPanel().style[e.parent.enableRtl?"right":"left"]=""),e.getScrollElement().style.left=e.getRowHeaderWidth(t)+"px"})},e.prototype.updateHideHeaders=function(e,t){e.showHeaders||t.classList.add("e-hide-headers")},e.prototype.rowHeightChanged=function(e){if(e.threshold||e.isHideShow){var t=this.parent.getActiveSheet();e.rowIdx<this.parent.frozenRowCount(t)&&this.setPanelHeight(t)}},e.prototype.colWidthChanged=function(e){if(e.threshold||e.isHideShow){var t=this.parent.getActiveSheet();e.colIdx<this.parent.frozenColCount(t)&&this.setPanelWidth(t,this.getRowHeaderPanel()),this.checkTableWidth(t)}},e.prototype.getRowHeaderWidth=function(e,t,r){var n=0,i=r?this.parent.viewport.scaleX:1;if(!t&&e.frozenColumns){var a=u(e.topLeftCell)[1];n=dt(e,a,a+e.frozenColumns-1,!0)/i}return n+=e.showHeaders?Vt(this.colGroupWidth)/i:0},e.prototype.getColHeaderHeight=function(e,t){var r=u(e.topLeftCell)[0];return(e.showHeaders&&!t?Vt(31):0)+at(e,r,r+e.frozenRows-1,!0)},e.prototype.getSelectAllContent=function(){return this.headerPanel.getElementsByClassName("e-selectall-container")[0]},e.prototype.getScrollElement=function(){var e;return this.contentPanel&&(e=this.contentPanel.parentElement||this.contentPanel.nextElementSibling),e&&e.querySelector(".e-scroller")},e.prototype.getSelectAllTable=function(){return this.headerPanel.getElementsByClassName("e-selectall-table")[0]},e.prototype.getColHeaderTable=function(){return this.headerPanel.getElementsByClassName("e-colhdr-table")[0]},e.prototype.getRowHeaderTable=function(){return this.contentPanel.getElementsByClassName("e-rowhdr-table")[0]},e.prototype.getContentTable=function(){return this.contentPanel.getElementsByClassName("e-content-table")[0]},e.prototype.getRowHeaderPanel=function(){return this.contentPanel.getElementsByClassName("e-row-header")[0]},e.prototype.getColHeaderPanel=function(){return this.headerPanel.getElementsByClassName("e-column-header")[0]},e.prototype.getContentPanel=function(){return this.contentPanel.getElementsByClassName("e-sheet-content")[0]},e.prototype.addEventListener=function(){this.parent.on("created",this.triggerCreatedEvent,this),this.parent.on(ri,this.rowHeightChanged,this),this.parent.on(ni,this.colWidthChanged,this),this.parent.on(Gn,this.removeEventListener,this)},e.prototype.destroy=function(){this.headerPanel&&(gt(this.headerPanel),this.headerPanel.remove()),this.headerPanel=null,this.contentPanel&&(gt(this.contentPanel),this.contentPanel.remove()),this.contentPanel=null,this.col&&(gt(this.col),this.col.remove()),this.col=null,this.rowRenderer=null,this.cellRenderer=null,this.colGroupWidth=null,this.parent=null},e.prototype.removeEventListener=function(){this.parent.off("created",this.triggerCreatedEvent),this.parent.off(ri,this.rowHeightChanged),this.parent.off(ni,this.colWidthChanged),this.parent.off(Gn,this.removeEventListener)},e}(),za=function(){function e(e){this.parent=e,this.element=this.parent.createElement("tr"),this.cellRenderer=e.serviceLocator.getService("cell"),this.parent.on(ii,this.initProps,this)}return e.prototype.render=function(e,r,n){var i=this.element.cloneNode(),a=this.parent.getActiveSheet();if(void 0===e)return i.classList.add("e-header-row"),i;if(i.classList.add("e-row"),!this.bottomBorderWidth){h=1;if(window.devicePixelRatio%1>0){var o=1*window.devicePixelRatio%1;h=1+(o?(o>.5?1-o:-1*o)/window.devicePixelRatio:0)}this.bottomBorderWidth=h}var s=nt(a,e,!0),l=nt(a,e),d={height:s+"px",lineHeight:l<20?s>this.bottomBorderWidth?s-this.bottomBorderWidth+"px":"0px":""};if(Object.assign(i.style,d),t.attributes(i,{"aria-rowindex":(e+1).toString()}),r&&!n){if(l<20){var h=this.bottomBorderWidth-1+4;i.style.lineHeight=s>=h?s-h+"px":s>this.bottomBorderWidth?s-this.bottomBorderWidth+"px":"0px",i.classList.contains("e-reach-fntsize")||i.classList.add("e-reach-fntsize")}tt(a,e+1)&&!tt(a,e-1)&&i.classList.add("e-hide-start"),0!==e&&tt(a,e-1)&&!tt(a,e+1)&&i.classList.add("e-hide-end")}return i},e.prototype.refresh=function(e,t,r,n,i){var a,o=this,s=this.parent.getActiveSheet();if(n)a=this.render(e,n,i),this.cellRenderer.renderRowHeader(e,a);else{var l,d,h=function(){for(;l<=d;)ht(s,l)||o.cellRenderer.render({colIdx:l,rowIdx:e,cell:He(e,l,s),address:g(e,l),lastCell:l===d,row:a,hRow:r,isHeightCheckNeeded:!0,pRow:t,first:e===o.parent.viewport.topIndex&&j(s,e,!0)!==j(s,0,!0)?"Row":"",skipFormatCheck:re(o.parent),checkCF:!0}),l++},p=this.parent.frozenColCount(s);p&&(a=r,l=u(s.topLeftCell)[0],d=p-1,h()),a=this.render(e,n,i),l=this.parent.viewport.leftIndex+p,d=this.parent.viewport.rightIndex,h()}return a},e.prototype.initProps=function(){this.bottomBorderWidth=null},e.prototype.destroy=function(){this.parent.off(ii,this.initProps),this.element&&this.element.remove(),this.bottomBorderWidth&&(this.bottomBorderWidth=null),this.parent=null,this.element=null},e}(),ja=function(){function e(e){this.parent=e,this.element=this.parent.createElement("td"),this.th=this.parent.createElement("th",{className:"e-header-cell"}),this.tableRow=e.createElement("tr",{className:"e-row"}),this.parent.on(Nn,this.updateView,this),this.parent.on(Gr,this.calculateFormula,this)}return e.prototype.renderColHeader=function(e,r,n){var i=this.th.cloneNode(),a=v(e+1);i.innerText=a;var o=this.parent.getActiveSheet();ht(o,e+1)&&i.classList.add("e-hide-start"),0!==e&&ht(o,e-1)&&i.classList.add("e-hide-end"),n?r.insertBefore(i,n):r.appendChild(i),this.parent.trigger("beforeCellRender",{cell:null,element:i,address:a,colIndex:e}),this.parent.notify("renderFilterCell",{td:i,rowIndex:0,colIndex:e}),t.attributes(i,{"aria-colindex":(e+1).toString(),tabindex:"-1"})},e.prototype.renderRowHeader=function(e,r,n){var i=this.element.cloneNode();t.addClass([i],"e-header-cell"),t.attributes(i,{role:"rowheader",tabindex:"-1"}),i.innerText=(e+1).toString(),n?r.insertBefore(i,n):r.appendChild(i),this.parent.trigger("beforeCellRender",{cell:null,element:i,address:""+(e+1),rowIndex:e})},e.prototype.render=function(e){var r=this.parent.getActiveSheet();if(e.td=this.element.cloneNode(),e.td.className="e-cell",t.attributes(e.td,{"aria-colindex":(e.colIdx+1).toString(),tabindex:"-1"}),this.checkMerged(e))return this.createImageAndChart(e),e.refChild?e.row.insertBefore(e.td,e.refChild):e.row.appendChild(e.td),e.td;e.isRefresh=!1,e.skipFormatCheck=re(this.parent);var n=this.update(e);e.checkCF&&e.cell&&r.conditionalFormats&&r.conditionalFormats.length&&this.parent.notify(Cn,{indexes:[e.rowIdx,e.colIdx],cell:e.cell,ele:e.td,isRender:!0}),e.td.classList.contains("e-cell-template")||this.parent.notify("renderFilterCell",{td:e.td,rowIndex:e.rowIdx,colIndex:e.colIdx}),e.refChild?e.row.insertBefore(e.td,e.refChild):e.row.appendChild(e.td);var i={cell:e.cell,element:e.td,address:e.address,rowIndex:e.rowIdx,colIndex:e.colIdx,needHeightCheck:!1,row:e.row};if(this.parent.trigger("beforeCellRender",i),!r.rows[e.rowIdx]||!r.rows[e.rowIdx].customHeight){if(i.needHeightCheck||n&&i.element&&i.element.children.length){var a=i.element.cloneNode(!0);a.style.width=lt(r,e.colIdx,!0)+"px",this.tableRow.appendChild(a)}if(e.lastCell&&this.tableRow.childElementCount){var o=this.getRowHeightOnInit();o>nt(r,e.rowIdx)&&Kt(this.parent,r,o,e.rowIdx,e.row,e.hRow),this.tableRow.innerText=""}}return this.setWrapByValue(r,e),i.element},e.prototype.setWrapByValue=function(e,r){r.cell&&t.isNullOrUndefined(r.cell.wrap)&&r.cell.value&&r.cell.value.toString().includes("\n")&&(Ue(r.rowIdx,r.colIdx,e,{wrap:!0},!0),this.parent.notify(an,{range:[r.rowIdx,r.colIdx,r.rowIdx,r.colIdx],wrap:!0,initial:!0,sheet:e,td:r.td,row:r.row,hRow:r.hRow}))},e.prototype.update=function(e){var r,n=this.parent.getActiveSheet();if(!e.isRefresh||e.cell&&e.cell.template){var i=this.processTemplates(e.cell,e.rowIdx,e.colIdx);i&&("string"==typeof i?e.td.innerHTML=i:(gt(e.td),t.append(i,e.td)),e.td.classList.add("e-cell-template"),r=!0)}if(e.isRefresh){if(e.td.rowSpan&&(this.mergeFreezeRow(n,e.rowIdx,e.colIdx,e.td.rowSpan,e.row,!0),e.td.removeAttribute("rowSpan")),e.td.colSpan&&(this.mergeFreezeCol(n,e.rowIdx,e.colIdx,e.td.colSpan,!0),e.td.removeAttribute("colSpan")),this.checkMerged(e))return!1;if(e.cell&&!e.cell.hyperlink){var a=e.td.querySelector(".e-hyperlink");a&&t.detach(a)}if(e.cell&&e.td.children.length>0&&e.td.children[e.td.childElementCount-1].className.indexOf("e-addNoteIndicator")>-1){var o=e.td.querySelector(".e-addNoteIndicator");o&&t.detach(o)}e.cell&&this.parent.allowWrap||!e.td.classList.contains("e-wraptext")||e.td.classList.remove("e-wraptext")}e.cell&&e.cell.formula&&!e.isRandomFormula&&"Automatic"===this.parent.calculationMode&&(this.calculateFormula(e),e.fillType&&"FillWithoutFormatting"===e.fillType&&delete e.cell.format);var s={value:e.cell&&e.cell.value,type:e.cell&&$e(e.cell.format),format:e.cell&&e.cell.format,formattedText:e.cell&&e.cell.value,isRightAlign:!1,cell:e.cell,rowIndex:e.rowIdx,colIndex:e.colIdx,td:e.td,skipFormatCheck:e.skipFormatCheck,refresh:!0};"Manual"===this.parent.calculationMode&&e.cell&&!e.cell.value&&""!==e.cell.value&&e.cell.formula&&(s.value=0,e.cell.value="0"),e.cell&&this.parent.notify(Wr,s),this.parent.refreshNode(e.td,s);var l={};if(e.cell){if(e.cell.style&&(l=e.cell.style.properties?Ve(e.cell.style,!0):e.cell.style),void 0!==s.color&&((l=Object.assign({},l)).color=s.color),this.createImageAndChart(e),e.cell.hyperlink&&("FillFormattingOnly"===e.fillType?(e.td.style.textDecoration="underline",e.td.style.color="#00e"):this.parent.notify("createHyperlinkElement",{cell:e.cell,style:l,td:e.td,rowIdx:e.rowIdx,colIdx:e.colIdx,fillType:e.fillType,action:e.action})),e.cell.rowSpan>1){var d=e.rowSpan||e.cell.rowSpan-this.parent.hiddenCount(e.rowIdx,e.rowIdx+(e.cell.rowSpan-1));d>1&&(e.td.rowSpan=d,this.mergeFreezeRow(n,e.rowIdx,e.colIdx,d,e.row))}if(e.cell.colSpan>1){var h=e.colSpan||e.cell.colSpan-this.parent.hiddenCount(e.colIdx,e.colIdx+(e.cell.colSpan-1),"columns");h>1&&(e.td.colSpan=h,this.mergeFreezeCol(n,e.rowIdx,e.colIdx,h))}t.isNullOrUndefined(e.cell.notes)||e.fillType?!t.isNullOrUndefined(e.td)&&e.td.children.length>0&&e.td.children[e.td.childElementCount-1].className.indexOf("e-addNoteIndicator")>-1&&this.parent.notify("deleteNote",{rowIndex:e.rowIdx,columnIndex:e.colIdx}):this.parent.notify("createNoteIndicator",{targetElement:e.td,rowIndex:e.rowIdx,columnIndex:e.colIdx}),e.cell.isNoteEditable&&this.parent.notify("showNote",{rowIndex:e.rowIdx,columnIndex:e.colIdx,isNoteEditable:!0,isScrollWithNote:!0,cellElement:e.td})}if(e.isRefresh&&t.isNullOrUndefined(e.cell)&&!t.isNullOrUndefined(e.td)&&e.td.children.length>0&&e.td.children[e.td.childElementCount-1].className.indexOf("e-addNoteIndicator")>-1&&this.parent.notify("deleteNote",{rowIndex:e.rowIdx,columnIndex:e.colIdx}),e.isRefresh&&this.removeStyle(e.td,e.rowIdx,e.colIdx),e.lastCell&&this.parent.chartColl&&this.parent.chartColl.length&&this.parent.notify("refreshChart",{cell:e.cell,rIdx:e.rowIdx,cIdx:e.colIdx,sheetIdx:this.parent.activeSheetIndex,isSelectAll:e.isSelectAll}),this.applyStyle(e,l),"Row"===e.checkNextBorder){var p=this.parent.getCellStyleValue(["borderTop"],[Number(this.parent.getContentTable().rows[0].getAttribute("aria-rowindex"))-1,e.colIdx]).borderTop;""===p||e.cell&&e.cell.style&&e.cell.style.bottomPriority||(e.style={borderBottom:p},this.parent.notify(Xr,e))}if("Column"===e.checkNextBorder){var c=this.parent.getCellStyleValue(["borderLeft"],[e.rowIdx,e.colIdx+1]).borderLeft;""===c||e.cell&&e.cell.style&&(e.cell.style.borderRight||e.cell.style.border)||(e.style={borderRight:c},this.parent.notify(Xr,e))}e.cell&&!t.isNullOrUndefined(e.cell.wrap)&&this.parent.notify(an,{range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx],wrap:e.cell.wrap,sheet:n,initial:!0,td:e.td,row:e.row,hRow:e.hRow,isCustomHgt:!e.isRefresh&&nt(n,e.rowIdx)>(n&&n.standardHeight?n.standardHeight:20)});var u,f;return e.cell&&e.cell.validation?(u=e.cell.validation,f=n.columns&&n.columns[e.colIdx]):u=pt(n.columns&&n.columns[e.colIdx],e.rowIdx,e.colIdx)&&n.columns[e.colIdx].validation,u&&(u.isHighlighted&&(e.validation=u,e.col=f,this.parent.notify("updateHighlight",e)),"List"!==u.type||e.isRefresh||e.address!==n.activeCell||(e.validation=u,this.parent.notify("addListValidationDropdown",e))),r},e.prototype.applyStyle=function(e,r){(Object.keys(r).length||Object.keys(this.parent.commonCellStyle).length||e.lastCell)&&(e.style=t.extend({},this.parent.commonCellStyle,r),this.parent.notify(Xr,e))},e.prototype.createImageAndChart=function(e){if(e.cell.chart&&e.cell.chart.length>0&&this.parent.notify(xn,{chart:e.cell.chart,isInitCell:!0,range:g(e.rowIdx,e.colIdx),isUndoRedo:!1}),e.cell.image&&e.cell.image.length>0)for(var t=0;t<e.cell.image.length;t++)e.cell.image[t]&&this.parent.notify(Ni,{options:{src:e.cell.image[t].src,id:e.cell.image[t].id,height:e.cell.image[t].height,width:e.cell.image[t].width,top:e.cell.image[t].top,left:e.cell.image[t].left},range:m([e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]),isPublic:!1})},e.prototype.calculateFormula=function(e){if(void 0!==e.cell.value&&null!==e.cell.value){var r={action:"checkFormulaAdded",added:!0,address:e.address,sheetId:(void 0===e.sheetIndex?this.parent.getActiveSheet():Ae(this.parent,e.sheetIndex)).id.toString()};if(this.parent.notify(Kr,r),r.added)return}else e.formulaRefresh&&(e.cell.value="");var n=k(e.cell.formula),i={action:"refreshCalculate",value:e.cell.formula,rowIndex:e.rowIdx,colIndex:e.colIdx,isFormula:n,sheetIndex:e.sheetIndex,isRefreshing:e.isRefreshing,isDependentRefresh:e.isDependentRefresh,isRandomFormula:e.isRandomFormula,fillType:e.fillType};("Automatic"===this.parent.calculationMode||e.isSortAction||"calculate"===e.action||e.isDependentRefresh)&&this.parent.notify(Kr,i),(void 0===e.cell.value&&"Manual"===this.parent.calculationMode&&!this.parent.getActiveSheet().isSheetCalculated||this.parent.isEdit&&"#CIRCULARREF!"===e.cell.value)&&(e.cell.value="0"),e.cell.value=He(e.rowIdx,e.colIdx,t.isNullOrUndefined(e.sheetIndex)?this.parent.getActiveSheet():Ae(this.parent,e.sheetIndex)).value,n&&(e.cell.formula.indexOf("^+")>-1||e.cell.formula.indexOf("&+")>-1)&&(e.cell.formula=i.value)},e.prototype.checkMerged=function(e){if(e.cell&&(e.cell.colSpan<0||e.cell.rowSpan<0)){var t=this.parent.getActiveSheet();if(t.frozenRows||t.frozenColumns){var r={range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]};this.parent.notify(mn,r);var n=this.parent.frozenRowCount(t),i=this.parent.frozenColCount(t);r.range=r.range,(t.frozenRows&&t.frozenColumns?r.range[0]<n&&r.range[1]<i?e.rowIdx<n&&e.colIdx<i:r.range[0]<n?e.rowIdx<n:!(r.range[1]<i)||e.colIdx<i:n?r.range[0]>=n||e.rowIdx<n:r.range[1]>=i||e.colIdx<i)&&(e.td.style.display="none")}else e.td.style.display="none";e.isMerged=!0;var a=e.cell.rowSpan,o=e.cell.colSpan;return(o<0||a<0)&&(this.parent.notify("checkPrevMerge",e),o<0&&e.cell.style&&e.cell.style.borderTop&&this.applyStyle(e,{borderTop:e.cell.style.borderTop}),a<0&&e.cell.style&&e.cell.style.borderLeft&&this.applyStyle(e,{borderLeft:e.cell.style.borderLeft})),e.isMerged}return!1},e.prototype.mergeFreezeRow=function(e,r,n,i,a,o){var s=this.parent.frozenRowCount(e);if(s&&r<s&&r+(i-1)>=s){var l=void 0,d=0,h=void 0,p=this.parent.frozenColCount(e),c=a||this.parent.getRow(r,null,n),f=[].slice.call(c.parentElement.querySelectorAll(".e-empty"));if(o){var g=r+i-s;if(g<f.length)return;var m=0;if(g===f.length){var v=void 0,y=void 0,C=void 0;for(p&&n<p?(y=u(e.topLeftCell)[1],C=p):(y=this.parent.viewport.leftIndex+p,C=this.parent.viewport.rightIndex),y;y<C;y++)y!==n&&(v=He(r,y,e,!1,!0)).rowSpan&&r+v.rowSpan-s>m&&(m=r+v.rowSpan-s);if(m===g)return}else m=g;for(var b=r+(i-1),y=m,C=f.length;y<C;y++)d+=nt(e,b),b--,t.detach(f.pop());return this.updateSpanTop(n,p,d,!0),void(f.length||this.updateColZIndex(n,p,!0))}this.updateColZIndex(n,p);for(var y=s,C=r+(i-1);y<=C;y++)d+=-(h=nt(e,j(e,y,!0),!0)),s+f.length>y||((l=c.cloneNode()).classList.add("e-empty"),l.style.visibility="hidden",l.style.height=h+"px",c.parentElement.appendChild(l));this.updateSpanTop(n,p,d)}},e.prototype.updateSpanTop=function(e,t,r,n){var i=this.parent.serviceLocator.getService("sheet").contentPanel;if(n){if(!parseInt(i.style.top,10))return;r=parseInt(i.style.top,10)+r}if(t&&e<t&&(n||!parseInt(i.style.top,10)||r<parseInt(i.style.top,10))){i.style.top=r+"px";var a=i.nextElementSibling;a&&(a.style.top=r+"px")}},e.prototype.mergeFreezeCol=function(e,r,n,i,a){var o=this.parent.frozenColCount(e);if(o&&n<o&&n+(i-1)>=o){var s=void 0,l=void 0,d=this.parent.frozenRowCount(e),h=(r<d?this.parent.getSelectAllContent():this.parent.getRowHeaderContent()).querySelector("colgroup"),p=[].slice.call(h.querySelectorAll(".e-empty"));if(a){var c=n+i-o;if(c<p.length)return;var f=0;if(c===p.length){var g=void 0,m=void 0,v=void 0;for(d&&r<d?(m=d,v=u(e.topLeftCell)[0]):(m=this.parent.viewport.bottomIndex,v=this.parent.viewport.topIndex+d),v;v<m;v++)v!==r&&(g=He(v,n,e,!1,!0)).colSpan&&n+g.colSpan-o>f&&(f=n+g.colSpan-o);if(f===c)return}else f=c;for(var v=f,m=p.length;v<m;v++)t.detach(p.pop());return this.parent.serviceLocator.getService("sheet").setPanelWidth(e,this.parent.getRowHeaderContent()),void(p.length||this.updateRowZIndex(r,d,!0))}this.updateRowZIndex(r,d);for(var v=o,m=n+(i-1);v<=m;v++)o+p.length>v||((s=h.childNodes[0].cloneNode()).classList.add("e-empty"),s.style.visibility="hidden",l=lt(e,j(e,v,!0,"columns"),null,!0),s.style.width=l+"px",h.appendChild(s),v===m&&this.parent.serviceLocator.getService("sheet").setPanelWidth(e,this.parent.getRowHeaderContent()))}},e.prototype.updateColZIndex=function(e,t,r){e<t?this.updateSelectAllZIndex(r):(this.parent.getColumnHeaderContent().style.zIndex=r?"":"2",this.updatedHeaderZIndex(r))},e.prototype.updateSelectAllZIndex=function(e){var t=this.parent.element.querySelector(".e-frozen-row"),r=this.parent.element.querySelector(".e-frozen-column");if(e)this.parent.getSelectAllContent().style.zIndex="",t&&(t.style.zIndex=""),r&&(r.style.zIndex="");else{var n=this.parent.getRowHeaderContent(),i=this.parent.getColumnHeaderContent();if(n.style.zIndex||i.style.zIndex){this.parent.getSelectAllContent().style.zIndex="3",t&&(t.style.zIndex="4"),r&&(r.style.zIndex="4");var a=n.querySelector(".e-selection");a&&(a.style.zIndex="3");var o=i.querySelector(".e-selection");o&&(o.style.zIndex="3")}else this.parent.getSelectAllContent().style.zIndex="2"}},e.prototype.updatedHeaderZIndex=function(e){if(!e&&"2"===this.parent.getSelectAllContent().style.zIndex){this.parent.getSelectAllContent().style.zIndex="3";var t=this.parent.element.querySelector(".e-frozen-row"),r=this.parent.element.querySelector(".e-frozen-column");r&&(r.style.zIndex="4"),t&&(t.style.zIndex="4");var n=this.parent.getRowHeaderContent().querySelector(".e-selection");n&&(n.style.zIndex="3");var i=this.parent.getColumnHeaderContent().querySelector(".e-selection");i&&(i.style.zIndex="3")}},e.prototype.updateRowZIndex=function(e,t,r){e<t?this.updateSelectAllZIndex(r):(this.parent.getRowHeaderContent().style.zIndex=r?"":"2",this.updatedHeaderZIndex(r))},e.prototype.processTemplates=function(e,t,r){for(var n,i=this.parent.getActiveSheet(),a=i.ranges,o=0,s=a.length;o<s;o++)if(a[o].template&&(n=c(a[o].address.length?a[o].address:a[o].startCell))[0]<=t&&n[1]<=r&&n[2]>=t&&n[3]>=r){if(e)return this.compileCellTemplate(a[o].template,Object.assign({rowIndex:t,colIndex:r},e));if(!He(t,r,i,!0))return this.compileCellTemplate(a[o].template,Object.assign({rowIndex:t,colIndex:r},He(t,r,i,null,!0)))}return""},e.prototype.compileCellTemplate=function(e,r){var n;if("string"==typeof e){var i=void 0;return i=0===e.trim().indexOf("#")?document.querySelector(e).innerHTML.trim():e,n=t.compile(i),!this.parent.isVue||this.isSelector(e)?n(r,this.parent,"ranges","",!0)[0].outerHTML:n(r,this.parent,"ranges","")}var a=(n=t.compile(e))(r,this.parent,"ranges","");return a[0]?a:[a]},e.prototype.isSelector=function(e){try{return!!document.querySelector(e)}catch(e){return!1}},e.prototype.getRowHeightOnInit=function(){var e=this.parent.createElement("table",{className:"e-table e-test-table"});e.appendChild(this.parent.createElement("tbody")).appendChild(this.tableRow),this.parent.element.appendChild(e);var t=this.tableRow.getBoundingClientRect().height;return this.parent.element.removeChild(e),t<20?20:t},e.prototype.removeStyle=function(e,t,r){var n;if(e.style.length){var i=(n=this.parent.getCellStyleValue(["borderLeft","border"],[t,r+1])).borderLeft||n.border,a=(n=this.parent.getCellStyleValue(["borderTop","border"],[t+1,r])).borderTop||n.border;i||a?[].slice.call(e.style).forEach(function(t){i&&a?t.includes("border-right")||t.includes("border-bottom")||e.style.removeProperty(t):(!i||t.indexOf("border-right")>-1||a&&"none"!==a)&&(!a||t.indexOf("border-bottom")>-1||i&&"none"!==i)||e.style.removeProperty(t)}):e.removeAttribute("style")}var o=this.parent.getCell(t-1,r);if(o&&o.style.borderBottom){var s=Number(o.parentElement.getAttribute("aria-rowindex"))-1;(n=this.parent.getCellStyleValue(["borderBottom","border"],[s,r])).borderBottom||n.border||(o.style.borderBottom="")}var l=e.previousElementSibling;l&&l.style.borderRight&&(r=Number(l.getAttribute("aria-colindex"))-1,(n=this.parent.getCellStyleValue(["borderRight","border"],[t,r])).borderRight||n.border||(l.style.borderRight=""))},e.prototype.refreshRange=function(e,t,r,n,i,a,o,s,l,d,h,p){void 0===l&&(l=!0);var c,u,f=this.parent.getActiveSheet(),m=e.slice();if(bt(this.parent,m,!0))for(var v=0,y=m[0];y<=m[2];y++)if(!tt(f,y))for(var C=m[1];C<=m[3];C++)ht(f,C)||((u=this.parent.getCell(y,C))&&(c={rowIdx:y,colIdx:C,td:u,cell:He(y,C,f),isRefreshing:t,lastCell:C===m[3],isRefresh:!0,isHeightCheckNeeded:l,manualUpdate:!0,first:"",onActionUpdate:n,skipFormatCheck:a,isFromAutoFillOption:s,isSelectAll:h,rowHeight:p&&p[v]&&p[v].rowHeight},v++,o&&(c.address=g(y,C)),this.update(c),i&&f.conditionalFormats&&f.conditionalFormats.length&&this.parent.notify(Cn,{indexes:[y,C],isAction:!0}),this.parent.notify("renderFilterCell",{td:u,rowIndex:y,colIndex:C}),r&&this.setWrapByValue(f,c)),"Manual"===this.parent.calculationMode&&d&&(u?c.isSortAction=d:c={rowIdx:y,colIdx:C,td:u,cell:He(y,C,f),isRefreshing:t,lastCell:C===m[3],isRefresh:!0,isHeightCheckNeeded:l,manualUpdate:!0,first:"",onActionUpdate:n,skipFormatCheck:a,isFromAutoFillOption:s,isSortAction:d},c.cell&&c.cell.formula&&f.isSheetCalculated&&this.calculateFormula(c)))},e.prototype.refresh=function(e,t,r,n,i,a,o,s,l){var d=this.parent.getActiveSheet();if((n||!tt(d,e)&&!ht(d,t))&&(n||!this.parent.scrollSettings.enableVirtualization||this.parent.insideViewport(e,t))){var h=n||this.parent.getCell(e,t);if(!h)return;var p={rowIdx:e,colIdx:t,td:h,cell:He(e,t,d),isRefresh:!0,lastCell:r,isHeightCheckNeeded:!0,manualUpdate:!0,first:"",skipFormatCheck:o,isRandomFormula:s,fillType:l};this.update(p),i&&d.conditionalFormats&&d.conditionalFormats.length&&this.parent.notify(Cn,{indexes:[e,t],isAction:!0}),this.parent.notify("renderFilterCell",{td:h,rowIndex:e,colIndex:t}),a&&this.setWrapByValue(d,p)}},e.prototype.updateView=function(e){if(t.isNullOrUndefined(e.sheetIndex)||e.sheetIndex===this.parent.activeSheetIndex){if(!e.indexes){var r=this.parent.getActiveSheet(),n=this.parent.frozenRowCount(r),i=this.parent.frozenColCount(r),a=c(r.topLeftCell);n&&i&&this.refreshRange([a[0],a[1],n-1,i-1],e.refreshing,e.checkWrap,!1,e.checkCF),n&&this.refreshRange([a[0],this.parent.viewport.leftIndex+i,n-1,this.parent.viewport.rightIndex],e.refreshing,e.checkWrap,!1,e.checkCF),i&&this.refreshRange([this.parent.viewport.topIndex+n,a[1],this.parent.viewport.bottomIndex,i-1],e.refreshing,e.checkWrap,!1,e.checkCF),e.indexes=[this.parent.viewport.topIndex+n,this.parent.viewport.leftIndex+i,this.parent.viewport.bottomIndex,this.parent.viewport.rightIndex]}this.refreshRange(e.indexes,e.refreshing,e.checkWrap,!1,e.checkCF)}else e.refreshing&&this.calculateFormula({cell:He(e.indexes[0],e.indexes[1],Ae(this.parent,e.sheetIndex),!0,!0),rowIdx:e.indexes[0],colIdx:e.indexes[1],sheetIndex:e.sheetIndex})},e.prototype.destroy=function(){this.parent.off(Nn,this.updateView),this.parent.off(Gr,this.calculateFormula),this.element&&this.element.remove(),this.element=null,this.th&&this.th.remove(),this.th=null,this.tableRow&&this.tableRow.remove(),this.tableRow=null,this.parent=null},e}(),_a=function(){function e(e){this.parent=e,this.addEventListener(),this.instantiateRenderer()}return e.prototype.render=function(){this.parent.setProperties({activeSheetIndex:this.parent.skipHiddenSheets(this.parent.activeSheetIndex)},!0),this.parent.isMobileView()||(this.parent.notify(qn,null),this.parent.notify("formulaBar",null));var e=this.parent.createElement("div",{id:this.parent.element.id+"_sheet_panel",className:"e-sheet-panel"});this.parent.enableRtl&&e.classList.add("e-rtl"),this.parent.element.appendChild(e),this.parent.showSheetTabs?this.parent.notify("sheetTabs",null):(this.parent.notify(Kr,{action:"initSheetInfo"}),this.parent.notify(Kr,{action:"initiateDefinedNames"})),this.parent.isMobileView()&&(this.parent.notify("formulaBar",null),this.parent.notify(qn,null)),this.parent.password&&(this.parent.password.length>0||this.parent.isProtected)&&(this.parent.isProtected=!0,this.parent.showSheetTabs&&(this.parent.element.querySelector(".e-add-sheet-tab").setAttribute("disabled","true"),this.parent.element.querySelector(".e-add-sheet-tab").classList.add("e-disabled"))),"None"===this.parent.selectionSettings.mode&&(this.parent.allowAutoFill=!1),this.setSheetPanelSize(),this.renderSheet(e),this.checkTopLeftCell(!this.parent.refreshing)},e.prototype.checkTopLeftCell=function(e,t,r,n,i,a){var o=this.parent.getActiveSheet();this.parent.showSpinner();var s,l="A1"===o.topLeftCell,d=u(o.topLeftCell);if(o.topLeftCell!==o.paneTopLeftCell&&(o.frozenRows||o.frozenColumns)){var h=u(o.paneTopLeftCell);s=this.parent.scrollSettings.enableVirtualization,l=o.frozenRows&&o.frozenColumns?d[0]+o.frozenRows===h[0]&&d[1]+o.frozenColumns===h[1]:o.frozenRows?d[0]+o.frozenRows===h[0]&&0===d[1]:d[1]+o.frozenColumns===h[1]&&0===d[0],d[0]&&h[0]>d[0]?this.parent.viewport.beforeFreezeHeight=at(o,0,d[0]-1,!0):this.parent.viewport.beforeFreezeHeight=0,d[1]&&h[1]>d[1]?this.parent.viewport.beforeFreezeWidth=dt(o,0,d[1]-1,!0):this.parent.viewport.beforeFreezeWidth=0}else this.parent.viewport.beforeFreezeHeight=this.parent.viewport.beforeFreezeWidth=0;var p=this.parent.frozenRowCount(o),c=this.parent.frozenColCount(o);if(!this.parent.scrollSettings.enableVirtualization||l)this.refreshUI({rowIndex:d[0],colIndex:d[1],refresh:"All"},null,e,t,i,a),s&&(this.parent.viewport.topIndex=j(o,p,!0)-p,this.parent.viewport.leftIndex=j(o,c,!0,"columns")-c);else{var f=o.paneTopLeftCell===o.topLeftCell?d:u(o.paneTopLeftCell),g={preventScroll:!0};g.scrollTop=r||(f[0]>p?at(o,p,f[0]-1,!0):0),g.scrollLeft=n||(f[1]>c?dt(o,c,f[1]-1,!0):0),this.parent.notify("onContentScroll",g);var m=this.parent.getThreshold("row"),v=o.frozenRows?d[0]:d[0]>m?j(o,d[0]-m,!0):0,y=[];o.frozenRows&&y.push(f[0]-m>p?f[0]-m:p),m=this.parent.getThreshold("col");var C=o.frozenColumns?d[1]:d[1]>m?j(o,d[1]-m,!0,"columns"):0;o.frozenColumns?(y.length||y.push(p),y.push(f[1]-m>c?f[1]-m:c)):y.length&&y.push(c),this.refreshUI({rowIndex:v,colIndex:C,refresh:"All",top:g.scrollTop,left:g.scrollLeft,frozenIndexes:y},null,e,t,i,a),s&&(p&&y[0]>=p&&(this.parent.viewport.topIndex=j(o,y[0],!0)-p),c&&y[1]>=c&&(this.parent.viewport.leftIndex=j(o,y[1],!0,"columns")-c))}},e.prototype.renderSheet=function(e){void 0===e&&(e=document.getElementById(this.parent.element.id+"_sheet_panel")),e.appendChild(this.parent.createElement("div",{className:"e-sheet",id:this.parent.element.id+"_sheet",styles:"background-color: #fff"})),this.parent.serviceLocator.getService("sheet").renderPanel()},e.prototype.refreshUI=function(e,r,n,i,a,o){var s=this;"All"!==e.refresh&&this.parent.showSpinner();var l=this.parent.serviceLocator.getService("sheet"),d=this.parent.getActiveSheet(),h=Le(this.parent),p={rowCount:d.rowCount,colCount:d.colCount};if(e.frozenIndexes=e.frozenIndexes?e.frozenIndexes:[],!r)if(this.parent.scrollSettings.enableVirtualization){var c=e.rowIndex+this.parent.viewport.rowCount+2*this.parent.getThreshold("row"),f=e.colIndex+this.parent.viewport.colCount+2*this.parent.getThreshold("col"),m=this.parent.frozenRowCount(d),v=this.parent.frozenColCount(d);e.frozenIndexes.length&&(c+=e.frozenIndexes[0]-m,f+=e.frozenIndexes[1]-v),"Row"===e.refresh?c+=m:c+=d.frozenRows,"Column"===e.refresh?f+=v:f+=d.frozenColumns;var y=e.frozenIndexes[0]>m?e.frozenIndexes[0]:e.rowIndex+("Row"===e.refresh?m:d.frozenRows),C=this.parent.skipHidden(y,c,"rows",!1);c=C[1],y!==C[0]&&(I=u(d.paneTopLeftCell))[0]===y&&this.parent.updateTopLeftCell(C[0]-m,I[1],"col"),C[0]-=m;var b=d.rowCount-1,x=0,S=e.rowIndex;this.parent.scrollSettings.isFinite&&c>b&&(x=c-b,c=j(d,b,!1),C[0]+m>j(d,m,!0)&&(R=(R=e.rowIndex-x)<0?0:R,R=this.decreaseHidden(R,e.rowIndex-1,m),e.top&&R<e.rowIndex&&this.parent.notify("updateTranslate",{height:at(d,R+m,e.rowIndex-1+m,!0),isRender:!0}),this.parent.viewport.topIndex=C[0]=R,S="Row"===e.refresh?R:S)),"Row"===e.refresh?e.rowIndex=j(d,S+m,!0)-m:S=e.rowIndex=m?j(d,S,!0):C[0];var w=e.frozenIndexes[1]>v?e.frozenIndexes[1]:e.colIndex+("Column"===e.refresh?v:d.frozenColumns);if(C=this.parent.skipHidden(w,f,"columns",!1),f=C[1],w!==C[0]){var I=u(d.paneTopLeftCell);I[1]===w&&this.parent.updateTopLeftCell(I[0],C[0]-v,"row")}C[0]-=v,b=d.colCount-1,x=0;var E=e.colIndex;if(this.parent.scrollSettings.isFinite&&f>b&&(x=f-b,f=j(d,b,!1,"columns"),C[0]+v>j(d,v,!0,"columns"))){var R=e.colIndex-x;R=R>-1?R:0,R=this.decreaseHidden(R,e.colIndex-1,v,"columns"),e.left&&R<e.colIndex&&this.parent.notify("updateTranslate",{width:dt(d,R+v,e.colIndex-1+v,!0),isRender:!0}),this.parent.viewport.leftIndex=C[0]=R,E="Column"===e.refresh?R:E}"Column"===e.refresh?e.colIndex=j(d,E+v,!0,"columns")-v:E=e.colIndex=v?j(d,E,!0,"columns"):C[0],"Row"===e.refresh&&(S+=m,m&&(c+=u(d.topLeftCell)[0]),f=this.parent.viewport.rightIndex),"Column"===e.refresh&&(E+=v,v&&(f+=u(d.topLeftCell)[1]),c=this.parent.viewport.bottomIndex),this.parent.viewport.topIndex=e.rowIndex,this.parent.viewport.bottomIndex=c,this.parent.viewport.leftIndex=e.colIndex,this.parent.viewport.rightIndex=f,r=g(S,E)+":"+g(c,f)}else"All"===e.refresh&&this.updateTopLeftScrollPosition(t.extend(e,{sheet:d})),this.parent.viewport.bottomIndex=d.rowCount-1,this.parent.viewport.rightIndex=d.colCount-1,r=g(e.rowIndex,e.colIndex)+":"+g(this.parent.viewport.bottomIndex,this.parent.viewport.rightIndex);"All"===e.refresh&&this.parent.trigger("beforeDataBound",{});var N=this.parent.isOpen||this.parent.refreshing;zt(this.parent.getMainContent(),{busy:!0});var F=this.parent.sheets.length;ye(this.parent,h+"!"+r,null,null,e.frozenIndexes).then(function(t){if(s.parent&&!(F<s.parent.sheets.length)){var h=we(s.parent,d.id);if(!a&&(void 0===h||h!==s.parent.activeSheetIndex))return void(h>-1&&s.checkTopLeftCell());var c,f=[e.rowIndex,e.colIndex].concat(u(r.split(":")[1]));switch(e.refresh){case"All":l.renderTable({cells:t,indexes:f,top:e.top,left:e.left,initLoad:n,isRefreshing:i,isOpen:N,openOptions:o});break;case"Row":l.refreshRowContent({cells:t,indexes:f,skipUpdateOnFirst:e.skipUpdateOnFirst,prevRowColCnt:p}),c={isEdit:!1},s.parent.notify("isFormulaBarEdit",c),c.isEdit&&s.parent.notify(Yn,{action:"startEdit",refreshCurPos:!1});break;case"Column":l.refreshColumnContent({cells:t,indexes:f,skipUpdateOnFirst:e.skipUpdateOnFirst,prevRowColCnt:p,insertDelete:e.insertDelete});break;case"RowPart":l.updateRowContent({cells:t,indexes:f,direction:e.direction,skipUpdateOnFirst:e.skipUpdateOnFirst,prevRowColCnt:p});break;case"ColumnPart":l.updateColContent({cells:t,indexes:f,direction:e.direction,skipUpdateOnFirst:e.skipUpdateOnFirst,prevRowColCnt:p})}s.parent&&s.parent.isReact&&s.parent.renderReactTemplates()}}),this.parent.notify("beforeVirtualContentLoaded",{refresh:e.refresh,skipTranslate:e.skipTranslate})},e.prototype.updateTopLeftScrollPosition=function(e){var t=u(e.sheet.topLeftCell),r=u(e.sheet.paneTopLeftCell);if(e.sheet.frozenRows){var n=this.parent.frozenRowCount(e.sheet);r[0]>n&&(e.top=at(e.sheet,n,r[0]-1,!0))}else e.rowIndex&&(e.rowIndex=0),0!==t[0]&&(e.top=at(e.sheet,0,t[0]-1,!0));if(e.sheet.frozenColumns){var i=this.parent.frozenColCount(e.sheet);r[1]>i&&(e.left=dt(e.sheet,i,r[1]-1,!0))}else e.colIndex&&(e.colIndex=0),0!==t[1]&&(e.left=dt(e.sheet,0,t[1]-1,!0))},e.prototype.removeSheet=function(){document.getElementById(this.parent.element.id+"_sheet")&&t.remove(document.getElementById(this.parent.element.id+"_sheet"))},e.prototype.refreshSheet=function(e,t,r,n,i){var a=0,o=0;if(t){var s=this.parent.element.getElementsByClassName("e-main-panel")[0];s&&(a=s.scrollTop);var l=this.parent.getMainContent();l&&(o=l.scrollLeft)}this.removeSheet(),this.renderSheet(),this.parent.notify(ii,{}),this.checkTopLeftCell(!1,e,a,o,n,i),r&&or(this.parent.element)},e.prototype.setSheetPanelSize=function(e){var t,r=document.getElementById(this.parent.element.id+"_sheet_panel"),n=this.parent.element.getBoundingClientRect();if(this.parent.viewport.scaleY=this.parent.viewport.scaleX=1,this.parent.enableScaling){var i=this.parent.element.offsetHeight,a=i/n.height;1!==a&&Math.abs(i-n.height)>=.1*i&&(this.parent.viewport.scaleY=a);var o=this.parent.element.offsetWidth,s=o/n.width;1!==s&&Math.abs(o-n.width)>=.1*o&&(this.parent.viewport.scaleX=s)}"auto"===this.parent.height?(r.style.height="260px",t=230):(t=n.height*this.parent.viewport.scaleY-yt(r,null,this.parent.viewport.scaleY),r.style.height=t+"px",t-=32/this.parent.viewport.scaleY),void 0!==e&&(this.colMinWidth=e),this.parent.viewport.height=t;var l=n.width*this.parent.viewport.scaleX;this.parent.viewport.width=l-32/this.parent.viewport.scaleX,this.parent.viewport.rowCount=this.roundValue(t,20),this.parent.viewport.colCount=this.roundValue(l,this.colMinWidth||64)},e.prototype.roundValue=function(e,t){var r=e/t,n=Math.round(r);return Math.abs(r-n)<.5?n:n-1},e.prototype.moveOrDuplicateSheetHandler=function(e){this.parent.notify("refreshSheetTabs",null),e.refresh&&this.refreshSheet(e.isDuplicate)},e.prototype.decreaseHidden=function(e,t,r,n){void 0===n&&(n="rows"),e+=r,t+=r;for(var i=this.parent.getActiveSheet(),a=t;a>=e;a--)if(i[""+n][a]&&i[""+n][a].hidden&&--e<r){e=j(i,r,!0,n);break}return e-r},e.prototype.instantiateRenderer=function(){this.parent.serviceLocator.register("cell",new ja(this.parent)),this.parent.serviceLocator.register("row",new za(this.parent)),this.parent.serviceLocator.register("sheet",new Va(this.parent))},e.prototype.destroy=function(){this.removeEventListener(),this.parent.serviceLocator.getService("row").destroy(),this.parent.serviceLocator.getService("cell").destroy(),this.colMinWidth&&(this.colMinWidth=null),this.parent=null},e.prototype.addEventListener=function(){this.parent.on(Gn,this.destroy,this),this.parent.on(In,this.moveOrDuplicateSheetHandler,this),this.parent.on("getUpdatedScrollPosition",this.updateTopLeftScrollPosition,this)},e.prototype.removeEventListener=function(){this.parent.off(Gn,this.destroy),this.parent.off(In,this.moveOrDuplicateSheetHandler),this.parent.off("getUpdatedScrollPosition",this.updateTopLeftScrollPosition)},e}(),qa=function(e,t,r,n){return new(r||(r=Promise))(function(i,a){function o(e){try{l(n.next(e))}catch(e){a(e)}}function s(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(o,s)}l((n=n.apply(e,t||[])).next())})},Wa=function(e,t){function r(e){return function(t){return n([e,t])}}function n(r){if(i)throw new TypeError("Generator is already executing.");for(;l;)try{if(i=1,a&&(o=2&r[0]?a.return:r[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,r[1])).done)return o;switch(a=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return l.label++,{value:r[1],done:!1};case 5:l.label++,a=r[1],r=[0];continue;case 7:r=l.ops.pop(),l.trys.pop();continue;default:if(o=l.trys,!(o=o.length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){l=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){l.label=r[1];break}if(6===r[0]&&l.label<o[1]){l.label=o[1],o=r;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(r);break}o[2]&&l.ops.pop(),l.trys.pop();continue}r=t.call(e,l)}catch(e){r=[6,e],a=0}finally{i=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var i,a,o,s,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},Ga=function(){function e(e){this.parent=e,this.init(),this.addEventListener()}return e.prototype.init=function(){this.parent.element.appendChild(this.parent.createElement("input",{className:"e-clipboard",attrs:{contenteditable:"true",tabindex:"-1","aria-hidden":"true"}}))},e.prototype.addEventListener=function(){var e=this.getClipboardEle();this.parent.on(Qn,this.cut,this),this.parent.on(ei,this.copy,this),this.parent.on(ti,this.paste,this),this.parent.on("clearCopy",this.clearCopiedInfo,this),this.parent.on("tabSwitch",this.tabSwitchHandler,this),this.parent.on(Zn,this.cMenuBeforeOpenHandler,this),this.parent.on("ribboClick",this.ribbonClickHandler,this),this.parent.on(Wn,this.initCopyIndicator,this),this.parent.on(ri,this.rowHeightChanged,this),this.parent.on(ni,this.colWidthChanged,this),this.parent.on("refreshClipboard",this.refreshOnInsertDelete,this),t.EventHandler.add(e,"cut",this.cut,this),t.EventHandler.add(e,"copy",this.copy,this),t.EventHandler.add(e,"paste",this.paste,this)},e.prototype.removeEventListener=function(){var e=this.getClipboardEle();this.parent.isDestroyed||(this.parent.off(Qn,this.cut),this.parent.off(ei,this.copy),this.parent.off(ti,this.paste),this.parent.off("clearCopy",this.clearCopiedInfo),this.parent.off("tabSwitch",this.tabSwitchHandler),this.parent.off(Zn,this.cMenuBeforeOpenHandler),this.parent.off("ribboClick",this.ribbonClickHandler),this.parent.off(Wn,this.initCopyIndicator),this.parent.off(ri,this.rowHeightChanged),this.parent.off(ni,this.colWidthChanged),this.parent.off("refreshClipboard",this.refreshOnInsertDelete)),t.EventHandler.remove(e,"cut",this.cut),t.EventHandler.remove(e,"copy",this.copy),t.EventHandler.remove(e,"paste",this.paste)},e.prototype.ribbonClickHandler=function(e){var t=this.parent.element.id;switch(e.item.id){case t+"_cut":this.cut({invokeCopy:!0});break;case t+"_copy":this.copy({invokeCopy:!0})}},e.prototype.tabSwitchHandler=function(e){0!==e.activeTab||this.copiedInfo||this.copiedShapeInfo||this.hidePaste()},e.prototype.cMenuBeforeOpenHandler=function(e){var t=this.parent.getActiveSheet(),r=this.parent.serviceLocator.getService(Na),n=[],i=[],a=[],o=[],s=u(t.activeCell),l=He(s[0],s[1],t),d=t.isProtected&&U(l,ot(t,s[1])),h=ae(l,ot(t,s[1]),Qe(t,s[0]));"Content"!==e.target&&"RowHeader"!==e.target&&"ColumnHeader"!==e.target&&"SelectAll"!==e.target||(this.parent.enableContextMenuItems([r.getConstant("Paste"),r.getConstant("PasteSpecial")],!!(this.copiedInfo||this.copiedShapeInfo&&!d)),this.parent.enableContextMenuItems([r.getConstant("Cut")],!d)),"Content"===e.target&&(t.isProtected&&this.parent.enableContextMenuItems([r.getConstant("Filter"),r.getConstant("Sort"),r.getConstant("AddNote")],!1),d?this.parent.enableContextMenuItems([r.getConstant("Cut"),r.getConstant("Hyperlink"),r.getConstant("EditNote"),r.getConstant("DeleteNote")],!1):h?this.parent.enableContextMenuItems([r.getConstant("Cut"),r.getConstant("Paste"),r.getConstant("PasteSpecial"),r.getConstant("Filter"),r.getConstant("Sort"),r.getConstant("Hyperlink"),r.getConstant("EditHyperlink"),r.getConstant("OpenHyperlink"),r.getConstant("RemoveHyperlink"),r.getConstant("AddNote")],!1):t.isProtected&&!t.protectSettings.insertLink&&this.parent.enableContextMenuItems([r.getConstant("Hyperlink")],!1)),t.isProtected&&("ColumnHeader"===e.target&&(a=[r.getConstant("DeleteColumn"),r.getConstant("DeleteColumns"),r.getConstant("InsertColumn"),r.getConstant("InsertColumns")],o=[r.getConstant("HideColumn"),r.getConstant("HideColumns"),r.getConstant("UnhideColumns")],this.parent.enableContextMenuItems(a,!1),this.parent.enableContextMenuItems(o,t.protectSettings.formatColumns)),"RowHeader"===e.target&&(n=[r.getConstant("DeleteRow"),r.getConstant("DeleteRows"),r.getConstant("InsertRow"),r.getConstant("InsertRows")],i=[r.getConstant("HideRow"),r.getConstant("HideRows"),r.getConstant("UnhideRows")],this.parent.enableContextMenuItems(n,!1),this.parent.enableContextMenuItems(i,t.protectSettings.formatRows)))},e.prototype.rowHeightChanged=function(e){if(this.copiedInfo){var t=this.getCopyIndicator();t&&(this.copiedInfo.range[0]>e.rowIdx?t.style.top=parseFloat(t.style.top)+e.threshold+"px":P(this.copiedInfo.range,e.rowIdx,this.copiedInfo.range[1])&&(t.style.height=parseFloat(t.style.height)+e.threshold+"px"))}},e.prototype.colWidthChanged=function(e){if(this.copiedInfo){var t=this.getCopyIndicator();t&&(this.copiedInfo.range[1]>e.colIdx?t.style.left=parseFloat(t.style.left)+e.threshold+"px":P(this.copiedInfo.range,this.copiedInfo.range[0],e.colIdx)&&(t.style.width=parseFloat(t.style.width)+e.threshold+"px"))}},e.prototype.cut=function(e){this.setCopiedInfo(e,!0)},e.prototype.copy=function(e){this.setCopiedInfo(e,!1)},e.prototype.paste=function(e){var r=this;if(this.parent.isEdit||this.parent.element.getElementsByClassName("e-dlg-overlay").length>0)return void(this.parent.element.getElementsByClassName("e-spreadsheet-edit")[0].style.height="auto");var n,i=e&&e.clipboardData||window.clipboardData;if(!(i&&e.clipboardData&&e.clipboardData.getData("isInternalCut").length)||this.copiedInfo)if(i||this.copiedShapeInfo||e.isInternal&&this.copiedInfo){e.isInternal=!i;var a=void 0,o=this.getCopiedIdx();e.isAction=!!i||e.isAction;var s=e&&e.sIdx>-1?e.sIdx:this.parent.activeSheetIndex,l=Ae(this.parent,s),d=w(e&&e.range||c(l.selectedRange)),h=void 0,p=void 0;if(i){if(h=this.getExternalCells(e),p=h.model,!e.isInternal&&h.internal&&(i=!1,!this.copiedInfo))return;if(!p||!p.length){if(h.file)return void this.parent.notify("insertImage",{file:h.file});if(!this.copiedInfo)return;i=!1}}h=h;var u,f,g,v=Object.assign({isExternal:i},this.copiedInfo),y=void 0,C=void 0,b=void 0,x=void 0,S=void 0,I=void 0;i?(f=s,g=Ae(this.parent,f),y={},b="Sheet"!==(x=h.selection)&&(d[2]-d[0]+1)%h.rowCount==0&&(d[3]-d[1]+1)%h.colCount==0,u=[0,0,h.usedRowIndex,h.usedColIndex]):(u=w(this.copiedShapeInfo?c(l.selectedRange):this.copiedInfo.range),f=o,y=ot(l,u[1]),C=E(u)&&this.isRangeMerged(d,l),g=Ae(this.parent,f),b=!C&&(d[2]-d[0]+1)%(u[2]-u[0]+1)==0&&(d[3]-d[1]+1)%(u[3]-u[1]+1)==0,g&&(S=0===u[1]&&u[3]===g.colCount-1,I=0===u[0]&&u[2]===g.rowCount-1,S?I?(x="Sheet",u[2]=g.usedRange.rowIndex,u[3]=g.usedRange.colIndex):(x="Row",u[3]=g.usedRange.colIndex):I&&(x="Column",u[2]=g.usedRange.rowIndex))),n=b?d:[d[0],d[1]].concat([d[0]+u[2]-u[0],d[1]+u[3]-u[1]||d[1]]),x&&(("Sheet"===x||"Column"===x)&&n[2]<l.usedRange.rowIndex&&(n[2]=l.usedRange.rowIndex),("Sheet"===x||"Row"===x)&&n[3]<l.usedRange.colIndex&&(n[3]=l.usedRange.colIndex));var R=e&&e.type||"All";if(oe(this.parent,n))return void this.parent.notify(yi,null);if(l.isProtected&&sr(this.parent,n))return void this.parent.notify(vi,null);if(e.isAction&&!this.copiedShapeInfo){var N={requestType:"paste",copiedInfo:this.copiedInfo,copiedRange:m(u),pastedRange:m(n),type:R,cancel:!1};if(this.parent.notify(qr,{eventArgs:N,action:"clipboard"}),N.cancel)return;d=c(N.pastedRange),n=(b=i?"Sheet"!==h.selection&&(d[2]-d[0]+1)%h.rowCount==0&&(d[3]-d[1]+1)%h.colCount==0:!C&&!S&&(d[2]-d[0]+1)%(u[2]-u[0]+1)==0&&!I&&(d[3]-d[1]+1)%(u[3]-u[1]+1)==0)?d:[d[0],d[1]].concat([d[0]+u[2]-u[0],d[1]+u[3]-u[1]||d[1]]),R=N.type}var F=void 0;x?(F=[].concat(n),"Sheet"!==x&&"Column"!==x||(n[2]<l.usedRange.rowIndex&&(n[2]=l.usedRange.rowIndex),u[2]<l.usedRange.rowIndex&&(u[2]+=l.usedRange.rowIndex-u[2]),F[2]<l.rowCount&&(F[2]=l.rowCount-1)),"Sheet"!==x&&"Row"!==x||(n[3]<l.usedRange.colIndex&&(u[3]+=l.usedRange.colIndex-n[3],n[3]=l.usedRange.colIndex),u[3]<l.usedRange.colIndex&&(u[3]+=l.usedRange.colIndex-u[3]),F[3]<l.colCount&&(F[3]=l.colCount-1))):F=n;var A=void 0,O=void 0,T=void 0,D=d[0],L=[];if(l.isProtected&&sr(this.parent,n))return void this.parent.notify(vi,null);if(this.copiedShapeInfo&&!this.copiedInfo){var M=this.copiedShapeInfo.pictureElem;M.classList.contains("e-datavisualization-chart")?(this.copiedShapeInfo.chartInfo.top=null,this.copiedShapeInfo.chartInfo.left=null,this.parent.notify(xn,{chart:[this.copiedShapeInfo.chartInfo],isInitCell:!0,isUndoRedo:!0,isPaste:!0,dataSheetIdx:this.copiedShapeInfo.sheetIdx,isCut:this.copiedShapeInfo.isCut,sheetId:l.id,range:e.range||l.name+"!"+l.selectedRange})):this.parent.notify(Ni,{options:{src:M.style.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi,"$2"),height:this.copiedShapeInfo.height,width:this.copiedShapeInfo.width,id:this.copiedShapeInfo.isCut?M.id:""},range:m([D,d[1],D,d[1]]),isPublic:!1,isUndoRedo:!0});var B=He(D,d[1],l);if(B&&!t.isNullOrUndefined(B.image)&&B.image.length>0){Fe={requestType:"imagePaste",copiedShapeInfo:this.copiedShapeInfo,pasteSheetIndex:this.parent.activeSheetIndex,pastedRange:Le(this.parent)+"!"+m([D,d[1],D,d[1]]),pastedPictureElement:document.getElementById(B.image[B.image.length-1].id)};this.parent.notify(ci,{eventArgs:Fe,action:"clipboard"})}}else{var H=[],U=this.isInRange(u,d,o),V=!1,z=!1,j=0,_=[],W=void 0;b||"Values"===R||(W=this.setCF(u,n,g,l,_,W));for(var G=!1,Y=[],X={sheet:l,isExternal:!!i},K=this.setCell(X),$=!i&&this.copiedInfo.isCut&&this.setCell({sheet:g}),Z=[],J=[],Q=u[0],ee=0;Q<=u[2];Q++,ee++)if(i||v.isCut||!rt(g,Q)){U&&(H[d[0]+ee]={cells:[]});for(var te=u[1],re=0;te<=u[3];te++,re++){if(U&&(H[d[0]+ee].cells[d[1]+re]=He(d[0]+ee,d[1]+re,g,!1,!0)),A=i?p[Q]&&p[Q].cells[te]||{}:t.extend({},U&&H[Q]&&H[Q].cells[te]?H[Q].cells[te]:He(Q,te,g),null,!0),y=ot(g,te),!A.validation&&pt(y,Q,te)){var ne=Object.assign({},y.validation),ie=[0,u[1],0,u[3]],ae=ne.value1,se=ne.value2;k(ae)&&(ne.value1=q([Q,te],ie,g,this.parent,{formula:ae})),k(se)&&(ne.value2=q([Q,te],ie,g,this.parent,{formula:se})),A.validation=ne}if(A&&A.isReadOnly&&delete A.isReadOnly,S||I){if(A&&A.rowSpan)if(A.rowSpan>0)A.rowSpan+Q-1<=u[2]?V=!0:A={};else if(V){if(A.rowSpan<0){var le=A.rowSpan,de=A.colSpan?A.colSpan:0,he=He(D+le,d[1]+re+de,l);he&&!he.rowSpan&&(A={})}}else A={};A&&A.colSpan&&(A.colSpan>0?A.colSpan+te-1<=u[3]?z=!0:A={}:z||(A={}))}if(A&&R){var pe=void 0;switch(R){case"Formats":pe={format:A.format,style:A.style},this.copiedInfo&&!this.copiedInfo.isCut&&(A.rowSpan&&(pe.rowSpan=A.rowSpan),A.colSpan&&(pe.colSpan=A.colSpan)),A=pe;break;case"Values":(A={value:A.value}).value&&A.value.toString().indexOf("\n")>-1&&this.parent.getCell(d[0],d[1]).classList.add("e-alt-unwrap")}O=["Formats","Values"].indexOf(R)>-1}if(!this.parent.scrollSettings.isFinite&&(u[2]-u[0]>1048575-d[0]||u[3]-u[1]>16383-d[1])||this.parent.scrollSettings.isFinite&&(u[2]-u[0]>l.rowCount-1-d[0]||u[3]-u[1]>l.colCount-1-d[1]))return void this.showDialog();if(b){for(var ce=d[0];ce<=d[2];ce+=u[2]-u[0]+1)if(v.isCut||j||!rt(l,ce+ee))for(var ue=d[1];ue<=d[3];ue+=u[3]-u[1]+1){if(Q!==u[0]||te!==u[1]||void 0!==W&&!W.length||"Values"===R||(W=this.setCF(u,[ce,ue,ce+(u[2]-u[0]),ue+(u[3]-u[1])],g,l,_,W)),T=He(ce+ee,ue+re,l,!1,!0),!(i||t.isNullOrUndefined(T.colSpan)&&t.isNullOrUndefined(T.rowSpan))){if(S||I)continue;var fe={range:[ce+ee,ue+re,ce+ee,ue+re],merge:!1,isAction:!1,type:"All",sheetIndex:s,preventRefresh:s!==this.parent.activeSheetIndex};L.push(fe),this.parent.notify(gn,fe)}var ge=ue+re;if(A=t.extend({},A||{},null,!0),!O&&this.copiedInfo&&!this.copiedInfo.isCut&&A.formula){var me=q([ce+ee,ge],[Q,te],g,this.parent,U?A:null);t.isNullOrUndefined(me)||(A.formula=me)}if(this.copiedInfo&&!this.copiedInfo.isCut&&A.validation){var ve=d,ye=q(ve,ie=u,g,this.parent,{formula:A.validation.value1});A.validation.value1=ye,""!==A.validation.value2&&(ye=q(ve,ie,g,this.parent,{formula:A.validation.value2}),A.validation.value2=ye)}l.isProtected&&A&&!1!==A.isLocked&&(A.isLocked=T.isLocked),T&&T.formula&&T.formula.indexOf("=UNIQUE(")>-1&&this.parent.notify("removeUniquecol",null);var Ce={cellIdx:[Q,te],isUnique:!1,uniqueRange:"",sheetName:g.name};this.parent.notify(en,Ce),Ce.isUnique&&(A.value=null),G=!1,A&&A.formula&&A.formula.indexOf("=UNIQUE(")>-1&&(G=!0,Y.push([ce,ge]),A.value=null),K(ce+ee,ge,A,ge===d[3],O,G,e.beforeActionData,e.isUndo)||A.formula&&this.copiedInfo&&this.copiedInfo.isCut&&this.parent.notify(tn,{cellRef:m([Q,te,Q,te])})}}else!i&&Xt(this.parent,Q,te,o)||(C?K(D,d[1]+re,{value:A.value},te===u[3],!0):K(D,d[1]+re,A,te===u[3],O));if(!i&&this.copiedInfo.isCut&&(!P(d,Q,te)||o!==this.parent.activeSheetIndex)){var be=He(Q,te,g);if(be){if(be.isReadOnly)continue;if(be.isLocked||t.isNullOrUndefined(be.isLocked))if(!S&&!I||void 0===be.rowSpan&&void 0===be.colSpan)!be.validation&&g.columns[te]&&g.columns[te].validation&&-1===J.indexOf(te)&&J.push(te),be=null;else{if(!(be.rowSpan>1||be.colSpan>1))continue;Z.push({range:[Q,te,Q,te],rowSpan:be.rowSpan,colSpan:be.colSpan}),be=null}else!1===be.isLocked&&(be=g.isProtected?{isLocked:!1}:null)}$(Q,te,be,te===u[3])}}D++}else ee--,j++;if(Z.length&&Z.forEach(function(e){Ue(e.range[0],e.range[1],g,{rowSpan:e.rowSpan,colSpan:e.colSpan});var t={range:e.range};r.parent.notify("mergedRange",t),r.parent.notify(gn,{merge:!1,range:t.range,type:"All",sheetIndex:f,preventRefresh:f!==r.parent.activeSheetIndex}),t.range=t.range;for(var n=t.range[0];n<=t.range[2];n++)for(var i=t.range[1];i<=t.range[3];i++)$(n,i,null)}),J.length&&J.forEach(function(e){r.parent.notify(ln,{range:g.name+"!"+m([u[0],e,u[2],e]),isRemoveValidation:!0})}),Y.length)for(Q=0;Q<Y.length;Q++)this.parent.serviceLocator.getService("cell").refresh(Y[Q][0],Y[Q][1]);X.isRandFormula&&"Automatic"===this.parent.calculationMode&&this.parent.notify(Kr,{action:"refreshRandomFormula"}),this.parent.notify(Sn,null);var xe=n[2]-j,Se=F[2]-j;n[2]=xe,F[2]=Se,this.parent.setUsedRange(n[2],n[3]);var we=m(F);s!==this.parent.activeSheetIndex||e.isFromUpdateAction||this.parent.notify("selectRange",{address:we}),!i&&this.copiedInfo.isCut&&(a=this.copiedInfo.isCut,o===this.parent.activeSheetIndex&&this.parent.serviceLocator.getService("cell").refreshRange(u),this.clearCopiedInfo()),(i||U)&&this.copiedInfo&&this.clearCopiedInfo();var Ie=void 0;if(a){W&&W.length&&"Values"!==R&&(Ie={range:u,sheetIdx:f,isClear:!0},this.parent.notify(bn,Ie)),ir(g,u[0],u[1],(this.parent.getRow(u[0],null,this.parent.frozenColCount(g))||{offsetHeight:20}).offsetHeight);Re=ar(g,u[0]);Kt(this.parent,g,Re,u[0])}_.length&&s===this.parent.activeSheetIndex&&this.parent.notify(Cn,{cfModel:_,isAction:!0});var Ee=Ae(this.parent,o);if(!i&&u[0]===u[2]&&"Row"===x){for(var Re=Ee.rows[u[0]].height,Q=d[0];Q<=d[2];Q++)Kt(this.parent,this.parent.getActiveSheet(),Re,Q);if(a){var Ne=Ee&&Ee.standardHeight?Ee.standardHeight:20;Kt(this.parent,Ee,Ne,u[0])}}if(e.isAction){var Fe={requestType:"paste",copiedInfo:v,mergeCollection:L,pasteSheetIndex:this.parent.activeSheetIndex,copiedRange:g.name+"!"+(v.range?m(v.range):g.selectedRange),pastedRange:l.name+"!"+m(n),type:R||"All",selectedRange:we};j&&(Fe.skipFilterCheck=!0),Ie&&Ie.cfClearActionArgs&&(Fe.cfClearActionArgs=Ie.cfClearActionArgs),_.length&&(Fe.cfActionArgs={cfModel:_,sheetIdx:s}),this.parent.notify(ci,{eventArgs:Fe,action:"clipboard"})}e.focus&&or(this.parent.element)}}else this.getClipboardEle().select()},e.prototype.setCF=function(e,t,r,n,i,a){var o,s,l=this,d=function(r){o=[t[0]+(s[0]<=e[0]?0:s[0]-e[0]),t[1]+(s[1]<=e[1]?0:s[1]-e[1]),t[2]-(s[2]>=e[2]?0:e[2]-s[2]),t[3]-(s[3]>=e[3]?0:e[3]-s[3])],n.conditionalFormats||l.parent.setSheetPropertyOnMute(n,"conditionalFormats",[]);var a={range:m(o),type:r.type,cFColor:r.cFColor,value:r.value,format:r.format};n.conditionalFormats.push(a),i.push(a)};if(a)for(var h=0,p=a.length;h<p;h++)s=c(a[h].range),d(a[h]);else if(a=[],r.conditionalFormats)for(var h=0,p=r.conditionalFormats.length;h<p;h++)s=c(r.conditionalFormats[h].range),J([e],r.conditionalFormats[h].range)&&(a.push(r.conditionalFormats[h]),d(r.conditionalFormats[h]));return a},e.prototype.isRangeMerged=function(e,t){var r=He(e[0],e[1],t);if(r&&(r.colSpan>1||r.rowSpan>1)){var n={range:e.slice(2,4).concat(e.slice(2,4))};return this.parent.notify(mn,n),n.range[0]===e[0]&&n.range[1]===e[1]&&n.range[2]===e[2]&&n.range[3]===e[3]}return!1},e.prototype.updateFilter=function(e,t){var r,n;this.parent.notify("setFilteredCollection",null);for(var i=0;i<this.parent.sheets.length;i++)if(this.parent.filterCollection&&this.parent.filterCollection[i]&&this.parent.filterCollection[i].sheetIndex===we(this.parent,e.sId)){var a=e.range,o=c(this.parent.filterCollection[i].filterRange);a=w(a),o[0]===a[0]&&o[2]===a[2]&&o[1]===a[1]&&o[3]===a[3]&&(r=!0,n=[Math.abs(a[0]-o[0]),Math.abs(a[1]-o[1]),Math.abs(a[2]-o[2]),Math.abs(a[3]-o[3])])}var s=this.parent.getCell(e.range[0],e.range[1]),l=(s=s?s.querySelector(".e-filter-icon")?s:this.parent.getCell(e.range[2],e.range[3]):s)?s.querySelector(".e-sortasc-filter"):s,d=s?s.querySelector(".e-sortdesc-filter"):s;if(r)for(var h=0;h<this.parent.filterCollection.length;h++){var p=this.parent.filterCollection[h],u=e&&e.sId?we(this.parent,e.sId):this.parent.activeSheetIndex;if(p.sheetIndex===u&&this.parent.notify(pi,{predicates:null,range:p.filterRange,sIdx:u,isCut:!0}),p.sheetIndex===u&&u===this.parent.activeSheetIndex&&(n=[t[0]+n[0],t[1]+n[1],Math.abs(t[2]-n[2]),Math.abs(t[3]-n[3])],this.parent.notify(pi,{predicates:null,range:m(n),sIdx:null,isCut:!0}),e.range[3]===e.range[1])){var f=this.parent.getCell(t[0],t[1]);l&&f&&f.querySelector(".e-filter-icon").classList.add("e-sortasc-filter"),d&&f&&f.querySelector(".e-filter-icon").classList.add("e-sortdesc-filter")}}},e.prototype.isInRange=function(e,t,r){var n=this.parent.activeSheetIndex;return P(e,t[0],t[1])&&r===n||P(e,t[2],t[3])&&r===n},e.prototype.setCell=function(e){var t=this,r=e.sheet,n=r.name===this.parent.getActiveSheet().name;return function(i,a,o,s,l,d,h,p){o&&o.formula&&(o.formula.indexOf("RANDBETWEEN(")>-1||o.formula.indexOf("RAND(")>-1||o.formula.indexOf("NOW(")>-1)&&(e.isRandFormula=!0);var c=Y(t.parent,r,{cell:o,rowIdx:i,colIdx:a,pvtExtend:!l,valChange:!d,lastCell:s,uiRefresh:n,requestType:"paste",skipFormatCheck:!e.isExternal,isRandomFormula:e.isRandFormula},h,p);if(!c&&o&&o.style&&e.isExternal){var u=nr(t.parent,i,a,r,o.style||t.parent.cellStyle,o.wrap?Qt(t.parent.getDisplayText(o),rr(r,i,a,o.colSpan>1?a+o.colSpan-1:a),o.style,t.parent.cellStyle):1);(u=Math.round(u))<20&&(u=20),ir(r,i,a,u);var f=at(r,i),g=ar(r,i);g>f&&Kt(t.parent,r,g,i)}return c}},e.prototype.getCopiedIdx=function(){if(this.copiedInfo){for(var e=0;e<this.parent.sheets.length;e++)if(this.parent.sheets[e].id===this.copiedInfo.sId)return e;this.clearCopiedInfo()}return-1},e.prototype.setCopiedInfo=function(e,n){var i=this;if(!this.parent.isEdit){var a=new r.Deferred;e.promise=a.promise;var o,s=this.parent.getActiveSheet();if(e&&e.range){var l=0===e.range[1]&&e.range[3]===s.colCount-1,d=0===e.range[0]&&e.range[2]===s.rowCount-1,h={range:e.range};l||d||this.parent.notify("mergedRange",h),o=h.range}else o=c(s.selectedRange);if(n&&oe(this.parent,o))return void this.parent.notify(yi,null);if(e&&!e.isPublic&&!e.clipboardData){var p={copiedRange:s.name+"!"+m(o),cancel:!1,action:n?"cut":"copy"};if(this.parent.notify(qr,p),p.cancel)return}var u={sheet:s,indexes:[0,0,s.rowCount-1,s.colCount-1],isFinite:this.parent.scrollSettings.isFinite,promise:new Promise(function(e){e(void 0)})},f=document.getElementsByClassName("e-ss-overlay-active"),g=f.length;!s.isLocalData||e&&e.clipboardData||0!==o[0]||o[2]!==s.rowCount-1||g||(this.parent.showSpinner(),this.parent.notify("updateSheetFromDataSource",u)),this.checkForUncalculatedFormula(o,e&&e.sId?e.sId:s.id),u.promise.then(function(){if(g>0){var r={clientY:f[0].offsetTop,isImage:!0};i.parent.notify(Ei,r);var l={clientX:f[0].offsetLeft,isImage:!0};if(i.parent.notify(Ri,l),i.copiedShapeInfo={sId:e&&e.sId?e.sId:s.id,sheetIdx:s.index,isCut:n,pictureElem:f[0],copiedRange:m([r.clientY,l.clientX,r.clientY,l.clientX]),height:f[0].offsetHeight,width:f[0].offsetWidth,chartInfo:i.getChartElemInfo(f[0])},!f[0].classList.contains("e-datavisualization-chart")){var d=window.getComputedStyle(f[0]).backgroundImage.slice(5,-2);i.addImgToClipboard(d,i.copiedShapeInfo.height,i.copiedShapeInfo.width)}i.hidePaste(!0),n&&(f[0].classList.contains("e-datavisualization-chart")?i.parent.deleteChart(i.copiedShapeInfo.chartInfo.id):i.parent.notify(Fi,{id:i.copiedShapeInfo.pictureElem.id,sheetIdx:i.copiedShapeInfo.sId,range:i.copiedShapeInfo.copiedRange}))}else e&&e.clipboardData||(i.copiedInfo&&i.clearCopiedInfo(),i.copiedInfo={range:o,sId:e&&e.sId?e.sId:s.id,isCut:n},i.hidePaste(!0),e.isFromUpdateAction||i.initCopyIndicator(),t.Browser.isIE||i.getClipboardEle().select(),e&&e.invokeCopy&&document.execCommand(n?"cut":"copy"),i.parent.hideSpinner());t.Browser.isIE&&i.setExternalCells(e,n),a.resolve()}),e&&e.clipboardData&&(this.setExternalCells(e,n),this.getClipboardEle().setAttribute("aria-label",s.selectedRange+" "+this.parent.serviceLocator.getService(Na).getConstant(n?"Cut":"Copy")))}},e.prototype.imageToCanvas=function(e,t,r){return new Promise(function(n){var i=document.createElement("canvas"),a=i.getContext("2d"),o=new Image;o.src=e,o.crossOrigin="anonymous",o.onload=function(){i.width=r,i.height=t,a.drawImage(o,0,0,r,t),i.toBlob(function(e){n(e)},"image/png")}})},e.prototype.addImgToClipboard=function(e,t,r){return qa(this,void 0,void 0,function(){var n,i,a;return Wa(this,function(o){switch(o.label){case 0:return i=window.navigator,[4,this.imageToCanvas(e,t,r)];case 1:return a=o.sent(),[4,i.clipboard.write([new ClipboardItem((n={},n[a.type]=a,n))])];case 2:return o.sent(),[2]}})})},e.prototype.checkForUncalculatedFormula=function(e,r){for(var n,i=we(this.parent,r),a=Ae(this.parent,i),o=e[0];o<=e[2];o++)for(var s=e[1];s<=e[3];s++)(n=He(o,s,a,null,!0)).formula&&t.isUndefined(n.value)&&this.parent.notify(Kr,{action:"refreshCalculate",value:n.formula,rowIndex:o,colIndex:s,isFormula:k(n.formula),sheetIndex:i})},e.prototype.getChartElemInfo=function(e){var t=this.parent.chartColl;if(e.classList.contains("e-datavisualization-chart"))for(var r=e.getElementsByClassName("e-control")[0].id,n=0;n<t.length;n++)if(t[n].id===r)return t[n];return null},e.prototype.clearCopiedInfo=function(){this.copiedInfo&&(this.parent.getActiveSheet().id===this.copiedInfo.sId&&(this.removeIndicator(this.parent.getSelectAllContent()),this.removeIndicator(this.parent.getColumnHeaderContent()),this.removeIndicator(this.parent.getRowHeaderContent()),this.removeIndicator(this.parent.getMainContent())),this.copiedInfo=null,this.hidePaste()),this.copiedShapeInfo&&(this.copiedShapeInfo=null,this.hidePaste())},e.prototype.removeIndicator=function(e){if(e){var r=e.getElementsByClassName("e-copy-indicator")[0];r&&t.detach(r)}},e.prototype.initCopyIndicator=function(){if(this.copiedInfo&&this.parent.getActiveSheet().id===this.copiedInfo.sId){var e=this.parent.createElement("div",{className:"e-copy-indicator"});e.appendChild(this.parent.createElement("div",{className:"e-top"})),e.appendChild(this.parent.createElement("div",{className:"e-bottom"})),e.appendChild(this.parent.createElement("div",{className:"e-left"})),e.appendChild(this.parent.createElement("div",{className:"e-right"})),St(this.parent,e,this.copiedInfo.range,"e-copy-indicator")}},e.prototype.showDialog=function(){var e=this;this.parent.serviceLocator.getService(Fa).show({header:"Spreadsheet",height:205,width:340,isModal:!0,showCloseIcon:!0,content:this.parent.serviceLocator.getService(Na).getConstant("PasteAlert"),beforeOpen:function(t){var r={dialogName:"PasteDialog",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",r),r.cancel&&(t.cancel=!0)}})},e.prototype.hidePaste=function(e){this.parent.getActiveSheet().isProtected&&(e=!1),this.parent.notify("enableToolbarItems",[{items:[this.parent.element.id+"_paste"],enable:e||!1}])},e.prototype.setExternalCells=function(e,r){var n,i,a,o="",s=this.parent.getActiveSheet(),l=w(this.copiedInfo.range),d=0===l[1]&&l[3]===s.colCount-1,h=0===l[0]&&l[2]===s.rowCount-1,p='<html><body><table class="e-spreadsheet" xmlns="http://www.w3.org/1999/xhtml" style="border-collapse:collapse;"';(d||h)&&(p+=' aria-rowcount="'+s.usedRange.rowIndex+'" aria-colcount="'+s.usedRange.colIndex+'"',p+=' aria-label="'+(d&&h?"Sheet":d?"Row":"Column")+'"'),p+="><tbody>";for(var c=l[0];c<=l[2];c++)if(r||!rt(s,c)){p+="<tr>";for(var u=l[1];u<=l[3];u++)if(!((n=He(c,u,s,!1,!0)).colSpan<0||n.rowSpan<0)){if(p+="<td",n.colSpan&&(p+=' colspan="'+n.colSpan+'"'),n.rowSpan&&(p+=' rowspan="'+n.rowSpan+'"'),n.style?(a="",n.style.whiteSpace||(a+="white-space:"+(n.wrap?"normal":"nowrap")+";"),n.style.verticalAlign||(a+="vertical-align:bottom;"),Object.keys(n.style).forEach(function(e){var t=n.style[""+e];e.includes("border")&&t.includes("dashed")&&t.includes("1px")&&(t=t.replace("1px","thin"));var r=e.match(/[A-Z]/);a+=("backgroundColor"===e?"background":r?e.replace(r[0],"-"+r[0].toLowerCase()):e)+":"+("backgroundColor"===e||"color"===e?n.style[""+e].slice(0,7):t)+";"}),p+=a.includes('"')?" style='"+a+"'":' style="'+a+'"'):p+=' style="white-space:'+(n.wrap?"normal":"nowrap")+';vertical-align:bottom;"',t.isNullOrUndefined(n.value))p+="></td>";else{if(i=n.value,n.format&&"General"!==n.format){p+=n.value.toString().includes('"')?" cell-value='"+i+"'":' cell-value="'+n.value+'"',p+=n.format.includes('"')?" num-format='"+n.format+"'":' num-format="'+n.format+'"';var f={formattedText:i,value:i,format:n.format,cell:n,rowIndex:c,colIndex:u,dataUpdate:!0};this.parent.notify(Wr,f),i=f.formattedText}p+=">","string"==typeof i&&i.includes("\n")?p+=i.split("\n").join("<br>"):p+=i,o+=i,p+="</td>"}o+=u===l[3]?"":"\t"}p+="</tr>",o+=c===l[2]?"":"\n"}p+="</tbody></table></body></html>",t.Browser.isIE?(window.clipboardData.setData("text",o),r&&window.clipboardData.setData("isInternalCut",o)):(e.clipboardData.setData("text/html",p),e.clipboardData.setData("text/plain",o),r&&e.clipboardData.setData("isInternalCut",o),e.preventDefault())},e.prototype.getExternalCells=function(e){var r,n,i=this,a=[],o={model:a},s=this.parent.createElement("span"),l=function(){return setTimeout(function(){i.getClipboardEle().innerHTML=""},0)};if(t.Browser.isIE)n=window.clipboardData.getData("text");else{if(r=e.clipboardData.getData("text/html"),n=e.clipboardData.getData("text/plain"),this.copiedInfo&&r.includes('<table class="e-spreadsheet"')){var d=!1;if(!this.copiedInfo.isCut){var h={sheetIdx:we(this.parent,this.copiedInfo.sId)};if(this.parent.notify("getFilterRange",h),h.isFiltered){var p=h.filterRange,c=this.copiedInfo.range;d=p[0]===c[0]&&p[1]===c[1]&&p[2]===c[2]&&p[3]===c[3]}}if(!d)return l(),{internal:!0}}s.innerHTML=r}if(s.querySelector("table"))this.generateCells(s,o);else if(s.querySelector("img")){var u=s.querySelector("img");this.parent.notify(Ni,{options:{src:u.src,height:u.height,width:u.width},isPublic:!0})}else if(n){var f,g,m,v=[];r&&(g=[].slice.call(s.children));var y=this.cellStyle(s);o.colCount=1,n.split("\n").forEach(function(e){f=null,r&&(m=g.filter(function(t){return t.textContent&&t.textContent.replace(/(\r\n|\n|\r|\s)/gm," ").trim()===e.trim()})[0])&&(f=y(m),g.splice(g.indexOf(m),1)),e.split("\t").forEach(function(e,t){(e||f)&&(v[t]={},f&&(f.whiteSpace&&"nowrap"!==f.whiteSpace?(v[t].wrap=!0,delete f.whiteSpace,Object.keys(f).length&&(v[t].style=f)):v[t].style=f),e&&(k(e)?v[t].formula=e:v[t].value=ve(e.trim(),!0,!0)))}),a.push({cells:v}),o.colCount=Math.max(o.colCount,v.length),v=[]}),o.rowCount=a.length,o.usedRowIndex=a.length-1,o.usedColIndex=o.colCount-1}else if(e.clipboardData.files&&e.clipboardData.files[0]&&e.clipboardData.files[0].type.includes("image"))return l(),{file:e.clipboardData.files[0]};return l(),o},e.prototype.generateCells=function(e,r){var n=r.model,i=e.querySelector("table"),a=i.classList.contains("e-spreadsheet"),o={},s={};r.usedRowIndex=i.rows.length-1,r.rowCount=i.rows.length,a&&(r.selection=i.getAttribute("aria-label"),r.selection&&("Sheet"===r.selection?(r.usedRowIndex=Number(i.getAttribute("aria-rowcount")),r.usedColIndex=Number(i.getAttribute("aria-colcount"))):"Row"===r.selection?r.usedColIndex=Number(i.getAttribute("aria-colcount")):r.usedRowIndex=Number(i.getAttribute("aria-rowcount"))));var l=[];t.isNullOrUndefined(i)||t.isNullOrUndefined(i.getAttribute("style"))||(l.push(i.getAttribute("style")),this.generateStyles(l,o));var d,h,p,c,u,f,g,m=this.cellStyle(e,a),v=1;r.colCount=1;for(var y=[],C=0,b=r.usedRowIndex;C<=b;C++){d=i.rows[C],t.isNullOrUndefined(d.getAttribute("style"))||(y.push(d.getAttribute("style")),this.generateStyles(y,s)),n[C]||(n[C]={cells:[]}),h=n[C].cells,r.colCount=Math.max(r.colCount,d.cells.length),u=r.usedColIndex<d.cells.length?r.usedColIndex:d.cells.length-1;for(var x=0;x<=u;x++){if(c=d.cells[x],g=x,h[x]&&(x=this.getNewIndex(h,x)),h[x]={},p=m(c,s,o),c.textContent=c.textContent.replace(/(\r\n|\n|\r)/gm,""),c.textContent=c.textContent.replace(/\s+/g," "),p.whiteSpace&&"nowrap"!==p.whiteSpace&&(h[x].wrap=!0,delete p.whiteSpace),Object.keys(p).length&&(p.border&&(["borderBottom","borderTop","borderLeft","borderRight"].forEach(function(e){p[""+e]=p.border}),delete p.border),h[x].style=p),c.textContent&&(h[x].value=ve(c.textContent.trim(),!0,!0)),f=a?"num-format":"number-format",c.getAttribute(f)&&(h[x].format=c.getAttribute(f),h[x].value&&c.getAttribute("cell-value")&&(h[x].value=ve(c.getAttribute("cell-value").trim(),!0,!0))),c.getAttribute("colspan")&&parseInt(c.getAttribute("colspan"),10)>1&&(h[x].colSpan=parseInt(c.getAttribute("colspan"),10)),c.getAttribute("rowspan")&&parseInt(c.getAttribute("rowspan"),10)>1&&(h[x].rowSpan=parseInt(c.getAttribute("rowspan"),10)),h[x].colSpan>1&&h[x].rowSpan>1)for(var S=void 0,w=C,I=C+h[x].rowSpan;w<I;w++)for(var E=x,R=x+h[x].colSpan;E<R;E++)w===C&&E===x||(S=h[x].style?{style:t.extend({},h[x].style)}:{},w!==C&&(S.rowSpan=C-w),E!==x&&(S.colSpan=x-E),n[w]||(n[w]={cells:[]}),n[w].cells[E]=S);else if(h[x].colSpan>1)for(var w=x+1,I=x+h[x].colSpan;w<I;w++)h[w]={colSpan:x-w,style:t.extend({},p)};else if(h[x].rowSpan>1)for(var w=C+1,I=C+h[x].rowSpan;w<I;w++)n[w]||(n[w]={cells:[]}),n[w].cells[x]={rowSpan:C-w,style:t.extend({},p)};x=g}v=Math.max(v,h.length)}r.usedColIndex=v-1},e.prototype.getNewIndex=function(e,t){return e[t]&&(t++,t=this.getNewIndex(e,t)),t},e.prototype.cellStyle=function(e,t){var r,n,i=this;if(!t){r=e.querySelector("style")&&e.querySelector("style").innerHTML;var a=Object.keys(this.parent.commonCellStyle);if(a&&a.length&&r){var o=r.includes("td")?r.split("td")[1]:r;o=o.includes("{")?o.split("{")[1].split("}")[0]:o.split("}")[0],n={};for(var s=0;s<a.length;s++){var l=a[s],d=l.match(/[A-Z]/);d&&(l=l.replace(d[0],"-"+d[0].toLowerCase())),o.indexOf(l)>-1&&(n[a[s]]=o.split(l+":")[1].split(";")[0].trim())}}}return function(e,a,o){var s,l={};if(t){if(!e.getAttribute("style"))return l;s=e.getAttribute("style").split(";")}else{if(s=[],r&&e.className&&r.includes(e.classList[0])){var d=r.split(e.classList[0]);s.push(d[d.length-1].split("{")[1].split("}")[0])}var h=[].slice.call(e.querySelectorAll("*"));h.unshift(e),h.forEach(function(e){e.getAttribute("style")&&s.push(e.getAttribute("style")),"B"===e.tagName&&s.push("font-weight:bold"),"I"===e.tagName&&s.push("font-style:italic"),"U"===e.tagName&&s.push("text-decoration:underline")}),Object.assign(l,o,a,n)}return s.length&&i.generateStyles(s,l),e.querySelector("S")&&(l.textDecoration=l.textDecoration?"underline line-through":"line-through"),l.textDecoration&&-1===["underline","line-through","underline line-through","none"].indexOf(l.textDecoration)&&(l.textDecoration="none"),l.textAlign&&-1===["left","center","right"].indexOf(l.textAlign)&&(l.textAlign="left"),l.verticalAlign&&-1===["bottom","middle","top"].indexOf(l.verticalAlign)&&(l.verticalAlign="bottom"),l.fontSize&&(l.fontSize=Math.round(parseFloat(l.fontSize.indexOf("px")>-1?(.75*parseFloat(l.fontSize)).toString():l.fontSize.indexOf("em")>-1?(16*parseFloat(l.fontSize)/1.3333).toString():l.fontSize))+"pt"),l.fontWeight&&-1===["bold","normal"].indexOf(l.fontWeight)&&(l.fontWeight=l.fontWeight>"599"?"bold":"normal"),l}},e.prototype.generateStyles=function(e,t){var r,n,i,a,o,s=["font-family","vertical-align","text-align","text-indent","color","white-space","font-weight","font-style","font-size","text-decoration","background","background-color"],l=["fontFamily","verticalAlign","textAlign","textIndent","color","whiteSpace","fontWeight","fontStyle","fontSize","textDecoration","backgroundColor","backgroundColor"],d=["border-bottom","border-top","border-right","border-left","border"],h=["borderBottom","borderTop","borderRight","borderLeft","border"];e&&e.length&&e.forEach(function(e){e.split(";").forEach(function(e){if(n=e.split(":")[0].trim(),(r=s.indexOf(n))>-1)n=e.split(":")[1].trim(),t[l[r]]=n;else if((r=d.indexOf(n))>-1){if("none"===(n=e.split(":")[1].trim()))n=void 0;else if(n.includes("pt")){i=n.split("pt"),a=i[0].split(" ");for(var p=0;p<a.length;p++)if(o=parseFloat(a[p])){a.splice(p,1),a.unshift((o/.75).toFixed(2)+"px"),i[0]=a.join(" ");break}n=i.join("")}t[h[r]]=n}})})},e.prototype.refreshOnInsertDelete=function(e){if(this.copiedInfo){if(e.model.id!==this.copiedInfo.sId)return;var t=this.copiedInfo.range;if(e.isInsert){if("Column"===e.modelType){if(e.start<=t[3]){if(e.start<=t[1]){r=e.end-e.start+1;t[1]+=r,t[3]+=r}else t[3]=t[1]+(e.start-t[1]-1);this.performAction()}}else if(e.start<=t[2]){if(e.start<=t[0]){var r=e.end-e.start+1;t[0]+=r,t[2]+=r}else t[2]=t[1]+(e.start-t[1]-1);this.performAction()}}else this.clearCopiedInfo()}},e.prototype.performAction=function(){var e=this.getCopyIndicator();e&&St(this.parent,e,this.copiedInfo.range,"e-copy-indicator")},e.prototype.getClipboardEle=function(){return this.parent.element.getElementsByClassName("e-clipboard")[0]},e.prototype.getCopyIndicator=function(){return this.parent.element.getElementsByClassName("e-copy-indicator")[0]},e.prototype.getModuleName=function(){return"clipboard"},e.prototype.destroy=function(){this.removeEventListener();var e=this.getClipboardEle();t.detach(e),this.parent=null},e}(),Ya=function(){function e(e){this.editorElem=null,this.editCellData={},this.isEdit=!1,this.isCellEdit=!0,this.isNewValueEdit=!0,this.isAltEnter=!1,this.curEndPos=null,this.curStartPos=null,this.uniqueColl="",this.uniqueActCell="",this.isSpill=!1,this.keyCodes={BACKSPACE:8,SPACE:32,TAB:9,DELETE:46,ESC:27,ENTER:13,FIRSTALPHABET:65,LASTALPHABET:90,FIRSTNUMBER:48,LASTNUMBER:59,FIRSTNUMPAD:96,LASTNUMPAD:111,SYMBOLSETONESTART:186,SYMBOLSETONEEND:192,SYMBOLSETTWOSTART:219,SYMBOLSETTWOEND:222,FIREFOXEQUALPLUS:61,FIREFOXMINUS:173,F2:113},this.formulaErrorStrings=["mismatched parentheses","requires 3 arguments","improper formula","empty expression","mismatched string quotes","wrong number of arguments","invalid arguments"],this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.isEdit&&this.cancelEdit(!0,!1),this.removeEventListener(),this.editorElem=null,this.formulaErrorStrings&&(this.formulaErrorStrings=[]),this.editCellData&&(this.editCellData={}),this.keyCodes&&(this.keyCodes={}),this.parent=null},e.prototype.addEventListener=function(){t.Browser.isDevice&&"safari"===t.Browser.info.name&&(t.Browser.isIos||t.Browser.isIos7)?t.EventHandler.add(this.parent.element,"touchend",this.tapHandler,this):t.EventHandler.add(this.parent.element,"dblclick",this.dblClickHandler,this),this.parent.on("mouseDown",this.mouseDownHandler,this),this.parent.on(Kn,this.keyUpHandler,this),this.parent.on($n,this.keyDownHandler,this),this.parent.on(Yn,this.performEditOperation,this),this.parent.on("initiateCur",this.initiateCurPosition,this),this.parent.on("editValue",this.updateFormulaBarValue,this),this.parent.on("addressHandle",this.addressHandler,this),this.parent.on("initiateEdit",this.initiateRefSelection,this),this.parent.on("forRefSelRender",this.refSelectionRender,this),this.parent.on(en,this.checkUniqueRange,this),this.parent.on("reApplyFormula",this.reApplyFormula,this),this.parent.on("activeSheetChanged",this.sheetChangeHandler,this),this.parent.on(yi,this.readOnlyAlertHandler,this),this.parent.on("finiteAlert",this.finiteAlertHandler,this)},e.prototype.removeEventListener=function(){t.Browser.isDevice&&"safari"===t.Browser.info.name&&(t.Browser.isIos||t.Browser.isIos7)?t.EventHandler.remove(this.parent.element,"touchend",this.tapHandler):t.EventHandler.remove(this.parent.element,"dblclick",this.dblClickHandler),this.parent.isDestroyed||(this.parent.off("mouseDown",this.mouseDownHandler),this.parent.off(Kn,this.keyUpHandler),this.parent.off($n,this.keyDownHandler),this.parent.off(Yn,this.performEditOperation),this.parent.off("initiateCur",this.initiateCurPosition),this.parent.off("editValue",this.updateFormulaBarValue),this.parent.off("addressHandle",this.addressHandler),this.parent.off("initiateEdit",this.initiateRefSelection),this.parent.off("forRefSelRender",this.refSelectionRender),this.parent.off(en,this.checkUniqueRange),this.parent.off("reApplyFormula",this.reApplyFormula),this.parent.off("activeSheetChanged",this.sheetChangeHandler),this.parent.off(yi,this.readOnlyAlertHandler),this.parent.off("finiteAlert",this.finiteAlertHandler))},e.prototype.getModuleName=function(){return"edit"},e.prototype.performEditOperation=function(e){switch(e.action){case"renderEditor":if(this.renderEditor(),e.initLoad&&t.Browser.isDevice&&"safari"===t.Browser.info.name&&(t.Browser.isIos||t.Browser.isIos7)){var r=this.parent.createElement("div",{className:"e-ss-focus-edit",attrs:{contentEditable:"true",inputmode:"none",tabindex:"-1"}}),n=this.parent.element.querySelector(".e-sheet-panel");n&&(n.style.position="relative",n.appendChild(r)),this.parent.element.onfocus=function(){or(r)}}break;case"refreshEditor":this.refreshEditor(e.value,e.refreshFormulaBar,e.refreshEditorElem,e.isAppend,e.trigEvent),e.refreshCurPos&&this.setCursorPosition();break;case"startEdit":if(this.isEdit){var i={isEdit:!1};this.parent.notify("isFormulaBarEdit",i),i.isEdit&&(this.isNewValueEdit=e.isNewValueEdit,this.startEdit(e.address,e.value,e.refreshCurPos))}else this.isNewValueEdit=e.isNewValueEdit,this.startEdit(e.address,e.value,e.refreshCurPos);break;case"endEdit":this.isEdit&&this.endEdit(e.refreshFormulaBar,null,e.isPublic);break;case"cancelEdit":this.isEdit&&this.cancelEdit(e.refreshFormulaBar);break;case"getCurrentEditValue":e.editedValue=this.editCellData.value,void 0!==e.endFormulaRef&&(e.endFormulaRef=this.endFormulaRef);break;case"refreshDependentCellValue":this.refreshDependentCellValue(e.rowIdx,e.colIdx,e.sheetIdx);break;case"getElement":e.element=this.getEditElement(this.parent.getActiveSheet());break;case"focusEditorElem":this.editorElem.focus();break;case"getCurrentEditSheetIdx":e.sheetIndex=this.editCellData.sheetIndex}},e.prototype.keyUpHandler=function(e){if(this.isEdit){var t=this.getEditElement(this.parent.getActiveSheet());if(e.altKey&&13===e.keyCode?(t.focus(),this.altEnter(),this.isAltEnter=!0):this.isCellEdit&&this.editCellData.value!==t.textContent&&16!==e.keyCode&&(!e.shiftKey||e.shiftKey&&!Pt(e.keyCode))&&this.refreshEditor(t.textContent,this.isCellEdit),k(this.editCellData.value,!0)&&(!e||16!==e.keyCode&&17!==e.keyCode&&(!e.shiftKey||!Pt(e.keyCode)))&&(this.updateFormulaReference(t),this.endFormulaRef)){var r=this.getCurPosition(),n=["+","-","*","/",this.parent.listSeparator,"(","=","&",":"];r.end&&n.indexOf(this.editCellData.value[r.end-1])>-1&&(this.endFormulaRef=!1)}}},e.prototype.updateFormulaReference=function(e){var t=this.parent.element.querySelector(".e-formularef-indicator");t&&t.parentElement.removeChild(t),this.editCellData.value!==e.textContent&&this.refreshEditor(e.textContent,!0);var r=this.editCellData.sheetIndex,n=this.editCellData.value;this.parent.notify("initiateFormulaReference",{range:n,formulaSheetIdx:r})},e.prototype.keyDownHandler=function(e){var r=e.target,n=e.keyCode,i=this.parent.getActiveSheet(),a=u(i.activeCell),o=He(a[0],a[1],i,!1,!0),s=this.parent.enableKeyboardShortcut;if(!(s||n!==this.keyCodes.SPACE||e.ctrlKey||e.altKey||e.metaKey))return void e.preventDefault();if(!t.closest(r,".e-spreadsheet .e-dialog"))if(!i.isProtected||r.classList.contains("e-sheet-rename")||!U(o,ot(i,a[1]))||(r.classList.contains("e-formula-bar")||r.classList.contains("e-combobox"))&&!r.disabled){if(this.isEdit){var l=this.getEditElement(i),d=k(this.editCellData.value,!0);if((this.isCellEdit||d&&this.editCellData.value!==l.textContent&&16!==e.keyCode&&17!==e.keyCode)&&(a[1]<this.parent.frozenColCount(i)&&(!i.frozenRows||a[0]>=this.parent.frozenRowCount(i))&&l&&"auto"!==l.style.height&&Jt(l.textContent,o.style,this.parent.cellStyle)>parseInt(l.style.maxWidth,10)&&(l.style.height="auto"),Jt(l.textContent,o.style,this.parent.cellStyle)>parseInt(l.style.maxWidth,10)-5&&(l.style.height="auto"),a[0]<this.parent.frozenRowCount(i)&&l&&!l.style.overflow&&Jt(l.textContent,o.style,this.parent.cellStyle)>parseInt(l.style.maxWidth,10)&&(l.style.overflow="auto"),(!e.shiftKey||e.shiftKey&&!Pt(e.keyCode))&&this.refreshEditor(l.textContent,this.isCellEdit,!1,!1,!1)),!e.altKey)switch(n){case this.keyCodes.ENTER:if(t.Browser.isWindows&&e.preventDefault(),d){var h=this.parent.element.querySelector(".e-formularef-indicator");h&&h.parentElement.removeChild(h),Ae(this.parent,this.editCellData.sheetIndex).id===i.id?this.endEdit(!1,e):(this.parent.goTo(this.editCellData.fullAddr),this.endEdit(!1,e))}else this.endEdit(!1,e);break;case this.keyCodes.TAB:this.hasFormulaSuggSelected()||this.endEdit(!1,e);break;case this.keyCodes.ESC:s&&this.cancelEdit(!0,!0,e)}}else if(r.classList.contains("e-spreadsheet")||t.closest(r,".e-sheet-panel")){13===n&&"true"===r.contentEditable&&e.preventDefault();var p=String.fromCharCode(n),c=n>=this.keyCodes.FIRSTALPHABET&&n<=this.keyCodes.LASTALPHABET||p.toLowerCase()!==p.toUpperCase()&&!(n>=112&&n<=123),f=n>=this.keyCodes.FIRSTNUMBER&&n<=this.keyCodes.LASTNUMBER,g=n>=this.keyCodes.FIRSTNUMPAD&&n<=this.keyCodes.LASTNUMPAD,m=n>=this.keyCodes.SYMBOLSETONESTART&&n<=this.keyCodes.SYMBOLSETONEEND;m||(m=n>=this.keyCodes.SYMBOLSETTWOSTART&&n<=this.keyCodes.SYMBOLSETTWOEND);var v=n===this.keyCodes.FIREFOXEQUALPLUS||n===this.keyCodes.FIREFOXMINUS,y=!e.shiftKey&&!e.ctrlKey&&!e.metaKey&&n===this.keyCodes.F2&&s,C=n===this.keyCodes.BACKSPACE&&s,b=/(Macintosh|MacIntel|MacPPC|Mac68K|Mac|Mac OS|iPod|iPad)/i.test(navigator.userAgent)&&C,x=this.parent.element.querySelector(".e-readonly-alert-dlg"),S=this.parent.element.getElementsByClassName("e-ss-overlay-active");if((!e.ctrlKey&&!e.metaKey&&!e.altKey&&(!e.shiftKey&&n===this.keyCodes.SPACE||c||f||g||m||"mozilla"===t.Browser.info.name&&v)||y||C)&&(y&&(this.isNewValueEdit=!1),x||(oe(this.parent)&&0===S.length?this.parent.notify(yi,null):S.length?C&&!b&&this.editingHandler("delete"):(this.startEdit(null,null,!0,!0),or(this.getEditElement(i))))),(n===this.keyCodes.DELETE||b)&&s){var w=i.isProtected&&sr(this.parent);x||(w?this.parent.notify(vi,null):oe(this.parent)&&0===S.length?this.parent.notify(yi,null):(this.editingHandler("delete"),this.parent.notify("activeCellChanged",null)))}}}else if((n>=this.keyCodes.FIRSTALPHABET&&n<=this.keyCodes.LASTALPHABET||n>=this.keyCodes.FIRSTNUMBER&&n<=this.keyCodes.LASTNUMBER||n===this.keyCodes.DELETE||n===this.keyCodes.BACKSPACE||n===this.keyCodes.SPACE||n>=this.keyCodes.FIRSTNUMPAD&&n<=this.keyCodes.LASTNUMPAD||n>=this.keyCodes.SYMBOLSETONESTART&&n<=this.keyCodes.SYMBOLSETONEEND||n>=219&&n<=222||!e.shiftKey&&!e.ctrlKey&&!e.metaKey&&n===this.keyCodes.F2)&&67!==n&&89!==n&&90!==n){if(i.protectSettings.insertLink&&75===n)return;if(e.altKey&&(65===n||70===n||72===n||77===n||78===n||87===n))return;e.ctrlKey||70===e.keyCode||this.parent.element.querySelector(".e-editAlert-dlg")||r.parentElement.classList.contains("e-unprotectpwd-content")||r.parentElement.classList.contains("e-password-content")||r.parentElement.classList.contains("e-sheet-password-content")||r.parentElement.classList.contains("e-unprotectsheetpwd-content")||r.parentElement.classList.contains("e-reenterpwd-content")||this.parent.notify(vi,null)}},e.prototype.renderEditor=function(){if(!this.editorElem||!t.select("#"+this.parent.element.id+"_edit",this.parent.element)){var e=this.parent.createElement("div",{id:this.parent.element.id+"_edit",className:"e-spreadsheet-edit",attrs:{contentEditable:"true",role:"textbox",spellcheck:"false","aria-multiline":"true"}});this.parent.element.getElementsByClassName("e-spreadsheet-edit")[0]&&this.parent.element.getElementsByClassName("e-spreadsheet-edit")[0].remove();var r=this.parent.element.querySelector(".e-sheet-content");if(!r)return;r.appendChild(e),this.editorElem=e}this.parent.notify("formulaOperation",{action:"renderAutoComplete"})},e.prototype.refreshEditor=function(e,t,r,n,i,a){void 0===i&&(i=!0),n?e=this.editCellData.value=this.editCellData.value+e:this.editCellData.value=a||e;var o=this.getEditElement(this.parent.getActiveSheet());r&&o&&(o.textContent=e),t&&this.parent.notify("formulaBarOperation",{action:"refreshFormulabar",value:e}),this.parent.isEdit&&o&&i&&this.editCellData.value===o.textContent&&this.triggerEvent("cellEditing").cancel&&this.cancelEdit(!1,!1,null,!0)},e.prototype.startEdit=function(e,t,r,n){void 0===r&&(r=!0),this.parent.showSheetTabs&&this.parent.element.querySelector(".e-add-sheet-tab").setAttribute("disabled","true");var i=this.parent.getActiveSheet(),a=u(i.activeCell),o=He(a[0],a[1],i,!1,!0);if("Manual"===this.parent.calculationMode&&k(o.formula)&&(this.editCellData.prevFormulaValue=o.value),Xt(this.parent,a[0],a[1],this.parent.activeSheetIndex)){var s=this.parent.getCell(a[0],a[1]),l=!1,d=s.innerHTML;if(s&&d.indexOf("<")>-1&&d.indexOf(">")>-1&&d.indexOf("input")>-1&&(l=!0),l)return}var h=this.updateEditCellDetail(e,t);this.initiateEditor(r,h),this.positionEditor(),this.parent.isEdit=this.isEdit=!0,this.parent.notify("clearCopy",null),this.parent.notify("enableToolbarItems",[{enable:!1}]),o.formula&&!n&&this.parent.notify("initiateFormulaReference",{range:o.formula,formulaSheetIdx:this.editCellData.sheetIndex})},e.prototype.setCursorPosition=function(){var e=this.getEditElement(this.parent.getActiveSheet()),t=e.textContent.length;if(t){var r=document.getSelection(),n=document.createRange();n.setStart(e.firstChild,t),n.collapse(!0),r.removeAllRanges(),r.addRange(n)}e.focus()},e.prototype.hasFormulaSuggSelected=function(){var e=document.getElementById(this.parent.element.id+"_ac_popup");return e&&"visible"===e.style.visibility&&e.querySelectorAll(".e-item-focus").length>0},e.prototype.editingHandler=function(e){var r,n=document.getElementsByClassName("e-ss-overlay-active"),i=n.length;switch(e){case"delete":if(i>0)n[0].classList.contains("e-datavisualization-chart")?this.parent.notify(Ai,{id:n[0].id,sheetIdx:this.parent.activeSheetIndex+1}):this.parent.notify(Fi,{id:n[0].id,sheetIdx:this.parent.activeSheetIndex+1});else{var a=this.parent.getActiveSheet(),o=a.selectedRange,s=y(o);o=m(s=s[0]>s[2]||s[1]>s[3]?w(s):s);var l={address:a.name+"!"+o,cancel:!1};if(this.parent.notify(qr,{action:"cellDelete",eventArgs:l}),l.cancel)return;s=c(o=C(l.address)),dr(this.parent,s,this.parent.activeSheetIndex),this.parent.notify("selectionComplete",{}),0===s[0]&&0===s[1]&&s[2]>=a.usedRange.rowIndex&&s[3]>=a.usedRange.colIndex&&this.parent.setUsedRange(0,0,a,!1,!0);var d={cellIdx:s,isUnique:!1};if(this.checkUniqueRange(d),d.isUnique){var h=c(this.uniqueColl);(x=He(h[0],h[1],this.parent.getActiveSheet()))&&x.value&&(r=x.value.toString().indexOf("#SPILL!")>-1)}if(d.isUnique&&this.uniqueColl.split(":")[0]===o.split(":")[0]){for(var p=c(this.uniqueColl),u=p[0];u<=p[2];u++)for(v=p[1];v<=p[3];v++)this.parent.updateCellInfo({value:"",formula:""},m([u,v]),!0);this.parent.notify("removeUniquecol",null),this.uniqueColl=""}else if(d.isUnique){var f=c(this.uniqueColl);if("#SPILL!"===He(f[0],f[1],a).value){for(var g=!1,v=f[0];v<=f[2];v++)for(var b=f[1];b<=f[3];b++){var x=He(v,b,a);v===f[0]&&b===f[1]?g=!1:x&&!t.isNullOrUndefined(x.value)&&""!==x.value&&(g=!0)}g||this.reApplyFormula()}}d.isUnique?this.parent.notify(ci,{action:"cellDelete",eventArgs:{address:a.name+"!"+o,isSpill:r}}):this.parent.notify(ci,{action:"cellDelete",eventArgs:{address:a.name+"!"+o}})}}},e.prototype.getCurPosition=function(){var e={},t=window.getSelection();if(t&&t.focusNode&&t.focusNode.classList&&t.focusNode.classList.contains("e-formula-bar-panel")){var r=t.focusNode.getElementsByClassName("e-formula-bar e-css")[0];r.value===this.editCellData.value&&(e.start=r.selectionStart,e.end=r.selectionEnd)}else if(this.getEditElement(this.parent.getActiveSheet()).textContent===this.editCellData.value&&(e.start=t.anchorOffset,e.end=t.focusOffset,e.start>e.end)){var n=e.start;e.start=e.end,e.end=n}return e},e.prototype.mouseDownHandler=function(e){if(!t.closest(e.target,".e-findtool-dlg")&&!t.closest(e.target,".e-validation-error-dlg")&&this.isEdit){var r=this.getCurPosition(),n=void 0,i=void 0;r.start&&(this.curStartPos=n=r.start),r.end&&(this.curEndPos=i=r.end);var a=e.target,o=this.parent.getActiveSheet(),s=this.parent.element.querySelector(".e-formularef-indicator");this.isCellEdit=a.classList.contains("e-spreadsheet-edit");var l=k(this.editCellData.value,!0),d=this.getEditElement(o),h=["+","-","*","/",this.parent.listSeparator,"(","=","&",":"];if(a.classList.contains("e-cell")||a.classList.contains("e-header-cell")||a.classList.contains("e-selectall")||t.closest(a,".e-toolbar-item.e-active")||t.closest(a,".e-table"))if(!l||this.endFormulaRef)this.endFormulaRef=!1,this.endEdit(!1,e);else{var p=u(o.activeCell),c=He(p[0],p[1],o),f=document.activeElement.classList.contains("e-formula-bar")?document.activeElement.value:d.textContent;if(this.editCellData.value===f)if(n===i){if(this.editCellData.sheetIndex!==Se(this.parent,o.name)){if(-1===h.indexOf(f.substring(n-1,n)))return s&&s.parentElement.removeChild(s),this.parent.goTo(this.editCellData.fullAddr),void this.endEdit(!1,e)}else if(-1===h.indexOf(d.textContent.substring(n-1,n)))return s&&s.parentElement.removeChild(s),void this.endEdit(!1,e)}else-1!==h.indexOf(f.substring(n-1,n))&&O(f.substring(n,i))&&f.indexOf(":")!==i&&(this.editCellData.value=f.substring(0,n)+f.substring(i,f.length));if(!c)return;if((l=c.formula&&(k(c.formula)||this.editCellData.value&&0===this.editCellData.value.toString().indexOf("=")))&&this.parent.isEdit){g=i;this.editCellData.value.length===g?(")"===this.editCellData.value.substring(this.editCellData.value.length-1)||fe(this.editCellData.value.substring(this.editCellData.value.length-1)))&&(s&&s.parentElement.removeChild(s),this.endEdit(!1,e)):this.editCellData.value===f&&-1===h.indexOf(f.substring(g-1,g))&&(s&&s.parentElement.removeChild(s),this.endEdit(!1,e))}}else if(l&&this.editCellData.value===d.textContent&&d.textContent.indexOf("(")!==d.textContent.length-1&&!this.isCellEdit&&!a.classList.contains("e-formula-bar")&&-1===h.indexOf(this.editCellData.value.substring(n-1,n))&&Ae(this.parent,this.editCellData.sheetIndex).id===o.id){var g=window.getSelection().focusOffset;if(-1===h.indexOf(d.textContent.substring(g-1,g)))return s&&s.parentElement.removeChild(s),this.parent.goTo(this.editCellData.fullAddr),void(this.isEdit&&this.endEdit(!1,e))}}},e.prototype.tapHandler=function(e){var t=this;if(!this.tapedTwice)return this.tapedTwice=!0,void setTimeout(function(){if(t.tapedTwice=!1,!t.parent.isEdit&&e.target.classList.contains("e-cell")){var r=t.parent.element.querySelector(".e-ss-focus-edit");r&&or(r)}},300);e.preventDefault(),this.dblClickHandler(e)},e.prototype.dblClickHandler=function(e){var r=e.target;if(!t.closest(r,".e-datavisualization-chart")&&!r.classList.contains("e-ss-overlay")&&(r.classList.contains("e-active-cell")||r.classList.contains("e-cell")||r.classList.contains("e-wrap-content")||t.closest(r,".e-sheet-content")||r.classList.contains("e-table"))){var n=this.parent.getActiveSheet(),i=u(n.activeCell),a=He(i[0],i[1],n,!1,!0);if(ae(a,ot(n,i[1]),Qe(n,i[0])))this.parent.notify(yi,null);else if(n.isProtected&&U(a,ot(n,i[1])))this.parent.notify(vi,null);else if(this.isEdit){if(!r.classList.contains("e-spreadsheet-edit"))if(k(this.editCellData.value)){var o=this.editCellData.fullAddr.substring(0,this.editCellData.fullAddr.lastIndexOf("!"));this.parent.getActiveSheet().name===o&&this.endEdit()}else this.endEdit()}else this.isNewValueEdit=!1,this.startEdit(),or(this.getEditElement(n))}},e.prototype.updateEditCellDetail=function(e,r){var n,i,a;if(n=t.isNullOrUndefined(this.editCellData.sheetIndex)?e&&e.lastIndexOf("!")>-1?Se(this.parent,Ie(e)):this.parent.activeSheetIndex:this.editCellData.sheetIndex,this.editCellData.addr?k(this.editCellData.value,!0)&&(i=Ae(this.parent,n),this.isNewValueEdit=!1):(i=Ae(this.parent,n),e=e?C(e):i.activeCell),e){var o=c(e),s=o[0],l=o[1],d=He(s,l,i,!1,!0);if(d.colSpan>1||d.rowSpan>1){var h={sheet:i,cell:d,rowIdx:s,colIdx:l};te(h),s=h.rowIdx,l=h.colIdx,a=h.isMergedHiddenCell}var p=this.parent.getCell(s,l),u=xt(i,o,this.parent.frozenRowCount(i),this.parent.frozenColCount(i),this.parent.viewport.beforeFreezeHeight,this.parent.viewport.beforeFreezeWidth,this.parent.sheetModule.colGroupWidth);this.editCellData={addr:e,fullAddr:Le(this.parent,n)+"!"+e,rowIndex:s,colIndex:l,sheetIndex:n,element:p,value:r||"",position:u,prevFormulaValue:this.editCellData.prevFormulaValue}}return a},e.prototype.initiateEditor=function(e,r){var n=this;ye(this.parent,this.editCellData.fullAddr,!1,r).then(function(r){n.parent&&r.forEach(function(r){var i,a=function(){var e={cell:r,value:r?r.value:"",showFormattedText:n.editCellData.showFormattedText};n.parent.notify("getFormattedBarText",e),i=r?r.formula||e.value:"",n.editCellData.oldValue=i};a();var o=n.triggerEvent("cellEdit",null,i);if(o.cancel)return void n.cancelEdit(!0,!1,null,!0);o.showFormattedText&&(n.editCellData.showFormattedText=!0,a()),n.editCellData.value?i=n.editCellData.value:n.editCellData.value=i;var s;n.isNewValueEdit?(s=i,i=""):n.isNewValueEdit=!0,t.isUndefined(i)&&(i=""),n.refreshEditor(i,!1,!0,!1,!1,s),e&&n.setCursorPosition()})})},e.prototype.positionEditor=function(e){var r,n=this.editCellData.element,i={isEdit:!1};if(this.parent.notify("isFormulaBarEdit",i),i.isEdit&&t.isNullOrUndefined(n)&&(n=r=this.parent.getCell(this.editCellData.rowIndex,this.editCellData.colIndex),this.editCellData.element=r),n){n.classList.add("e-ss-edited");var a=this.parent.getActiveSheet(),o=He(this.editCellData.rowIndex,this.editCellData.colIndex,a,!1,!0),s=this.editCellData.position.left+1,l=this.editCellData.position.top+1,d={range:[this.editCellData.rowIndex,this.editCellData.colIndex,this.editCellData.rowIndex,this.editCellData.colIndex]};this.parent.notify(mn,d);var h=at(a,d.range[0],d.range[2])-3,p=dt(a,d.range[1],d.range[3])-3,c=this.parent.getMainContent(),u=c.parentElement,f=void 0,g=this.parent.frozenColCount(a),m=void 0,v=void 0,y=this.parent.frozenRowCount(a),C=void 0;if(this.editCellData.colIndex<g)f=Math.abs(this.parent.getRowHeaderContent().getBoundingClientRect()[this.parent.enableRtl?"left":"right"]-n.getBoundingClientRect()[this.parent.enableRtl?"right":"left"])-1,this.editCellData.rowIndex<y?"2"===this.parent.getRowHeaderContent().style.zIndex&&(m="3"):Jt(o.value,o.style,this.parent.cellStyle)>f&&(C=!0);else{f=u.offsetWidth-(s-c.scrollLeft)-28-this.parent.sheetModule.getRowHeaderWidth(a);var b=n.getBoundingClientRect(),x=u.getBoundingClientRect(),S=this.parent.enableRtl?b.left:b.right,w=this.parent.enableRtl?x.left:x.right,I=this.parent.getScrollElement(),E=this.parent.sheetModule.getScrollSize();this.parent.enableRtl?w+E>S&&(I.scrollLeft-=b.width):w-E<S&&(I.scrollLeft+=b.width)}this.editCellData.rowIndex<y&&(v=!0);var R=!v&&(o&&o.wrap||n&&e||C)?"auto;":h+"px;",N="display:block;top:"+l+"px;"+(this.parent.enableRtl?"right:":"left:")+s+"px;min-width:"+p+"px;max-width:"+(o&&o.wrap?p:f)+"px;height:"+R+(o&&o.wrap?"width:"+p+"px;":"")+"min-height:"+h+"px;"+(m?"z-index: "+m+";":"")+(v&&(o&&!o.wrap||n&&e)&&(Jt(o.value,o.style,this.parent.cellStyle)>f||n&&e)?"overflow: auto;":"");n.style.cssText.split(";").forEach(function(e){e.includes("border")||(N+=e+";")});var F=this.getEditElement(a,!0);F.style.cssText=N,Jt(F.textContent,o.style,this.parent.cellStyle)>f&&(F.style.height="auto");var A=this.parent.element.querySelector(".e-active-cell");A&&(A.style.height=h+4+"px"),n.classList.contains("e-right-align")?F.classList.add("e-right-align"):n.classList.contains("e-center-align")&&F.classList.add("e-center-align")}},e.prototype.updateEditedValue=function(e,t,r,n){var i=this,a=this.editCellData.oldValue;t&&(this.editCellData.value=t);var o=this.editCellData.value;this.parent.notify("setActionData",{args:{action:"beforeCellSave",eventArgs:{address:this.editCellData.addr}}});var s=!0;if(this.parent.allowDataValidation){var l=this.parent.getActiveSheet(),d=c(l.activeCell),h=He(d[0],d[1],l,!1,!0),p=ot(l,d[1]);if(h.validation||pt(p,d[0],d[1])){var u=this.editCellData.value||this.getEditElement(l).innerText,f=this.parent.activeSheetIndex,g={value:u,range:"string"==typeof this.editCellData.addr?c(this.editCellData.addr):this.editCellData.addr,sheetIdx:f,isEdit:!0,td:null,isValid:!0},m=Object.assign({},h,{value:u});Ue(d[0],d[1],l,m),this.parent.notify("isValidation",g),Ue(d[0],d[1],l,h),(s=g.isValid)?k(u)||!h.format?this.editCellData.value||(this.editCellData.value=u):(u!==g.value||!this.editCellData.value&&g.value)&&(this.editCellData.value=g.value):this.isCellEdit=!0}}if(!n&&k(this.editCellData.value)){var v={formula:this.editCellData.value};if(this.parent.notify("checkFormulaRef",v),v.isInvalid){var y;this.isCellEdit=!0,s=!1;var C=this.parent.serviceLocator.getService(Na),b=this.parent.serviceLocator.getService(Fa);b.show({width:400,isModal:!0,showCloseIcon:!0,target:this.parent.element,cssClass:"e-validation-error-dlg",content:C.getConstant("CellReferenceTypoError")+"<br>"+v.formula,beforeOpen:function(){return i.editCellData.element.focus()},buttons:[{buttonModel:{content:C.getConstant("Yes"),isPrimary:!0},click:function(){y=!0,b.hide()}},{buttonModel:{content:C.getConstant("No")},click:function(){return b.hide()}}],close:function(){if(y)t=i.editCellData.value=v.formula,i.updateCell(a,e,t,o,r),i.parent.notify("formulaBarOperation",{action:"refreshFormulabar",value:v.formula});else{var n=i.getEditElement(i.parent.getActiveSheet());n.innerText&&window.getSelection().selectAllChildren(n)}}},!1)}}s?this.updateCell(a,e,t,o,r):r&&r.preventDefault()},e.prototype.updateCell=function(e,r,n,i,a){var o=e?e.toString().toUpperCase():"",s=this.parent.getActiveSheet();(e||0===e)&&(e=e.toString());var l=this.editCellData.value;if(l&&(l=l.toString()),e!==l||k(o)){this.isAltEnter&&l&&l.includes("\n")&&(ze(s.activeCell,!0,this.parent,!0),this.refreshEditor(l,this.isCellEdit,!1,!1,!1));var d=c(s.activeCell);e&&e.indexOf("=UNIQUE(")>-1&&""===this.editCellData.value&&this.parent.notify("removeUniquecol",null);var h={cellIdx:d,isUnique:!1};this.checkUniqueRange(h);var p=h.isUnique;if(p&&""!==e&&""===this.editCellData.value&&-1===He((w=c(this.uniqueColl))[0],w[1],s).value.toString().indexOf("#SPILL!"))return;e&&e.indexOf("UNIQUE")>-1&&this.editCellData.value&&this.editCellData.value.toString().indexOf("UNIQUE")>-1&&p&&this.updateUniqueRange("");var u={action:"updateCellValue",address:this.editCellData.addr,value:this.editCellData.value,skipCellFormat:this.editCellData.showFormattedText};this.parent.notify($r,u);var f=He(d[0],d[1],s,!0),g=void 0;t.isNullOrUndefined(f)||(g=f.value.toString());var m="#CIRCULARREF!"===g;if(this.formulaErrorStrings.indexOf(g)>-1||m){var v=void 0;if(a){var y=a.target,C=["e-scroller","e-main-panel","e-autofill"];["e-toolbar-item","e-tab-wrap","e-text-wrap","e-tab-text","e-caret"].some(function(e){return y.classList.contains(e)})&&t.closest(y,".e-ribbon")||C.some(function(e){return y.classList.contains(e)})||(v=this.showFormulaAlertDlg(g,m)),v||a.preventDefault()}if(!v)return delete f.value,delete f.formula,this.parent.notify(tn,{cellRef:s.activeCell,clearFormulaInfo:!0}),void(k(o)?this.parent.updateCellInfo({formula:o},s.activeCell):e&&this.parent.updateCellInfo({value:e},s.activeCell));f.value="0"}var b=void 0;u.isFormulaDependent&&(b=ee(this.parent,this.parent.viewport));var x=He(d[0],d[1],s,!0),S=this.getRefreshNodeArgs(x,this.editCellData.element,this.editCellData.rowIndex,this.editCellData.colIndex);if(this.editCellData.value=S.value,this.parent.notify("refreshChart",{cell:null,rIdx:this.editCellData.rowIndex,cIdx:this.editCellData.colIndex,viewportIndexes:b}),x&&x.formula&&(this.editCellData.formula=x.formula),r&&this.parent.refreshNode(this.editCellData.element,S),x&&x.hyperlink&&this.parent.serviceLocator.getService("cell").refreshRange(d),s.conditionalFormats&&s.conditionalFormats.length&&this.parent.notify(Cn,{indexes:[this.editCellData.rowIndex,this.editCellData.colIndex],isAction:!0,refreshAll:u.isFormulaDependent,isEdit:!0}),x&&x.wrap&&this.parent.notify(an,{range:d,wrap:!0,sheet:s}),p){var w=c(this.uniqueColl);if(He(w[0],w[1],s).value.toString().indexOf("#SPILL!")>-1&&(this.isSpill=!0),""!==e&&""===this.editCellData.value||this.editCellData.formula&&this.editCellData.formula.length>1&&e!==this.editCellData.formula){for(var I=!1,E=w[0];E<=w[2];E++)for(var R=w[1];R<=w[3];R++){var N=He(E,R,s);E===w[0]&&R===w[1]?I=!1:N&&!t.isNullOrUndefined(N.value)&&""!==N.value&&(I=!0)}I||this.reApplyFormula()}else this.updateUniqueRange(i)}}this.triggerEvent("cellSave",a,n),this.resetEditState(),this.focusElement(a)},e.prototype.checkUniqueRange=function(e){var t={range:[]};this.parent.notify("getUniqueRange",t);var r=t.range;e.sheetName||(e.sheetName=this.parent.getActiveSheet().name);for(var n=0;n<r.length;n++)if(r[n].substring(0,r[n].lastIndexOf("!"))===e.sheetName)for(var i=c(r[n]),a=i[0];a<=i[2];a++)for(var o=i[1];o<=i[3];o++)if(e.cellIdx[0]===a&&e.cellIdx[1]===o){e.isUnique=!0,this.uniqueCell=!0;var s=""!==this.uniqueColl?c(this.uniqueColl):[0,0,0,0],l=c(r[n]);if(s[0]===l[0]&&s[1]===l[1]){var d=[s[0],l[1],s[0],l[1]];d[2]=s[2]>l[2]?s[2]:l[2],d[3]=s[3]>l[3]?s[3]:l[3],this.uniqueColl=m(d),e.uniqueRange=m(d)}else this.uniqueColl=r[n],e.uniqueRange=r[n]}},e.prototype.updateUniqueRange=function(e){var t=c(this.uniqueColl),r=!1;"#SPILL!"!==He(t[0],t[1],this.parent.getActiveSheet()).value&&(r=!0);for(var n=t[0];n<=t[2];n++)for(var i=t[1];i<=t[3];i++)r&&(n===t[0]&&i===t[1]?this.parent.updateCellInfo({value:"#SPILL!"},m([n,i]),!0):m([n,i]).split(":")[0]===this.editCellData.addr?this.parent.updateCellInfo({value:e},m([n,i]),!0):this.parent.updateCellInfo({value:""},m([n,i]),!0))},e.prototype.reApplyFormula=function(){var e=c(this.uniqueColl),t=He(e[0],e[1],this.parent.getActiveSheet());this.parent.updateCellInfo({value:""},m([e[0],e[1]]),!0);for(var r=this.parent.sheets,n=t.formula,i=0;i<r.length;i++)n.indexOf(r[i].name)>-1&&(n=n.replace(r[i].name,"!"+i));this.parent.notify(Kr,{action:"computeExpression",formula:n}),this.uniqueCell=!1,""!==this.uniqueActCell&&(this.editCellData.value=this.uniqueActCell,this.uniqueActCell="")},e.prototype.refreshDependentCellValue=function(e,t,r){if(e&&t&&(e--,t--,(this.editCellData.rowIndex!==e||this.editCellData.colIndex!==t)&&this.parent.activeSheetIndex===r||this.uniqueCell&&this.parent.activeSheetIndex===r)){var n=Ae(this.parent,r),i=void 0;if(tt(n,e)||ht(n,t)||(i=this.parent.getCell(e,t)),i){if(i.parentElement){var a=i.parentElement.getAttribute("aria-rowindex");if(a&&Number(a)-1!==e)return}var o=He(e,t,n),s=c(n.activeCell);s[0]===e&&s[1]===t&&(this.uniqueActCell=o.value);var l=this.getRefreshNodeArgs(o,i,e,t);this.parent.refreshNode(i,l)}}},e.prototype.getRefreshNodeArgs=function(e,t,r,n){var i={value:(e=e||{}).value,format:e.format,formattedText:e.formattedText&&""!==e.formattedText?e.formattedText:e.value,isRightAlign:!1,type:"General",cell:e,rowIndex:r,td:t,colIndex:n,refresh:!0,isEdit:!0};return this.parent.notify(Wr,i),i},e.prototype.endEdit=function(e,t,r){void 0===e&&(e=!1),e&&this.refreshEditor(this.editCellData.oldValue,!1,!0,!1,!1);var n=this.triggerEvent("beforeCellSave");if(n.cancel)return void(this.parent.isEdit&&t&&t.preventDefault());if(!this.isAltEnter&&n.value&&n.value.toString().indexOf("\n")>-1){var i=He(this.editCellData.rowIndex,this.editCellData.colIndex,this.parent.getActiveSheet());ze(this.parent.getActiveSheet().activeCell,!i||!1!==i.wrap,this.parent),this.refreshEditor(n.value,this.isCellEdit,!1,!1,!1)}this.updateEditedValue(!0,n.value,t,r)},e.prototype.cancelEdit=function(e,t,r,n){void 0===e&&(e=!0),void 0===t&&(t=!0),this.refreshEditor(this.editCellData.oldValue,e,!1,!1,!1),n||(t?this.triggerEvent("cellSave",r,void 0,!0):this.triggerEvent("cellEdited")),this.resetEditState(),this.focusElement()},e.prototype.focusElement=function(e){if(e&&9===e.keyCode&&document.activeElement.classList.contains("e-formula-bar")){var t=this.parent.element.querySelector(".e-formula-bar-panel "+(e.shiftKey?".e-insert-function":".e-combobox"));t&&or(t)}else or(this.parent.element);this.parent.notify("enableToolbarItems",[{enable:!0}])},e.prototype.triggerEvent=function(e,t,r,n){var i=this.parent.getActiveSheet(),a=He(this.editCellData.rowIndex,this.editCellData.colIndex,i),o={element:this.editCellData.element,value:r||this.editCellData.value,oldValue:this.editCellData.oldValue,address:this.editCellData.fullAddr,displayText:this.parent.getDisplayText(a),previousFormulaValue:this.editCellData.prevFormulaValue};if(o.address){var s={cellIdx:c(o.address),isUnique:!1};this.checkUniqueRange(s),s.isUnique&&(o.isSpill=this.isSpill)}var l=(o.value?o.value.toString():o.value)!==(o.oldValue||0===o.oldValue?o.oldValue.toString():o.oldValue);if(!l&&(n||!k(o.value)||a&&a.format&&"Text"===$e(a.format)))"beforeCellSave"!==e&&("cellSave"===e?this.parent.trigger("cellEdited",o):this.parent.trigger(e,o));else{if("cellSave"!==e&&(o.cancel=!1),"beforeCellSave"===e&&(this.parent.notify(qr,{eventArgs:o,action:"cellSave",preventAction:!0}),a=k(o.value)?{formula:o.value}:{value:o.value},Y(this.parent,i,{cell:a,rowIdx:this.editCellData.rowIndex,colIdx:this.editCellData.colIndex,eventOnly:!0})))return this.cancelEdit(!1,!1,null,!0),o.cancel=!0,o;this.parent.trigger(e,o),"cellSave"===e&&(this.parent.trigger("cellEdited",o),this.editCellData.formula?o.formula=this.editCellData.formula:l||(o.formula=o.value),a.format&&(o.format=a.format),o.originalEvent=t,this.parent.notify(ci,{eventArgs:o,action:"cellSave"}))}return o},e.prototype.altEnter=function(){this.positionEditor(!0);var e,t=window.getSelection(),r=t.anchorNode,n=document.createRange();0===(e=3===r.nodeType?t.anchorOffset:r.textContent.length)&&r.textContent.length>0&&(e=r.textContent.length);var i=r.textContent,a=i.slice(0,e),o=i.slice(e)||" ";r.textContent=a+"\n"+o,n=document.createRange(),3===r.nodeType?(n.setStart(r,e+1),n.setEnd(r,e+1)):1===r.nodeType&&(n.setStart(r.firstChild,e+1),n.setEnd(r.firstChild,e+1)),t.removeAllRanges(),t.addRange(n)},e.prototype.resetEditState=function(e){if(void 0===e&&(e=!0),e){var r=this.getEditElement(this.parent.getActiveSheet());(k(r.textContent)||""===r.textContent)&&this.parent.notify("clearCellRef",null),this.editCellData.element&&(this.editCellData.element.classList.remove("e-ss-edited"),this.editorElem.textContent="",r===this.editorElem?(this.editorElem.removeAttribute("style"),this.editorElem.classList.remove("e-right-align")):t.detach(r))}if(this.editCellData={},this.parent.isEdit=this.isEdit=!1,this.isCellEdit=!0,this.isAltEnter=!1,this.parent.notify("formulaOperation",{action:"endEdit"}),this.parent.showSheetTabs&&!this.parent.isProtected){var n=this.parent.element.querySelector(".e-add-sheet-tab");n&&n.removeAttribute("disabled")}},e.prototype.refSelectionRender=function(){var e=this.getEditElement(this.parent.getActiveSheet());e&&k(e.textContent)&&this.parent.notify("initiateFormulaReference",{range:e.textContent,formulaSheetIdx:this.editCellData.sheetIndex})},e.prototype.initiateRefSelection=function(){var e=this.editCellData.fullAddr.substring(0,this.editCellData.fullAddr.lastIndexOf("!")),t=this.editCellData.value;this.parent.getActiveSheet().name===e&&k(this.editCellData.value,!0)?(this.startEdit(this.editCellData.addr,t,!1),this.parent.notify("initiateFormulaReference",{range:this.editCellData.value,formulaSheetIdx:this.editCellData.sheetIndex}),this.getEditElement(this.parent.getActiveSheet()).textContent=t,this.initiateCurPosition()):this.initiateCurPosition()},e.prototype.addressHandler=function(e){var t=this.parent.serviceLocator.getService(Fa).dialogInstance;if(t&&t.element&&t.element.classList.contains("e-validation-error-dlg"))return void(e.isAlertDlgOpen=!0);if(!this.curStartPos){var r=this.getCurPosition();r.start&&(this.curStartPos=r.start),r.end&&(this.curEndPos=r.end)}var n=e.range,i=this.editCellData.sheetIndex,a=this.getEditElement(this.parent.getActiveSheet());this.parent.activeSheetIndex!==i&&(n="'"+this.parent.getActiveSheet().name+"'!"+n,e.isNameBoxSelect&&(i=this.parent.activeSheetIndex));var o=this.editCellData.value;if(e.isSelect)this.parent.notify("initiateFormulaReference",{range:o+n,formulaSheetIdx:i});else if(this.parent.activeSheetIndex===i){var s=document.activeElement.classList.contains("e-formula-bar")?document.activeElement.value:a.textContent;e.isNameBoxSelect&&(this.parent.notify("initiateFormulaReference",{range:o+n,formulaSheetIdx:i}),this.curStartPos=o.length);var l=void 0,d=void 0;e.isMouseDown&&s!==o?(l=s.substring(0,this.curEndPos)+this.parent.listSeparator,d=s.substring(this.curEndPos),this.refreshEditor(l+d,!1,!0),this.parent.notify("initiateFormulaReference",{range:a.textContent,formulaSheetIdx:i}),this.curEndPos+=this.parent.listSeparator.length,this.curStartPos=this.curEndPos,l+=n):(l=o.substring(0,this.curStartPos)+n,d=o.substring(this.curStartPos),e.isNameBoxSelect&&this.refreshEditor(l+d,!0,!0)),a.textContent=l+d,this.curEndPos=l.length}},e.prototype.updateFormulaBarValue=function(e){var t=this.editCellData.value,r=this.parent.getActiveSheet().selectedRange.split(" "),n=r[r.length-1];n=E(y(n))?n.split(":")[0]:n;var i=this.parent.element.querySelector(".e-formula-bar");if(t&&k(t,!0)){var a=this.editCellData.fullAddr.substring(0,this.editCellData.fullAddr.lastIndexOf("!")),o=this.parent.getActiveSheet().name!==a;o&&(n="'"+this.parent.getActiveSheet().name+"'!"+n);var s=void 0,l=void 0;o&&e.isMouseDown&&r.length>1&&e.formulaBarVal&&e.formulaBarVal!==t?(s=e.formulaBarVal.substring(0,this.curEndPos)+this.parent.listSeparator,l=e.formulaBarVal.substring(this.curEndPos),this.refreshEditor(s+l,!0),this.curEndPos+=this.parent.listSeparator.length,this.curStartPos=this.curEndPos,s+=n):(s=t.substring(0,this.curStartPos)+n,l=t.substring(this.curStartPos)),i.value=s+l,this.curEndPos=s.length}},e.prototype.setFormulaBarCurPosition=function(e,t,r){e.setSelectionRange&&(e.focus(),e.selectionStart=t,e.selectionEnd=t,e.setSelectionRange(t,r))},e.prototype.initiateCurPosition=function(e){void 0===e&&(e={isCellEdit:!1});var t=this.getEditElement(this.parent.getActiveSheet(),!0);if(e.isCellEdit){var r=this.getCurPosition();if(!this.endFormulaRef&&r.start===r.end){this.updateFormulaReference(t);var n=["+","-","*","/",this.parent.listSeparator,"(","=","&",":"];r.end&&-1===n.indexOf(this.editCellData.value[r.end-1])&&(this.endFormulaRef=!0)}}else{var i=t.innerText,a=window.getSelection();if(a&&a.focusNode&&a.focusNode.classList&&a.focusNode.classList.contains("e-formula-bar-panel")){var o=this.parent.element.querySelector(".e-formula-bar");return void this.setFormulaBarCurPosition(o,this.curEndPos,this.curEndPos)}if(i){var s=document.createRange();i.indexOf(")"),i.length,s.setStart(t.childNodes[0],this.curEndPos),s.setEnd(t.childNodes[0],this.curEndPos),a.removeAllRanges(),a.addRange(s)}if(this.editCellData.sheetIndex!==this.parent.activeSheetIndex){var l=this.parent.element.querySelector(".e-formula-bar");l.value&&(l.value.indexOf(")")===this.curEndPos-1?this.setFormulaBarCurPosition(l,this.curEndPos-1,this.curEndPos-1):this.setFormulaBarCurPosition(l,this.curEndPos,this.curEndPos))}}},e.prototype.getEditElement=function(e,t){if((this.isEdit||t)&&(e.frozenRows||e.frozenColumns)){var r=this.parent.frozenRowCount(e),n=this.parent.frozenColCount(e),i=u(e.activeCell),a=void 0;if(i[0]<r&&i[1]<n)a=this.parent.getSelectAllContent();else if(i[0]<r)a=this.parent.getColumnHeaderContent();else{if(!(i[1]<n))return this.editorElem;a=this.parent.getRowHeaderContent()}var o=a.getElementsByClassName("e-spreadsheet-edit")[0];return!o&&t&&(o=a.appendChild(this.editorElem.cloneNode())),o}return this.editorElem},e.prototype.sheetChangeHandler=function(){this.isEdit||(this.editCellData.value=null)},e.prototype.showFormulaAlertDlg=function(e,t){var r,n,i=this,a=this.parent.serviceLocator.getService(Na),o=this.parent.serviceLocator.getService("dialog"),s=this.getFormulaErrorKey(e),l=a.getConstant(s),d=o.dialogInstance;return d&&d.visible&&d.element.classList.contains("e-circularref-dlg")?n:(o.show({width:400,isModal:!0,showCloseIcon:!0,target:this.parent.element,cssClass:"e-validation-error-dlg e-circularref-dlg",content:l,beforeOpen:function(e){if(t){var a=i.parent.getActiveSheet(),s={dialogName:"CircularReferenceDialog",element:e.element,target:e.target,cancel:e.cancel,cellAddress:a.name+"!"+a.activeCell,content:l};if(i.parent.trigger("dialogBeforeOpen",s),s.cancel)return void(e.cancel=n=!0);s.content!==l&&(o.dialogInstance.content=s.content,o.dialogInstance.dataBind())}if(window.getSelection().rangeCount>0){var d=window.getSelection().getRangeAt(0);r=d.endOffset}},buttons:[{buttonModel:{content:a.getConstant("Ok"),isPrimary:!0},click:function(){return o.hide()}}],close:function(){if(!n){var e=i.getEditElement(i.parent.getActiveSheet());if(e.childElementCount){var t=e.textContent;r=t.length,e.textContent=t}var a=document.getSelection(),o=document.createRange();o.setStart(e.firstChild,r),o.collapse(!0),a.removeAllRanges(),a.addRange(o),e.focus()}}},!1),n)},e.prototype.getFormulaErrorKey=function(e){var t;switch(e){case"invalid arguments":t="InvalidArguments";break;case"improper formula":t="ImproperFormula";break;case"empty expression":t="EmptyExpression";break;case"mismatched parentheses":t="MismatchedParenthesis";break;case"mismatched string quotes":t="MismatchedStringQuotes";break;case"wrong number of arguments":t="WrongNumberOfArguments";break;case"requires 3 arguments":t="Requires3Arguments";break;case"#CIRCULARREF!":t="FormulaCircularRef";break;default:t="InvalidFormulaError"}return t},e.prototype.readOnlyAlertHandler=function(){var e,r=this,n=this.parent.serviceLocator.getService(Na),i=this.parent.serviceLocator.getService("dialog"),a=this.parent.element.querySelector(".e-find-dlg");t.isNullOrUndefined(a)||(e=t.getComponent(a,"dialog")),i.show({content:n.getConstant("ReadonlyAlert"),isModal:!0,closeOnEscape:!0,showCloseIcon:!0,width:"400px",cssClass:"e-readonly-alert-dlg",beforeOpen:function(e){var t={dialogName:"ReadOnlyAlertDialog",content:n.getConstant("ReadonlyAlert"),element:e.element,target:e.target,cancel:e.cancel};r.parent.trigger("dialogBeforeOpen",t),t.cancel?e.cancel=!0:(i.dialogInstance.content=t.content,or(r.parent.element))},close:function(){t.isNullOrUndefined(a)||(i.dialogInstance=e),or(r.parent.element)}})},e.prototype.finiteAlertHandler=function(){var e=this.parent.serviceLocator.getService(Na);this.parent.serviceLocator.getService("dialog").show({header:e.getConstant("Alert"),content:e.getConstant("FiniteAlert"),isModal:!0,closeOnEscape:!0,showCloseIcon:!0,width:"400px",cssClass:"e-finite-alert-dlg"})},e}(),Xa=function(){function e(e){this.invalidOperators=["%"],this.formulaRange=[],this.isNoteActiveElement=!1,this.isNoteTouch=!1,this.parent=e,this.addEventListener(),this.mouseMoveEvt=this.mouseMoveHandler.bind(this)}return e.prototype.addEventListener=function(){this.parent.on(Wn,this.init,this),this.parent.on("mouseDown",this.mouseDownHandler,this),this.parent.on("virtualContentLoaded",this.virtualContentLoadedHandler,this),this.parent.on("cellNavigate",this.cellNavigateHandler,this),this.parent.on("selectRange",this.selectRange,this),this.parent.on(ri,this.rowHeightChanged,this),this.parent.on(ni,this.colWidthChanged,this),this.parent.on("protectSelection",this.protectHandler,this),this.parent.on("initiateFormulaReference",this.initiateFormulaSelection,this),this.parent.on("clearCellRef",this.clearBorder,this),this.parent.on(Ei,this.getRowIdxFromClientY,this),this.parent.on(Ri,this.getColIdxFromClientX,this),this.parent.on("getChartRowIdxFromClientY",this.getRowIdxFromClientY,this),this.parent.on("getChartColIdxFromClientX",this.getColIdxFromClientX,this),this.parent.on("focusBorder",this.chartBorderHandler,this),this.parent.on(Li,this.isTouchSelectionStarted,this),this.parent.on("rangeSelectionByKeydown",this.selectionByKeydown,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Wn,this.init),this.parent.off("mouseDown",this.mouseDownHandler),this.parent.off("virtualContentLoaded",this.virtualContentLoadedHandler),this.parent.off("cellNavigate",this.cellNavigateHandler),this.parent.off("selectRange",this.selectRange),this.parent.off(ri,this.rowHeightChanged),this.parent.off(ni,this.colWidthChanged),this.parent.off("protectSelection",this.protectHandler),this.parent.off("initiateFormulaReference",this.initiateFormulaSelection),this.parent.off("clearCellRef",this.clearBorder),this.parent.off(Ei,this.getRowIdxFromClientY),this.parent.off(Ri,this.getColIdxFromClientX),this.parent.off("getChartRowIdxFromClientY",this.getRowIdxFromClientY),this.parent.off("getChartColIdxFromClientX",this.getColIdxFromClientX),this.parent.off("focusBorder",this.chartBorderHandler),this.parent.off(Li,this.isTouchSelectionStarted),this.parent.off("rangeSelectionByKeydown",this.selectionByKeydown))},e.prototype.isTouchSelectionStarted=function(e){e.touchSelectionStarted=this.touchSelectionStarted},e.prototype.selectionByKeydown=function(e){this.selectRangeByIdx(e.range,e.e,!1,!1,!1,!1,void 0,!1)},e.prototype.rowHeightChanged=function(e){var t=this;e.threshold&&ft(function(){if(t.parent){var r=t.parent.getActiveSheet(),n=t.getActiveCell();if(n&&(r.frozenRows||r.frozenColumns||r.selectedRange.includes(" ")))return void t.selectRange({address:r.selectedRange,isRowHeightChanged:!0});var i,a=w(c(r.selectedRange)),o={range:a,isActiveCell:!1,skipChecking:!0};if(n){var s=u(r.activeCell)[0];t.parent.notify("mergedRange",o),o.isActiveCell&&(i=He(a[0],a[1],r,!1,!0).rowSpan>1&&a[0]<=e.rowIdx&&a[2]>=e.rowIdx),s===e.rowIdx||i?n.style.height=parseFloat(n.style.height)+e.threshold+"px":s>e.rowIdx&&(n.style.top=parseFloat(n.style.top)+e.threshold+"px")}if(n=t.getSelectionElement()){if(i||a[0]===a[2]&&a[1]===a[3])return;var l=a[0],d=a[2];l<=e.rowIdx&&d>=e.rowIdx&&n?n.style.height=parseFloat(n.style.height)+e.threshold+"px":l>e.rowIdx&&n&&(n.style.top=parseFloat(n.style.top)+e.threshold+"px")}}})},e.prototype.colWidthChanged=function(e){var t=this;e.threshold&&ft(function(){if(t.parent){var r=t.parent.getActiveSheet(),n=t.getActiveCell(),i=t.parent.enableRtl;if(n&&(r.frozenRows||r.frozenColumns||r.selectedRange.includes(" ")))return void t.selectRange({address:r.selectedRange});var a,o=w(c(r.selectedRange)),s={range:o,isActiveCell:!1,skipChecking:!0};if(n){t.parent.notify("mergedRange",s);var l=u(r.activeCell)[1];if(s.isActiveCell){var d=He(o[0],o[1],r,!1,!0);a=d.rowSpan>1||d.colSpan>1}l===e.colIdx||a?n.style.width=parseFloat(n.style.width)+e.threshold+"px":l>e.colIdx&&(i?n.style.right=parseFloat(n.style.right)+e.threshold+"px":n.style.left=parseFloat(n.style.left)+e.threshold+"px")}if((n=t.getSelectionElement())&&!a&&(o[0]!==o[2]||o[1]!==o[3])){var h=o[1],p=o[3];h<=e.colIdx&&p>=e.colIdx&&n?n.style.width=parseFloat(n.style.width)+e.threshold+"px":h>e.colIdx&&n&&(i?n.style.right=parseFloat(n.style.right)+e.threshold+"px":n.style.left=parseFloat(n.style.left)+e.threshold+"px")}}})},e.prototype.selectRange=function(e){e.address="Single"===this.parent.selectionSettings.mode?m(u(e.address)):e.address,this.selectMultiRange(e.address,null,null,e.skipChecking,e.isRowHeightChanged)},e.prototype.init=function(){this.createSelectionElement();var e=this.parent.getActiveSheet(),t=w(c(e.selectedRange)),r=u(e.activeCell),n=t[0]<=r[0]&&t[2]>=r[0]&&t[1]<=r[1]&&t[3]>=r[1];this.selectMultiRange(e.selectedRange,!0,n)},e.prototype.selectMultiRange=function(e,t,r,n,i){var a=this,o=this.parent.activeSheetIndex;e.indexOf("!")>-1&&(o=Se(this.parent,Ie(e)),e=e.substring(e.lastIndexOf("!")+1)),this.parent.activeSheetIndex===o?e.split(" ").forEach(function(e,o){a.selectRangeByIdx(c(e),{type:"mousedown",ctrlKey:0!==o},null,r,t,n,void 0,!1,i)}):Re(this.parent,e,this.parent.sheets[o])},e.prototype.createSelectionElement=function(){var e=this.parent.getMainContent(),t=this.parent.createElement("div",{className:"e-selection"});e.appendChild(t),t=this.parent.createElement("div",{className:"e-active-cell"}),e.appendChild(t)},e.prototype.isMergeActiveCell=function(e,t,r,n){var i=He(r,n,e,!1,!0);if(i.rowSpan&&1!==i.rowSpan||i.colSpan&&1!==i.colSpan){var a={range:[r,n,r,n]};this.parent.notify(mn,a);var o=a.range;return o[0]===t[0]&&o[1]===t[1]}return!1},e.prototype.mouseDownHandler=function(e){var r=this;if(this.isNoteActiveElement=!t.isNullOrUndefined(document)&&!t.isNullOrUndefined(document.activeElement)&&"string"==typeof document.activeElement.className&&document.activeElement.className.indexOf("e-addNoteContainer")>-1,!(t.closest(e.target,".e-scrollbar")||e.target.classList.contains("e-main-panel")||e.target.classList.contains("e-sheet"))){var n={action:"getCurrentEditValue",editedValue:""},i=this.parent.getActiveSheet();this.parent.notify(Yn,n);var a=k(n.editedValue,!0),o=this.parent.enableNotes&&!t.isNullOrUndefined(this.parent.spreadsheetNoteModule.noteCellIndexes)?this.parent.spreadsheetNoteModule.noteCellIndexes:u(this.parent.getActiveSheet().activeCell),s=this.parent.getCell(o[0],o[1]);if(!t.isNullOrUndefined(s)&&null!==s.children&&s.children.length>0&&this.isNoteActiveElement&&s.children[s.children.length-1].classList.contains("e-addNoteIndicator")){var l=He(o[0],o[1],i),d=!t.isNullOrUndefined(l)&&l.notes?"editNote":"addNote",h=document.getElementsByClassName("e-addNoteContainer")[0],p=Le(this.parent,this.parent.activeSheetIndex)+"!"+m(o);if(t.isNullOrUndefined(h)||t.isNullOrUndefined(h.value)||"e-addNoteContainer"===e.target.className||!t.isNullOrUndefined(l)&&!t.isNullOrUndefined(l.notes)&&l.notes===h.value)"e-addNoteContainer"!==e.target.className&&Y(this.parent,this.parent.getActiveSheet(),{rowIdx:o[0],colIdx:o[1],preventEvt:!0,cell:{isNoteEditable:!1}});else{this.parent.notify("setActionData",{args:{action:"beforeCellSave",eventArgs:{address:p}}}),Y(this.parent,this.parent.getActiveSheet(),{rowIdx:o[0],colIdx:o[1],preventEvt:!0,cell:{notes:h.value,isNoteEditable:!1}});var f={notes:h.value,address:p};this.parent.notify(ci,{eventArgs:f,action:d})}this.parent.spreadsheetNoteModule.isShowNote=null}if(!this.isNoteTouch&&"e-addNoteContainer"!==e.target.className&&document.getElementsByClassName("e-addNoteContainer")&&document.getElementsByClassName("e-addNoteContainer").length>0&&this.parent.notify("removeNoteContainer",""),this.isNoteTouch&&e.type.indexOf("mouse")>-1&&(this.isNoteTouch=!1),!this.parent.isEdit||a){var g=document.getElementById(this.parent.element.id+"_overlay");if("string"==typeof e.target.className){if(e.target.className.indexOf("e-ss-overlay")>-1)return}else g&&g.classList.remove("e-ss-overlay-active");if(t.closest(e.target,".e-datavisualization-chart"))return;if(i.isProtected&&!i.protectSettings.selectCells&&!i.protectSettings.selectUnLockedCells)return;if(!t.closest(e.target,".e-findtool-dlg")&&!t.closest(e.target,".e-dragfill-ddb")&&this.getSheetElement().contains(e.target)&&!e.target.classList.contains("e-colresize")&&!e.target.classList.contains("e-rowresize")){var v=this.parent.getActiveSheet(),C=this.parent.selectionSettings.mode,b=Mt(e),x=Bt(e),S=this.getRowIdxFromClientY({clientY:x,target:e.target}),w=this.getColIdxFromClientX({clientX:b,target:e.target}),I=u(v.activeCell),R=void 0,N=void 0;if(v.showHeaders){var F=e.target;if(v.frozenColumns||v.frozenRows){var A=this.parent.getSelectAllContent().querySelector("thead");N=A?(this.parent.getColumnHeaderContent().contains(F)||A.contains(F))&&F.classList.contains("e-header-cell")||F.classList.contains("e-selectall-table")&&S<0&&w>=this.parent.frozenColCount(v):this.parent.getColumnHeaderContent().contains(F)&&F.classList.contains("e-header-cell"),R=(A=this.parent.getSelectAllContent().querySelector("tbody"))?(this.parent.getRowHeaderContent().contains(F)||A.contains(F))&&F.classList.contains("e-header-cell")||F.classList.contains("e-selectall-table")&&w<0&&S>=this.parent.frozenRowCount(v):this.parent.getRowHeaderContent().contains(F)&&F.classList.contains("e-header-cell"),-1===S&&(S=0),-1===w&&(w=0)}else R=this.parent.getRowHeaderContent().contains(e.target),N=this.parent.getColumnHeaderContent().contains(e.target)}if((v.frozenRows||v.frozenColumns)&&!N&&!R){var O=e.target,T=["e-rowhdr-table","e-selectall-table","e-colhdr-table"].findIndex(function(e){return O.classList.contains(e)});if(T>-1){var D=[".e-row-header",".e-selectall-container",".e-column-header"][T],L=t.closest(O,D);if(L&&L.style.zIndex&&((l=He(S,w,v))&&l.validation&&"List"===l.validation.type||pt(v.columns[w],S,w)&&"List"===v.columns[w].validation.type)){var P=this.parent.getCell(S,w);if(P){var M=P.querySelector(".e-validation-list");if(M){var B=M.getBoundingClientRect();if(b>=B.left&&b<=B.right&&x>=B.top&&x<=B.bottom){var H=M.querySelector(".e-dropdownlist");if(H){var U=t.getComponent(H,"dropdownlist");U&&U.showPopup()}}}}}}}if(3===e.which&&this.isSelected(S,w))return;if(e.target.classList.contains("e-autofill")){this.isautoFillClicked=!0;var V=e.target.parentElement.querySelector(".e-dragfill-ddb");V&&!V.classList.contains("e-hide")||(this.dAutoFillCell=v.selectedRange)}var z=c(v.topLeftCell),j=void 0;if(R?(this.isRowSelected=!0,e.shiftKey&&"Single"!==C?this.startCell||(this.startCell=[z[0],0]):this.startCell=[S,0],j=[this.startCell[0],v.frozenColumns?z[1]:0,S,v.colCount-1]):N?(this.isColSelected=!0,e.shiftKey&&"Single"!==C?this.startCell||(this.startCell=[0,z[1]]):this.startCell=[0,w],j=[v.frozenRows?z[0]:0,this.startCell[1],v.rowCount-1,w]):t.closest(e.target,".e-select-all-cell")?(this.startCell=[v.frozenRows?z[0]:0,v.frozenColumns?z[1]:0],j=[].concat(this.startCell,[v.rowCount-1,v.colCount-1])):e.target.classList.contains("e-sheet-content")||(e.shiftKey&&"Single"!==C||(this.startCell=[S,w]),this.isautoFillClicked||t.closest(e.target,".e-filloption")||(j=[].concat(this.startCell?this.startCell:u(v.activeCell),[S,w]))),At(e)&&!R&&!N&&j){var _=this.isRowColSelected(j);this.isRowSelected=_.isRowSelected,this.isColSelected=_.isColSelected}var q=e.ctrlKey&&j&&v.selectedRange.includes(m(j));if(!q&&"Multiple"===C&&(!Ot(e)&&(!At(e)||At(e)&&(I[0]===S&&I[1]===w||this.isMergeActiveCell(v,I,S,w)))||N||R)?(document.addEventListener(Nt().split(" ")[0],this.mouseMoveEvt),t.Browser.isPointer||(t.Browser.isIos&&At(e)&&e.target&&e.target.classList.contains("e-cell")&&e.preventDefault(),document.addEventListener(Nt().split(" ")[1],this.mouseMoveEvt,{passive:!1})),this.touchSelectionStarted=!0):this.touchSelectionStarted=!1,!Ot(e))if(q){if(this.parent.isEdit){var W=function(e){t.EventHandler.remove(document,Ft(),W),r.updateFormulaCursorPosition(e)};t.EventHandler.add(document,Ft(),W,this)}}else t.EventHandler.add(document,Ft(),this.mouseUpHandler,this);var G="e-addNoteIndicator"===e.target.className||e.target.children.length>0&&e.target.children[e.target.childElementCount-1].className.indexOf("e-addNoteIndicator")>-1;if(At(e)&&G){var X=u(m(j).split(":")[0]);this.parent.notify("showNote",{rowIndex:X[0],columnIndex:X[1],isNoteEditable:!1}),this.isNoteTouch=!0,this.parent.spreadsheetNoteModule.isNoteVisibleOnTouch=!0}if(At(e)&&!N&&!R)return void(this.touchEvt=e);if(j&&this.selectRangeByIdx(j,e),!this.isNoteTouch&&e.type.indexOf("mouse")>-1&&G){var K=u(m(j).split(":")[0]);this.parent.notify("showNote",{rowIndex:K[0],columnIndex:K[1],isNoteEditable:!1}),this.parent.spreadsheetNoteModule.isNoteVisible=!0}this.parent.isMobileView()&&(this.parent.element.classList.add("e-mobile-focused"),this.parent.renderModule.setSheetPanelSize())}}if(a&&(e.target.classList.contains("e-cell")||e.target.classList.contains("e-wrap-content")||e.target.classList.contains("e-header-cell"))&&this.parent.isEdit){var $=(j=this.parent.getActiveSheet().selectedRange).split(" ");j=E(y($[$.length-1]))?$[$.length-1].split(":")[0]:$[$.length-1],this.parent.notify("addressHandle",{range:j,isSelect:!1,isMouseDown:e.ctrlKey})}}},e.prototype.mouseMoveHandler=function(e){var r=this,n=this.parent.getActiveSheet();kt(e)&&e.preventDefault();var i={action:"getCurrentEditValue",editedValue:""};this.parent.notify(Yn,i);var a,o,s=k(i.editedValue,!0),l=this.parent.getMainContent().parentElement,d=this.parent.element.getElementsByClassName("e-scroller")[0],h=l.getBoundingClientRect(),p=this.parent.frozenColCount(n),f=h.left+this.parent.sheetModule.getRowHeaderWidth(n,!1,!0),g=h.right-vt(),v=h.top,y=h.bottom,C=Mt(e),b=Bt(e),x=this.isRowSelected?n.colCount-1:this.getColIdxFromClientX({clientX:C,target:e.target}),S=this.isColSelected?n.rowCount-1:this.getRowIdxFromClientY({clientY:b,target:e.target});if(e.ctrlKey){var w=n.selectedRange.split(" ");a=c(w[w.length-1])}else a=c(n.selectedRange);if(t.Browser.isDevice){var I=screen.availWidth;g>=I-40&&(g-=40-(I-g)),!n.showHeaders&&f<40&&(f+=40-f)}var E={range:[S,x,S,x]};if(this.parent.notify(mn,E),!(E.range[2]===a[2]&&E.range[3]===a[3]&&b<=y&&b>=v&&C<=g&&C>=f)){var R=this.parent.frozenRowCount(n);s||this.isColSelected||this.isRowSelected||(a=u(n.activeCell));var N=b>y&&!this.isColSelected&&S<n.rowCount,F=b<v&&S>=0&&!this.isColSelected&&!!l.scrollTop&&(!R||a[0]>=R),A=C>g&&!this.isRowSelected&&x<n.colCount,O=C<f&&x>=0&&!this.isRowSelected&&!!d.scrollLeft&&(!p||a[1]>=p);this.clearInterval();var T,D;if(N||F||A||O){(F||O)&&(T=S,D=x);var L=function(){if(N||F){if((S=r.getRowIdxFromClientY({clientY:N?y:v}))>=n.rowCount)return void r.clearInterval();l.scrollTop+=(N?1:-1)*nt(n,S)}if(A||O){if((x=r.getColIdxFromClientX({clientX:A?g:f,isFScroll:!0}))>=n.colCount)return void r.clearInterval();d.scrollLeft+=(A?1:-1)*lt(n,x)}if(F&&n.frozenRows&&!l.scrollTop||O&&n.frozenColumns&&!d.scrollLeft)return r.selectRangeByIdx([].concat(a[0],a[1],[T,D]),e),void r.clearInterval();r.selectRangeByIdx([].concat(a[0],a[1],[S,x]),e)};L(),this.scrollInterval=setInterval(function(){L(),r.clearInterval(),r.scrollInterval=setInterval(L,100)})}else{var P=[].concat(a[0],a[1],[S,x]);if(R&&P[0]<R&&P[2]>=R&&l.scrollTop&&(l.scrollTop=0,P[2]=R),p&&P[1]<p&&P[3]>=p&&d.scrollLeft&&(d.scrollLeft=0,P[3]=p),this.isautoFillClicked){e.target.classList.contains("e-autofill")&&(this.dAutoFillCell=n.selectedRange);var M={e:e,indexes:null};this.parent.notify("selectAutoFillRange",M),o=P=M.indexes}this.selectRangeByIdx(P,e)}if(s&&this.parent.isEdit&&!t.closest(e.target,"#"+this.parent.element.id+"_edit")){var B=void 0,H=(B=this.isautoFillClicked?m(o):this.parent.getActiveSheet().selectedRange).split(" ");this.parent.notify("addressHandle",{range:H[H.length-1],isSelect:!1})}}},e.prototype.mouseUpHandler=function(e){var r=this.getRowIdxFromClientY({clientY:Bt(e),target:e.target}),n=this.getColIdxFromClientX({clientX:Mt(e),target:e.target});this.clearInterval(),!Ot(e)||this.isColSelected||this.isRowSelected||this.getRowIdxFromClientY({clientY:Bt(this.touchEvt),target:e.target})!==r||this.getColIdxFromClientX({clientX:Mt(this.touchEvt),target:e.target})!==n||this.mouseDownHandler(e),document.removeEventListener(Nt().split(" ")[0],this.mouseMoveEvt),t.Browser.isPointer||document.removeEventListener(Nt().split(" ")[1],this.mouseMoveEvt),t.EventHandler.remove(document,Ft(),this.mouseUpHandler);var i=this.parent.getActiveSheet();if((i.frozenRows||i.frozenColumns)&&wt(this.parent.element,null,"e-cur-selection",!0,!0),this.parent.notify("mouseUpAfterSelection",e),this.isautoFillClicked){var a=this.parent.getActiveSheet(),o=c(a.selectedRange);if(!(this.isColSelected&&o[1]===n||this.isRowSelected&&o[0]===r)){var s=e.target.parentElement.querySelector(".e-dragfill-ddb");s&&!s.classList.contains("e-hide")||(this.dAutoFillCell=a.selectedRange),this.parent.notify("performAutoFill",{event:e,dAutoFillCell:this.dAutoFillCell})}this.isautoFillClicked=!1}else e.ctrlKey||lr(Ne(this.parent.getActiveSheet()))?this.parent.notify("hideAutoFillElement",null):this.parent.notify("positionAutoFillElement",null);this.updateFormulaCursorPosition(e)},e.prototype.updateFormulaCursorPosition=function(e){if(this.parent.isEdit){var t={action:"getCurrentEditValue",editedValue:""};this.parent.notify(Yn,t),k(t.editedValue,!0)&&this.parent.notify("initiateCur",{isCellEdit:e.target.classList.contains("e-spreadsheet-edit")})}},e.prototype.isSelected=function(e,t){for(var r,n=!1,i=this.parent.getActiveSheet().selectedRange.split(" "),a=0;a<i.length;a++)if((r=w(c(i[a])))[0]<=e&&e<=r[2]&&r[1]<=t&&t<=r[3]){n=!0;break}return n},e.prototype.virtualContentLoadedHandler=function(e){var t,r,n,i=this,a=this.parent.getActiveSheet();a.selectedRange.split(" ").forEach(function(o,s){if(t=c(o),n=0===t[1]&&t[3]===e.prevRowColCnt.colCount-1,r=0===t[0]&&t[2]===e.prevRowColCnt.rowCount-1,n||r)t=r&&n?[0,0,a.rowCount-1,a.colCount-1]:r?[0,t[1],a.rowCount-1,t[3]]:[t[0],0,t[2],a.colCount-1],a.frozenRows||a.frozenColumns?i.selectRangeByIdx(t,{type:"mousedown",ctrlKey:0!==s},!1,!1,!1,!1,void 0,!0):i.selectRangeByIdx(t,null,!0,null,null,null,s);else{t=c(o);var l=i.parent.viewport.topIndex+i.parent.frozenRowCount(a),d=i.parent.viewport.leftIndex+i.parent.frozenColCount(a);i.highlightHdr(t,0!==s,t[0]>=l||t[2]>=l,t[1]>=d||t[3]>=d)}})},e.prototype.clearInterval=function(){this.scrollInterval&&(clearInterval(this.scrollInterval),this.scrollInterval=null)},e.prototype.getScrollLeft=function(){return this.parent.scrollModule?this.parent.scrollModule.prevScroll.scrollLeft:0},e.prototype.cellNavigateHandler=function(e){var t=this.parent.getActiveSheet();(!t.isProtected||t.protectSettings.selectCells||t.protectSettings.selectUnLockedCells)&&(e.type="mousedown",this.selectRangeByIdx(e.range,e,!1,!1,!1,!1,void 0,e.preventAnimation))},e.prototype.getColIdxFromClientX=function(e){var r=this,n=0,i=this.parent.getActiveSheet(),a=0;if(e.isImage)a=e.clientX;else{var o=document.getElementById(this.parent.element.id+"_sheet").getBoundingClientRect();a=this.parent.enableRtl?o.right-this.parent.sheetModule.getRowHeaderWidth(i,!0,!0)-1-e.clientX:e.clientX-(o.left+this.parent.sheetModule.getRowHeaderWidth(i,!0,!0)+1),a+=this.parent.viewport.beforeFreezeWidth;if(e.target&&(t.closest(e.target,".e-row-header")||t.closest(e.target,".e-selectall-container"))&&!this.isScrollableArea(e.clientX,e.target,!0)||!(!this.parent.frozenColCount(i)||a>function(){var e=r.parent.element.querySelector(".e-frozen-column");return parseInt(e.style[r.parent.enableRtl?"right":"left"],10)/r.parent.viewport.scaleX}()||e.isFScroll)||(a+=this.getScrollLeft()/this.parent.viewport.scaleX),i.frozenRows&&a<0&&i.showHeaders)return-1}for(var s,l=0;;l++)if(s=n+=lt(i,l,null,!e.isImage)/this.parent.viewport.scaleX,a<(e.isImage?Number(ur(s).toFixed(2)):s)||this.parent.scrollSettings.isFinite&&l===i.colCount-1)return e.isImage||(e.size=a),e.clientX=l,l},e.prototype.isScrollableArea=function(e,t,r){return!!t.classList.contains("e-table")&&(r?e>this.parent.getMainContent().getBoundingClientRect().left:e>this.parent.getMainContent().parentElement.getBoundingClientRect().top)},e.prototype.getRowIdxFromClientY=function(e){var r=0,n=this.parent.getActiveSheet(),i=0;if(e.isImage)i=e.clientY;else{var a=document.getElementById(this.parent.element.id+"_sheet");if(i=e.clientY+this.parent.viewport.beforeFreezeHeight-(a.getBoundingClientRect().top+(n.showHeaders?31/this.parent.viewport.scaleY:0)),e.target&&t.closest(e.target,".e-header-panel")&&!this.isScrollableArea(e.clientY,e.target)||(i+=this.parent.getMainContent().parentElement.scrollTop/this.parent.viewport.scaleY),n.frozenColumns&&i<0&&n.showHeaders)return-1}for(var o,s=0;;s++)if(o=r+=nt(n,s,!e.isImage)/this.parent.viewport.scaleY,i<(e.isImage?Number(ur(o).toFixed(2)):o)||this.parent.scrollSettings.isFinite&&s===n.rowCount-1)return e.isImage||(e.size=i),e.clientY=s,s},e.prototype.initFormulaReferenceIndicator=function(e){if(this.parent.isEdit){var t=this.parent.createElement("div",{className:"e-formularef-indicator"});t.appendChild(this.parent.createElement("div",{className:"e-top"})),t.appendChild(this.parent.createElement("div",{className:"e-bottom"})),t.appendChild(this.parent.createElement("div",{className:"e-left"})),t.appendChild(this.parent.createElement("div",{className:"e-right"})),this.parent.getMainContent().appendChild(t),St(this.parent,t,e,"e-formularef-indicator")}},e.prototype.isMouseEvent=function(e){return Tt(e)||Lt(e)||Dt(e)},e.prototype.selectRangeByIdx=function(e,r,n,i,a,o,s,l,d){var h=this,p=r&&this.isMouseEvent(r);if(!(r&&r.target&&p&&t.closest(r.target,"#"+this.parent.element.id+"_edit"))){var u={action:"getCurrentEditValue",editedValue:"",endFormulaRef:!1};this.parent.notify(Yn,u);var f,g=!!this.parent.isEdit&&k(u.editedValue,!0)&&!u.endFormulaRef,v=r&&r.ctrlKey&&Tt(r);v||(f=this.getSelectionElement(r,s));var y,C=this.parent.getActiveSheet(),b=c(C.topLeftCell),x=this.parent.element.querySelector(".e-formularef-indicator"),S={range:[].slice.call(e),isActiveCell:!1,skipChecking:o},w=this.isRowColSelected(e);w.isColSelected||w.isRowSelected||this.parent.notify("mergedRange",S),e!==S.range&&(y=!0),e=S.range;var I=new Promise(function(e){e(void 0)}),R={range:m(e),cancel:!1};if(C.isProtected){var N=He(e[2],e[3],C);if(C.protectSettings.selectUnLockedCells&&!C.protectSettings.selectCells)if(t.isNullOrUndefined(N)){if(!C.protectSettings.selectCells)return}else{if(!0===N.isLocked||t.isNullOrUndefined(N.isLocked))return;var F=this.parent.element.getElementsByClassName("e-sheet-panel")[0];F&&F.classList.contains("e-protected")&&F.classList.remove("e-protected")}}if(this.parent.trigger("beforeSelect",R),!R.cancel){if(g&&x&&x.parentElement.removeChild(x),d||this.parent.notify("hideAutoFillOptions",null),!E(e)&&!S.isActiveCell||v){if(v)if(void 0===s){var A=m(e);if(C.selectedRange.includes(A)&&!g)return(M=C.selectedRange.split(" ")).length>1?(M.splice(M.indexOf(A),1),A=M.join(" ")):A=C.activeCell+":"+C.activeCell,void this.selectRange({address:A});f=this.getSelectionElement(r,s)}else f=this.getSelectionElement(r,s);if(g&&this.parent.isEdit){if(r&&r.target&&(!p||!r.target.classList.contains("e-spreadsheet-edit"))&&this.parent.isEdit){D={range:m(e),isSelect:!0};if(this.parent.notify("addressHandle",D),D.isAlertDlgOpen)return;this.initFormulaReferenceIndicator(e)}}else{T=void 0;f&&(f.classList.remove("e-hide"),(C.frozenRows||C.frozenColumns)&&((r&&r.target||v)&&(T="e-cur-selection",Dt(r)&&f.classList.contains("e-cur-selection")?f.classList.add("e-hide"):f.classList.add(T)),!v&&(this.isColSelected||this.isRowSelected)&&Tt(r)&&(wt(this.parent.getSelectAllContent(),null,"e-selection"),wt(this.parent.getColumnHeaderContent(),null,"e-selection"),wt(this.parent.getRowHeaderContent(),null,"e-selection"))));var O=this.isColSelected&&this.isRowSelected?void 0:this.getOffset(e[2],e[3]);y&&O&&(O.left={idx:0,size:0}),I=St(this.parent,f,e,T,l,v,v&&!r.target)||I}}else{if(f&&(f.classList.contains("e-multi-range")||f.classList.add("e-hide"),C.frozenRows||C.frozenColumns)){var T=Dt(r)?"e-cur-selection":"e-selection";wt(this.parent.getSelectAllContent(),null,T,!0),wt(this.parent.getColumnHeaderContent(),null,T,!0),wt(this.parent.getRowHeaderContent(),null,T,!0)}if(C.frozenColumns||C.frozenRows||!f||St(this.parent,f,e),g&&r&&r.target&&(!p||!r.target.classList.contains("e-spreadsheet-edit"))&&this.parent.isEdit){var D={range:m(e).split(":")[0],isSelect:!0};if(this.parent.notify("addressHandle",D),D.isAlertDlgOpen)return;this.initFormulaReferenceIndicator(e)}}var L={action:"getCurrentEditSheetIdx",sheetIndex:null};this.parent.notify(Yn,L),C.frozenColumns&&e[1]>0&&e[1]===b[1]&&e[3]===C.colCount-1&&(e[1]=0),C.frozenRows&&e[0]>0&&e[0]===b[0]&&e[2]===C.rowCount-1&&(e[0]=0);var P=m(e);if(r&&r.ctrlKey&&(Dt(r)||Lt(r))&&!g)P=C.selectedRange.slice(0,C.selectedRange.lastIndexOf(" "))+" "+P;else if(s>-1){var M=C.selectedRange.split(" ");M[s]=P,P=M.join(" ")}if(g||this.isautoFillClicked)a||this.isautoFillClicked||Re(this.parent,P,C,v);else{var B=!1;C.selectedRange!==P&&(B=!0),Re(this.parent,P,C,v),B&&I.then(function(){h.parent&&h.parent.trigger("select",{range:h.parent.getActiveSheet().selectedRange})})}w=this.isRowColSelected(e),this.isRowSelected=w.isRowSelected,this.isColSelected=w.isColSelected,this.highlightHdr(e,r&&r.ctrlKey),n||r&&("mousemove"===r.type||kt(r))||(g?L.sheetIndex===this.parent.getActiveSheet().id-1&&a?(i=!0,this.updateActiveCell(i?c(C.activeCell):e,a,l)):this.parent.isEdit||this.updateActiveCell(i?c(C.activeCell):e,a,l):this.updateActiveCell(i?c(C.activeCell):e,a,l)),t.isNullOrUndefined(r)&&(r={type:"mousedown"}),g?a||this.parent.notify("selectionComplete",r):this.parent.notify("selectionComplete",r),v||lr(Ne(this.parent.getActiveSheet()))?this.parent.notify("hideAutoFillElement",null):this.parent.notify("positionAutoFillElement",{preventAnimation:l}),this.parent.showAggregate&&this.parent.notify("showAggregate",{}),this.parent.notify(wi,null)}}},e.prototype.isRowColSelected=function(e){var t=this.parent.getActiveSheet();return{isRowSelected:0===e[1]&&e[3]===t.colCount-1,isColSelected:0===e[0]&&e[2]===t.rowCount-1}},e.prototype.updateActiveCell=function(e,t,r){var n,i,a,o=this.parent.getActiveSheet(),s=c(o.topLeftCell);this.isColSelected?(n=s[0],i=e[1],this.isRowSelected&&(i=s[1])):(n=e[0],i=e[1],this.isRowSelected&&(i=s[1]));var l={range:[n,i].concat([n,i])};if(this.parent.notify(mn,l),e!==l.range&&(a=!0),e=l.range,o.activeCell!==g(e[0],e[1])||t){if(this.previousActiveCell=o.activeCell.indexOf(":")>-1?this.previousActiveCell:o.activeCell,this.parent.setSheetPropertyOnMute(o,"activeCell",g(e[0],e[1])),o.isProtected){var d=this.parent.element.querySelector(".e-formula-bar"),h=U(He(e[0],e[1],o),ot(o,e[1]));h&&d&&!d.disabled?d.disabled=!0:!h&&d&&d.disabled&&(d.disabled=!1)}if(this.getActiveCell()){var p=this.getOffset(e[2],e[3]);a&&(p.left={idx:0,size:0}),St(this.parent,this.getActiveCell(),e,"e-active-cell",r)}this.parent.notify("activeCellChanged",null)}else St(this.parent,this.getActiveCell(),e,"e-active-cell",r)},e.prototype.getOffset=function(e,t){var r={left:{idx:0,size:0},top:{idx:0,size:0}};return this.parent.scrollModule&&(t>=this.parent.scrollModule.offset.left.idx&&(r.left=this.parent.scrollModule.offset.left),e>=this.parent.scrollModule.offset.top.idx&&(r.top=this.parent.scrollModule.offset.top)),r},e.prototype.getSelectionElement=function(e,r){var n=this.parent.getActiveSheet();if(e&&e.ctrlKey&&!this.parent.isEdit){if(Lt(e)||Dt(e))return n.frozenColumns||n.frozenRows?(a=this.parent.getMainContent().querySelector(".e-cur-selection"))||(a=this.parent.element.querySelector(".e-multi-range"))&&a.cloneNode():this.parent.getMainContent().querySelector(".e-selection:last-child");var i=this.parent.getMainContent().getElementsByClassName("e-selection")[0],a=i.cloneNode();return a.classList.add("e-multi-range"),n.frozenColumns||n.frozenRows?(n.selectedRange.includes(" ")||(i.classList.remove("e-hide"),St(this.parent,i,w(c(n.selectedRange)),void 0,!1,!0)),!this.parent.getMainContent().querySelector(".e-multi-range")&&i.classList.contains("e-hide")?i:a):(i.classList.remove("e-hide"),this.parent.getMainContent().appendChild(a))}return r>-1?n.frozenRows||n.frozenColumns?this.parent.element.querySelector(".e-sheet").getElementsByClassName("e-selection")[r]:this.parent.getMainContent().getElementsByClassName("e-selection")[r]:([].slice.call(this.parent.element.getElementsByClassName("e-multi-range")).forEach(function(e){t.remove(e)}),this.parent.getMainContent().getElementsByClassName("e-selection")[0])},e.prototype.getActiveCell=function(){return this.parent.getMainContent().getElementsByClassName("e-active-cell")[0]},e.prototype.getSheetElement=function(){return document.getElementById(this.parent.element.id+"_sheet")},e.prototype.highlightHdr=function(e,r,n,i){var a=this;void 0===n&&(n=!0),void 0===i&&(i=!0);var o=this.parent.getActiveSheet();if(o.showHeaders){r||(t.removeClass(this.getSheetElement().querySelectorAll(".e-highlight"),"e-highlight"),t.removeClass(this.getSheetElement().querySelectorAll(".e-prev-highlight"),"e-prev-highlight"));var s=this.parent.element.getElementsByClassName("e-select-all-cell")[0];s&&t.removeClass([s],["e-prev-highlight-right","e-prev-highlight-bottom"]);var l=[],d=[],h=w(e);this.isRowSelected&&(h[1]=j(o,h[1],!0,"columns")),this.isColSelected&&(h[0]=j(o,h[0],!0));var p,c,f=[0,0,0,0],g=[0,0,0,0],m=u(o.topLeftCell),v=function(e,t,r){var n,i;if(e&&h[p]<e)m[p]=j(o,m[p],!0,t),(s=j(o,h[p],!0,t))===m[p]&&(h[p]=s),i=a.parent.hiddenCount(m[p],h[p]-1,t,o),f[p]=h[p]-i-m[p],n=h[c]<e?h[c]:e-1,f[c]=n-a.parent.hiddenCount(h[p],n,t,o)-i-m[p]+1,n=a.parent.viewport[""+r]+e,h[c]>=n&&(g[p]=0,g[p]-=a.parent.hiddenCount(n,n,t,o),g[c]=h[c]-a.parent.hiddenCount(n,h[c],t,o)-n+1);else{n=j(o,a.parent.viewport[""+r]+e,!0,t);var s=j(o,h[p],!0,t);n===s&&(h[p]=n),i=a.parent.hiddenCount(n,h[p]-1,t,o),g[p]=h[p]-i-n,g[c]=h[c]-a.parent.hiddenCount(h[p],h[c],t,o)-i-n+1}},y=function(e,t,r){for(var n=[].slice.call(t.getElementsByClassName("e-header-cell")),i=e[p];i<e[c];i++)n[i]&&r.push(n[i])};if(n){if(p=0,c=2,v(this.parent.frozenRowCount(o),"rows","topIndex"),o.frozenRows){var C=this.parent.getSelectAllContent().querySelector("tbody");C&&y(f,C,l)}y(g,this.parent.getRowHeaderContent(),l)}if(i){if(p=1,c=3,v(this.parent.frozenColCount(o),"columns","leftIndex"),o.frozenColumns){var b=this.parent.getSelectAllContent().querySelector("thead");b&&y(f,b,d)}y(g,this.parent.getColumnHeaderContent(),d)}o.isProtected&&!o.protectSettings.selectCells?t.removeClass([].concat(l,d),"e-highlight"):t.addClass([].concat(l,d),"e-highlight"),l.length&&l[0].parentElement.previousElementSibling&&l[0].parentElement.previousElementSibling.classList.add("e-prev-highlight"),d.length&&d[0].previousElementSibling&&d[0].previousElementSibling.classList.add("e-prev-highlight"),this.isRowSelected&&this.isColSelected&&(o.isProtected&&!o.protectSettings.selectCells?document.getElementById(this.parent.element.id+"_select_all").classList.remove("e-highlight"):document.getElementById(this.parent.element.id+"_select_all").classList.add("e-highlight")),s&&(j(o,h[0],!0)===j(o,0,!0)&&s.classList.add("e-prev-highlight-bottom"),j(o,h[1],!0,"columns")===j(o,0,!0,"columns")&&s.classList.add("e-prev-highlight-right"))}},e.prototype.protectHandler=function(){var e=c(this.parent.getActiveSheet().selectedRange),t=w(e),r=u(this.parent.getActiveSheet().activeCell),n=t[0]<=r[0]&&t[2]>=r[0]&&t[1]<=r[1]&&t[3]>=r[1];this.selectRangeByIdx(e,null,null,n)},e.prototype.initiateFormulaSelection=function(e){this.processFormulaEditRange(e.range,e.formulaSheetIdx)},e.prototype.processFormulaEditRange=function(e,t){var r,n=t,i=0,a={formula:e};this.parent.notify("parseFormulaArgument",a);var o=a.formulaArr,s=o.length,l=0,d=[["e-vborderright","e-vborderbottom"],["e-pborderright","e-pborderbottom"],["e-cborderright","e-cborderbottom"],["e-gborderright","e-gborderbottom"],["e-oborderright","e-oborderbottom"],["e-bborderright","e-bborderbottom"]];this.clearBorder();for(var h=this.parent.getActiveSheet().id-1;i<s&&(r=o[i],!(this.invalidOperators.indexOf(r)>-1));){if(O(r.toUpperCase())){if(r=r.replace(/\$/g,""),i>0&&o[i-1].lastIndexOf("!")===o[i-1].length-1){var p=o[i-1].substring(1,o[i-1].lastIndexOf("!")-1);n=p?Se(this.parent,p):n}":"===o[i+1]&&o[++i+1]&&O(o[i+1].toUpperCase())&&(r=r+":"+o[i+1],i++),h===n&&this.updateFormulaEditRange(r,l,d),n=t,l++}i++}},e.prototype.updateFormulaEditRange=function(e,t,r){var n=c(e);this.formulaRange[t]=e,this.dStartCell={rowIndex:n[0],colIndex:n[1]},this.dEndCell={rowIndex:n[2],colIndex:n[3]},this.focusBorder(this.dStartCell,this.dEndCell,r[t%6])},e.prototype.chartBorderHandler=function(e){this.focusBorder(e.startcell,e.endcell,e.classes,!0)},e.prototype.focusBorder=function(e,r,n,i){i=!t.isNullOrUndefined(i)&&i;var a=this.parent.getActiveSheet(),o=w([e.rowIndex,e.colIndex,r.rowIndex,r.colIndex]),s=c(a.topLeftCell),l=this.parent.hiddenCount(s[1],o[3]-1,"columns",a);if(i&&l>0&&(o[1]-=l,o[3]-=l),a.frozenRows||a.frozenColumns){var d=this.parent.createElement("div",{className:i?"e-range-indicator e-chart-range":"e-range-indicator e-formuala-range"});return d.appendChild(this.parent.createElement("div",{className:"e-top"})),d.appendChild(this.parent.createElement("div",{className:"e-bottom"})),d.appendChild(this.parent.createElement("div",{className:"e-left"})),d.appendChild(this.parent.createElement("div",{className:"e-right"})),void St(this.parent,d,o,"e-range-indicator")}var h=o[0],p=o[1],u=o[2],f=o[3];h&&this.getEleFromRange([h-1,p,h-1,f]).forEach(function(e){e&&(e.classList.add(n[1]),i||e.classList.add("e-formularef-selection"))}),this.getEleFromRange([h,f,u,f]).forEach(function(e){e&&(e.classList.add(n[0]),i||e.classList.add("e-formularef-selection"))}),this.getEleFromRange([u,p,u,f]).forEach(function(e){e&&(e.classList.add(n[1]),i||e.classList.add("e-formularef-selection"))}),p&&this.getEleFromRange([h,p-1,u,p-1]).forEach(function(e){e&&(e.classList.add(n[0]),i||e.classList.add("e-formularef-selection"))})},e.prototype.getEleFromRange=function(e){var t,r,n,i,a=e[0],o=e[1],s=e[2],l=e[3],d=[],h=[];if(a>s&&(n=a,a=s,s=n),o>l&&(n=o,o=l,l=n),this.parent.scrollSettings.enableVirtualization)for(t=a;t<=s;t++)if((r=t)>-1){var p=this.parent.getRow(r,null);p&&(i=p.getElementsByClassName("e-cell"),d=l===o?[i[l]]:this.getRowCells(i,o,l+1),this.merge(h,d))}return h},e.prototype.getRowCells=function(e,t,r){var n=[];for(t;t<r;t++)e[t]&&n.push(e[t]);return n},e.prototype.merge=function(e,t){e&&t&&Array.prototype.push.apply(e,t)},e.prototype.clearBorder=function(){var e=this.parent.getActiveSheet();if(e.frozenColumns||e.frozenRows)return void[].slice.call(this.parent.element.getElementsByClassName("e-formuala-range")).forEach(function(e){t.detach(e)});for(var r=this.parent.element.getElementsByClassName("e-formularef-selection"),n=r.length-1;n>=0;n--)for(var i=r[n],a=["e-vborderright","e-vborderbottom","e-pborderright","e-pborderbottom","e-cborderright","e-cborderbottom","e-gborderright","e-gborderbottom","e-oborderright","e-oborderbottom","e-bborderright","e-bborderbottom","e-formularef-selection"],o=0;o<a.length;o++)i.classList.remove(a[o])},e.prototype.getModuleName=function(){return"selection"},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e}(),Ka=function(){function e(e){this.clientX=0,this.isKeyScroll=!0,this.parent=e,this.addEventListener(),this.initProps()}return e.prototype.onContentScroll=function(e){if(this.parent){var r,n,i=this.parent.getMainContent().parentElement,a=e.scrollLeft,o=e.scrollTop||i.scrollTop,s=a&&this.parent.enableRtl?this.initScrollValue-a:a;if(this.parent.allowAutoFill){var l=document.querySelector("#"+this.parent.element.id+"_autofilloptionbtn-popup"),d=document.querySelector("#"+this.parent.element.id+"_autofilloptionbtn");l&&t.getComponent(d,"dropdown-btn").toggle()}if(!t.isNullOrUndefined(a)&&this.prevScroll.scrollLeft!==s){var h=s>this.prevScroll.scrollLeft;n=this.offset.left.size,this.offset.left=this.getColOffset(s,h,e.skipHidden),e.preventScroll||(this.parent.getColumnHeaderContent().scrollLeft=a,this.parent.getMainContent().scrollLeft=a,e.scrollLeft=a),r={cur:this.offset.left,prev:{idx:this.leftIndex,size:n},increase:h,preventScroll:e.preventScroll},this.updateTopLeftCell(h,!0),this.parent.notify("focusRenameInput",null),this.parent.notify("horizontalScroll",r),this.updateNoteContainer(),this.parent.scrollSettings.enableVirtualization||!h||this.parent.scrollSettings.isFinite||this.updateNonVirtualCols(),this.leftIndex=r.prev.idx,this.prevScroll.scrollLeft=s}if(Math.round(this.prevScroll.scrollTop)!==Math.round(o)){e.skipRowVirualScroll&&(this.prevScroll.scrollTop=0,this.offset.top={idx:0,size:0});var p=o>this.prevScroll.scrollTop;n=this.offset.top.size,this.offset.top=this.getRowOffset(o,p),r={cur:this.offset.top,prev:{idx:this.topIndex,size:n},increase:p,preventScroll:e.preventScroll},this.updateTopLeftCell(p),e.preventScroll&&this.offset.top.idx<=this.parent.getThreshold("row")?this.offset.top={idx:0,size:0}:e.skipRowVirualScroll?r.prev.idx=r.cur.idx:(this.parent.notify("focusRenameInput",null),this.parent.notify("verticalScroll",r),this.updateNoteContainer()),this.parent.scrollSettings.enableVirtualization||!p||this.parent.scrollSettings.isFinite||this.updateNonVirtualRows(),this.topIndex=r.prev.idx,this.prevScroll.scrollTop=o}var c={isEdit:!1};this.parent.notify("isFormulaBarEdit",c),c.isEdit&&this.parent.element.querySelector(".e-formula-bar").focus(),this.isKeyScroll=!0}},e.prototype.updateNoteContainer=function(){document.getElementsByClassName("e-addNoteContainer")&&document.getElementsByClassName("e-addNoteContainer").length>0&&this.parent.notify("updateNoteContainer",null)},e.prototype.updateScrollValue=function(e){void 0!==e.scrollLeft&&(this.prevScroll.scrollLeft=e.scrollLeft+(this.prevScroll.scrollLeft-this.offset.left.size),this.offset.left.size=e.scrollLeft),void 0!==e.scrollTop&&(this.prevScroll.scrollTop=e.scrollTop+(this.prevScroll.scrollTop-this.offset.top.size),this.offset.top.size=e.scrollTop)},e.prototype.updateNonVirtualRows=function(){var e=this.parent.getActiveSheet(),t=this.parent.getThreshold("row");this.offset.top.idx>e.rowCount-(this.parent.viewport.rowCount+t)&&(this.parent.renderModule.refreshUI({rowIndex:e.rowCount,colIndex:0,direction:"first",refresh:"RowPart"},g(e.rowCount,0)+":"+g(e.rowCount+t-1,e.colCount-1)),this.parent.setSheetPropertyOnMute(e,"rowCount",e.rowCount+t),this.parent.viewport.bottomIndex=e.rowCount-1)},e.prototype.updateNonVirtualCols=function(){var e=this.parent.getActiveSheet(),t=this.parent.getThreshold("col");this.offset.left.idx>e.colCount-(this.parent.viewport.colCount+t)&&(this.parent.renderModule.refreshUI({rowIndex:0,colIndex:e.colCount,direction:"first",refresh:"ColumnPart"},g(0,e.colCount)+":"+g(e.rowCount-1,e.colCount+t-1)),this.parent.setSheetPropertyOnMute(e,"colCount",e.colCount+t),this.parent.viewport.rightIndex=e.colCount-1)},e.prototype.updateTopLeftCell=function(e,t){var r=this.parent.getActiveSheet(),n=this.offset.top.idx,i=this.offset.left.idx;if(!e){var a=this.parent.frozenRowCount(r);n=j(r,n+a,!0)-a;var o=this.parent.frozenColCount(r);i=j(r,i+o,!0,"columns")-o}t?this.parent.updateTopLeftCell(null,i,"row"):this.parent.updateTopLeftCell(n,null,"col")},e.prototype.getRowOffset=function(e,t){var r=this.offset.top.size,n=this.parent.getActiveSheet(),i=t?this.offset.top.idx+1:this.offset.top.idx?this.offset.top.idx-1:0,a=this.parent.frozenRowCount(n),o=this.parent.scrollSettings.isFinite?n.rowCount:1/0;for(e=Math.round(e);i<o;)if(t){if(r+=s=nt(n,i-1+a,!0),Math.abs(Math.round(r)-e)<=1)return{idx:j(n,i+a,!0)-a,size:r};if(Math.round(r)>e)return{idx:i-1,size:r-s};i++}else{var s=nt(n,i+a,!0);if((r-=s)<=0)return{idx:0,size:0};if(Math.abs(Math.round(r)-e)<=1)return{idx:i,size:r};if(Math.round(r)<e)return r+=s,Math.round(r)>e?{idx:i,size:r-s<0?0:r-s}:{idx:j(n,i+1+a,!0)-a,size:r};i--}return{idx:this.offset.top.idx,size:this.offset.top.size}},e.prototype.getColOffset=function(e,t,r){for(var n=this.offset.left.size,i=this.parent.getActiveSheet(),a=t?this.offset.left.idx+1:this.offset.left.idx?this.offset.left.idx-1:0,o=this.parent.frozenColCount(i),s=this.parent.scrollSettings.isFinite?i.colCount:1/0;a<s;)if(t){if(n+=l=lt(i,a-1+o,r,!0),Math.abs(Math.round(n)-e)<=1)return{idx:j(i,a+o,!0,"columns")-o,size:n};if(Math.round(n)>e)return{idx:a-1,size:n-l};a++}else{var l=lt(i,a+o,r,!0);if((n-=l)<=0)return{idx:0,size:0};if(Math.abs(Math.round(n)-e)<=1)return{idx:a,size:n};if(Math.round(n)<e)return n+=l,Math.round(n)>e?(n-=l,{idx:a,size:n<0?0:n}):{idx:j(i,a+1+o,!0,"columns")-o,size:n};a--}return{idx:this.offset.left.idx,size:this.offset.left.size}},e.prototype.contentLoaded=function(e){if(!this.parent.scrollSettings.enableVirtualization){var t=this.parent.createElement("div",{className:"e-virtualtrack"});this.updateNonVirualScrollWidth({scrollTrack:t}),this.parent.getScrollElement().appendChild(t)}e.left&&(this.parent.getScrollElement().scrollLeft=e.left),this.setScrollEvent(),this.parent.enableRtl&&(this.initScrollValue=this.parent.getScrollElement().scrollLeft)},e.prototype.updateNonVirualScrollWidth=function(e){e.scrollTrack||(e.scrollTrack=this.parent.getScrollElement().getElementsByClassName("e-virtualtrack")[0]),e.scrollTrack.style.width=Math.abs(this.parent.getContentTable().getBoundingClientRect().width+(this.parent.scrollSettings.isFinite?this.parent.sheetModule.getScrollSize():0))+"px"},e.prototype.onHeaderWheel=function(e){e.preventDefault(),this.parent.getMainContent().parentElement.scrollTop+=e.deltaY,this.parent.getScrollElement().scrollLeft+=e.deltaX},e.prototype.onContentWheel=function(e){0!==e.deltaX&&(e.preventDefault(),this.parent.getScrollElement().scrollLeft+=e.deltaX)},e.prototype.scrollHandler=function(e){this.onContentScroll({scrollLeft:e.target.scrollLeft})},e.prototype.updateScroll=function(e){t.isNullOrUndefined(e.left)?this.parent.sheetModule.contentPanel.scrollTop=e.top:this.parent.getScrollElement().scrollLeft=e.left},e.prototype.setScrollEvent=function(){t.EventHandler.add(this.parent.sheetModule.contentPanel,"scroll",this.onContentScroll,this),t.EventHandler.add(this.parent.getColumnHeaderContent(),"wheel",this.onHeaderWheel,this),t.EventHandler.add(this.parent.getSelectAllContent(),"wheel",this.onHeaderWheel,this),t.EventHandler.add(this.parent.getMainContent(),"wheel",this.onContentWheel,this),t.EventHandler.add(this.parent.getRowHeaderContent(),"wheel",this.onContentWheel,this),t.EventHandler.add(this.parent.getScrollElement(),"scroll",this.scrollHandler,this)},e.prototype.initProps=function(){this.topIndex=0,this.leftIndex=0,this.prevScroll={scrollLeft:0,scrollTop:0},this.offset={left:{idx:0,size:0},top:{idx:0,size:0}}},e.prototype.setPadding=function(e){this.parent.sheetModule.contentPanel.style.overflowY="scroll";var t=vt();if(t>0){var r=this.parent.getColumnHeaderContent(),n=this.parent.enableRtl?{margin:"marginLeft",border:"borderLeftWidth"}:{margin:"marginRight",border:"borderRightWidth"};r.parentElement.style[n.margin]=t+"px",r.style[n.border]="1px"}e&&(this.initScrollValue=0)},e.prototype.setClientX=function(e){if("mousedown"!==e.type&&"mouse"!==e.pointerType){var r={touchSelectionStarted:!1};if(this.parent.notify(Li,r),!r.touchSelectionStarted&&!r.isOverlayClicked){this.clientX=this.getPointX(e);var n=document.getElementById(this.parent.element.id+"_sheet");t.EventHandler.add(n,t.Browser.isPointer?"pointermove":"touchmove",this.onTouchScroll,this),t.EventHandler.add(n,t.Browser.isPointer?"pointerup":"touchend",this.pointerUpHandler,this)}}},e.prototype.getPointX=function(e){return e.touches&&e.touches.length?e.touches[0].clientX:e.clientX},e.prototype.onTouchScroll=function(e){if("mouse"!==e.pointerType){var t=this.getPointX(e),r=this.clientX-t,n=this.parent.element.getElementsByClassName("e-scroller")[0];(r>10||r<-10)&&n.scrollLeft+r>=0&&(e.preventDefault(),this.clientX=t,ft(function(){n.scrollLeft+=r}))}},e.prototype.pointerUpHandler=function(){var e=document.getElementById(this.parent.element.id+"_sheet");t.EventHandler.remove(e,t.Browser.isPointer?"pointermove":"touchmove",this.onTouchScroll),t.EventHandler.remove(e,t.Browser.isPointer?"pointerup":"touchend",this.pointerUpHandler)},e.prototype.addEventListener=function(){this.parent.on(Wn,this.contentLoaded,this),this.parent.on("onContentScroll",this.onContentScroll,this),this.parent.on("updateScroll",this.updateScroll,this),this.parent.on(ii,this.initProps,this),this.parent.on(Gn,this.destroy,this),this.parent.on("mouseDown",this.setClientX,this),this.parent.on("updateScrollValue",this.updateScrollValue,this),this.parent.scrollSettings.enableVirtualization||(this.parent.on("virtualContentLoaded",this.updateNonVirualScrollWidth,this),this.parent.on(ni,this.updateNonVirualScrollWidth,this))},e.prototype.destroy=function(){this.removeEventListener();var e=document.querySelector("#"+this.parent.element.id+"_autofilloptionbtn");if(e){var r=t.getComponent(e,"dropdown-btn");r&&r.destroy()}this.parent=null},e.prototype.removeEventListener=function(){this.parent.off(Wn,this.contentLoaded),this.parent.off("onContentScroll",this.onContentScroll),this.parent.off("updateScroll",this.updateScroll),this.parent.off(ii,this.initProps),this.parent.off(Gn,this.destroy),this.parent.off("mouseDown",this.setClientX),this.parent.off("updateScrollValue",this.updateScrollValue),this.parent.scrollSettings.enableVirtualization||(this.parent.off("virtualContentLoaded",this.updateNonVirualScrollWidth),this.parent.off(ni,this.updateNonVirualScrollWidth))},e}(),$a=function(){function e(e){this.scroll=[],this.parent=e,this.addEventListener()}return e.prototype.createVirtualElement=function(e){var r=this.parent.getActiveSheet(),n=this.parent.getMainContent();this.content=this.parent.createElement("div",{className:"e-virtualable"}),this.content.appendChild(n.querySelector(".e-table")),n.appendChild(this.content);var i,a=n.appendChild(this.parent.createElement("div",{className:"e-virtualtrack"})),o=0;this.parent.sheets.length>this.scroll.length&&this.initScroll();var s=this.parent.viewport.bottomIndex;r.rowCount>s+1||r.usedRange.rowIndex>s?(!this.parent.scrollSettings.isFinite&&r.rowCount<=r.usedRange.rowIndex&&this.parent.setSheetPropertyOnMute(r,"rowCount",r.usedRange.rowIndex+1),this.setScrollCount(r.rowCount,"row")):(this.parent.scrollSettings.isFinite||this.parent.setSheetPropertyOnMute(r,"rowCount",s+1),this.scroll[this.parent.activeSheetIndex].rowCount=r.rowCount);var l=this.parent.frozenRowCount(r),d=u(r.topLeftCell);e.top&&(o=e.top,r.frozenRows&&(o+=at(r,d[0],l-1,!0)),l=u(r.paneTopLeftCell)[0]),o+=at(r,l,this.scroll[this.parent.activeSheetIndex].rowCount-1,!0),s=this.parent.viewport.rightIndex;var h=0,p=this.parent.frozenColCount(r);e.left?(h=e.left,p&&(h+=dt(r,d[1],p-1,!0)),l=u(r.paneTopLeftCell)[1]):l=p,r.colCount>s+1||r.usedRange.colIndex>s?(!this.parent.scrollSettings.isFinite&&r.colCount<=r.usedRange.colIndex&&this.parent.setSheetPropertyOnMute(r,"colCount",r.usedRange.colIndex+1),h+=dt(r,l,s,!0),this.setScrollCount(r.colCount,"col"),i=h+dt(r,s+1,this.scroll[this.parent.activeSheetIndex].colCount-1,!0)):(this.parent.scrollSettings.isFinite||this.parent.setSheetPropertyOnMute(r,"colCount",s+1),h+=dt(r,l,r.colCount-1,!0),this.scroll[this.parent.activeSheetIndex].colCount=r.colCount,i=h),t.isNullOrUndefined(this.parent.viewport.leftIndex)&&(this.parent.viewport.leftIndex=0),t.isNullOrUndefined(this.parent.viewport.topIndex)&&(this.parent.viewport.topIndex=0),e.left&&(h=dt(r,this.parent.viewport.leftIndex+p,s,!0)),t.isNullOrUndefined(this.translateX)&&(this.translateX=0),t.isNullOrUndefined(this.translateY)&&(this.translateY=0),n=this.parent.getRowHeaderContent(),this.rowHeader=this.content.cloneNode(),this.rowHeader.appendChild(n.querySelector(".e-table")),n.appendChild(this.rowHeader);var c=n.appendChild(a.cloneNode());this.rowHeader.style.transform="translate(0px, "+this.translateY+"px)",n=this.parent.getColumnHeaderContent(),this.colHeader=this.content.cloneNode(),this.colHeader.appendChild(n.querySelector(".e-table")),n.appendChild(this.colHeader);var f=n.appendChild(a.cloneNode());if(this.colHeader.style.width=h+"px",c.style.height=o+"px",f.style.width=i+"px",this.colHeader.style.transform="translate("+this.translateX+"px, 0px)",this.content.style.transform="translate("+this.translateX+"px, "+this.translateY+"px)",this.content.style.width=h+"px",a.style.height=o+"px",a.style.width=i+"px",this.parent.allowScrolling){var g=f.cloneNode(!0);g.style.width=i+(this.parent.scrollSettings.isFinite?this.parent.sheetModule.getScrollSize():0)+"px",this.parent.getScrollElement().appendChild(g)}},e.prototype.initScroll=function(){for(var e=0;e<this.parent.sheets.length;)this.scroll[e]||this.scroll.push({rowCount:0,colCount:0}),e++},e.prototype.setScrollCount=function(e,t){var r=this.parent.activeSheetIndex;this.scroll[r][t+"Count"]&&this.scroll[r][t+"Count"]===e||(this.scroll[r][t+"Count"]=e)},e.prototype.getRowAddress=function(e){var t=this.parent.getActiveSheet();return m([e[0],t.frozenColumns?u(t.topLeftCell)[1]:this.parent.viewport.leftIndex,e[1],this.parent.viewport.rightIndex])},e.prototype.getColAddress=function(e){var t=this.parent.getActiveSheet();return m([t.frozenRows?u(t.topLeftCell)[0]:this.parent.viewport.topIndex,e[0],this.parent.viewport.bottomIndex,e[1]])},e.prototype.updateScrollCount=function(e,t,r){void 0===r&&(r=e);var n=this.parent.getActiveSheet(),i=e+this.parent.viewport[t+"Count"]+1+r,a=this.scroll[this.parent.activeSheetIndex][t+"Count"];if(i<a){if(n[t+"Count"]===a)return;i=a}this.parent.scrollSettings.isFinite||this.parent.setSheetPropertyOnMute(n,t+"Count",i)},e.prototype.onVerticalScroll=function(e){var t=e.cur.idx,r=e.cur.size,n=e.prev.idx,i=Math.abs(t-n),a=this.parent.getThreshold("row");if(i>Math.round(a/2)){var o=void 0,s=void 0,l=void 0,d=this.parent.getActiveSheet();if(t<=a&&!e.increase){if(this.translateY&&n>a){this.translateY=0;var h=this.parent.frozenColCount(d),p=this.parent.frozenRowCount(d);if(e.preventScroll)this.parent.viewport.topIndex=n-(a-p);else{var f=h?u(d.topLeftCell)[1]:this.parent.viewport.leftIndex,g=h?[p,this.parent.viewport.leftIndex+h]:[];if(i<this.parent.viewport.rowCount+a){o=j(d,p,!0),s=j(d,this.parent.viewport.topIndex+p-1,!1),this.parent.viewport.topIndex=o-p;S=this.skipHiddenLastIdx(this.parent.viewport.bottomIndex-(s-o+1-this.hiddenCount(o,s)),this.parent.viewport.bottomIndex);this.parent.viewport.bottomIndex=j(d,S,!1),this.parent.renderModule.refreshUI({colIndex:f,rowIndex:o,direction:"last",refresh:"RowPart",skipUpdateOnFirst:!0,frozenIndexes:g},this.getRowAddress([o,j(d,s,!1)]))}else{var m=this.parent.viewport.leftIndex;this.parent.renderModule.refreshUI({rowIndex:0,colIndex:f,refresh:"Row",skipUpdateOnFirst:!0,frozenIndexes:g,skipTranslate:!0}),h&&(this.parent.viewport.leftIndex=m),this.translate({refresh:"Row"})}or(this.parent.element),t=0}}this.updateScrollCount(a,"row")}if(n<a&&(i=Math.abs(t-a)),!e.increase&&this.parent.scrollSettings.isFinite&&this.parent.viewport.bottomIndex===j(d,d.rowCount-1,!1)){var p=this.parent.frozenRowCount(d),v=this.parent.viewport.topIndex+p+c(d.paneTopLeftCell)[0]-1;if(t+p>v)return void(e.prev.idx=t);i=v-(t+p)}if(t>a){if(l=this.parent.viewport.topIndex,this.parent.viewport.topIndex=t-a,e.increase&&l>this.parent.viewport.topIndex)return void(this.parent.viewport.topIndex=l);p=this.parent.frozenRowCount(d);if(e.preventScroll)this.setThresholdHeight(r,a,p),this.translate({refresh:"Row"});else{var f=void 0,y=[];if((h=this.parent.frozenColCount(d))?(f=u(d.topLeftCell)[1],y.push(p),y.push(this.parent.viewport.leftIndex+h)):f=this.parent.viewport.leftIndex,i<this.parent.viewport.rowCount+a)if(e.increase){if(o=this.parent.viewport.bottomIndex+1,s=this.parent.viewport.bottomIndex+(this.parent.viewport.topIndex-l),(s-=this.hiddenCount(l+p,this.parent.viewport.topIndex-1+p))<=this.parent.viewport.bottomIndex||this.parent.scrollSettings.isFinite&&o>j(d,d.rowCount-1,!1,"rows"))return void(this.parent.viewport.topIndex=l);var C=this.parent.skipHidden(o,s,"rows",!1),b=this.checkLastIdx(C[1],"row");o=C[0],s=b.index;var x=this.parent.viewport.topIndex+p;b.diff&&(x=j(d,l,!0,"rows",s-o+1-this.hiddenCount(o,s))+p),this.parent.viewport.topIndex=j(d,x,!b.diff)-p,this.setThresholdHeight(r,t-this.parent.viewport.topIndex,p,!!b.diff,l===j(d,p,!0)),this.parent.viewport.bottomIndex=s,this.parent.renderModule.refreshUI({colIndex:f,rowIndex:o,direction:"first",refresh:"RowPart",frozenIndexes:y},this.getRowAddress([o,s]))}else{if((o=j(d,this.parent.viewport.topIndex+p,!1))<p&&(o=j(d,o=p,!0)),this.parent.viewport.topIndex=o-p,(s=j(d,l+p-1,!1))<p||s<o)return void(this.parent.viewport.topIndex=l);var S=this.skipHiddenLastIdx(this.parent.viewport.bottomIndex-(s-o+1-this.hiddenCount(o,s)),this.parent.viewport.bottomIndex);this.parent.viewport.bottomIndex=j(d,S,!1),this.setThresholdHeight(r,t-this.parent.viewport.topIndex,p),this.parent.renderModule.refreshUI({colIndex:f,rowIndex:o,direction:"last",refresh:"RowPart",frozenIndexes:y},this.getRowAddress([o,s]))}else l=this.parent.viewport.leftIndex,this.parent.viewport.topIndex=j(d,this.parent.viewport.topIndex+p,!1)-p,this.parent.viewport.topIndex<0&&(this.parent.viewport.topIndex=j(d,p,!0)-p),this.parent.renderModule.refreshUI({rowIndex:this.parent.viewport.topIndex,colIndex:f,refresh:"Row",frozenIndexes:y,skipTranslate:!0}),h&&(this.parent.viewport.leftIndex=l),this.setThresholdHeight(r,t-this.parent.viewport.topIndex,p,this.parent.scrollSettings.isFinite&&this.parent.viewport.bottomIndex===j(d,d.rowCount-1,!1)),this.translate({refresh:"Row"});this.updateScrollCount(t,"row",a),this.focusSheet()}}e.prev.idx=t}},e.prototype.skipHiddenLastIdx=function(e,t,r){void 0===r&&(r="rows");for(var n=this.parent.getActiveSheet(),i=0,a=e;a<=t;a++)n[""+r][a]&&n[""+r][a].hidden&&i++;return i&&(e=this.skipHiddenLastIdx(e-i,e-1,r)),e},e.prototype.hiddenCount=function(e,t,r){void 0===r&&(r="rows");for(var n=0,i=this.parent.getActiveSheet(),a=e;a<=t;a++)i[""+r][a]&&i[""+r][a].hidden&&n++;return n},e.prototype.checkLastIdx=function(e,t){var r=0;if(this.parent.scrollSettings.isFinite){var n=this.parent.getActiveSheet(),i=j(n,n[t+"Count"]-1,!1,"col"===t?"columns":"rows");e>i&&(r=e-i,e=i)}return{index:e,diff:r}},e.prototype.onHorizontalScroll=function(e){var t=e.cur.idx,r=e.cur.size,n=e.prev.idx,i=Math.abs(t-n),a=this.parent.getThreshold("col");if(i>Math.round(a/2)){var o=void 0,s=void 0,l=void 0,d=this.parent.getActiveSheet();if(t<=a&&!e.increase){if(this.translateX&&n>a){this.translateX=0;var h=this.parent.frozenColCount(d),p=this.parent.frozenRowCount(d);if(e.preventScroll)this.parent.viewport.leftIndex=n-(a-h);else{var f=p?u(d.topLeftCell)[0]:this.parent.viewport.topIndex,g=p?[this.parent.viewport.topIndex+p,h]:[];if(i<this.parent.viewport.colCount+a){o=j(d,h,!0,"columns"),s=j(d,this.parent.viewport.leftIndex+h-1,!1,"columns"),this.parent.viewport.leftIndex=o-h;x=this.skipHiddenLastIdx(this.parent.viewport.rightIndex-(s-o+1-this.hiddenCount(o,s,"columns")),this.parent.viewport.rightIndex,"columns");this.parent.viewport.rightIndex=j(d,x,!1,"columns"),this.parent.renderModule.refreshUI({rowIndex:f,colIndex:o,direction:"last",refresh:"ColumnPart",skipUpdateOnFirst:!0,frozenIndexes:g},this.getColAddress([o,j(d,s,!1,"columns")]))}else{var m=this.parent.viewport.topIndex;this.parent.renderModule.refreshUI({rowIndex:f,colIndex:0,refresh:"Column",skipUpdateOnFirst:!0,frozenIndexes:g,skipTranslate:!0}),p&&(this.parent.viewport.topIndex=m),this.translate({refresh:"Column"})}or(this.parent.element),t=0}}this.updateScrollCount(a,"col")}if(n<a&&(i=Math.abs(t-a)),!e.increase&&this.parent.scrollSettings.isFinite&&this.parent.viewport.rightIndex===j(d,d.colCount-1,!1,"columns")){var h=this.parent.frozenColCount(d),v=this.parent.viewport.leftIndex+h+c(d.paneTopLeftCell)[1]-1;if(v+=this.hiddenCount(this.parent.viewport.leftIndex+h,v),t+h>v)return void(e.prev.idx=t);i=v-(t+h)}if(t>a){if(l=this.parent.viewport.leftIndex,this.parent.viewport.leftIndex=t-a,e.increase&&l>this.parent.viewport.leftIndex)return void(this.parent.viewport.leftIndex=l);h=this.parent.frozenColCount(d);if(e.preventScroll)this.setThresholdWidth(r,a,h),this.translate({refresh:"Column"});else{var f=(p=this.parent.frozenRowCount(d))?u(d.topLeftCell)[0]:this.parent.viewport.topIndex,y=[];if(p&&(y=[p+this.parent.viewport.topIndex,h]),i<this.parent.viewport.colCount+a)if(e.increase){if(o=this.parent.viewport.rightIndex+1,s=this.parent.viewport.rightIndex+(this.parent.viewport.leftIndex-l),(s-=this.hiddenCount(l+h,this.parent.viewport.leftIndex-1+h,"columns"))<=this.parent.viewport.rightIndex||this.parent.scrollSettings.isFinite&&o>j(d,d.colCount-1,!1,"columns"))return void(this.parent.viewport.leftIndex=l);var C=this.parent.skipHidden(o,s,"columns",!1),b=this.checkLastIdx(C[1],"col");o=C[0],s=b.index,this.parent.viewport.leftIndex=j(d,this.parent.viewport.leftIndex-b.diff+h,!b.diff,"columns")-h,this.setThresholdWidth(r,t-this.parent.viewport.leftIndex,h,!!b.diff,l===j(d,h,!0,"columns")),this.parent.viewport.rightIndex=s,this.parent.renderModule.refreshUI({rowIndex:f,colIndex:o,direction:"first",refresh:"ColumnPart",frozenIndexes:y},this.getColAddress([o,s]))}else{if((o=j(d,this.parent.viewport.leftIndex+h,!1,"columns"))<h&&(o=j(d,o=h,!0,"columns")),this.parent.viewport.leftIndex=o-h,(s=j(d,l+h-1,!1,"columns"))<h||s<o)return void(this.parent.viewport.leftIndex=l);var x=this.skipHiddenLastIdx(this.parent.viewport.rightIndex-(s-o+1-this.hiddenCount(o,s,"columns")),this.parent.viewport.rightIndex,"columns");this.parent.viewport.rightIndex=j(d,x,!1,"columns"),this.setThresholdWidth(r,t-this.parent.viewport.leftIndex,h),this.parent.renderModule.refreshUI({rowIndex:f,colIndex:o,direction:"last",refresh:"ColumnPart",frozenIndexes:y},this.getColAddress([o,s]))}else l=this.parent.viewport.topIndex,this.parent.viewport.leftIndex=j(d,this.parent.viewport.leftIndex+h,!1,"columns")-h,this.parent.viewport.leftIndex<0&&(this.parent.viewport.leftIndex=j(d,h,!0,"columns")-h),this.parent.renderModule.refreshUI({rowIndex:f,colIndex:this.parent.viewport.leftIndex,refresh:"Column",frozenIndexes:y,skipTranslate:!0}),p&&(this.parent.viewport.topIndex=l),this.setThresholdWidth(r,t-this.parent.viewport.leftIndex,h,this.parent.scrollSettings.isFinite&&this.parent.viewport.rightIndex===j(d,d.colCount-1,!1,"columns")),this.translate({refresh:"Column"});this.updateScrollCount(t,"col",a),this.focusSheet()}}e.prev.idx=t}},e.prototype.focusSheet=function(){document.activeElement.classList.contains("e-text-findNext-short")&&t.closest(document.activeElement,"#"+this.parent.element.id)||or(this.parent.element)},e.prototype.setThresholdHeight=function(e,t,r,n,i){var a=this.parent.getActiveSheet(),o=this.parent.viewport.topIndex+r,s=o+t-1;this.translateY=n||i||s<o?o<=r?0:at(a,r,o-1,!0):e-at(a,o,s,!0)},e.prototype.setThresholdWidth=function(e,t,r,n,i){var a=this.parent.getActiveSheet(),o=this.parent.viewport.leftIndex+r,s=o+t-1;this.translateX=n||i||s<o?o<=r?0:dt(a,r,o-1,!0):e-dt(a,o,s,!0)},e.prototype.translate=function(e){if(!e.skipTranslate&&this.content){var t=this.translateX||0;t=this.parent.enableRtl?-t:t,"Row"!==e.refresh&&"RowPart"!==e.refresh||(this.content.style.transform="translate("+t+"px, "+this.translateY+"px)",this.rowHeader.style.transform="translate(0px, "+this.translateY+"px)"),"Column"!==e.refresh&&"ColumnPart"!==e.refresh||(this.content.style.transform="translate("+t+"px, "+this.translateY+"px)",this.colHeader.style.transform="translate("+t+"px, 0px)")}},e.prototype.updateColumnWidth=function(e){if("Column"===e.refresh){this.content.style.width="";var t=this.parent.getActiveSheet(),r=dt(t,this.parent.viewport.leftIndex+this.parent.frozenColCount(t),this.parent.viewport.rightIndex,!0);if(this.colHeader.style.width=r+"px",this.content.style.width=r+"px",!this.parent.scrollSettings.isFinite||e.isUpdate){var n=this.parent.element.querySelector(".e-scroller .e-virtualtrack");if(!n)return;var i=parseInt(n.style.width,10),a=r+this.translateX+this.parent.viewport.beforeFreezeWidth;if(a>i){o=a-i;n.style.width=i+o+"px"}else{var o=i-a,s=this.parent.getMainContent().getElementsByClassName("e-virtualtrack")[0];i-o<parseInt(s.style.width,10)&&(n.style.width=s.style.width)}}}else if(!this.parent.scrollSettings.isFinite){var s=this.parent.getMainContent().getElementsByClassName("e-virtualtrack")[0],l=parseInt(s.style.height,10),d=this.content.getBoundingClientRect().height+this.translateY+this.parent.viewport.beforeFreezeHeight;if(d>l){o=d-l;s.style.height=l+o+"px"}else{var o=l-d,h=this.parent.getRowHeaderContent().getElementsByClassName("e-virtualtrack")[0];l-o<parseInt(h.style.height,10)&&(s.style.height=h.style.height)}}},e.prototype.updateRowColCount=function(e){if(this.scroll.length){var t=this.parent.getActiveSheet();if("row"===e.update){if(e.index!==this.scroll[this.parent.activeSheetIndex].rowCount-1){var r=this.getVTrackHeight("height"),n=r;if(e.index>=this.scroll[this.parent.activeSheetIndex].rowCount?void 0===e.start?n+=at(t,this.scroll[this.parent.activeSheetIndex].rowCount,e.index,!0):n+=at(t,e.start,e.end,!0):void 0===e.start?n-=at(t,e.index+1,this.scroll[this.parent.activeSheetIndex].rowCount-1,!0):n-=at(t,e.start,e.end,!0),!e.isDelete&&n<r)return;this.scroll[this.parent.activeSheetIndex].rowCount=e.index+1,this.updateVTrack(this.rowHeader,n,"height"),this.scroll[this.parent.activeSheetIndex].rowCount>t.rowCount&&this.parent.setSheetPropertyOnMute(t,"rowCount",this.scroll[this.parent.activeSheetIndex].rowCount)}}else if(e.index!==this.scroll[this.parent.activeSheetIndex].colCount-1){var i=this.getVTrackHeight("width"),a=i;if(e.index>=this.scroll[this.parent.activeSheetIndex].colCount?void 0===e.start?a+=dt(t,this.scroll[this.parent.activeSheetIndex].colCount,e.index,!0):a+=dt(t,e.start,e.end,!0):void 0===e.start?a-=dt(t,e.index+1,this.scroll[this.parent.activeSheetIndex].colCount-1,!0):a-=dt(t,e.start,e.end,!0),!e.isDelete&&a<i)return;this.scroll[this.parent.activeSheetIndex].colCount=e.index+1,this.updateVTrack(this.colHeader,a,"width"),this.scroll[this.parent.activeSheetIndex].colCount>t.colCount&&this.parent.setSheetPropertyOnMute(t,"colCount",this.scroll[this.parent.activeSheetIndex].colCount)}}},e.prototype.getVTrackHeight=function(e){var t=this.content.nextElementSibling.style[""+e];if(t.includes("e+")){var r=(t=t.split("px")[0]).split("e+");return Number(r[0])*Math.pow(10,Number(r[1]))}return parseFloat(t)},e.prototype.updateVTrackHeight=function(e){var t=this.parent.frozenRowCount(this.parent.getActiveSheet());if(e.rowIdx<this.scroll[this.parent.activeSheetIndex].rowCount&&this.updateVTrack(this.rowHeader,this.getVTrackHeight("height")+e.threshold,"height"),e.rowIdx>=t&&e.rowIdx<this.parent.scrollModule.offset.top.idx+t){var r=this.parent.element.getElementsByClassName("e-main-panel")[0];r&&(this.parent.scrollModule.prevScroll.scrollTop=r.scrollTop+e.threshold,r.scrollTop+=e.threshold),this.parent.scrollModule.offset.top.size+=e.threshold,e.rowIdx<this.parent.viewport.topIndex+t&&(this.translateY+=e.threshold,this.translate({refresh:"Row"}))}},e.prototype.updateVTrackWidth=function(e){if(!ht(this.parent.getActiveSheet(),e.colIdx)){var t=this.parent.frozenColCount(this.parent.getActiveSheet());if(e.colIdx>=this.parent.viewport.leftIndex+t&&e.colIdx<=this.parent.viewport.rightIndex){var r=this.parent.getColumnHeaderContent().getElementsByClassName("e-virtualtrack")[0];r.style.width=parseFloat(r.style.width)+e.threshold+"px";var n=this.parent.getMainContent().getElementsByClassName("e-virtualtrack")[0];n.style.width=parseFloat(n.style.width)+e.threshold+"px";var i=this.parent.getScrollElement().getElementsByClassName("e-virtualtrack")[0];i.style.width=parseFloat(i.style.width)+e.threshold+"px";var a=this.parent.getColumnHeaderContent().getElementsByClassName("e-virtualable")[0];a.style.width=parseFloat(a.style.width)+e.threshold+"px";var o=this.parent.getMainContent().getElementsByClassName("e-virtualable")[0];o.style.width=parseFloat(o.style.width)+e.threshold+"px"}else e.colIdx>=t&&e.colIdx<this.parent.viewport.leftIndex+t&&(this.parent.scrollModule.offset.left.size+=e.threshold,this.translateX+=e.threshold,this.translate({refresh:"Column"}))}},e.prototype.updateVTrack=function(e,t,r){e.nextElementSibling.style[""+r]=t+"px",this.content.nextElementSibling.style[""+r]=t+"px","width"===r&&this.parent.allowScrolling&&(this.parent.getScrollElement().firstElementChild.style.width=t+"px")},e.prototype.deInitProps=function(){this.parent.viewport.leftIndex=null,this.parent.viewport.topIndex=null,this.parent.viewport.bottomIndex=null,this.translateX=null,this.translateY=null},e.prototype.updateScrollProps=function(e){var t=this;void 0===e&&(e={sheetIndex:0,sheets:this.parent.sheets}),0===this.scroll.length?this.initScroll():e.sheets.forEach(function(){t.scroll.splice(e.sheetIndex,0,{rowCount:0,colCount:0})})},e.prototype.sliceScrollProps=function(e){t.isNullOrUndefined(e.sheetIndex)?this.scroll.length=0:this.scroll.splice(e.sheetIndex,1)},e.prototype.updateTranslate=function(e){if(e.height){if(e.isRender)this.translateY-=e.height;else{var t=parseInt(this.parent.getMainContent().getElementsByClassName("e-virtualtrack")[0].style.height,10);e.isHide?(this.updateVTrack(this.rowHeader,t-e.height,"height"),this.setThresholdHeight(this.translateY,e.prevSize-1-this.parent.viewport.topIndex+1,this.parent.frozenRowCount(this.parent.getActiveSheet()))):(this.updateVTrack(this.rowHeader,t+e.height,"height"),this.translateY=this.translateY+e.size)}this.translate({refresh:"Row"})}e.width&&(this.translateX-=e.width,this.translate({refresh:"Column"}))},e.prototype.addEventListener=function(){this.parent.on("beforeContentLoaded",this.createVirtualElement,this),this.parent.on("beforeVirtualContentLoaded",this.translate,this),this.parent.on("virtualContentLoaded",this.updateColumnWidth,this),this.parent.on("updateTableWidth",this.updateColumnWidth,this),this.parent.on("verticalScroll",this.onVerticalScroll,this),this.parent.on("horizontalScroll",this.onHorizontalScroll,this),this.parent.on("updateRowColCount",this.updateRowColCount,this),this.parent.on(ri,this.updateVTrackHeight,this),this.parent.on(ni,this.updateVTrackWidth,this),this.parent.on(ii,this.deInitProps,this),this.parent.on("sheetsDestroyed",this.sliceScrollProps,this),this.parent.on("sheetCreated",this.updateScrollProps,this),this.parent.on("updateTranslate",this.updateTranslate,this),this.parent.on(Gn,this.destroy,this)},e.prototype.destroy=function(){this.removeEventListener();var e=document.querySelectorAll(".e-addNoteIndicator");e&&e.forEach(function(e){e.remove()}),this.rowHeader&&(gt(this.rowHeader),this.rowHeader.remove()),this.colHeader&&(gt(this.colHeader),this.colHeader.remove()),this.content&&(gt(this.content),this.content.remove()),this.rowHeader=null,this.colHeader=null,this.content=null,this.parent=null,this.scroll.length=0,this.translateX=null,this.translateY=null},e.prototype.removeEventListener=function(){this.parent.off("beforeContentLoaded",this.createVirtualElement),this.parent.off("beforeVirtualContentLoaded",this.translate),this.parent.off("virtualContentLoaded",this.updateColumnWidth),this.parent.off("updateTableWidth",this.updateColumnWidth),this.parent.off("verticalScroll",this.onVerticalScroll),this.parent.off("horizontalScroll",this.onHorizontalScroll),this.parent.off("updateRowColCount",this.updateRowColCount),this.parent.off(ri,this.updateVTrackHeight),this.parent.off(ni,this.updateVTrackWidth),this.parent.off("sheetsDestroyed",this.sliceScrollProps),this.parent.off("sheetCreated",this.updateScrollProps),this.parent.off("updateTranslate",this.updateTranslate),this.parent.off(Gn,this.destroy)},e}(),Za=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on($n,this.keyDownHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off($n,this.keyDownHandler)},e.prototype.keyDownHandler=function(e){var r=this,n=e.target,i=this.parent.enableRtl,a=this.parent.enableKeyboardShortcut;if(e.altKey&&(38===e.keyCode||40===e.keyCode)&&!a)return void e.preventDefault();if(e.altKey&&38===e.keyCode&&this.parent.element.lastElementChild.classList.contains("e-filter-popup"))return void this.parent.notify("filterCellKeyDown",{closePopup:!0});if(this.parent.allowPrint&&e.ctrlKey&&80===e.keyCode&&a)return e.preventDefault(),void this.parent.print();var o=e.target;if(t.isNullOrUndefined(o)||!o.classList.contains("e-addNoteContainer")){var s=this.parent.serviceLocator.getService(Fa).dialogInstance,l=n.id===this.parent.element.id+"_name_box";if("None"===this.parent.selectionSettings.mode||s||this.parent.isEdit||n.classList.contains("e-ss-ddb")&&117!==e.keyCode&&9!==e.keyCode||l&&117!==e.keyCode||n.classList.contains("e-sheet-rename")||n.id===this.parent.element.id+"_SearchBox"||n.classList.contains("e-chk-hidden")||n.classList.contains("e-ddl")&&n.classList.contains("e-input-focus")){if(s){if(13===e.keyCode)s.element.classList.contains("e-spreadsheet-function-dlg")&&(n.classList.contains("e-formula-list")||n.classList.contains("e-list-item"))&&or(s.element.querySelector(".e-footer-content .e-primary"));else if(9===e.keyCode)if(s.element.classList.contains("e-find-dlg")){var d=s.element.querySelectorAll(".e-footer-content .e-btn:not(:disabled)"),h=d.length?d[d.length-1].className:"e-findnreplace-checkmatch";if(e.shiftKey){if(document.activeElement.classList.contains("e-dlg-closeicon-btn"))if(e.preventDefault(),d.length)or(d[d.length-1]);else{var p=s.element.querySelector(".e-findnreplace-exactmatchcheckbox");p&&(or(p.querySelector(".e-findnreplace-checkmatch")),p.classList.add("e-focus"))}}else document.activeElement.className.includes(h)&&or(s.element)}else if(s.element.classList.contains("e-protect-dlg"))(e.shiftKey?document.activeElement.classList.contains("e-primary"):document.activeElement.id===this.parent.element.id+"_protect_check")&&(f=s.element.querySelector(".e-protect-option-list"))&&!f.querySelector(".e-list-item.e-focused")&&(v=f.querySelector(".e-list-item"))&&v.classList.add("e-focused");else if(s.element.classList.contains("e-custom-format-dlg"))if(e.shiftKey)document.activeElement.className.includes("e-list-item e-active")&&(f=t.closest(document.activeElement,".e-custom-listview"))&&or(f);else if(document.activeElement.classList.contains("e-btn")&&document.activeElement.parentElement.classList.contains("e-custom-dialog")){var f=s.element.querySelector(".e-custom-listview"),g=t.getComponent(f,"listview");if(f){var v=f.querySelector(".e-list-item.e-active");if(!v){if(!(v=f.querySelector(".e-list-item")))return;g.selectItem(v)}e.preventDefault(),v.focus()}}else document.activeElement.classList.contains("e-list-item")&&or(s.element);else if(s.element.classList.contains("e-spreadsheet-function-dlg"))e.shiftKey&&document.activeElement.className.includes("e-list-item e-active")&&(f=t.closest(document.activeElement,".e-formula-list"))&&or(f);else if(s.element.classList.contains("e-goto-dlg")&&!s.element.classList.contains("e-dlg-modal"))if(e.shiftKey){if(document.activeElement.className.includes("e-dlg-closeicon-btn")){var y=s.element.querySelector(".e-footer-content .e-btn");y&&(e.preventDefault(),or(y))}}else document.activeElement.className.includes("e-btn-goto-ok")&&or(s.element)}else l&&9===e.keyCode&&e.shiftKey&&this.focusEle(e,".e-formula-bar",!1,!0);fe={action:"getCurrentEditValue",editedValue:""};this.parent.notify(Yn,fe);var C=k(fe.editedValue,!0);return void(this.parent.isEdit&&C&&e.shiftKey&&!e.ctrlKey&&Pt(e.keyCode)&&this.shiftSelection(e))}var b=this.parent.getActiveSheet(),x=u(b.activeCell);if(e.altKey){if(40===e.keyCode){if(n.classList.contains("e-dropdown-btn")||n.classList.contains("e-split-btn"))return;var S={e:e,isFilterCell:!1};if(this.parent.notify("filterCellKeyDown",S),S.isFilterCell)return}if(40===e.keyCode&&!document.getElementById(this.parent.element.id+"listValid_popup")&&(he=this.parent.getCell(x[0],x[1]))){var w=he.querySelector(".e-validation-list .e-ddl");if(w){or(w);var I=w.querySelector(".e-dropdownlist")||w;return void((g=t.getComponent(I,"dropdownlist"))&&g.showPopup())}}}n.id===this.parent.element.id+"_File"&&or(this.parent.element);var E=n.classList.contains("e-add-sheet-tab")||n.classList.contains("e-sheets-list")||n.classList.contains("e-tab-wrap")&&!!t.closest(n,".e-sheet-tabs-items")||n.classList.contains("e-aggregate-list")||n.classList.contains("e-scroll-nav");[9,37,38,39,40,33,34,35,36].indexOf(e.keyCode)>-1&&!E&&e.preventDefault();var R,N=c(b.selectedRange);if(36===e.keyCode){var F=this.parent.frozenColCount(b),A=void 0;if(e.ctrlKey||e.metaKey){var O=j(b,this.parent.frozenRowCount(b),!0);e.shiftKey?A=[x[0],x[1],O,j(b,F,!0,"columns")]:(A=[O,j(b,F,!0,"columns"),O])[3]=A[1],(H=this.parent.element.querySelector(".e-main-panel")).scrollTop&&(H.scrollTop=0);var T=this.parent.getScrollElement();T.scrollLeft&&(T.scrollLeft=0)}else if(e.shiftKey){D=j(b,F,!0,"columns");A=b.frozenColumns&&j(b,x[1],!0,"columns")===D?[N[0],x[1],N[2],j(b,0,!0,"columns")]:[N[0],x[1],N[2],D],this.scrollNavigation([A[2],A[3]],!0)}else{var D=j(b,F,!0,"columns");!b.frozenColumns||D!==x[1]&&F!==x[1]||(D=j(b,0,!0,"columns")),A=[x[0],D,x[0],D],this.scrollNavigation([A[0],A[1]],!0)}this.updateSelection(b,A,e)}else if(e.ctrlKey||e.metaKey){if(35===e.keyCode){e.preventDefault();var L=j(b,b.usedRange.rowIndex,!1);L=L>-1?L:b.usedRange.rowIndex;var P=j(b,b.usedRange.colIndex,!1,"columns");P=P>-1?P:b.usedRange.colIndex,e.shiftKey||(x[0]=L,x[1]=P),x[2]=L,x[3]=P,this.updateSelection(b,x.concat(x),e),this.scrollNavigation([L,P],!0)}else 32===e.keyCode&&!e.shiftKey&&a&&(N[0]=0,N[2]=b.rowCount-1,this.updateSelection(b,N,{shiftKey:!0}));if(40===e.keyCode||39===e.keyCode||38===e.keyCode||37===e.keyCode)e.shiftKey?(40===e.keyCode?N[2]=this.getNextNonEmptyCell(N[2],x[1],"down"):39===e.keyCode&&!i||37===e.keyCode&&i?N[3]=this.getNextNonEmptyCell(x[0],N[3],"right"):38===e.keyCode?N[2]=this.getNextNonEmptyCell(N[2],x[1],"top"):N[3]=this.getNextNonEmptyCell(x[0],N[3],"left"),this.updateSelection(b,N,e),this.scrollNavigation([N[2],N[3]],!0)):(37===e.keyCode&&!i||39===e.keyCode&&i?x[1]=this.getNextNonEmptyCell(x[0],x[1],"left"):38===e.keyCode?x[0]=this.getNextNonEmptyCell(x[0],x[1],"top"):39===e.keyCode&&!i||37===e.keyCode&&i?x[1]=this.getNextNonEmptyCell(x[0],x[1],"right"):x[0]=this.getNextNonEmptyCell(x[0],x[1],"down"),this.parent.selectRange(m(x)),this.scrollNavigation([x[0],x[1]],!0));else if(117===e.keyCode){var M=document.activeElement;M.classList.contains("e-spreadsheet")||t.closest(M,".e-sheet")?this.setFocus("Sheet",e,!0):E?this.setFocus("SheetTabs",e):t.closest(M,".e-ribbon")?this.setFocus("Ribbon",e):(l||M.classList.contains("e-insert-function"))&&this.setFocus("FormulaBar",e)}}else{if(e.shiftKey){if(32===e.keyCode&&a&&(e.preventDefault(),N[1]=0,N[3]=b.colCount-1,this.updateSelection(b,N,e)),this.shiftSelection(e),(34===e.keyCode||33===e.keyCode)&&this.parent.scrollModule&&this.parent.scrollModule.isKeyScroll){var B=0,H=this.parent.element.querySelector(".e-main-panel"),U=j(b,u(b.paneTopLeftCell)[0],!0),V=hr(this.parent,U).height;if(34===e.keyCode)B=V+this.parent.scrollModule.offset.top.size,this.parent.scrollSettings.isFinite||(G=this.parent.getMainContent().querySelector(".e-virtualtrack"))&&parseFloat(G.style.height)<B+V&&(G.style.height=B+V+"px");else if(B=this.parent.scrollModule.offset.top.size-V,Math.round(B)<0){if(!H.scrollTop)return void this.parent.selectRange(m([N[0],N[1],U,N[3]]));B=0}var z=j(b,c(b.selectedRange)[2],!0),_=U>z?0:z-U;this.parent.scrollModule&&H.scrollTop&&(this.parent.scrollModule.isKeyScroll=!1),H.scrollTop=B,ft(function(){34===e.keyCode?(N[2]=j(b,u(b.paneTopLeftCell)[0]+_,!0),r.parent.scrollSettings.isFinite&&N[2]>b.rowCount-1&&(N[2]=j(b,b.rowCount-1,!1),N[2]=N[2]<0?0:N[2])):(N[2]=j(b,u(b.paneTopLeftCell)[0]+_,!1),N[2]=N[2]<0?0:N[2]),r.updateSelection(b,N,e)})}}else if(9===e.keyCode||(this.parent.enableRtl?37===e.keyCode:39===e.keyCode)){if((he=He(x[0],x[1],b))&&he.colSpan>1&&(x[1]+=he.colSpan-1),x[1]<b.colCount-1&&(!b.isProtected||b.protectSettings.selectCells))x[1]+=1,R=!0;else if(b.protectSettings.selectUnLockedCells){K=this.getNextUnlockedCell("right",x);R=x[1]!==K[1]||x[0]!==K[0],x[1]=K[1],x[0]=K[0]}}else if(13===e.keyCode||40===e.keyCode){if((he=He(x[0],x[1],b))&&he.rowSpan>1&&(x[0]+=he.rowSpan-1),x[0]<b.rowCount-1&&(!b.isProtected||b.protectSettings.selectCells))R=!0,x[0]+=1;else if(b.protectSettings.selectUnLockedCells){K=this.getNextUnlockedCell("down",x);R=x[0]!==K[0]||x[1]!==K[1],x[1]=K[1],x[0]=K[0]}}else if((34===e.keyCode||33===e.keyCode)&&this.parent.scrollModule&&this.parent.scrollModule.isKeyScroll){var H=this.parent.element.querySelector(".e-main-panel"),B=0,q=j(b,u(b.paneTopLeftCell)[0],!0),W=j(b,u(b.activeCell)[0],!0),V=hr(this.parent,q).height;if(34===e.keyCode){if(B=this.parent.scrollModule.offset.top.size+V,!this.parent.scrollSettings.isFinite){var G=this.parent.getMainContent().querySelector(".e-virtualtrack");G&&parseFloat(G.style.height)<B+V&&(G.style.height=B+V+"px")}}else{if(B=this.parent.scrollModule.offset.top.size-V,b.frozenRows&&x[0]<this.parent.frozenRowCount(b))return void this.parent.selectRange(m([q,N[1],q,N[1]]));if(Math.round(B)<0){if(!H.scrollTop)return;B=0}}var X=q>W?0:W-q;this.parent.scrollModule&&H.scrollTop&&(this.parent.scrollModule.isKeyScroll=!1),H.scrollTop=B,ft(function(){var t;34===e.keyCode?(t=j(b,u(b.paneTopLeftCell)[0]+X,!0),r.parent.scrollSettings.isFinite&&t>b.rowCount-1&&(t=(t=j(b,b.rowCount-1,!1))<0?0:t)):(t=u(b.paneTopLeftCell)[0]+X,t-=r.parent.hiddenCount(q,W),t=(t=j(b,t,!1))<0?0:t),r.parent.notify("cellNavigate",{range:[t,x[1],t,x[1]],preventAnimation:!0})})}if(e.shiftKey?9===e.keyCode:this.parent.enableRtl?39===e.keyCode:37===e.keyCode){if(x[1]>0&&(!b.isProtected||b.protectSettings.selectCells))x[1]-=1,R=!0;else if(b.protectSettings.selectUnLockedCells){var K=this.getNextUnlockedCell("left",x);R=x[1]!==K[1]||x[0]!==K[0],x[1]=K[1],x[0]=K[0]}if(x[1]<=0){var $=this.parent.getMainContent();0===x[1]&&$.scrollLeft&&!this.parent.enableRtl&&($.scrollLeft=0)}}else if((e.shiftKey?13===e.keyCode:38===e.keyCode)&&!this.parent.element.querySelector(".e-find-toolbar")){if(x[0]>0&&(!b.isProtected||b.protectSettings.selectCells))x[0]-=1,R=!0;else if(b.protectSettings.selectUnLockedCells){var Z=this.getNextUnlockedCell("up",x);R=x[0]!==Z[0]||x[1]!==Z[1],x[1]=Z[1],x[0]=Z[0]}if(x[0]<=0){var J=this.parent.getMainContent().parentElement;0===x[0]&&J.scrollTop&&(J.scrollTop=0)}}}if(!R||this.parent.scrollModule&&!this.parent.scrollModule.isKeyScroll||E||t.closest(document.activeElement,".e-ribbon")||n.classList.contains("e-insert-function")||n.classList.contains("e-formula-bar")&&(!n.classList.contains("e-formula-bar")||"TEXTAREA"!==n.nodeName||13!==e.keyCode)){if(9===e.keyCode){var Q=this.parent.showRibbon&&t.closest(document.activeElement,".e-ribbon");if(Q)t.closest(document.activeElement,".e-tab-header")?e.shiftKey||Q.classList.contains("e-collapsed")?this.focusEle(e,".e-ribbon .e-drop-icon"):this.focusEle(e,".e-ribbon .e-content .e-toolbar-item:not(.e-separator):not(.e-overlay):not(.e-hide) .e-btn"):t.closest(document.activeElement,".e-content")?e.shiftKey?this.focusEle(e,".e-ribbon .e-toolbar-items .e-toolbar-item.e-active .e-tab-wrap",!0):this.focusEle(e,".e-ribbon .e-drop-icon"):document.activeElement.classList.contains("e-drop-icon")&&(e.shiftKey&&!Q.classList.contains("e-collapsed")?this.focusEle(e,".e-ribbon .e-content .e-toolbar-item:not(.e-separator):not(.e-overlay):not(.e-hide) .e-btn"):this.focusEle(e,".e-ribbon .e-toolbar-items .e-toolbar-item.e-active .e-tab-wrap",!0));else if(n.classList.contains("e-insert-function"))e.shiftKey?this.focusEle(e,".e-formula-bar-panel .e-combobox"):this.focusEle(e,".e-formula-bar",!1,!0);else if(E)if(e.shiftKey){var ee=n.classList.contains("e-aggregate-list")||n.classList.contains("e-scroll-left-nav");if(n.classList.contains("e-add-sheet-tab")||ee||n.classList.contains("e-sheets-list")&&n.previousElementSibling&&n.previousElementSibling.disabled){var te=!ee&&this.parent.element.querySelector(".e-aggregate-list");te?this.focusEle(e,null,!1,!1,te):!n.classList.contains("e-scroll-left-nav")&&this.parent.element.querySelector(".e-sheet-tab-panel .e-scroll-nav")?this.focusEle(e,".e-sheet-tab-panel .e-scroll-right-nav",!0):(ne=[].slice.call(this.parent.element.querySelectorAll(".e-sheet-tab-panel .e-toolbar-item")))[ne.length-1]&&this.focusEle(e,null,!0,!1,ne[ne.length-1].querySelector(".e-tab-wrap"))}else n.classList.contains("e-scroll-right-nav")?this.focusEle(e,".e-sheet-tab-panel .e-scroll-left-nav",!0):n.classList.contains("e-tab-wrap")&&(0===(K=(ne=[].slice.call(this.parent.element.querySelectorAll(".e-sheet-tab-panel .e-toolbar-item"))).indexOf(n.parentElement))?this.focusEle(e,".e-sheet-tab-panel .e-sheets-list"):this.focusEle(e,null,!0,!1,ne[K-1].querySelector(".e-tab-wrap")))}else{var re=!!this.parent.element.querySelector(".e-aggregate-list");if(n.classList.contains("e-aggregate-list")||!re&&n.classList.contains("e-scroll-right-nav"))this.focusEle(e,".e-sheet-tab-panel .e-icon-btn:not(:disabled)");else if(n.classList.contains("e-sheets-list"))this.focusEle(e,".e-sheet-tab-panel .e-toolbar-item .e-tab-wrap",!0);else if(n.classList.contains("e-scroll-left-nav"))this.focusEle(e,".e-sheet-tab-panel .e-scroll-right-nav",!0);else if(n.classList.contains("e-tab-wrap")){var ne=[].slice.call(this.parent.element.querySelectorAll(".e-sheet-tab-panel .e-toolbar-item")),ie=ne.indexOf(n.parentElement);if(ie===ne.length-1){var ae=!!this.parent.element.querySelector(".e-sheet-tab-panel .e-scroll-nav");!ae&&re||this.focusEle(e,".e-sheet-tab-panel ."+(ae?"e-scroll-nav":"e-icon-btn:not(:disabled)"),ae)}else this.focusEle(e,null,!0,!1,ne[ie+1].querySelector(".e-tab-wrap"))}}}}else{if(40===e.keyCode||38===e.keyCode||13===e.keyCode)for(;tt(b,x[0]);)if((40===e.keyCode||!e.shiftKey&&13===e.keyCode)&&(x[0]=x[0]+1),(38===e.keyCode||e.shiftKey&&13===e.keyCode)&&(x[0]=x[0]-1,x[0]<0))return;if(37===e.keyCode||39===e.keyCode||9===e.keyCode)for(;ht(b,x[1]);)if((39===e.keyCode||!e.shiftKey&&9===e.keyCode)&&(x[1]=x[1]+1),(37===e.keyCode||e.shiftKey&&9===e.keyCode)&&(x[1]=x[1]-1,x[1]<0))return;var oe=c(b.topLeftCell);b.frozenRows&&x[0]<oe[0]&&(x[0]=j(b,oe[0],!0)),b.frozenColumns&&x[1]<oe[1]&&(x[1]=j(b,oe[1],!0,"columns")),this.scrollNavigation(x);var se=m(x),le=function(e){if(se!==b.selectedRange){r.parent.selectionModule.previousActiveCell=b.activeCell,document.getElementsByClassName("e-addNoteContainer")&&document.getElementsByClassName("e-addNoteContainer").length>0&&r.parent.notify("removeNoteContainer",""),r.parent.setSheetPropertyOnMute(b,"activeCell",se),r.parent.notify("cellNavigate",{range:x.concat(x),preventAnimation:e});var n;t.Browser.isDevice&&"safari"===t.Browser.info.name&&(t.Browser.isIos||t.Browser.isIos7)&&(n=r.parent.element.querySelector(".e-ss-focus-edit")),(n=n||r.parent.getCell(x[0],x[1]))&&or(n)}};if(this.parent.scrollModule&&this.parent.scrollModule.isKeyScroll){if(se===b.selectedRange)return;ft(le.bind(this,!0))}else le()}121===e.keyCode&&e.shiftKey&&!this.parent.enableKeyboardShortcut&&e.preventDefault()}else if("Escape"===e.key||27===e.keyCode){var de=!t.isNullOrUndefined(this.parent.spreadsheetNoteModule.noteCellIndexes)?this.parent.spreadsheetNoteModule.noteCellIndexes:u(this.parent.getActiveSheet().activeCell),he=He(de[0],de[1],this.parent.getActiveSheet()),pe=this.parent.getCell(de[0],de[1]),ce=Le(this.parent,this.parent.activeSheetIndex)+"!"+m(de);if(!t.isNullOrUndefined(o)&&!t.isNullOrUndefined(o.value)&&(t.isNullOrUndefined(he)||t.isNullOrUndefined(he.notes)||he.notes!==o.value)&&document.activeElement.className.indexOf("e-addNoteContainer")>-1){var ue=!t.isNullOrUndefined(he)&&he.notes?"editNote":"addNote";this.parent.notify("setActionData",{args:{action:"beforeCellSave",eventArgs:{address:ce}}}),Y(this.parent,this.parent.getActiveSheet(),{rowIdx:de[0],colIdx:de[1],preventEvt:!0,cell:{notes:o.value,isNoteEditable:!1}});var fe={notes:o.value,address:ce};this.parent.notify(ci,{eventArgs:fe,action:ue})}this.parent.spreadsheetNoteModule.isShowNote=null,this.parent.notify("removeNoteContainer",""),or(pe)}},e.prototype.setFocus=function(e,t,r){"Sheet"===e?t.shiftKey?this.parent.showFormulaBar?this.focusEle(t,".e-formula-bar-panel .e-combobox"):this.setFocus("FormulaBar",t,r):this.parent.showSheetTabs?this.focusEle(t,".e-sheet-tab-panel .e-icon-btn:not(:disabled)"):this.setFocus("SheetTabs",t,r):"SheetTabs"===e?t.shiftKey?r||this.focusEle(t,".e-selectall"):this.parent.showRibbon?this.focusEle(t,".e-ribbon .e-toolbar-items .e-toolbar-item.e-active .e-tab-wrap",!0):this.setFocus("Ribbon",t,r):"Ribbon"===e?t.shiftKey?this.parent.showSheetTabs?this.focusEle(t,".e-sheet-tab-panel .e-icon-btn:not(:disabled)"):r||this.focusEle(t,".e-selectall"):this.parent.showFormulaBar?this.focusEle(t,".e-formula-bar-panel .e-combobox"):this.setFocus("FormulaBar",t,r):"FormulaBar"===e&&(t.shiftKey?this.parent.showRibbon?this.focusEle(t,".e-ribbon .e-toolbar-items .e-toolbar-item.e-active .e-tab-wrap",!0):this.setFocus("Ribbon",t,r):r||this.focusEle(t,".e-selectall"))},e.prototype.focusEle=function(e,r,n,i,a){if(a=a||this.parent.element.querySelector(r),n&&!a){var o=(s=this.parent.element.querySelector(".e-ribbon .e-tab"))&&t.getComponent(s,"tab").selectedItem||0;a=(a=this.parent.element.querySelector(".e-tab-header").getElementsByClassName("e-toolbar-item")[o])&&a.querySelector(".e-tab-wrap")}if(a)if(e.preventDefault(),i)a.click(),or(a),a.setSelectionRange(a.value.length,a.value.length);else if(n){if(a.setAttribute("tabindex","0"),a.parentElement.classList.contains("e-active")&&a.parentElement.classList.contains("e-toolbar-item")){var s=this.parent.element.querySelector(".e-sheet-tab-panel .e-sheet-tab");!s&&s.classList.contains("e-focused")&&s.classList.add("e-focused")}a.focus()}else or(a)},e.prototype.updateSelection=function(e,t,r){e.isProtected&&!e.protectSettings.selectCells&&e.protectSettings.selectUnLockedCells?sr(this.parent,w(t))||this.parent.notify("cellNavigate",{range:t,shiftKey:r.shiftKey}):this.parent.notify("cellNavigate",{range:t,shiftKey:r.shiftKey})},e.prototype.getNextNonEmptyCell=function(e,r,n){var i,a,o=this.parent.getActiveSheet(),s=function(e,r){var n=He(e,r,o,null,!0).value;return!t.isNullOrUndefined(n)&&""!==n};if("down"===n){i=s(h=j(o,e+1,!0),r);for(var l=j(o,o.rowCount-1,!1),d=h;d<o.rowCount;d++){if(d===l)return d;if(i){if(!s(j(o,d,!0),r))return j(o,d-1,!1)}else if(a=j(o,d+1,!0),s(a,r))return a}return e}if("top"===n){var h=j(o,e-1,!1);i=s(h,r);for(var p=this.parent.frozenRowCount(o)?c(o.topLeftCell)[0]:0,u=j(o,p,!0),f=h;f>=0;f--){if(f===u)return f;if(i){if(!s(j(o,f,!1),r))return j(o,f+1,!0)}else if(a=j(o,f-1,!1),s(a,r))return a}return e}if("right"===n){i=s(e,v=j(o,r+1,!0,"columns"));for(var g=j(o,o.colCount-1,!1,"columns"),m=v;m<o.colCount;m++){if(m===g)return m;if(i){if(!s(e,j(o,m,!0,"columns")))return j(o,m-1,!1,"columns")}else if(a=j(o,m+1,!0,"columns"),s(e,a))return a}return r}var v=j(o,r-1,!1,"columns");i=s(e,v);for(var p=this.parent.frozenColCount(o)?c(o.topLeftCell)[1]:0,u=j(o,p,!0,"columns"),y=v;y>=0;y--){if(y===u)return y;if(i){if(!s(e,j(o,y,!1,"columns")))return j(o,y+1,!0,"columns")}else if(a=j(o,y-1,!1,"columns"),s(e,a))return a}return r},e.prototype.getNextUnlockedCell=function(e,t){var r,n,i=this.parent.getActiveSheet();if("right"===e)for(var a=t[0],o=void 0,s=void 0,l=i.usedRange.rowIndex,d=i.usedRange.colIndex;a<=l;){for(o=void 0===o?t[1]+1:0,s&&a===t[0]&&(d=t[1]-1),o;o<=d;o++)if(r=He(a,o,i),n=ot(i,o)||{},!U(r,n)&&!n.hidden&&!tt(i,a))return[a,o];a!==i.usedRange.rowIndex||s?a++:(a=0,l=t[0],s=!0)}else if("left"===e)for(var a=t[0],o=void 0,s=void 0,l=0,d=0;a>=l;){for(o=void 0===o?t[1]-1:i.usedRange.colIndex,s&&a===t[0]&&(d=t[1]+1),o;o>=d;o--)if(r=He(a,o,i),n=ot(i,o)||{},!U(r,n)&&!n.hidden&&!tt(i,a))return[a,o];0!==a||s?a--:(a=i.usedRange.rowIndex,l=t[0],s=!0)}else if("down"===e)for(var o=t[1],a=void 0,s=void 0,d=i.usedRange.colIndex,l=i.usedRange.rowIndex;o<=d;){for(a=void 0===a?t[0]+1:0,s&&o===t[1]&&(l=t[0]-1),a;a<=l;a++)if(r=He(a,o,i),n=ot(i,o)||{},!U(r,n)&&!n.hidden&&!tt(i,a))return[a,o];o!==i.usedRange.colIndex||s?o++:(o=0,d=t[1],s=!0)}else for(var o=t[1],a=void 0,s=void 0,d=0,l=0;o>=d;){for(a=void 0===a?t[0]-1:i.usedRange.rowIndex,s&&o===t[1]&&(l=t[0]+1),a;a>=l;a--)if(r=He(a,o,i),n=ot(i,o)||{},!U(r,n)&&!n.hidden&&!tt(i,a))return[a,o];0!==o||s?o--:(o=i.usedRange.colIndex,d=t[1],s=!0)}return t},e.prototype.shiftSelection=function(e){var r=this.parent.getActiveSheet(),n=c(r.selectedRange),i=w(n),a=!0,o=this.parent.enableRtl;if(38===e.keyCode){for(s=i[1];s<=i[3];s++){l=He(n[2],s,r);if(!t.isNullOrUndefined(l)&&l.rowSpan&&l.rowSpan<0){n[2]=j(r,n[2]-(Math.abs(l.rowSpan)+1),!1),a=!1;break}}a&&(n[2]=j(r,n[2]-1,!1));d=this.parent.frozenRowCount(r)?c(r.topLeftCell)[0]:0;if(n[2]<d)return}if(40===e.keyCode){for(s=i[1];s<=i[3];s++){l=He(n[2],s,r);if(!t.isNullOrUndefined(l)&&l.rowSpan&&l.rowSpan>0){n[2]=j(r,n[2]+Math.abs(l.rowSpan),!0),a=!1;break}}if(a&&(n[2]=j(r,n[2]+1,!0)),n[2]>=r.rowCount&&(n[2]=j(r,r.rowCount-1,!1),n[2]<0))return}if(39===e.keyCode&&!o||37===e.keyCode&&o){for(s=i[0];s<=i[2];s++){l=He(s,n[3],r);if(!t.isNullOrUndefined(l)&&l.colSpan&&l.colSpan>0){n[3]=j(r,n[3]+Math.abs(l.colSpan),!0,"columns"),a=!1;break}}if(a&&(n[3]=j(r,n[3]+1,!0,"columns")),n[3]>=r.colCount&&(n[3]=j(r,r.colCount-1,!1,"columns"),n[3]<0))return}if(37===e.keyCode&&!o||39===e.keyCode&&o){for(var s=i[0];s<=i[2];s++){var l=He(s,n[3],r);if(!t.isNullOrUndefined(l)&&l.colSpan&&l.colSpan<0){n[3]=j(r,n[3]-(Math.abs(l.colSpan)+1),!1,"columns"),a=!1;break}}a&&(n[3]=j(r,n[3]-1,!1,"columns"));var d=this.parent.frozenColCount(r)?c(r.topLeftCell)[1]:0;if(n[3]<d)return}if(!this.parent.scrollSettings.enableVirtualization&&e.shiftKey&&e.ctrlKey){var h=[r.usedRange.rowIndex,r.usedRange.colIndex];if(37===e.keyCode&&(n[3]<=h[1]?n[3]=j(r,0,!0,"columns"):n[3]=j(r,h[1],!0,"columns")),38===e.keyCode&&(n[2]<=h[0]?n[2]=j(r,0,!0):n[2]=j(r,h[0],!0)),39===e.keyCode&&(n[3]<=h[1]?n[3]=j(r,h[1],!1,"columns"):n[3]=j(r,r.colCount,!1,"columns"),n[3]<0))return;if(40===e.keyCode&&(n[2]<=h[0]?n[2]=j(r,h[0],!1):n[2]=j(r,r.rowCount,!1),n[2]<0))return}if(37===e.keyCode||39===e.keyCode||38===e.keyCode||40===e.keyCode){var p=u(r.activeCell);this.parent.isEdit&&e.shiftKey?(e.preventDefault(),this.parent.notify("rangeSelectionByKeydown",{range:n,e:e}),this.parent.notify("addressHandle",{range:m(w(n)),isSelect:!1}),this.parent.notify("initiateCur",{})):this.parent.notify("cellNavigate",{range:n,shiftKey:e.shiftKey}),this.scrollNavigation([L(r,n)?p[0]:n[2],D(r,n)?p[1]:n[3]])}},e.prototype.scrollNavigation=function(e,t){if(this.parent.allowScrolling){var r=this.parent.enableRtl?-1:1,n=this.parent.getMainContent().parentElement,i=this.parent.getScrollElement(),a=this.parent.getActiveSheet(),o=w(c(a.selectedRange)),s=u(a.topLeftCell),l=this.parent.frozenRowCount(a),d=this.parent.frozenColCount(a),h=u(a.paneTopLeftCell),p=j(a,e[0]<l?s[0]:h[0],!0),f=this.parent.scrollModule.offset.top.size;if(n.scrollTop)if(l&&e[0]!==o[2]){if(e[0]===l)return void(n.scrollTop=0);e[0]===l-1&&(n.scrollTop=0)}else if(e[0]===j(a,0,!0))return void(n.scrollTop=0);if(i&&i.scrollLeft)if(d&&e[1]!==o[3]){if(e[1]===d)return void(i.scrollLeft=0);e[1]===d-1&&(i.scrollLeft=0)}else if(e[1]===j(a,0,!0,"columns"))return void(i.scrollLeft=0);var g=hr(this.parent,p).index;if(g<=e[0]){if(e[0]>=l)if(t){var m=n.getBoundingClientRect().height,v=at(a,h[0],e[0],!0);n.scrollTop=v>2*m?f+v-m:f+v-nt(a,e[0],!0),or(this.parent.element)}else n.scrollTop=f+at(a,g,e[0],!0)}else p>e[0]&&(n.scrollTop&&(this.parent.scrollModule.isKeyScroll=!1),n.scrollTop=f-Math.ceil(at(a,e[0],p-1,!0)),t&&or(this.parent.element));var y=pr(this.parent,h[1]);if(y<=e[1]&&i){if(e[1]>=d)if(t){var C=i.getBoundingClientRect().width,b=dt(a,h[1],e[1],!0);i.scrollLeft=b>2*C?(this.parent.scrollModule.offset.left.size+b-C)*r:(this.parent.scrollModule.offset.left.size+(b-lt(a,e[0],null,!0)))*r,or(this.parent.element)}else i.scrollLeft=(this.parent.scrollModule.offset.left.size+dt(a,y,e[1],!0))*r}else h[1]>e[1]&&i&&(i.scrollLeft&&(this.parent.scrollModule.isKeyScroll=!1),i.scrollLeft=(this.parent.scrollModule.offset.left.size-dt(a,e[1],h[1]-1,!0))*r,t&&or(this.parent.element))}},e.prototype.getModuleName=function(){return"keyboardNavigation"},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e}(),Ja=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on($n,this.keyDownHandler,this),this.parent.on(Kn,this.keyUpHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off($n,this.keyDownHandler),this.parent.off(Kn,this.keyUpHandler))},e.prototype.isTrgtNotInput=function(e){var r=e.target;return!(t.closest(r,".e-filter-popup")||t.closest(r,".e-find-dlg")||t.closest(r,".e-hyperlink-dlg")||t.closest(r,".e-sheet-tab")||t.closest(r,".e-name-box")||t.closest(r,".e-link-dialog"))},e.prototype.ribbonShortCuts=function(e){if(this.parent.showRibbon&&e.altKey&&!e.ctrlKey&&!e.shiftKey){var r=t.getComponent(this.parent.element.querySelector(".e-ribbon .e-tab"),"tab"),n=void 0;if(72===e.keyCode)n=1;else if(78===e.keyCode)n=2;else if(65===e.keyCode)n=4;else if(87===e.keyCode)n=5;else if(77===e.keyCode)n=3;else if(70===e.keyCode)e.preventDefault(),t.select("#"+this.parent.element.id+"_File",this.parent.element).click();else if(18===e.keyCode){e.preventDefault();var i=u(this.parent.getActiveSheet().activeCell),a={sheetIdx:this.parent.activeSheetIndex};if(this.parent.notify("getFilterRange",a),!(a.hasFilter&&a.filterRange&&a.filterRange[0]===i[0]&&a.filterRange[1]<=i[1]&&a.filterRange[3]>=i[1])){var o=document.activeElement;if(!(o.classList.contains("e-spreadsheet-edit")||o.classList.contains("e-sheet-rename")||o.id===this.parent.element.id+"_name_box"||t.closest(o,".e-dropdown-btn")||t.closest(o,".e-split-btn")||t.closest(o,".e-popup-open"))){var s=this.parent.getCell(i[0],i[1]);if(s&&s.querySelector(".e-validation-list"))return;if(t.closest(o,".e-ribbon"))return void or(this.parent.element);for(var l=0;l<=this.parent.ribbonModule.ribbon.items.length;l++)if(l===this.parent.ribbonModule.ribbon.selectedTab){var d=this.parent.element.querySelector(".e-toolbar-items").children[l+2].children[0];return d.setAttribute("tabindex","0"),void or(d)}}}}n&&(r.items[n].disabled||r.items[n].cssClass.includes("e-hide")?or(this.parent.element):(e.preventDefault(),r.select(n,Object.assign(e,{isShortcut:!0}))))}},e.prototype.keyUpHandler=function(e){if(37===e.keyCode||39===e.keyCode){var r=document.activeElement;if(r.classList.contains("e-colorpicker-wrapper")||r.classList.contains("e-split-btn-wrapper")){var n=r.querySelector(".e-split-btn");n&&or(n)}}else if(13===e.keyCode){var i=e.target;if(i.classList.contains("e-scroll-nav")){var a=function(){i.getAttribute("tabindex")||(i.setAttribute("tabindex","0"),or(i)),t.EventHandler.remove(i,"blur",a)};t.EventHandler.add(i,"blur",a,this)}}},e.prototype.keyDownHandler=function(e){var r="None"===this.parent.selectionSettings.mode;this.ribbonShortCuts(e);var n=this.parent.getActiveSheet(),i=e.target,a=e.target;if(t.isNullOrUndefined(a)||!a.classList.contains("e-addNoteContainer")){if((e.ctrlKey||e.metaKey)&&this.isTrgtNotInput(e)){t.closest(i,".e-find-dlg")||r||([79,83].indexOf(e.keyCode)>-1?e.preventDefault():65!==e.keyCode||this.parent.isEdit||e.preventDefault());y=u(n.activeCell);if(79===e.keyCode)this.parent.allowOpen&&this.parent.openUrl&&t.select("#"+this.parent.element.id+"_fileUpload",this.parent.element).click();else if(83===e.keyCode)this.parent.saveUrl&&this.parent.allowSave&&this.parent.notify("exportDialog",null);else if(67!==e.keyCode||r)if(75!==e.keyCode||r)if(90!==e.keyCode||r)if(89!==e.keyCode||r){if((82===e.keyCode||68===e.keyCode)&&!r){e.preventDefault();var o=w(c(n.selectedRange)),s={colIndex:o[1],rowIndex:o[0]},l=void 0,d=void 0;if(68===e.keyCode?(o[0]===o[2]?s.rowIndex=o[0]-1:o[0]+=1,d=m([s.rowIndex,s.colIndex,s.rowIndex,o[3]]),l="Down"):(o[1]===o[3]?s.colIndex=o[1]-1:o[1]+=1,l="Right",d=m([s.rowIndex,s.colIndex,o[2],s.colIndex])),s.rowIndex<0||s.colIndex<0)return;this.parent.notify("performAutoFill",{fillType:He(s.rowIndex,s.colIndex,n,!1,!0).formula?"FillSeries":"CopyCells",dAutoFillCell:d,rangeInfo:{direction:l,startCell:s,endCell:{rowIndex:o[2],colIndex:o[3]},fillRange:o}}),this.parent.notify("selectionComplete",{type:"mousedown"}),this.parent.notify(Sn,null)}}else this.parent.isEdit||(e.preventDefault(),this.parent.notify(hi,{isUndo:!1}));else this.parent.isEdit||(e.preventDefault(),this.parent.notify(hi,{isUndo:!0}));else{var h=n.rows[y[0]],p=void 0;e.preventDefault(),t.isNullOrUndefined(h)||(p=h.cells[y[1]]),t.isNullOrUndefined(p)&&Ue(y[0],y[1],n,p,!1),p&&p.hyperlink?this.parent.notify("editHyperlink",null):this.parent.notify("initiateHyperlink",null)}else this.parent.notify(ei,{promise:Promise});var f=n.isProtected&&U(He(y[0],y[1],n),ot(n,y[1]));if(70===e.keyCode&&!r&&this.parent.allowFindAndReplace&&(e.preventDefault(),this.parent.notify("findToolDlg",{})),f&&n.isProtected&&86!==e.keyCode||70===e.keyCode||r||(71===e.keyCode?(e.preventDefault(),this.parent.notify(gi,null)):72===e.keyCode?(e.preventDefault(),this.parent.notify(mi,null)):88===e.keyCode?this.parent.notify(Qn,{promise:Promise}):86===e.keyCode&&this.parent.notify(ti,{isAction:!0}),!e.shiftKey||76!==e.keyCode||this.parent.isEdit||n.isProtected||(e.preventDefault(),this.parent.notify(pi,{}))),!r&&(!n.isProtected||n.protectSettings.formatCells))if(66===e.keyCode)e.preventDefault(),g="bold"===(g=this.parent.getCellStyleValue(["fontWeight"],y).fontWeight)?"normal":"bold",this.parent.notify(Yr,{style:{fontWeight:g},onActionUpdate:!0,refreshRibbon:!0});else if(73===e.keyCode){e.preventDefault();var g=this.parent.getCellStyleValue(["fontStyle"],y).fontStyle;g="italic"===g?"normal":"italic",this.parent.notify(Yr,{style:{fontStyle:g},onActionUpdate:!0,refreshRibbon:!0})}else e.ctrlKey&&85===e.keyCode&&!e.shiftKey?(e.preventDefault(),this.parent.notify("textDecorationUpdate",{style:{textDecoration:"underline"},refreshRibbon:!0})):e.ctrlKey&&53===e.keyCode&&!e.shiftKey&&(e.preventDefault(),this.parent.notify("textDecorationUpdate",{style:{textDecoration:"line-through"},refreshRibbon:!0}))}if(27===e.keyCode&&this.parent.notify("clearCopy",null),((e.ctrlKey||e.metaKey)&&119===e.keyCode||13===e.keyCode&&i.classList.contains("e-drop-icon"))&&this.parent.showRibbon){e.preventDefault();var v=this.parent.element.querySelector(".e-drop-icon");v&&v.click()}if((e.ctrlKey||e.metaKey)&&!r)if(57===e.keyCode){if(!n.isProtected||n.protectSettings.formatRows){e.preventDefault();y=c(n.selectedRange);this.parent.notify(vn,{startIndex:y[0],endIndex:y[2],hide:!e.shiftKey,isCol:!1,actionUpdate:!0})}}else if(48===e.keyCode&&(!n.isProtected||n.protectSettings.formatColumns)){var y=c(n.selectedRange);this.parent.notify(vn,{startIndex:y[1],endIndex:y[3],hide:!e.shiftKey,isCol:!0,actionUpdate:!0})}if(e.shiftKey&&!r)if(113!==e.keyCode||n.isProtected){if(114===e.keyCode)e.preventDefault(),this.parent.notify("renderInsertDlg",null);else if(116===e.keyCode&&this.parent.allowFindAndReplace)e.preventDefault(),this.parent.notify("findToolDlg",{});else if(121===e.keyCode){var C=document.activeElement.className;["e-spreadsheet","e-cell","e-header-cell","e-clipboard","e-rowhdr-table","e-selectall-table","e-main-panel"].some(function(e){return C.includes(e)})&&this.focusTarget(n)}}else e.preventDefault(),e.target.children.length>0&&"string"==typeof e.target.children[e.target.children.length-1].className&&e.target.children[e.target.children.length-1].className.indexOf("e-addNoteIndicator")>-1?this.parent.notify("editNote",null):this.parent.notify("addNote",null);if(e.altKey&&!r&&((e.ctrlKey||e.metaKey)&&78===e.keyCode?(e.preventDefault(),this.parent.refresh(!0)):113===e.keyCode&&this.parent.saveUrl&&(e.preventDefault(),this.parent.notify("exportDialog",null))),(e.ctrlKey||e.metaKey)&&e.shiftKey&&!r){if(!n.isProtected||n.protectSettings.formatCells){var b=n.selectedRange,x=void 0;if(192===e.keyCode)x="General";else if(52===e.keyCode)x=Ke("CurrencyWithColorCode");else if(53===e.keyCode)x="0%";else if(54===e.keyCode)x=Ke("Scientific");else if(51===e.keyCode)x="dd-mmm-yy";else if(50===e.keyCode)x="h:mm AM/PM";else if(49===e.keyCode)x=Ke("Number");else if(55===e.keyCode){e.preventDefault();this.parent.notify(Yr,{style:{border:"1px solid #000000"},onActionUpdate:!0,borderType:"Outer"})}if(x&&!oe(this.parent,w(c(b)))){var S={format:x,range:b,cancel:!1,requestType:"NumberFormat"},I={range:n.name+"!"+S.range,format:S.format,requestType:"NumberFormat"};this.parent.trigger("beforeCellFormat",S),this.parent.notify(qr,{eventArgs:S,action:"format"}),S.cancel||(this.parent.notify("applyNumber",S),this.parent.notify("selectionComplete",{type:"mousedown"}),this.parent.notify(ci,{eventArgs:I,action:"format"}),this.parent.notify(Sn,null))}}if(85===e.keyCode){e.preventDefault();var E=this.parent.element.querySelector(".e-formula-bar-panel .e-drop-icon");E&&E.click()}}122!==e.keyCode||!e.shiftKey||e.ctrlKey||this.parent.isProtected||this.parent.notify(on,{model:this.parent,start:this.parent.activeSheetIndex+1,end:this.parent.activeSheetIndex+1,modelType:"Sheet",isAction:!0,activeSheetIndex:this.parent.activeSheetIndex+1}),e.shiftKey&&e.altKey&&75===e.keyCode&&this.parent.showSheetTabs&&this.parent.element.querySelector(".e-sheets-list").click()}},e.prototype.focusTarget=function(e){var t,r=w(c(e.selectedRange)),n=0===r[1]&&r[3]===e.colCount-1,i=0===r[0]&&r[2]===e.rowCount-1;if(n&&i)t=this.parent.element.querySelector(".e-selectall");else if(n){u=this.parent.frozenRowCount(e);if(r[0]<u)t=(l=this.parent.getRow(r[0],this.parent.sheetModule.getSelectAllTable()))&&l.cells[0];else{r[0]=j(e,r[0],!0);var a=j(e,c(e.paneTopLeftCell)[0],!0),o=hr(this.parent,a).index,s=void 0;t=(s=r[0]>a&&r[0]<o?this.parent.getRow(r[0],this.parent.getRowHeaderTable()):r[0]>=o?this.parent.getRow(o-1,this.parent.getRowHeaderTable()):this.parent.getRow(a+1,this.parent.getRowHeaderTable()))&&s.cells[0]}}else if(i){f=this.parent.frozenColCount(e);if(r[1]<f){var l=this.parent.element.querySelector(".e-selectall-container .e-header-row");t=l&&this.parent.getCell(0,r[1],l)}else{r[1]=j(e,r[1],!0,"columns");var d=j(e,c(e.paneTopLeftCell)[1],!0,"columns"),h=pr(this.parent,d),s=this.parent.element.querySelector(".e-column-header .e-header-row");t=r[1]>d&&r[1]<h?s&&this.parent.getCell(0,r[1],s):r[1]>=h?s&&this.parent.getCell(0,h-1,s):s&&this.parent.getCell(0,d+1,s)}}else{var p=c(e.paneTopLeftCell);t=this.parent.getCell(r[0],r[1]);var u=this.parent.frozenRowCount(e),f=this.parent.frozenColCount(e);if(r[0]<u&&r[1]<f)t=this.parent.getCell(r[0],r[1]);else if(r[0]<u){var d=c(e.paneTopLeftCell)[1],h=pr(this.parent,d);t=r[1]>d&&r[1]<h?this.parent.getCell(r[0],r[1]):r[1]>=h?this.parent.getCell(r[0],h-1):this.parent.getCell(r[0],d+1)}else if(r[1]<f){var a=c(e.paneTopLeftCell)[0],o=hr(this.parent,a).index;t=r[0]>a&&r[0]<o?this.parent.getCell(r[0],r[1]):r[0]>=o?this.parent.getCell(o-1,r[1]):this.parent.getCell(a+1,r[1])}else{var a=c(e.paneTopLeftCell)[0],o=hr(this.parent,a).index,d=c(e.paneTopLeftCell)[1],h=pr(this.parent,d);t=r[0]>a&&r[0]<o?r[1]>d&&r[1]<h?this.parent.getCell(r[0],r[1]):r[1]>=h?this.parent.getCell(r[0],h-1):this.parent.getCell(r[0],d+1):r[0]>=o?r[1]>d&&r[1]<h?this.parent.getCell(o-1,r[1]):r[1]>=h?this.parent.getCell(o-1,h-1):this.parent.getCell(o-1,d+1):r[1]>d&&r[1]<h?this.parent.getCell(a+1,r[1]):r[1]>=h?this.parent.getCell(a+1,h-1):this.parent.getCell(a+1,d+1)}t||(t=this.parent.getCell(p[0]+1,p[1]+1))}t&&or(t)},e.prototype.getModuleName=function(){return"keyboardShortcut"},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e}(),Qa=function(){function e(e){this.checkHeight=!1,this.parent=e,this.addEventListener()}return e.prototype.applyCellFormat=function(e){if(e.checkHeight)return this.checkHeight||(this.checkHeight=!0),void this.updateRowHeight(e.rowIdx,e.colIdx,e.lastCell,e.onActionUpdate,e.outsideViewport,e.rowHeight);var t=Object.keys(e.style),r=this.parent.getActiveSheet();if(!(e.lastCell&&!t.length&&ar(r,e.rowIdx)<=(r.standardHeight||20))){var n=e.td||this.parent.getCell(e.rowIdx,e.colIdx);if(n){this.updateMergeBorder(e,r);var i=void 0;if(e.formatColor&&n.style.color===e.formatColor&&(i=e.style.color,delete e.style.color),void 0!==e.style.border||void 0!==e.style.borderTop||void 0!==e.style.borderLeft){var a={};Object.keys(e.style).forEach(function(t){a[""+t]=e.style[""+t]}),void 0!==a.border&&(Object.assign(n.style,{borderRight:e.style.border,borderBottom:e.style.border}),this.setLeftBorder(e.style.border,n,e.rowIdx,e.colIdx,e.colIdx===this.parent.frozenColCount(r)?e.hRow:e.row,e.onActionUpdate,e.first,r),this.setTopBorder(e.style.border,n,e.rowIdx,e.colIdx,e.pRow,e.pHRow,e.onActionUpdate,e.first,e.lastCell,e.manualUpdate,r,e),delete a.border),void 0!==a.borderTop&&(this.setTopBorder(e.style.borderTop,n,e.rowIdx,e.colIdx,e.pRow,e.pHRow,e.onActionUpdate,e.first,e.lastCell,e.manualUpdate,r,e),delete a.borderTop),void 0!==a.borderLeft&&(this.setLeftBorder(e.style.borderLeft,n,e.rowIdx,e.colIdx,e.colIdx===this.parent.frozenColCount(r)?e.hRow:e.row,e.onActionUpdate,e.first,r),delete a.borderLeft),Object.keys(a).length&&(void 0!==a.borderBottom&&this.setThickBorderHeight(a.borderBottom,e.rowIdx,e.colIdx,n,e.row,e.hRow,e.onActionUpdate,e.lastCell,e.manualUpdate),Object.assign(n.style,a))}else{if(void 0!==e.style.borderBottom&&this.setThickBorderHeight(e.style.borderBottom,e.rowIdx,e.colIdx,n,e.row,e.hRow,e.onActionUpdate,e.lastCell,e.manualUpdate),Object.assign(n.style,e.style),n){var o=n.querySelector(".e-cf-databar");if(o){var s=o.querySelector(".e-databar-value");s&&(s.style.textDecoration=e.style.textDecoration,e.style.verticalAlign&&(s.style.alignItems="top"===e.style.verticalAlign?"start":"middle"===e.style.verticalAlign?"center":"end"))}}var l=He(e.rowIdx,e.colIdx,r);if(l&&(l.rowSpan||l.colSpan)&&n.offsetHeight>0&&(c=$t(this.parent,l.style||this.parent.cellStyle))>n.offsetHeight&&Kt(this.parent,r,n.offsetHeight,e.rowIdx),e.style.fontSize&&n){var d=n.querySelector(".e-validation-list");d&&this.parent.notify("addListValidationDropdown",{ddlCont:d,rowIdx:e.rowIdx,colIdx:e.colIdx,updatePosition:!0})}}var h=He(e.rowIdx,e.colIdx,r,null,!0);if(r.rows[e.rowIdx]&&r.rows[e.rowIdx].customHeight){if(!h.wrap&&(e.style.fontSize||e.style.fontFamily)){var p=nt(r,e.rowIdx,!0)-tr(e.rowIdx,e.colIdx,r);p<$t(this.parent,h.style)?n.style.lineHeight=p+"px":n.style.lineHeight&&(n.style.lineHeight="")}}else if(e.isHeightCheckNeeded)if(e.manualUpdate)this.checkHeight||(this.checkHeight=_(e.style,e.onActionUpdate)),n&&n.children[0]&&"e-cf-databar"===n.children[0].className&&e.style.fontSize&&(n.children[0].querySelector(".e-databar-value").style.fontSize=e.style.fontSize),e.isFromAutoFillOption||this.updateRowHeight(e.rowIdx,e.colIdx,e.lastCell,e.onActionUpdate,null,e.rowHeight),h.wrap&&(e.style.fontSize||e.style.fontFamily)&&(n.style.lineHeight=parseFloat(h.style&&h.style.fontSize||this.parent.cellStyle.fontSize)*Zt(h.style&&h.style.fontFamily?h.style:this.parent.cellStyle)+"pt");else if(!h.wrap&&_(e.style)&&ir(r,e.rowIdx,e.colIdx,nr(this.parent,e.rowIdx,e.colIdx,r,e.style)),e.lastCell){var c=ar(r,e.rowIdx);c>(r.standardHeight||20)&&c>nt(r,e.rowIdx)&&Kt(this.parent,r,c,e.rowIdx,e.row,e.hRow)}void 0!==i&&(e.style.color=i)}else this.updateRowHeight(e.rowIdx,e.colIdx,!0,e.onActionUpdate,null,e.rowHeight)}},e.prototype.updateRowHeight=function(e,t,r,n,i,a){if(this.checkHeight){var o=this.parent.getActiveSheet(),s=He(e,t,o,null,!0);if(!s.rowSpan){var l=0;l=nr(this.parent,e,t,o,s.style||this.parent.cellStyle,s.wrap&&!s.colSpan?Qt(this.parent.getDisplayText(s),rr(o,e,t),s.style,this.parent.cellStyle):1);var d=s.value&&s.value.toString();if(d&&d.indexOf("\n")>-1){var h=void 0,p=d.split("\n"),c=0,u=p.length;for(h=0;h<u;h++){var f=Qt(p[h],rr(o,e,t),s.style,this.parent.cellStyle);0===f&&(f=1),c+=f}l=nr(this.parent,e,t,o,s.style||this.parent.cellStyle,c)}var g=o&&o.standardHeight?o.standardHeight:20;if(l<g&&(l=g),ir(o,e,t,l),!i){var m=this.parent.getCell(e,t);m&&m.children[0]&&"e-cf-databar"===m.children[0].className&&(m.children[0].style.height="100%",m.children[0].firstElementChild.nextElementSibling.style.height="100%")}if(r){this.checkHeight=!1;var v=a||ar(o,e),y=nt(o,e);(n?v!==y:v>y)&&Kt(this.parent,o,v,e,null,null,!0,i)}}}},e.prototype.updateMergeBorder=function(e,t){var r=He(e.rowIdx,e.colIdx,t,null,!0),n={range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]};if(this.parent.notify(mn,n),r.rowSpan>1&&!e.style.borderBottom){var i=He(n.range[2],n.range[1],t,null,!0);i.style&&i.style.borderBottom&&(e.style.borderBottom=i.style.borderBottom)}if(r.colSpan>1&&!e.style.borderRight){var a=He(n.range[0],n.range[3],t,null,!0);a.style&&a.style.borderRight&&(e.style.borderRight=a.style.borderRight)}},e.prototype.setLeftBorder=function(e,t,r,n,i,a,o,s){if(!o||!o.includes("Column")){var l=this.parent.enableRtl?this.parent.getCell(r,n+1,i):this.parent.getCell(r,n-1,i);if(l){var d=He(r,n-1,s,!1,!0);if(d.rowSpan&&1!==d.rowSpan||d.colSpan&&1!==d.colSpan){var h={range:[r,n-1,r,n-1]};if(this.parent.notify(mn,h),(d=He(h.range[0],h.range[1],s,!1,!0)).style&&d.style.borderRight&&"none"!==d.style.borderRight)return;if((d=He(h.range[0],h.range[3],s,null,!0)).style&&d.style.borderRight&&"none"!==d.style.borderRight)return;t.style.borderLeft=e}else a&&""!==e&&n===this.parent.viewport.leftIndex&&(this.parent.getMainContent().scrollLeft-=this.getBorderSize(e)),l.style.borderRight="none"===e?l.style.borderRight:e}else t.style.borderLeft=e}},e.prototype.setTopBorder=function(e,t,r,n,i,a,o,s,l,d,h,p){if(!s||!s.includes("Row")){var c=n,u=He(r,n,h,!1,!0);u.colSpan>1&&ht(h,n)&&(c=j(h,n,!0,"columns"))>n+u.colSpan-1&&(c=n);var f=this.parent.getCell(r-1,c,i);if(f)if((u=He(r-1,n,h,!1,!0)).rowSpan&&1!==u.rowSpan||u.colSpan&&1!==u.colSpan){var g={range:[r-1,n,r-1,n]};if(this.parent.notify(mn,g),(u=He(g.range[0],g.range[1],h,!1,!0)).style&&u.style.borderBottom&&"none"!==u.style.borderBottom)return;if((u=He(g.range[2],g.range[1],h,null,!0)).style&&u.style.borderBottom&&"none"!==u.style.borderBottom)return;t.style.borderTop=e,void 0!==p.mergeBorderRows&&-1===p.mergeBorderRows.indexOf(r)&&p.mergeBorderRows.push(r)}else{if(tt(h,r-1)){var m=[Number(f.parentElement.getAttribute("aria-rowindex"))-1,n];if(this.parent.getCellStyleValue(["bottomPriority"],m).bottomPriority)return}o&&""!==e&&h.topLeftCell.includes(""+(r+1))&&(this.parent.getMainContent().parentElement.scrollTop-=this.getBorderSize(e)),this.setThickBorderHeight(e,r-1,n,f,i,a,o,l,d),f.style.borderBottom="none"===e?f.style.borderBottom:e}else t.style.borderTop=e}},e.prototype.setThickBorderHeight=function(e,t,r,n,i,a,o,s,l){var d=e?this.getBorderSize(e):1,h=this.parent.getActiveSheet();if(d>2&&(!h.rows[t]||!h.rows[t].customHeight))if(l)this.checkHeight||(this.checkHeight=!0),this.updateRowHeight(t,r,s,o);else{var p=nt(h,t),c=Math.ceil(this.parent.calculateHeight(this.parent.getCellStyleValue(["fontFamily","fontSize"],[t,r]),1,3));c>p&&Kt(this.parent,h,c,t,i,a)}!o||!s&&this.checkHeight||!(d<3)||h.rows[t]&&h.rows[t].customHeight||(this.checkHeight||(this.checkHeight=!0),this.updateRowHeight(t,r,s,o))},e.prototype.getBorderSize=function(e){var t=e.split(" ")[0];return"thin"===t?1:"medium"===t?2:"thick"===t?3:parseInt(t,10)||1},e.prototype.clearObj=function(e){var r=this,n=e.options,i=n.range?n.range.indexOf("!")>0?n.range.substring(n.range.lastIndexOf("!")+1):n.range:this.parent.getActiveSheet().selectedRange,a=n.range&&n.range.indexOf("!")>0?Se(this.parent,n.range.substring(0,n.range.lastIndexOf("!"))):this.parent.activeSheetIndex,o=w(c(i));if(oe(this.parent,o))return void(e.isAction&&this.parent.notify(yi,null));var s,l,d,h=this.parent.sheets[a],p=o[0],u=o[2],f=this.parent.element.getElementsByClassName("e-ss-overlay-active"),g=f.length>0,v=this.parent.element.getElementsByClassName("e-prev-highlight-bottom").length>0,y={range:i,type:n.type,requestType:"clear",sheetIndex:a},C=function(){e.isAction&&r.parent.notify(qr,{action:"beforeClear",eventArgs:y})},b=function(){e.isAction&&(y={range:h.name+"!"+i,type:n.type,sheetIndex:a},d&&(y.cfClearActionArgs=d.cfClearActionArgs),r.parent.notify(ci,{eventArgs:y,action:"clear",isSelectAll:v}))},x="Clear All"===n.type;if(g)("Clear Contents"===n.type||x)&&(C(),f[0].classList.contains("e-datavisualization-chart")?this.parent.notify(Ai,{id:f[0].id,sheetIdx:this.parent.activeSheetIndex+1,clearAction:!0}):this.parent.notify(Fi,{id:f[0].id,sheetIdx:this.parent.activeSheetIndex+1,clearAction:!0}),b());else{if(C(),"Clear Formats"===n.type||x)for(d={range:i,sheetIdx:a,isClear:!0},this.parent.notify(bn,d),e.cfClearActionArgs=d.cfClearActionArgs,x&&(this.parent.notify(ln,{range:i,isRemoveValidation:!0}),0===p&&0===o[1]&&u>=h.usedRange.rowIndex&&o[3]>=h.usedRange.colIndex&&this.parent.setUsedRange(p,o[1],h,!1,!0)),p;p<=u;p++)for(s=o[1],l=o[3],s;s<=l;s++){var S=He(p,s,h),I=this.parent.getCell(p,s);S&&(x&&S.formula&&this.parent.notify(tn,{cellRef:m([p,s,p,s])}),S.wrap&&this.parent.notify(an,{range:[p,s,p,s],wrap:!1,sheet:h}),S.hyperlink&&(I&&t.removeClass(I.querySelectorAll(".e-hyperlink"),"e-hyperlink-style"),x&&this.parent.removeHyperlink(h.name+"!"+m([p,s,p,s]))))}"Clear Hyperlinks"===n.type&&this.parent.removeHyperlink(h.name+"!"+i),this.parent.notify("clear",{range:h.name+"!"+i,type:n.type}),this.parent.serviceLocator.getService("cell").refreshRange(w(c(i)),!1,!1,!1,"Clear Hyperlinks"===n.type,re(this.parent),!x,null,null,null,v),e.isFromUpdateAction||this.parent.notify("selectRange",{address:i}),this.parent.notify("activeCellChanged",null),b()}},e.prototype.addEventListener=function(){this.parent.on(Xr,this.applyCellFormat,this),this.parent.on(Si,this.clearObj,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Xr,this.applyCellFormat),this.parent.off(Si,this.clearObj))},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null,this.checkHeight=null},e.prototype.getModuleName=function(){return"cellformat"},e}(),eo=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on(Wn,this.wireEvents,this),this.parent.on(ai,this.autoFit,this),this.parent.on("setAutoFit",this.setAutoFitHandler,this),this.parent.on("propertyChange",this.propertyChange,this)},e.prototype.autoFit=function(e){for(var t=e.isRow?this.parent.getRowHeaderTable():this.parent.getColHeaderTable().rows[0],r=e.startIndex;r<=e.endIndex;r++)this.trgtEle=e.isRow?this.parent.getRow(r,t):this.parent.getCell(null,r,t),this.setAutofit(r,!e.isRow)},e.prototype.wireEvents=function(){var e=this.parent.getRowHeaderContent(),r=this.parent.element.getElementsByClassName("e-header-panel")[0];r&&(t.EventHandler.add(r,"dblclick",this.dblClickHandler,this),t.EventHandler.add(e,"dblclick",this.dblClickHandler,this),t.EventHandler.add(r,"mousedown",this.mouseDownHandler,this),t.EventHandler.add(e,"mousedown",this.mouseDownHandler,this),this.wireResizeCursorEvent(e,r))},e.prototype.wireResizeCursorEvent=function(e,r){t.EventHandler.add(e,"mousemove",this.setTarget,this),t.EventHandler.add(r,"mousemove",this.setTarget,this)},e.prototype.unWireResizeCursorEvent=function(){t.EventHandler.remove(this.parent.getRowHeaderContent(),"mousemove",this.setTarget);var e=this.parent.element.getElementsByClassName("e-header-panel")[0];e&&t.EventHandler.remove(e,"mousemove",this.setTarget)},e.prototype.unwireEvents=function(){var e=this.parent.getRowHeaderContent(),r=this.parent.element.getElementsByClassName("e-header-panel")[0];r&&(t.EventHandler.remove(r,"dblclick",this.dblClickHandler),t.EventHandler.remove(e,"dblclick",this.dblClickHandler),t.EventHandler.remove(r,"mousedown",this.mouseDownHandler),t.EventHandler.remove(e,"mousedown",this.mouseDownHandler),this.unWireResizeCursorEvent())},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Wn,this.wireEvents),this.parent.off(ai,this.autoFit),this.parent.off("setAutoFit",this.setAutoFitHandler),this.parent.off("propertyChange",this.propertyChange))},e.prototype.mouseMoveHandler=function(e){var t=this.parent.element.getElementsByClassName("e-colresize-handler")[0],r=this.parent.element.getElementsByClassName("e-rowresize-handler")[0];if(this.resizeTooltip(null,!0,e),t||r){this.isMouseMoved=!0;var n=this.parent.enableRtl;t?(n?e.x<this.trgtEle.parentElement.firstChild.getBoundingClientRect().right:e.x>this.trgtEle.parentElement.firstChild.getBoundingClientRect().left)&&(t.style.left=e.clientX-document.getElementById(this.parent.element.id+"_sheet").getBoundingClientRect().left+"px"):r&&e.y>=this.trgtEle.parentElement.parentElement.firstChild.getBoundingClientRect().top&&(r.style.top=e.clientY-document.getElementById(this.parent.element.id+"_sheet").getBoundingClientRect().top+"px")}},e.prototype.mouseDownHandler=function(e){if(t.closest(e.target,".e-header-cell")&&!e.target.className.includes("e-filter-icon")){if(this.event=e,this.trgtEle=e.target,this.trgtEle.parentElement.classList.contains("e-hide-end")||this.trgtEle.classList.contains("e-hide-end")){var r=this.trgtEle.offsetHeight,n=e.offsetY;(r>=10&&n<5||r-2<8&&n<Math.ceil((n-2)/2))&&this.trgtEle.classList.add("e-skip-resize")}this.updateTarget(e,this.trgtEle);var i=this.trgtEle,a=i.classList.contains("e-colresize")?"e-colresize-handler":i.classList.contains("e-rowresize")?"e-rowresize-handler":"";this.createResizeHandler(i,a),this.unWireResizeCursorEvent(),t.EventHandler.add(this.parent.element,"mousemove",this.mouseMoveHandler,this),t.EventHandler.add(document,"mouseup",this.mouseUpHandler,this)}},e.prototype.mouseUpHandler=function(e){var r=this.parent.element.getElementsByClassName("e-resize-handle")[0];this.resizeOn(e),this.isMouseMoved=null;var n=document.querySelector(".e-header-tooltip");r&&(t.detach(r),this.updateCursor()),n&&n.remove(),t.EventHandler.remove(document,"mouseup",this.mouseUpHandler),t.EventHandler.remove(this.parent.element,"mousemove",this.mouseMoveHandler);var i=this.parent.element.getElementsByClassName("e-header-panel")[0];i&&this.wireResizeCursorEvent(this.parent.getRowHeaderContent(),i),this.parent.notify("positionAutoFillElement",null),this.parent.notify("hideAutoFillOptions",null)},e.prototype.dblClickHandler=function(e){if(t.closest(e.target,".e-header-cell")&&!e.target.className.includes("e-filter-icon")){if(this.trgtEle=e.target,this.updateTarget(e,this.trgtEle))return void this.parent.notify(yi,null);if(this.trgtEle.classList.contains("e-colresize")){var r=parseInt(this.trgtEle.getAttribute("aria-colindex"),10)-1,n=lt(this.parent.getActiveSheet(),r)+"px";this.trgtEle.classList.contains("e-unhide-column")?this.showHiddenColumns(r-1):this.setAutofit(r,!0,n,this.trgtEle)}else if(this.trgtEle.classList.contains("e-rowresize")){var i=parseInt(this.trgtEle.parentElement.getAttribute("aria-rowindex"),10)-1,a=nt(this.parent.getActiveSheet(),i)+"px";this.setAutofit(i,!1,a)}this.parent.notify("positionAutoFillElement",null)}},e.prototype.setTarget=function(e){if(!this.parent.isEdit&&t.closest(e.target,".e-header-cell")&&!e.target.className.includes("e-filter-icon")){var r=e.target,n=this.parent.getActiveSheet();if(n.isProtected&&(!n.protectSettings.formatColumns||!n.protectSettings.formatRows)){if(!n.protectSettings.formatRows&&!n.protectSettings.formatColumns)return;if(n.protectSettings.formatRows&&t.closest(r,".e-colhdr-table"))return;if(n.protectSettings.formatColumns&&t.closest(r,".e-rowhdr-table"))return}var i,a,o,s;if(t.closest(r,".e-header-row"))a=r.offsetWidth,s="e-colresize",o=this.parent.enableRtl?a-e.offsetX:e.offsetX,(l=this.getColPrevSibling(r))&&!l.classList.contains("e-select-all-cell")?i=l:Number(r.getAttribute("aria-colindex"))>1&&(i=r);else if(t.closest(r,".e-row")){o=e.offsetY,a=r.offsetHeight,s="e-rowresize";var l=this.getRowPrevSibling(r);l?i=l.firstElementChild:Number(r.parentElement.getAttribute("aria-rowindex"))>1&&(i=r)}if(a-2<8&&o!==Math.ceil((a-2)/2))o<Math.ceil((a-2)/2)?(r.classList.add(s),i&&i.classList.add(s)):o>Math.ceil((a-2)/2)&&r.classList.add(s);else if(a-5<o&&o<=a&&a>=10)r.classList.add(s);else if(o<5&&i&&a>=10)r.classList.add(s),i.classList.add(s);else for(var d=this.parent.element.getElementsByClassName(s),h=0;h<d.length;h++)d[h].classList.remove(s)}},e.prototype.getColPrevSibling=function(e){var r=this.parent.frozenColCount(this.parent.getActiveSheet());return e.previousElementSibling||(r&&t.closest(e,".e-column-header")?this.parent.getSelectAllContent().querySelector(".e-header-row").lastElementChild:null)},e.prototype.getRowPrevSibling=function(e){var r=this.parent.frozenRowCount(this.parent.getActiveSheet());return e.parentElement.previousElementSibling||(r&&t.closest(e,".e-row-header")?this.parent.getSelectAllContent().querySelector("tbody").lastElementChild:null)},e.prototype.updateTarget=function(e,r){if(t.closest(r,".e-header-row")){var n=this.parent.enableRtl?r.offsetWidth-e.offsetX:e.offsetX;if(r.offsetWidth<10&&n<Math.ceil((r.offsetWidth-2)/2)||n<5&&r.offsetWidth>=10&&r.classList.contains("e-colresize")){var i=this.parent.getActiveSheet(),a=Number(this.trgtEle.getAttribute("aria-colindex"))-2;if((o=this.getColPrevSibling(r))&&!ht(i,a))this.trgtEle=o;else if(a>-1){if(ot(i,a).isReadOnly||oe(this.parent,[0,a,i.rowCount-1,a]))return!0;this.trgtEle.classList.add("e-unhide-column")}}}else if(r.offsetHeight<10&&e.offsetY<Math.ceil((r.offsetHeight-2)/2)||e.offsetY<5&&r.offsetHeight>=10&&r.classList.contains("e-rowresize")){var i=this.parent.getActiveSheet(),a=Number(r.parentElement.getAttribute("aria-rowindex"))-2,o=this.getRowPrevSibling(r);if(o||tt(i,a))if("dblclick"===e.type&&tt(i,a)){if(Qe(i,a).isReadOnly||oe(this.parent,[a,0,a,i.colCount-1]))return!0;var s=w(c(i.selectedRange)),l=void 0;l=a<=s[2]&&a>s[0]&&D(i,s)?{startIndex:s[0],endIndex:s[2],hide:!1,autoFit:!0}:{startIndex:a,endIndex:a,hide:!1,autoFit:!0},this.parent.notify(vn,l)}else tt(i,a)||(this.trgtEle=o.getElementsByClassName("e-header-cell")[0])}return!1},e.prototype.setAutoFitHandler=function(e){e.isCol&&ht(this.parent.getActiveSheet(),e.idx)?this.showHiddenColumns(e.idx):this.setAutofit(e.idx,e.isCol,null,null,e.sheetIdx)},e.prototype.getWrapText=function(e,t,r){var n,i=this,a=e.toString().split(" "),o=Jt(" ",r,this.parent.cellStyle),s=0,l=0,d=e,h="",p=function(){var e=parseInt(l.toString(),10);(e>s||e===s&&Jt(h.trim(),r,i.parent.cellStyle)>Jt(d,r,i.parent.cellStyle))&&(d=h.trim(),s=e)};return a.forEach(function(e,s){n=Jt(e,r,i.parent.cellStyle),(l+n)/t>1?(p(),h="",l=n):l+=n+=(l+n+o)/t>=1?0:o,h+=e+" ",s===a.length-1&&p()}),d},e.prototype.setAutofit=function(e,r,n,i,a){var o,s=this,l=t.isNullOrUndefined(a)?this.parent.getActiveSheet():Ae(this.parent,a),d=!!t.isNullOrUndefined(a)||a===this.parent.activeSheetIndex;if(i){var h={cancel:!1,index:e,isCol:r,sheetIndex:this.parent.activeSheetIndex};if(r?(h.oldWidth=n,h.autoFitWithHeader=!1):h.oldHeight=n,this.parent.notify(qr,{eventArgs:h,action:"resizeToFit"}),h.cancel)return;o=h.autoFitWithHeader}var p,u,f,g,m={},v=this.parent.createElement("table",{className:this.parent.getContentTable().className+" e-resizetable",styles:"height: auto"}),y=this.parent.createElement("tbody"),C=this.parent.createElement("tr",{className:"e-row"}),b=this.parent.createElement("td",{className:"e-cell"}),x=0,S=0;if(r){var w;v.style.width="auto";var I=function(e){(u=b.cloneNode()).textContent=e,u.style.fontFamily=m.style&&m.style.fontFamily||s.parent.cellStyle.fontFamily,u.style.fontSize=m.style&&m.style.fontSize||s.parent.cellStyle.fontSize,u.style.fontWeight=m.style&&m.style.fontWeight||s.parent.cellStyle.fontWeight,(w=C.cloneNode()).appendChild(u),y.appendChild(w)};o&&I(i.textContent);for(var E=0,R=l.rows.length;E<R;E++)(m=He(E,e,l))&&m.value&&(m.wrap?(g=!0,I(this.getWrapText(this.parent.getDisplayText(m),rr(l,e,e,m.colSpan>1?e+m.colSpan-1:e),m.style))):I(this.parent.getDisplayText(m)));p=lt(l,e)}else{var N=l.rows[e]&&l.rows[e].cells?l.rows[e].cells.length:0;f=this.parent.createElement("colgroup");for(var F=0;F<N;F++)(m=He(e,F,l))&&(u=b.cloneNode(),m.wrap&&u.classList.add("e-wraptext"),u.textContent=this.parent.getDisplayText(m),u.style.fontFamily=m.style&&m.style.fontFamily||this.parent.cellStyle.fontFamily,u.style.fontSize=m.style&&m.style.fontSize||this.parent.cellStyle.fontSize,C.appendChild(u),x+=S=m.colSpan&&m.colSpan>=1?this.getMergedColumnsWidth(m.colSpan,F,l):m.colSpan&&m.colSpan<1?0:lt(l,F,!1,!0),f.appendChild(this.parent.createElement("col",{styles:"width:"+S+"px"})));v.appendChild(f),y.appendChild(C),p=nt(l,e)}v.appendChild(y),x&&(v.style.width=x+"px");var A=this.parent.createElement("div",{className:this.parent.element.className,styles:"display: block"});A.appendChild(v),document.body.appendChild(A);var k=v.getBoundingClientRect();document.body.removeChild(A);var O,T=Math.ceil(r?k.width:k.height),D=(r?this.getFloatingElementWidth(T+(g?1:0),e):T)||p;if(r){O=D>0?-(p-D):-p;var L=this.parent.frozenColCount(l);L&&e>=c(l.topLeftCell)[1]&&e<L||e>=this.parent.viewport.leftIndex+L&&e<=this.parent.viewport.rightIndex?(ot(l,e).width=D>0?D:0,d&&(this.resizeStart(e,this.parent.getViewportIndex(e,!0),D+"px",r,!0,n),this.parent.notify(ni,{threshold:O,colIdx:e}))):(d&&this.parent.notify(ni,{threshold:O,colIdx:e}),ot(l,e).width=D>0?D:0)}else{var P=this.parent.frozenRowCount(l);O=-(p-(D=D>20?D:20)),P&&e>=c(l.topLeftCell)[0]&&e<P||e>=this.parent.viewport.topIndex+P&&e<=this.parent.viewport.bottomIndex?(it(l,e,D),et(l,e,{customHeight:!1}),d&&(this.resizeStart(e,this.parent.getViewportIndex(e),D+"px",r,!0,n),this.parent.notify(ri,{threshold:O,rowIdx:e}))):(d&&this.parent.notify(ri,{threshold:O,rowIdx:e}),it(l,e,D))}d&&this.parent.selectRange(l.selectedRange)},e.prototype.getMergedColumnsWidth=function(e,t,r){for(var n=0,i=0;i<e;i++)n+=lt(r,t,!1,!0),t++;return n},e.prototype.createResizeHandler=function(e,t){var r=this.parent.createElement("div",{className:t});r.classList.add("e-resize-handle");var n=document.getElementById(this.parent.element.id+"_sheet");e.classList.contains("e-colresize")?(r.style.height=this.parent.getMainContent().parentElement.clientHeight+this.parent.getColumnHeaderContent().offsetHeight+"px",r.style.left=this.event.clientX-n.getBoundingClientRect().left+"px",r.style.top="0px"):e.classList.contains("e-rowresize")&&(r.style.width=this.parent.getMainContent().parentElement.clientWidth+"px",r.style.left="0px",r.style.top=this.event.clientY-n.getBoundingClientRect().top+"px"),n.appendChild(r),this.resizeTooltip(e,!1),this.updateCursor()},e.prototype.resizeTooltip=function(e,r,i){if(r){var a=this.parent.enableRtl,o=document.querySelector(".e-header-tooltip"),s=this.parent.element.getElementsByClassName("e-colresize-handler")[0],l=this.parent.element.getElementsByClassName("e-rowresize-handler")[0];if(s){var d=a?Math.round(this.trgtEle.getBoundingClientRect().right)-i.clientX:i.clientX-Math.round(this.trgtEle.getBoundingClientRect().left);o&&(o.firstChild.textContent=d>0?"Width:("+d.toString()+" pixels)":"Width: 0.00")}else if(l){var h=i.clientY-Math.round(this.trgtEle.getBoundingClientRect().top);o&&(o.firstChild.textContent=h>0?"Height:("+h.toString()+" pixels)":"Height: 0.00")}}else{var p=e.classList.contains("e-colresize"),c=e.classList.contains("e-rowresize");if(p||c){var u=p?"e-colresize-handler":"e-rowresize-handler",f=new n.Tooltip({cssClass:"e-header-tooltip",showTipPointer:!1});p?f.content=t.initializeCSPTemplate(function(){return"Width:("+Math.round(e.getBoundingClientRect().width).toString()+" pixels)"}):c&&(f.content=t.initializeCSPTemplate(function(){return"Height:("+Math.round(e.getBoundingClientRect().height).toString()+" pixels)"}),f.offsetX=-(this.parent.getMainContent().parentElement.clientWidth/2-Math.round(e.getBoundingClientRect().width))),f.appendTo("."+u),f.open(),f.refresh()}}},e.prototype.setColWidth=function(e,t,r,n){var i=this.parent.getActiveSheet(),a=Vt(r)-n;if(a<0&&n<-a&&(a=-n),r>0){if(this.isMouseMoved&&this.trgtEle.classList.contains("e-unhide-column"))return this.showHiddenColumns(e,r),void this.parent.notify(ci,{eventArgs:{index:e,width:"0px",isCol:!0,sheetIndex:this.parent.activeSheetIndex,oldWidth:n+"px",hide:!1},action:"resize"});this.resizeStart(e,t,r+"px",!0,!1,n+"px"),st(i,e,{width:r,customWidth:!0}),this.parent.notify(ni,{threshold:a,colIdx:e,checkWrapCell:!0})}else this.isMouseMoved&&(this.parent.hideColumn(e),this.showHideCopyIndicator(),this.parent.notify(ci,{eventArgs:{index:e,width:"0px",isCol:!0,sheetIndex:this.parent.activeSheetIndex,oldWidth:n+"px",hide:!0},action:"resize"}))},e.prototype.showHideCopyIndicator=function(){var e=this.parent.element.getElementsByClassName("e-copy-indicator")[0],r=!1;e&&(t.detach(e),this.parent.notify("hideAutoFillElement",null),r=!0),r&&this.parent.notify(Wn,{})},e.prototype.showHiddenColumns=function(e,t){var r,n,i,a=this,o=this.parent.getActiveSheet(),s=c(o.selectedRange);if(e>=s[1]&&e<=s[3]&&s[2]===o.rowCount-1&&u(o.activeCell)[0]===u(o.topLeftCell)[0]?(r=s[1],n=s[3],i=this.parent.getMainContent().querySelector("colgroup")):r=n=e,void 0!==t)for(var l=r;l<=n;l++)st(o,l,{width:t,customWidth:!0}),l>=this.parent.viewport.leftIndex&&l<=this.parent.viewport.rightIndex&&!ht(o,l)&&(i.children[this.parent.getViewportIndex(l,!0)].style.width=t+"px");this.trgtEle&&this.trgtEle.classList.remove("e-unhide-column");var d={startIndex:r,endIndex:n,hide:!1,isCol:!0,autoFit:!0};if(this.parent.notify(vn,d),this.showHideCopyIndicator(),void 0===t)if(d.autoFit)this.autoFit({isRow:!1,startIndex:r,endIndex:n});else{var h=function(){a.parent.off(Wn,h),a.autoFit({isRow:!1,startIndex:r,endIndex:n})};this.parent.on(Wn,h,this)}},e.prototype.setRowHeight=function(e,t,r,n){var i=this.parent.getActiveSheet(),a=this.parent.frozenColCount(i),o=parseInt(this.parent.getRow(e,null,a).style.height,10),s=r,l=Vt(parseInt(s,10))-o;l<0&&o<-l&&(l=-o);var d;i.rows[e]&&i.rows[e].customHeight&&(d=!0),this.resizeStart(e,t,s,!1,!1,n,d),et(i,e,{height:parseInt(s,10)>0?parseInt(s,10):0,customHeight:!0}),this.parent.notify(ri,{threshold:l,rowIdx:e,isCustomHgt:!0})},e.prototype.resizeOn=function(e){var t,r,n=this,i=this.parent.getActiveSheet(),a=c(i.activeCell),o=He(a[0],a[1],i);if(this.trgtEle.classList.contains("e-rowresize")){var s=Number(this.trgtEle.parentElement.getAttribute("aria-rowindex"))-2;if(this.isMouseMoved&&tt(i,s)&&this.trgtEle.classList.contains("e-skip-resize")&&e.clientY>this.trgtEle.getBoundingClientRect().top){this.trgtEle.classList.remove("e-skip-resize");var l={startIndex:s,endIndex:s,hide:!1,skipAppend:!0};this.parent.notify(vn,l);var d=this.parent.getRowHeaderTable().tBodies[0],h=this.parent.getContentTable().tBodies[0];l.hdrRow.style.display="none",l.row.style.display="none",d.insertBefore(l.hdrRow,d.children[l.insertIdx]),h.insertBefore(l.row,h.children[l.insertIdx]),this.trgtEle=l.hdrRow.firstElementChild,l.hdrRow.nextElementSibling.classList.remove("e-hide-end"),l.mergeCollection.forEach(function(e){n.parent.notify(gn,e)})}else if(this.trgtEle.classList.contains("e-skip-resize")){if(this.trgtEle.classList.remove("e-skip-resize"),!this.isMouseMoved&&tt(i,s)||!this.trgtEle.parentElement.previousElementSibling)return;this.trgtEle=this.trgtEle.parentElement.previousElementSibling.getElementsByClassName("e-header-cell")[0]}r=t=parseInt(this.trgtEle.parentElement.getAttribute("aria-rowindex"),10)-1,t=this.parent.getViewportIndex(r);var p=this.parent.frozenColCount(i),u=this.parent.getRow(r,null,p).style.height,f=e.clientY-this.event.clientY+parseInt(u,10);if(f<=0)return this.parent.hideRow(r),this.showHideCopyIndicator(),et(i,r,{height:0,customHeight:!0}),void this.parent.notify(ci,{eventArgs:{index:r,height:"0px",isCol:!1,sheetIndex:this.parent.activeSheetIndex,oldHeight:u},action:"resize"});if(this.setRowHeight(r,t,f+"px",u),this.parent.notify(oi,{rowIndex:r}),"none"===this.trgtEle.parentElement.style.display){var g=this.parent.getActiveSheet(),m=w(c(g.selectedRange));if(r<=m[2]&&r>m[0]){f=nt(g,r);for(var v=void 0,y=m[0];y<=m[2];y++)y!==r&&(u=nt(g,y)+"px",et(g,y,{customHeight:!0,height:f}),tt(g,y)?v||(v=y):(this.parent.getRow(y).style.height=f+"px",g.showHeaders&&(this.parent.getRow(y,this.parent.getRowHeaderTable()).style.height=f+"px")),this.parent.notify(ci,{eventArgs:{index:y,height:f+"px",isCol:!1,sheetIndex:this.parent.activeSheetIndex,oldHeight:u},action:"resize"}));this.parent.hideRow(m[0],r-1,!1),this.showHideCopyIndicator(),t+=Math.abs(r-v)}else 0===t||tt(g,r-1)?0!==t&&this.trgtEle.parentElement.classList.add("e-hide-end"):this.trgtEle.parentElement.previousElementSibling.classList.remove("e-hide-start"),this.parent.selectRange(g.selectedRange);this.trgtEle.parentElement.style.display="",this.parent.getContentTable().rows[t].style.display=""}}else if(this.trgtEle.classList.contains("e-colresize")){this.isMouseMoved&&this.trgtEle.classList.contains("e-unhide-column")&&e.clientX<this.trgtEle.getBoundingClientRect().left&&(this.trgtEle.classList.remove("e-unhide-column"),this.trgtEle.previousElementSibling&&(this.trgtEle=this.trgtEle.previousElementSibling)),t=parseInt(this.trgtEle.getAttribute("aria-colindex"),10)-1;var C=void 0;this.trgtEle.classList.contains("e-unhide-column")?(t-=1,C=0):C=lt(this.parent.getActiveSheet(),t),this.setColWidth(t,this.parent.getViewportIndex(t,!0),(this.parent.enableRtl?this.event.clientX-e.clientX:e.clientX-this.event.clientX)+C,C)}o&&o.format&&o.format.includes("*")&&this.parent.notify(Wr,{value:o.value,format:o.format,cell:o,formattedText:o.value,rowIndex:a[0],colIndex:a[1]})},e.prototype.resizeStart=function(e,t,r,n,i,a,o){_t(e,t,r,n,this.parent);var s,l,d=i?"resizeToFit":"resize";n?(s={index:e,width:r,isCol:n,sheetIndex:this.parent.activeSheetIndex,oldWidth:a},l=a!==r):(s={index:e,height:r,isCol:n,sheetIndex:this.parent.activeSheetIndex,oldHeight:a,isPrevCustomHeight:o},l=a!==r),l&&this.parent.notify(ci,{eventArgs:s,action:d})},e.prototype.updateCursor=function(){this.parent.element.getElementsByClassName("e-colresize-handler")[0]?this.parent.element.classList.add("e-col-resizing"):this.parent.element.classList.contains("e-col-resizing")&&this.parent.element.classList.remove("e-col-resizing"),this.parent.element.getElementsByClassName("e-rowresize-handler")[0]?this.parent.element.classList.add("e-row-resizing"):this.parent.element.classList.contains("e-row-resizing")&&this.parent.element.classList.remove("e-row-resizing")},e.prototype.getFloatingElementWidth=function(e,t){var r=e,n={filterRange:[],hasFilter:!1};return this.parent.notify("getFilterRange",n),n.hasFilter&&n.filterRange&&n.filterRange[1]<=t&&n.filterRange[3]>=t&&(r=e+22),r},e.prototype.destroy=function(){this.unwireEvents(),this.removeEventListener(),this.trgtEle&&this.trgtEle.remove(),this.trgtEle=null,this.event=null,this.parent=null},e.prototype.getModuleName=function(){return"resize"},e.prototype.propertyChange=function(e){"allowResizing"===e.propertyName&&this.wireEvents()},e}(),to=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.hideShow=function(e){var r=this,n=t.isUndefined(e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex,i=Ae(this.parent,n);if(e.startIndex>e.endIndex){var a=e.startIndex;e.startIndex=e.endIndex,e.endIndex=a}if(void 0!==e.actionUpdate){var o=e.isCol?[0,e.startIndex,i.rowCount-1,e.endIndex]:[e.startIndex,0,e.endIndex,i.colCount-1];if(oe(this.parent,o))return void(e.actionUpdate&&this.parent.notify(yi,null))}var s;if(e.actionUpdate){if(e.sheetIndex=n,s={eventArgs:e,action:"hideShow"},this.parent.notify(qr,s),e.cancel)return;delete e.cancel}e.hide&&(e.hiddenIndexes=[]);var l=function(t){e.isCol?(r.hideCol(e),t&&r.parent.sheetModule.colWidthChanged({colIdx:e.startIndex,isHideShow:!0})):(r.hideRow(e),t&&r.parent.sheetModule.rowHeightChanged({rowIdx:e.startIndex,isHideShow:!0}))},d=e.isCol?this.parent.frozenColCount(i):this.parent.frozenRowCount(i);if(d&&e.startIndex<d){var h=void 0;if(e.freezePane=!0,e.endIndex>=d&&(h=e.endIndex,e.endIndex=d-1),l(!0),delete e.freezePane,void 0!==h){var p=e.startIndex;e.endIndex=h,e.startIndex=d,l(!this.parent.scrollSettings.enableVirtualization),e.startIndex=p}}else l(!this.parent.scrollSettings.enableVirtualization);e.actionUpdate&&(this.updateIndexOnlyForHiddenColumnsAndRows(e,i),this.parent.notify(ci,s),or(this.parent.element))},e.prototype.updateIndexOnlyForHiddenColumnsAndRows=function(e,t){for(var r=e.startIndex,n=e.endIndex,i=e.startIndex;i<=n;i++)if(!1===(e.isCol?ot(t,i):Qe(t,i)||{}).hidden){e.startIndex=i;break}for(var a=e.endIndex;a>=r;a--)if(!1===(e.isCol?ot(t,a):Qe(t,a)||{}).hidden){e.endIndex=a;break}},e.prototype.hideRow=function(e){var r,n,i,a,o,s,l=this,d=t.isUndefined(e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex,h=Ae(this.parent,d),p=0,f=Object.assign({},e),m=this.parent.scrollSettings.isFinite&&!f.freezePane;if(m){if(f.startIndex>=h.rowCount)return;f.endIndex>=h.rowCount&&(f.endIndex=h.rowCount-1),s=0}var v=this.parent.frozenRowCount(h);if(f.hide){for(var y,C=void 0,b=void 0,x=[],S=[],w=m&&f.endIndex===j(h,h.rowCount-1,!1),I=f.startIndex;I<=f.endIndex;I++)if(tt(h,I))f.isFiltering&&!rt(h,I)&&et(h,I,{isFiltered:!0});else if(void 0===n&&(f.freezePane?(y=this.parent.sheetModule.getSelectAllTable(),C=this.parent.getColHeaderTable()):(y=this.parent.getRowHeaderTable(),C=this.parent.getContentTable()),n=this.parent.getViewportIndex(I),p=0),o={hidden:!0},f.isFiltering&&(o.isFiltered=!0),f.isFiltering||(x=gr(this.parent)),et(h,I,o),f.isFiltering||(S=gr(this.parent)),d===this.parent.activeSheetIndex)if(m&&(s+=nt(h,I,!0,!0)),this.refreshChart(I,"rows"),f.isFiltering||this.refreshChartCellModel(x,S),b=C&&C.rows[n]){if(!a)for(N=0;N<=h.usedRange.colIndex;N++)if(((r=He(I,N,h)||{}).colSpan||r.rowSpan)&&(f.startIndex>=this.parent.viewport.topIndex||this.parent.scrollSettings.enableVirtualization)){a=!0;break}if(a)continue;if(y.rows[n]&&t.detach(y.rows[n]),t.detach(b),p++,(b=C.rows[n])&&I===f.endIndex)for(var E=void 0,R=(i=j(h,I+1,!0))!==j(h,0,!0)&&i===(this.parent.viewport.topIndex>=f.startIndex?f.endIndex+1:this.parent.viewport.topIndex)?"Row":"",N=this.parent.viewport.leftIndex;N<=this.parent.viewport.rightIndex;N++)""!==(re=this.parent.getCellStyleValue(["borderTop"],[i,N]).borderTop)&&(E=b.cells[N],this.parent.notify(Xr,{onActionUpdate:!1,rowIdx:i,colIdx:N,style:{borderTop:re},row:b,pRow:b.previousElementSibling,first:R,td:E}))}else I<=this.parent.viewport.bottomIndex?p++:p--;if(f.refreshUI)return;if(a&&(f.startIndex>=this.parent.viewport.topIndex||!this.parent.scrollSettings.enableVirtualization))return void(f.isFiltering?e.refreshUI=!0:(this.parent.selectRange(h.selectedRange),h.frozenRows||h.frozenColumns?(this.parent.renderModule.refreshSheet(!1,!1,!0),e.refreshUI=!0):this.parent.renderModule.refreshUI({rowIndex:this.parent.viewport.topIndex,colIndex:this.parent.viewport.leftIndex,refresh:"Row"})));if(!p)return;this.parent.selectRange(h.selectedRange);var F=function(){if(h.showHeaders){var e=f.freezePane?1:0;n===e?y.rows[e]&&y.rows[e].classList.add("e-hide-end"):(y&&y.rows[n-1]&&y.rows[n-1].classList.add("e-hide-start"),y&&y.rows[n]&&y.rows[n].classList.add("e-hide-end"))}};if(!f.freezePane&&this.parent.scrollSettings.enableVirtualization){var A=f.startIndex,k=f.startIndex;if(f.startIndex<u(h.paneTopLeftCell)[0]||p>this.parent.viewport.rowCount){if(f.isFiltering)return void(e.refreshUI=!0);this.parent.updateTopLeftCell(j(h,f.startIndex-1<v?v:f.startIndex-1,!0)-v,null,"col"),this.parent.renderModule.refreshSheet(!1,!1,!0)}else{k=(A=this.parent.viewport.bottomIndex+1)+p-1;var O=this.parent.skipHidden(A,k,"rows",!1);if(A=O[0],k=O[1],m){if(A>=h.rowCount)return void(this.parent.viewport.topIndex+v===j(h,v,!0)?(F(),this.parent.notify("updateTranslate",{isHide:!0,height:s}),w&&(this.parent.viewport.bottomIndex=j(h,h.rowCount-1,!1))):this.parent.renderModule.refreshSheet(!1,!1,!0));if(k>=h.rowCount)return void this.parent.renderModule.refreshSheet(!1,!1,!0);this.parent.notify("updateTranslate",{isHide:!0,height:s})}this.parent.viewport.bottomIndex=k;var T=void 0,D=this.parent.frozenColCount(h),L=[];D?(L.push(v),L.push(this.parent.viewport.leftIndex+D),T=u(h.topLeftCell)[1]):T=this.parent.viewport.leftIndex,this.parent.renderModule.refreshUI({colIndex:T,rowIndex:A,direction:"",refresh:"RowPart",frozenIndexes:L},g(A,T)+":"+g(k,this.parent.viewport.rightIndex))}}F()}else{var P=void 0,M=void 0,B=void 0,b=void 0,H=void 0,U=void 0,C=void 0,V=void 0,z=void 0,_=f.startIndex-1,q=[],W=f.freezePane,G="lastElementChild",Y=0,X=this.parent.viewport.topIndex+v;if(m){var K=j(h,h.rowCount-1,!1);if(this.parent.viewport.bottomIndex===K)if(X===j(h,v,!0))W=!0;else{var $=c(h.paneTopLeftCell)[0];h.rowCount-1-$+1-this.parent.hiddenCount($,h.rowCount-1)<this.parent.viewport.rowCount+Math.round(this.parent.getThreshold("row")/2)&&(G="firstElementChild")}}for(var x=gr(this.parent),I=f.startIndex,Z=f.endIndex;I<=Z;I++)if(f.isFiltering?tt(h,I):tt(h,I)&&!rt(h,I))if(void 0===H){if(o={hidden:!1},f.isFiltering&&(o.isFiltered=!1),!W&&I>this.parent.viewport.bottomIndex){if(et(h,I,o),void 0===z)return}else if(void 0===z&&(z=I),et(h,I,o),d===this.parent.activeSheetIndex){m&&(s+=nt(h,I,!0,!0)),this.refreshChart(I,"rows"),void 0===n&&(P=document.createDocumentFragment(),M=document.createDocumentFragment(),U=this.parent.serviceLocator.getService("row"),f.freezePane?(V=this.parent.sheetModule.getSelectAllTable(),C=this.parent.getColHeaderTable()):(V=this.parent.getRowHeaderTable(),C=this.parent.getContentTable(),I<this.parent.viewport.topIndex+v&&(this.parent.viewport.topIndex=I-v)),n=this.parent.getViewportIndex(I)),_++,B=U.refresh(I,null,null,!0,!0),P.appendChild(B),V&&V.rows.length&&!W&&t.detach(V.tBodies[0][""+G]),b=M.appendChild(U.refresh(I,b,B)),C&&C.rows.length&&!W&&(t.detach(C.tBodies[0][""+G]),"firstElementChild"===G&&(void 0!==n&&n-1>-1&&(n-=1),Y+=nt(h,this.parent.viewport.topIndex,!0),this.parent.viewport.topIndex=j(h,this.parent.viewport.topIndex+1,!0)));for(N=this.parent.viewport.leftIndex;N<=this.parent.viewport.rightIndex;N++)if(void 0!==(r=He(I,N,h)||{}).rowSpan||void 0!==r.colSpan){var J={range:[I,N,I,N],isAction:!1,merge:!0,type:"All",skipChecking:!0};this.parent.notify(mn,J),q.length&&J.range[1]===q[q.length-1].range[1]&&J.range[0]===q[q.length-1].range[0]||q.push(J)}}}else Z=I;else{if(f.startIndex===f.endIndex)return;void 0===n?_++:H=I}S=gr(this.parent);if(this.refreshChartCellModel(x,S),void 0===n)return;var Q=void 0;if(!f.freezePane){if(f.isFiltering&&f.startIndex<u(h.paneTopLeftCell)[0]&&(e.refreshUI=!0,void 0===H||H===f.endIndex))return;var ee=this.parent.viewport.bottomIndex;this.parent.viewport.bottomIndex=this.parent.viewport.topIndex+v+this.parent.viewport.rowCount+2*this.parent.getThreshold("row");var te=this.parent.hiddenCount(f.endIndex+1,this.parent.viewport.bottomIndex);p=this.parent.hiddenCount(this.parent.viewport.topIndex+v,f.startIndex)+te,this.parent.viewport.bottomIndex+=p,m&&this.parent.viewport.bottomIndex>=h.rowCount&&(this.parent.viewport.bottomIndex=j(h,h.rowCount-1,!1)),!f.isFiltering&&z>=X&&z<=ee&&z>this.parent.viewport.bottomIndex-te-Math.abs(_-z)&&(Q=!0)}if(f.insertIdx=e.insertIdx=n,f.row=e.row=M.querySelector(".e-row"),f.mergeCollection=e.mergeCollection=q,h.showHeaders&&(e.hdrRow=f.hdrRow=P.querySelector(".e-row"),0!==n&&!tt(h,_-1)&&V.rows[n-1]&&V.rows[n-1].classList.remove("e-hide-start"),0!==f.startIndex&&tt(h,f.startIndex-1)&&f.hdrRow.classList.add("e-hide-end"),tt(h,_+1)?P.lastElementChild.classList.add("e-hide-start"):V.rows[n]&&V.rows[n].classList.remove("e-hide-end")),b&&C&&C.rows[n]){i=j(h,_+1,!0);for(I=this.parent.viewport.leftIndex;I<=this.parent.viewport.rightIndex;I++){var re=this.parent.getCellStyleValue(["borderTop"],[i,I]).borderTop;if(""!==re){this.parent.notify(Xr,{onActionUpdate:!1,rowIdx:i,colIdx:I,style:{borderTop:re},pRow:b,td:C.rows[n].cells[I],first:""});var ne=j(h,z-1,!1);ne>-1?!C.rows[n-1]||this.parent.getCellStyleValue(["borderBottom"],[ne,I]).borderBottom||this.parent.getCellStyleValue(["borderTop"],[z,I]).borderTop||(C.rows[n-1].cells[I].style.borderBottom=""):C.rows[n].cells[I].style.borderTop=""}}}if(f.skipAppend)return;m&&this.parent.notify("updateTranslate",{height:s,size:Y}),Q||Math.abs(_-z)>this.parent.viewport.rowCount+2*this.parent.getThreshold("row")?this.parent.renderModule.refreshSheet(!1,!1,!0):(V&&(V.tBodies[0].rows.length?V.tBodies[0].insertBefore(P,V.rows[n]):V.tBodies[0].appendChild(P)),C&&C.tBodies[0]&&(C.tBodies[0].rows.length?C.tBodies[0].insertBefore(M,C.rows[n]):C.tBodies[0].appendChild(M)),this.parent.selectRange(h.selectedRange),f.autoFit&&h.showHeaders&&this.parent.notify(ai,{startIndex:f.startIndex,endIndex:f.endIndex,isRow:!0}),q.forEach(function(e){l.parent.notify(gn,e)}),void 0!==H&&H!==f.endIndex&&(f.startIndex=H,this.hideRow(f)))}},e.prototype.hideCol=function(e){for(var r,n=this,i=t.isUndefined(e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex,a=Ae(this.parent,i),o=[],s=[],l=u(a.paneTopLeftCell),d=this.parent.frozenColCount(a),h=this.parent.frozenRowCount(a),p=this.parent.viewport.leftIndex+d,c=j(a,a.colCount-1,!1,"columns"),f=e.startIndex;f<=e.endIndex;f++){if(e.hide){if(ht(a,f))continue}else if(!ht(a,f)||e.hiddenIndexes&&-1===e.hiddenIndexes.indexOf(f))continue;var g=gr(this.parent);st(a,f,{hidden:e.hide});var v=gr(this.parent);this.refreshChart(f,"columns"),this.refreshChartCellModel(g,v),this.parent.scrollSettings.enableVirtualization&&!e.freezePane&&(f<p||f>this.parent.viewport.rightIndex&&(!this.parent.scrollSettings.isFinite||!(c===this.parent.viewport.rightIndex&&f>=c&&f<a.colCount)))?f<p&&s.push(f):(o.push(f),e.hide&&(e.hiddenIndexes.push(f),f<=l[1]&&(r=!0)))}if((s.length||o.length)&&i===this.parent.activeSheetIndex){var y,C,b=u(a.topLeftCell),x=function(){var t;return t=n.parent.scrollSettings.enableVirtualization?[h?b[0]:n.parent.viewport.topIndex,n.parent.viewport.bottomIndex]:[0,a.rowCount-1],e.freezePane?(y=n.parent.getRowHeaderTable(),C=n.parent.sheetModule.getSelectAllTable()):(y=n.parent.getContentTable(),C=n.parent.getColHeaderTable()),t};if(e.hide){if(!o.length)return;if((o.length<=this.parent.getThreshold("col")||!this.parent.scrollSettings.enableVirtualization||e.freezePane)&&this.removeCell(a,o,x(),y,C),!e.freezePane&&this.parent.scrollSettings.enableVirtualization){if(r)return this.parent.updateTopLeftCell(null,j(a,o[0]-1<d?d:o[0]-1,!0,"columns")-d,"row"),void this.parent.renderModule.refreshSheet(!1,!1,!0);var S=[],w=this.parent.viewport.topIndex,I=h?b[0]:w;if(h&&(S=[h+w,d]),this.parent.scrollSettings.isFinite){var E=j(a,a.colCount-1,!1,"columns"),R=this.parent.viewport.leftIndex+d,N=this.parent.viewport.rightIndex;if(N+o.length>=E){var F=j(a,R-(N+o.length-E),!1,"columns");return F>=d&&(this.parent.viewport.leftIndex=F,this.parent.viewport.leftIndex-=this.parent.hiddenCount(N,E)),this.parent.viewport.rightIndex=E,R!==this.parent.viewport.leftIndex+d||N!==this.parent.viewport.rightIndex?(this.parent.renderModule.refreshUI({colIndex:this.parent.viewport.leftIndex,refresh:"Column",frozenIndexes:S,rowIndex:I,skipUpdateOnFirst:this.parent.viewport.leftIndex+d===j(a,d,!0,"columns")}),h&&(this.parent.viewport.topIndex=w)):this.parent.notify("updateTableWidth",{refresh:"Column",isUpdate:!0}),void this.parent.selectRange(a.selectedRange)}}if(o.length<=this.parent.getThreshold("col")){var A=this.parent.skipHidden(this.parent.viewport.rightIndex+1,this.parent.viewport.rightIndex+o.length,"columns");this.parent.viewport.rightIndex=A[1],this.parent.renderModule.refreshUI({rowIndex:I,colIndex:A[0],direction:"",refresh:"ColumnPart",frozenIndexes:S},""+m([I,A[0],this.parent.viewport.bottomIndex,A[1]]))}else this.parent.renderModule.refreshUI({skipUpdateOnFirst:this.parent.viewport.leftIndex+d===j(a,d,!0,"columns"),rowIndex:I,colIndex:this.parent.viewport.leftIndex,refresh:"Column",frozenIndexes:S}),h&&(this.parent.viewport.topIndex=w)}this.parent.selectRange(a.selectedRange)}else{if(s.length&&this.parent.scrollSettings.enableVirtualization){s.sort(function(e,t){return e-t});var k=s[0]-1<d?d:s[0]-1;return this.parent.updateTopLeftCell(null,j(a,k,!0,"columns")-d,"row"),this.parent.renderModule.refreshSheet(!1,!1,!0),void(e.autoFit&&(e.autoFit=!1))}(!this.parent.scrollSettings.isFinite||this.parent.viewport.rightIndex<c)&&(o.length<=this.parent.getThreshold("col")||!this.parent.scrollSettings.enableVirtualization||e.freezePane)?(this.appendCell(a,o,x(),y,C,e.freezePane),this.parent.scrollSettings.enableVirtualization&&!e.freezePane&&this.parent.notify("virtualContentLoaded",{refresh:"Column",prevRowColCnt:{rowCount:a.rowCount,colCount:a.colCount}}),this.parent.selectRange(a.selectedRange)):this.parent.renderModule.refreshSheet(!1,!1,!0)}}},e.prototype.removeCell=function(e,r,n,i,a){var o,s,l,d,h,p=this,c=n[0],u=n[1],f=0,g=r.length-1,m=this.parent.frozenRowCount(e),v=i.getElementsByTagName("colgroup")[0],y=this.parent.getViewportIndex(r[0],!0)+1,C=j(e,m-1,!1);for(e.showHeaders&&(l=a.getElementsByTagName("colgroup")[0],o=a.rows[0]);c<=u;)tt(e,c)?c++:(s=m&&c<m?a.rows[f+1]:i.rows[f],r.forEach(function(n,i){if(0===f&&c>=m&&(e.showHeaders&&(t.detach(l.children[y]),t.detach(o.cells[y])),t.detach(v.children[y])),t.detach(s.cells[y]),0===i&&(void 0!==(d=He(c,n,e,!1,!0)).colSpan&&(void 0===d.rowSpan||d.colSpan>1)||d.rowSpan<0&&c-1>-1&&tt(e,c-1)&&Math.abs(d.rowSpan)===p.parent.hiddenCount(c+d.rowSpan,c,"rows",e))&&p.parent.notify("hiddenMerge",{rowIdx:c,colIdx:n,model:"col",start:r[0],end:r[g]}),i===g){h=j(e,n+1,!0,"columns");var a=p.parent.getCellStyleValue(["borderLeft"],[f,h]).borderLeft;""!==a&&p.parent.notify(Xr,{onActionUpdate:!1,rowIdx:f,colIdx:h,style:{borderLeft:a},row:s,first:""}),(void 0!==(d=He(c,n,e)||{}).colSpan&&(void 0===d.rowSpan||d.colSpan>1)||d.rowSpan<0&&c-1>-1&&tt(e,c-1)&&Math.abs(d.rowSpan)===p.parent.hiddenCount(c+d.rowSpan,c,"rows",e))&&p.parent.notify("hiddenMerge",{rowIdx:c,colIdx:n,model:"col",start:r[0],end:r[g],isEnd:!0})}}),m&&c===C?(f=0,c=this.parent.viewport.topIndex+m):(f++,c++));y-1>-1&&e.showHeaders&&o.cells[y-1]&&o.cells[y-1].classList.add("e-hide-start"),e.showHeaders&&o.cells[y]&&o.cells[y].classList.add("e-hide-end")},e.prototype.appendCell=function(e,r,n,i,a,o){var s,l,d,h,p=this,c=n[0],u=n[1],f=0,m=r.length-1,v=this.parent.frozenRowCount(e),y=i.getElementsByTagName("colgroup")[0];e.showHeaders&&(d=a.getElementsByTagName("colgroup")[0],s=a.rows[0]);var C=this.parent.serviceLocator.getService("cell");r.sort(function(e,t){return e-t});for(var b,x,S,w,I=[],E=[],R=j(e,v-1,!1);c<=u;)tt(e,c)?c++:(l=v&&c<v?a.rows[f+1]:i.rows[f],r.forEach(function(n,i){if(0===f&&(E[i]=p.parent.getViewportIndex(n,!0),e.showHeaders&&(x=s.cells[E[i]])&&(0===i&&r[i]&&!ht(e,r[i]-1)&&x.previousSibling&&x.previousElementSibling.classList.remove("e-hide-start"),i===m&&x.classList.remove("e-hide-end")),c>=v&&(y.children[E[i]]?(y.insertBefore(p.parent.sheetModule.updateCol(e,n),y.children[E[i]]),e.showHeaders&&C.renderColHeader(n,s,x)):(y.appendChild(p.parent.sheetModule.updateCol(e,n)),e.showHeaders&&C.renderColHeader(n,s)),o||(t.detach(y.lastChild),e.showHeaders&&t.detach(s.lastChild)),e.showHeaders&&i===m&&(t.detach(d),a.insertBefore(y.cloneNode(!0),a.tHead)))),o||t.detach(l.lastChild),x=l.cells[E[i]],w={rowIdx:c,colIdx:n,cell:He(c,n,e),row:l,address:g(c,n),lastCell:n===m,isHeightCheckNeeded:!0,first:n!==j(e,0,!0,"columns")&&n===p.parent.viewport.leftIndex?"Column":"",checkNextBorder:i===m?"Column":"",checkCF:!0},x&&(w.refChild=x),b=C.render(w),0===i&&b.previousSibling&&""!==p.parent.getCellStyleValue(["borderLeft"],[f,j(e,r[r.length-1]+1,!0,"columns")]).borderLeft&&(h=j(e,r[0]-1,!1,"columns"))>-1&&!p.parent.getCellStyleValue(["borderRight"],[f,h]).borderRight&&!p.parent.getCellStyleValue(["borderLeft"],[f,r[0]]).borderLeft&&(b.previousSibling.style.borderRight=""),void 0!==(S=He(c,n,e)||{}).colSpan&&(void 0===S.rowSpan||S.colSpan>1)||S.rowSpan<0&&c-1>-1&&tt(e,c-1)&&Math.abs(S.rowSpan)===p.parent.hiddenCount(c+S.rowSpan,c,"rows",e)){var u={range:[c,n,c,n],isAction:!1,merge:!0,type:"All",skipChecking:!0};p.parent.notify(mn,u),I.length&&u.range[1]===I[I.length-1].range[1]&&u.range[0]===I[I.length-1].range[0]||I.push(u)}}),v&&c===R?(c=this.parent.viewport.topIndex+v,f=0):(c++,f++));I.forEach(function(e){p.parent.notify(gn,e)}),this.parent.viewport.rightIndex=j(e,this.parent.viewport.rightIndex-r.length,!1,"columns")},e.prototype.refreshChart=function(e,t){this.parent.notify("refreshChart",{rIdx:e,showHide:t})},e.prototype.refreshChartCellModel=function(e,t){this.parent.notify("refreshChartCellModel",{prevChartIndexes:e,currentChartIndexes:t})},e.prototype.addEventListener=function(){this.parent.on(vn,this.hideShow,this),this.parent.on(Gn,this.destroy,this)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.off(vn,this.hideShow),this.parent.off(Gn,this.destroy)},e}(),ro=function(){function e(e){this.divElements=[],this.inputElements=[],this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on("initiateHyperlink",this.initiateHyperlinkHandler,this),this.parent.on("editHyperlink",this.editHyperlinkHandler,this),this.parent.on("openHyperlink",this.openHyperlinkHandler,this),this.parent.on(Xn,this.hyperlinkClickHandler,this),this.parent.on("createHyperlinkElement",this.createHyperlinkEle,this),this.parent.on(Kn,this.keyUpHandler,this),this.parent.on("deleteHyperlink",this.removeHyperlink,this),this.parent.on(si,this.removeHyperlinkHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("initiateHyperlink",this.initiateHyperlinkHandler),this.parent.off("editHyperlink",this.editHyperlinkHandler),this.parent.off("openHyperlink",this.openHyperlinkHandler),this.parent.off(Xn,this.hyperlinkClickHandler),this.parent.off("createHyperlinkElement",this.createHyperlinkEle),this.parent.off(Kn,this.keyUpHandler),this.parent.off("deleteHyperlink",this.removeHyperlink),this.parent.off(si,this.removeHyperlinkHandler))},e.prototype.getModuleName=function(){return"spreadsheetHyperlink"},e.prototype.keyUpHandler=function(e){var r=e.target;if(t.closest(r,".e-document")){var n=document.querySelector(".e-hyp-text"),i=this.parent.element.querySelector(".e-hyperlink-alert-span"),a=(t.closest(r,".e-hyperlink-dlg")||t.closest(r,".e-edithyperlink-dlg")).getElementsByClassName("e-footer-content")[0].firstChild;n&&!t.isNullOrUndefined(n.value)&&(O(n.value.toUpperCase())?i&&(i.remove(),a.removeAttribute("disabled")):(this.showDialog(),a.setAttribute("disabled","true")))}if(r.classList.contains("e-text")&&t.closest(r,".e-cont")&&t.closest(r,".e-webpage")&&t.closest(r,".e-webpage").getElementsByClassName("e-cont")[1]===r.parentElement){a=(t.closest(r,".e-hyperlink-dlg")||t.closest(r,".e-edithyperlink-dlg")).getElementsByClassName("e-footer-content")[0].firstChild;""!==r.value?a.removeAttribute("disabled"):!!t.closest(r,".e-link-dialog").querySelector(".e-webpage").querySelectorAll(".e-cont")[1].querySelector(".e-text").value||a.setAttribute("disabled","true")}},e.prototype.initiateHyperlinkHandler=function(){var e=this,t=this.parent.getActiveSheet();if(t.isProtected&&(!t.protectSettings.insertLink||sr(this.parent)))return void this.parent.notify(vi,null);if(oe(this.parent))return void this.parent.notify(yi,null);var r=this.parent.serviceLocator.getService(Na);if(!this.parent.element.querySelector(".e-hyperlink-dlg")){var n,i=this.parent.serviceLocator.getService(Fa);i.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-hyperlink-dlg",header:r.getConstant("InsertLink"),beforeOpen:function(t){var r={dialogName:"InsertLinkDialog",element:t.element,target:t.target,cancel:t.cancel};if(e.parent.trigger("dialogBeforeOpen",r),r.cancel)return void(t.cancel=!0);i.dialogInstance.content=e.hyperlinkContent(),n=i.dialogInstance.content.querySelector(".e-text").value,i.dialogInstance.dataBind(),or(e.parent.element)},open:function(){setTimeout(function(){or(i.dialogInstance.element.querySelectorAll(".e-webpage input")[1])})},beforeClose:this.dialogBeforeClose.bind(this),buttons:[{buttonModel:{content:r.getConstant("Insert"),isPrimary:!0,disabled:!0},click:function(){e.dlgClickHandler(n),i.hide()}}]})}},e.prototype.dialogBeforeClose=function(){var e=this.headerTabs;e&&e.element&&(e.destroy(),e.element.remove()),this.headerTabs=null,br(this.inputElements),this.inputElements=[],br(this.divElements),this.divElements=[]},e.prototype.dlgClickHandler=function(e){var t,r,n=this.parent.getActiveSheet(),i=n.name+"!"+n.selectedRange,a=this.parent.element.querySelector(".e-link-dialog").getElementsByClassName("e-content")[0].querySelector(".e-item.e-active");if(a)if((t=a.getElementsByClassName("e-cont")[0].querySelector(".e-text").value)===e&&(t=null),a.querySelector(".e-webpage")){d={address:r=a.getElementsByClassName("e-cont")[1].querySelector(".e-text").value};this.parent.insertHyperlink(d,i,t,!1)}else{r=a.getElementsByClassName("e-cont")[1].querySelector(".e-text").value;var o=a.getElementsByClassName("e-cont")[2];if(o.getElementsByClassName("e-list-item")[0].querySelector(".e-active")){d={address:r=a.getElementsByClassName("e-cont")[2].querySelector(".e-active").textContent+"!"+r.toUpperCase()};this.parent.insertHyperlink(d,i,t,!1)}else if(o.querySelector(".e-active"))for(var s=a.getElementsByClassName("e-cont")[2].querySelector(".e-active").textContent,l=0;l<this.parent.definedNames.length;l++)if(this.parent.definedNames[l].name===s){var d={address:this.parent.definedNames[l].name};this.parent.insertHyperlink(d,i,t,!1)}}},e.prototype.showDialog=function(){this.parent.element.querySelector(".e-hyperlink-alert-span")&&this.parent.element.querySelector(".e-hyperlink-alert-span").remove();var e=this.parent.serviceLocator.getService(Na),t=this.parent.createElement("span",{className:"e-hyperlink-alert-span"});t.innerText=e.getConstant("HyperlinkAlert"),(this.parent.element.querySelector(".e-hyperlink-dlg")||this.parent.element.querySelector(".e-edithyperlink-dlg")).querySelector(".e-dlg-content").appendChild(t)},e.prototype.editHyperlinkHandler=function(){var e,t=this,r=this.parent.serviceLocator.getService(Na),n=this.parent.serviceLocator.getService(Fa);n.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-edithyperlink-dlg",header:r.getConstant("EditLink"),beforeOpen:function(r){var i={dialogName:"EditLinkDialog",element:r.element,target:r.target,cancel:r.cancel};if(t.parent.trigger("dialogBeforeOpen",i),i.cancel)return void(r.cancel=!0);n.dialogInstance.content=t.hyperEditContent(),e=n.dialogInstance.content.querySelector(".e-text").value,n.dialogInstance.dataBind(),or(t.parent.element)},open:function(){setTimeout(function(){or(n.dialogInstance.element.querySelector(".e-webpage")?n.dialogInstance.element.querySelectorAll(".e-webpage input")[1]:n.dialogInstance.element.querySelectorAll(".e-document input")[1])})},buttons:[{buttonModel:{content:r.getConstant("Update"),isPrimary:!0},click:function(){t.dlgClickHandler(e),n.hide()}}]})},e.prototype.openHyperlinkHandler=function(){var e=u(this.parent.getActiveSheet().activeCell),t=this.parent.getCell(e[0],e[1]);t.getElementsByClassName("e-hyperlink")[0]&&(t=t.querySelector(".e-hyperlink")),this.hlOpenHandler(t)},e.prototype.hlOpenHandler=function(e,r,n){var i=this;if(e.classList.contains("e-hyperlink")){var a=t.closest(e,".e-cell");if(!a)return;var o=["",""],s=void 0,l=!0,d=this.parent.getActiveSheet(),h=parseInt(a.getAttribute("aria-colindex"),10)-1,p=parseInt(a.parentElement.getAttribute("aria-rowindex"),10)-1,u=He(p,h,d,!1,!0);u.style&&"#00e"===u.style.color&&(Y(this.parent,d,{rowIdx:p,colIdx:h,preventEvt:!0,cell:{style:{color:"#551a8b"}}}),a.style.color="#551a8b");var f=u.hyperlink,g=void 0,v={hyperlink:f,address:d.activeCell,target:"_blank",cancel:!1};if(this.parent.trigger("beforeHyperlinkClick",v),v.cancel)return void(n&&n.preventDefault());var y={hyperlink:f=v.hyperlink,address:d.activeCell};"string"==typeof f&&(g=f),"object"==typeof f&&(g=f.address);var C=g;if(-1===g.indexOf("http://")&&-1===g.indexOf("https://")&&-1===g.indexOf("ftp://")){if(!t.isNullOrUndefined(g)){if(this.parent.definedNames)for(x=0;x<this.parent.definedNames.length;x++)if(this.parent.definedNames[x].name===g){g=(g=this.parent.definedNames[x].refersTo).slice(1);break}-1!==g.lastIndexOf("!")?(o[0]=g.substring(0,g.lastIndexOf("!")),o[0].startsWith("'")&&o[0].endsWith("'")&&(o[0]=o[0].slice(1,o[0].length-1)),o[1]=g.substring(g.lastIndexOf("!")+1)):(o[0]=this.parent.getActiveSheet().name,o[1]=g);for(var b,x=0;x<this.parent.sheets.length;x++)this.parent.sheets[x].name===o[0]&&(b=x);if(d=this.parent.sheets[b],-1!==o[1].indexOf(":")){var S=o[1].indexOf(":"),w=o[1].substr(0,S),I=o[1].substr(S+1,o[1].length);w=w.replace("$",""),(I=I.replace("$","")).match(/\D/g)&&!I.match(/[0-9]/g)&&w.match(/\D/g)&&!w.match(/[0-9]/g)?(w+="1",I+=d.rowCount,o[1]=w+":"+I):!I.match(/\D/g)&&I.match(/[0-9]/g)&&!w.match(/\D/g)&&w.match(/[0-9]/g)&&(s=[parseInt(w,10)-1,0,parseInt(I,10)-1,d.colCount-1],l=!1)}var E=void 0,R=this.parent.definedNames;if(!t.isNullOrUndefined(R))for(x=0;x<R.length;x++)if(R[x].name===C){E=!0;break}if(O(o[1])||E){if(s=l?c(o[1]):s,!t.isNullOrUndefined(d)){var N=m(s);if(d===this.parent.getActiveSheet())ft(function(){i.parent.goTo(N)});else{if(N.indexOf(":")>=0){var F=N.split(":");N=F[0]===F[1]?F[0]:N}ft(function(){i.parent.goTo(i.parent.sheets[b].name+"!"+N)})}}}else this.showInvalidHyperlinkDialog()}}else r||(this.isValidUrl(g)?window.open(g,v.target):this.showInvalidHyperlinkDialog());this.parent.trigger("afterHyperlinkClick",y)}},e.prototype.isValidUrl=function(e){return/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(e)},e.prototype.showInvalidHyperlinkDialog=function(){var e=this.parent.serviceLocator.getService(Fa),t=this.parent.serviceLocator.getService(Na);e.show({width:323,isModal:!0,showCloseIcon:!0,header:t.getConstant("Hyperlink"),content:t.getConstant("InvalidHyperlinkAlert"),buttons:[{buttonModel:{content:t.getConstant("Ok"),isPrimary:!0},click:function(){e.hide()}}]},!1)},e.prototype.hyperlinkClickHandler=function(e){var r=e.target;if(t.closest(r,".e-link-dialog")&&t.closest(r,".e-toolbar-item")){var n=(u=(c=t.closest(r,".e-hyperlink-dlg")||t.closest(r,".e-edithyperlink-dlg")).getElementsByClassName("e-footer-content")[0]).firstChild,i=c.querySelector(".e-document"),a=c.querySelector(".e-webpage"),o=a?a.querySelectorAll(".e-cont")[0].querySelector(".e-text").value:i.querySelectorAll(".e-cont")[0].querySelector(".e-text").value,s=i?i.querySelectorAll(".e-cont")[0].querySelector(".e-text").value:o;if(t.closest(r,".e-toolbar-items").getElementsByClassName("e-toolbar-item")[1].classList.contains("e-active")){var l=i.querySelectorAll(".e-cont")[2].querySelector(".e-active");i.querySelectorAll(".e-cont")[0].querySelector(".e-text").value=o,t.closest(l,".e-list-item").classList.contains("e-level-2")&&n.hasAttribute("disabled")?n.removeAttribute("disabled"):t.closest(l,".e-list-item").classList.contains("e-level-1")&&!n.hasAttribute("disabled")&&n.setAttribute("disabled","true")}else{var d=!a.querySelectorAll(".e-cont")[1].querySelector(".e-text").value;a.querySelectorAll(".e-cont")[0].querySelector(".e-text").value=s,d&&!n.hasAttribute("disabled")?n.setAttribute("disabled","true"):!d&&n.hasAttribute("disabled")&&n.removeAttribute("disabled")}}if(t.closest(r,".e-list-item")&&r.classList.contains("e-fullrow")){var h=this.parent.element.getElementsByClassName("e-link-dialog")[0];if(!h)return;var p=(h=h.getElementsByClassName("e-content")[0].getElementsByClassName("e-active")[0]).getElementsByClassName("e-cont")[1].getElementsByClassName("e-text")[0],c=t.closest(r,".e-hyperlink-dlg")||t.closest(r,".e-edithyperlink-dlg"),u=c.getElementsByClassName("e-footer-content")[0],n=u.firstChild;t.closest(r,".e-list-item").classList.contains("e-level-2")?"defName"===t.closest(r,".e-list-item").getAttribute("data-uid")?(p.classList.contains("e-disabled")||p.hasAttribute("readonly")||(p.setAttribute("readonly","true"),p.classList.add("e-disabled"),p.setAttribute("disabled","true")),n.hasAttribute("disabled")&&n.removeAttribute("disabled")):"sheet"===t.closest(r,".e-list-item").getAttribute("data-uid")&&(p.classList.contains("e-disabled")&&p.hasAttribute("readonly")&&(p.removeAttribute("readonly"),p.classList.remove("e-disabled"),p.removeAttribute("disabled")),O(p.value.toUpperCase())&&n.hasAttribute("disabled")&&n.removeAttribute("disabled")):t.closest(r,".e-list-item").classList.contains("e-level-1")&&n.setAttribute("disabled","true")}else this.hlOpenHandler(r,!0,e)},e.prototype.createHyperlinkEle=function(e){var r=e.cell;if(!t.isNullOrUndefined(r.hyperlink)){var n=e.td,i=this.parent.createElement("a",{className:"e-hyperlink e-hyperlink-style"}),a=void 0;if("string"==typeof r.hyperlink?(0===r.hyperlink.toLowerCase().indexOf("www.")&&(r.hyperlink="http://"+r.hyperlink),a=r.hyperlink):0===(a=r.hyperlink.address).toLowerCase().indexOf("www.")&&(r.hyperlink.address=a="http://"+a),0===a.indexOf("http://")||0===a.indexOf("https://")||0===a.indexOf("ftp://")?(i.setAttribute("href",a),i.setAttribute("target","_blank")):(a.includes("=")||a.includes("!"))&&i.setAttribute("ref",a),"Accounting"===$e(r.format)?i.innerHTML=n.innerHTML:i.innerText=""!==n.innerText?n.innerText:a,n.textContent="",n.innerText="","FillWithoutFormatting"!==this.parent.autoFillSettings.fillType&&"FillWithoutFormatting"!==e.fillType&&"Clear Formats"!==e.action||(i.style.textDecoration="none"),n.appendChild(i),!e.style.color||!e.style.textDecoration){var o={};e.style.color||(e.style.color=o.color="#00e"),e.style.textDecoration||(e.style.textDecoration=o.textDecoration="underline"),Y(this.parent,this.parent.getActiveSheet(),{rowIdx:e.rowIdx,colIdx:e.colIdx,preventEvt:!0,cell:{style:o}})}}},e.prototype.hyperEditContent=function(){var e=!0,t=this.hyperlinkContent(),r=c(this.parent.getActiveSheet().activeCell),n=this.parent.sheets[this.parent.getActiveSheet().id-1].rows[r[0]].cells[r[1]];this.parent.scrollSettings.enableVirtualization&&(r[0]=r[0]-this.parent.viewport.topIndex,r[1]=r[1]-this.parent.viewport.leftIndex);var i,a=this.parent.getDisplayText(n),o=n.hyperlink;"string"==typeof o?(i=o,a=a||i,-1===i.indexOf("http://")&&-1===i.indexOf("https://")&&-1===i.indexOf("ftp://")&&(e=!1)):"object"==typeof o&&(i=o.address,a=a||i,-1===i.indexOf("http://")&&-1===i.indexOf("https://")&&-1===i.indexOf("ftp://")&&(e=!1));for(var s=0,l=0,d=this.parent.definedNames,h=this.parent.sheets,p=0,u=d.length;p<u;p++)d[p].name===i&&s++;for(var p=0,u=h.length;p<u;p++)i.includes(h[p].name)&&l++;0===s&&0===l&&(e=!0);var f=t.querySelector(".e-content");if(e){var g=f.querySelector(".e-webpage");g.getElementsByClassName("e-cont")[0].getElementsByClassName("e-text")[0].setAttribute("value",a),"string"==typeof o?g.getElementsByClassName("e-cont")[1].querySelector(".e-text").setAttribute("value",o):g.getElementsByClassName("e-cont")[1].querySelector(".e-text").setAttribute("value",o.address)}else{var m=void 0,v=f.querySelector(".e-document");v.getElementsByClassName("e-cont")[0].getElementsByClassName("e-text")[0].setAttribute("value",a);var y=void 0,C=void 0;if(this.parent.definedNames)for(p=0;p<this.parent.definedNames.length;p++)if(this.parent.definedNames[p].name===i){m=!0;break}if(m){var b=v.getElementsByClassName("e-cont")[1].getElementsByClassName("e-text")[0];b.setAttribute("readonly","true"),b.classList.add("e-disabled"),b.setAttribute("disabled","true");for(var x=(w=v.getElementsByClassName("e-cont")[2]).querySelectorAll(".e-list-item.e-level-1")[1],p=0;p<x.getElementsByTagName("li").length;p++)x.getElementsByTagName("li")[p].innerText===i&&x.getElementsByTagName("li")[p].classList.add("e-active")}else{if(i&&-1!==i.lastIndexOf("!")){var S=i.lastIndexOf("!");y=i.substring(0,S),C=i.substring(S+1)}v.getElementsByClassName("e-cont")[1].querySelector(".e-text").setAttribute("value",C);for(var w=v.getElementsByClassName("e-cont")[2],x=w.querySelectorAll(".e-list-item.e-level-1")[0],p=0;p<x.getElementsByTagName("li").length;p++)if(x.getElementsByTagName("li")[p].innerText===y){if(x.getElementsByTagName("li")[p].classList.contains("e-active"))break;x.getElementsByTagName("li")[p].classList.add("e-active")}else x.getElementsByTagName("li")[p].classList.contains("e-active")&&x.getElementsByTagName("li")[p].classList.remove("e-active")}}return t},e.prototype.hyperlinkContent=function(){var e,r,n=this.parent.serviceLocator.getService(Na),a=0,o=0,s=!0,l=!0,d=c(this.parent.getActiveSheet().activeCell),h=this.parent.getActiveSheet(),p=He(d[0],d[1],h),u=!0;if(p){u=!!(p.value&&"string"==typeof p.value&&null!==p.value.match("[A-Za-z]+")||""===p.value||t.isNullOrUndefined(p.value));var f=p.hyperlink;if("string"==typeof f)-1===(g=f).indexOf("http://")&&-1===g.indexOf("https://")&&-1===g.indexOf("ftp://")&&(r=f,s=!1);else if("object"==typeof f){var g=f.address;-1===g.indexOf("http://")&&-1===g.indexOf("https://")&&-1===g.indexOf("ftp://")&&(r=f.address,s=!1)}if(r){for(var m=0,v=0,y=this.parent.definedNames,C=this.parent.sheets,b=0,x=C.length;b<x;b++)r.includes(C[b].name)&&v++;for(var S=0,x=y.length;S<x;S++)y[S].name===r&&m++;0===m&&0===v&&(s=!0)}if(o=s?0:1,this.parent.definedNames)for(var w=0;w<this.parent.definedNames.length;w++)if(this.parent.definedNames[w].name===r){e=!0,l=!1;break}}var I=this.parent.createElement("div",{className:"e-link-dialog"}),E=this.parent.createElement("div",{className:"e-webpage"}),R=this.parent.createElement("div",{className:"e-document"});this.headerTabs=new i.Tab({selectedItem:o,items:[{header:{text:n.getConstant("WebPage")},content:E},{header:{text:n.getConstant("ThisDocument")},content:R}]}),this.headerTabs.appendTo(I);var N=I.querySelector(".e-toolbar-items").querySelector(".e-indicator");N.style.cssText=s?"left: 0; right: 136px":"left: 136px; right: 0";var F=this.parent.createElement("div",{className:"e-cont"}),A=this.parent.createElement("div",{className:"e-cont"}),k=this.parent.createElement("div",{className:"e-header"});k.innerText=n.getConstant("DisplayText");var O=this.parent.createElement("div",{className:"e-header"});O.innerText=n.getConstant("Url");var T=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"Text"}});this.inputElements.push(T),u||(T.classList.add("e-disabled"),T.setAttribute("readonly","true"),T.setAttribute("disabled","true")),p&&t.isNullOrUndefined(p.hyperlink)&&T.setAttribute("value",this.parent.getDisplayText(p));var D=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"Text"}});this.inputElements.push(D),T.setAttribute("placeholder",n.getConstant("EnterTheTextToDisplay")),D.setAttribute("placeholder",n.getConstant("EnterTheUrl")),F.appendChild(T),F.insertBefore(k,T),A.appendChild(D),A.insertBefore(O,D),E.appendChild(A),E.insertBefore(F,A);var L=[],P=[],M=this.parent.sheets;for(a;a<this.parent.sheets.length;a++){var B=this.parent.sheets[a].name;"Visible"===this.parent.sheets[a].state&&(M[a]===this.parent.getActiveSheet()?L.push({nodeId:"sheet",nodeText:-1!==B.indexOf(" ")?"'"+B+"'":B,selected:!0}):L.push({nodeId:"sheet",nodeText:-1!==B.indexOf(" ")?"'"+B+"'":B}))}for(a=0;a<this.parent.definedNames.length;a++)P.push({nodeId:"defName",nodeText:this.parent.definedNames[a].name});var H=[{nodeId:"01",nodeText:n.getConstant("CellReference"),expanded:l,nodeChild:L},{nodeId:"02",nodeText:n.getConstant("DefinedNames"),expanded:e,nodeChild:P}],U=new i.TreeView({fields:{dataSource:H,id:"nodeId",text:"nodeText",child:"nodeChild"}}),V=this.parent.createElement("div",{className:"e-cont"}),z=this.parent.createElement("div",{className:"e-header"});z.innerText=n.getConstant("CellReference");var j=this.parent.createElement("input",{className:"e-input e-text e-hyp-text",attrs:{type:"Text"}});j.setAttribute("value","A1"),this.inputElements.push(j),V.appendChild(j),V.insertBefore(z,j);var _=this.parent.createElement("div",{className:"e-cont"}),q=this.parent.createElement("div",{className:"e-header"});q.innerText=n.getConstant("DisplayText");var W=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"Text"}});this.inputElements.push(W),u||(W.classList.add("e-disabled"),W.setAttribute("readonly","true"),W.setAttribute("disabled","true")),p&&t.isNullOrUndefined(p.hyperlink)&&W.setAttribute("value",this.parent.getDisplayText(p)),W.setAttribute("placeholder",n.getConstant("EnterTheTextToDisplay")),_.appendChild(W),_.insertBefore(q,W);var G=this.parent.createElement("div",{className:"e-cont"}),Y=this.parent.createElement("div",{className:"e-header"});Y.innerText=n.getConstant("Sheet");var X=this.parent.createElement("div",{className:"e-refcont"});return this.divElements.push(F),this.divElements.push(A),this.divElements.push(k),this.divElements.push(O),this.divElements.push(V),this.divElements.push(z),this.divElements.push(_),this.divElements.push(q),this.divElements.push(G),this.divElements.push(Y),this.divElements.push(X),this.divElements.push(R),this.divElements.push(E),this.divElements.push(I),G.appendChild(X),G.insertBefore(Y,X),R.appendChild(V),R.insertBefore(_,V),U.appendTo(X),R.appendChild(G),I},e.prototype.removeHyperlink=function(e){var t=He(e.rowIdx,e.colIdx,e.sheet);t&&t.hyperlink&&("string"==typeof t.hyperlink?t.value=t.value||0===t.value?t.value:t.hyperlink:t.value=t.value||0===t.value?t.value:t.hyperlink.address,delete t.hyperlink,t.style&&(delete t.style.textDecoration,delete t.style.color),t.validation&&t.validation.isHighlighted&&t.style.backgroundColor&&(t.style.color="#ff0000"),e.sheet===this.parent.getActiveSheet()&&(t.style&&this.parent.notify(Sn,null),e.preventRefresh||this.parent.serviceLocator.getService("cell").refresh(e.rowIdx,e.colIdx,!1,null,!0,!1,re(this.parent))))},e.prototype.removeHyperlinkHandler=function(e){var t,r,n=e.range,i=this.parent.getActiveSheet();if(!e.preventEventTrigger){var a={address:-1===n.indexOf("!")?i.name+"!"+n:n,cancel:!1};if(this.parent.notify(qr,{action:"removeHyperlink",eventArgs:a}),a.cancel)return}if(n&&-1!==n.indexOf("!")){var o=n.lastIndexOf("!");t=n.substring(0,o);for(var s=this.parent.sheets,l=0;l<s.length;l++)s[l].name===t&&(r=l);i=this.parent.sheets[r],n=n.substring(o+1)}for(var d,h,p=c(n?n:i.activeCell),u=p[0];u<=p[2];u++)for(var f=p[1];f<=p[3];f++)if(i&&i.rows[u]&&i.rows[u].cells[f]){if(h=[],d=this.parent.getCell(u,f))for(g=0;g<d.classList.length;g++)h.push(d.classList[g]);this.parent.notify("deleteHyperlink",{sheet:i,rowIdx:u,colIdx:f});for(var g=0;g<h.length;g++)d.classList.contains(h[g])||d.classList.add(h[g])}e.preventEventTrigger||this.parent.notify(ci,{action:"removeHyperlink",eventArgs:{address:-1===n.indexOf("!")?i.name+"!"+n:n}})},e}(),no=function(){return(no=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}).apply(this,arguments)},io=function(){function e(e){this.undoCollection=[],this.redoCollection=[],this.isUndo=!1,this.undoRedoStep=100,this.parent=e,this.addEventListener()}return e.prototype.setActionData=function(e){var t,r=this.parent.getActiveSheet(),n=[],i=[],a=e.args,o=a.eventArgs,s={};switch(a.action){case"format":t=c(a.eventArgs.range);break;case"clipboard":s=o.copiedInfo,t=c(C(o.pastedRange)),s&&s.isCut&&(i=this.getCellDetails(s.range,Ae(this.parent,we(this.parent,s.sId)),"clipboard"));break;case"beforeSort":(t=c(a.eventArgs.range))[0]===t[2]&&t[2]-t[0]==0&&(t[0]=0,t[1]=0,t[2]=r.usedRange.rowIndex,t[3]=r.usedRange.colIndex);break;case"beforeCellSave":case"cellDelete":case"cellSave":case"addNote":case"editNote":case"deleteNote":t=c(o.address);break;case"beforeWrap":case"beforeReplace":case"chartDesign":t=this.parent.getAddressInfo(o.address).indices;break;case"beforeClear":case"beforeInsertImage":t=c(o.range);break;case"deleteImage":t=c(o.address);break;case"beforeInsertChart":case"filter":t=c(o.range);break;case"autofill":t=c(o.fillRange);break;case"validation":mr(o.range.substring(o.range.lastIndexOf("!")+1))?(t=c(o.range))[2]=r.usedRange.rowIndex:t=c(o.range);break;case"removeValidation":if(o.isColSelected){this.beforeActionData={cellDetails:[]};for(var l=o.range.substring(o.range.lastIndexOf("!")+1).split(":"),d=f(l[0]),h=f(l[1]);d<=h;d++)r.columns[d]&&r.columns[d].validation&&this.beforeActionData.cellDetails.push({colIndex:d,validation:r.columns[d].validation})}else t=c(o.range);break;case"hyperlink":case"removeHyperlink":t=c(o.address)}"beforeSort"===a.action?(this.beforeActionData={cellDetails:o.cellDetails},this.beforeActionData.sortedCellDetails=o.sortedCellDetails):t&&(n=a.isClearAction&&this.beforeActionData.cellDetails.length>0?this.beforeActionData.cellDetails:this.getCellDetails(t,r,a.action),this.beforeActionData={cellDetails:n,cutCellDetails:i})},e.prototype.getBeforeActionData=function(e){e.beforeDetails=this.beforeActionData},e.prototype.performUndoRedo=function(e){var r;e.isFromUpdateAction?r=e:(r=e.isUndo?this.undoCollection.pop():this.redoCollection.pop(),e.setCollection&&(e.undoArgs=r)),this.isUndo=e.isUndo;var n;if(r){var i,a=void 0,o=r.action,s={},l=[];if("autofill"===r.action||"autofillWithCF"===r.action?l=r.eventArgs.fillRange.split("!"):"cellSave"===r.action||"cellDelete"===r.action?l=r.eventArgs.address.split("!"):"clipboard"===r.action&&(l=r.eventArgs.pastedRange.split("!")),l.length>0?i=Ae(this.parent,Se(this.parent,l[0])):"clear"===r.action&&(i=Ae(this.parent,r.eventArgs.sheetIndex)),"autofillWithCF"===r.action){r.action="autofill";var d=i.conditionalFormats;"autofillWithCF"===d[d.length-1].action&&e.isUndo&&(d[d.length-1].value?d.pop():this.parent.notify(bn,{range:d[d.length-1].range,isAction:!0}))}if(!e.isPublic){var h=r.eventArgs.beforeActionData;if(delete r.eventArgs.beforeActionData,a={action:r.action,eventArgs:{}},t.extend(a.eventArgs,r.eventArgs,null,!0),"Manual"===this.parent.calculationMode&&("clipboard"===r.action||"cellDelete"===r.action||"autofill"===r.action||"clear"===r.action))if(e.isUndo){if("paste"===r.eventArgs.requestType&&"clipboard"===r.action||r.eventArgs.fillType){var p=void 0;if(h.cutCellDetails.length?i.isSheetCalculated&&(p="Cut"):p=r.eventArgs.fillType?"autofill":"Copy",p)for(var c=0,u=h.cellDetails,f=h.cutCellDetails;c<u.length;c++){var g=He(u[c].rowIndex,u[c].colIndex,i,!1,!0);g=g?g.value:"","Copy"===p?u[c].copyCellValue=g:"autofill"===p?u[c].value!==g&&u[c].autoFillText!==g&&(u[c].autoFillText=g):"Cut"===p&&f[c].value!==g&&(f[c].value=g)}}}else i.isSheetCalculated&&(h.cutCellDetails.length?h.cutCellDetails:h.cellDetails).forEach(function(e){var t=He(e.rowIndex,e.colIndex,i,!1,!0).value;!t&&0!==t||e.value===t||(e.value=t)});if(r.eventArgs.beforeActionData=h,a.eventArgs.cancel=!1,r.preventAction=a.preventAction=!0,e.isUndo){if(a.isUndo=!0,"cellSave"===r.action&&"Manual"===this.parent.calculationMode&&i.isSheetCalculated&&1===h.cellDetails.length){var m=He(h.cellDetails[0].rowIndex,h.cellDetails[0].colIndex,i);m&&r.eventArgs.displayText!==m.value&&(r.eventArgs.displayText=m.value)}}else a.isRedo=!0;if(e.isFromUpdateAction||this.parent.notify(qr,a),a.eventArgs.cancel)return void this.updateUndoRedoIcons();delete a.eventArgs.cancel}switch(r.action){case"cellSave":case"format":case"wrap":case"cellDelete":case"autofill":case"removeValidation":case"hyperlink":case"addNote":case"editNote":case"deleteNote":case"removeHyperlink":(r=this.performOperation(r,e.preventEvt,e.preventReSelect,e.isFromAutoFillOption)).action=o;break;case"sorting":this.undoForSorting(r,e.isUndo);break;case"clipboard":r=this.undoForClipboard(r,e.isUndo,a),n=!0;break;case"resize":case"resizeToFit":if(r=this.undoForResize(r),e.isUndo){var v=r.eventArgs;if(!v.isPrevCustomHeight){var y=this.parent.sheets[v.sheetIndex],C=y&&Qe(y,v.index);C&&C.customHeight&&delete C.customHeight}}break;case"hideShow":Yt(r,this.parent,!e.isUndo);break;case"replace":r=this.performOperation(r);break;case"replaceAll":r.eventArgs.isAction=!1,e.isUndo&&(s.value=r.eventArgs.replaceValue,s.replaceValue=r.eventArgs.value,s.skipFormatCheck=re(this.parent)),this.parent.notify(pn,no({},r.eventArgs,s));break;case"insert":case"filter":Yt(r,this.parent,!e.isUndo,null,a),n="filter"===r.action;break;case"delete":Yt(r,this.parent,!e.isUndo);break;case"validation":Yt(r,this.parent,!e.isUndo),r=this.performOperation(r);break;case"addHighlight":case"removeHighlight":Yt(r,this.parent,!e.isUndo);break;case"merge":r.eventArgs.merge=r.isFromUpdateAction?r.eventArgs.merge:!r.eventArgs.merge,Yt(r,this.parent,!e.isUndo);break;case"clear":r=this.performOperation(r),e.isUndo&&r.eventArgs.cfClearActionArgs&&Yt({action:"clearCF",eventArgs:r.eventArgs.cfClearActionArgs},this.parent,!e.isUndo);for(c=this.undoCollection.length;c>0&&this.undoCollection[c-1].isClearAction;c--)this.performUndoRedo(e);break;case"conditionalFormat":Yt(r,this.parent,!e.isUndo,this.undoCollection);break;case"clearCF":Yt(r,this.parent,!e.isUndo);break;case"insertImage":case"deleteImage":case"imageRefresh":Yt(r,this.parent,!e.isUndo);break;case"insertChart":case"deleteChart":case"chartRefresh":Yt(r,this.parent,!e.isUndo);break;case"chartDesign":r.eventArgs.isUndo=e.isUndo,this.parent.notify("undoRedoForChartDesign",r.eventArgs);break;case"addDefinedName":Yt(r,this.parent,!e.isUndo)}e.isFromUpdateAction||(e.isUndo?this.redoCollection.push(r):this.undoCollection.push(r),this.undoCollection.length>this.undoRedoStep&&this.undoCollection.splice(0,1),this.redoCollection.length>this.undoRedoStep&&this.redoCollection.splice(0,1),this.updateUndoRedoIcons(),e.isPublic||n||this.parent.notify(ci,t.extend({isUndoRedo:!0,isUndo:e.isUndo},r))),this.parent.notify(Sn,null)}},e.prototype.undoForSorting=function(e,r){var n=this,i=S(this.parent,e.eventArgs.range),a=c(e.eventArgs.range),o=function(e,r){if(i===n.parent.activeSheetIndex){var o=n.parent.getCell(a[0]-1,n.parent.sortCollection[e].columnIndex);if(o&&(o=t.select(".e-filter-icon",o))){var s="e-sort"+("Ascending"===n.parent.sortCollection[e].order?"asc":"desc")+"-filter";r?o.classList.add(s):o.classList.remove(s)}}};if(r){if(this.parent.notify("updateSortedDataOnCell",{result:e.eventArgs.beforeActionData.cellDetails,range:a,sheet:Ae(this.parent,i),jsonData:e.eventArgs.beforeActionData.sortedCellDetails,isUndo:!0}),this.parent.notify("sortComplete",{range:e.eventArgs.range}),this.parent.sortCollection&&e.eventArgs.previousSort)for(h=this.parent.sortCollection.length-1;h>=0;h--)if(this.parent.sortCollection[h].sheetIndex===i){o(h,!1),this.parent.sortCollection.splice(h,1);var s=e.eventArgs.previousSort;if(Array.isArray(s))for(var l=0;l<s.length;l++)this.parent.sortCollection.splice(l,0,s[l]),o(l,!0);this.parent.sortCollection.length||(this.parent.sortCollection=void 0);break}}else if(Yt(e,this.parent,!0),e.eventArgs.previousSort){var d=0;if(this.parent.sortCollection)for(var h=this.parent.sortCollection.length-1;h>=0;h--)this.parent.sortCollection[h].sheetIndex===i&&(o(h,!1),d=h,this.parent.sortCollection.splice(h,1));else this.parent.sortCollection=[];this.parent.sortCollection.splice(d,0,{sortRange:e.eventArgs.range.substring(e.eventArgs.range.lastIndexOf("!")+1),sheetIndex:i,columnIndex:f(e.eventArgs.sortOptions.sortDescriptors.field),order:e.eventArgs.sortOptions.sortDescriptors.order}),o(d,!0)}},e.prototype.updateUndoRedoCollection=function(e){var t=["clipboard","format","sorting","cellSave","resize","resizeToFit","wrap","hideShow","replace","validation","merge","clear","conditionalFormat","clearCF","insertImage","imageRefresh","insertChart","deleteChart","chartRefresh","filter","cellDelete","autofill","autofillWithCF","addDefinedName","removeValidation","removeHighlight","addHighlight","hyperlink","removeHyperlink","deleteImage","chartDesign","replaceAll","addNote","editNote","deleteNote"];"insert"!==e.args.action&&"delete"!==e.args.action||"Sheet"===e.args.eventArgs.modelType||t.push(e.args.action);var r=e.args.action;if(-1!==t.indexOf(r)||e.isPublic){var n=e.args.eventArgs;if("clipboard"===r||"sorting"===r||"format"===r||"cellSave"===r||"wrap"===r||"replace"===r||"validation"===r||"clear"===r||"conditionalFormat"===r||"clearCF"===r||"insertImage"===r||"imageRefresh"===r||"insertChart"===r||"chartRefresh"===r||"filter"===r||"cellDelete"===r||"autofill"===r||"autofillWithCF"===r||"removeValidation"===r||"addDefinedName"===r||"hyperlink"===r||"removeHyperlink"===r||"deleteImage"===r||"chartDesign"===r||"addNote"===r||"editNote"===r||"deleteNote"===r){var i={beforeDetails:{cellDetails:[]}};this.parent.notify("getBeforeActionData",i),n.beforeActionData=i.beforeDetails}if("clipboard"===r&&n.copiedInfo&&n.copiedInfo.isExternal){var a=this.parent.getAddressInfo(n.pastedRange);n.copiedInfo.cellDetails=this.getCellDetails(a.indices,Ae(this.parent,a.sheetIndex),r)}this.redoCollection.length>0&&"autofillWithCF"===this.redoCollection[this.redoCollection.length-1].action&&"autofill"===e.args.action&&(e.args.action="autofillWithCF"),this.undoCollection.push(e.args),this.redoCollection=[],this.undoCollection.length>this.undoRedoStep&&this.undoCollection.splice(0,1),this.updateUndoRedoIcons()}},e.prototype.clearUndoRedoCollection=function(){this.undoCollection=[],this.redoCollection=[],this.updateUndoRedoIcons()},e.prototype.updateUndoRedoIcons=function(){var e=this.parent.serviceLocator.getService(Na);this.parent.notify("enableToolbarItems",[{tab:e.getConstant("Home"),items:[this.parent.element.id+"_undo"],enable:this.undoCollection.length>0}]),this.parent.notify("enableToolbarItems",[{tab:e.getConstant("Home"),items:[this.parent.element.id+"_redo"],enable:this.redoCollection.length>0}])},e.prototype.updateUndoRedoSheetReferences=function(e){var t=function(t){t.forEach(function(t){var r=t.eventArgs;r&&["address","dataRange","fillRange"].forEach(function(t){r[t]&&r[t].includes(e.pName)&&(r[t]=r[t].replace(e.pName,e.value))})})};t(this.undoCollection),t(this.redoCollection)},e.prototype.undoForClipboard=function(e,t,r){var n=this,i=e.eventArgs,a=[];a[0]=i.pastedRange.substring(0,i.pastedRange.lastIndexOf("!")),a[1]=i.pastedRange.substring(i.pastedRange.lastIndexOf("!")+1);var o,s=c(a[1]),l=Se(this.parent,a[0]),d=Ae(this.parent,l),h=i.copiedInfo,p=i.beforeActionData,u=e.isFromUpdateAction,f=l===this.parent.activeSheetIndex;if(r&&(r.isUndoRedo=!0,r.eventArgs.beforeActionData=p),"imagePaste"===e.eventArgs.requestType){var g=i.copiedShapeInfo;t?(o=g.pictureElem,g.isCut?(this.parent.notify(Fi,{id:o.id,sheetIdx:i.pasteSheetIndex+1,isUndoRedo:!0}),this.parent.notify(Ni,{options:{src:o.style.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi,"$2"),height:g.height,width:g.width,id:o.id},range:g.copiedRange,isPublic:!1,isUndoRedo:!0})):this.parent.notify(Fi,{id:i.pastedPictureElement.id,sheetIdx:i.pasteSheetIndex+1,isUndoRedo:!0})):g.isCut?(o=g.pictureElem,this.parent.notify(Fi,{id:o.id,sheetIdx:g.sId,isUndoRedo:!0}),this.parent.notify(Ni,{options:{src:o.style.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi,"$2"),height:g.height,width:g.width,id:o.id},range:g.pastedRange,isPublic:!1,isUndoRedo:!0})):(o=i.pastedPictureElement,this.parent.notify(Ni,{options:{src:o.style.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi,"$2"),height:o.offsetHeight,width:o.offsetWidth,id:o.id},range:g.pastedRange,isPublic:!1,isUndoRedo:!0}))}else{if(t){if(h.isCut){var m=p.cutCellDetails;this.updateCellDetails(m,Ae(this.parent,we(this.parent,h.sId)),w(h.range),f,e),i.cfClearActionArgs&&Yt({action:"clearCF",eventArgs:i.cfClearActionArgs},this.parent,!1)}p&&this.updateCellDetails(p.cellDetails,d,s,f,e,null,null,r?r.isUndoRedo:null),i.cfActionArgs&&i.cfActionArgs.cfModel.forEach(function(e){Yt({eventArgs:{range:e.range,type:e.type,cFColor:e.cFColor,value:e.value,sheetIdx:i.cfActionArgs.sheetIdx,cancel:!0},action:"conditionalFormat"},n.parent,!1)}),ir(d,s[0],s[1],nt(d,s[0]));var v=ar(d,s[0]);Kt(this.parent,d,v,s[0]),i.mergeCollection.forEach(function(e){e.merge=!e.merge,n.parent.notify(gn,e),e.merge=!e.merge}),r&&!u&&this.parent.notify(ci,r)}else if(h.isExternal){b=this.parent.getAddressInfo(i.pastedRange);this.updateCellDetails(h.cellDetails,Ae(this.parent,b.sheetIndex),b.indices,!0,e,null,null,r?r.isUndoRedo:null),r&&!u&&this.parent.notify(ci,r)}else{var C=new Promise(function(e){e(void 0)}),b=this.parent.getAddressInfo(i.copiedRange);this.parent.notify(i.copiedInfo.isCut?Qn:ei,{range:b.indices,sId:Ae(this.parent,b.sheetIndex).id,promise:C,invokeCopy:!0,isPublic:!0,isFromUpdateAction:u}),C.then(function(){n.parent.notify(ti,{range:a?y(i.pastedRange):a,sIdx:a?Se(n.parent,Ie(i.pastedRange)):a,type:i.type,isAction:!1,isInternal:!0,isFromUpdateAction:u,beforeActionData:i.beforeActionData,isUndo:t}),r&&!u&&n.parent.notify(ci,r)})}f&&!u?(this.parent.notify("selectRange",{address:i.selectedRange}),this.parent.notify("positionAutoFillElement",{})):this.checkRefreshNeeded(l,u)}return e},e.prototype.undoForResize=function(e){var t=e.eventArgs;if(void 0===t.hide)if(t.isCol){r=t.oldWidth;t.oldWidth=t.width,t.width=r}else{var r=t.oldHeight;t.oldHeight=t.height,t.height=r}else t.hide=!t.hide;Yt(e,this.parent,!1);var n=this.parent.getActiveSheet(),i=c(n.activeCell),a=He(i[0],i[1],n);if(a&&a.rowSpan){o=this.parent.getCell(i[0],i[1]);this.parent.element.querySelector(".e-active-cell").style.height=o.offsetHeight+"px"}else if(a&&a.colSpan){var o=this.parent.getCell(i[0],i[1]);this.parent.element.querySelector(".e-active-cell").style.width=o.offsetWidth+"px"}return e},e.prototype.performOperation=function(e,r,n,i){var a=e.eventArgs,o=[],s="cellSave"===e.action||"wrap"===e.action||"replace"===e.action||"cellDelete"===e.action||"hyperlink"===e.action||"addNote"===e.action||"editNote"===e.action||"deleteNote"===e.action||"removeHyperlink"===e.action?a.address:a.range;"autofill"===e.action?(o[0]=a.fillRange.substring(0,a.fillRange.lastIndexOf("!")),o[1]=a.fillRange.substring(a.fillRange.lastIndexOf("!")+1)):(o[0]=s.substring(0,s.lastIndexOf("!")),o[1]=s.substring(s.lastIndexOf("!")+1));var l,d=Se(this.parent,o[0]),h=Ae(this.parent,d);if(a.isColSelected){var p=o[1].split(":");l=[0,f(p[0]),h.rowCount-1,f(p[1])]}else l=w(c(o[1]));var u=l,v=a.beforeActionData,y=e.isFromUpdateAction,C=this.checkRefreshNeeded(d,y),b={cellIdx:[l[0],l[1]],isUnique:!1,uniqueRange:""};if(a.isColSelected||this.parent.notify(en,b),this.isUndo){if(b.isUnique&&a.formula&&a.formula.indexOf("UNIQUE")>-1&&"#SPILL!"!==He((x=c(b.uniqueRange))[0],x[1],this.parent.getActiveSheet()).value)for(N=x[0];N<=x[2];N++)for(B=x[1];B<=x[3];B++)N===x[0]&&B===x[1]&&(B+=1),this.parent.updateCellInfo({value:""},m([N,B]),!0);if(this.updateCellDetails(v.cellDetails,h,l,C,e,r,a.isColSelected,!0,i),b.isUnique&&"cellDelete"===e.action&&a.isSpill){for(var x=c(b.uniqueRange),S=He(x[0],x[1],this.parent.getActiveSheet()),I=x[0];I<=x[2];I++)for(N=x[1];N<=x[3];N++)for(B=l[0];B<=l[2];B++)for(var E=l[1];E<=l[3];E++)I===B&&N===E||this.parent.updateCellInfo({value:""},g(I,N),!0);S.value="#SPILL!",this.parent.updateCellInfo(S,g(x[0],x[1]),!0)}if(!a.isSpill&&""!==b.uniqueRange){for(var R=c(b.uniqueRange),N=R[0];N<=R[2];N++)for(B=R[1];B<=R[3];B++)N===R[0]&&B===R[1]&&(B+=1),this.parent.updateCellInfo({value:""},m([N,B]),!0);this.parent.notify("reApplyFormula",null)}}else{var F=e.eventArgs,A=c(h.activeCell),k=o[1]?o[1].split(":"):[];u[0]!==A[0]&&u[1]!==A[1]&&"hyperlink"===e.action&&k.length>0&&(h.activeCell=k[0],A=c(h.activeCell));var O=this.parent.getCellStyleValue(["textDecoration"],A).textDecoration;if(F&&F.style&&F.style.textDecoration){var T=F.style.textDecoration,D=T,L=void 0,P=!1;"underline"===O?D="underline"===T?"none":"underline line-through":"line-through"===O?D="line-through"===T?"none":"underline line-through":"underline line-through"===O&&(D="underline"===T?"line-through":"underline",P=!0),"none"===D&&(P=!0),F.style.textDecoration=D,e.eventArgs=F;for(I=u[0];I<=u[2];I++)for(N=u[1];N<=u[3];N++){if(L={},"none"===(O=this.parent.getCellStyleValue(["textDecoration"],[I,N]).textDecoration)){if(P)continue;L.textDecoration=T}else if("underline"===O||"line-through"===O)if(P){if(T!==O)continue;L.textDecoration="none"}else L.textDecoration=T!==O?"underline line-through":T;else if("underline line-through"===O){if(!P)continue;L.textDecoration="underline"===T?"line-through":"underline"}this.parent.notify(Yr,{style:{textDecoration:L.textDecoration},range:[I,N,I,N],refreshRibbon:!0,onActionUpdate:!0})}F.style.textDecoration=T,e.eventArgs=F}else{if(!t.isNullOrUndefined(a.oldValue)&&a.oldValue!==a.value&&b.isUnique){var M=c(b.uniqueRange);if("#SPILL!"!==He(M[0],M[1],this.parent.getActiveSheet()).value)for(N=M[0];N<=M[2];N++)for(var B=M[1];B<=M[3];B++)N===M[0]&&B===M[1]&&(this.parent.updateCellInfo({value:"#SPILL!"},m([M[0],M[1]]),!0),B+=1),this.parent.updateCellInfo({value:""},m([N,B]),!0)}if(Yt(e,this.parent,!0),b.isUnique&&"cellDelete"===e.action&&a.isSpill){for(var H=c(b.uniqueRange),U=!1,I=H[0];I<=H[1];I++)for(N=H[1];N<=H[3];N++)I===H[0]&&N===H[1]&&N++,He(I,N,h)&&!t.isNullOrUndefined(He(I,N,h).value)&&""!==He(I,N,h).value&&(U=!0);U||((S=He(H[0],H[1],this.parent.getActiveSheet())).value="",this.parent.updateCellInfo(S,g(H[0],H[1]),!0),this.parent.notify("reApplyFormula",null))}}}return"autofill"===e.action&&(o[1]=this.isUndo?e.eventArgs.dataRange:e.eventArgs.selectedRange),!C||n||y||(a.isColSelected&&(o[1]=h.selectedRange),this.parent.notify("selectRange",{address:o[1]})),this.parent.showAggregate&&this.parent.notify("showAggregate",{}),e},e.prototype.getCellDetails=function(e,r,n){var i,a=this,o=[],s="cellDelete"===n,l={};e=w(e);var d=function(e,n){var s={rowIndex:e,colIndex:n,value:i?i.value:"",formula:i?i.formula:""},l=nt(r,e);if(i){i.format&&(s.format=i.format),t.isNullOrUndefined(i.isLocked)||(s.isLocked=i.isLocked),i.style&&(s.style=Object.assign({},i.style)),i.wrap&&(s.wrap=i.wrap),i.rowSpan&&(s.rowSpan=i.rowSpan),i.colSpan&&(s.colSpan=i.colSpan),i.image&&(s.image=i.image),i.chart&&(s.chart=JSON.parse(JSON.stringify(i.chart))),i.validation&&(s.validation=Object.assign({},i.validation)),i.notes&&(s.notes=i.notes),i.isReadOnly&&(s.isReadOnly=i.isReadOnly),i.formattedText&&(s.formattedText=i.formattedText),i.hyperlink&&(s.hyperlink=t.isObject(i.hyperlink)?t.extend({},i.hyperlink):i.hyperlink),(r.standardHeight?l!==r.standardHeight:20!==l)&&(i.rowHeight=s.rowHeight=l);var d=a.parent.editModule;s.value=i&&d&&i.formula===d.editCellData.value&&!t.isNullOrUndefined(d.editCellData.prevFormulaValue)?d.editCellData.prevFormulaValue:s.value}o.push(s)};if("validation"===n||"removeValidation"===n)for(var h=e[1];h<=e[3];h++)for(var p=ot(r,h),c=e[0];c<=e[2];c++)!l[h]&&pt(p,c,h)&&(o.push({colIndex:h,validation:Object.assign({},p.validation)}),l[h]=!0),(i=He(c,h,r))&&!i.validation||d(c,h);else for(var u=e[0];u<=e[2];u++)if(!s||!rt(r,u))for(var f=e[1];f<=e[3];f++)i=He(u,f,r),d(u,f);return o},e.prototype.updateCellDetails=function(e,r,n,i,a,o,s,l,d){var h,p,c,u,f,v,y,C=this,b=e.length,x=a&&!o&&("cellSave"===a.action||"cellDelete"===a.action||"autofill"===a.action||"clipboard"===a.action),S=a&&!a.eventArgs.cfClearActionArgs&&r.conditionalFormats&&r.conditionalFormats.length&&[].slice.call(r.conditionalFormats),w=[];"cellDelete"===a.action&&(v=!1,y=n);for(var I=this,E=0;E<b;E++)!function(n){if(s||t.isUndefined(e[n].rowIndex))return st(r,e[n].colIndex,{validation:e[n].validation}),"continue";(p=He(e[n].rowIndex,e[n].colIndex,r,!1,!0)).style&&a&&("format"===a.action||"clipboard"===a.action)&&(!p.style.borderTop||e[n].style&&e[n].style.borderTop||I.parent.setBorder({borderTop:""},r.name+"!"+g(e[n].rowIndex,e[n].colIndex),null,l),!p.style.borderLeft||e[n].style&&e[n].style.borderLeft||I.parent.setBorder({borderLeft:""},r.name+"!"+g(e[n].rowIndex,e[n].colIndex),null,l),!p.style.borderRight||e[n].style&&e[n].style.borderRight||I.parent.setBorder({borderRight:""},r.name+"!"+g(e[n].rowIndex,e[n].colIndex),null,l),!p.style.fontSize||e[n].style&&e[n].style.fontSize||(p.style.fontSize="11pt",c=!0,I.parent.notify(Xr,{style:{fontSize:"11pt"},rowIdx:e[n].rowIndex,colIdx:e[n].colIndex,lastCell:!0,isHeightCheckNeeded:!0,manualUpdate:!0,onActionUpdate:!0})),!p.style.fontFamily||e[n].style&&e[n].style.fontFamily||(c=!0,p.style.fontFamily="Calibri",I.parent.notify(Xr,{style:{fontFamily:"Calibri"},rowIdx:e[n].rowIndex,colIdx:e[n].colIndex,lastCell:!0,isHeightCheckNeeded:!0,manualUpdate:!0,onActionUpdate:!0}))),p.image&&a&&"clipboard"===a.action&&p.image.forEach(function(t){C.parent.notify(Fi,{id:t.id,sheet:r,preventEventTrigger:!0,rowIdx:e[n].rowIndex,colIdx:e[n].colIndex})});var i={value:e[n].formula&&e[n].formula.toUpperCase().includes("UNIQUE")?null:e[n].value,formula:e[n].formula};if(e[n].format&&(i.format=e[n].format),t.isNullOrUndefined(e[n].isLocked)||(i.isLocked=p.isLocked?p.isLocked:e[n].isLocked),e[n].style&&(i.style=Object.assign({},e[n].style)),e[n].wrap&&(i.wrap=e[n].wrap),e[n].rowSpan&&(i.rowSpan=e[n].rowSpan),e[n].colSpan&&(i.colSpan=e[n].colSpan),e[n].hyperlink&&(i.hyperlink=e[n].hyperlink),e[n].image&&(i.image=e[n].image),e[n].notes&&(i.notes=e[n].notes),e[n].isReadOnly&&(i.isReadOnly=e[n].isReadOnly),e[n].formattedText&&(i.formattedText=e[n].formattedText),Ue(e[n].rowIndex,e[n].colIndex,r,i),f={action:"updateCellValue",address:[e[n].rowIndex,e[n].colIndex,e[n].rowIndex,e[n].colIndex],notes:e[n].notes,value:e[n].formula?e[n].formula:e[n].value,sheetIndex:Se(I.parent,r.name),skipFormatCheck:re(I.parent),isDelete:v,deletedRange:y,actionName:a.action},I.parent.notify($r,f),S&&!u&&(u=f.isFormulaDependent),a&&"format"===a.action&&"NumberFormat"===a.eventArgs.requestType&&i.wrap&&i.format!==p.format&&!Qe(r,e[n].rowIndex).customHeight?I.parent.notify(an,{range:[e[n].rowIndex,e[n].colIndex,e[n].rowIndex,e[n].colIndex],wrap:!0,sheet:r,initial:!0,isOtherAction:!0}):(a&&"wrap"===a.action&&a.eventArgs.wrap||p.wrap&&!e[n].wrap)&&I.parent.notify(an,{range:[e[n].rowIndex,e[n].colIndex,e[n].rowIndex,e[n].colIndex],wrap:!1,sheet:r,initial:!0}),a&&e[n].hyperlink&&"clear"===a.action){var o=r.name+"!"+m([e[n].rowIndex,e[n].colIndex,e[n].rowIndex,e[n].colIndex]);h=I.parent.getCell(e[n].rowIndex,e[n].colIndex),"Clear All"===a.eventArgs.type||"Clear Hyperlinks"===a.eventArgs.type?I.parent.addHyperlink(e[n].hyperlink,o,e[n].value):"Clear Formats"===a.eventArgs.type&&h&&t.addClass(h.querySelectorAll(".e-hyperlink"),"e-hyperlink-style")}e[n].validation&&I.parent.notify(ln,{rules:e[n].validation,range:r.name+"!"+g(e[n].rowIndex,e[n].colIndex)}),x&&e[n].value!==p.value&&I.parent.trigger("cellSave",{element:null,value:e[n].value,oldValue:p.value,formula:e[n].formula,cancel:!1,address:r.name+"!"+g(e[n].rowIndex,e[n].colIndex),displayText:I.parent.getDisplayText(e[n])}),S&&!u&&Z(S,w,e[n].rowIndex,e[n].colIndex)}(E);if(i){if(n[0]===n[2]&&n[1]===n[3]){var R=He(n[0],n[1],r);R.rowSpan>1&&(n[2]=n[0]+R.rowSpan-1),R.colSpan>1&&(n[3]=n[1]+R.colSpan-1)}var N=!1;"autofill"===a.action||"clipboard"===a.action||"wrap"===a.action?N=!0:"format"===a.action&&"CellFormat"===a.eventArgs.requestType&&(N=_(a.eventArgs.style,!0)),this.parent.serviceLocator.getService("cell").refreshRange(n,!1,!1,!0,!1,re(this.parent),null,d,N,null,null,e),(w.length||u)&&this.parent.notify(Cn,{cfModel:!u&&w,refreshAll:u,isAction:!0}),c&&ft(function(){return C.parent.selectRange(r.selectedRange)})}},e.prototype.checkRefreshNeeded=function(e,t){var r=!0;return e!==this.parent.activeSheetIndex&&(t||(this.parent.activeSheetIndex=e,this.parent.dataBind()),r=!1),r},e.prototype.addEventListener=function(){this.parent.on(hi,this.performUndoRedo,this),this.parent.on("updateUndoRedoCollection",this.updateUndoRedoCollection,this),this.parent.on("setActionData",this.setActionData,this),this.parent.on("getBeforeActionData",this.getBeforeActionData,this),this.parent.on("clearUndoRedoCollection",this.clearUndoRedoCollection,this),this.parent.on("setUndoRedo",this.updateUndoRedoIcons,this),this.parent.on("sheetRenameUpdate",this.updateUndoRedoSheetReferences,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(hi,this.performUndoRedo),this.parent.off("updateUndoRedoCollection",this.updateUndoRedoCollection),this.parent.off("setActionData",this.setActionData),this.parent.off("getBeforeActionData",this.getBeforeActionData),this.parent.off("clearUndoRedoCollection",this.clearUndoRedoCollection),this.parent.off("setUndoRedo",this.updateUndoRedoIcons),this.parent.off("sheetRenameUpdate",this.updateUndoRedoSheetReferences))},e.prototype.destroy=function(){this.removeEventListener(),this.undoCollection.length>0&&(this.undoCollection=[]),this.redoCollection.length>0&&(this.redoCollection=[]),this.beforeActionData&&this.beforeActionData.cellDetails&&(this.beforeActionData.cellDetails=[]),this.parent=null},e.prototype.getModuleName=function(){return"undoredo"},e}(),ao=function(){function e(e){this.parent=e,this.wrapCell=this.parent.createElement("span",{className:"e-wrap-content"}),this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on("ribboClick",this.ribbonClickHandler,this),this.parent.on(an,this.wrapTextHandler,this),this.parent.on(ri,this.rowHeightChangedHandler,this),this.parent.on(ni,this.colWidthChanged,this),this.parent.on("updateWrapCell",this.updateWrapCell,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("ribboClick",this.ribbonClickHandler),this.parent.off(an,this.wrapTextHandler),this.parent.off(ri,this.rowHeightChangedHandler),this.parent.off(ni,this.colWidthChanged),this.parent.off("updateWrapCell",this.updateWrapCell))},e.prototype.wrapTextHandler=function(e){if(e.initial||bt(this.parent,e.range,!0)){if(e.isPublic&&oe(this.parent,e.range))return;e.initial&&!e.td&&!e.outsideViewport&&bt(this.parent,e.range,!0)&&(e.initial=!1);var r=void 0,n=void 0,i=void 0,a=void 0,o=void 0,s=void 0,l=void 0,d=void 0,h=void 0,p=void 0,c=this.parent.frozenRowCount(e.sheet),u=void 0,f=void 0,g=void 0;!t.isNullOrUndefined(e.sheet.standardHeight)&&e.sheet.standardHeight<20?u=!0:f=this.parent.allowFiltering&&this.parent.filterModule.filterRange.has(this.parent.activeSheetIndex)&&this.parent.filterModule.filterRange.get(this.parent.activeSheetIndex).range;for(var m=e.range[0];m<=e.range[2];m++){a=0,s=(l=(h=Qe(e.sheet,m)).customHeight)||e.isCustomHgt,p=!tt(e.sheet,m);for(var v=e.range[1];v<=e.range[3];v++)if(!((n=He(m,v,e.sheet,null,!0)).rowSpan<0||n.colSpan<0)){var y=n.rowSpan>1||n.colSpan>1;if(r=e.initial?e.td:p&&!ht(e.sheet,v)&&this.parent.getCell(m,v),r?(e.wrap?(d=Zt(n.style&&n.style.fontFamily?n.style:this.parent.cellStyle),r.classList.add("e-wraptext")):(r.classList.remove("e-wraptext"),d=null),(s||y||h.height<20||u||f&&m===f[0]&&v>=f[1]&&v<=f[3])&&this.updateWrapCell({rowIdx:m,colIdx:v,sheet:e.sheet,ele:r}),t.Browser.isIE&&r.classList.add("e-ie-wrap")):d=null,!s&&!y){i=rr(e.sheet,m,v,n.colSpan>1?v+n.colSpan-1:v);F=this.parent.getDisplayText(n).toString();if(this.parent.isEdit&&r&&F.indexOf("\n")<0){var C=this.parent.element.querySelector(".e-spreadsheet-edit");C&&C.textContent.indexOf("\n")>-1&&(F=C.textContent)}if(F)if(e.wrap){r&&r.classList.contains("e-alt-unwrap")&&(r.classList.remove("e-alt-unwrap"),F.includes("\n")&&(g=r.querySelector(".e-hyperlink"))&&!g.innerText.includes("\n")&&(g.innerText=F));var b=void 0,x=0,S=void 0;if(F.indexOf("\n")>-1){var w=F.split("\n"),I=w.length;for(S=0;S<I;S++)0===(b=Qt(w[S],i,n.style,this.parent.cellStyle))&&(b=1),x+=b;b=x}else b=Qt(F,i,n.style,this.parent.cellStyle);if(o=nr(this.parent,m,v,e.sheet,n.style||this.parent.cellStyle,b,d),a=Math.max(a,o),n.rowSpan>1){var E=at(e.sheet,m,m+(n.rowSpan-1));if(E>=a)return;o=a=nt(e.sheet,m)+(a-E)}ir(e.sheet,m,v,o)}else{if(r&&(F.indexOf("\n")>-1&&r.classList.add("e-alt-unwrap"),g=r.querySelector(".e-hyperlink"))){var R=g.innerText;R.includes("\n")&&(g.innerText=R.split("\n").join(" "))}o=nr(this.parent,m,v,e.sheet,n.style||this.parent.cellStyle,1,d),ir(e.sheet,m,v,o),a=Math.max(ar(e.sheet,m),20)}else e.wrap&&F||(ir(e.sheet,m,v,20),a=Math.max(ar(e.sheet,m),20));if(v===e.range[3]){var N=nt(e.sheet,m);(e.wrap&&(e.isOtherAction?a>=20:a>20)&&ar(e.sheet,m)<=a||(!e.wrap||!F)&&ar(e.sheet,m)<N&&N>20)&&N!==a&&(r?(Kt(this.parent,e.sheet,a,m,e.row,e.hRow,p),r&&e.sheet.conditionalFormats&&e.sheet.conditionalFormats.length&&this.parent.notify(Cn,{indexes:[m,v],isAction:!0})):Kt(this.parent,e.sheet,a,m,null,null,p,!p||m>this.parent.viewport.bottomIndex||m>=c&&m<this.parent.viewport.topIndex+c))}}if(r){if(s&&!y){var F=this.parent.getDisplayText(n);e.wrap?r.classList.contains("e-alt-unwrap")&&r.classList.remove("e-alt-unwrap"):F.indexOf("\n")>-1&&r.classList.add("e-alt-unwrap")}e.wrap?l?r.style.lineHeight&&(r.style.lineHeight=""):r.style.lineHeight=parseFloat(n.style&&n.style.fontSize||this.parent.cellStyle.fontSize)*d+"pt":r.style.lineHeight=""}}}e.initial||this.parent.notify("positionAutoFillElement",null)}},e.prototype.ribbonClickHandler=function(e){var r=t.closest(e.originalEvent.target,".e-btn");if(r&&r.id===this.parent.element.id+"_wrap"){var n=r.classList.contains("e-active"),i=b(this.parent.getActiveSheet()),a={address:i,wrap:n,cancel:!1};if(oe(this.parent))return void this.parent.notify(yi,null);this.parent.notify(qr,{action:"beforeWrap",eventArgs:a}),a.cancel||(ze(this.parent.getActiveSheet().selectedRange,n,this.parent),this.parent.notify(ci,{action:"wrap",eventArgs:{address:i,wrap:n}}))}},e.prototype.rowHeightChangedHandler=function(e){if(e.isCustomHgt){e.sheet=this.parent.getActiveSheet();for(var t=this.parent.viewport.leftIndex,r=this.parent.viewport.rightIndex;t<=r;t++)He(e.rowIdx,t,e.sheet,!1,!0).wrap&&(e.colIdx=t,e.ele=this.parent.getCell(e.rowIdx,t),this.updateWrapCell(e),e.ele.style.lineHeight&&(e.ele.style.lineHeight=""))}},e.prototype.colWidthChanged=function(e){if(e.checkWrapCell){e.sheet=this.parent.getActiveSheet();for(var t=this.parent.viewport.topIndex,r=this.parent.viewport.bottomIndex;t<=r;t++)He(t,e.colIdx,e.sheet,!1,!0).wrap&&(e.rowIdx=t,e.ele=this.parent.getCell(t,e.colIdx),this.updateWrapCell(e))}},e.prototype.updateWrapCell=function(e){if(e.ele&&!e.ele.querySelector(".e-wrap-content")){for(var r=this.wrapCell.cloneNode(),n=e.ele.querySelector(".e-filter-btn");e.ele.childElementCount&&!t.isNullOrUndefined(e.ele.firstElementChild)&&-1===e.ele.firstElementChild.className.indexOf("e-addNoteIndicator");)r.appendChild(e.ele.firstElementChild);var i=void 0;if(!t.isNullOrUndefined(e.ele.firstElementChild)&&e.ele.firstElementChild.className.indexOf("e-addNoteIndicator")>-1&&(i=e.ele.firstElementChild),n&&(e.ele.firstChild?e.ele.insertBefore(n,e.ele.firstChild):e.ele.appendChild(n)),!He(e.rowIdx,e.colIdx,e.sheet,!1,!0).hyperlink){var a=e.ele.lastChild;a&&3===a.nodeType?(r.appendChild(document.createTextNode(a.textContent)),a.textContent=""):(r.appendChild(document.createTextNode(e.ele.textContent)),e.ele.textContent="")}e.ele.appendChild(r),t.isNullOrUndefined(i)||e.ele.appendChild(i)}},e.prototype.getModuleName=function(){return"wrapText"},e.prototype.destroy=function(){this.removeEventListener(),this.wrapCell&&(this.wrapCell.remove(),this.wrapCell=null),this.parent=null},e}(),oo=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.insert=function(e){var t=e.eventArgs;this.parent.notify("beforeInsert",t);var r=Ae(this.parent,t.activeSheetIndex);switch(t.modelType){case"Sheet":this.parent.notify("insertSheetTab",{startIdx:t.index,endIdx:t.index+(t.model.length-1),preventUpdate:!t.isAction}),this.parent.renderModule.refreshSheet();break;case"Row":if(t.activeSheetIndex===this.parent.activeSheetIndex){l=this.parent.frozenRowCount(r);if(!this.parent.scrollSettings.enableVirtualization||t.index<=this.parent.viewport.bottomIndex)if(t.freezePane)this.parent.renderModule.refreshSheet(!1,!1,!0);else if(this.parent.scrollSettings.enableVirtualization){s=this.parent.frozenColCount(r);if(t.index>=this.parent.viewport.topIndex+l){var n=[],i=void 0;s?(i=u(r.topLeftCell)[1],n.push(l),n.push(this.parent.viewport.leftIndex+s)):i=this.parent.viewport.leftIndex;var a=this.parent.viewport.leftIndex;this.parent.renderModule.refreshUI({rowIndex:this.parent.viewport.topIndex,colIndex:i,refresh:"Row",frozenIndexes:n,skipUpdateOnFirst:this.parent.viewport.topIndex+l===j(r,l,!0)}),s&&(this.parent.viewport.leftIndex=a)}var o=u(r.paneTopLeftCell)[0];t.index<o&&(this.parent.notify("updateScrollValue",{scrollTop:at(r,l,o-1,!0)}),this.parent.goTo(g(t.index,j(r,s,!0,"columns")))),this.parent.selectRange(r.selectedRange)}else this.parent.renderModule.refreshSheet(!1,!1,!0);else!this.parent.scrollSettings.isFinite||this.parent.viewport.topIndex+l!==j(r,0,!0)&&this.parent.viewport.bottomIndex!==j(r,r.rowCount-t.model.length-1,!1)||this.parent.renderModule.refreshSheet(!1,!1,!0)}break;case"Column":if(t.activeSheetIndex===this.parent.activeSheetIndex){var s=this.parent.frozenColCount(r);if(!this.parent.scrollSettings.enableVirtualization||t.index<=this.parent.viewport.rightIndex)if(t.freezePane)this.parent.renderModule.refreshSheet(!1,!1,!0);else if(this.parent.scrollSettings.enableVirtualization){var l=this.parent.frozenRowCount(r);if(t.index>=this.parent.viewport.leftIndex+s){n=[];l&&(n=[l+this.parent.viewport.topIndex,s]);var d=l?u(r.topLeftCell)[0]:this.parent.viewport.topIndex,h=this.parent.viewport.topIndex;this.parent.renderModule.refreshUI({skipUpdateOnFirst:this.parent.viewport.leftIndex+s===j(r,s,!0,"columns"),rowIndex:d,colIndex:this.parent.viewport.leftIndex,refresh:"Column",frozenIndexes:n}),l&&(this.parent.viewport.topIndex=h)}var p=u(r.paneTopLeftCell)[1];t.index<p&&(this.parent.notify("updateScrollValue",{scrollLeft:dt(r,0,p-1,!0)}),this.parent.goTo(g(j(r,l,!0),t.index))),this.parent.selectRange(r.selectedRange)}else this.parent.renderModule.refreshSheet(!1,!1,!0);else!this.parent.scrollSettings.isFinite||this.parent.viewport.leftIndex+s!==j(r,0,!0,"columns")&&this.parent.viewport.rightIndex!==j(r,r.colCount-t.model.length-1,!1,"columns")||this.parent.renderModule.refreshSheet(!1,!1,!0)}}this.refreshImgElement(t.model.length,this.parent.activeSheetIndex,t.modelType,t.index),t.isAction?(delete t.isAction,this.parent.notify(ci,e),or(this.parent.element)):t.isUndoRedo||(t.isMethod=!0,this.parent.notify("triggerDataChange",e))},e.prototype.refreshImgElement=function(e,t,r,n){for(var i,a=this.parent.sheets[t],o=[0,0,a.usedRange.rowIndex,a.usedRange.colIndex],s=0;s<=o[2];s++)for(var l=o[1];l<=o[3];l++)(i=He(s,l,a))&&i.image&&i.image.length>0&&("Row"===r&&s>=n||"Column"===r&&l>=n)&&this.parent.notify("refreshImagePosition",{rowIdx:s,colIdx:l,sheetIdx:t,type:r,count:e,status:"insert"})},e.prototype.addEventListener=function(){this.parent.on("insert",this.insert,this)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off("insert",this.insert)},e.prototype.getModuleName=function(){return"insert"},e}(),so=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.delete=function(e){var t=e.eventArgs;if("Sheet"===t.modelType){var r=t.activeSheetIndex>=t.startIndex&&t.activeSheetIndex<=t.endIndex;r&&this.parent.setProperties({activeSheetIndex:this.parent.skipHiddenSheets(t.startIndex<this.parent.sheets.length?t.startIndex:t.startIndex?t.startIndex-1:0)},!0),t.endIndex<t.activeSheetIndex&&this.parent.setProperties({activeSheetIndex:t.activeSheetIndex-(t.endIndex+1-t.startIndex)},!0),this.parent.notify("refreshSheetTabs",null),r&&this.parent.renderModule.refreshSheet(!1,!1,!0)}else if(t.activeSheetIndex===this.parent.activeSheetIndex){var n=this.parent.getActiveSheet(),i=this.parent.frozenRowCount(n),a=this.parent.frozenColCount(n);if("Row"===t.modelType){if(!this.parent.scrollSettings.enableVirtualization||t.startIndex<=this.parent.viewport.bottomIndex)if(this.parent.scrollSettings.enableVirtualization)if(t.startIndex<u(n.paneTopLeftCell)[0])this.parent.updateTopLeftCell(j(n,t.startIndex-1<i?i:t.startIndex-1,!0)-i,null,"col"),this.parent.renderModule.refreshSheet(!1,!1,!0);else if(t.freezePane||this.parent.scrollSettings.isFinite&&this.parent.viewport.bottomIndex>=j(n,n.rowCount-1,!1))this.parent.renderModule.refreshSheet(!1,!1,!0);else{var o=[],s=this.parent.frozenColCount(n),l=void 0,d=this.parent.viewport.leftIndex;s?(o.push(i),o.push(d+s),l=u(n.topLeftCell)[1]):l=d,this.parent.renderModule.refreshUI({rowIndex:this.parent.viewport.topIndex,refresh:"Row",colIndex:l,skipUpdateOnFirst:this.parent.viewport.topIndex+i===j(n,i,!0),frozenIndexes:o}),s&&(this.parent.viewport.leftIndex=d),this.parent.selectRange(n.selectedRange)}else this.parent.renderModule.refreshSheet(!1,!1,!0)}else{if(!1!==t.refreshSheet&&(!this.parent.scrollSettings.enableVirtualization||t.startIndex<=this.parent.viewport.rightIndex))if(this.parent.scrollSettings.enableVirtualization)if(t.startIndex<u(n.paneTopLeftCell)[1])this.parent.updateTopLeftCell(null,j(n,t.startIndex-1<a?a:t.startIndex-1,!0,"columns")-a,"row"),this.parent.renderModule.refreshSheet(!1,!1,!0);else if(t.freezePane||!0===t.refreshSheet)this.parent.renderModule.refreshSheet(!1,!1,!0);else{var h=this.parent.frozenRowCount(n),o=[],p=this.parent.viewport.topIndex,c=h?u(n.topLeftCell)[0]:p;h&&(o=[h+p,a]),this.parent.renderModule.refreshUI({rowIndex:c,refresh:"Column",colIndex:this.parent.viewport.leftIndex,insertDelete:!0,skipUpdateOnFirst:this.parent.viewport.leftIndex+a===j(n,a,!0,"columns"),frozenIndexes:o}),h&&(this.parent.viewport.topIndex=p),this.parent.selectRange(n.selectedRange)}else this.parent.renderModule.refreshSheet(!1,!1,!0);delete t.refreshSheet}}this.refreshImgElement(t.deletedModel.length,this.parent.activeSheetIndex,t.modelType,t.startIndex),t.isAction?(delete t.isAction,this.parent.notify(ci,e),or(this.parent.element)):t.isUndoRedo||(t.isMethod=!0,this.parent.notify("triggerDataChange",e))},e.prototype.addEventListener=function(){this.parent.on("delete",this.delete,this)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off("delete",this.delete)},e.prototype.getModuleName=function(){return"delete"},e.prototype.refreshImgElement=function(e,t,r,n){for(var i,a=this.parent.sheets[t],o=[0,0,a.usedRange.rowIndex,a.usedRange.colIndex],s=0;s<=o[2];s++)for(var l=o[1];l<=o[3];l++)(i=He(s,l,a))&&i.image&&i.image.length>0&&("Row"===r&&s>=n||"Column"===r&&l>=n)&&this.parent.notify("refreshImagePosition",{rowIdx:s,colIdx:l,sheetIdx:t,type:r,count:e,status:"delete"})},e}(),lo=function(){function e(e){this.divElements=[],this.spanElements=[],this.inputElements=[],this.checkBoxElements=[],this.numericTextBoxElements=[],this.dropDownListElements=[],this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener();var e={};if(!this.parent.isDestroyed&&!this.parent.refreshing){var r=u(this.parent.getActiveSheet().activeCell),n=this.parent.getCell(r[0],r[1]);n&&(e={rowIdx:r[0],colIdx:r[1],td:n,isRefresh:!0})}this.removeListDropdownHandler(this.parent.element.querySelector(".e-validation-list"),e);var i=t.select("#"+this.parent.element.id+"_datavalidation-popup");i&&i.remove(),this.typeData=[],this.operatorData=[],this.dataList&&(this.dataList=null),this.formObj&&(this.formObj.destroy(),this.formObj=null),this.parent=null},e.prototype.addEventListener=function(){t.Browser.isDevice&&"safari"===t.Browser.info.name&&(t.Browser.isIos||t.Browser.isIos7)?t.EventHandler.add(this.parent.element,"touchend",this.listOpen,this):t.EventHandler.add(this.parent.element,"dblclick",this.listOpen,this),this.parent.on("initiatedatavalidation",this.initiateDataValidationHandler,this),this.parent.on(ui,this.invalidDataHandler,this),this.parent.on("isValidation",this.isValidCellHandler,this),this.parent.on("activeCellChanged",this.listHandler,this),this.parent.on(Kn,this.keyUpHandler,this),this.parent.on(Ci,this.removeValidationHandler,this),this.parent.on("updateHighlight",this.updateHighlightHandler,this),this.parent.on(ri,this.listValidationHeightHandler,this),this.parent.on("addListValidationDropdown",this.addListValidationDropdownHandler,this)},e.prototype.removeEventListener=function(){t.Browser.isDevice&&"safari"===t.Browser.info.name&&(t.Browser.isIos||t.Browser.isIos7)?t.EventHandler.remove(this.parent.element,"touchend",this.listOpen):t.EventHandler.remove(this.parent.element,"dblclick",this.listOpen),this.parent.isDestroyed||(this.parent.off("initiatedatavalidation",this.initiateDataValidationHandler),this.parent.off(ui,this.invalidDataHandler),this.parent.off("isValidation",this.isValidCellHandler),this.parent.off("activeCellChanged",this.listHandler),this.parent.off(Kn,this.keyUpHandler),this.parent.off(Ci,this.removeValidationHandler),this.parent.off("updateHighlight",this.updateHighlightHandler),this.parent.off(ri,this.listValidationHeightHandler),this.parent.off("addListValidationDropdown",this.addListValidationDropdownHandler))},e.prototype.removeValidationHandler=function(e){var t,r,n={cancel:!1,isColSelected:e.isCol};if(e.range&&e.range.includes("!")){if(r=e.range,!(t=Ae(this.parent,Se(this.parent,r.substring(0,r.lastIndexOf("!"))))))return}else if(t=this.parent.getActiveSheet(),r=t.name+"!",e.range)r+=e.range;else{var i=this.getRange(t.selectedRange);r+=i.range,n.isColSelected=i.isColSelected}n.range=r,e.isAction&&this.parent.notify(qr,{eventArgs:n,action:"removeValidation"}),n.cancel||(this.parent.notify(ln,{range:r,isRemoveValidation:!0}),e.isAction&&(delete n.cancel,this.parent.notify(ci,{eventArgs:n,action:"removeValidation"})))},e.prototype.updateNoteIndicator=function(e,r,n){var i=e.querySelector(".e-addNoteIndicator");i&&(t.remove(i),this.parent.notify("createNoteIndicator",{targetElement:e,rowIndex:r,columnIndex:n,skipEvent:!0}))},e.prototype.keyUpHandler=function(e){var r=e.target,n=this.parent.element.querySelector(".e-datavalidation-dlg");if(t.closest(r,".e-values")&&n&&13!==e.keyCode){var i=n.querySelector(".e-values"),a=i.querySelector(".e-dlg-error"),o=n.querySelector(".e-footer-content").querySelector(".e-primary");o.hasAttribute("disabled")&&o.removeAttribute("disabled"),a&&i.removeChild(a)}},e.prototype.listOpen=function(e){var t=e.target;this.listObj&&t.classList.contains("e-cell")&&t.querySelector(".e-validation-list")&&this.parent.isEdit&&this.listObj.showPopup()},e.prototype.invalidDataHandler=function(e){var t,r={range:"",cancel:!1},n=e.isRemoveHighlight?"removeHighlight":"addHighlight";!e.isPublic&&(t={eventArgs:r,action:n},this.parent.notify(qr,t),r.cancel)||(this.parent.notify(n,{range:r.range,isAction:!0}),e.isPublic||(t.preventAction=!0,this.parent.notify(ci,t)))},e.prototype.listHandler=function(){var e=this.parent.getActiveSheet(),t=u(e.activeCell),r=He(t[0],t[1],e),n=this.parent.getCell(t[0],t[1]);if(n){this.removeListDropdownHandler(this.parent.element.getElementsByClassName("e-validation-list")[0]);var i=r&&r.validation||e.columns&&e.columns[t[1]]&&e.columns[t[1]].validation;if(i&&"List"===i.type){if(i.address&&!M(i.address,t[0],t[1]))return;this.addListValidationDropdownHandler({cell:r,validation:i,td:n,rowIdx:t[0],colIdx:t[1]})}r&&r.validation&&(r.validation=i)}},e.prototype.removeListDropdownHandler=function(e,r){if(e)if(this.listObj&&this.listObj.destroy(),t.remove(e),r)r.isRefresh&&this.updateNoteIndicator(r.td,r.rowIdx,r.colIdx);else if(!t.isNullOrUndefined(this.parent.selectionModule.previousActiveCell)){var n=u(this.parent.selectionModule.previousActiveCell),i=this.parent.getCell(n[0],n[1]);i&&this.updateNoteIndicator(i,n[0],n[1])}},e.prototype.addListValidationDropdownHandler=function(e){var r=this;if(e.updatePosition)return void this.updateTopPosition({ddlCont:e.ddlCont,rowIdx:e.rowIdx,colIdx:e.colIdx});var n=e.validation.inCellDropDown;if(e.isRefresh){if(!e.td&&(e.td=this.parent.getCell(e.rowIdx,e.colIdx),!e.td))return;if(this.removeListDropdownHandler(e.td.querySelector(".e-validation-list"),e),"List"!==e.validation.type)return;t.isNullOrUndefined(n)&&(n=!0)}else t.isNullOrUndefined(e.validation.ignoreBlank)&&(e.validation.ignoreBlank=!0),t.isNullOrUndefined(n)&&(n=e.validation.inCellDropDown=!0);if(n){var i=this.parent.createElement("div",{className:"e-validation-list"}),a=this.parent.createElement("input",{id:this.parent.element.id+"listValid"});i.appendChild(a);var o,l=e.td,d=l.getElementsByClassName("e-wrap-content")[0]||l;this.updateTopPosition({ddlCont:i,rowIdx:e.rowIdx,colIdx:e.colIdx}),this.listValidationHeightHandler({ddlCont:i}),d.insertBefore(i,d.firstChild);var h=e.validation.value1;e.cell&&e.cell.validation||!h.startsWith("=")||(h=q([e.rowIdx,e.colIdx,e.rowIdx,e.colIdx],[0,e.colIdx,0,e.colIdx],this.parent.getActiveSheet(),this.parent,{formula:h}));var p=this.getListDataSource(h);this.listObj=new s.DropDownList({index:this.setDropDownListIndex(p,e.cell),dataSource:p,fields:{text:"text",value:"id"},width:"0px",popupHeight:"200px",change:function(){return r.listValueChange(r.listObj.text)},beforeOpen:function(){(o=window.browserDetails.isDevice)&&(window.browserDetails.isDevice=!1)},open:function(e){e.popup.offsetX=r.listObj.enableRtl?3:-l.offsetWidth+(r.parent.enableRtl?4:24),e.popup.offsetY=-(l.querySelector(".e-control-wrapper.e-ddl").offsetHeight-18),e.popup.element.style.width=l.offsetWidth-1+"px",o&&(window.browserDetails.isDevice=!0)},close:function(e){e.event&&(13===e.event.keyCode||e.event.altKey&&38===e.event.keyCode)&&(e.event.preventDefault(),e.event.stopPropagation()),or(r.parent.element)}}),this.listObj.appendTo(a),this.updateNoteIndicator(l,e.rowIdx,e.colIdx)}},e.prototype.updateTopPosition=function(e){var t=this.parent.getActiveSheet(),r=He(e.rowIdx,e.colIdx,t);r&&r.style&&r.style.fontSize&&parseFloat(r.style.fontSize)>11?e.ddlCont.style.top=parseFloat(r.style.fontSize)-11+"pt":e.ddlCont.style.top&&(e.ddlCont.style.top="")},e.prototype.listValidationHeightHandler=function(e){var t=this.parent.getActiveSheet(),r=u(t.activeCell),n=He(r[0],r[1],t),i=n&&n.validation||t.columns&&t.columns[r[1]]&&t.columns[r[1]].validation;if(i&&"List"===i.type&&i.inCellDropDown){var a=nt(t,r[0],!0)-tr(r[0],r[1],t);if(a<=18)(o=e.ddlCont||this.parent.element.querySelector(".e-validation-list"))&&(o.style.height=a+"px");else if(!e.ddlCont){var o=this.parent.element.querySelector(".e-validation-list");o&&o.style.removeProperty("height")}}},e.prototype.setDropDownListIndex=function(e,r){if(r&&!t.isNullOrUndefined(r.value))for(var n=r.value.toString(),i=fe(n),a=i&&t.getNumericObject(this.parent.locale),o=0,s=e.length;o<s;o++)if(e[o].text===n||i&&this.parseValidationValue(e[o].text,a).toString()===n)return o;return null},e.prototype.getListDataSource=function(e){var t=this,r=[],n=0,i=this.parent.definedNames,a=e,o=a.startsWith("=");if(i.length>0&&o)for(var s=a.split("=")[1],l=0,d=i.length;l<d;l++)if(i[l].name===s){for(var h=i[l].refersTo;h.includes("'");)h=h.replace("'","");a=h}if(o){var p=void 0,u=void 0,f=void 0,g=a.lastIndexOf("!");g>-1?(f=a.substring(1,g),u=a.substring(g+1),f.startsWith("'")&&f.endsWith("'")&&(f=f.substring(1,f.length-1)),p=Ae(this.parent,Se(this.parent,f))):(p=this.parent.getActiveSheet(),u=a.substring(1));var m=this.parent.getActiveSheet();if(p){if(p.name!==m.name){var v,y=c(m.selectedRange);p.ranges.forEach(function(e){if(!e.info||!e.info.loadedRange||!e.info.loadedRange.length)return void(v=!0)}),v&&(this.parent.showSpinner(),ye(this.parent,p.name+"!"+u).then(function(){if(t.parent.hideSpinner(),m.name===t.parent.getActiveSheet().name){var r=c(t.parent.getActiveSheet().selectedRange);if(r[0]===y[0]&&r[1]===y[1]){var n=t.getListDataSource(e);t.listObj.dataSource=n;var i=He(r[0],r[1],m);t.listObj.index=t.setDropDownListIndex(n,i),t.listObj.dataBind()}}}))}var C=void 0,b=u.split(":");if(b[0]&&b[1]&&(b[0].match(/[a-z]+$/gi)&&b[1].match(/[a-z]+$/gi)||b[0].match(/^[0-9]/g)&&b[1].match(/^[0-9]/g))){var x=this.parent.getIndexes(u);C=x.isCol?[0,x.startIdx,p.usedRange.rowIndex,x.startIdx]:[x.startIdx,0,x.startIdx,p.usedRange.colIndex]}else C=c(u);for(var S=void 0,w=C[0];w<=C[2];w++){p.rows[w]||et(p,w,{});for(var I=C[1];I<=C[3];I++){p.rows[w].cells||Ue(w,I,p,{}),n+=1,S=p.rows[w].cells[I];var E=this.parent.getDisplayText(S)||"";r.push({text:E,id:"list-"+n})}}}}else for(var R=this.getListOfValues(a),l=0;l<R.length;l++)n+=1,r.push({text:R[l],id:"list-"+n});return r},e.prototype.listValueChange=function(e){var t=this.parent.getActiveSheet(),r=y(t.activeCell),n=Object.assign({},He(r[0],r[1],t));if(t.isProtected&&U(n,ot(t,r[1])))this.parent.notify(vi,null);else if(ae(n,ot(t,r[1]),Qe(t,r[0])))this.parent.notify(yi,null);else{this.parent.isEdit&&this.parent.closeEdit();var i={value:e,oldValue:n.value,address:t.name+"!"+t.activeCell,cancel:!1};if(this.parent.notify(qr,{action:"cellSave",eventArgs:i}),i.cancel)return;var a={value:e,formula:""};if(n.format&&qe(n.format)&&!fe(e)){var o={formattedText:e,value:e,format:"General",cell:{value:e,format:"General"},isEdit:!0};this.parent.notify(Wr,o),"General"!==o.format&&["Currency","Percentage"].indexOf($e(o.format))>-1&&(a.format=o.format,a.value=o.value)}if(!Y(this.parent,t,{cell:a,rowIdx:r[0],colIdx:r[1],valChange:!0,lastCell:!0,checkCF:!0,uiRefresh:!0})){var s=He(r[0],r[1],t,!1,!0);delete s.formula,this.parent.notify("formulaBarOperation",{action:"refreshFormulabar",cell:s}),this.parent.notify(Sn,null),this.parent.notify(ci,{action:"cellSave",eventArgs:{value:e,oldValue:n.value,address:t.name+"!"+t.activeCell}})}}},e.prototype.getRange=function(e){var t,r=c(e),n=this.parent.getActiveSheet().rowCount;return r[2]===n-1&&0===r[0]&&(e=e.replace(/[0-9]/g,""),t=!0),{range:e,isColSelected:t}},e.prototype.initiateDataValidationHandler=function(){var e,t,r=this,n=this.parent.getActiveSheet(),i=c(n.selectedRange),a=i[0],o=i[1];i[2]>=i[0]?(e=function(){return a<=i[2]},t=function(){a++}):(e=function(){return a>=i[2]},t=function(){a--});var s,l;i[3]>=i[1]?(s=function(){return o<=i[3]},l=function(){o++}):(s=function(){return o>=i[3]},l=function(){o--});var d,h,p,u,f,g,m,v=function(e,t){if(g&&((i=q(e,t,n,r.parent,{formula:u.value1})).includes("#REF!")||(u.value1=i)),m){var i=q(e,t,n,r.parent,{formula:u.value2});i.includes("#REF!")||(u.value2=i)}};for(a;e();t()){for(o;s();l())if(d=He(a,o,n,!1,!0),f=d.validation||pt(n.columns[o],a,o)&&n.columns[o].validation)if(u){if(!(f.type===u.type&&f.operator===u.operator&&(g&&k(f.value1)||f.value1===u.value1)&&(m&&k(f.value2)||f.value2===u.value2))){h=!0;break}}else{u=Object.assign({},f),g=k(u.value1),m=k(u.value2),d.validation||v([a,o,a,o],[0,o,0,o]);var y=c(n.activeCell);a===y[0]&&o===y[1]||v(y,[a,o,a,o])}else p=!0;o=i[1]}var C=this.parent.serviceLocator.getService(Na),b=this.parent.serviceLocator.getService(Fa),x=function(e){if(!r.parent.element.querySelector(".e-datavalidation-dlg")){var t=r.getRange(n.selectedRange).range;b.show({width:375,showCloseIcon:!0,isModal:!0,cssClass:"e-datavalidation-dlg",header:C.getConstant("DataValidation"),beforeOpen:function(n){var i={dialogName:"ValidationDialog",element:n.element,target:n.target,cancel:n.cancel};r.parent.trigger("dialogBeforeOpen",i),i.cancel?n.cancel=!0:(b.dialogInstance.content=r.dataValidationContent(C,t,e),b.dialogInstance.dataBind(),or(r.parent.element))},beforeClose:r.dialogBeforeClose.bind(r),buttons:[{buttonModel:{content:C.getConstant("ClearAll"),cssClass:"e-btn e-clearall-btn e-flat"},click:function(){b.dialogInstance.content=r.dataValidationContent(C,t),b.dialogInstance.dataBind()}},{buttonModel:{content:C.getConstant("Apply"),isPrimary:!0},click:function(){r.dlgClickHandler(b)}}]})}};if(h||u&&p){var S,w=[{buttonModel:{isPrimary:!0,cssClass:"e-btn-goto-ok"},click:function(){b.hide(!0),x()}}];h?(S="MoreValidation",w[0].buttonModel.content=C.getConstant("Ok")):(S="ExtendValidation",w[0].buttonModel.content=C.getConstant("No"),w.splice(0,0,{buttonModel:{content:C.getConstant("Yes"),isPrimary:!0,cssClass:"e-btn-goto-ok"},click:function(){b.hide(!0),x(u)}}));var I=C.getConstant(S),E={width:350,isModal:!0,showCloseIcon:!0,cssClass:"e-goto-dlg",header:C.getConstant("Spreadsheet"),content:I,beforeOpen:function(e){var t={dialogName:S,element:e.element,target:e.target,cancel:e.cancel,content:I};r.parent.trigger("dialogBeforeOpen",t),t.cancel?e.cancel=!0:(t.content!==I&&(b.dialogInstance.content=t.content,b.dialogInstance.dataBind()),or(r.parent.element))},buttons:w};b.show(E)}else x(u)},e.prototype.dataValidationContent=function(e,r,n){var i,l,d,h,p,c=this,u=!n;if(u)i=l="0",p=!0;else{var f=n.value1,g=n.value2;if(d=n.type,h=n.operator,p=!1!==n.ignoreBlank,"Date"===d||"Time"===d){var m=function(e){if(fe(e)){var t={cell:{value:e},type:d.toLowerCase(),value:e};return c.parent.notify("getFormattedBarText",t),t.value}return e};i=m(f),l=m(g)}else{var v=function(e){if(fe(e)){e=e.toString();var r=t.getNumericObject(c.parent.locale);"."!==r.decimal&&e.includes(".")&&(e=e.replace(".",r.decimal))}return e};i=v(f),l=v(g)}}var y=this.parent.createElement("div",{className:"e-validation-dlg"}),C=this.parent.createElement("div",{className:"e-cellrange"}),b=this.parent.createElement("div",{className:"e-allowdata"}),x=this.parent.createElement("div",{className:"e-values"}),S=this.parent.createElement("div",{className:"e-ignoreblank"});this.divElements.push(y),this.divElements.push(C),this.divElements.push(b),this.divElements.push(x),this.divElements.push(S),y.appendChild(C),y.appendChild(b),y.appendChild(x),y.appendChild(S);var w=this.parent.createElement("span",{className:"e-header"});w.innerText=e.getConstant("CellRange");var I=this.parent.createElement("input",{className:"e-input",attrs:{value:r,"aria-label":e.getConstant("CellRange")}});C.appendChild(w),C.appendChild(I);var E=this.parent.createElement("div",{className:"e-allow"}),R=this.parent.createElement("div",{className:"e-data"});b.appendChild(E),b.appendChild(R);var N=this.parent.createElement("span",{className:"e-header"});N.innerText=e.getConstant("Allow"),this.typeData=[{text:e.getConstant("WholeNumber"),id:"type-1"},{text:e.getConstant("Decimal"),id:"type-2"},{text:e.getConstant("Date"),id:"type-3"},{text:e.getConstant("Time"),id:"type-4"},{text:e.getConstant("TextLength"),id:"type-5"},{text:e.getConstant("List"),id:"type-6"},{text:e.getConstant("Custom"),id:"type-7"}],this.operatorData=[{text:e.getConstant("Between"),id:"operator-1"},{text:e.getConstant("NotBetween"),id:"operator-2"},{text:e.getConstant("EqualTo"),id:"operator-3"},{text:e.getConstant("NotEqualTo"),id:"operator-4"},{text:e.getConstant("GreaterThan"),id:"operator-5"},{text:e.getConstant("LessThan"),id:"operator-6"},{text:e.getConstant("GreaterThanOrEqualTo"),id:"operator-7"},{text:e.getConstant("LessThanOrEqualTo"),id:"operator-8"}];var F=this.parent.createElement("input",{className:"e-select"});this.spanElements.push(w),this.inputElements.push(I),this.divElements.push(E),this.divElements.push(R),this.spanElements.push(N),this.inputElements.push(F);var A=0;if(!u){d&&(d=this.formattedType(d));for(D=0;D<this.typeData.length;D++)if(d===this.formattedType(this.typeData[D].text)){A=D;break}}if(u||"List"!==d&&"Custom"!==d){var k=0,O=this.parent.createElement("span",{className:"e-header"});O.innerText=e.getConstant("Data");var T=this.parent.createElement("input",{className:"e-select"});if(!u)for(var D=0;D<this.operatorData.length;D++)if(h===this.formattedValue(this.operatorData[D].text)){k=D;break}R.appendChild(O),R.appendChild(T),this.spanElements.push(O),this.inputElements.push(T),this.dataList=new s.DropDownList({dataSource:this.operatorData,index:k,popupHeight:"200px",change:this.userInput.bind(this)}),this.dropDownListElements.push(this.dataList),this.dataList.appendTo(T)}else if("Custom"!==d){var L=this.parent.createElement("input",{className:"e-checkbox"});R.appendChild(L);var P=new o.CheckBox({label:e.getConstant("InCellDropDown"),checked:!1!==n.inCellDropDown});this.checkBoxElements.push(P),P.appendTo(L),this.inputElements.push(L)}E.appendChild(N),E.appendChild(F),this.typeList=new s.DropDownList({dataSource:this.typeData,index:A,popupHeight:"200px",change:this.userInput.bind(this)}),this.dropDownListElements.push(this.typeList),this.typeList.appendTo(F);var M=function(e,t){var r=c.parent.createElement("span",{className:"e-header"});r.innerText=e;var n=c.parent.createElement("input",{className:"e-input",attrs:{value:t}});x.appendChild(r),x.appendChild(n),c.spanElements.push(r),c.inputElements.push(n)};if(u||this.typeList.value!==e.getConstant("List")&&this.typeList.value!==e.getConstant("Custom")&&(this.dataList.value===e.getConstant("Between")||this.dataList.value===e.getConstant("NotBetween"))){var B=this.parent.createElement("div",{className:"e-minimum"}),H=this.parent.createElement("div",{className:"e-maximum"});x.appendChild(B),x.appendChild(H);var U=this.parent.createElement("span",{className:"e-header"});U.innerText=e.getConstant("Minimum");var V=this.parent.createElement("span",{className:"e-header"});V.innerText=e.getConstant("Maximum");var z=this.parent.createElement("input",{id:"minvalue",className:"e-input",attrs:{value:i,"aria-label":e.getConstant("Minimum")}}),j=this.parent.createElement("input",{id:"maxvalue",className:"e-input",attrs:{value:l,"aria-label":e.getConstant("Maximum")}});B.appendChild(U),B.appendChild(z),H.appendChild(V),H.appendChild(j),this.divElements.push(B),this.divElements.push(H),this.spanElements.push(U),this.spanElements.push(V),this.inputElements.push(z),this.inputElements.push(j);var _=new a.NumericTextBox({value:0});this.numericTextBoxElements.push(_),_.appendTo("#minvalue");var q=new a.NumericTextBox({value:0});this.numericTextBoxElements.push(q),q.appendTo("#maxvalue")}else u||"List"!==d?u||"Custom"!==d?M(e.getConstant("Value"),i):M(e.getConstant("Formula"),i):M(e.getConstant("Sources"),i);var W=this.parent.createElement("input",{className:"e-checkbox"});S.appendChild(W);var G=new o.CheckBox({label:e.getConstant("IgnoreBlank"),checked:p});return this.checkBoxElements.push(G),G.appendTo(W),this.inputElements.push(W),y},e.prototype.dialogBeforeClose=function(){this.checkBoxElements.forEach(function(e){e&&e.element&&(e.destroy(),e.element.remove())}),this.checkBoxElements=[],this.numericTextBoxElements.forEach(function(e){e&&e.element&&(e.destroy(),e.element.remove())}),this.numericTextBoxElements=[],this.dropDownListElements.forEach(function(e){e&&e.element&&(e.destroy(),e.element.remove())}),this.dropDownListElements=[],br(this.spanElements),this.spanElements=[],br(this.inputElements),this.inputElements=[],br(this.divElements),this.divElements=[]},e.prototype.userInput=function(){var e=this.typeList,t=this.dataList,r=this.parent.element.querySelector(".e-datavalidation-dlg").querySelector(".e-validation-dlg"),n=r.querySelector(".e-allowdata"),i=r.querySelector(".e-values"),s=this.parent.serviceLocator.getService(Na),l=n.querySelector(".e-data"),d=function(e){for(;e.lastChild;)e.removeChild(e.lastChild)};if(d(i),e.value===s.getConstant("List")){d(l);var h=this.parent.createElement("input",{className:"e-checkbox"});this.inputElements.push(h),l.appendChild(h);var p=new o.CheckBox({label:s.getConstant("InCellDropDown"),checked:!0});this.checkBoxElements.push(p),p.appendTo(h)}else if(e.value===s.getConstant("Custom"))d(l);else if(!l.childElementCount||l.getElementsByClassName("e-checkbox-wrapper")[0]){d(l);var c=this.parent.createElement("span",{className:"e-header"});c.innerText=s.getConstant("Data");var u=this.parent.createElement("input",{className:"e-select"});this.spanElements.push(c),this.inputElements.push(u),l.appendChild(c),l.appendChild(u),t.appendTo(u)}if(e.value===s.getConstant("List")||e.value===s.getConstant("Custom")||t.value!==s.getConstant("Between")&&t.value!==s.getConstant("NotBetween")){var f=this.parent.createElement("span",{className:"e-header"});f.innerText=e.value===s.getConstant("List")?s.getConstant("Sources"):e.value===s.getConstant("Custom")?s.getConstant("Formula"):s.getConstant("Value");var g=e.value===s.getConstant("List")?this.parent.createElement("input",{className:"e-input",attrs:{placeholder:"Enter value"}}):this.parent.createElement("input",{className:"e-input",attrs:{value:"0"}});this.spanElements.push(f),this.inputElements.push(g),i.appendChild(f),i.appendChild(g)}else{var m=this.parent.createElement("div",{className:"e-minimum"}),v=this.parent.createElement("div",{className:"e-maximum"});this.divElements.push(m),this.divElements.push(v),i.appendChild(m),i.appendChild(v);var y=this.parent.createElement("span",{className:"e-header"});y.innerText=s.getConstant("Minimum");var C=this.parent.createElement("span",{className:"e-header"});C.innerText=s.getConstant("Maximum");var b=this.parent.createElement("input",{id:"min",className:"e-input",attrs:{value:"0"}}),x=this.parent.createElement("input",{id:"max",className:"e-input",attrs:{value:"0"}});this.spanElements.push(y),this.spanElements.push(C),this.inputElements.push(b),this.inputElements.push(x);var S=new a.NumericTextBox({value:0});this.numericTextBoxElements.push(S),S.appendTo("min");var w=new a.NumericTextBox({value:0});this.numericTextBoxElements.push(w),w.appendTo("max"),m.appendChild(y),m.appendChild(b),v.appendChild(C),v.appendChild(x)}},e.prototype.dlgClickHandler=function(e){var r,n=this,i=this.parent.serviceLocator.getService(Na),a=this.parent.element.querySelector(".e-datavalidation-dlg"),o=a.querySelector(".e-footer-content"),s=a.getElementsByClassName("e-dlg-content")[0].getElementsByClassName("e-validation-dlg")[0],l=s.getElementsByClassName("e-allowdata")[0],d=l.getElementsByClassName("e-allow")[0].getElementsByTagName("input")[0],h=l.getElementsByClassName("e-data")[0].getElementsByTagName("input")[0],p=s.getElementsByClassName("e-values")[0],u=[];u[0]=p.getElementsByTagName("input")[0].value,u[1]=p.getElementsByTagName("input")[1]?p.getElementsByTagName("input")[1].value:"";var f,g=this.formattedType(d.value),m=!0,v=s.querySelector(".e-ignoreblank .e-checkbox").checked,y=l.querySelector(".e-data").querySelector(".e-checkbox-wrapper")?!!l.querySelector(".e-data").querySelector(".e-checkbox-wrapper").querySelector(".e-check"):null,C=s.querySelector(".e-cellrange").getElementsByTagName("input")[0].value;h&&(f=this.formattedValue(h.value));var b=[];if("List"===g)if(""!==u[0]&&b.push(u[0]),u[0].startsWith("=")){var x=u[0].substring(1),S=this.parent.definedNames.find(function(e){return e.name===x});S&&(x=S.refersTo.substring(1));var I=void 0,E=void 0;if(x.includes("!")){E=x.lastIndexOf("!");var R=x.substring(0,E);x=x.substring(E+1),R.startsWith("'")&&R.endsWith("'")&&(R=R.substring(1,R.length-1)),I=Se(this.parent,R)>-1,S||(b[0]="="+R+"!"+x)}else I=!0;!x.includes(":")&&O(x)&&(x=x+":"+x);var N=void 0;if(I){var F=x.split(":");2===F.length&&(N=x.match(/[a-z]/gi)&&F[0].replace(/[0-9]/g,"")===F[1].replace(/[0-9]/g,"")||x.match(/\d/g)&&F[0].replace(/\D/g,"")===F[1].replace(/\D/g,""))}(m=N)||(r=S||void 0!==E||x.includes(":")?i.getConstant("DialogError"):i.getConstant("NamedRangeError"))}else u[0].length>256&&(m=!1,r=i.getConstant("ListLengthError"));else{var T=t.getNumericObject(this.parent.locale);if("Decimal"===g&&"."!==T.decimal){var D=function(e){return fe(e)&&e.includes(".")&&("."!==T.group||!A(e,n.parent.locale,T.group,T.decimal))};(D(u[0])||D(u[1]))&&(m=!1,r=i.getConstant("InvalidNumberError"))}Q(u,this.parent,T),""!==u[0]&&b.push(u[0]),""!==u[1]&&b.push(u[1])}if(m){var L=this.parent.getActiveSheet(),P=this.isDialogValidator(b,g,f);if("Between"===f&&P.isValid&&!isNaN(parseFloat(b[0]))&&!isNaN(parseFloat(b[1]))&&parseFloat(b[0])>parseFloat(b[1])&&(P.isValid=!1,P.errorMsg=i.getConstant("MinMaxError")),"Custom"===g&&k(b[0])){var M=["#N/A","#VALUE!","#REF!","#DIV/0!","#NUM!","#NAME?","#NULL!","#CALC!"],B={value:b[0]};this.parent.notify("commputeFormulaValue",B);var H=B.value;M.indexOf(H)>-1&&(P.isValid=!1,P.errorMsg=i.getConstant("InvalidFormula"))}if(r=P.errorMsg,m=P.isValid){if(oe(this.parent,w(c(C))))return e.hide(!0),void this.parent.notify(yi,null);var U={range:L.name+"!"+C,value1:b[0],value2:b[1]||"",ignoreBlank:v,type:g,operator:f,inCellDropDown:y,cancel:!1};this.parent.notify(qr,{eventArgs:U,action:"validation"}),U.cancel||(this.parent.notify(ln,{rules:{type:U.type,operator:U.operator,value1:U.value1,value2:U.value2,ignoreBlank:U.ignoreBlank,inCellDropDown:U.inCellDropDown},range:U.range,isAction:!0}),delete U.cancel,this.parent.element.getElementsByClassName("e-validation-error-dlg")[0]||(e.dialogInstance?e.dialogInstance.hide():e.hide()),this.parent.notify(ci,{eventArgs:U,action:"validation"}))}}if(!m){var V=this.parent.createElement("div",{className:"e-dlg-error",id:"e-invalid"});V.innerText=r,p.appendChild(V),o.querySelector(".e-primary").setAttribute("disabled","true")}},e.prototype.formattedValue=function(e){var t=this.parent.serviceLocator.getService(Na);switch(e){case t.getConstant("Between"):e="Between";break;case t.getConstant("NotBetween"):e="NotBetween";break;case t.getConstant("EqualTo"):e="EqualTo";break;case t.getConstant("NotEqualTo"):e="NotEqualTo";break;case t.getConstant("GreaterThan"):e="GreaterThan";break;case t.getConstant("LessThan"):e="LessThan";break;case t.getConstant("GreaterThanOrEqualTo"):e="GreaterThanOrEqualTo";break;case t.getConstant("LessThanOrEqualTo"):e="LessThanOrEqualTo";break;default:e="Between"}return e},e.prototype.formattedType=function(e){var t=this.parent.serviceLocator.getService(Na);switch(e){case t.getConstant("WholeNumber"):e="WholeNumber";break;case t.getConstant("Decimal"):e="Decimal";break;case t.getConstant("Date"):e="Date";break;case t.getConstant("TextLength"):e="TextLength";break;case t.getConstant("List"):e="List";break;case t.getConstant("Time"):e="Time";break;case t.getConstant("Custom"):e="Custom"}return e},e.prototype.isDialogValidator=function(e,t,r){var n,i=this.parent.serviceLocator.getService(Na),a=0;if("List"===t?!(e.length>0):"Between"===r||"NotBetween"===r?2!==e.length:!(e.length>0))return{isValid:!1,errorMsg:i.getConstant("EmptyError")};for(var o=void 0,s=0;s<e.length;s++){if(k(e[s])){var l={value:e[s]};this.parent.notify("commputeFormulaValue",l),o=l.value}else o="Date"===t||"Time"===t?e[s]=this.getDateAsNumber({range:[],cell:{value:e[s]}},e[s]):e[s];if(!(n=this.formatValidation(o,t,!0)).isValid)break;a+=1}return n.isValid=a===e.length,n},e.prototype.getDateAsNumber=function(e,t){var r={value:t,rowIndex:e.range[0],cell:e.cell,colIndex:e.range[1],sheetIndex:e.sheetIdx,updatedVal:""};return this.parent.notify(Zr,r),r.updatedVal||t},e.prototype.getListOfValues=function(e){return","!==this.parent.listSeparator&&e.includes(this.parent.listSeparator)?e.split(this.parent.listSeparator):e.split(",")},e.prototype.checkValidationHandler=function(e,r){var n=e.value.toString(),i=this.parent.sheets[e.sheetIdx],a=He(e.range[0],e.range[1],i,null,!0),o=r.value1,s=r.value2;if(!a.validation){var l=e.range,d=[0,e.range[1],0,e.range[3]];k(o)&&(o=q(l,d,i,this.parent,{formula:o})),k(s)&&(s=q(l,d,i,this.parent,{formula:s}))}if("List"!==r.type){if(k(o)){var h={value:o};this.parent.notify("commputeFormulaValue",h),o=h.value}if(k(s)){var p={value:s};this.parent.notify("commputeFormulaValue",p),s=p.value}if(k(e.value)){var c={value:e.value};this.parent.notify("commputeFormulaValue",c),e.value=c.value}}var u=e.value,f=r.operator||"Between",g=r.type||"WholeNumber",m=!!t.isNullOrUndefined(r.ignoreBlank)||r.ignoreBlank;if(m&&""===n)return!0;var v="Date"===g||"Time"===g;if(e.value)if(v||"TextLength"===r.type)fe(e.value)||(u=e.value=this.getDateAsNumber(e,e.value));else{x=e.isEdit&&t.getNumericObject(this.parent.locale);(R=this.parseValidationValue(e.value,x))!==e.value&&fe(R)&&(u=e.value=R.toString())}var y=this.formatValidation(e.value,g).isValid;if(y)if(y=!1,v?(o&&!fe(o)&&(o=this.getDateAsNumber(e,o)),s&&!fe(s)&&(s=this.getDateAsNumber(e,s))):"TextLength"===r.type&&(u=e.value.toString().length.toString()),"List"===g){var C=e.value.toString(),b=fe(C),x=b&&t.getNumericObject(this.parent.locale);if(o.startsWith("=")){for(var S=void 0,w=this.getListDataSource(o),I=0;I<w.length;I++)if(S=w[I].text.toString(),n===S||C===S||b&&C===this.parseValidationValue(S,x).toString()){y=!0;break}}else for(var E=this.getListOfValues(o),I=0;I<E.length;I++)if(n===E[I]||C===E[I]||b&&C===this.parseValidationValue(E[I],x).toString()){y=!0;break}!y&&m&&""===C&&(y=!0)}else if("Custom"===g){var R=parseFloat(o.toString());if(fe(R))if(0===R){var N={value:r.value1};this.parent.notify("getCellRefValue",N),y=""===N.value}else y=!0;else y="TRUE"===o.toUpperCase();!y&&m&&""===o&&(y=!0)}else switch("Decimal"===g||"Time"===g?(u=parseFloat(u.toString()),o=parseFloat(o.toString()),s=s?parseFloat(s.toString()):null):(u=parseInt(u.toString(),10),o=parseInt(o.toString(),10),s=s?parseInt(s.toString(),10):null),f){case"EqualTo":y=u===o;break;case"NotEqualTo":y=u!==o;break;case"Between":y=u>=o&&u<=s;break;case"NotBetween":y=!(u>=o&&u<=s);break;case"GreaterThan":y=u>o;break;case"LessThan":y=u<o;break;case"GreaterThanOrEqualTo":y=u>=o;break;case"LessThanOrEqualTo":y=u<=o}return y},e.prototype.parseValidationValue=function(e,t){if(fe(e))return t&&"."===t.group&&(e=e.toString()).indexOf(".")&&A(e,this.parent.locale,t.group,t.decimal)&&(e=e.split(t.group).join("")),e;var r={formattedText:e,value:e,format:"General",cell:{value:e,format:"General"},isEdit:!!t};return this.parent.notify(Wr,r),r.value},e.prototype.isValidCellHandler=function(e){var r=this.parent.sheets[e.sheetIdx],n=He(e.range[0],e.range[1],r),i={skip:!1,value:""},a=n&&n.validation;if(a){if(k(a.value1)&&!O(a.value1.substring(1,a.value1.length))&&a.value1.indexOf("(")>-1){var o=a.value1;o=o.substring(o.indexOf("=")+1,o.indexOf("(")),i.value=o.toUpperCase(),this.parent.notify("formulaInValidation",i)}if(!i.skip&&k(a.value2)&&!O(a.value2.substring(1,a.value2.length))&&a.value1.indexOf("(")>-1){var s=a.value2;s=s.substring(s.indexOf("=")+1,s.indexOf("(")),i.value=s.toUpperCase(),this.parent.notify("formulaInValidation",i)}}if(!i.skip&&(e.value=t.isNullOrUndefined(e.value)?"":e.value,a?(e.isValid=this.checkValidationHandler(e,a),e.isValid&&pt(r.columns[e.range[1]],e.range[0],e.range[1])&&(a=r.columns[e.range[1]].validation,e.isValid=this.checkValidationHandler(e,a))):pt(r.columns[e.range[1]],e.range[0],e.range[1])&&(a=r.columns[e.range[1]].validation,e.isValid=this.checkValidationHandler(e,a)),a)){var l=void 0;e.isEdit&&!e.isValid&&(e.isValid=l=this.validationErrorHandler(this.parent.serviceLocator.getService(Na).getConstant("ValidationError"))),e.isValid&&a.isHighlighted&&!tt(r,e.range[0])&&!ht(r,e.range[1])&&this.updateHighlightHandler({rowIdx:e.range[0],colIdx:e.range[1],isRemoveHighlightedData:!l,isRemoveValidation:!0})}},e.prototype.formatValidation=function(e,t,r){var n,i=this.parent.element.getElementsByClassName("e-sheet-panel")[0],o=this.parent.createElement("form",{id:"formId",className:"form-horizontal"}),s=this.parent.createElement("input",{id:"e-validation"});if(s.setAttribute("name","validation"),s.setAttribute("type","text"),"Date"===t&&fe(e)){var l=e.toString().split(".");2===l.length&&(e=l[0])}s.setAttribute("value",e),o.appendChild(s),i.appendChild(o);var d;switch(t){case"Date":d={rules:{validation:{date:!0}},customPlacement:function(e,t){n=t.innerText}};break;case"Decimal":d={rules:{validation:{number:!0}},customPlacement:function(e,t){n=t.innerText}};break;case"WholeNumber":d={rules:{validation:{regex:/^-?\d*\.?[0]*$/}},customPlacement:function(e,t){n=t.innerText}};break;case"TextLength":r&&(d={rules:{validation:{regex:/^\d*\.?[0]*$/}},customPlacement:function(e,t){n=t.innerText}})}this.formObj=new a.FormValidator("#formId",d);var h=this.formObj.validate();return i.removeChild(i.getElementsByClassName("form-horizontal")[0]),{isValid:h,errorMsg:n}},e.prototype.updateHighlightHandler=function(e){var t;if(!e.isRemoveValidation){var r=e.cell.value||0===e.cell.value?e.cell.value:e.cell.hyperlink?"string"==typeof e.cell.hyperlink?e.cell.hyperlink:e.cell.hyperlink.address||"":"",n={value:r,range:[e.rowIdx,e.colIdx],sheetIdx:this.parent.activeSheetIndex};(t=this.checkValidationHandler(n,e.validation))&&e.col&&pt(e.col,e.rowIdx,e.colIdx)&&(n.value=r,t=this.checkValidationHandler(n,e.col.validation))}if(t){if(e.removeOnValidData){var i=this.parent.getCell(e.rowIdx,e.colIdx);i&&i.style.backgroundColor&&(e.td=i,e.style=this.parent.getCellStyleValue(["backgroundColor","color"],[e.rowIdx,e.colIdx]),this.parent.notify(Xr,e),e.td=null)}}else e.isRemoveHighlightedData?(e.style=this.parent.getCellStyleValue(["backgroundColor","color"],[e.rowIdx,e.colIdx]),this.parent.notify(Xr,e)):(e.style={backgroundColor:"#ffff00",color:"#ff0000"},this.parent.notify(Xr,e))},e.prototype.validationErrorHandler=function(e){var t=this,r=this.parent.element.getElementsByClassName("e-spreadsheet-edit")[0],n=this.parent.serviceLocator.getService(Na),i=!1;if(!this.parent.element.querySelector(".e-validation-error-dlg")){var a=this.parent.serviceLocator.getService(Fa),o={width:400,height:200,isModal:!0,showCloseIcon:!0,cssClass:"e-validation-error-dlg",target:document.getElementById(this.parent.element.id)||this.parent.element,beforeOpen:function(n){var o={dialogName:"ValidationErrorDialog",element:n.element,target:n.target,cancel:n.cancel,content:e};t.parent.trigger("dialogBeforeOpen",o),o.cancel&&(n.cancel=!0,i=!0),r.focus(),a.dialogInstance.content=o.content,a.dialogInstance.dataBind()},buttons:[{buttonModel:{content:n.getConstant("Retry"),isPrimary:!0},click:function(){t.errorDlgHandler(a,"Retry")}},{buttonModel:{content:n.getConstant("Cancel")},click:function(){t.errorDlgHandler(a,"Cancel")}}]};a.show(o,!1)}return i},e.prototype.errorDlgHandler=function(e,t){if("Retry"===t){var r=this.parent.element.getElementsByClassName("e-spreadsheet-edit")[0];e.hide(),r.innerText&&(window.getSelection().selectAllChildren(r),this.listObj&&!this.listObj.isDestroyed&&this.listObj.showPopup())}else{var n=u(this.parent.getActiveSheet().activeCell),i=He(n[0],n[1],this.parent.getActiveSheet()),a=i?this.parent.getDisplayText(i):"";this.parent.notify(Yn,{action:"cancelEdit",value:a,refreshFormulaBar:!0,refreshEditorElem:!0,isAppend:!1,trigEvent:!0}),e.hide()}},e.prototype.getModuleName=function(){return"dataValidation"},e}(),ho=function(){function e(e){this.parent=e,this.init()}return e.prototype.init=function(){this.addEventListener()},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on(fi,this.protect,this),this.parent.on("protectSheet",this.protectSheetHandler,this),this.parent.on(vi,this.editProtectedAlert,this),this.parent.on("protectWorkbook",this.protectWorkbook,this),this.parent.on(Kn,this.KeyUpHandler,this),this.parent.on("unProtectWorkbook",this.unProtectWorkbook,this),this.parent.on("unProtectSheetPassword",this.unProtectSheetPassword,this),this.parent.on("importProtectWorkbook",this.importProtectWorkbook,this),this.parent.on(Ti,this.protectWorkbookHandler,this),this.parent.on(Di,this.removeWorkbookProtection,this),this.parent.on("toggleProtect",this.toggleProtect,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(fi,this.protect),this.parent.off("protectSheet",this.protectSheetHandler),this.parent.off(vi,this.editProtectedAlert),this.parent.off("protectWorkbook",this.protectWorkbook),this.parent.off(Kn,this.KeyUpHandler),this.parent.off("unProtectWorkbook",this.unProtectWorkbook),this.parent.off("unProtectSheetPassword",this.unProtectSheetPassword),this.parent.off("importProtectWorkbook",this.importProtectWorkbook),this.parent.off(Ti,this.protectWorkbookHandler),this.parent.off(Di,this.removeWorkbookProtection),this.parent.off("toggleProtect",this.toggleProtect))},e.prototype.protect=function(e){if(e.isActive){var t=this.parent.getActiveSheet();t.isImportProtected&&(t.isImportProtected=!1)}this.parent.notify("clearCopy",null),e.isActive?(this.parent.setSheetPropertyOnMute(Ae(this.parent,e.sheetIndex),"isProtected",!1),this.parent.notify("updateToggleItem",{props:"Protect"}),this.parent.notify("protectSheet",e),this.parent.notify("protectSelection",null)):this.createDialogue()},e.prototype.createDialogue=function(){var e=this,r=this.parent.serviceLocator.getService(Na),n=[{text:r.getConstant("SelectCells"),id:"1"},{text:r.getConstant("SelectUnlockedCells"),id:"6"},{text:r.getConstant("FormatCells"),id:"2"},{text:r.getConstant("FormatRows"),id:"3"},{text:r.getConstant("FormatColumns"),id:"4"},{text:r.getConstant("InsertLinks"),id:"5"}];this.optionList=new l.ListView({dataSource:n,showCheckBox:!0,select:this.dialogOpen.bind(this)});var i=this.parent.createElement("div",{className:"e-sheet-password-dialog"}),a=this.parent.createElement("div",{className:"e-sheet-password-content"}),s=this.parent.createElement("div",{className:"e-header"});s.innerText=r.getConstant("SheetPassword");var d=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}});d.setAttribute("placeholder",r.getConstant("EnterThePassword")),a.appendChild(d),a.insertBefore(s,d),i.appendChild(a);var h=this.parent.createElement("div",{className:"e-protect-content"});h.innerText=r.getConstant("ProtectAllowUser"),this.parent.setSheetPropertyOnMute(this.parent.getActiveSheet(),"isProtected",!1);var p=new o.CheckBox({checked:!0,label:r.getConstant("ProtectContent"),cssClass:"e-protect-checkbox"}),c=this.parent.createElement("div",{className:"e-protect-option-list",id:this.parent.element.id+"_option_list"}),u=this.parent.createElement("div",{className:"e-header-content"});u.innerText=r.getConstant("ProtectSheet");var f,g=this.parent.createElement("input",{id:this.parent.element.id+"_protect_check",attrs:{type:"checkbox"}}),m=this.parent.serviceLocator.getService("dialog"),v=function(){var r=t.getInstance(document.getElementById(e.parent.element.id+"_protect_check"),o.CheckBox);m.dialogInstance.element.querySelector(".e-footer-content .e-btn.e-primary").disabled=!r.checked};m.show({header:u.outerHTML,content:i.outerHTML+g.outerHTML+h.outerHTML+c.outerHTML,showCloseIcon:!0,isModal:!0,cssClass:"e-protect-dlg",beforeOpen:function(t){var r={dialogName:"ProtectSheetDialog",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",r),r.cancel?f=t.cancel=!0:or(e.parent.element)},beforeClose:function(){f||t.EventHandler.remove(p.element,"click",v)},buttons:[{click:this.selectOption.bind(this,m),buttonModel:{content:r.getConstant("Ok"),isPrimary:!0}},{click:function(){return m.hide()},buttonModel:{content:r.getConstant("Cancel")}}]},!1),f||(p.appendTo("#"+this.parent.element.id+"_protect_check"),this.optionList.appendTo("#"+this.parent.element.id+"_option_list"),this.optionList.selectMultipleItems([{id:"1"},{id:"6"}]),t.EventHandler.add(p.element,"click",v,this))},e.prototype.dialogOpen=function(e){var t=this.parent.serviceLocator.getService(Na);e.text===t.getConstant("SelectCells")&&e.isChecked&&e.isInteracted&&this.optionList.checkItem({id:"6"}),e.text===t.getConstant("SelectUnlockedCells")&&!e.isChecked&&e.isInteracted&&this.optionList.uncheckItem({id:"1"})},e.prototype.selectOption=function(e){var t=e.dialogInstance.element.querySelector(".e-sheet-password-content .e-input").value;if(t)this.reEnterSheetPassword(t);else{var r=this.parent.getActiveSheet();this.parent.setSheetPropertyOnMute(r,"isProtected",!0),this.parent.setSheetPropertyOnMute(r,"password",t),this.updateProtectSheet(t),e.hide(),r.protectSettings.selectCells||r.protectSettings.selectUnLockedCells?r.protectSettings.selectUnLockedCells&&sr(this.parent,c(r.selectedRange))&&this.parent.notify("hideAutoFillElement",null):this.parent.notify("hideAutoFillElement",null)}},e.prototype.applySheetPwd=function(e){var t=this.parent.getActiveSheet();this.parent.setSheetPropertyOnMute(t,"isProtected",!0),this.parent.setSheetPropertyOnMute(t,"password",e),this.updateProtectSheet(e),t.protectSettings.selectCells||t.protectSettings.selectUnLockedCells||this.parent.notify("hideAutoFillElement",null)},e.prototype.updateProtectSheet=function(e){var t=this.parent.serviceLocator.getService(Na),r=this.optionList.getSelectedItems(),n={selectCells:r.text.indexOf(t.getConstant("SelectCells"))>-1,formatCells:r.text.indexOf(t.getConstant("FormatCells"))>-1,formatRows:r.text.indexOf(t.getConstant("FormatRows"))>-1,formatColumns:r.text.indexOf(t.getConstant("FormatColumns"))>-1,insertLink:r.text.indexOf(t.getConstant("InsertLinks"))>-1,selectUnLockedCells:r.text.indexOf(t.getConstant("SelectUnlockedCells"))>-1};this.parent.notify(un,{protectSettings:n,password:e,triggerEvent:!0}),this.parent.notify("protectSelection",null),this.parent.notify("clearUndoRedoCollection",null)},e.prototype.protectSheetHandler=function(e){var r=t.isNullOrUndefined(e&&e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex,n=Ae(this.parent,r),i=this.parent.element.id,a=[i+"_undo",i+"_redo",i+"_cut",i+"_copy",i+"_paste",i+"_number_format",i+"_font_name",i+"_font_size",i+"_bold",i+"_italic",i+"_line-through",i+"_underline",i+"_font_color_picker",i+"_fill_color_picker",i+"_borders",i+"_merge_cells",i+"_text_align",i+"_vertical_align",i+"_wrap",i+"_sorting",i+"_clear",i+"_conditionalformatting"],o=[i+"_cut",i+"_copy",i+"_number_format",i+"_font_name",i+"_font_size",i+"_bold",i+"_italic",i+"_line-through",i+"_underline",i+"_font_color_picker",i+"_fill_color_picker",i+"_borders",i+"_text_align",i+"_vertical_align",i+"_wrap",i+"_sorting",i+"_clear",i+"_conditionalformatting"],s=[i+"_insert_function"],l=[i+"_hyperlink",i+"_",i+"_chart"],d=[i+"_image"],h=[i+"_find"],p=[i+"_datavalidation"],u=[i+"_chart"],f=document.getElementById(this.parent.element.id+"_sheet_panel");f&&(n.isProtected?n.protectSettings.selectCells?f.classList.remove("e-protected"):n.protectSettings.selectUnLockedCells&&!sr(this.parent,c(n.selectedRange))?f.classList.remove("e-protected"):f.classList.add("e-protected"):f.classList.add("e-protected"),n.isProtected||f.classList.remove("e-protected")),this.parent.dataBind(),this.parent.notify("protectCellFormat",{disableHomeBtnId:a,enableHomeBtnId:o,enableFrmlaBtnId:s,enableInsertBtnId:l,findBtnId:h,dataValidationBtnId:p,imageBtnId:d,chartBtnId:u}),this.parent.notify("enableFormulaInput",null),n.isProtected&&this.parent.notify("updateToggleItem",{props:"Protect"}),e&&e.triggerEvent&&this.parent.notify(ci,{action:"protectSheet",eventArgs:{sheetIndex:r,isProtected:n.isProtected,password:n.password,protectSettings:n.protectSettings.properties||n.protectSettings}})},e.prototype.editProtectedAlert=function(){var e=this,t=this.parent.serviceLocator.getService(Na),r=this.parent.serviceLocator.getService("dialog");r.show({content:t.getConstant("EditAlert"),isModal:!0,closeOnEscape:!0,showCloseIcon:!0,width:"400px",cssClass:"e-editAlert-dlg",beforeOpen:function(n){var i={dialogName:"EditAlertDialog",content:t.getConstant("EditAlert"),element:n.element,target:n.target,cancel:n.cancel};e.parent.trigger("dialogBeforeOpen",i),i.cancel?n.cancel=!0:(r.dialogInstance.content=i.content,or(e.parent.element))},close:function(){return or(e.parent.element)}})},e.prototype.protectWorkbook=function(){var e=this,t=this.parent.serviceLocator.getService(Na),r=this.parent.serviceLocator.getService(Fa);r.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-protectworkbook-dlg",header:t.getConstant("ProtectWorkbook"),beforeOpen:function(t){var n={dialogName:"ProtectWorkbook",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",n),n.cancel?t.cancel=!0:(r.dialogInstance.content=e.passwordProtectContent(),r.dialogInstance.dataBind(),or(e.parent.element))},buttons:[{buttonModel:{content:t.getConstant("Ok"),isPrimary:!0},click:function(){e.alertMessage(),e.dlgClickHandler(r)}}]})},e.prototype.passwordProtectContent=function(){var e=this.parent.serviceLocator.getService(Na),t=this.parent.createElement("div",{className:"e-password-dialog"}),r=this.parent.createElement("div",{className:"e-password-content"}),n=this.parent.createElement("div",{className:"e-password-content"}),i=this.parent.createElement("div",{className:"e-header"});i.innerText=e.getConstant("Password");var a=this.parent.createElement("div",{className:"e-header"});a.innerText=e.getConstant("ConfirmPassword");var o=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}}),s=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}});return o.setAttribute("placeholder",e.getConstant("EnterThePassword")),s.setAttribute("placeholder",e.getConstant("EnterTheConfirmPassword")),r.appendChild(o),r.insertBefore(i,o),n.appendChild(s),n.insertBefore(a,s),t.appendChild(n),t.insertBefore(r,n),t},e.prototype.KeyUpHandler=function(e){var r=e.target;if(r.classList.contains("e-text")&&t.closest(r,".e-password-content")&&t.closest(r,".e-password-dialog")&&t.closest(r,".e-password-dialog").getElementsByClassName("e-password-content")[1]===r.parentElement){var n=t.closest(r,".e-protectworkbook-dlg").getElementsByClassName("e-footer-content")[0].firstChild;""!==r.value?n.removeAttribute("disabled"):n.setAttribute("disabled","true")}if(r.classList.contains("e-text")&&t.closest(r,".e-unprotectpwd-content")&&t.closest(r,".e-unprotectpwd-dialog")&&t.closest(r,".e-unprotectpwd-dialog").getElementsByClassName("e-unprotectpwd-content")[0]===r.parentElement){var i=t.closest(r,".e-unprotectworkbook-dlg").getElementsByClassName("e-footer-content")[0].firstChild;""!==r.value?i.removeAttribute("disabled"):i.setAttribute("disabled","true")}if(r.classList.contains("e-text")&&t.closest(r,".e-reenterpwd-content")&&t.closest(r,".e-reenterpwd-dialog")&&t.closest(r,".e-reenterpwd-dialog").getElementsByClassName("e-reenterpwd-content")[0]===r.parentElement){var a=t.closest(r,".e-reenterpwd-dlg").getElementsByClassName("e-footer-content")[0].firstChild;""!==r.value?a.removeAttribute("disabled"):a.setAttribute("disabled","true")}if(r.classList.contains("e-text")&&t.closest(r,".e-unprotectsheetpwd-content")&&t.closest(r,".e-unprotectsheetpwd-dialog")&&t.closest(r,".e-unprotectsheetpwd-dialog").getElementsByClassName("e-unprotectsheetpwd-content")[0]===r.parentElement){o=t.closest(r,".e-unprotectworksheet-dlg").getElementsByClassName("e-footer-content")[0].firstChild;""!==r.value?o.removeAttribute("disabled"):o.setAttribute("disabled","true")}if(r.classList.contains("e-text")&&t.closest(r,".e-importprotectpwd-content")&&t.closest(r,".e-importprotectpwd-dialog")&&t.closest(r,".e-importprotectpwd-dialog").getElementsByClassName("e-importprotectpwd-content")[0]===r.parentElement){var o=t.closest(r,".e-importprotectworkbook-dlg").getElementsByClassName("e-footer-content")[0].firstChild;""!==r.value?o.removeAttribute("disabled"):o.setAttribute("disabled","true")}},e.prototype.alertMessage=function(){var e=this.parent.element.querySelector(".e-pwd-alert-span"),t=this.parent.element.querySelector(".e-unprotectpwd-alert-span"),r=this.parent.element.querySelector(".e-importprotectpwd-alert-span"),n=this.parent.element.querySelector(".e-reenterpwd-alert-span"),i=this.parent.element.querySelector(".e-unprotectsheetpwd-alert-span");e&&e.remove(),t&&t.remove(),r&&r.remove(),n&&n.remove(),i&&i.remove()},e.prototype.dlgClickHandler=function(e){var t=this.parent.serviceLocator.getService(Na),r=this.parent.element.querySelector(".e-password-dialog").getElementsByClassName("e-password-content")[0].querySelector(".e-input"),n=this.parent.element.querySelector(".e-password-dialog").getElementsByClassName("e-password-content")[1].querySelector(".e-input"),i=this.parent.createElement("span",{className:"e-pwd-alert-span"});r.value===n.value?(e.hide(),this.parent.notify("updateToggleItem",{props:"Protectworkbook"}),this.protectWorkbookHandler({password:r.value}),this.parent.notify(ci,{action:"protectWorkbook",eventArgs:{isProtected:!0,password:r.value}})):""===r.value?i.textContent=t.getConstant("PasswordAlertMsg"):""===n.value?i.textContent=t.getConstant("ConfirmPasswordAlertMsg"):r.value!==n.value&&(i.textContent=t.getConstant("PasswordAlert")),e.dialogInstance&&this.parent.element.querySelector(".e-protectworkbook-dlg").querySelector(".e-dlg-content").appendChild(i)},e.prototype.protectWorkbookHandler=function(e){this.parent.password=e.password,this.parent.isProtected=!0,this.parent.showSheetTabs&&(this.parent.element.querySelector(".e-add-sheet-tab").setAttribute("disabled","true"),this.parent.element.querySelector(".e-add-sheet-tab").classList.add("e-disabled")),this.parent.notify("updateToggleItem",{props:"Protectworkbook"})},e.prototype.unProtectWorkbook=function(){var e=this,t=this.parent.serviceLocator.getService(Na),r=this.parent.serviceLocator.getService(Fa);r.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-unprotectworkbook-dlg",header:t.getConstant("UnprotectWorkbook"),beforeOpen:function(t){var n={dialogName:"UnprotectWorkbook",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",n),n.cancel?t.cancel=!0:(r.dialogInstance.content=e.unProtectPasswordContent(),r.dialogInstance.dataBind(),or(e.parent.element))},buttons:[{buttonModel:{content:t.getConstant("Ok"),isPrimary:!0,disabled:!0},click:function(){e.alertMessage(),e.unprotectdlgOkClick(r)}}]})},e.prototype.unProtectsheet=function(e){var t=this,r=this.parent.serviceLocator.getService(Na),n=this.parent.serviceLocator.getService(Fa);n.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-unprotectworksheet-dlg",header:r.getConstant("UnprotectWorksheet"),beforeOpen:function(e){var r={dialogName:"UnProtectSheet",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",r),r.cancel?e.cancel=!0:(n.dialogInstance.content=t.unProtectSheetPasswordContent(),n.dialogInstance.dataBind(),or(t.parent.element))},buttons:[{buttonModel:{content:r.getConstant("Ok"),isPrimary:!0,disabled:!this.parent.allowOpen||!this.parent.openModule.isImportedFile||-1!==this.parent.openModule.unProtectSheetIdx.indexOf(this.parent.activeSheetIndex)},click:function(){t.alertMessage(),t.unprotectSheetdlgOkClick(n,e)}}]})},e.prototype.reEnterSheetPassword=function(e){var t,r,n=this,i=this.parent.serviceLocator.getService(Na),a=this.parent.serviceLocator.getService(Fa),o=a.dialogInstance;a.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-reenterpwd-dlg",header:i.getConstant("ConfirmPassword"),beforeOpen:function(e){var r={dialogName:"Re-enterPassword",element:e.element,target:e.target,cancel:e.cancel};if(n.parent.trigger("dialogBeforeOpen",r),r.cancel)t=e.cancel=!0;else{var i=n.parent.serviceLocator.getService(Na),o=n.parent.createElement("div",{className:"e-reenterpwd-dialog"}),s=n.parent.createElement("div",{className:"e-reenterpwd-content"}),l=n.parent.createElement("div",{className:"e-header"});l.innerText=i.getConstant("ReEnterPassword");var d=n.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}});s.appendChild(d),s.insertBefore(l,d),o.appendChild(s),a.dialogInstance.content=o,a.dialogInstance.dataBind(),or(n.parent.element.querySelector(".e-protect-dlg.e-dialog .e-footer-content .e-btn"))}},close:function(){a.dialogInstance=o,t?(n.applySheetPwd(e),a.hide(!0)):r&&a.hide(!0)},buttons:[{buttonModel:{content:i.getConstant("Ok"),isPrimary:!0,disabled:!0},click:function(){n.alertMessage();var t=n.parent.serviceLocator.getService(Na),i=n.parent.element.querySelector(".e-reenterpwd-dialog .e-reenterpwd-content .e-input").value;if(e===i)n.applySheetPwd(e),r=!0,a.hide();else{var o=n.parent.createElement("span",{className:"e-reenterpwd-alert-span"});o.textContent=i?t.getConstant("PasswordAlert"):t.getConstant("ConfirmPasswordAlertMsg"),n.parent.element.querySelector(".e-reenterpwd-dlg").querySelector(".e-reenterpwd-dialog").appendChild(o)}}}]})},e.prototype.unProtectPasswordContent=function(){var e=this.parent.serviceLocator.getService(Na),t=this.parent.createElement("div",{className:"e-unprotectpwd-dialog"}),r=this.parent.createElement("div",{className:"e-unprotectpwd-content"}),n=this.parent.createElement("div",{className:"e-header"});n.innerText=e.getConstant("EnterThePassword");var i=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}});return r.appendChild(i),r.insertBefore(n,i),t.appendChild(r),t},e.prototype.unProtectSheetPasswordContent=function(){var e=this.parent.serviceLocator.getService(Na),t=this.parent.createElement("div",{className:"e-unprotectsheetpwd-dialog"}),r=this.parent.createElement("div",{className:"e-unprotectsheetpwd-content"}),n=this.parent.createElement("div",{className:"e-header"});n.innerText=e.getConstant("EnterThePassword");var i=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}});return r.appendChild(i),r.insertBefore(n,i),t.appendChild(r),t},e.prototype.unprotectdlgOkClick=function(e){var t=this.parent.serviceLocator.getService(Na),r=this.parent.element.querySelector(".e-unprotectpwd-dialog").getElementsByClassName("e-unprotectpwd-content")[0].querySelector(".e-input");if(this.parent.password===r.value)e.hide(),this.removeWorkbookProtection(),this.parent.notify(ci,{action:"protectWorkbook",eventArgs:{isProtected:!1}});else{var n=this.parent.createElement("span",{className:"e-unprotectpwd-alert-span"});n.innerText=t.getConstant("UnprotectPasswordAlert"),this.parent.element.querySelector(".e-unprotectworkbook-dlg").querySelector(".e-dlg-content").appendChild(n)}},e.prototype.removeWorkbookProtection=function(){this.parent.password="",this.parent.isProtected=!1,this.parent.showSheetTabs&&(this.parent.element.querySelector(".e-add-sheet-tab").removeAttribute("disabled"),this.parent.element.querySelector(".e-add-sheet-tab").classList.remove("e-disabled"));var e=document.getElementById(this.parent.element.id+"_protectworkbook");e&&e.classList.remove("e-active"),this.parent.notify("updateToggleItem",{props:"Protectworkbook"})},e.prototype.unprotectSheetdlgOkClick=function(e,t){var r=this.parent.serviceLocator.getService(Na),n=this.parent.getActiveSheet(),i=this.parent.element.querySelector(".e-unprotectsheetpwd-dialog").getElementsByClassName("e-unprotectsheetpwd-content")[0].querySelector(".e-input");if(t&&0===n.password.length){var a={sheetPassword:i.value,sheetIndex:this.parent.activeSheetIndex};this.parent.open(a)}else if(n.password===i.value)e.hide(),this.unProtectSheetPassword();else{var o=this.parent.createElement("span",{className:"e-unprotectsheetpwd-alert-span"});o.innerText=r.getConstant("UnprotectPasswordAlert"),this.parent.element.querySelector(".e-unprotectworksheet-dlg").querySelector(".e-dlg-content").appendChild(o)}},e.prototype.unProtectSheetPassword=function(){var e=this.parent.getActiveSheet(),t=this.parent.activeSheetIndex;this.parent.setSheetPropertyOnMute(e,"isProtected",!e.isProtected),this.parent.setSheetPropertyOnMute(e,"password","");var r=!e.isProtected;this.parent.notify(fi,{isActive:r,id:this.parent.element.id+"_protect",sheetIndex:t,triggerEvent:!0}),this.parent.allowOpen&&this.parent.openModule.isImportedFile&&-1===this.parent.openModule.unProtectSheetIdx.indexOf(t)&&this.parent.openModule.unProtectSheetIdx.push(t)},e.prototype.importProtectWorkbook=function(e){var t=this,r=this.parent.serviceLocator.getService(Na),n=this.parent.serviceLocator.getService(Fa);n.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-importprotectworkbook-dlg",header:r.getConstant("UnprotectWorkbook"),beforeOpen:function(r){var i={dialogName:"ImportProtectWorkbook",element:r.element,target:r.target,cancel:r.cancel};t.parent.trigger("dialogBeforeOpen",i),i.cancel?r.cancel=!0:(n.dialogInstance.content=t.importProtectPasswordContent(e),n.dialogInstance.dataBind(),or(t.parent.element))},buttons:[{buttonModel:{content:r.getConstant("Ok"),isPrimary:!0,disabled:!0},click:function(){t.alertMessage(),t.importOkClick(e)}}]})},e.prototype.importProtectPasswordContent=function(e){var t=this.parent.serviceLocator.getService(Na),r=this.parent.createElement("div",{className:"e-importprotectpwd-dialog"}),n=this.parent.createElement("div",{className:"e-importprotectpwd-content"}),i=this.parent.createElement("span",{className:"e-header"});i.innerText='"'+e.file.name+'" '+t.getConstant("IsProtected");var a=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}});return a.setAttribute("placeholder",t.getConstant("EnterThePassword")),n.appendChild(i),n.appendChild(a),r.appendChild(n),r},e.prototype.importOkClick=function(e){var t=this.parent.element.querySelector(".e-importprotectpwd-dialog").getElementsByClassName("e-importprotectpwd-content")[0].querySelector(".e-input");this.parent.password=t.value;var r={file:e.file,password:t.value};this.parent.open(r)},e.prototype.toggleProtect=function(){var e,t=this.parent.element.id,r=this.parent.getActiveSheet();r.isProtected&&this.parent.allowOpen&&r.isImportProtected&&this.parent.openModule.isImportedFile&&-1===this.parent.openModule.unProtectSheetIdx.indexOf(this.parent.activeSheetIndex)?this.unProtectsheet(!0):r.password&&r.password.length>0?this.unProtectsheet():(this.parent.setSheetPropertyOnMute(r,"isProtected",!r.isProtected),e=!r.isProtected,this.parent.notify(fi,{isActive:e,id:t+"_protect",sheetIndex:this.parent.activeSheetIndex,triggerEvent:!0}))},e.prototype.getModuleName=function(){return"protectSheet"},e}(),po=function(){function e(e){this.shortValue="",this.divElements=[],this.paraElements=[],this.inputElements=[],this.textBoxElements=[],this.dropDownListElements=[],this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on(mi,this.renderFindDlg,this),this.parent.on(gi,this.renderGotoDlg,this),this.parent.on(dn,this.gotoHandler,this),this.parent.on("findHandler",this.findHandler,this),this.parent.on("showFindAlert",this.showFindAlert,this),this.parent.on("replaceAllDialog",this.replaceAllDialog,this),this.parent.on("findKeyUp",this.findKeyUp,this),this.parent.on("findToolDlg",this.findToolDlg,this),this.parent.on("activeSheetChanged",this.refreshFindDlg,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(mi,this.renderFindDlg),this.parent.off(gi,this.renderGotoDlg),this.parent.off(dn,this.gotoHandler),this.parent.off("findHandler",this.findHandler),this.parent.off("showFindAlert",this.showFindAlert),this.parent.off("replaceAllDialog",this.replaceAllDialog),this.parent.off("findKeyUp",this.findKeyUp),this.parent.off("findToolDlg",this.findToolDlg),this.parent.off("activeSheetChanged",this.refreshFindDlg))},e.prototype.findToolDlg=function(e){var r=this,a=function(n){var i=r.parent.showRibbon&&r.parent.element.querySelector(".e-ribbon");if(i){var a=e.event&&e.event.target?t.closest(e.event.target,"#"+r.parent.element.id+"_findbtn"):t.select("#"+r.parent.element.id+"_findbtn",i);a&&(n?a.classList.add("e-disabled"):a.classList.remove("e-disabled"),a.disabled=n)}},o=e.dialogEle||this.parent.element.getElementsByClassName("e-findtool-dlg")[0];e.isPublic&&(this.findValue=e.findValue);var s,l,d,h=this.parent.getActiveSheet(),p=function(e){if(l&&(!h.isProtected||h.protectSettings.selectCells||h.protectSettings.selectUnLockedCells)){var t=l.value;if(e&&13===e.keyCode)l.value&&"0 of 0"!==d.textContent&&(r.parent.notify("findHandler",{findOption:e.shiftKey?"prev":"next"}),r.updateCount(d,e.shiftKey));else{var n=void 0;if(""===t)d.textContent="0 of 0",n=!1;else{var i={value:t,mode:"Sheet",isCSen:!1,sheetIndex:r.parent.activeSheetIndex,isEMatch:!1,searchBy:"By Row"};r.parent.notify("count",i),d.textContent=i.findCount,n="0 of 0"!==i.findCount}s.enableItems(1,n),s.enableItems(2,n)}}};if(o)if(e.isPublic||e.refreshPosition){if(e.isPublic&&((l=o.querySelector(".e-text-findNext-short")).value=this.findValue,d=o.querySelector(".e-input-group-icon"),s=t.getComponent(o.querySelector(".e-find-toolbar"),"toolbar"),p()),e.refreshPosition){var c=void 0;if(this.parent.getActiveSheet().showHeaders){var u=this.parent.getColumnHeaderContent().parentElement;c=(u&&u.offsetHeight||30)+1}else c=1;o.style.top=c+"px"}}else a(!0),this.findDialog.hide();else{var f=this.parent.createElement("div",{className:"e-input-group"});l=this.parent.createElement("input",{className:"e-input e-text-findNext-short",attrs:{type:"Text"}}),this.findValue&&(l.value=this.findValue);var g=this.parent.serviceLocator.getService(Na);l.setAttribute("placeholder",g.getConstant("FindValue")),d=this.parent.createElement("span",{className:"e-input-group-icon"});var m,v=h.usedRange.rowIndex*h.usedRange.colIndex>100;l.onkeyup=function(e){v?(m&&clearTimeout(m),m=setTimeout(p.bind(r,e),500)):p(e)},f.appendChild(l),f.appendChild(d);var y=[{type:"Input",template:f},{prefixIcon:"e-icons e-prev-icon",tooltipText:g.getConstant("FindPreviousBtn"),type:"Button",cssClass:"e-findRib-prev",disabled:!0},{prefixIcon:"e-icons e-next-icon",tooltipText:g.getConstant("FindNextBtn"),type:"Button",cssClass:"e-findRib-next",disabled:!0},{type:"Separator"},{prefixIcon:"e-icons e-option-icon",tooltipText:g.getConstant("MoreOptions"),type:"Button",cssClass:"e-findRib-more"},{prefixIcon:"e-icons e-close",tooltipText:g.getConstant("Close"),type:"Button",cssClass:"e-findRib-close"}];s=new i.Toolbar({clicked:function(e){"e-findRib-next"===e.item.cssClass?(r.parent.notify("findHandler",{findOption:"next"}),r.updateCount(d)):"e-findRib-prev"===e.item.cssClass?(r.parent.notify("findHandler",{findOption:"prev"}),r.updateCount(d,!0)):"e-findRib-more"===e.item.cssClass&&(r.findDialog.animationSettings.effect="None",r.findDialog.setProperties({animationSettings:r.findDialog.animationSettings},!0),r.renderFindDlg(),r.findDialog.hide())},width:"auto",height:"auto",items:y,cssClass:"e-find-toolObj",created:function(){s.element.querySelectorAll(".e-toolbar-item .e-tbar-btn").forEach(function(e){return e.removeAttribute("tabindex")})}});var C=this.parent.createElement("div",{className:"e-find-toolbar",attrs:{tabindex:"-1"}});s.createElement=this.parent.createElement,s.appendTo(C),o=this.parent.createElement("div",{className:"e-dlg-div",attrs:{"aria-label":g.getConstant("FindValue")}});var b=this.parent.element.getElementsByClassName("e-sheet-panel")[0],x={cssClass:"e-findtool-dlg",visible:!1,enableRtl:this.parent.enableRtl,target:b,open:function(){if(t.EventHandler.add(document,"click",r.closeDialog,r),r.findValue&&(!h.isProtected||h.protectSettings.selectCells||h.protectSettings.selectUnLockedCells)){var e={value:r.findValue,mode:"Sheet",isCSen:!1,sheetIndex:r.parent.activeSheetIndex,isEMatch:!1,searchBy:"By Row"};r.parent.notify("count",e),d.textContent=e.findCount;var n="0 of 0"!==e.findCount;s.enableItems(1,n),s.enableItems(2,n)}else d.textContent="0 of 0";a(!1);var i=s.element.querySelector(".e-input-group");i&&i.addEventListener("focus",function(){var e=s.element.querySelector(".e-text-findNext-short");or(e),e.classList.add("e-input-focus"),e.setSelectionRange(0,e.value.length)}),S&&r.findDialog.setProperties({animationSettings:S},!0)},beforeOpen:function(){return or(r.parent.element)},beforeClose:function(){r.findValue=l.value||null,s.destroy(),t.EventHandler.remove(document,"click",r.closeDialog)},close:function(){r.findDialog.destroy(),r.findDialog=null,t.detach(o),b.style.position="",or(r.parent.element),a(!1)},created:function(){b.style.position="relative",o.style.width=r.parent.getMainContent().offsetWidth+"px",o.style.visibility="hidden",o.style.display="block",r.findDialog.width=2*parseInt(getComputedStyle(o).borderLeftWidth,10)+o.querySelector(".e-toolbar-items").getBoundingClientRect().width+"px",o.style.display="",o.style.width="",o.style.visibility="",o.style.top=(e&&e.headerHgt||r.parent.getColumnHeaderContent().parentElement.offsetHeight+1)+"px",o.style.left="",o.style[r.parent.enableRtl?"left":"right"]=r.parent.sheetModule.getScrollSize()+"px",r.findDialog.show()}};t.Browser.isDevice?(x.header=C,x.allowDragging=!0):x.content=C,this.findDialog=new n.Dialog(x),this.findDialog.createElement=this.parent.createElement;var S;e&&e.isPublic&&(S={effect:this.findDialog.animationSettings.effect},this.findDialog.setProperties({animationSettings:{effect:"None"}},!0)),this.findDialog.appendTo(o)}},e.prototype.refreshFindDlg=function(){var e=this.findDialog&&this.parent.element.getElementsByClassName("e-findtool-dlg")[0];if(e){var t=e.querySelector(".e-text-findNext-short");this.findToolDlg({findValue:t.value,isPublic:!0,refreshPosition:!0,dialogEle:e})}},e.prototype.updateCount=function(e,t){var r,n=e.textContent.split(" ");t?(r=Number(n[0])-1)<1&&(r=Number(n[2])):(r=Number(n[0])+1)>Number(n[2])&&(r=1),n[0]=r.toString(),e.textContent=n.join(" ")},e.prototype.closeDialog=function(e){!t.closest(e.target,".e-findRib-close")&&t.closest(e.target,".e-spreadsheet")||!this.findDialog||this.findToolDlg({})},e.prototype.renderFindDlg=function(){var e=this,r=this.parent.serviceLocator.getService(Fa);if(this.parent.element.querySelector(".e-find-dlg"))r.hide();else{var n=this.parent.serviceLocator.getService(Na),i={isModal:!1,showCloseIcon:!0,cssClass:"e-find-dlg",header:n.getConstant("FindAndReplace"),beforeOpen:function(t){var n={dialogName:"FindAndReplaceDialog",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",n),n.cancel?t.cancel=!0:(r.dialogInstance.content=e.findandreplaceContent(),r.dialogInstance.dataBind(),or(e.parent.element))},buttons:[{buttonModel:{content:n.getConstant("FindPreviousBtn"),isPrimary:!0,cssClass:"e-btn-findPrevious",disabled:!0},click:function(t){e.dialogMessage(),e.findHandler({findOption:t&&13===t.keyCode?"next":"prev"})}},{buttonModel:{content:n.getConstant("FindNextBtn"),isPrimary:!0,cssClass:"e-btn-findNext",disabled:!0},click:function(){e.dialogMessage(),e.findHandler({findOption:"next"})}},{buttonModel:{content:n.getConstant("ReplaceBtn"),isPrimary:!0,cssClass:"e-btn-replace",disabled:!0},click:function(){e.dialogMessage(),e.replaceHandler(hn)}},{buttonModel:{content:n.getConstant("ReplaceAllBtn"),isPrimary:!0,cssClass:"e-btn-replaceAll",disabled:!0},click:function(){e.dialogMessage(),e.replaceHandler(pn)}}],open:function(){var r=e.parent.element.querySelector(".e-text-findNext");if(r.value){var n=e.parent.element.querySelector(".e-btn-findPrevious");t.getComponent(n,"btn").disabled=!1,t.getComponent(e.parent.element.querySelector(".e-btn-findNext"),"btn").disabled=!1}ft(function(){or(r)})},beforeClose:this.dialogBeforeClose.bind(this)};r.show(i)}},e.prototype.dialogBeforeClose=function(){var e=this.checkBoxElements;e&&e.element&&(e.destroy(),e.element.remove()),this.checkBoxElements=null,this.textBoxElements.forEach(function(e){e&&e.element&&(e.destroy(),e.element.remove())}),this.textBoxElements=[],this.dropDownListElements.forEach(function(e){e&&e.element&&(e.destroy(),e.element.remove())}),this.dropDownListElements=[],br(this.paraElements),this.paraElements=[],br(this.inputElements),this.inputElements=[],br(this.divElements),this.divElements=[]},e.prototype.dialogMessage=function(){this.parent.element.querySelector(".e-replace-alert-span")?this.parent.element.querySelector(".e-replace-alert-span").remove():this.parent.element.querySelector(".e-find-alert-span")&&this.parent.element.querySelector(".e-find-alert-span").remove()},e.prototype.renderGotoDlg=function(){var e=this,r=this.parent.serviceLocator.getService(Na),n=this.parent.serviceLocator.getService(Fa);if(t.isNullOrUndefined(this.parent.element.querySelector(".e-goto-dlg"))){var i={width:300,isModal:!1,showCloseIcon:!0,cssClass:"e-goto-dlg",header:r.getConstant("GotoHeader"),beforeOpen:function(t){var r={dialogName:"GoToDialog",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",r),r.cancel?t.cancel=!0:(n.dialogInstance.content=e.GotoContent(),n.dialogInstance.dataBind(),or(e.parent.element))},buttons:[{buttonModel:{content:r.getConstant("Ok"),isPrimary:!0,cssClass:"e-btn-goto-ok"},click:function(){e.gotoHandler()&&n.hide()}}],open:function(){e.textFocus()}};n.show(i,!1)}else n.hide()},e.prototype.textFocus=function(){var e=this;this.parent.element.querySelector(".e-text-goto").addEventListener("focus",function(){e.parent.element.querySelector(".e-goto-alert-span")&&e.parent.element.querySelector(".e-goto-alert-span").remove()})},e.prototype.findHandler=function(e){var r=this.parent.element.querySelector(".e-text-findNext");r||(r=this.parent.element.querySelector(".e-text-findNext-short"))||this.gotoAlert();var n=r.value;if(""!==r.value){var i=this.parent.getActiveSheet();if(i.isProtected&&!i.protectSettings.selectCells&&!i.protectSettings.selectUnLockedCells)return;var a=this.parent.activeSheetIndex,o=this.parent.element.querySelector(".e-findnreplace-checkcase"),s=void 0;s=!!o&&t.getComponent(o,"checkbox").checked;var l=this.parent.element.querySelector(".e-findnreplace-checkmatch"),d=void 0;d=!!l&&t.getComponent(l,"checkbox").checked;var h=this.parent.element.querySelector(".e-findnreplace-searchby"),p=void 0;p=h?t.getComponent(h,"dropdownlist").value.toString():"By Row";var c=this.parent.element.querySelector(".e-findnreplace-searchwithin"),u=void 0;u=c?t.getComponent(c,"dropdownlist").value.toString():"Sheet";var f={value:n,sheetIndex:a,findOpt:e.findOption,mode:u,isCSen:s,isEMatch:d,searchBy:p,isAction:!0};this.parent.find(f)}},e.prototype.replaceHandler=function(e){var t=this.parent.element.querySelector(".e-find-dlg").querySelector(".e-text-findNext").value,r=this.parent.element.querySelector(".e-text-replaceInp").value,n=this.parent.element.querySelector(".e-findnreplace-checkcase").checked,i=this.parent.element.querySelector(".e-findnreplace-checkmatch").checked,a=this.parent.element.querySelector(".e-search-within .e-ddl-hidden").value,o=this.parent.element.querySelector(".e-searchby .e-ddl-hidden").value;this.parent.notify(e,{value:t,mode:a,isCSen:n,isEMatch:i,searchBy:o,findOpt:"next",replaceValue:r,replaceBy:e,sheetIndex:this.parent.activeSheetIndex,isAction:!0})},e.prototype.gotoHandler=function(e){var t=!0;if(e)this.parent.goTo(e.address);else{for(var r=this.parent.element.querySelector(".e-text-goto").value,n=0;n<this.parent.definedNames.length;n++)if(this.parent.definedNames[n].name===r){r=this.parent.definedNames[n].refersTo.slice(1);break}var i=r;r.includes("!")&&(i=r.substring(r.lastIndexOf("!")+1)),(i=i.split("$").join("")).includes(":")&&(i=i.split(":")[0]);var a=i.match(/\d+/),o=i.match(/[A-Z]+/i);if(a&&o&&0===o.index){var s=w(c(i)),l=this.parent.getActiveSheet();s[2]>=1048576||s[3]>=16384?(this.gotoAlert(),t=!1):this.parent.scrollSettings.isFinite&&(l.rowCount<s[2]+1||l.colCount<s[3]+1)?(this.parent.notify("finiteAlert",null),t=!1):this.parent.goTo(r)}else this.gotoAlert(),t=!1}return t},e.prototype.gotoAlert=function(){var e=this.parent.serviceLocator.getService(Na),t=this.parent.createElement("span",{className:"e-goto-alert-span"});t.innerText=e.getConstant("InsertingEmptyValue"),this.parent.element.querySelector(".e-goto-alert-span")&&this.parent.element.querySelector(".e-goto-alert-span").remove(),this.parent.element.querySelector(".e-goto-dlg").querySelector(".e-dlg-content").appendChild(t)},e.prototype.showFindAlert=function(){this.parent.element.querySelector(".e-replace-alert-span")&&this.parent.element.querySelector(".e-replace-alert-span").remove();var e=this.parent.element.querySelector(".e-find-dlg .e-dlg-content");if(e){var t=this.parent.createElement("span",{className:"e-find-alert-span"});t.innerText=this.parent.serviceLocator.getService(Na).getConstant("NoElements"),e.appendChild(t)}},e.prototype.replaceAllDialog=function(e){this.parent.element.querySelector(".e-find-alert-span")&&this.parent.element.querySelector(".e-find-alert-span").remove();var t=this.parent.element.querySelector(".e-replace-alert-span");t&&t.remove();var r=this.parent.serviceLocator.getService(Na),n=this.parent.createElement("span",{className:"e-replace-alert-span"});n.innerText=e.count+r.getConstant("ReplaceAllEnd")+e.replaceValue,this.parent.element.querySelector(".e-find-dlg")&&this.parent.element.querySelector(".e-find-dlg").querySelector(".e-dlg-content").appendChild(n)},e.prototype.findKeyUp=function(e){if(e.target.classList.contains("e-text-findNext")){var r=this.parent.element.querySelector(".e-text-findNext").value;if(t.isNullOrUndefined(r)||""===r)t.getComponent(this.parent.element.querySelector(".e-btn-findPrevious"),"btn").disabled=!0,t.getComponent(this.parent.element.querySelector(".e-btn-findNext"),"btn").disabled=!0,this.dialogMessage();else{var n=this.parent.element.querySelector(".e-btn-findPrevious");t.getComponent(n,"btn").disabled=!1,t.getComponent(this.parent.element.querySelector(".e-btn-findNext"),"btn").disabled=!1}}var i=this.parent.element.querySelector(".e-text-findNext").value,a=this.parent.element.querySelector(".e-text-replaceInp").value;t.isNullOrUndefined(i)||t.isNullOrUndefined(a)||""===i||""===a?(t.getComponent(this.parent.element.querySelector(".e-btn-replace"),"btn").disabled=!0,t.getComponent(this.parent.element.querySelector(".e-btn-replaceAll"),"btn").disabled=!0):this.parent.getActiveSheet().isProtected||(t.getComponent(this.parent.element.querySelector(".e-btn-replace"),"btn").disabled=!1,t.getComponent(this.parent.element.querySelector(".e-btn-replaceAll"),"btn").disabled=!1)},e.prototype.findandreplaceContent=function(){this.parent.element.querySelector(".e-text-findNext-short")&&(this.shortValue=this.parent.element.querySelector(".e-text-findNext-short").value);var e=this.parent.createElement("div",{className:"e-link-dialog"}),t=this.parent.createElement("div",{className:"e-find"}),r=this.parent.createElement("div",{className:"e-findCheck"});this.divElements.push(e),this.divElements.push(t),this.divElements.push(r);var n=this.parent.serviceLocator.getService(Na);e.appendChild(t);var i=this.parent.createElement("div",{className:"e-cont"}),l=this.parent.createElement("p",{className:"e-header"});l.innerText=n.getConstant("FindWhat");var d=this.parent.createElement("input",{className:"e-input e-text-findNext",attrs:{type:"Text",placeholder:n.getConstant("FindValue"),value:this.shortValue}});this.divElements.push(i),this.paraElements.push(l),this.inputElements.push(d),i.appendChild(d),i.insertBefore(l,d),t.appendChild(i);var h=new a.TextBox({width:"70%"});this.textBoxElements.push(h),h.createElement=this.parent.createElement,h.appendTo(d);var p=this.parent.createElement("div",{className:"e-cont"}),c=this.parent.createElement("p",{className:"e-header"});c.innerText=n.getConstant("ReplaceWith");var u=this.parent.createElement("input",{className:"e-input e-text-replaceInp",attrs:{type:"Text",placeholder:n.getConstant("ReplaceValue")}});this.divElements.push(p),this.paraElements.push(c),this.inputElements.push(u),p.appendChild(u),p.insertBefore(c,u),t.appendChild(p);var f=new a.TextBox({width:"70%"});this.textBoxElements.push(f),f.createElement=this.parent.createElement,f.appendTo(u);var g=[{Id:"Sheet",Within:n.getConstant("Sheet")},{Id:"Workbook",Within:n.getConstant("Workbook")}],m=new s.DropDownList({dataSource:g,cssClass:"e-search-within",fields:{value:"Id",text:"Within"},width:"50%",index:0});this.dropDownListElements.push(m);var v=n.getConstant("SearchWithin"),y=this.parent.createElement("input",{className:"e-findnreplace-searchwithin",attrs:{type:"select",label:v}}),C=this.parent.createElement("p",{className:"e-header"});C.innerText=v,this.inputElements.push(y),this.paraElements.push(C),t.appendChild(C),t.appendChild(y),m.createElement=this.parent.createElement,m.appendTo(y);var b=[{Id:"By Row",Search:n.getConstant("ByRow")},{Id:"By Column",Search:n.getConstant("ByColumn")}],x=new s.DropDownList({dataSource:b,cssClass:"e-searchby",fields:{value:"Id",text:"Search"},width:"50%",index:0});this.dropDownListElements.push(x),v=n.getConstant("SearchBy");var S=this.parent.createElement("input",{className:"e-findnreplace-searchby",attrs:{type:"select",label:v}}),w=this.parent.createElement("p",{className:"e-header"});w.innerText=v,this.inputElements.push(S),this.paraElements.push(w),t.appendChild(w),t.appendChild(S),x.createElement=this.parent.createElement,x.appendTo(S);var I=new o.CheckBox({label:n.getConstant("MatchCase"),checked:!1,cssClass:"e-findnreplace-casecheckbox"}),E=this.parent.createElement("input",{className:"e-findnreplace-checkcase",attrs:{type:"checkbox"}});this.inputElements.push(E),r.appendChild(E),I.createElement=this.parent.createElement,I.appendTo(E);var R=new o.CheckBox({label:n.getConstant("MatchExactCellElements"),checked:!1,cssClass:"e-findnreplace-exactmatchcheckbox"});this.checkBoxElements=R;var N=this.parent.createElement("input",{className:"e-findnreplace-checkmatch",attrs:{type:"checkbox"}});return this.inputElements.push(N),r.appendChild(N),R.createElement=this.parent.createElement,R.appendTo(N),t.appendChild(r),e},e.prototype.GotoContent=function(){var e=this.parent.serviceLocator.getService(Na),t=this.parent.createElement("div",{className:"e-link-dialog"}),r=this.parent.createElement("div",{className:"e-goto"});t.appendChild(r);var n=this.parent.createElement("div",{className:"e-cont"}),i=this.parent.createElement("p",{className:"e-header"});i.innerText=e.getConstant("Reference");var o=new a.TextBox({placeholder:e.getConstant("EnterCellAddress")}),s=this.parent.createElement("input",{className:"e-text-goto",attrs:{type:"Text"}});return n.appendChild(s),n.insertBefore(i,s),r.appendChild(n),o.createElement=this.parent.createElement,o.appendTo(s),t},e.prototype.destroy=function(){this.removeEventListener(),this.findDialog&&this.findDialog.hide(),this.parent=null},e.prototype.getModuleName=function(){return"findAndReplace"},e}(),co=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.merge=function(e){this.parent.serviceLocator.getService("cell").refresh(e.rowIdx,e.colIdx,e.lastCell,e.element,!1,!1,re(this.parent))},e.prototype.hideHandler=function(e){var t=this.parent.getActiveSheet(),r={range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]};this.parent.notify(mn,r),r.range=r.range;var n=He(r.range[0],r.range[1],t)||{},i="row"===e.model?r.range[0]:r.range[1],a=i+((n[e.model+"Span"]||1)-1);if(!(!e.isEnd&&(e.start===i||ht(t,i))||e.isEnd&&e.start>i&&!ht(t,i))&&n[e.model+"Span"]>1&&a>=e.start)if("row"===e.model?tt(t,i):ht(t,i)){if(e.colIdx<=a){var o=j(t,r.range[1],!0,"columns");if(o<=a){l=r.range[0];n.rowSpan>1&&(l=(l=j(t,r.range[0],!0))<=r.range[2]?l:r.range[0]);var s=this.parent.getCell(l,o);s&&(s.style.display="",this.parent.serviceLocator.getService("cell").refresh(r.range[0],r.range[1],!0,s,!0,!0))}}}else{var l=n.rowSpan>1?j(t,r.range[0],!0):r.range[0];this.merge({rowIdx:r.range[0],colIdx:r.range[1],element:this.parent.getCell(l,r.range[1])})}},e.prototype.checkPrevMerge=function(e){var t,r,n,i,a,o=this,s=this.parent.getActiveSheet(),l=function(){var t=o.parent.getContentTable(),n=t&&t.rows[0];if(n){var i=parseInt(n.getAttribute("aria-rowindex"),10)-1;if(r.range=r.range,i>o.parent.viewport.topIndex+o.parent.frozenRowCount(s)&&i>r.range[0]&&i<=r.range[2]){var a=void 0,l=o.parent.getRowHeaderTable(),d=l&&l.rows[0],h=o.parent.frozenColCount(s);if(h&&!d)return;for(var p=e.colIdx;p<=r.range[3];p++)(a=o.parent.getCell(i,p,p<h?d:n))&&(a.colSpan>1||a.rowSpan>1)&&(a.style.display="none",a.removeAttribute("colSpan"),a.removeAttribute("rowSpan"))}}},d=function(d){if(r.range=r.range,tt(s,r.range[0])&&e.rowIdx>=r.range[0]&&e.rowIdx<=r.range[2]){i=!1;for(p=r.range[0];p<e.rowIdx;p++)if(!tt(s,p)){i=!0;break}if(t.rowSpan>1&&!i){var h=t.rowSpan-o.parent.hiddenCount(r.range[0],r.range[2]);h>0&&(l(),e.td.style.display="",e.colSpan=n,e.rowSpan=h,e.cell=t,e.isMerged=!1)}}else if(d){for(var p=r.range[0];a&&p<e.rowIdx;p++)if(!tt(s,p)){i=!0;break}i||(l(),e.td.style.display="",e.colSpan=n,e.cell=t,e.isMerged=!1)}};if(e.cell.colSpan<0){if(e.colIdx-1>-1&&ht(s,e.colIdx-1)&&(t=He(e.rowIdx,e.colIdx-1,s,!1,!0),a=e.rowIdx-1>-1&&tt(s,e.rowIdx-1),(void 0!==t.colSpan||void 0!==t.rowSpan)&&(void 0===t.rowSpan||t.rowSpan>1||a)&&(r={range:[e.rowIdx,e.colIdx-1,e.rowIdx,e.colIdx-1]},this.parent.notify(mn,r),r.range=r.range,t=He(r.range[0],r.range[1],s,!1,!0),ht(s,r.range[1])&&e.colIdx>=r.range[1]&&e.colIdx<=r.range[3]))){for(var h=r.range[1];h<e.colIdx;h++)if(!ht(s,h)){i=!0;break}t.colSpan>1&&!i&&(n=t.colSpan-this.parent.hiddenCount(r.range[1],r.range[3],"columns"))>0&&d(!0)}}else e.rowIdx-1>-1&&tt(s,e.rowIdx-1)&&void 0!==(t=He(e.rowIdx-1,e.colIdx,s,!1,!0)).rowSpan&&(r={range:[e.rowIdx-1,e.colIdx,e.rowIdx-1,e.colIdx]},this.parent.notify(mn,r),r.range=r.range,t=He(r.range[0],r.range[1],s,!1,!0),d())},e.prototype.checkMerge=function(e){var t,r=this.parent.getActiveSheet(),n=He(e.rowIdx,e.colIdx,r)||{};if(e.isRow){if(void 0===n.colSpan||ht(r,e.colIdx-1)){if(t={range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]},t.range=t.range,this.parent.notify(mn,t),ht(r,e.colIdx-1)&&!ht(r,t.range[1])||e.isFreezePane&&t.range[0]<this.parent.frozenRowCount(r))return void(e.insideFreezePane=t.range[0]<this.parent.frozenRowCount(r));if(e.colIdx!==this.parent.viewport.leftIndex+this.parent.frozenColCount(r)&&ht(r,e.colIdx-1))for(var i=t.range[1];void 0!==n.colSpan&&i<e.colIdx;i++)if(!ht(r,i))return;n=He(t.range[0],t.range[1],r),(o=t.range[2]-e.rowIdx+1-this.parent.hiddenCount(e.rowIdx,t.range[2]))>=1&&(this.merge({rowIdx:t.range[0],colIdx:t.range[1],element:e.td}),1===o?e.td.removeAttribute("rowspan"):e.td.rowSpan=o,e.td.style.display="")}}else if(void 0===n.rowSpan||tt(r,e.rowIdx-1)){if(t={range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]},t.range=t.range,this.parent.notify(mn,t),tt(r,e.rowIdx-1)&&!tt(r,t.range[0])||e.isFreezePane&&t.range[1]<this.parent.frozenColCount(r))return void(e.insideFreezePane=t.range[1]<this.parent.frozenColCount(r));if(e.rowIdx!==this.parent.viewport.topIndex+this.parent.frozenRowCount(r)&&tt(r,e.rowIdx-1))for(var a=t.range[0];void 0!==n.rowSpan&&a<e.rowIdx;a++)if(!tt(r,a))return;n=He(t.range[0],t.range[1],r);var o=t.range[3]-e.colIdx+1-this.parent.hiddenCount(e.colIdx,t.range[3],"columns");o>=1&&(this.merge({rowIdx:t.range[0],colIdx:t.range[1],element:e.td}),1===o?e.td.removeAttribute("colspan"):e.td.colSpan=o,e.td.style.display="")}},e.prototype.addEventListener=function(){this.parent.on("applyMerge",this.merge,this),this.parent.on("hiddenMerge",this.hideHandler,this),this.parent.on("checkPrevMerge",this.checkPrevMerge,this),this.parent.on("checkMerge",this.checkMerge,this)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("applyMerge",this.merge),this.parent.off("hiddenMerge",this.hideHandler),this.parent.off("checkPrevMerge",this.checkPrevMerge),this.parent.off("checkMerge",this.checkMerge))},e.prototype.getModuleName=function(){return"merge"},e}(),uo=function(){function e(e){this.divElements=[],this.spanElements=[],this.inputElements=[],this.dropDownListElements=[],this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.dupData&&(this.dupData=[]),this.colorData&&(this.colorData=[]),this.parent=null},e.prototype.addEventListener=function(){this.parent.on(Cn,this.applyCF,this),this.parent.on("renderCFDlg",this.renderCFDlg,this),this.parent.on("clearCF",this.clearCF,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Cn,this.applyCF),this.parent.off("renderCFDlg",this.renderCFDlg),this.parent.off("clearCF",this.clearCF))},e.prototype.clearCF=function(e){var r=this,n=this.parent.getActiveSheet(),i=function(e,n,i,a){t.removeClass([a],["e-redft","e-yellowft","e-greenft","e-redf","e-redt","e-iconset"]);var o,s;["backgroundColor","color"].forEach(function(t){a.style[""+t]&&(a.style[""+t]="",(o=i&&i.style&&i.style[""+t]||r.parent.commonCellStyle[""+t])&&((s={})[""+t]=o,r.parent.notify(Xr,{style:s,rowIdx:e,colIdx:n,td:a})))});var l;[".e-cf-databar",".e-iconsetspan"].forEach(function(e){l=a.querySelector(e);var t=a.querySelector(".e-wrap-content");l&&(t?t.removeChild(l):a.removeChild(l),a.textContent=r.parent.getDisplayText(i))})};this.updateRange(n,e.indexes,this.parent.frozenRowCount(n),this.parent.frozenColCount(n),u(n.topLeftCell),i)},e.prototype.renderCFDlg=function(e){var t,r=this,n=this.parent.serviceLocator.getService(Na),i=this.parent.serviceLocator.getService(Fa);i.show({width:375,showCloseIcon:!0,isModal:!0,cssClass:"e-conditionalformatting-dlg",header:e.action.replace("...",""),beforeOpen:function(t){var n={dialogName:"ConditionalFormatDialog",element:t.element,target:t.target,cancel:t.cancel};r.parent.trigger("dialogBeforeOpen",n),n.cancel?t.cancel=!0:(i.dialogInstance.content=r.cfDlgContent(e.action),i.dialogInstance.dataBind(),or(r.parent.element))},beforeClose:this.dialogBeforeClose.bind(this),close:function(){t&&(r.parent.notify(yi,null),t=!1)},buttons:[{buttonModel:{content:n.getConstant("Ok"),isPrimary:!0},click:function(){var n=r.parent.getActiveSheet();oe(r.parent,w(c(n.selectedRange)))?t=!0:r.dlgClickHandler(e.action),i.hide()}}]})},e.prototype.dialogBeforeClose=function(){var e=this.numericTBElements;e&&e.element&&(e.destroy(),e.element.remove()),this.numericTBElements=null,this.dropDownListElements.forEach(function(e){e&&e.element&&(e.destroy(),e.element.remove())}),this.dropDownListElements=[],this.value1Inp&&(this.value1Inp.removeEventListener("input",this.validateCFInput.bind(this)),this.value1Inp.parentNode&&this.value1Inp.parentNode.removeChild(this.value1Inp),this.value1Inp=null),this.value2Inp&&(this.value2Inp.removeEventListener("input",this.validateCFInput.bind(this)),this.value2Inp.parentNode&&this.value2Inp.parentNode.removeChild(this.value2Inp),this.value2Inp=null),br(this.spanElements),this.spanElements=[],br(this.inputElements),this.inputElements=[],br(this.divElements),this.divElements=[]},e.prototype.dlgClickHandler=function(e){var t=this.parent.serviceLocator.getService(Na),r=this.parent.element.querySelector(".e-conditionalformatting-dlg .e-dlg-content .e-cf-dlg"),n={cFColor:this.getCFColor(r.querySelector(".e-cfsub .e-input").value),range:this.parent.getActiveSheet().selectedRange},i=r.querySelectorAll(".e-cfmain .e-input");if(e===t.getConstant("DuplicateValues")+"...")n.type=i[0].value===t.getConstant("Duplicate")?"Duplicate":"Unique";else{n.type=this.getType(e);var a=[];i[0]&&a.push(i[0].value),i[1]&&a.push(i[1].value),Q(a,this.parent),n.value=a.join(",")}this.parent.notify(yn,{cfModel:n,isAction:!0})},e.prototype.getType=function(e){var t,r=this.parent.serviceLocator.getService(Na);switch(e){case r.getConstant("GreaterThan")+"...":t="GreaterThan";break;case r.getConstant("LessThan")+"...":t="LessThan";break;case r.getConstant("Between")+"...":t="Between";break;case r.getConstant("CFEqualTo")+"...":t="EqualTo";break;case r.getConstant("TextThatContains")+"...":t="ContainsText";break;case r.getConstant("ADateOccuring")+"...":t="DateOccur";break;case r.getConstant("Top10Items")+"...":t="Top10Items";break;case r.getConstant("Bottom10Items")+"...":t="Bottom10Items";break;case r.getConstant("Top10")+" %...":t="Top10Percentage";break;case r.getConstant("Bottom10")+" %...":t="Bottom10Percentage";break;case r.getConstant("AboveAverage")+"...":t="AboveAverage";break;case r.getConstant("BelowAverage")+"...":t="BelowAverage"}return t},e.prototype.getCFColor=function(e){var t=this.parent.serviceLocator.getService(Na),r="RedFT";switch(e){case t.getConstant("LightRedFillWithDarkRedText"):r="RedFT";break;case t.getConstant("YellowFillWithDarkYellowText"):r="YellowFT";break;case t.getConstant("GreenFillWithDarkGreenText"):r="GreenFT";break;case t.getConstant("RedFill"):r="RedF";break;case t.getConstant("RedText"):r="RedT"}return r},e.prototype.cfDlgContent=function(e){var t=this.getDlgText(e),r=this.parent.serviceLocator.getService(Na),n=this.parent.createElement("div",{className:"e-cf-dlg"}),i=this.parent.createElement("div",{className:"e-cfmain"}),o=this.parent.createElement("div",{className:"e-cfsub"});this.divElements.push(n),this.divElements.push(i),this.divElements.push(o);var l=this.parent.createElement("span",{className:"e-header e-top-header"});l.innerText=t,this.value1Inp=this.parent.createElement("input",{className:"e-input",id:"valueInput",attrs:{type:"text","aria-label":t}});var d=this.parent.createElement("input",{className:"e-select"}),h=this.parent.createElement("span",{className:"e-header"});h.innerText=r.getConstant("With");var p=this.parent.createElement("input",{className:"e-select"});this.spanElements.push(l),this.inputElements.push(d),this.spanElements.push(h),this.inputElements.push(p),n.appendChild(i),n.appendChild(o),i.appendChild(l);var c;if(e!==r.getConstant("DuplicateValues")+"..."){if(e!==r.getConstant("AboveAverage")+"..."&&e!==r.getConstant("BelowAverage")+"..."){i.appendChild(this.value1Inp),c=!0;var u=e===r.getConstant("Top10")+" %..."||e===r.getConstant("Bottom10")+" %...";if(e===r.getConstant("Top10Items")+"..."||e===r.getConstant("Bottom10Items")+"..."||u){this.value1Inp.maxLength=u?3:4;var f=new a.NumericTextBox({value:10,min:1,max:u?100:1e3,format:"###"});this.numericTBElements=f,f.appendTo(this.value1Inp)}}}else{i.appendChild(d),this.dupData=[{text:r.getConstant("Duplicate"),id:"duplicate"},{text:r.getConstant("Unique"),id:"unique"}];var g=new s.DropDownList({dataSource:this.dupData,index:0,popupHeight:"200px"});this.dropDownListElements.push(g),g.appendTo(d)}if(e===r.getConstant("Between")+"..."){var m=this.parent.createElement("span",{className:"e-header e-header-2"});m.innerText=r.getConstant("And"),this.value2Inp=this.parent.createElement("input",{className:"e-input e-between"}),this.spanElements.push(m),i.appendChild(m),i.appendChild(this.value2Inp),this.value2Inp.addEventListener("input",this.validateCFInput.bind(this))}c&&(this.validateCFInput({target:this.value1Inp}),this.value1Inp.addEventListener("input",this.validateCFInput.bind(this))),o.appendChild(h),o.appendChild(p),this.colorData=[{text:r.getConstant("LightRedFillWithDarkRedText"),value:"redft",id:"redft"},{text:r.getConstant("YellowFillWithDarkYellowText"),id:"yellowft"},{text:r.getConstant("GreenFillWithDarkGreenText"),id:"greenft"},{text:r.getConstant("RedFill"),id:"redf"},{text:r.getConstant("RedText"),id:"redt"}];var v=new s.DropDownList({dataSource:this.colorData,index:0,popupHeight:"200px"});return this.dropDownListElements.push(v),v.appendTo(p),n},e.prototype.validateCFInput=function(e){var t=this.parent.serviceLocator.getService(Fa),r=e.target.value,n=t.dialogInstance.element.getElementsByClassName("e-primary")[0];r&&(e.target.classList.contains("e-between")||e.target.parentElement.querySelector(".e-between"))&&(r=e.target.parentElement.querySelector(e.target.classList.contains("e-between")?".e-input":".e-between").value),n.disabled=!r.trim()},e.prototype.checkCellHandler=function(e,t,r){return r.range.trim().split(",").some(function(r){var n=c(r.includes(":")?r:r+":"+r);return e>=n[0]&&e<=n[2]&&t>=n[1]&&t<=n[3]})},e.prototype.getDlgText=function(e){var t=this.parent.serviceLocator.getService(Na),r="";switch(e){case t.getConstant("GreaterThan")+"...":r=t.getConstant("FormatCellsGreaterThan");break;case t.getConstant("LessThan")+"...":r=t.getConstant("FormatCellsLessThan");break;case t.getConstant("Between")+"...":r=t.getConstant("FormatCellsBetween");break;case t.getConstant("CFEqualTo")+"...":r=t.getConstant("FormatCellsEqualTo");break;case t.getConstant("TextThatContains")+"...":r=t.getConstant("FormatCellsThatContainTheText");break;case t.getConstant("ADateOccuring")+"...":r=t.getConstant("FormatCellsThatContainADateOccurring");break;case t.getConstant("DuplicateValues")+"...":r=t.getConstant("FormatCellsDuplicate");break;case t.getConstant("Top10Items")+"...":case t.getConstant("Top10")+" %...":r=t.getConstant("FormatCellsTop");break;case t.getConstant("Bottom10Items")+"...":case t.getConstant("Bottom10")+" %...":r=t.getConstant("FormatCellsBottom");break;case t.getConstant("AboveAverage")+"...":r=t.getConstant("FormatCellsAbove");break;case t.getConstant("BelowAverage")+"...":r=t.getConstant("FormatCellsBelow")}return r},e.prototype.updateResult=function(e,r,n,i,a,o,s,l){var d,h,p,u,f,g={},m={},v=e.range.split(","),y=[];n?f=function(){if(fe(h)&&"Text"!==u){var e=parseFloat(h);e>=0?(void 0===y[0]||e>y[0])&&(y[0]=e):(void 0===y[1]||e<y[1])&&(y[1]=e)}}:i?f=function(){if(fe(h)&&"Text"!==u){var e=parseFloat(h);y.push(Number(e))}}:a?(y=[0,0],f=function(){fe(h)&&"Text"!==u&&(y[0]+=parseFloat(h),y[1]++)}):f=o?function(){fe(h)&&"Text"!==u&&y.push(parseFloat(h))}:s?function(){if(fe(h)&&"Text"!==u){var e=parseFloat(h);(void 0===y[0]||e<y[0])&&(y[0]=e),(void 0===y[1]||e>y[1])&&(y[1]=e)}}:function(){g[""+h]?""!==h&&(m[""+h]||(m[""+h]=!0,y.push(h))):g[""+h]=!0};for(var C=0;C<v.length;C++)for(var b=(d=c(v[C]))[0];b<=d[2];b++)for(var x=d[1];x<=d[3];x++)p=He(b,x,r,!1,!0),u="",t.isNullOrUndefined(p.value)?p.formula&&(this.parent.notify(Gr,{cell:p,rowIdx:b,colIdx:x,sheetIndex:this.parent.activeSheetIndex}),h=p.value.toString().toLowerCase(),u=$e(p.format),f()):(h=p.value.toString().toLowerCase(),u=$e(p.format),f());if(i||o){if(y=y.sort(function(e,t){return e-t}),e.type.includes("Bottom")||(y=y.reverse()),o){var S=parseFloat(l);e.type.includes("Percentage")&&(S=(S/=100/y.length)<1?1:S),y=y.slice(0,S)}}else a&&((y=[y[0]/y[1]])[0]||(y=[]));e.result=y},e.prototype.applyCF=function(e){var t=!e.cfModel,r=this.parent.getActiveSheet(),n=e.cfModel||r.conditionalFormats,i=[e.indexes];e.refreshAll&&(i=ee(this.parent,this.parent.viewport));for(var a={},o=n.length-1;o>=0;o--)(!t||(2===i[0].length?this.checkCellHandler(e.indexes[0],e.indexes[1],n[o]):J(i,n[o].range)))&&this.updateCF(e,r,n[o],a)},e.prototype.updateCF=function(e,r,n,i){var a,o=this,s="",l=!1;if(n.value){var d=[],h=[];if("Between"===n.type?(d=n.value.split('"').filter(function(e){return e.trim()&&","!==e.trim()})).length>1?(h=d,l=!0):h=n.value.split(",").filter(function(e){return!!e.trim()}):h=[n.value],h.length>1)if(h[0].split("(").length>1){for(var p="",f=0;f<h.length;f++)(p+=h[f]+",").split("(").length===p.split(")").length&&void 0===a&&(a=p.substring(0,p.length-1),p="");s=p.substring(0,p.length-1)}else{a=h[0];for(f=1;f<h.length;f++)s+=f+1===h.length?h[f]:h[f]+","}else a=h[0]||n.value}n.type||(n.type="GreaterThan");var m,v;n.format&&n.format.style?(m=Ve(n.format.style,!0),Object.keys(m).length||(v=n.cFColor)||(v=n.cFColor="RedFT")):(m={},(v=n.cFColor)||(v=n.cFColor="RedFT"));var y=n.type.includes("Average"),C=n.type.includes("10")&&fe(a),b=n.type.includes("Three")||n.type.includes("Four")||n.type.includes("Five"),x=n.type.includes("DataBar"),S=n.type.includes("ColorScale");e.isRender&&n.result||!("Duplicate"===n.type||"Unique"===n.type||x||S||y||C||b)||this.updateResult(n,r,x,S,y,C,b,a);var w=function(r,l,d,h,p,c){var u,f,y=d&&!t.isNullOrUndefined(d.value)?d.value.toString():"",C=!0,b=d?$e(d.format):"";switch(n.type){case"GreaterThan":case"LessThan":u=o.isGreaterThanLessThan(n,y,a,b);break;case"Between":u=fe(y)&&"Text"!==b&&o.isBetWeen(n,y,a,s,c);break;case"EqualTo":u=o.isEqualTo(n,y,a);break;case"ContainsText":u=y&&a&&o.isContainsText(y,a);break;case"DateOccur":f={value:a,cell:{},updatedVal:a},fe(a)||o.parent.notify(Zr,f),u=y===f.updatedVal;break;case"Unique":u=""!==y&&-1===n.result.indexOf(y.toLowerCase());break;case"Duplicate":u=n.result.indexOf(y.toLowerCase())>-1;break;case"Top10Items":case"Bottom10Items":case"Top10Percentage":case"Bottom10Percentage":if(n.result){w=parseFloat(y);ue(y)&&(w=ce(y)),u=n.result.indexOf(w)>-1}break;case"AboveAverage":u=n.result.length&&fe(y)&&"Text"!==b&&parseFloat(y)>n.result[0];break;case"BelowAverage":u=n.result.length&&fe(y)&&"Text"!==b&&parseFloat(y)<n.result[0];break;default:if(C=!1,x)i[r+"_"+l+"_bars"]||(i[r+"_"+l+"_bars"]=!0,o.applyDataBars(y,n,h,r,b,p));else if(S){if(!i[r+"_"+l]){var w=fe(y)?parseFloat(y):NaN;if(isNaN(w)){if(h.style.backgroundColor&&!h.classList.contains("e-yellowft")&&!h.classList.contains("e-greenft")&&!h.classList.value.includes("e-redf")){h.style.backgroundColor="";var I=t.extend({},o.parent.commonCellStyle,d&&d.style);I.backgroundColor&&o.parent.notify(Xr,{style:{backgroundColor:I.backgroundColor},td:h,rowIdx:r,colIdx:l})}}else{var E=n.result,R=E.indexOf(w);if(-1===R){if(h.style.backgroundColor){h.style.backgroundColor="";var N=t.extend({},o.parent.commonCellStyle,d&&d.style);N.backgroundColor&&o.parent.notify(Xr,{style:{backgroundColor:N.backgroundColor},td:h,rowIdx:r,colIdx:l})}}else{var F=o.getColor(n.type);h.style.backgroundColor=0===R?F[0]:R===E.length-1?F[F.length-1]:3===E.length&&1===R?F[1]:o.getGradient(R,F[0],F[1],F[2],E.length),i[r+"_"+l]=!0}}}}else if(!i[r+"_"+l+"_icons"]){i[r+"_"+l+"_icons"]=!0;var A=o.parent.createElement("span",{className:"e-icon e-iconsetspan"});o.applyIconSet(y,n,h,A,b)&&d&&d.format&&d.format.includes("*")&&"Accounting"!==$e(d.format)&&o.parent.notify("rowFillHandler",{cell:d,cellEle:h,rowIdx:r,colIdx:l,updateFillSize:!0,iconSetSpan:A})}}if(e.isAction&&C&&(o.parent.trigger("beforeConditionalFormat",{conditionalFormat:n,cell:d,element:h,apply:u,address:g(r,l)}),!u&&e.isEdit&&!i[r+"_"+l])){var k;v?h.className.includes("e-"+v.toLowerCase())&&(h.classList.remove("e-"+v.toLowerCase()),h.style.backgroundColor="",h.style.color="",((k=t.extend({},o.parent.commonCellStyle,d&&d.style)).backgroundColor||k.color)&&o.parent.notify(Xr,{rowIdx:r,colIdx:l,td:h,style:{backgroundColor:k.backgroundColor,color:k.color}})):(h.removeAttribute("style"),k=t.extend({},o.parent.commonCellStyle,d&&d.style),Object.keys(k).length&&o.parent.notify(Xr,{style:k,rowIdx:r,colIdx:l,td:h}))}u&&!i[r+"_"+l]&&(i[r+"_"+l]=!0,t.removeClass([h],["e-redft","e-yellowft","e-greenft","e-redf","e-redt"]),v&&(h.classList.add("e-"+v.toLowerCase()),o.setCFStyle(m,n)),Object.assign(h.style,m))};if(e.ele)w(e.indexes[0],e.indexes[1],e.cell,e.ele,e.resizedRowHeight,l);else for(var I=n.range.split(","),E=this.parent.frozenRowCount(r),R=this.parent.frozenColCount(r),N=u(r.topLeftCell),F=0;F<I.length;F++)this.updateRange(r,c(I[F]),E,R,N,w,l)},e.prototype.updateRange=function(e,t,r,n,i,a,o){t[0]=t[0]<r?t[0]<i[0]?i[0]:t[0]:t[0]<this.parent.viewport.topIndex+r?this.parent.viewport.topIndex+r:t[0],t[1]=t[1]<n?t[1]<i[1]?i[1]:t[1]:t[1]<this.parent.viewport.leftIndex+n?this.parent.viewport.leftIndex+n:t[1],t[2]=t[2]<r?t[2]<i[0]?i[0]-1:t[2]:t[2]>this.parent.viewport.bottomIndex?this.parent.viewport.bottomIndex:t[2],t[3]=t[3]<n?t[3]<i[1]?i[1]-1:t[3]:t[3]>this.parent.viewport.rightIndex?this.parent.viewport.rightIndex:t[3];for(var s,l=t[0];l<=t[2];l++)if(r&&l===r&&(l=this.parent.viewport.topIndex+r),!tt(e,l))for(var d=t[1];d<=t[3];d++)n&&d===n&&(d=this.parent.viewport.leftIndex+n),ht(e,d)||(s=this.parent.getCell(l,d))&&a(l,d,He(l,d,e),s,void 0,o)},e.prototype.applyIconSet=function(e,t,r,n,i){var a=r.classList.contains("e-iconset"),o=r.querySelector(".e-wrap-content");if(a){r.classList.remove("e-iconset");var s=r.querySelector(".e-iconsetspan");s&&(o?o.removeChild(s):r.removeChild(s))}var l=fe(e)?parseFloat(e):NaN,d=t.result;if(isNaN(l)||void 0===d[0]&&void 0===d[1]||fe(e)&&"Text"===i)return a;var h,p=d[0],c=d[1],u=this.getIconList(t.type).split(",");if(3===u.length){var f=p+.33*(c-p);h="e-"+(l>=p+.67*(c-p)?u[0].trim():l>=f?u[1].trim():u[2].trim())}else if(4===u.length){var g=p+.25*(c-p),m=p+.5*(c-p);h="e-"+(l>=(v=p+.75*(c-p))?u[0].trim():l>=m?u[1].trim():l>=g?u[2].trim():u[3].trim())}else if(5===u.length){var g=p+.2*(c-p),m=p+.4*(c-p),v=p+.6*(c-p);h="e-"+(l>=p+.8*(c-p)?u[0].trim():l>=v?u[1].trim():l>=m?u[2].trim():l>=g?u[3].trim():u[4].trim())}n.classList.add(h);var y=r.querySelector(".e-cf-databar");return y&&(n.style.height=y.style.height,n.classList.add("top"===r.style.verticalAlign?"e-cf-icon-top":"middle"===r.style.verticalAlign?"e-cf-icon-middle":"e-cf-icon-end")),o?o.insertBefore(n,o.firstChild):r.insertBefore(n,r.childNodes[0]),r.classList.add("e-iconset"),!0},e.prototype.getIconList=function(e){switch(e){case"ThreeArrows":return"3arrows-1,3arrows-2,3arrows-3";case"ThreeArrowsGray":return"3arrowsgray-1,3arrowsgray-2,3arrowsgray-3";case"FourArrowsGray":return"4arrowsgray-1,4arrowsgray-2,4arrowsgray-3,4arrowsgray-4";case"FourArrows":return"4arrows-1,4arrows-2,4arrows-3,4arrows-4";case"FiveArrowsGray":return"5arrowsgray-1,5arrowsgray-2,5arrowsgray-3,5arrowsgray-4,5arrowsgray-5";case"FiveArrows":return"5arrows-1,5arrows-2,5arrows-3,5arrows-4,5arrows-5";case"ThreeTrafficLights1":return"3trafficlights-1,3trafficlights-2,3trafficlights-3";case"ThreeTrafficLights2":return"3rafficlights2-1,3rafficlights2-2,3rafficlights2-3";case"ThreeSigns":return"3signs-1,3signs-2,3signs-3";case"FourTrafficLights":return"4trafficlights-1,4trafficlights-2,4trafficlights-3,4trafficlights-4";case"FourRedToBlack":return"4redtoblack-1,4redtoblack-2,4redtoblack-3,4redtoblack-4";case"ThreeSymbols":return"3symbols-1,3symbols-2,3symbols-3";case"ThreeSymbols2":return"3symbols2-1,3symbols2-2,3symbols2-3";case"ThreeFlags":return"3flags-1,3flags-2,3flags-3";case"FourRating":return"4rating-4,4rating-3,4rating-2,4rating-1";case"FiveQuarters":return"5quarters-1,5quarters-2,5quarters-3,5quarters-4,5quarters-5";case"FiveRating":return"5rating-5,5rating-4,5rating-3,5rating-2,5rating-1";case"ThreeTriangles":return"3triangles-1,3triangles-2,3triangles-3";case"ThreeStars":return"3stars-1,3stars-2,3stars-3";case"FiveBoxes":return"5boxes-1,5boxes-2,5boxes-3,5boxes-4,5boxes-5"}return"3arrows-1,3arrows-2,3arrows-3"},e.prototype.applyDataBars=function(e,t,r,n,i,a){var o,s,l=this.parent.getActiveSheet(),d=t.result,h=0;if(fe(e)&&(s=parseFloat(e)),void 0===d[0]&&void 0===d[1]||isNaN(s)||fe(e)&&"Text"===i){var p=r.getElementsByClassName("e-cf-databar")[0];if(p){var c=p.getElementsByClassName("e-databar-value")[0].textContent,u=r.querySelector(".e-hyperlink"),f=r.querySelector(".e-addNoteIndicator"),g=r.querySelector(".e-wrap-content");g?(g.textContent="",u?g.appendChild(u):g.innerText=c):(r.removeChild(p),u?r.appendChild(u):r.innerText=c),f&&r.appendChild(f)}}else{void 0!==d[0]&&void 0!==d[1]?(o=d[0]+Math.abs(d[1]),h=Math.abs(d[1]/o*100)):o=void 0!==d[0]?d[0]:d[1];var m=this.parent.createElement("div",{id:"spreadsheet-databar",className:"e-cf-databar"}),v=this.parent.createElement("span",{id:"spreadsheet-leftspan",className:"e-databar"}),y=this.parent.createElement("span",{id:"spreadsheet-rightspan",className:"e-databar"}),C=this.parent.createElement("span",{id:"spreadsheet-dataspan",className:"e-databar-value"}),b=r.querySelector(".e-iconsetspan"),x=r.querySelector(".e-addNoteIndicator"),S=r.querySelector(".e-wrap-content"),w=a||nt(l,n,!0),I=r.querySelector("#"+this.parent.element.id+"_currency");m.style.height=w-1+"px",b&&(b.style.height=w-1+"px",b.classList.add("top"===r.style.verticalAlign?"e-cf-icon-top":"middle"===r.style.verticalAlign?"e-cf-icon-middle":"e-cf-icon-end")),I&&(I.style.alignItems="top"===r.style.verticalAlign?"start":"middle"===r.style.verticalAlign?"center":"end",I.classList.add("e-cf-currency"));var E=t.type[0];"L"===E&&(E+="B"),void 0===d[1]?(y.style.width=Math.ceil(Math.abs(s/o*100))+"%",y.style.height=w-3+"px",y.style.backgroundColor=this.getColor(E)[0],y.style.left="0px"):void 0===d[0]?(y.style.width=Math.ceil(Math.abs(s/o*100))+"%",y.style.height=w-3+"px",y.style.backgroundColor=this.getColor("R")[0],y.style.left="0px"):s>=0?(v.style.width=h+"%",v.style.height=w-3+"px",v.style.backgroundColor="transparent",v.style.left="0px",y.style.width=Math.ceil(Math.abs(s/o*100))+"%",y.style.height=w-3+"px",y.style.backgroundColor=this.getColor(E)[0],y.style.left=h+"%"):(v.style.width=Math.ceil(Math.abs(s/o*100))+"%",v.style.height=w-3+"px",v.style.backgroundColor=this.getColor("R")[0],v.style.width===h+"%"?v.style.left="0px":v.style.right=100-h+"%"),C.style.fontSize=r.style.fontSize||"11pt",C.style.alignItems="top"===r.style.verticalAlign?"start":"middle"===r.style.verticalAlign?"center":"end",C.style.textDecoration=r.style.textDecoration;var R=r.querySelector("#"+this.parent.element.id+"_currency");R&&m.appendChild(R);var N=r.querySelector(".e-hyperlink");if(N)C.appendChild(N);else{var F=r.querySelector(".e-validation-list")?r.innerText:r.textContent;C.innerText=F,""===F&&C.appendChild(document.createTextNode(F))}m.appendChild(v),m.appendChild(y),m.appendChild(C),r.textContent="",S?(S.textContent="",b&&S.appendChild(b),S.appendChild(m),r.appendChild(S)):(b&&r.insertBefore(b,r.firstElementChild),r.appendChild(m)),x&&r.appendChild(x)}},e.prototype.getColor=function(e){if("LB"===e)return["#008aef"];for(var t=e.split(""),r=[],n=0;n<t.length;n++)switch(t[n]){case"G":r.push("#63be7b");break;case"Y":r.push("#ffeb84");break;case"R":r.push("#f8696b");break;case"W":r.push("#ffffff");break;case"B":r.push("#5a8ac6");break;case"O":r.push("#ffb628");break;case"LB":r.push("#008aef");break;case"P":r.push("#d6007b")}return r},e.prototype.getGradient=function(e,r,n,i,a){if(t.isNullOrUndefined(i))return this.getLinear(r,n,e/a);var o=a/2;return e>=o?this.getLinear(n,i,Math.abs((e-o)/o)):this.getLinear(r,n,e/o)},e.prototype.getLinear=function(e,t,r){return"#"+this.byteLinear(e[1]+e[2],t[1]+t[2],r)+this.byteLinear(e[3]+e[4],t[3]+t[4],r)+this.byteLinear(e[5]+e[6],t[5]+t[6],r)},e.prototype.byteLinear=function(e,t,r){var n=parseInt(e,16)*(1-r)+parseInt(t,16)*r|0;return Math.abs(n).toString(16)},e.prototype.isGreaterThanLessThan=function(e,t,r,n){if(fe(t)&&"Text"!==n){if(fe(r)){var i=new RegExp(/[^.-a-zA-Z 0-9]+/g);return"GreaterThan"===e.type?parseFloat(t)>parseFloat(r.replace(i,"")):parseFloat(t)<parseFloat(r.replace(i,""))}var a={value:r,rowIndex:0,colIndex:0,sheetIndex:0,isDate:!1,updatedVal:"",isTime:!1};if(this.parent.notify(Zr,a),a.isDate||a.isTime)return e.value=a.updatedVal.toString(),"GreaterThan"===e.type?Number(t)>Number(a.updatedVal):Number(t)<Number(a.updatedVal);if(r)return"GreaterThan"===e.type?t.toLowerCase()>r.toLowerCase():t.toLowerCase()<r.toLowerCase()}else if(""===t&&Number(r)>0&&"LessThan"===e.type)return!0;return!1},e.prototype.isBetWeen=function(e,t,r,n,i){var a,o;if(!i){var s=new RegExp(/[^.-a-zA-Z 0-9]+/g);r=r.replace(s,""),n=n.replace(s,"")}if(fe(r)){var l=parseFloat(r),d=parseFloat(n);return l>d&&(l=(a=[d,l])[0],d=a[1]),parseFloat(t)>=l&&parseFloat(t)<=d}if(r&&n){var h={value:r,cell:{},updatedVal:""},p={value:n,cell:{},updatedVal:""};return this.parent.notify(Zr,h),this.parent.notify(Zr,p),(h.isDate||h.isTime)&&(p.isDate||p.isTime)?(e.value=h.updatedVal+","+p.updatedVal,h.updatedVal>p.updatedVal&&(o=[p.updatedVal,h.updatedVal],h.updatedVal=o[0],p.updatedVal=o[1]),t>=h.updatedVal&&t<=p.updatedVal):t.toLowerCase()>=r.toLowerCase()&&t.toLowerCase()<=n.toLowerCase()}return!1},e.prototype.isEqualTo=function(e,t,r){if(fe(r)){if(""===t)return 0===parseFloat(r);var n=new RegExp(/[^.-a-zA-Z 0-9]+/g);return parseFloat(t)===parseFloat(r.replace(n,""))}if(t&&r){var i={value:r,cell:{},updatedVal:""};return this.parent.notify(Zr,i),i.isTime||i.isDate?(e.value=i.updatedVal,t===i.updatedVal):t.toLowerCase()===r.toLowerCase()}return!1},e.prototype.isContainsText=function(e,t){var r=new RegExp(/[^.-a-zA-Z 0-9]+/g);return fe(t.replace(r,""))?(t=t.replace(r,""),ue(e)&&(e=ce(e).toString()),e.indexOf(t)>-1):ue(t)?(ue(e)&&(e=ce(e).toString()),e.indexOf(ce(t).toString())>-1):e.toLowerCase().indexOf(t.toLowerCase())>-1},e.prototype.setCFStyle=function(e,t){switch(t.cFColor){case"RedFT":e.backgroundColor="#ffc7ce",e.color="#9c0055";break;case"YellowFT":e.backgroundColor="#ffeb9c",e.color="#9c6500";break;case"GreenFT":e.backgroundColor="#c6efce",e.color="#006100";break;case"RedF":e.backgroundColor="#ffc7ce";break;case"RedT":e.color="#9c0055"}return e},e.prototype.getModuleName=function(){return"conditionalFormatting"},e}(),fo=function(){function e(e){this.fillOptionIndex=0,this.parent=e,this.addEventListener()}return e.prototype.getfillItems=function(){var e=this.parent.serviceLocator.getService(Na);return[{text:e.getConstant("CopyCells")},{text:e.getConstant("FillSeries")},{text:e.getConstant("FillFormattingOnly")},{text:e.getConstant("FillWithoutFormatting")}]},e.prototype.createAutoFillElement=function(){if(this.parent.allowAutoFill){var e=this.parent.getMainContent(),t=this.parent.createElement("div",{className:"e-autofill"});e.lastElementChild&&e.lastElementChild.classList.contains("e-ss-overlay")?e.insertBefore(t,e.getElementsByClassName("e-ss-overlay")[0]):e.appendChild(t),this.autoFillElement=t,this.autoFillDropDown&&(this.autoFillDropDown.destroy(),this.autoFillDropDown=null),this.getautofillDDB({id:this.parent.element.id+"_autofilloptionbtn",appendElem:e})}},e.prototype.getautofillDDB=function(e){var t=this;return this.splitBtnElem=this.parent.createElement("button",{id:e.id,className:"e-filloption",attrs:{type:"button"}}),this.splitBtnElem.appendChild(this.parent.createElement("span",{className:"e-tbar-btn-text"})),this.autoFillDropDown=new d.DropDownButton({cssClass:"e-dragfill-ddb",iconCss:"e-icons e-dragfill-icon",items:this.getfillItems(),createPopupOnClick:!0,enableRtl:this.parent.enableRtl,select:function(e){t.autoFillOptionClick({type:t.getFillType(e.item.text)})},beforeOpen:function(){return t.autoFillClick()}}),this.autoFillDropDown.createElement=this.parent.createElement,this.autoFillDropDown.appendTo(this.splitBtnElem),e.appendElem.appendChild(this.splitBtnElem),this.autoFillDropDown},e.prototype.getFillType=function(e){var t=this.parent.serviceLocator.getService(Na);return e===t.getConstant("CopyCells")?"CopyCells":e===t.getConstant("FillSeries")?"FillSeries":e===t.getConstant("FillFormattingOnly")?"FillFormattingOnly":"FillWithoutFormatting"},e.prototype.autoFillClick=function(){var e=this.parent.serviceLocator.getService(Na),t={fillType:"FillSeries",disableItems:[""]};this.parent.notify("getFillInfo",t),this.autoFillDropDown.setProperties({items:this.getfillItems()},!0),this.autoFillDropDown.removeItems(t.disableItems),this.refreshAutoFillOption(e.getConstant(t.fillType))},e.prototype.getFillRange=function(e,t,r,n){switch(n){case"Up":return[r.rowIndex,e.colIndex,e.rowIndex-1,t.colIndex];case"Right":return[e.rowIndex,t.colIndex+1,t.rowIndex,r.colIndex];case"Down":return[t.rowIndex+1,e.colIndex,r.rowIndex,t.colIndex];case"Left":return[e.rowIndex,r.colIndex,t.rowIndex,e.colIndex-1]}},e.prototype.autoFillOptionClick=function(e){var t=this.parent.serviceLocator.getService(Na),r=this.parent.getActiveSheet(),n=w(c(this.parent.selectionModule.dAutoFillCell)),i=c(r.selectedRange),a=n[0],o=n[1],s=n[2],l=n[3],d=this.getDirection({rowIndex:s,colIndex:l},{rowIndex:i[2],colIndex:i[3]}),h=[a,o,s,l],p=this.getFillRange({rowIndex:a,colIndex:o},{rowIndex:s,colIndex:l},{rowIndex:i[2],colIndex:i[3]},d);this.refreshAutoFillOption(t.getConstant(e.type));var u={isUndo:!0,isPublic:!0,preventReSelect:!0,preventEvt:"FillWithoutFormatting"===e.type,setCollection:"FillFormattingOnly"===e.type||"FillWithoutFormatting"===e.type,isFromAutoFillOption:!0};this.parent.notify(hi,u);var f={dataRange:r.name+"!"+m(h),fillRange:r.name+"!"+m(p),direction:d,fillType:e.type,isFillOptClick:!0};this.isVerticalFill="Down"===f.direction||"Up"===f.direction,this.parent.notify(En,f),this.positionAutoFillElement({isautofill:!0});var g={dataRange:f.dataRange,fillRange:f.fillRange,fillType:f.fillType,direction:f.direction,selectedRange:r.name+"!"+m(i),undoArgs:u.undoArgs};this.parent.notify(ci,{eventArgs:g,action:"autofill"}),this.parent.showAggregate&&this.parent.notify("showAggregate",{}),this.autoFillClick()},e.prototype.refreshAutoFillOption=function(e){for(t=0;t<this.autoFillDropDown.items.length;t++)this.autoFillDropDown.items[t].iconCss="";for(var t=0;t<this.autoFillDropDown.items.length;t++)this.autoFillDropDown.items[t].text===e&&(this.autoFillDropDown.items[t].iconCss="e-icons e-selected-icon");["Copy Cells","Fill Series","Fill Formatting Only","Fill Without Formatting"].indexOf(e)<0&&(this.autoFillDropDown.items[this.fillOptionIndex].iconCss=""),this.autoFillDropDown.dataBind()},e.prototype.positionAutoFillElement=function(e){var r,n,i,a=0,o=0,s=this.parent.getActiveSheet(),l=w(c(s.selectedRange)),d=-5,h=-5,p=6,u=6,f=0===l[1]&&l[3]===s.colCount-1,g=0===l[0]&&l[2]===s.rowCount-1,m=l[2],v=l[3],y=this.parent.enableRtl,C=this.parent.getCell(m,v);if(ht(s,l[3])||tt(s,l[2])||C&&C.classList.contains("e-formularef-selection")||s.isProtected&&s.protectSettings.selectUnLockedCells&&sr(this.parent,l))return void this.hideAutoFillElement();if(s.isProtected&&(s.protectSettings.selectCells||s.protectSettings.selectUnLockedCells)||!s.isProtected)if(f?(d=-5,h=-1,p=6,u=2,m=l[2],v=l[1]):g&&(h=-5,d=0,p=1,u=6,m=l[0],v=l[3]),s.frozenColumns||s.frozenRows){if(g||f?(St(this.parent,this.autoFillElement,l,"e-autofill",e&&e.preventAnimation),this.parent.autoFillSettings.showFillOptions&&e&&e.isautofill&&St(this.parent,this.autoFillDropDown.element,l,"e-filloption")):(St(this.parent,this.autoFillElement,[m,v,m,v],"e-autofill",e&&e.preventAnimation),this.parent.autoFillSettings.showFillOptions&&e&&e.isautofill&&St(this.parent,this.autoFillDropDown.element,[m,v,m,v],"e-filloption")),this.autoFillElement){this.autoFillCell={rowIndex:m,colIndex:v};var b=this.parent.element.querySelectorAll(".e-autofill");if(b.length){x=b[0].getBoundingClientRect();this.autoFillElementPosition={left:x.left,top:x.top},[].slice.call(b).forEach(function(e){t.removeClass([e],"e-hide")})}}}else if(i=xt(s,[m,v,m,v],this.parent.frozenRowCount(s),this.parent.frozenColCount(s),this.parent.viewport.beforeFreezeHeight,this.parent.viewport.beforeFreezeWidth,this.parent.sheetModule.colGroupWidth),r=at(s,m,m,!0),n=dt(s,v,v,!0),g||(a+=r),f||(o+=n),a+=Math.round(i.top)+d,o+=Math.round(i.left)+h,this.autoFillElement){t.removeClass([this.autoFillElement],"e-hide"),this.autoFillElement.style.top=a+"px",y?this.autoFillElement.style.right=o+"px":this.autoFillElement.style.left=o+"px",this.autoFillCell={rowIndex:m,colIndex:v};var x=this.autoFillElement.getBoundingClientRect();if(this.autoFillElementPosition={left:x.left,top:x.top},this.parent.autoFillSettings.showFillOptions&&e&&e.isautofill){t.removeClass([this.autoFillDropDown.element],"e-hide");var S=this.parent.element.querySelector(".e-main-panel"),I=this.parent.element.querySelector(".e-main-panel .e-sheet-content .e-virtualable"),E=this.parent.element.querySelector(".e-sheet-panel .e-scrollbar .e-scroller"),R=I&&I.clientHeight<S.clientHeight?S.clientHeight-I.clientHeight:0,N=I&&I.clientWidth<S.clientWidth?S.clientWidth-I.clientWidth:0,F=this.autoFillDropDown.element.getBoundingClientRect();S.scrollTop+S.clientHeight-R<a+F.height&&(a-=F.height),E.scrollLeft+E.clientWidth-N<o+F.width&&(o-=F.width),this.autoFillDropDown.element.style.top=a+p+"px",y?this.autoFillDropDown.element.style.right=o+u+"px":this.autoFillDropDown.element.style.left=o+u+"px"}}},e.prototype.hideAutoFillElement=function(){var e=this.parent.element;[].slice.call(e.querySelectorAll(".e-autofill")).forEach(function(r){e&&t.addClass([r],"e-hide")})},e.prototype.hideAutoFillOptions=function(){var e=this.parent.element;[].slice.call(e.querySelectorAll(".e-filloption")).forEach(function(r){e&&t.addClass([r],"e-hide")})},e.prototype.selectAutoFillRange=function(e){var t={clientY:Bt(e.e),target:e.e.target},r={clientX:Mt(e.e),target:e.e.target},n=this.parent.getActiveSheet();this.parent.notify(Ei,t),this.parent.notify(Ri,r);var i,a=this.getAutoFillRange({rowIndex:t.clientY,colIndex:r.clientX});return i=a&&a.fillRange?[a.startCell.rowIndex,a.startCell.colIndex,a.endCell.rowIndex,a.endCell.colIndex]:c(n.selectedRange),e.indexes=i,i},e.prototype.getAutoFillRange=function(e){var t=this.parent.getActiveSheet(),r=this.autoFillCell,n=w(c(t.selectedRange)),i=n[0],a=n[1],o=n[2],s=n[3],l=B(n,[e.rowIndex,e.colIndex,e.rowIndex,e.colIndex],!0),d={rowIndex:i,colIndex:a},h={rowIndex:n[0],colIndex:n[1]},p={rowIndex:n[2],colIndex:n[3]},u={rowIndex:o,colIndex:s},f=this.modifyRangeForMerge(e.rowIndex,e.colIndex,r.rowIndex,r.colIndex,n);return e.rowIndex<r.rowIndex?i-e.rowIndex>e.colIndex-s&&i-e.rowIndex>a-e.colIndex?l?{startCell:d,endCell:{rowIndex:e.rowIndex,colIndex:s}}:{startCell:u,endCell:{rowIndex:f.rowIndex,colIndex:a},fillRange:[f.rowIndex,a,i-1,s],direction:"Up"}:e.colIndex>r.colIndex?{startCell:d,endCell:{rowIndex:o,colIndex:e.colIndex},fillRange:[i,s+1,o,e.colIndex],direction:"Right"}:e.colIndex<r.colIndex?l?{startCell:d,endCell:u}:{startCell:u,endCell:{rowIndex:i,colIndex:e.colIndex},fillRange:[i,e.colIndex,o,a-1],direction:"Left"}:{startCell:h,endCell:p}:e.colIndex>r.colIndex?e.rowIndex-o>e.colIndex-s?{startCell:d,endCell:{rowIndex:e.rowIndex,colIndex:s},fillRange:[o+1,a,e.rowIndex,s],direction:"Down"}:{startCell:d,endCell:{rowIndex:o,colIndex:f.colIndex},fillRange:[i,s+1,o,f.colIndex],direction:"Right"}:e.colIndex<r.colIndex?e.rowIndex-o>s-e.colIndex||e.rowIndex-i>s-e.colIndex&&e.rowIndex!==o?{startCell:d,endCell:{rowIndex:e.rowIndex,colIndex:s},fillRange:[o+1,a,e.rowIndex,s],direction:"Down"}:l?{startCell:d,endCell:u}:{startCell:u,endCell:{rowIndex:i,colIndex:f.colIndex},fillRange:[i,f.colIndex,o,a-1],direction:"Left"}:e.rowIndex>r.rowIndex?{startCell:d,endCell:{rowIndex:f.rowIndex,colIndex:s},fillRange:[o+1,a,f.rowIndex,s],direction:"Down"}:(e.rowIndex===r.rowIndex&&(e.colIndex,r.colIndex),{startCell:h,endCell:p})},e.prototype.modifyRangeForMerge=function(e,t,r,n,i){var a={rowIndex:e,colIndex:t};if(this.isMergedRange(i)){var o=i[2]-i[0]+1,s=i[3]-i[1]+1,l=void 0;e<r?(l=(i[2]-e+1)%o)&&e-(o-l)>=0&&(a.rowIndex=e-(o-l)):t>n?(l=(t-i[1]+1)%s)&&(a.colIndex=t+(s-l)):t<n?(l=(i[3]-t+1)%s)&&t-(s-l)>=0&&(a.colIndex=t-(s-l)):e>r&&(l=(e-i[0]+1)%o)&&(a.rowIndex=e+(o-l))}return a},e.prototype.performAutoFill=function(e){if(!e.rangeInfo&&(e.event.clientX>this.autoFillElementPosition.left&&e.event.clientX<this.autoFillElementPosition.left+10)&&(e.event.clientY>this.autoFillElementPosition.top&&e.event.clientY<this.autoFillElementPosition.top+10))this.positionAutoFillElement({isautofill:!1});else{var t=void 0;if(e.rangeInfo)t=e.rangeInfo;else{var r={clientY:Bt(e.event),target:e.event.target},n={clientX:Mt(e.event),target:e.event.target};this.parent.notify(Ei,r),this.parent.notify(Ri,n),t=this.getAutoFillRange({rowIndex:r.clientY,colIndex:n.clientX})}var i=this.parent.getActiveSheet();if(t&&t.fillRange){var a={dataRange:i.name+"!"+e.dAutoFillCell,fillRange:i.name+"!"+m(t.fillRange),direction:t.direction,fillType:e.fillType||this.parent.autoFillSettings.fillType,cancel:!1};if(oe(this.parent,c(e.dAutoFillCell))||oe(this.parent,t.fillRange))return void this.parent.notify(yi,null);if(this.parent.notify(qr,{eventArgs:a,action:"autofill"}),a.cancel)return;var o=sr(this.parent,t.fillRange);if(i.isProtected&&o)return void this.parent.notify(vi,null);e.rangeInfo?this.performAutoFillAction(a,null,o):(this.performAutoFillAction(a,t,o),this.positionAutoFillElement({isautofill:!0}))}}},e.prototype.refreshCell=function(e){this.parent.serviceLocator.getService("cell").refreshRange([e.rowIndex,e.colIndex,e.rowIndex,e.colIndex])},e.prototype.getDirection=function(e,r,n){if(n=t.isNullOrUndefined(n)?this.isVerticalFill:n){if(r.rowIndex<e.rowIndex)return"Up";if(r.rowIndex>e.rowIndex)return"Down";if(r.colIndex>e.colIndex)return"Right";if(r.colIndex<e.colIndex)return"Left"}else{if(r.colIndex>e.colIndex)return"Right";if(r.colIndex<e.colIndex)return"Left";if(r.rowIndex<e.rowIndex)return"Up";if(r.rowIndex>e.rowIndex)return"Down"}return null},e.prototype.performAutoFillAction=function(e,t,r){var n=this,i=this.parent.getActiveSheet(),a=this.parent.serviceLocator.getService(Na);if(this.isMergedRange(c(e.fillRange))){var o=this.parent.serviceLocator.getService(Fa);return void o.show({isModal:!0,showCloseIcon:!0,height:180,width:400,content:a.getConstant("AutoFillMergeAlertMsg"),buttons:[{buttonModel:{content:this.parent.serviceLocator.getService(Na).getConstant("Ok"),isPrimary:!0},click:function(){o.hide(),n.parent.selectRange(e.dataRange)}}],close:function(){o.hide(),n.parent.selectRange(e.dataRange)}},!1)}this.isVerticalFill="Down"===e.direction||"Up"===e.direction,this.parent.notify(En,{dataRange:e.dataRange,fillRange:e.fillRange,direction:e.direction,fillType:e.fillType,isLockedCell:r});var s=t?m([t.startCell.rowIndex,t.startCell.colIndex,t.endCell.rowIndex,t.endCell.colIndex]):i.selectedRange;Re(this.parent,s,i);var l={dataRange:e.dataRange,fillRange:e.fillRange,fillType:e.fillType,direction:e.direction,selectedRange:s};this.parent.notify(ci,{eventArgs:l,action:i.conditionalFormats&&i.conditionalFormats.length>0&&"autofillWithCF"===i.conditionalFormats[i.conditionalFormats.length-1].action?"autofillWithCF":"autofill"}),this.parent.trigger("select",{range:this.parent.getActiveSheet().selectedRange}),this.parent.showAggregate&&this.parent.notify("showAggregate",{}),this.parent.notify(Sn,null)},e.prototype.getRangeData=function(e){for(var t,r=[],n=this.parent.getActiveSheet(),i=e.range[0],a=e.range[1],o=e.range[2],s=e.range[3],l=a;i<=o;)if(tt(n,i))i++;else{for(a=l;a<=s;)ht(n,a)?a++:(t=He(i,a,n),r.push(t),a++);i++}return r},e.prototype.isMergedRange=function(e){var t=0,r=this.getRangeData({range:e,sheetIdx:this.parent.activeSheetIndex});for(t=0;t<r.length;t++)if(r[t]&&(r[t].rowSpan||r[t].colSpan))return!0;return!1},e.prototype.addEventListener=function(){this.parent.on(Wn,this.createAutoFillElement,this),this.parent.on("positionAutoFillElement",this.positionAutoFillElement,this),this.parent.on("hideAutoFillOptions",this.hideAutoFillOptions,this),this.parent.on("hideAutoFillElement",this.hideAutoFillElement,this),this.parent.on("performAutoFill",this.performAutoFill,this),this.parent.on("selectAutoFillRange",this.selectAutoFillRange,this),this.parent.on("refreshCell",this.refreshCell,this),this.parent.on(Rn,this.getautofillDDB,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Wn,this.createAutoFillElement),this.parent.off("positionAutoFillElement",this.positionAutoFillElement),this.parent.off("hideAutoFillOptions",this.hideAutoFillOptions),this.parent.off("hideAutoFillElement",this.hideAutoFillElement),this.parent.off("performAutoFill",this.performAutoFill),this.parent.off("selectAutoFillRange",this.selectAutoFillRange),this.parent.off("refreshCell",this.refreshCell),this.parent.off(Rn,this.getautofillDDB))},e.prototype.destroy=function(){this.removeEventListener(),this.autoFillElement&&this.autoFillElement.remove(),this.autoFillElement=null,this.autoFillElementPosition=null,this.autoFillCell=null,this.autoFillDropDown&&this.autoFillDropDown.destroy(),this.autoFillDropDown=null,this.isVerticalFill=null,this.fillOptionIndex=null,this.splitBtnElem&&(gt(this.splitBtnElem),this.splitBtnElem.remove()),this.splitBtnElem=null,this.parent=null},e.prototype.getModuleName=function(){return"autofill"},e}(),go=function(){function e(e){this.isNoteVisible=!1,this.isNoteVisibleOnTouch=!1,this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){if(this.removeEventListener(),!this.parent.isDestroyed&&!this.parent.refreshing)for(var e=this.parent.element.getElementsByClassName("e-addNoteIndicator");e.length;){var r=t.closest(e[0],".e-cell");r&&(t.EventHandler.remove(r,"mouseover",this.mouseOver),t.EventHandler.remove(r,"mouseout",this.mouseOut)),t.detach(e[0])}this.parent=null,this.isNoteVisible=null},e.prototype.addEventListener=function(){this.parent.on("addNote",this.addNote,this),this.parent.on("editNote",this.editNote,this),this.parent.on("deleteNote",this.deleteNote,this),this.parent.on("createNoteIndicator",this.createNoteIndicator,this),this.parent.on("showNote",this.showNote,this),this.parent.on("removeNoteContainer",this.removeNoteContainer,this),this.parent.on("updateNoteContainer",this.updateNoteContainer,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("addNote",this.addNote),this.parent.off("editNote",this.editNote),this.parent.off("showNote",this.showNote),this.parent.off("deleteNote",this.deleteNote),this.parent.off("createNoteIndicator",this.createNoteIndicator),this.parent.off("removeNoteContainer",this.removeNoteContainer),this.parent.off("updateNoteContainer",this.updateNoteContainer))},e.prototype.getModuleName=function(){return"spreadsheetNote"},e.prototype.addNote=function(){var e=t.isNullOrUndefined(this.noteCellIndexes)?u(this.parent.getActiveSheet().activeCell):this.noteCellIndexes,r=this.parent.getCell(e[0],e[1]);!t.isNullOrUndefined(r)&&(0===r.children.length||r.children.length>0&&-1===r.children[r.childElementCount-1].className.indexOf("e-addNoteIndicator"))&&(this.createNoteIndicator({targetElement:r,rowIndex:e[0],columnIndex:e[1]}),this.createNoteContainer(r,e[0],e[1],!1,!0))},e.prototype.deleteNote=function(e){var r=u(this.parent.getActiveSheet().activeCell),n=t.isNullOrUndefined(e)||t.isNullOrUndefined(e.rowIndex)?r[0]:e.rowIndex,i=t.isNullOrUndefined(e)||t.isNullOrUndefined(e.columnIndex)?r[1]:e.columnIndex,a=this.parent.getCell(n,i);if(a.children.length>0&&a.children[a.children.length-1].className.indexOf("e-addNoteIndicator")>-1){a.removeChild(a.children[a.children.length-1]),t.EventHandler.remove(a,"mouseover",this.mouseOver),t.EventHandler.remove(a,"mouseout",this.mouseOut);var o=Le(this.parent,this.parent.activeSheetIndex)+"!"+this.parent.getActiveSheet().activeCell,s=He(n,i,this.parent.getActiveSheet());if(!t.isNullOrUndefined(e)&&e.isDeleteFromMenu&&this.parent.notify("setActionData",{args:{action:"beforeCellSave",eventArgs:{address:o}}}),!t.isNullOrUndefined(s)&&s.notes&&delete s.notes,!t.isNullOrUndefined(e)&&e.isDeleteFromMenu){var l={notes:s.notes,address:o};this.parent.notify(ci,{eventArgs:l,action:"deleteNote"}),this.isShowNote=null}}},e.prototype.editNote=function(){var e=t.isNullOrUndefined(this.noteCellIndexes)?u(this.parent.getActiveSheet().activeCell):this.noteCellIndexes;this.showNote({rowIndex:e[0],columnIndex:e[1],isNoteEditable:!0});var r=document.getElementsByClassName("e-addNoteContainer")[0];Y(this.parent,this.parent.getActiveSheet(),{rowIdx:e[0],colIdx:e[1],preventEvt:!0,cell:{isNoteEditable:!0}}),r&&this.getNoteFocus(r)},e.prototype.createNoteIndicator=function(e){var r=this.parent.createElement("div",{className:"e-addNoteIndicator",styles:"position: absolute;top: 0;right: 0;width: 0;height: 0;border-left: 8px solid transparent;border-top: 8px solid red;cursor: pointer;"});if(e.targetElement.children.length>0)for(var n=nt(this.parent.getActiveSheet(),e.rowIndex),i=0;i<e.targetElement.childElementCount;i++)e.targetElement.children[i].className.indexOf("e-filter-btn")>-1&&(r.style.right=(n<30?e.targetElement.children[i].getBoundingClientRect().width<=0?20:e.targetElement.children[i].getBoundingClientRect().width:2)+"px"),e.targetElement.children[i].className.indexOf("e-validation-list")>-1&&(r.style.right=(e.targetElement.children[i].getBoundingClientRect().width||20)+2+"px");(!t.isNullOrUndefined(e.targetElement)&&0===e.targetElement.children.length||e.targetElement.children.length>0&&-1===e.targetElement.children[e.targetElement.childElementCount-1].className.indexOf("e-addNoteIndicator"))&&(e.skipEvent||(t.EventHandler.add(e.targetElement,"mouseover",this.mouseOver,[this,e.rowIndex,e.columnIndex]),t.EventHandler.add(e.targetElement,"mouseout",this.mouseOut,this)),e.targetElement.appendChild(r))},e.prototype.mouseOver=function(){var e=this,r=e[0];(r.isNoteVisibleOnTouch&&!t.isNullOrUndefined(document.getElementsByClassName("e-addNoteContainer")[0])||t.isNullOrUndefined(document.getElementsByClassName("e-addNoteContainer")[0]))&&(t.isNullOrUndefined(document.getElementsByClassName("e-addNoteContainer")[0])||r.removeNoteContainer(),r.showNote({rowIndex:e[1],columnIndex:e[2],isNoteEditable:!1}),r.isNoteVisible=!0)},e.prototype.mouseOut=function(e){!this.isNoteVisible||this.isNoteVisibleOnTouch||t.isNullOrUndefined(document.getElementsByClassName("e-addNoteContainer")[0])||-1!==document.activeElement.className.indexOf("e-addNoteContainer")||t.isNullOrUndefined(e.relatedTarget)||-1!==e.relatedTarget.className.indexOf("e-connectorLine")||-1!==e.relatedTarget.className.indexOf("e-addNoteContainer")||(this.removeNoteContainer(),this.isNoteVisible=!1)},e.prototype.createNoteContainer=function(e,r,n,i,a){var o=He(r,n,this.parent.getActiveSheet()),s=e.getBoundingClientRect(),l=this.parent.createElement("textarea",{className:"e-addNoteContainer"});this.createContainer(l,o,s,i),this.createConnectorLine(l,s),a&&this.getNoteFocus(l),t.EventHandler.add(l,"mouseout",this.mouseOut,this),t.EventHandler.add(document.getElementsByClassName("e-connectorLine")[0],"mouseout",this.mouseOut,this)},e.prototype.getNoteFocus=function(e){e.selectionStart=e.value.length,e.focus()},e.prototype.createContainer=function(e,r,n,i){var a=5;!t.isNullOrUndefined(document.getElementsByClassName("e-select-all-cell")[0])&&!t.isNullOrUndefined(document.getElementsByClassName("e-scroller")[0])&&n.top>=document.getElementsByClassName("e-select-all-cell")[0].getBoundingClientRect().bottom&&n.right>=document.getElementsByClassName("e-select-all-cell")[0].getBoundingClientRect().right&&n.bottom<=document.getElementsByClassName("e-scroller")[0].getBoundingClientRect().top&&n.right<=document.getElementsByClassName("e-scroller")[0].getBoundingClientRect().width?(e.style.display="block",a=n.top===document.getElementsByClassName("e-select-all-cell")[0].getBoundingClientRect().bottom?0:a):e.style.display="none";var o=this.parent.element.getBoundingClientRect(),s=this.parent.element.style.getPropertyValue("position");e.style.position="absolute",e.style.top=n.top-(o.top-("absolute"===s?0:this.parent.element.offsetTop))-a+"px",e.style.left=n.left+n.width-(o.left-("absolute"===s?0:this.parent.element.offsetLeft))+10+"px",e.style.width="120px",e.style.height="120px",e.style.zIndex="5",e.style.color="black",e.style.backgroundColor="lightyellow",!i||t.isNullOrUndefined(r)||t.isNullOrUndefined(r.notes)?e.innerHTML="":e.innerHTML=r.notes,this.parent.element.appendChild(e)},e.prototype.createConnectorLine=function(e,t){var r=this.parent.createElement("canvas",{className:"e-connectorLine",styles:"width: 100px; position: absolute;  z-index: 1;"}),n=r.getContext("2d"),i=this.parent.element.getBoundingClientRect(),a=this.parent.element.style.getPropertyValue("position");r.style.left=t.left+t.width-(i.left-("absolute"===a?0:this.parent.element.offsetLeft))+"px",r.style.top=e.getBoundingClientRect().top-(i.top-("absolute"===a?0:this.parent.element.offsetTop))-5+"px",n.clearRect(0,0,r.width,r.height),n.beginPath(),e.getBoundingClientRect().top===t.top?(n.moveTo(0,16),n.lineTo(30,15)):(n.moveTo(0,30),n.lineTo(30,15)),n.strokeStyle="black",n.lineWidth=5,n.stroke(),this.parent.element.appendChild(r),e.getBoundingClientRect().top>0?(r.style.display="block",r.style.zIndex="4"):r.style.display="none"},e.prototype.showNote=function(e){var r=t.isNullOrUndefined(this.parent.getCell(e.rowIndex,e.columnIndex))?e.cellElement:this.parent.getCell(e.rowIndex,e.columnIndex),n=document.getElementById(this.parent.element.id+"_contextmenu"),i=t.isNullOrUndefined(n)?"none":n.style.getPropertyValue("display"),a=!!e.isNoteEditable||"block"!==i;!t.isNullOrUndefined(r)&&t.isNullOrUndefined(document.getElementsByClassName("e-addNoteContainer")[0])&&a&&(e.isScrollWithNote||null!==r.children&&r.children.length>0&&r.children[r.children.length-1].classList.contains("e-addNoteIndicator"))&&(this.createNoteContainer(r,e.rowIndex,e.columnIndex,!0,e.isNoteEditable),this.noteCellIndexes=[e.rowIndex,e.columnIndex])},e.prototype.removeNoteContainer=function(){t.EventHandler.remove(document.getElementsByClassName("e-addNoteContainer")[0],"mouseout",this.mouseOut),t.EventHandler.remove(document.getElementsByClassName("e-connectorLine")[0],"mouseout",this.mouseOut),this.parent.element.removeChild(document.getElementsByClassName("e-addNoteContainer")[0]),this.parent.element.removeChild(document.getElementsByClassName("e-connectorLine")[0]),this.noteCellIndexes=null,this.isNoteVisible=!1,this.isNoteVisibleOnTouch=!1},e.prototype.updateNoteContainer=function(){this.parent.selectionModule.isNoteActiveElement=document.activeElement.className.indexOf("e-addNoteContainer")>-1||this.parent.selectionModule.isNoteActiveElement;var e=t.isNullOrUndefined(this.noteCellIndexes)?u(this.parent.getActiveSheet().activeCell):this.noteCellIndexes,r=He(e[0],e[1],this.parent.getActiveSheet()),n=document.getElementsByClassName("e-addNoteContainer")[0];if((t.isNullOrUndefined(r)||t.isNullOrUndefined(r.notes)||r.notes!==n.value)&&this.parent.selectionModule.isNoteActiveElement){var i=Le(this.parent,this.parent.activeSheetIndex)+"!"+m(e);this.parent.notify("setActionData",{args:{action:"beforeCellSave",eventArgs:{address:i}}});var a=!t.isNullOrUndefined(r)&&r.notes?"editNote":"addNote";Y(this.parent,this.parent.getActiveSheet(),{rowIdx:e[0],colIdx:e[1],preventEvt:!0,cell:{notes:n.value,isNoteEditable:!0}});var o={notes:n.value,address:i};this.parent.notify(ci,{eventArgs:o,action:a}),this.isShowNote=null}if(this.isShowNote=t.isNullOrUndefined(this.isShowNote)?this.parent.selectionModule.isNoteActiveElement:this.isShowNote,this.isShowNote){var s=!t.isNullOrUndefined(r)&&!t.isNullOrUndefined(r.isNoteEditable)&&r.isNoteEditable;this.parent.notify("removeNoteContainer",""),this.parent.notify("showNote",{rowIndex:e[0],columnIndex:e[1],isNoteEditable:!0,isScrollWithNote:s})}else this.parent.notify("removeNoteContainer",""),this.isShowNote=null},e}(),mo=function(){function e(e){this.parent=e}return e.prototype.show=function(e,r){var i,a=this;r=!!t.isNullOrUndefined(r);var o=e.beforeOpen||null,s=e.close||null,l={header:"Spreadsheet",cssClass:this.parent.cssClass,target:this.parent.element,buttons:[],allowDragging:!0};e.beforeOpen=function(e){o&&(o(e),e.cancel&&(a.hide(!0),e.preventFocus||or(a.parent.element)))},e.close=function(){a.destroyDialog(),s&&s()},t.extend(l,e),r&&(i=this.parent.serviceLocator.getService(Na).getConstant(l.buttons.length?"Cancel":"Ok"),l.buttons.push({buttonModel:{content:i,isPrimary:0===l.buttons.length},click:this.hide.bind(this)}));var d=this.parent.createElement("div");document.body.appendChild(d),this.dialogInstance=new n.Dialog(l),this.dialogInstance.createElement=this.parent.createElement,this.dialogInstance.appendTo(d),this.dialogInstance&&this.dialogInstance.refreshPosition()},e.prototype.destroyDialog=function(){this.dialogInstance.destroy(),t.remove(this.dialogInstance.element),this.dialogInstance=null},e.prototype.hide=function(e){this.dialogInstance&&(e&&(this.dialogInstance.animationSettings.effect="None",this.dialogInstance.dataBind()),this.dialogInstance.hide())},e.prototype.destroy=function(){this.parent=null},e}(),vo=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.initializeActionBegin=function(){var e=this,t=this.parent.beforeCellFormat;this.parent.beforeCellFormat=function(r){e.actionEventHandler({evtArgs:r,evtFunc:t,actionType:"begin",eventType:"format"})};var r=this.parent.beforeOpen;this.parent.beforeOpen=function(t){e.actionEventHandler({evtArgs:t,evtFunc:r,actionType:"begin",eventType:"beforeOpen"})};var n=this.parent.beforeSave;this.parent.beforeSave=function(t){e.actionEventHandler({evtArgs:t,evtFunc:n,actionType:"begin",eventType:"beforeSave"})};var i=this.parent.beforeSort;this.parent.beforeSort=function(t){e.actionEventHandler({evtArgs:t,evtFunc:i,actionType:"begin",eventType:"beforeSort"})}},e.prototype.initializeActionComplete=function(){var e=this,t=this.parent.sortComplete;this.parent.sortComplete=function(r){e.actionEventHandler({evtArgs:r,evtFunc:t,actionType:"complete",eventType:"sorting"})};var r=this.parent.cellSave;this.parent.cellSave=function(t){e.actionEventHandler({evtArgs:t,evtFunc:r,actionType:"complete",eventType:"cellSave"})}},e.prototype.actionEventHandler=function(e){e.evtFunc&&e.evtFunc.apply(this,[e]),"begin"===e.actionType?this.actionBeginHandler({eventArgs:e.evtArgs,action:e.eventType}):this.actionCompleteHandler({eventArgs:e.evtArgs,action:e.eventType})},e.prototype.actionBeginHandler=function(e){var t=e.preventAction;delete e.preventAction;var r={action:e.action};e.isUndo&&(r.isUndo=!0,delete e.isUndo),e.isRedo&&(r.isUndo=!1,delete e.isRedo),r.args=e,this.parent.trigger("actionBegin",r),t||this.parent.isPrintingProcessing||"clipboard"!==e.action&&"format"!==e.action&&"cellSave"!==e.action&&"addNote"!==e.action&&"editNote"!==e.action&&"deleteNote"!==e.action&&"beforeWrap"!==e.action&&"beforeReplace"!==e.action&&"filter"!==e.action&&"beforeClear"!==e.action&&"beforeInsertImage"!==e.action&&"beforeInsertChart"!==e.action&&"chartDesign"!==e.action&&"cellDelete"!==e.action&&"autofill"!==e.action&&"validation"!==e.action&&"removeValidation"!==e.action&&"hyperlink"!==e.action&&"removeHyperlink"!==e.action&&"deleteImage"!==e.action||this.parent.notify("setActionData",{args:e}),t&&(e.preventAction=!0),r.isUndo&&(e.isUndo=!0),!1===r.isUndo&&(e.isRedo=!0)},e.prototype.actionCompleteHandler=function(e){var t=e.preventAction;delete e.preventAction,this.parent.notify("triggerDataChange",e),e.preventEventTrigger||this.parent.trigger("actionComplete",e),t||"undoRedo"===e.action||"gotoSheet"===e.action||this.parent.notify("updateUndoRedoCollection",{args:e}),this.parent.notify("positionAutoFillElement",null)},e.prototype.addEventListener=function(){this.parent.on(ci,this.actionCompleteHandler,this),this.parent.on(qr,this.actionBeginHandler,this),this.parent.on(Gn,this.removeEventListener,this)},e.prototype.removeEventListener=function(){this.parent.off(ci,this.actionCompleteHandler),this.parent.off(qr,this.actionBeginHandler),this.parent.off(Gn,this.removeEventListener)},e}(),yo=function(){function e(e){this.minHeight="300px",this.minWidth="400px",this.isOverlayClicked=!1,this.isResizerClicked=!1,this.currentWidth=400,this.currenHeight=300,this.parent=e,this.parent.on(Li,this.isOverlaySelected,this),this.parent.on(wi,this.refreshOverlayElem,this),this.parent.on(Gn,this.destroy,this)}return e.prototype.insertOverlayElement=function(e,r,n){var i=this.parent.createElement("div",{id:e,attrs:{class:"e-ss-overlay"},styles:"width: "+this.minWidth+";  height: "+this.minHeight});if(this.parent.allowEditing){var a=this.parent.element.getElementsByClassName("e-ss-overlay-active")[0];a&&(t.removeClass([a],"e-ss-overlay-active"),this.parent.notify("removeDesignChart",{})),i.classList.add("e-ss-overlay-active")}var o=c(r),s=this.parent.sheets[n],l=this.parent.frozenRowCount(s),d=this.parent.frozenColCount(s),h=xt(s,o,l,d,this.parent.viewport.beforeFreezeHeight,this.parent.viewport.beforeFreezeWidth,this.parent.sheetModule.colGroupWidth,!0);if(o[0]>=l&&o[1]<d){var p=this.parent.sheetModule.contentPanel;p.scrollTop&&(h.top-=p.scrollTop,h.top+=this.parent.getColumnHeaderContent().parentElement.getBoundingClientRect().height)}if(o[1]>=d&&o[0]<l){var f=this.parent.getScrollElement();f.scrollLeft&&(h.left-=f.scrollLeft,h.left+=this.parent.sheetModule.getRowHeaderWidth(s))}var g;return o[0]<l||o[1]<d?(g=this.parent.element.querySelector("#"+this.parent.element.id+"_sheet"),l&&(o[0]>=l?h.top+=(s.showHeaders?31:0)+at(s,u(s.topLeftCell)[0],l-1):d||(h.left+=this.parent.sheetModule.getRowHeaderWidth(s,!0))),d&&(o[1]>=d?h.left+=this.parent.sheetModule.getRowHeaderWidth(s):l||(h.left+=s.showHeaders?31:0))):g=this.parent.getMainContent(),i.style.top=Number(ur(h.top).toFixed(2))+"px",i.style.left=Number(ur(h.left).toFixed(2))+"px",n===this.parent.activeSheetIndex?(g.appendChild(i),this.renderResizeHandler(i),this.addEventListener(i)):this.parent.isPrintingProcessing&&(i.style.visibility="hidden",document.body.append(i)),this.originalWidth=parseFloat(getComputedStyle(i,null).getPropertyValue("width").replace("px","")),this.originalHeight=parseFloat(getComputedStyle(i,null).getPropertyValue("height").replace("px","")),{element:i,top:h.top,left:h.left}},e.prototype.adjustFreezePaneSize=function(e,r,n){var i=c(n),a=this.parent.getActiveSheet(),o=this.parent.frozenRowCount(a),s=this.parent.frozenColCount(a);if(i[0]<o||i[1]<s?(t.isNullOrUndefined(e.top)||(r.style.top=e.top+(a.showHeaders?31:0)-this.parent.viewport.beforeFreezeHeight+"px"),t.isNullOrUndefined(e.left)||(r.style.left=e.left+this.parent.sheetModule.getRowHeaderWidth(a,!0)-this.parent.viewport.beforeFreezeWidth+"px")):(t.isNullOrUndefined(e.top)||(r.style.top=e.top-this.parent.viewport.beforeFreezeHeight-(o?at(a,u(a.topLeftCell)[0],o-1):0)+"px"),t.isNullOrUndefined(e.left)||(r.style.left=e.left-this.parent.viewport.beforeFreezeWidth-(s?dt(a,u(a.topLeftCell)[1],s-1):0)+"px")),t.isNullOrUndefined(e.top)){var l=u(a.topLeftCell)[0];e.top=this.parent.viewport.beforeFreezeHeight+(o&&l===i[0]?0:at(a,o?l:0,i[0]-1))}if(t.isNullOrUndefined(e.left)){var d=u(a.topLeftCell)[1];e.left=this.parent.viewport.beforeFreezeWidth+(s&&d===i[1]?0:dt(a,s?d:0,i[1]-1))}},e.prototype.addEventListener=function(e){var r=e;t.EventHandler.add(r,Rt(),this.overlayClickHandler,this),t.EventHandler.add(r,Nt(),this.overlayMouseMoveHandler,this),t.EventHandler.add(this.parent.element.querySelector("#"+this.parent.element.id+"_sheet"),Nt(),this.overlayMouseMoveHandler,this),t.EventHandler.add(document,Ft(),this.overlayMouseUpHandler,this),this.parent.on("overlayEleSize",this.setOriginalSize,this)},e.prototype.setOriginalSize=function(e){this.originalHeight=e.height,this.originalWidth=e.width},e.prototype.overlayMouseMoveHandler=function(e){var r,n,i,a,o,s,l=e.target,d=document.getElementsByClassName("e-ss-overlay-active")[0],h=this.parent.getActiveSheet(),p=h.frozenRows||h.frozenColumns?[29,this.parent.sheetModule.getRowHeaderWidth(h,!0)]:[-1,-1];if(this.isOverlayClicked&&this.isResizerClicked)switch(kt(e)&&e.preventDefault(),this.resizer){case"e-ss-overlay-t":r=Math.max(this.originalMouseY-Bt(e)+this.originalHeight,20),n=Bt(e)-(this.originalMouseY-this.originalResizeTop),r>20&&n>p[0]&&(d.style.height=r+"px",d.style.top=n+"px",this.resizedReorderTop=n,this.currenHeight=r,this.parent.notify(wn,{height:d.style.height,width:d.style.width,overlayEle:d}));break;case"e-ss-overlay-r":(i=this.originalWidth+(Ht(e)-this.originalMouseX))>20&&(d.style.width=i+"px",this.currentWidth=i,this.parent.notify(wn,{height:d.style.height,width:d.style.width,overlayEle:d}));break;case"e-ss-overlay-b":(a=this.originalHeight+(Ut(e)-this.originalMouseY))>20&&(d.style.height=a+"px",this.currenHeight=a,this.parent.notify(wn,{height:d.style.height,width:d.style.width,overlayEle:d}));break;case"e-ss-overlay-l":o=Math.max(this.originalMouseX-Mt(e)+this.originalWidth,20),s=Mt(e)-(this.originalMouseX-this.originalResizeLeft),o>20&&s>p[1]&&(d.style.width=o+"px",d.style.left=s+"px",this.resizedReorderLeft=s,this.currentWidth=o,this.parent.notify(wn,{height:d.style.height,width:d.style.width,overlayEle:d}))}else if(this.isOverlayClicked)if(kt(e)&&e.preventDefault(),t.closest(l,".e-sheet")&&!l.classList.contains("e-sheet-content")||l.classList.contains("e-cell")){if(!d)return;var c=Mt(e)-this.diffX,u=Bt(e)-this.diffY;c>p[1]&&(d.style.left=c+"px"),u>p[0]&&(d.style.top=u+"px"),this.resizedReorderLeft=c<0?0:c,this.resizedReorderTop=u<0?0:u}else this.overlayMouseUpHandler(e,!0)},e.prototype.overlayMouseUpHandler=function(e,r){if(this.parent&&!this.parent.getActiveSheet().isProtected&&this.parent.allowEditing){this.isResizerClicked=!1;var n=e.target,i=document.getElementsByClassName("e-datavisualization-chart e-ss-overlay-active");n.classList.contains("e-ss-overlay")||(n=t.closest(e.target,".e-datavisualization-chart")?t.closest(e.target,".e-datavisualization-chart"):n);var a=this.parent.getActiveSheet(),o={prevTop:a.frozenRows||a.frozenColumns?this.prevY:this.originalReorderTop,prevLeft:a.frozenRows||a.frozenColumns?this.prevX:this.originalReorderLeft,currentTop:this.resizedReorderTop>=0?parseInt(this.resizedReorderTop.toString(),10):this.originalReorderTop,currentLeft:this.resizedReorderLeft>=0?parseInt(this.resizedReorderLeft.toString(),10):this.originalReorderLeft,id:n.id,currentHeight:this.currenHeight,currentWidth:this.currentWidth,requestType:"imageRefresh",prevHeight:this.originalHeight,prevWidth:this.originalWidth};if(this.isOverlayClicked||r){var s=void 0,l=void 0,d={clientY:o.prevTop,isImage:!0},h={clientX:o.prevLeft,isImage:!0},p=this.parent.element.getElementsByClassName("e-ss-overlay-active")[0];if(a.frozenRows||a.frozenColumns){if(!p)return;d.isImage=!1,h.isImage=!1,d.target=p,h.target=p,o.prevTop<this.parent.getColumnHeaderContent().getBoundingClientRect().bottom&&(d.target=this.parent.getColumnHeaderContent()),o.prevLeft<this.parent.getRowHeaderContent().getBoundingClientRect().right&&(h.target=this.parent.getRowHeaderTable());var c=p.getBoundingClientRect();s={clientY:c.top},l={clientX:c.left},c.top<this.parent.getColumnHeaderContent().getBoundingClientRect().bottom&&(s.target=this.parent.getColumnHeaderContent()),c.left<this.parent.getRowHeaderContent().getBoundingClientRect().right&&(l.target=this.parent.getRowHeaderTable())}else s={clientY:o.currentTop,isImage:!0},l={clientX:o.currentLeft,isImage:!0};if(this.parent.notify(Ei,d),this.parent.notify(Ei,s),this.parent.notify(Ri,h),this.parent.notify(Ri,l),s.size&&(o.currentTop=s.size),l.size&&(o.currentLeft=l.size),o.prevRowIdx=d.clientY,o.prevColIdx=h.clientX,o.currentRowIdx=s.clientY,o.currentColIdx=l.clientX,(a.frozenColumns||a.frozenRows)&&!t.closest(p,".e-sheet-content")){var u=this.parent.frozenColCount(a),f=this.parent.frozenRowCount(a);if(o.currentRowIdx>=f&&o.currentColIdx>=u){var g=parseInt(p.style.top,10),m=parseInt(p.style.left,10);g+=this.parent.sheetModule.contentPanel.scrollTop,g-=this.parent.getColumnHeaderContent().parentElement.getBoundingClientRect().height,m+=this.parent.getScrollElement().scrollLeft,m-=this.parent.sheetModule.getRowHeaderWidth(a),p.style.top=g+"px",p.style.left=m+"px",this.parent.getMainContent().appendChild(p)}}i&&i[0]&&i[0].querySelector(".e-control")&&(o.id=i[0].id),this.originalReorderTop!==this.resizedReorderTop||this.originalReorderLeft!==this.resizedReorderLeft?(o.id=p.id,i&&i[0]?(o.requestType="chartRefresh",this.parent.notify(ki,o)):this.parent.notify(Ii,o),this.resizedReorderTop=this.originalReorderTop,this.resizedReorderLeft=this.originalReorderLeft):this.currenHeight===this.originalHeight&&this.originalWidth===this.currentWidth||(o.id=n.id.indexOf("overlay")>0?n.id:n.parentElement&&n.parentElement.classList.contains("e-ss-overlay")?n.parentElement.id:p.id,i&&i[0]?(o.requestType="chartRefresh",this.parent.notify(ki,o)):this.parent.notify(Ii,o),this.originalHeight=this.currenHeight,this.originalWidth=this.currentWidth)}this.isOverlayClicked=!1}},e.prototype.isOverlaySelected=function(e){e.isOverlayClicked=this.isOverlayClicked},e.prototype.refreshOverlayElem=function(e){if(e){var r=".e-ss-overlay-active"+(e&&e.selector||""),n=this.parent.element.querySelector(r);n&&(t.removeClass([n],"e-ss-overlay-active"),this.parent.notify("removeDesignChart",{}))}else for(var r="e-ss-overlay-active",i=Array.from(this.parent.element.getElementsByClassName(r)),a=0;a<i.length;a++){var o=i[a];o&&(t.removeClass([o],"e-ss-overlay-active"),this.parent.notify("removeDesignChart",{}))}this.parent.notify("clearChartBorder",null)},e.prototype.overlayClickHandler=function(e){if(!this.parent.getActiveSheet().isProtected&&this.parent.allowEditing){this.isOverlayClicked=!0;var r=e.target,n=e.target;r.classList.contains("e-ss-overlay")||(n=r.parentElement,t.closest(e.target,".e-datavisualization-chart")&&(n=t.closest(e.target,".e-datavisualization-chart")));var i=this.parent.getActiveSheet();if((i.frozenColumns||i.frozenRows)&&t.closest(n,".e-sheet-content")){var a=parseInt(n.style.top,10),o=parseInt(n.style.left,10);a-=this.parent.sheetModule.contentPanel.scrollTop,a+=this.parent.getColumnHeaderContent().parentElement.getBoundingClientRect().height,o-=this.parent.getScrollElement().scrollLeft,o+=this.parent.sheetModule.getRowHeaderWidth(i),n.style.top=a+"px",n.style.left=o+"px",this.parent.element.querySelector("#"+this.parent.element.id+"_sheet").appendChild(n)}this.originalWidth=this.currentWidth=parseFloat(n.style.width),this.originalHeight=this.currenHeight=parseFloat(n.style.height),this.originalReorderLeft=parseFloat(n.style.left),this.originalReorderTop=parseFloat(n.style.top),this.resizedReorderLeft=parseFloat(n.style.left),this.resizedReorderTop=parseFloat(n.style.top),this.originalResizeTop=this.originalReorderTop,this.originalResizeLeft=this.originalReorderLeft,this.originalMouseX=Mt(e),this.originalMouseY=Bt(e),this.diffX=this.originalMouseX-this.originalReorderLeft,this.diffY=this.originalMouseY-this.originalReorderTop;var s=document.getElementsByClassName("e-ss-overlay-active")[0];s&&t.removeClass([s],"e-ss-overlay-active"),this.parent.element.querySelector("#"+n.id).classList.add("e-ss-overlay-active"),r.classList.contains("e-ss-resizer")&&(this.resizer=r.classList[0],this.isResizerClicked=!0),n.classList.contains("e-datavisualization-chart")&&(this.parent.notify("focusChartBorder",{id:n.id}),s||this.parent.notify("insertDesignChart",{id:n.id}));var l=n.getBoundingClientRect();this.prevX=l.left,this.prevY=l.top}},e.prototype.renderResizeHandler=function(e){for(var r,n=["e-ss-overlay-t","e-ss-overlay-r","e-ss-overlay-b","e-ss-overlay-l"],i=0;i<n.length;)r=this.parent.createElement("div",{className:n[i]+" e-ss-resizer"+(t.Browser.isDevice?" e-ss-resizer-touch":""),styles:"width: 8px; height: 8px; border-radius: 4px;"}),e.appendChild(r),i++},e.prototype.removeEventListener=function(){var e=this.parent.element.querySelectorAll(".e-ss-overlay");if(e.length)for(var r=0;r<e.length;r++)t.EventHandler.remove(e[r],Rt(),this.overlayClickHandler),t.EventHandler.remove(e[r],Nt(),this.overlayMouseMoveHandler);var n=this.parent.element.querySelector("#"+this.parent.element.id+"_sheet");n&&t.EventHandler.remove(n,Nt(),this.overlayMouseMoveHandler),document&&t.EventHandler.remove(document,Ft(),this.overlayMouseUpHandler),this.parent.isDestroyed||(this.parent.off("overlayEleSize",this.setOriginalSize),this.parent.off(Li,this.isOverlaySelected),this.parent.off(wi,this.refreshOverlayElem),this.parent.off(Gn,this.destroy))},e.prototype.destroy=function(){this.removeEventListener(),this.currentWidth&&(this.currentWidth=null),this.currenHeight&&(this.currenHeight=null),this.minHeight&&(this.minHeight=null),this.minWidth&&(this.minWidth=null),this.isOverlayClicked&&(this.isOverlayClicked=null),this.isResizerClicked&&(this.isResizerClicked=null),this.parent=null},e}(),Co=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),bo=function(){return(bo=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}).apply(this,arguments)},xo=function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},So=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Co(r,e),xo([t.Property("")],r.prototype,"text",void 0),xo([t.Property("")],r.prototype,"iconCss",void 0),xo([t.Property("left")],r.prototype,"iconPosition",void 0),r}(t.ChildProperty),wo=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Co(r,e),xo([t.Complex({},So)],r.prototype,"header",void 0),xo([t.Collection([],i.Item)],r.prototype,"content",void 0),xo([t.Property("")],r.prototype,"cssClass",void 0),xo([t.Property(!1)],r.prototype,"disabled",void 0),r}(t.ChildProperty),Io=function(e){function r(t,r){return e.call(this,t)||this}return Co(r,e),r.prototype.preRender=function(){},r.prototype.render=function(){this.element.id||(this.element.id=t.getUniqueID("ribbon")),this.renderRibbon()},r.prototype.destroy=function(){var r=this.element.querySelector(".e-drop-icon");if(r&&r.removeEventListener("click",this.ribbonExpandCollapse.bind(this)),this.menuItems.length){var n=document.getElementById(this.element.id+"_menu");n&&t.getComponent(n,"menu").destroy()}this.toolbarObj&&this.toolbarObj.destroy(),this.tabObj&&this.tabObj.destroy(),this.element.innerHTML="",this.toolbarObj=null,this.tabObj=null,e.prototype.destroy.call(this)},r.prototype.getTabItems=function(){var e=this,t=[];return this.menuItems.length&&t.push({header:{text:this.initMenu(this.menuItems)},content:this.toolbarObj.element,cssClass:"e-menu-tab"}),this.items.forEach(function(r){t.push({header:r.header,content:e.toolbarObj.element})}),t},r.prototype.initMenu=function(e){var r=this,n=this.createElement("ul",{id:this.element.id+"_menu"});this.element.appendChild(n);var a=new i.Menu({cssClass:"e-file-menu",items:e,showItemOnClick:!0,beforeOpen:function(t){t.parentItem.text===e[0].text&&(a.showItemOnClick=!1),r.trigger("beforeOpen",t)},select:function(e){r.trigger("fileMenuItemSelect",e)},beforeClose:function(n){if("mouseover"===n.event.type&&!t.closest(n.event.target,".e-menu-popup"))return void(n.cancel=!0);r.trigger("beforeClose",n),n.parentItem&&n.parentItem.text!==e[0].text||a.setProperties({showItemOnClick:!0},!0)},beforeItemRender:function(e){r.trigger("beforeFileMenuItemRender",e)},created:function(){a.element.removeAttribute("tabindex");var e=a.element.querySelector(".e-menu-item");e&&e.removeAttribute("tabindex")}});return a.createElement=this.createElement,a.appendTo(n),n.parentElement},r.prototype.renderRibbon=function(){var e,r=this,n=this.createElement("div"),a=this.createElement("div");this.toolbarObj=new i.Toolbar({items:this.items[this.selectedTab].content,clicked:function(e){return r.trigger("clicked",e)}}),this.toolbarObj.createElement=this.createElement,this.toolbarObj.appendTo(a),this.tabObj=new i.Tab({selectedItem:this.getIndex(this.selectedTab),animation:{next:{duration:0},previous:{duration:0}},items:this.getTabItems(),selecting:function(n){if(n.isSwiped)return void(n.cancel=!0);if(e=n.event&&n.event.isShortcut,r.menuItems.length&&0===n.selectingIndex){if(n.cancel=!0,(!n.event||e||"keydown"===n.event.type)&&n.selectingItem){var i=n.selectingItem.querySelector(".e-file-menu .e-menu-item");i&&i.click()}}else{if(n.selectingIndex===r.getIndex(r.selectedTab))return;r.updateToolbar(r.getIndex(n.selectingIndex,!0)),r.toolbarObj.dataBind(),r.refreshTemplateItems(r.toolbarObj),r.element.classList.contains("e-collapsed")&&t.EventHandler.remove(n.selectedItem,"click",r.ribbonExpandCollapse);var a=void 0;r.menuItems.length?((a=bo({},n)).selectingIndex-=1,a.selectedIndex-=1):a=n,r.trigger("selecting",a)}},selected:function(t){t.isInteracted||e||(t.preventFocus=!0),t.selectedIndex!==r.getIndex(r.selectedTab)&&(r.setProperties({selectedTab:r.getIndex(t.selectedIndex,!0)},!0),r.element.classList.contains("e-collapsed")&&(r.element.classList.remove("e-collapsed"),r.trigger("expandCollapse",{element:r.toolbarObj.element,expanded:!0})))},created:function(){r.toolbarObj.refreshOverflow()}}),this.element.appendChild(n),this.tabObj.createElement=this.createElement,this.tabObj.appendTo(n);var o=this.createElement("span",{className:"e-drop-icon e-icons"});o.addEventListener("click",this.ribbonExpandCollapse.bind(this)),this.element.appendChild(o)},r.prototype.ribbonExpandCollapse=function(e){var r,n={element:this.toolbarObj.element,expanded:!0};this.element.classList.contains("e-collapsed")?(r=this.tabObj.element.querySelector(".e-tab-header").getElementsByClassName("e-toolbar-item")[this.tabObj.selectedItem],this.element.classList.remove("e-collapsed"),r.classList.add("e-active"),t.EventHandler.remove(r,"click",this.ribbonExpandCollapse),this.trigger("expandCollapse",n)):(r=this.tabObj.element.querySelector(".e-tab-header .e-toolbar-item.e-active"),this.element.classList.add("e-collapsed"),n.expanded=!1,r.classList.remove("e-active"),t.EventHandler.add(r,"click",this.ribbonExpandCollapse,this),this.trigger("expandCollapse",n))},r.prototype.getIndex=function(e,t){return this.menuItems.length?t?e-1:e+1:e},r.prototype.updateToolbar=function(e){this.toolbarObj.items=this.items[e].content,this.toolbarObj.dataBind()},r.prototype.refreshTemplateItems=function(e){this.spreadInstance&&this.spreadInstance.isReact&&this.spreadInstance.portals&&e&&e.portals&&(this.spreadInstance.portals=this.spreadInstance.portals.concat(e.portals),this.spreadInstance.renderReactTemplates())},r.prototype.enableMenuItems=function(e,r,n){void 0===r&&(r=!0),this.menuItems.length&&t.getComponent(document.getElementById(this.element.id+"_menu"),"menu").enableItems(e,r,n)},r.prototype.hideMenuItems=function(e,r,n){if(void 0===r&&(r=!0),this.menuItems.length){var i=t.getComponent(document.getElementById(this.element.id+"_menu"),"menu");r?i.hideItems(e,n):i.showItems(e,n)}},r.prototype.addMenuItems=function(e,r,n,i){if(void 0===n&&(n=!0),this.menuItems.length){var a=t.getComponent(document.getElementById(this.element.id+"_menu"),"menu");n?a.insertAfter(e.reverse(),r,i):a.insertBefore(e,r,i)}},r.prototype.hideTabs=function(e,t){var r=this;void 0===t&&(t=!0);var n,i,a,o;if(t||(o=this.isAllHidden()),e.forEach(function(e){(n=r.getTabIndex(e,-1))>-1&&(t?r.items[n].cssClass.includes(" e-hide")||(r.items[n].cssClass=r.items[n].cssClass+" e-hide",r.tabObj.items[r.getIndex(n)].cssClass=r.items[n].cssClass,void 0===i&&n===r.selectedTab&&(i=!0),a=!0):r.items[n].cssClass.includes(" e-hide")&&(r.items[n].cssClass=r.items[n].cssClass.replace(" e-hide",""),r.tabObj.items[r.getIndex(n)].cssClass=r.items[n].cssClass,void 0===i&&n===r.selectedTab&&(i=!0),a=!0))}),this.setProperties({items:this.items},!0),this.tabObj.items=this.tabObj.items,this.tabObj.dataBind(),t&&(o=this.isAllHidden())&&(i=!1),!t&&o&&(i=!i),a&&o&&(this.element.classList.contains("e-collapsed")?(this.element.classList.remove("e-collapsed"),this.element.querySelector(".e-drop-icon").classList.remove("e-hide")):(this.element.classList.add("e-collapsed"),this.element.querySelector(".e-drop-icon").classList.add("e-hide"))),i)for(var s=0;s<this.items.length;s++)if(!this.items[s].cssClass.includes(" e-hide")){this.tabObj.selectedItem=this.getIndex(s),this.tabObj.dataBind();break}},r.prototype.isAllHidden=function(){for(var e=!0,t=0;t<this.items.length;t++)if(!this.items[t].cssClass.includes(" e-hide")){e=!1;break}return e},r.prototype.enableTabs=function(e,t){var r=this;void 0===t&&(t=!0),e.forEach(function(e){var n=r.getTabIndex(e,-1);n>-1&&(r.items[n].disabled=!t,n=r.getIndex(n),r.tabObj.enableTab(n,t))}),this.setProperties({items:this.items},!0)},r.prototype.addTabs=function(e,t){var r=this,n=this.getTabIndex(t);e.forEach(function(e){e=new wo(r.items[0],"items",e,!0),r.items.splice(n,0,e),r.tabObj.addTab([{header:e.header,content:r.toolbarObj.element}],r.getIndex(n)),n++}),this.setProperties({items:this.items},!0),this.setProperties({selectedTab:this.getIndex(this.tabObj.selectedItem,!0)},!0)},r.prototype.getTabIndex=function(e,t){if(void 0===t&&(t=this.items.length),e)for(var r=0;r<this.items.length;r++)if(this.items[r].header.text===e){t=r;break}return t},r.prototype.addToolbarItems=function(e,r,n){var a=this,o=this.getTabIndex(e);t.isNullOrUndefined(n)&&(n=this.items[o].content.length),r.forEach(function(e){e=new i.Item(a.items[o].content[0],"content",e,!0),a.items[o].content.splice(n,0,e),n++}),this.setProperties({items:this.items},!0),o===this.selectedTab&&r.length&&this.updateToolbar(o)},r.prototype.enableItems=function(e,t,r){if(void 0===r&&(r=!0),t){var n=this.getTabIndex(e,-1);if(n<0)return;for(var i=0;i<t.length;i++){if("string"==typeof t[i])for(var a=0;a<this.items[n].content.length;a++)if(this.items[n].content[a].id===t[i]){t[i]=a;break}if("string"==typeof t[i]){if(t.length-1>i)continue;return}this.items[n].content[t[i]].disabled=!r,this.setProperties({items:this.items},!0),n===this.selectedTab&&this.toolbarObj.enableItems(t[i],r)}}else this.toolbarObj.disable(!r)},r.prototype.hideToolbarItems=function(e,t,r){var n=this;void 0===r&&(r=!0);for(var i,a,o=0;o<this.items.length;o++)if(this.items[o].header.text===e){i=o,t.forEach(function(e){(a=n.items[i].content[e])&&(r?a.cssClass.includes(" e-hide")||(a.cssClass=a.cssClass+" e-hide"):a.cssClass.includes(" e-hide")&&(a.cssClass=a.cssClass.replace(" e-hide","")))});break}this.setProperties({items:this.items},!0),void 0!==i&&i===this.selectedTab&&this.updateToolbar(i)},r.prototype.getModuleName=function(){return"ribbon"},r.prototype.getPersistData=function(){return this.addOnPersist([])},r.prototype.onPropertyChanged=function(e,t){for(var r=0,n=Object.keys(e);r<n.length;r++)switch(n[r]){case"selectedTab":this.tabObj.selectedItem=this.getIndex(e.selectedTab),this.tabObj.dataBind()}},xo([t.Property("")],r.prototype,"cssClass",void 0),xo([t.Property(!0)],r.prototype,"menuType",void 0),xo([t.Collection([],i.MenuItem)],r.prototype,"menuItems",void 0),xo([t.Property(0)],r.prototype,"selectedTab",void 0),xo([t.Collection([],wo)],r.prototype,"items",void 0),xo([t.Property(null)],r.prototype,"spreadInstance",void 0),xo([t.Event()],r.prototype,"selecting",void 0),xo([t.Event()],r.prototype,"fileMenuItemSelect",void 0),xo([t.Event()],r.prototype,"beforeFileMenuItemRender",void 0),xo([t.Event()],r.prototype,"beforeOpen",void 0),xo([t.Event()],r.prototype,"beforeClose",void 0),xo([t.Event()],r.prototype,"selectFormat",void 0),xo([t.Event()],r.prototype,"clicked",void 0),xo([t.Event()],r.prototype,"created",void 0),xo([t.Event()],r.prototype,"expandCollapse",void 0),r=xo([t.NotifyPropertyChanges],r)}(t.Component),Eo=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.render=function(){var e=this,r=this.parent.element.id,n=this.parent.createElement("input",{attrs:{type:"color"}}),i=function(e){e.element.tabIndex=-1};this.fontColorPicker=new a.ColorPicker({value:"#000000ff",mode:"Palette",showButtons:!1,presetColors:Aa,enableOpacity:!1,cssClass:"e-spreadsheet-color-popup",beforeTileRender:i,beforeClose:function(){return e.beforeCloseHandler(e.fontColorPicker)},open:this.openHandler.bind(this),beforeModeSwitch:function(t){return e.beforeModeSwitch(e.fontColorPicker,t)},change:function(t){var r={style:{color:e.fontColorPicker.getValue(t.currentValue.rgba)},onActionUpdate:!0};e.parent.notify(Yr,r),r.cancel?e.fontColorPicker.setProperties({value:e.fontColorPicker.getValue(t.previousValue.rgba,"HEXA")},!0):e.updateSelectedColor(r.style.color,e.fontColorPicker.element,"TextColor")},created:function(){return e.updateSelectedColor("#000000",e.fontColorPicker.element,"TextColor",!0)}}),this.fontColorPicker.createElement=this.parent.createElement,this.parent.element.appendChild(n),this.fontColorPicker.appendTo(n),n.parentElement.id=r+"_font_color_picker",t.addClass([n.nextElementSibling.getElementsByClassName("e-selected-color")[0]],["e-icons","e-font-color"]),n=this.parent.createElement("input",{attrs:{type:"color"}}),this.filColorPicker=new a.ColorPicker({value:"#ffff00ff",mode:"Palette",presetColors:ka,showButtons:!1,enableOpacity:!1,cssClass:"e-spreadsheet-color-popup",open:this.openHandler.bind(this),beforeTileRender:i,beforeClose:function(){return e.beforeCloseHandler(e.filColorPicker)},beforeModeSwitch:function(t){return e.beforeModeSwitch(e.filColorPicker,t)},change:function(t){var r={style:{backgroundColor:e.filColorPicker.getValue(t.currentValue.rgba)},onActionUpdate:!0};e.parent.notify(Yr,r),r.cancel?e.filColorPicker.setProperties({value:e.filColorPicker.getValue(t.previousValue.rgba,"HEXA")},!0):e.updateSelectedColor(r.style.backgroundColor,e.filColorPicker.element,"FillColor")},created:function(){return e.updateSelectedColor("#ffff00",e.filColorPicker.element,"FillColor",!0)}}),this.filColorPicker.createElement=this.parent.createElement,this.parent.element.appendChild(n),this.filColorPicker.appendTo(n),n.parentElement.id=r+"_fill_color_picker",t.addClass([n.nextElementSibling.getElementsByClassName("e-selected-color")[0]],["e-icons","e-fill-color"])},e.prototype.updateSelectedColor=function(e,t,r,n){var i=this.parent.serviceLocator.getService(Na).getConstant(r);n&&t.parentElement.querySelector(".e-dropdown-btn").setAttribute("aria-label",i);var a=t.parentElement.querySelector(".e-split-colorpicker");a.setAttribute("aria-label",i+" "+e),a.firstElementChild.style.borderBottomColor=e},e.prototype.openHandler=function(e){e.element.querySelector(".e-mode-switch-btn").title=this.parent.serviceLocator.getService(Na).getConstant("MoreColors")},e.prototype.beforeCloseHandler=function(e){e.modeSwitcher||e.setProperties({modeSwitcher:!0},!0),e.showButtons&&e.setProperties({showButtons:!1},!0),or(e.element.parentElement.querySelector(".e-split-colorpicker"))},e.prototype.beforeModeSwitch=function(e,t){var r=this.parent.serviceLocator.getService(Na);"Picker"===t.mode?(e.showButtons=!0,e.dataBind(),t.element.querySelector(".e-apply").title=r.getConstant("Apply"),t.element.querySelector(".e-cancel").title=r.getConstant("Cancel"),t.element.querySelector(".e-mode-switch-btn").title=r.getConstant("StandardColors")):(e.showButtons=!1,e.dataBind(),t.element.querySelector(".e-mode-switch-btn").title=r.getConstant("MoreColors"))},e.prototype.destroy=function(){this.parent&&(this.removeEventListener(),this.fontColorPicker&&this.fontColorPicker.destroy(),this.fontColorPicker=null,this.filColorPicker&&this.filColorPicker.destroy(),this.filColorPicker=null,this.parent=null)},e.prototype.addEventListener=function(){this.parent.on("beforeRibbonCreate",this.render,this),this.parent.on("destroyRibbonComponents",this.destroy,this),this.parent.on(Gn,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("beforeRibbonCreate",this.render),this.parent.off("destroyRibbonComponents",this.destroy),this.parent.off(Gn,this.destroy))},e}(),Ro=function(){function e(e){this.border="1px solid #000000",this.fontNameIndex=5,this.numPopupWidth=0,this.preTabIdx=1,this.spanElements=[],this.iconSetGroupElement=[],this.iconSetElements=[],this.iconWrapElements=[],this.parent=e,this.addEventListener(),new Eo(e)}return e.prototype.getModuleName=function(){return"ribbon"},e.prototype.ribbonOperation=function(e){e&&e.onPropertyChange?this.onPropertyChanged(e.prop):this.initialize()},e.prototype.initialize=function(e){if(this.parent.notify("beforeRibbonCreate",{}),this.parent.isMobileView())this.createMobileView();else{var t=e&&(this.parent.element.querySelector(".e-formula-bar-panel")||document.getElementById(this.parent.element.id+"_sheet_panel"));this.createRibbon(t)}},e.prototype.getRibbonMenuItems=function(){var e=this.parent.serviceLocator.getService(Na),t=this.parent.element.id;return[{text:this.parent.isMobileView()?"":e.getConstant("File"),iconCss:this.parent.isMobileView()?"e-icons e-file-menu-icon":null,id:t+"_File",items:[{text:e.getConstant("New"),id:t+"_New",iconCss:"e-new e-icons"},{text:e.getConstant("Open"),id:t+"_Open",iconCss:"e-open e-icons"},{text:e.getConstant("SaveAs"),iconCss:"e-save e-icons",id:t+"_Save_As",items:[{text:e.getConstant("ExcelXlsx"),id:t+"_Xlsx",iconCss:"e-xlsx e-icons"},{text:e.getConstant("ExcelXls"),id:t+"_Xls",iconCss:"e-xls e-icons"},{text:e.getConstant("CSV"),id:t+"_Csv",iconCss:"e-csv e-icons"},{text:e.getConstant("PDF"),id:t+"_Pdf",iconCss:"e-pdf e-icons"}]},{text:e.getConstant("Print"),id:t+"_Print",iconCss:"e-print e-icons"}]}]},e.prototype.getRibbonItems=function(){var e=this,r=this.parent.element.id,n=this.parent.serviceLocator.getService(Na),i=[{header:{text:n.getConstant("Home")},content:[{prefixIcon:"e-undo-icon",tooltipText:n.getConstant("Undo")+" (Ctrl+Z)",htmlAttributes:{"aria-label":n.getConstant("Undo")},id:r+"_undo",disabled:!0},{prefixIcon:"e-redo-icon",tooltipText:n.getConstant("Redo")+" (Ctrl+Y)",htmlAttributes:{"aria-label":n.getConstant("Redo")},id:r+"_redo",disabled:!0},{type:"Separator",id:r+"_separator_1"},{prefixIcon:"e-cut-icon",tooltipText:n.getConstant("Cut")+" (Ctrl+X)",htmlAttributes:{"aria-label":n.getConstant("Cut")},id:r+"_cut"},{prefixIcon:"e-copy-icon",tooltipText:n.getConstant("Copy")+" (Ctrl+C)",htmlAttributes:{"aria-label":n.getConstant("Copy")},id:r+"_copy"},{tooltipText:n.getConstant("Paste")+" (Ctrl+V)",template:this.getPasteBtn(r,n),id:r+"_paste",disabled:!0},{type:"Separator",id:r+"_separator_2"},{template:this.getNumFormatDDB(r,n),tooltipText:n.getConstant("NumberFormat"),id:r+"_number_format"},{type:"Separator",id:r+"_separator_3"},{template:this.getFontNameDDB(r),tooltipText:n.getConstant("Font"),id:r+"_font_name"},{type:"Separator",id:r+"_separator_4"},{template:this.getFontSizeDDB(r),tooltipText:n.getConstant("FontSize"),id:r+"_font_size"},{type:"Separator",id:r+"_separator_5"},{template:this.getBtn(r,"bold",n.getConstant("Bold")),tooltipText:n.getConstant("Bold")+" (Ctrl+B)",id:r+"_bold"},{template:this.getBtn(r,"italic",n.getConstant("Italic")),tooltipText:n.getConstant("Italic")+" (Ctrl+I)",id:r+"_italic"},{template:this.getBtn(r,"line-through",n.getConstant("Strikethrough")),tooltipText:n.getConstant("Strikethrough")+" (Ctrl+5)",id:r+"_line-through"},{template:this.getBtn(r,"underline",n.getConstant("Underline")),tooltipText:n.getConstant("Underline")+" (Ctrl+U)",id:r+"_underline"},{template:document.getElementById(r+"_font_color_picker"),tooltipText:n.getConstant("TextColor"),id:r+"_font_color_picker"},{type:"Separator",id:r+"_separator_6"},{template:document.getElementById(r+"_fill_color_picker"),tooltipText:n.getConstant("FillColor"),id:r+"_fill_color_picker"},{template:this.getBordersDBB(r),tooltipText:n.getConstant("Borders"),id:r+"_borders"},{template:this.getMergeSplitBtn(r),tooltipText:n.getConstant("MergeCells"),id:r+"_merge_cells",disabled:!0},{type:"Separator",id:r+"_separator_7"},{template:this.getTextAlignDDB(r),tooltipText:n.getConstant("HorizontalAlignment"),id:r+"_text_align"},{template:this.getVerticalAlignDDB(r),tooltipText:n.getConstant("VerticalAlignment"),id:r+"_vertical_align"},{template:this.getBtn(r,"wrap",n.getConstant("WrapText"),!1),tooltipText:""+n.getConstant("WrapText"),id:r+"_wrap"}]},{header:{text:n.getConstant("Insert")},content:[{prefixIcon:"e-hyperlink-icon",text:n.getConstant("Link"),id:r+"_hyperlink",tooltipText:n.getConstant("Link"),click:function(){e.getHyperlinkDlg()}},{prefixIcon:"e-image-icon",text:n.getConstant("Image"),id:r+"_image",tooltipText:n.getConstant("Image"),click:function(){t.select("#"+r+"_imageUpload",e.parent.element).click()}}]},{header:{text:n.getConstant("Formulas")},content:[{prefixIcon:"e-insert-function",tooltipText:n.getConstant("InsertFunction"),text:n.getConstant("InsertFunction"),id:r+"_insert_function"},{type:"Separator",id:r+"_separator_14"},{template:this.createCalcOptions(r,n),tooltipText:n.getConstant("CalcOptionsTip"),id:r+"_calc_types"},{type:"Separator",id:r+"_separator_15"},{prefixIcon:"e-calculate-sheet",tooltipText:n.getConstant("CalcSheetTip"),text:n.getConstant("CalcActiveSheet"),id:r+"_calc_current_sheet",click:function(){e.parent.notify(Kr,{action:"ClearDependentCellCollection"}),e.parent.calculateNow("Sheet")},disabled:"Automatic"===this.parent.calculationMode},{prefixIcon:"e-calculation",tooltipText:n.getConstant("CalcWorkbookTip"),text:n.getConstant("CalcWorkbook"),id:r+"_calc_entire_sheets",click:function(){e.parent.notify(Kr,{action:"ClearDependentCellCollection"}),e.parent.calculateNow("Workbook")},disabled:"Automatic"===this.parent.calculationMode}]},{header:{text:n.getConstant("Data")},content:[{prefixIcon:"e-protect-icon",text:n.getConstant("ProtectSheet"),id:r+"_protect",tooltipText:n.getConstant("ProtectSheet")},{prefixIcon:"e-password-protect-icon",text:n.getConstant("ProtectWorkbook"),id:r+"_protectworkbook",tooltipText:n.getConstant("ProtectWorkbook")},{type:"Separator",id:r+"_separator_8"},{template:this.datavalidationDDB(r),tooltipText:n.getConstant("DataValidation"),id:r+"_datavalidation"}]},{header:{text:n.getConstant("View")},content:[{prefixIcon:"e-hide-headers",text:this.getLocaleText("Headers"),id:r+"_headers",tooltipText:this.getLocaleText("Headers")},{type:"Separator",id:r+"_separator_9"},{prefixIcon:"e-hide-gridlines",text:this.getLocaleText("GridLines"),id:r+"_gridlines",tooltipText:this.getLocaleText("GridLines")},{type:"Separator",id:r+"_separator_13"},{prefixIcon:"e-freeze-pane",text:n.getConstant("FreezePanes"),id:r+"_freezepanes",tooltipText:n.getConstant("FreezePanes"),disabled:!this.parent.allowFreezePane},{prefixIcon:"e-freeze-row",text:n.getConstant("FreezeRows"),id:r+"_freezerows",tooltipText:n.getConstant("FreezeRows"),disabled:!this.parent.allowFreezePane},{prefixIcon:"e-freeze-column",text:n.getConstant("FreezeColumns"),id:r+"_freezecolumns",tooltipText:n.getConstant("FreezeColumns"),disabled:!this.parent.allowFreezePane}]}];return this.parent.allowConditionalFormat&&i.find(function(e){return e.header&&e.header.text===n.getConstant("Home")}).content.push({type:"Separator",id:r+"_separator_10"},{template:this.getCFDBB(r),tooltipText:n.getConstant("ConditionalFormatting"),id:r+"_conditionalformatting"}),this.parent.allowChart&&i.find(function(e){return e.header&&e.header.text===n.getConstant("Insert")}).content.push({type:"Separator",id:r+"_separator_11"},{template:this.getChartDDB(r,!0),text:n.getConstant("Chart"),tooltipText:n.getConstant("Chart"),id:r+"_chart"}),this.parent.allowCellFormatting&&i.find(function(e){return e.header&&e.header.text===n.getConstant("Home")}).content.push({type:"Separator",id:r+"_separator_12"},{template:this.getClearDDB(r),tooltipText:n.getConstant("Clear"),id:r+"_clear"}),(this.parent.allowSorting||this.parent.allowFiltering)&&i.find(function(e){return e.header&&e.header.text===n.getConstant("Home")}).content.push({template:this.getSortFilterDDB(r),tooltipText:n.getConstant("SortAndFilter"),id:r+"_sorting"}),this.parent.allowFindAndReplace&&i.find(function(e){return e.header&&e.header.text===n.getConstant("Home")}).content.push({template:this.getFindBtn(r),prefixIcon:"e-tbar-search-icon tb-icons",tooltipText:n.getConstant("FindReplaceTooltip"),id:r+"_find"}),i},e.prototype.createCalcOptions=function(e,r){var n=t.createElement("button",{id:e+"_calc_types",attrs:{type:"button"},className:"e-calc-types"}),i=t.createElement("span",{className:"e-calc-types-text"});return i.innerText=r.getConstant("CalcOptions"),n.appendChild(i),this.calcTypeOptions=new d.DropDownButton({items:[{id:e+"_Automatic",text:r.getConstant("Automatic"),iconCss:"Automatic"===this.parent.calculationMode?"e-icons e-selected-icon":""},{id:e+"_Manual",text:r.getConstant("Manual"),iconCss:"Manual"===this.parent.calculationMode?"e-icons e-selected-icon":""}],createPopupOnClick:!0,iconCss:"e-calculation e-icons",cssClass:"e-flat e-calc-types"}),this.calcTypeOptions.select=this.selectCalcOptions.bind(this),this.calcTypeOptions.appendTo(n),n},e.prototype.selectCalcOptions=function(e){e.item.id===this.parent.element.id+"_Automatic"?(this.calcTypeOptions.items[0].iconCss="e-icons e-selected-icon",this.calcTypeOptions.items[1].iconCss="","Manual"===this.parent.calculationMode&&this.parent.notify(Kr,{action:"ClearDependentCellCollection"}),this.parent.setProperties({calculationMode:"Automatic"},!0),this.updateFormulaButtons(),this.parent.calculateNow("Workbook")):(this.calcTypeOptions.items[0].iconCss="",this.calcTypeOptions.items[1].iconCss="e-icons e-selected-icon",this.parent.setProperties({calculationMode:"Manual"},!0),this.updateFormulaButtons())},e.prototype.updateFormulaButtons=function(){var e=this.parent.serviceLocator.getService(Na);this.parent.notify("enableToolbarItems",[{tab:e.getConstant("Formulas"),items:[this.parent.element.id+"_calc_current_sheet"],enable:"Manual"===this.parent.calculationMode}]),this.parent.notify("enableToolbarItems",[{tab:e.getConstant("Formulas"),items:[this.parent.element.id+"_calc_entire_sheets"],enable:"Manual"===this.parent.calculationMode}])},e.prototype.getPasteBtn=function(e,t){var r=this,n=this.parent.element.appendChild(this.parent.createElement("button",{id:e+"_paste",attrs:{type:"button"}}));return this.pasteSplitBtn=new d.SplitButton({iconCss:"e-icons e-paste-icon",items:[{text:t.getConstant("All"),id:"All"},{text:t.getConstant("Values"),id:"Values"},{text:t.getConstant("Formats"),id:"Formats"}],createPopupOnClick:!0,select:function(e){r.pasteSplitBtn.element.setAttribute("aria-label",t.getConstant("Paste")+" "+e.item.text),r.parent.notify(ti,{type:e.item.id,isAction:!0,isInternal:!0})},click:function(){n.setAttribute("aria-label",t.getConstant("Paste")),r.parent.notify(ti,{isAction:!0,isInternal:!0})},beforeOpen:function(e){e.element.setAttribute("aria-label",t.getConstant("Paste"))}}),this.pasteSplitBtn.createElement=this.parent.createElement,this.pasteSplitBtn.appendTo(n),n.parentElement},e.prototype.getHyperlinkDlg=function(){var e=this.parent.getActiveSheet(),t=c(e.activeCell),r=He(t[0],t[1],e);r&&r.hyperlink?this.parent.notify("editHyperlink",null):this.parent.notify("initiateHyperlink",null)},e.prototype.passwordProtectDlg=function(){this.parent.password.length>0?this.parent.notify("unProtectWorkbook",null):document.getElementById(this.parent.element.id+"_protectworkbook").classList.contains("e-active")?(document.getElementById(this.parent.element.id+"_protectworkbook").classList.remove("e-active"),this.parent.showSheetTabs&&this.parent.element.querySelector(".e-add-sheet-tab").removeAttribute("disabled")):this.parent.notify("protectWorkbook",null)},e.prototype.getLocaleText=function(e){var t=this.parent.serviceLocator.getService(Na);return this.parent.getActiveSheet()["show"+e]?t.getConstant("Hide"+e):t.getConstant("Show"+e)},e.prototype.getLocaleProtectText=function(e,t){var r,n=this.parent.serviceLocator.getService(Na);return this.parent.getActiveSheet().isProtected?(t&&this.parent.getMainContent().classList.remove("e-hide-"+e.toLowerCase()),r=n.getConstant("Unprotect"+e)):(t&&this.parent.getMainContent().classList.add("e-hide-"+e.toLowerCase()),r=n.getConstant("Protect"+e)),r},e.prototype.getLocaleProtectWorkbook=function(e,t){var r,n=this.parent.serviceLocator.getService(Na);return this.parent.isProtected?(t&&this.parent.getMainContent().classList.remove("e-hide-"+e.toLowerCase()),r=n.getConstant(e)):(t&&this.parent.getMainContent().classList.add("e-hide-"+e.toLowerCase()),r=n.getConstant(e)),r},e.prototype.insertDesignChart=function(){var e=this,t=this.parent.serviceLocator.getService(Na),r=this.ribbon.items.length-1,n=t.getConstant("ChartDesign");if(this.parent.allowChart&&this.ribbon.items[r]&&this.ribbon.items[r].header.text!==n){this.preTabIdx=this.ribbon.selectedTab;var i=this.parent.element.id,a=[{header:{text:n},content:[{template:this.getAddChartEleDBB(i),tooltipText:t.getConstant("AddChartElement"),id:i+"add_chart_ element_chart"},{type:"Separator"},{prefixIcon:"e-switch-row-column-icon",text:t.getConstant("SwitchRowColumn"),tooltipText:t.getConstant("SwitchRowColumn"),id:i+"switch_row_column_chart",click:function(){e.parent.notify(Oi,{switchRowColumn:!0,triggerEvent:!0})}},{type:"Separator"},{template:this.getChartThemeDDB(i),tooltipText:t.getConstant("ChartTheme"),id:i+"_chart_theme"},{type:"Separator"},{template:this.getChartDDB(i,!1),tooltipText:t.getConstant("ChartType"),id:i+"_chart_type"}]}];this.addRibbonTabs({items:a}),this.ribbon.tabObj.select(this.ribbon.items.length)}},e.prototype.removeDesignChart=function(){var e=this.parent.serviceLocator.getService(Na),t=this.ribbon.items.length-1;this.ribbon.items[t]&&this.ribbon.items[t].header.text===e.getConstant("ChartDesign")&&(this.ribbon.tabObj.select(this.preTabIdx+1),this.parent.hideRibbonTabs([e.getConstant("ChartDesign")],!0),document.getElementsByClassName("e-addchart-ddb").length>0&&document.getElementsByClassName("e-addchart-ddb")[0].remove(),document.getElementsByClassName("e-chart-type-ddb").length>0&&document.getElementsByClassName("e-chart-type-ddb")[0].remove(),document.getElementsByClassName("e-charttheme-ddb").length>0&&document.getElementsByClassName("e-charttheme-ddb")[0].remove(),delete this.ribbon.items[t].content[0],this.ribbon.items.length=this.ribbon.items.length-1)},e.prototype.createRibbon=function(e){var t=this.parent.createElement("div",{id:this.parent.element.id+"_ribbon"});this.ribbon=new Io({selectedTab:0,menuItems:this.getRibbonMenuItems(),items:this.getRibbonItems(),fileMenuItemSelect:this.fileMenuItemSelect.bind(this),beforeOpen:this.fileMenuBeforeOpen.bind(this),beforeClose:this.fileMenuBeforeClose.bind(this),clicked:this.toolbarClicked.bind(this),created:this.ribbonCreated.bind(this),selecting:this.tabSelecting.bind(this),expandCollapse:this.expandCollapseHandler.bind(this),beforeFileMenuItemRender:this.beforeRenderHandler.bind(this),spreadInstance:this.parent&&this.parent.isReact?this.parent:null}),this.ribbon.createElement=this.parent.createElement,e?this.parent.element.insertBefore(t,e):this.parent.element.appendChild(t),this.ribbon.appendTo(t)},e.prototype.tabSelecting=function(e){if(e.selectingIndex!==this.ribbon.selectedTab){var t=this.parent.serviceLocator.getService(Na);if(this.ribbon.items[e.selectingIndex]&&this.ribbon.items[e.selectingIndex].header.text===t.getConstant("Insert"))for(n=(r=this.ribbon.items[e.selectingIndex].content).length-1;n>=0;n--)if(r[n].id===this.parent.element.id+"_chart"){(i=r[n].template)&&!i.classList.contains("e-dropdown-btn")&&this.createChartDdb(document.getElementById(this.parent.element.id+"_chart-btn"),!0);break}if(this.ribbon.items[e.selectedIndex]&&this.ribbon.items[e.selectedIndex].header.text===t.getConstant("Insert"))for(var r=this.ribbon.items[e.selectedIndex].content,n=r.length-1;n>=0;n--)if(r[n].id===this.parent.element.id+"_chart"){var i=r[n].template;i&&i.classList.contains("e-dropdown-btn")&&this.destroyComponent(i,"dropdown-btn");break}this.refreshRibbonContent(e.selectingIndex),this.parent.notify("tabSwitch",{activeTab:e.selectingIndex})}},e.prototype.beforeRenderHandler=function(e){var t=this.parent.serviceLocator.getService(Na);e.item.text!==t.getConstant("Open")||this.parent.openUrl&&this.parent.allowOpen||e.element.classList.add("e-disabled"),e.item.text!==t.getConstant("SaveAs")||this.parent.saveUrl&&this.parent.allowSave||e.element.classList.add("e-disabled"),e.item.text!==t.getConstant("Print")||this.parent.allowPrint||e.element.classList.add("e-disabled")},e.prototype.getChartThemeDDB=function(e){var r=this,n=this.parent.serviceLocator.getService(Na),i=this.parent.createElement("button",{id:e+"_chart_theme",attrs:{type:"button"},className:"e-ss-ddb"});i.appendChild(this.parent.createElement("span",{className:"e-tbar-btn-text"}));var a="Material",o=this.parent.element.querySelector(".e-ss-overlay-active");if(o){var s=o.querySelector(".e-chart");s?a=t.getComponent(s,"chart").theme:(s=o.querySelector(".e-accumulationchart"))&&(a=t.getComponent(s,"accumulationchart").theme)}var l=new d.DropDownButton({items:this.getChartThemeDdbItems(a),content:n.getConstant(a),createPopupOnClick:!0,select:function(e){r.parent.notify("selectionComplete",{type:"mousedown"}),e.element&&e.element.querySelector(".e-selected-icon")||(l.content=e.item.text,l.dataBind(),r.parent.notify(Oi,{chartTheme:e.item.id,triggerEvent:!0}),l.setProperties({items:r.getChartThemeDdbItems(e.item.id)},!0))},cssClass:"e-flat e-charttheme-ddb",beforeOpen:function(e){r.tBarDdbBeforeOpen(e.element,e.items,r.parent.serviceLocator.getService(Na).getConstant("Chart"))}});return l.createElement=this.parent.createElement,l.appendTo(i),i},e.prototype.getNumFormatDDB=function(e,t){var r=this,n=this.parent.createElement("button",{id:e+"_number_format",attrs:{type:"button"},className:"e-ss-ddb"}),i=this.parent.createElement("span",{className:"e-tbar-btn-text"});i.innerText=t.getConstant("General"),n.appendChild(i);var a={action:"getLocalizedFormats"};this.parent.notify(kn,a);var o=a.defaultFormats,s=a.localizedFormats;return this.numFormatDDB=new d.DropDownButton({items:this.getNumFormatDdbItems(e),createPopupOnClick:!0,select:function(e){var t=r.parent.serviceLocator.getService(Na);if(e.item.text===t.getConstant("Custom"))r.renderCustomFormatDialog(o,s);else{var n=e.item.id.split(r.parent.element.id+"_")[1],i=Ke(n);r.applyNumFormat(i);var a=r.parent.getActiveSheet();r.refreshNumFormatSelection($e(i,!0),a,t,i);var l=u(a.activeCell);r.refreshTextAlign(a,He(l[0],l[1],a,!1,!0),n,l),r.numFormatDDB.element.setAttribute("aria-label",n),r.parent.showAggregate&&r.parent.notify("showAggregate",{})}},open:function(e){return r.numDDBOpen(e)},beforeItemRender:function(e){return r.previewNumFormat(e)},cssClass:"e-flat e-numformat-ddb",beforeOpen:function(e){r.tBarDdbBeforeOpen(e.element,e.items,r.parent.serviceLocator.getService(Na).getConstant("NumberFormat"))}}),this.numFormatDDB.createElement=this.parent.createElement,this.numFormatDDB.appendTo(n),n},e.prototype.getFontSizeDDB=function(e){var t=this;return this.fontSizeDdb=new d.DropDownButton({cssClass:"e-font-size-ddb",content:"11",createPopupOnClick:!0,items:[{text:"8"},{text:"9"},{text:"10"},{text:"11"},{text:"12"},{text:"14"},{text:"16"},{text:"18"},{text:"20"},{text:"22"},{text:"24"},{text:"26"},{text:"28"},{text:"36"},{text:"48"},{text:"72"}],beforeOpen:function(e){t.tBarDdbBeforeOpen(e.element,e.items,t.parent.serviceLocator.getService(Na).getConstant("FontSize")),t.refreshSelected(t.fontSizeDdb,e.element,"content","text")},select:function(e){var r={style:{fontSize:e.item.text+"pt"},onActionUpdate:!0};t.parent.notify(Yr,r),r.cancel||(t.fontSizeDdb.content=r.style.fontSize.split("pt")[0],t.fontSizeDdb.dataBind()),t.fontSizeDdb.element.setAttribute("aria-label",e.item.text)}}),this.fontSizeDdb.createElement=this.parent.createElement,this.fontSizeDdb.appendTo(this.parent.createElement("button",{id:e+"_font_size",attrs:{type:"button"},className:"e-ss-ddb"})),this.fontSizeDdb.element},e.prototype.getChartDDB=function(e,t){var r,n=this.parent.serviceLocator.getService(Na);if(t)r=this.parent.createElement("button",{id:e+"_chart-btn",attrs:{type:"button"}}),(i=this.parent.createElement("span",{id:e+"_chart"})).innerText=n.getConstant("Chart"),r.appendChild(i);else{r=this.parent.createElement("button",{id:e+"_chart-type-btn",attrs:{type:"button"}});var i=this.parent.createElement("span",{id:e+"_chart_type"});i.innerText=n.getConstant("ChartType"),r.appendChild(i),this.createChartDdb(r,!1)}return r},e.prototype.closeDropdownPopup=function(e){if(e.altKey&&38===e.keyCode||27===e.keyCode){var t=this[1];t&&(t.toggle(),or(t.element))}},e.prototype.createChartDdb=function(e,r){var n,i=this,a=this.parent.serviceLocator.getService(Na),o=r?"e-chart-menu":"e-chart-type-menu",s=this.parent.createElement("ul",{id:this.parent.element.id+(r?"_chart_menu":"_chart_type_menu")}),l=new d.DropDownButton({iconCss:"e-icons "+(r?"e-chart-icon":"e-chart-type-icon"),cssClass:r?"e-chart-ddb":"e-chart-type-ddb",target:s,createPopupOnClick:!0,beforeOpen:function(e){n=i.createChartMenu(s,o,a,l),i.tBarDdbBeforeOpen(e.element,n.items,i.parent.serviceLocator.getService(Na).getConstant("Chart")),t.EventHandler.add(s,"keydown",i.closeDropdownPopup,[i,l])},open:function(){return or(s)},beforeClose:function(e){e.event&&t.closest(e.event.target,"."+o)?e.cancel=!0:(t.EventHandler.remove(s,"keydown",i.closeDropdownPopup),n.destroy())}});l.createElement=this.parent.createElement,l.appendTo(e)},e.prototype.createChartMenu=function(e,r,n,a){var o=this,s=new i.Menu({cssClass:r,items:[{iconCss:"e-icons e-column",text:n.getConstant("Column"),items:[{id:"column_chart"}]},{iconCss:"e-icons e-bar",text:n.getConstant("Bar"),items:[{id:"bar_chart"}]},{iconCss:"e-icons e-area",text:n.getConstant("Area"),items:[{id:"area_chart"}]},{iconCss:"e-icons e-pie-doughnut",text:n.getConstant("PieAndDoughnut"),items:[{id:"pie_doughnut_chart"}]},{iconCss:"e-icons e-line",text:n.getConstant("Line"),items:[{id:"line_chart"}]},{iconCss:"e-icons e-scatter",text:n.getConstant("Scatter"),items:[{id:"scatter_chart"}]}],orientation:"Vertical",beforeOpen:function(e){var r;e.parentItem.text===n.getConstant("Column")?(e.element.firstChild.appendChild(l),r="e-column-chart"):e.parentItem.text===n.getConstant("Bar")?(e.element.firstChild.appendChild(C),r="e-bar-chart"):e.parentItem.text===n.getConstant("Area")?(e.element.firstChild.appendChild(A),r="e-area-chart"):e.parentItem.text===n.getConstant("Line")?(e.element.firstChild.appendChild(P),r="e-line-chart"):e.parentItem.text===n.getConstant("PieAndDoughnut")?(e.element.firstChild.appendChild(W),r="e-pie-doughnut-chart"):e.parentItem.text===n.getConstant("Radar")?(e.element.firstChild.appendChild($),r="e-radar-chart"):e.parentItem.text===n.getConstant("Scatter")&&(e.element.firstChild.appendChild(te),r="e-scatter-chart"),r&&(e.element.parentElement.classList.add(r),t.EventHandler.add(e.element,"keydown",o.menuIconKeyDown.bind(o,r+" .e-menu-icon",0)))},select:function(e){return o.chartSelected(e,a)},beforeItemRender:function(e){e.item.text||e.element.removeAttribute("tabindex")},beforeClose:function(e){e.event&&37===e.event.keyCode?e.cancel=!0:t.EventHandler.remove(e.element,"keydown",o.menuIconKeyDown)}}),l=this.parent.createElement("div",{id:"column_main",className:"e-column-main"}),d=this.parent.createElement("div",{id:"column1_text",className:"e-column1-text"});d.innerText=n.getConstant("Column");var h=this.parent.createElement("div",{id:"column1_cont",className:"e-column1-cont"}),p=this.parent.createElement("div",{id:"column2_cont",className:"e-column2-cont"});l.appendChild(d),l.appendChild(h);var c=n.getConstant("ClusteredColumn"),u=this.parent.createElement("span",{id:"clusteredColumn",className:"e-clusteredcolumn e-column-icon e-menu-icon e-icons",attrs:{title:c,"aria-label":c,tabindex:"-1"}});c=n.getConstant("StackedColumn");var f=this.parent.createElement("span",{id:"stackedColumn",className:"e-stackedcolumn e-column-icon e-menu-icon e-icons",attrs:{title:c,"aria-label":c,tabindex:"-1"}});c=n.getConstant("StackedColumn100");var g=this.parent.createElement("span",{id:"stackedColumn100",className:"e-stackedcolumn100 e-column-icon e-menu-icon e-icons",attrs:{title:c,"aria-label":c,tabindex:"-1"}}),m=this.parent.createElement("span",{id:"clusteredColumn3D",className:"e-clusteredColumn3D e-column-icon"}),v=this.parent.createElement("span",{id:"stackedColumn3D",className:"e-stackedColumn3D e-column-icon"}),y=this.parent.createElement("span",{id:"stackedColumn1003D",className:"e-stackedColumn1003D e-column-icon"});h.appendChild(u),h.appendChild(f),h.appendChild(g),p.appendChild(m),p.appendChild(v),p.appendChild(y);var C=this.parent.createElement("div",{id:"bar_main",className:"e-bar-main"}),b=this.parent.createElement("div",{id:"bar1_text",className:"e-bar1-text"});b.innerText=n.getConstant("Bar");var x=this.parent.createElement("div",{id:"bar1_cont",className:"e-bar1-cont"}),S=this.parent.createElement("div",{id:"bar2_cont",className:"e-bar2-cont"});C.appendChild(b),C.appendChild(x),c=n.getConstant("ClusteredBar");var w=this.parent.createElement("span",{id:"clusteredBar",className:"e-clusteredbar e-bar-icon e-menu-icon e-icons",attrs:{title:c,"aria-label":c,tabindex:"-1"}});c=n.getConstant("StackedBar");var I=this.parent.createElement("span",{id:"stackedBar",className:"e-stackedbar e-bar-icon e-menu-icon e-icons",attrs:{title:c,"aria-label":c,tabindex:"-1"}});c=n.getConstant("StackedBar100");var E=this.parent.createElement("span",{id:"stackedBar100",className:"e-stackedbar100 e-bar-icon e-menu-icon e-icons",attrs:{title:c,"aria-label":c,tabindex:"-1"}}),R=this.parent.createElement("span",{id:"clusteredBar3D",className:"e-clusteredBar3D e-bar-icon"}),N=this.parent.createElement("span",{id:"stackedBar3D",className:"e-stackedBar3D e-bar-icon"}),F=this.parent.createElement("span",{id:"stackedBar1003D",className:"e-stackedBar1003D e-bar-icon"});x.appendChild(w),x.appendChild(I),x.appendChild(E),S.appendChild(R),S.appendChild(N),S.appendChild(F);var A=this.parent.createElement("div",{id:"area_main",className:"e-area-main"}),k=this.parent.createElement("div",{id:"area_text",className:"e-area-text"});k.innerText=n.getConstant("Area");var O=this.parent.createElement("div",{id:"area_cont",className:"e-area-cont"});A.appendChild(k),A.appendChild(O),c=n.getConstant("Area");var T=this.parent.createElement("span",{id:"area",className:"e-area e-area-icon e-menu-icon e-icons",attrs:{title:c,"aria-label":c,tabindex:"-1"}});c=n.getConstant("StackedArea");var D=this.parent.createElement("span",{id:"stackedArea",className:"e-stackedarea e-area-icon e-menu-icon e-icons",attrs:{title:c,"aria-label":c,tabindex:"-1"}});c=n.getConstant("StackedArea100");var L=this.parent.createElement("span",{id:"stackedArea100",className:"e-stackedarea100 e-area-icon e-menu-icon e-icons",attrs:{title:c,"aria-label":c,tabindex:"-1"}});O.appendChild(T),O.appendChild(D),O.appendChild(L);var P=this.parent.createElement("div",{id:"line_main",className:"e-line-main"}),M=this.parent.createElement("div",{id:"line_text",className:"e-line-text"});M.innerText=n.getConstant("Line");var B=this.parent.createElement("div",{id:"line_cont",className:"e-line-cont"}),H=this.parent.createElement("div",{id:"line_cont_marker",className:"e-line-cont"});P.appendChild(M),P.appendChild(B),P.appendChild(H),c=n.getConstant("Line");var U=this.parent.createElement("span",{id:"line",className:"e-line e-line-icon e-menu-icon e-icons",attrs:{title:c,"aria-label":c,tabindex:"-1"}});c=n.getConstant("StackedLine");var V=this.parent.createElement("span",{id:"stackedLine",className:"e-stackedline e-line-icon e-menu-icon e-icons",attrs:{title:c,"aria-label":c,tabindex:"-1"}});c=n.getConstant("StackedLine100");var z=this.parent.createElement("span",{id:"stackedLine100",className:"e-stackedline100 e-line-icon e-menu-icon e-icons",attrs:{title:c,"aria-label":c,tabindex:"-1"}});c=n.getConstant("LineMarker");var j=this.parent.createElement("span",{id:"lineMarker",className:"e-line-marker e-line-icon e-menu-icon e-icons",attrs:{title:c,"aria-label":c,tabindex:"-1"}});c=n.getConstant("StackedLineMarker");var _=this.parent.createElement("span",{id:"stackedLineMarker",className:"e-stackedline-marker e-line-icon e-menu-icon e-icons",attrs:{title:c,"aria-label":c,tabindex:"-1"}});c=n.getConstant("StackedLine100Marker");var q=this.parent.createElement("span",{id:"stackedLine100Marker",className:"e-stackedline100-marker e-line-icon e-menu-icon e-icons",attrs:{title:c,"aria-label":c,tabindex:"-1"}});B.appendChild(U),B.appendChild(V),B.appendChild(z),H.appendChild(j),H.appendChild(_),H.appendChild(q);var W=this.parent.createElement("div",{id:"pie_main",className:"e-pie-main"}),G=this.parent.createElement("div",{id:"pie_text",className:"e-pie-text"});G.innerText=n.getConstant("Pie");var Y=this.parent.createElement("div",{id:"pie_cont",className:"e-pie-cont"});W.appendChild(G),W.appendChild(Y),c=n.getConstant("Pie");var X=this.parent.createElement("span",{id:"pie",className:"e-pie e-pie-icon e-menu-icon e-icons",attrs:{title:c,"aria-label":c,tabindex:"-1"}});c=n.getConstant("Doughnut");var K=this.parent.createElement("span",{id:"doughnut",className:"e-doughnut e-pie-icon e-menu-icon e-icons",attrs:{title:c,"aria-label":c,tabindex:"-1"}});Y.appendChild(X),Y.appendChild(K);var $=this.parent.createElement("div",{id:"radar_main",className:"e-radar-main"}),Z=this.parent.createElement("div",{id:"radar_text",className:"e-radar-text"});Z.innerText=n.getConstant("Radar");var J=this.parent.createElement("div",{id:"radar_cont",className:"e-radar-cont"});$.appendChild(Z),$.appendChild(J);var Q=this.parent.createElement("span",{id:"radar",className:"e-radar e-radar-icon e-menu-icon e-icons",attrs:{tabindex:"-1"}}),ee=this.parent.createElement("span",{id:"radar_markers",className:"e-radar-markers e-radar-icon e-menu-icon e-icons",attrs:{tabindex:"-1"}});Q.title=n.getConstant("BlueDataBar"),ee.title=n.getConstant("GreenDataBar"),J.appendChild(Q),J.appendChild(ee);var te=this.parent.createElement("div",{id:"scatter_main",className:"e-scatter-main"}),re=this.parent.createElement("div",{id:"scatter_text",className:"e-scatter-text"});c=n.getConstant("Scatter"),re.innerText=c;var ne=this.parent.createElement("div",{id:"scatter_cont",className:"e-scatter-cont"});te.appendChild(re),te.appendChild(ne);var ie=this.parent.createElement("span",{id:"scatter",className:"e-scatter e-scatter-icon e-menu-icon e-icons",attrs:{title:c,"aria-label":c,tabindex:"-1"}});return ne.appendChild(ie),s.createElement=this.parent.createElement,s.appendTo(e),e.classList.add("e-ul"),s},e.prototype.getAddChartEleDBB=function(e){var r,n=this,i=this.parent.serviceLocator.getService(Na),a=this.parent.createElement("ul",{id:e+"_add_chart_menu"});this.addChartDdb=new d.DropDownButton({iconCss:"e-icons e-addchart-icon",cssClass:"e-addchart-ddb",target:a,createPopupOnClick:!0,close:function(){return or(n.parent.element)},beforeOpen:function(e){r=n.createAddChartMenu(a,i),n.tBarDdbBeforeOpen(e.element,r.items),t.EventHandler.add(a,"keydown",n.closeDropdownPopup,[n,n.addChartDdb])},open:function(){return or(a)},beforeClose:function(e){e.event&&t.closest(e.event.target,".e-addchart-menu")?e.cancel=!0:(t.EventHandler.remove(a,"keydown",n.closeDropdownPopup),r.destroy())}}),this.addChartDdb.createElement=this.parent.createElement;var o=this.parent.createElement("button",{id:e+"_addchart",attrs:{type:"button"}}),s=this.parent.createElement("span",{id:e+"_chart"});return s.innerText=i.getConstant("AddChartElement"),o.appendChild(s),this.addChartDdb.appendTo(o),this.addChartDdb.element},e.prototype.createAddChartMenu=function(e,r){var n=this,a=new i.Menu({cssClass:"e-addchart-menu",title:r.getConstant("AddChartElement"),items:[{iconCss:"e-icons e-axes",text:r.getConstant("Axes"),items:[{iconCss:"e-icons e-ph-axes",id:"PHAxes",text:r.getConstant("PrimaryHorizontal")},{iconCss:"e-icons e-pv-axes",id:"PVAxes",text:r.getConstant("PrimaryVertical")}]},{iconCss:"e-icons e-axis-title",text:r.getConstant("AxisTitle"),items:[{iconCss:"e-icons e-ph-axistitle",id:"PHAxisTitle",text:r.getConstant("PrimaryHorizontal")},{iconCss:"e-icons e-pv-axistitle",id:"PVAxisTitle",text:r.getConstant("PrimaryVertical")}]},{iconCss:"e-icons e-chart-title",text:r.getConstant("ChartTitle"),items:[{iconCss:"e-icons e-ct-none",id:"ChartTitleNone",text:r.getConstant("None")},{iconCss:"e-icons e-ct-abovechart",id:"ChartTitleAbove",text:r.getConstant("AboveChart")}]},{iconCss:"e-icons e-data-labels",id:this.parent.element.id+"data-labels",text:r.getConstant("DataLabels"),items:[{iconCss:"e-icons e-dl-none",id:"DLNone",text:r.getConstant("None")},{iconCss:"e-icons e-dl-center",id:"DLCenter",text:r.getConstant("Center")},{iconCss:"e-icons e-dl-insideend",id:"DLInsideend",text:r.getConstant("InsideEnd")},{iconCss:"e-icons e-dl-insidebase",id:"DLInsidebase",text:r.getConstant("InsideBase")},{iconCss:"e-icons e-dl-outsideend",id:"DLOutsideend",text:r.getConstant("OutsideEnd")}]},{iconCss:"e-icons e-gridlines",text:r.getConstant("Gridlines"),items:[{iconCss:"e-icons e-gl-major-horizontal",id:"GLMajorHorizontal",text:r.getConstant("PrimaryMajorHorizontal")},{iconCss:"e-icons e-gl-major-vertical",id:"GLMajorVertical",text:r.getConstant("PrimaryMajorVertical")},{iconCss:"e-icons e-gl-minor-horizontal",id:"GLMinorHorizontal",text:r.getConstant("PrimaryMinorHorizontal")},{iconCss:"e-icons e-gl-minor-vertical",id:"GLMinorVertical",text:r.getConstant("PrimaryMinorVertical")}]},{iconCss:"e-icons e-legends",text:r.getConstant("Legends"),items:[{iconCss:"e-icons e-legends-none",id:"LegendNone",text:r.getConstant("None")},{iconCss:"e-icons e-legends-right",id:"LegendsRight",text:r.getConstant("Right")},{iconCss:"e-icons e-legends-left",id:"LegendsLeft",text:r.getConstant("Left")},{iconCss:"e-icons e-legends-bottom",id:"LegendsBottom",text:r.getConstant("Bottom")},{iconCss:"e-icons e-legends-top",id:"LegendsTop",text:r.getConstant("Top")}]}],orientation:"Vertical",select:this.addChartEleSelected.bind(this),beforeOpen:function(e){if(e.parentItem.id===n.parent.element.id+"data-labels"){var i=n.parent.element.querySelector(".e-ss-overlay-active");if(i){var a=i.querySelector(".e-chart");if(a){var o=t.getComponent(a,"chart");if(o.series[0]&&o.series[0].type.includes("Line")){var s=function(e,t){if(e){var n=e.parentElement;n.innerHTML="",n.appendChild(e),n.appendChild(document.createTextNode(r.getConstant(t)))}};s(e.element.querySelector(".e-dl-insideend"),"Above"),s(e.element.querySelector(".e-dl-insidebase"),"Below");var l=e.element.querySelector(".e-dl-outsideend");l&&(l.parentElement.style.display="none")}}}}}});return a.createElement=this.parent.createElement,a.appendTo(e),e.classList.add("e-ul"),a},e.prototype.getCFDBB=function(e){var r,n=this,i=this.parent.createElement("ul",{id:e+"_cf_menu"});return this.cfDdb=new d.DropDownButton({iconCss:"e-icons e-conditionalformatting-icon",cssClass:"e-cf-ddb",target:i,createPopupOnClick:!0,close:function(){return or(n.parent.element)},beforeOpen:function(e){r=n.createCFMenu(i),n.tBarDdbBeforeOpen(e.element,r.items,n.parent.serviceLocator.getService(Na).getConstant("ConditionalFormatting")),t.EventHandler.add(i,"keydown",n.closeDropdownPopup,[n,n.cfDdb])},open:function(){return or(i)},beforeClose:function(e){e.event&&t.closest(e.event.target,".e-cf-menu")?e.cancel=!0:(t.EventHandler.remove(i,"keydown",n.closeDropdownPopup),r&&r.element&&(br(n.spanElements),n.spanElements=[],br(n.iconWrapElements),n.iconWrapElements=[],br(n.iconSetElements),n.iconSetElements=[],br(n.iconSetGroupElement),n.iconSetGroupElement=[],r.destroy(),r.element.remove()))}}),this.cfDdb.createElement=this.parent.createElement,this.cfDdb.appendTo(this.parent.createElement("button",{id:e+"_conditionalformatting",attrs:{type:"button"}})),this.cfDdb.element},e.prototype.createCFMenu=function(e){var r=this,n=this.parent.serviceLocator.getService(Na),a=function(e,t,i){var a;e.forEach(function(e){a=n.getConstant(e+t);var o=r.parent.createElement("span",{id:e+t,className:"e-"+e.toLowerCase()+" e-cf-icon",attrs:{title:a,"aria-label":a,tabindex:"-1"}});r.spanElements.push(o),i.appendChild(o)})},o=new i.Menu({cssClass:"e-cf-menu",items:[{iconCss:"e-icons e-hlcellrules",text:n.getConstant("HighlightCellsRules"),items:[{iconCss:"e-icons e-greaterthan",id:"cf_greaterthan_dlg",text:n.getConstant("GreaterThan")+"..."},{iconCss:"e-icons e-lessthan",id:"cf_lessthan_dlg",text:n.getConstant("LessThan")+"..."},{iconCss:"e-icons e-between",id:"cf_between_dlg",text:n.getConstant("Between")+"..."},{iconCss:"e-icons e-equalto",id:"cf_eqaulto_dlg",text:n.getConstant("CFEqualTo")+"..."},{iconCss:"e-icons e-textcontains",id:"cf_textcontains_dlg",text:n.getConstant("TextThatContains")+"..."},{iconCss:"e-icons e-adateoccuring",id:"cf_adateoccuring_dlg",text:n.getConstant("ADateOccuring")+"..."},{iconCss:"e-icons e-duplicate",id:"cf_duplicatevalues_dlg",text:n.getConstant("DuplicateValues")+"..."}]},{iconCss:"e-icons e-topbottomrules",text:n.getConstant("TopBottomRules"),items:[{iconCss:"e-icons e-top10items",id:"cf_top10items_dlg",text:n.getConstant("Top10Items")+"..."},{iconCss:"e-icons e-top10",id:"cf_top10_dlg",text:n.getConstant("Top10")+" %..."},{iconCss:"e-icons e-bottom10items",id:"cf_bottom10items_dlg",text:n.getConstant("Bottom10Items")+"..."},{iconCss:"e-icons e-bottom10",id:"cf_bottom10_dlg",text:n.getConstant("Bottom10")+" %..."},{iconCss:"e-icons e-aboveaverage",id:"cf_aboveaverage_dlg",text:n.getConstant("AboveAverage")+"..."},{iconCss:"e-icons e-belowaverage",id:"cf_belowaverage_dlg",text:n.getConstant("BelowAverage")+"..."}]},{iconCss:"e-icons e-databars",text:n.getConstant("DataBars"),items:[{id:"db_icons1"},{id:"db_icons2"}]},{iconCss:"e-icons e-colorscales",text:n.getConstant("ColorScales"),items:[{id:"cs_icons1"},{id:"cs_icons2"},{id:"cs_icons3"}]},{iconCss:"e-icons e-iconsets",text:n.getConstant("IconSets"),items:[{id:"is_icons"}]},{iconCss:"e-icons e-clearrules",text:n.getConstant("ClearRules"),items:[{id:"cf_cr_cells",text:n.getConstant("SelectedCells")},{id:"cf_cr_sheet",text:n.getConstant("EntireSheet")}]}],orientation:"Vertical",beforeOpen:function(e){if("e-icons e-databars"===e.parentItem.iconCss)e.element.parentElement.classList.add("e-databars"),a(["Blue","Green","Red"],"DataBar",e.element.firstChild),a(["Orange","LightBlue","Purple"],"DataBar",e.element.lastChild),t.EventHandler.add(e.element,"keydown",r.menuIconKeyDown.bind(r,"e-cf-icon",3));else if("e-icons e-colorscales"===e.parentItem.iconCss)e.element.parentElement.classList.add("e-colorscales"),a(["GYR","RYG","GWR","RWG"],"ColorScale",e.element.firstChild),a(["BWR","RWB","WR","RW"],"ColorScale",e.element.querySelector("#cs_icons2")),a(["GW","WG","GY","YG"],"ColorScale",e.element.lastChild),t.EventHandler.add(e.element,"keydown",r.menuIconKeyDown.bind(r,"e-cf-icon",4));else if("e-icons e-iconsets"===e.parentItem.iconCss){e.element.parentElement.classList.add("e-iconsets");var i=r.parent.createElement("div",{id:"is",className:"e-is"});r.iconSetGroupElement.push(i);var o,s,l,d;[{hdr:"Directional"},{cont:[{cls:"3arrows",key:"ThreeArrowsColor",id:"ThreeArrows",count:3},{cls:"3arrowsgray",key:"ThreeArrowsGray",count:3},{cls:"3triangles",key:"ThreeTriangles",count:3},{cls:"4arrowsgray",key:"FourArrowsGray",count:4},{cls:"4arrows",key:"FourArrowsColor",id:"FourArrows",count:4},{cls:"5arrowsgray",key:"FiveArrowsGray",count:5},{cls:"5arrows",key:"FiveArrowsColor",id:"FiveArrows",count:5}]},{hdr:"Shapes"},{cont:[{cls:"3trafficlights",key:"ThreeTrafficLights1",count:3},{cls:"3rafficlights2",key:"ThreeTrafficLights2",count:3},{cls:"3signs",key:"ThreeSigns",count:3},{cls:"4trafficlights",key:"FourTrafficLights",count:4},{cls:"4redtoblack",key:"RedToBlack",id:"FourRedToBlack",count:4}]},{hdr:"Indicators"},{cont:[{cls:"3symbols",key:"ThreeSymbols1",id:"ThreeSymbols",count:3},{cls:"3symbols2",key:"ThreeSymbols2",count:3},{cls:"3flags",key:"ThreeFlags",count:3}]},{hdr:"Ratings"},{cont:[{cls:"3stars",key:"ThreeStars",count:3},{cls:"4rating",key:"FourRatings",id:"FourRating",count:4},{cls:"5quarters",key:"FiveQuarters",count:5},{cls:"5rating",key:"FiveRatings",id:"FiveRating",count:5},{cls:"5boxes",key:"FiveBoxes",count:5}]}].forEach(function(e,t){o=r.parent.createElement("div",{id:"is"+(t+1),className:"e-is"+(t+1)}),r.iconSetElements.push(o),e.hdr?o.innerText=n.getConstant(e.hdr):e.cont.forEach(function(e){for(l=n.getConstant(e.key),s=r.parent.createElement("div",{id:e.id||e.key,className:"e-"+e.cls+" e-is-wrapper",attrs:{title:l,"aria-label":l,tabindex:"-1"}}),r.iconWrapElements.push(s),d=0;d<e.count;d++){var t=r.createElement("span","e-"+e.cls+"-"+(d+1)+" e-iconsetspan");r.spanElements.push(t),s.appendChild(t)}o.appendChild(s)}),i.appendChild(o)}),e.element.firstChild.appendChild(i),t.EventHandler.add(e.element,"keydown",r.menuIconKeyDown.bind(r,"e-is-wrapper",0))}},select:this.cfSelected.bind(this),beforeItemRender:function(e){(e.item.id.includes("db_icons")||e.item.id.includes("cs_icons")||"is_icons"===e.item.id)&&e.element.removeAttribute("tabindex")},beforeClose:function(e){var n=["e-icons e-databars","e-icons e-colorscales","e-icons e-iconsets"].indexOf(e.parentItem.iconCss)>-1;e.cancel=e.event&&37===e.event.keyCode&&n,n&&!e.cancel&&t.EventHandler.remove(e.element,"keydown",r.menuIconKeyDown)}});return o.createElement=this.parent.createElement,o.appendTo(e),e.classList.add("e-ul"),o},e.prototype.menuIconKeyDown=function(e,t,r){var n,i=[];if(r){if(40===r.keyCode||39===r.keyCode||38===r.keyCode||37===r.keyCode)if(r.preventDefault(),i=[].slice.call(document.querySelectorAll("."+e)),-1===(n=i.indexOf(r.target)))n=0;else if(39===r.keyCode)++n===i.length&&(n=0);else if(37===r.keyCode)-1===--n&&(n=i.length-1);else if(!e.includes("e-menu-icon")){var a=i.length,o=void 0,s=void 0;t||(t=2,40===r.keyCode?(o=[6,11,14,19],s=[5,10,13]):(o=[7,12,15],s=[8,13,16]),a--),40===r.keyCode?n===a-1?n=0:(n+=o&&o.indexOf(n)>-1?1:s&&s.indexOf(n)>-1?3:t,o&&a++,n>=a&&(n=n-a+1)):0===n?n=a-1:(n-=o&&o.indexOf(n)>-1?1:s&&s.indexOf(n)>-1?3:t)<0&&(n=o?a:a+n-1)}}else n=0,i=[].slice.call(document.querySelectorAll("."+e));i[n]&&or(i[n])},e.prototype.createElement=function(e,t){return this.parent.createElement(e,{className:t})},e.prototype.getBordersDBB=function(e){var r=this,n=this.parent.createElement("ul",{id:e+"_borders_menu"});this.cPickerEle=this.parent.createElement("input",{id:e+"_cell_border_color",attrs:{type:"color"}}),this.parent.element.appendChild(this.cPickerEle),this.colorPicker=new a.ColorPicker({cssClass:"e-border-colorpicker",mode:"Palette",inline:!0,beforeTileRender:function(e){e.element.tabIndex=-1},change:function(e){var t=r.border.split(" ");t[2]=e.currentValue.hex,r.border=t.join(" ")}}),this.colorPicker.createElement=this.parent.createElement,this.colorPicker.appendTo(this.cPickerEle);var i;return this.bordersDdb=new d.DropDownButton({iconCss:"e-icons e-bottom-borders",cssClass:"e-borders-ddb",target:n,createPopupOnClick:!0,beforeOpen:function(e){i=r.createBorderMenu(n),r.tBarDdbBeforeOpen(e.element,i.items,r.parent.serviceLocator.getService(Na).getConstant("Borders"),1),t.EventHandler.add(n,"keydown",r.closeDropdownPopup,[r,r.bordersDdb])},open:function(){return or(n)},beforeClose:function(e){e.event&&t.closest(e.event.target,".e-borders-menu")?e.cancel=!0:(t.EventHandler.remove(n,"keydown",r.closeDropdownPopup),i.destroy())},close:function(){return or(r.bordersDdb.element)}}),this.bordersDdb.createElement=this.parent.createElement,this.bordersDdb.appendTo(this.parent.createElement("button",{id:e+"_borders",attrs:{type:"button"}})),this.bordersDdb.element},e.prototype.createBorderMenu=function(e){var r=this,n=this.parent.serviceLocator.getService(Na),a=this.parent.element.id,o=new i.Menu({cssClass:"e-borders-menu",items:[{iconCss:"e-icons e-top-borders",text:n.getConstant("TopBorders"),id:a+"_border_topborders"},{iconCss:"e-icons e-left-borders",text:n.getConstant("LeftBorders"),id:a+"_border_leftborders"},{iconCss:"e-icons e-right-borders",text:n.getConstant("RightBorders"),id:a+"_border_rightborders"},{iconCss:"e-icons e-bottom-borders",text:n.getConstant("BottomBorders"),id:a+"_border_bottomborders"},{iconCss:"e-icons e-all-borders",text:n.getConstant("AllBorders"),id:a+"_border_allborders"},{iconCss:"e-icons e-horizontal-borders",text:n.getConstant("HorizontalBorders"),id:a+"_border_horizontalborders"},{iconCss:"e-icons e-vertical-borders",text:n.getConstant("VerticalBorders"),id:a+"_border_verticalborders"},{iconCss:"e-icons e-outside-borders",text:n.getConstant("OutsideBorders"),id:a+"_border_outsideborders"},{iconCss:"e-icons e-inside-borders",text:n.getConstant("InsideBorders"),id:a+"_border_insideborders"},{iconCss:"e-icons e-no-borders",text:n.getConstant("NoBorders"),id:a+"_border_noborders"},{separator:!0},{text:n.getConstant("BorderColor"),items:[{id:a+"_border_colors"}],id:a+"_border_bordercolor"},{text:n.getConstant("BorderStyle"),items:[{iconCss:"e-icons e-selected-icon",id:a+"_1px"},{id:a+"_2px"},{id:a+"_3px"},{id:a+"_dashed"},{id:a+"_dotted"},{id:a+"_double"}]}],orientation:"Vertical",beforeOpen:function(e){if(e.parentItem.id===a+"_border_bordercolor"){r.colorPicker.refresh();var t=r.colorPicker.element.parentElement;e.element.firstElementChild.appendChild(t),t.style.display="inline-block",e.element.parentElement.classList.add("e-border-color"),e.element.firstElementChild.removeAttribute("tabindex")}else e.element.classList.add("e-border-style")},beforeClose:function(e){if(e.event&&e.parentItem.id===a+"_border_bordercolor")if(!t.closest(e.event.target,".e-border-colorpicker")||t.closest(e.event.target,".e-apply")||t.closest(e.event.target,".e-cancel")){r.colorPicker=t.getComponent(r.cPickerEle,"colorpicker"),"Picker"===r.colorPicker.mode&&(r.colorPicker.mode="Palette",r.colorPicker.dataBind());var n=r.colorPicker.element.parentElement;n.style.display="",r.parent.element.appendChild(n)}else e.cancel=!0},onOpen:function(e){if(e.parentItem.id===a+"_border_bordercolor"){e.element.parentElement.style.overflow="visible";var t=e.element.querySelector(".e-color-palette .e-palette");t&&or(t)}},onClose:function(){return or(o.element)},select:function(e){r.borderSelected(e,o)}});return o.createElement=this.parent.createElement,o.appendTo(e),e.classList.add("e-ul"),o},e.prototype.chartSelected=function(e,r){var n=!t.isNullOrUndefined(t.closest(e.element,".e-chart-menu")),i=e.element.id;if("column_chartbar_chartarea_chartpie_doughnut_chartline_chartradar_chartscatter_chart".includes(i)){!e.item||e.item.items&&e.item.items.length||r.toggle();var a=e.event.target.id;this.parent.notify("insertChart",{action:i,id:a,isChart:n})}},e.prototype.addChartEleSelected=function(e){var t=e.element.id;this.parent.notify(Oi,{addChartEle:t,triggerEvent:!0}),!e.item||e.item.items&&e.item.items.length||this.addChartDdb.toggle()},e.prototype.cfSelected=function(e){var t=this.parent.getActiveSheet();if(e.item.id.includes("_dlg"))this.parent.notify("renderCFDlg",{action:e.item.text});else{var r=e.item.id.includes("icons");if(r||"cf_cr_cells"===e.item.id||"cf_cr_sheet"===e.item.id)if(oe(this.parent,w(c(t.selectedRange))))this.parent.notify(yi,null);else if(r){var n=e.event.target;this.parent.notify(yn,{cfModel:{type:n.id||n.parentElement.id,range:t.selectedRange},isAction:!0})}else"cf_cr_cells"===e.item.id?this.parent.notify(bn,{range:t.selectedRange,isAction:!0}):"cf_cr_sheet"===e.item.id&&(this.parent.conditionalFormat=null,this.parent.notify(bn,{isAction:!0}))}!e.item||e.item.items&&e.item.items.length||this.cfDdb.toggle()},e.prototype.borderSelected=function(e,t){this.bordersDdb.element.setAttribute("aria-label",e.item.text);var r=this.parent.element.id;if(!e.item.items.length&&e.item.id!==r+"_border_colors"){if(!e.item.text){var n=this.border.split(" "),i="solid"===n[1]?r+"_"+n[0]:r+"_"+n[1];if(i===e.item.id)return;return e.item.id===r+"_1px"||e.item.id===r+"_2px"||e.item.id===r+"_3px"?(n[0]=e.item.id.split(r+"_")[1],n[1]="solid"):(n[1]=e.item.id.split(r+"_")[1],n[0]="double"===n[1]?"3px":"1px"),this.border=n.join(" "),t.items[12].items.forEach(function(t){t.id===i&&(t.iconCss=null),t.id===e.item.id&&(t.iconCss="e-icons e-selected-icon")}),void t.setProperties({items:t.items},!0)}switch(this.bordersDdb.toggle(),this.parent.showSpinner(),e.item.id){case r+"_border_topborders":this.parent.notify(Yr,{style:{borderTop:this.border},onActionUpdate:!0});break;case r+"_border_leftborders":this.parent.notify(Yr,{style:{borderLeft:this.border},onActionUpdate:!0});break;case r+"_border_rightborders":this.parent.notify(Yr,{style:{borderRight:this.border},onActionUpdate:!0});break;case r+"_border_bottomborders":this.parent.notify(Yr,{style:{borderBottom:this.border},onActionUpdate:!0});break;case r+"_border_allborders":this.parent.notify(Yr,{style:{border:this.border},onActionUpdate:!0});break;case r+"_border_horizontalborders":this.parent.notify(Yr,{style:{border:this.border},onActionUpdate:!0,borderType:"Horizontal"});break;case r+"_border_verticalborders":this.parent.notify(Yr,{style:{border:this.border},onActionUpdate:!0,borderType:"Vertical"});break;case r+"_border_outsideborders":this.parent.notify(Yr,{style:{border:this.border},onActionUpdate:!0,borderType:"Outer"});break;case r+"_border_insideborders":this.parent.notify(Yr,{style:{border:this.border},onActionUpdate:!0,borderType:"Inner"});break;case r+"_border_noborders":this.parent.notify(Yr,{style:{border:""},onActionUpdate:!0})}this.parent.hideSpinner()}},e.prototype.getFontNameDDB=function(e){var t=this,r=this.parent.createElement("button",{id:e+"_font_name",attrs:{type:"button"},className:"e-ss-ddb"}),n=this.parent.createElement("span",{className:"e-tbar-btn-text"});return n.innerText="Calibri",r.appendChild(n),this.fontNameDdb=new d.DropDownButton({cssClass:"e-font-family",items:this.getFontFamilyItems(),createPopupOnClick:!0,select:function(e){var n={style:{fontFamily:e.item.text},onActionUpdate:!0};t.parent.notify(Yr,n),r.setAttribute("aria-label",e.item.text),n.cancel||t.refreshFontNameSelection(n.style.fontFamily)},beforeOpen:function(e){t.tBarDdbBeforeOpen(e.element,e.items,t.parent.serviceLocator.getService(Na).getConstant("Font"))}}),this.fontNameDdb.createElement=this.parent.createElement,this.fontNameDdb.appendTo(r),r},e.prototype.getBtn=function(e,t,r,n){void 0===n&&(n=!0);var i=new o.Button({iconCss:"e-icons e-"+t+"-icon",cssClass:"e-flat",isToggle:!0});return i.createElement=this.parent.createElement,i.appendTo(this.parent.createElement("button",{id:e+"_"+t,attrs:{"aria-label":r,type:"button"}})),n&&i.element.addEventListener("click",this.toggleBtnClicked.bind(this)),i.element},e.prototype.datavalidationDDB=function(e){var t,r=this,n=this.parent.serviceLocator.getService(Na);return this.datavalidationDdb=new d.DropDownButton({cssClass:"e-datavalidation-ddb",iconCss:"e-datavalidation-icon e-icons",content:n.getConstant("DataValidation"),items:[{text:n.getConstant("DataValidation")},{text:n.getConstant("HighlightInvalidData")},{text:n.getConstant("ClearHighlight")},{text:n.getConstant("ClearValidation")}],createPopupOnClick:!0,beforeOpen:function(e){r.refreshSelected(r.datavalidationDdb,e.element,"iconCss"),e.element.setAttribute("aria-label",n.getConstant("DataValidation"))},select:function(e){switch(e.item.text){case n.getConstant("DataValidation"):r.parent.notify("initiatedatavalidation",null);break;case n.getConstant("HighlightInvalidData"):r.parent.notify(ui,{});break;case n.getConstant("ClearHighlight"):r.parent.notify(ui,{isRemoveHighlight:!0});break;case n.getConstant("ClearValidation"):r.parent.notify(Ci,{isAction:!0});break;default:t=e.item.text===n.getConstant("SortAscending")?"Ascending":"Descending",r.parent.notify("applySort",{sortOptions:{sortDescriptors:{order:t}}})}r.datavalidationDdb.element.setAttribute("aria-label",e.item.text)}}),this.datavalidationDdb.createElement=this.parent.createElement,this.datavalidationDdb.appendTo(this.parent.createElement("button",{id:e+"_datavalidation",attrs:{type:"button"},className:"e-ss-ddb"})),this.datavalidationDdb.element},e.prototype.getTextAlignDDB=function(e){var t=this,r=this.parent.serviceLocator.getService(Na);return this.textAlignDdb=new d.DropDownButton({cssClass:"e-align-ddb",iconCss:"e-icons e-left-icon",items:[{iconCss:"e-icons e-left-icon"},{iconCss:"e-icons e-center-icon"},{iconCss:"e-icons e-right-icon"}],beforeItemRender:this.alignItemRender.bind(this),createPopupOnClick:!0,beforeOpen:function(e){t.refreshSelected(t.textAlignDdb,e.element,"iconCss"),e.element.setAttribute("aria-label",r.getConstant("HorizontalAlignment"))},select:function(e){var n={style:{textAlign:e.item.iconCss.split(" e-")[1].split("-icon")[0]},onActionUpdate:!0};t.parent.notify(Yr,n),n.cancel||(t.textAlignDdb.iconCss="e-icons e-"+n.style.textAlign+"-icon",t.textAlignDdb.dataBind()),t.textAlignDdb.element.setAttribute("aria-label",r.getConstant("HorizontalAlignment")+" "+r.getConstant("Align"+t.getAlignText(e)))}}),this.textAlignDdb.createElement=this.parent.createElement,this.textAlignDdb.appendTo(this.parent.createElement("button",{id:e+"_text_align",attrs:{type:"button"},className:"e-ss-ddb"})),this.textAlignDdb.element},e.prototype.getVerticalAlignDDB=function(e){var t=this,r=this.parent.serviceLocator.getService(Na);return this.verticalAlignDdb=new d.DropDownButton({cssClass:"e-align-ddb",iconCss:"e-icons e-bottom-icon",items:[{iconCss:"e-icons e-top-icon"},{iconCss:"e-icons e-middle-icon"},{iconCss:"e-icons e-bottom-icon"}],beforeItemRender:this.alignItemRender.bind(this),createPopupOnClick:!0,beforeOpen:function(e){t.refreshSelected(t.verticalAlignDdb,e.element,"iconCss"),e.element.setAttribute("aria-label",r.getConstant("VerticalAlignment"))},select:function(e){var n={style:{verticalAlign:e.item.iconCss.split(" e-")[1].split("-icon")[0]},onActionUpdate:!0};t.parent.notify(Yr,n),n.cancel||(t.verticalAlignDdb.iconCss="e-icons e-"+n.style.verticalAlign+"-icon",t.verticalAlignDdb.dataBind()),t.verticalAlignDdb.element.setAttribute("aria-label",r.getConstant("VerticalAlignment")+" "+r.getConstant("Align"+t.getAlignText(e)))}}),this.verticalAlignDdb.createElement=this.parent.createElement,this.verticalAlignDdb.appendTo(this.parent.createElement("button",{id:e+"_vertical_align",attrs:{type:"button"},className:"e-ss-ddb"})),this.verticalAlignDdb.element},e.prototype.getMergeSplitBtn=function(e){var t=this;this.parent.element.appendChild(this.parent.createElement("button",{id:e+"_merge",attrs:{type:"button"}}));var r=this.parent.serviceLocator.getService(Na);return this.mergeSplitBtn=new d.SplitButton({cssClass:"e-merge-ddb",iconCss:"e-icons e-merge-icon",createPopupOnClick:!0,items:[{text:r.getConstant("MergeAll"),id:e+"_merge_all"},{text:r.getConstant("MergeHorizontally"),id:e+"_merge_horizontally"},{text:r.getConstant("MergeVertically"),id:e+"_merge_vertically"},{separator:!0,id:e+"_merge_separator"},{text:r.getConstant("Unmerge"),id:e+"_unmerge"}],select:this.mergeSelectHandler.bind(this),click:function(e){e.element.setAttribute("aria-label",r.getConstant("MergeCells")),e.element.classList.contains("e-active")?t.unMerge():t.merge(t.parent.element.id+"_merge_all")},created:function(){var e=r.getConstant("MergeCells");t.mergeSplitBtn.element.title=e,t.mergeSplitBtn.element.setAttribute("aria-label",e),t.mergeSplitBtn.element.nextElementSibling.title=r.getConstant("SelectMergeType")},beforeOpen:function(e){return e.element.setAttribute("aria-label",r.getConstant("MergeCells"))}}),this.mergeSplitBtn.createElement=this.parent.createElement,this.mergeSplitBtn.appendTo("#"+e+"_merge"),this.mergeSplitBtn.element.parentElement},e.prototype.mergeSelectHandler=function(e){e.item.id===this.parent.element.id+"_unmerge"?this.unMerge():this.merge(e.item.id),this.mergeSplitBtn.element.setAttribute("aria-label",e.item.text)},e.prototype.unMerge=function(e){var t=this.parent.getActiveSheet(),r=w(c(t.selectedRange));if(oe(this.parent,r))return void this.parent.notify(yi,null);this.parent.showSpinner();for(var n=t.selectedRange,i=[],a=r[0];a<=r[2];a++)for(var o=r[1];o<=r[3];o++){var s=He(a,o,t);if(s&&(s.rowSpan>1||s.colSpan>1)){var l={range:[a,o,a,o]};this.parent.notify("mergedRange",l),i.push(l.range)}}var d={merge:!1,range:e?e.range||n:n,isAction:!0,refreshRibbon:!0,type:"All"};i.length>0&&(d.mergeCollection=i),this.parent.notify(gn,d),this.toggleActiveState(!1),this.parent.hideSpinner()},e.prototype.merge=function(e){var t,r=this,n=this.parent.getActiveSheet(),i=c(n.selectedRange);if(oe(this.parent,w(i)))return void this.parent.notify(yi,null);for(var a,o=e.includes("merge_all"),s=i[0];s<=i[2];s++)for(var l=i[1];l<=i[3];l++)s===i[0]&&l===i[1]&&o||s===i[0]&&e.includes("merge_vertically")||l===i[1]&&e.includes("_merge_horizontally")||((t=He(s,l,n)||{}).value||t.formula)&&(a=!0);if(!a)return this.performMerge(e),void(o&&this.toggleActiveState(!0));var d=this.parent.serviceLocator.getService(Fa);d.show({height:200,width:400,isModal:!0,showCloseIcon:!0,cssClass:"e-merge-alert-dlg",content:this.parent.serviceLocator.getService(Na).getConstant("MergeCellsAlert"),beforeOpen:function(e){var t={dialogName:"MergeAlertDialog",element:e.element,target:e.target,cancel:e.cancel};r.parent.trigger("dialogBeforeOpen",t),t.cancel?e.cancel=!0:or(r.parent.element)},buttons:[{buttonModel:{content:this.parent.serviceLocator.getService(Na).getConstant("Ok"),isPrimary:!0},click:function(){d.hide(),r.performMerge(e),o&&r.toggleActiveState(!0)}}]})},e.prototype.performMerge=function(e){var t=this.parent.element.id;switch(this.parent.showSpinner(),e){case t+"_merge_all":this.parent.notify(gn,{merge:!0,range:this.parent.getActiveSheet().selectedRange,type:"All",isAction:!0,refreshRibbon:!0});break;case t+"_merge_horizontally":this.parent.notify(gn,{merge:!0,range:this.parent.getActiveSheet().selectedRange,type:"Horizontally",isAction:!0});break;case t+"_merge_vertically":this.parent.notify(gn,{merge:!0,range:this.parent.getActiveSheet().selectedRange,type:"Vertically",isAction:!0})}this.parent.hideSpinner()},e.prototype.getSortFilterDDB=function(e){var t,r=this,n=this.parent.serviceLocator.getService(Na);return this.sortingDdb=new d.DropDownButton({cssClass:"e-sort-filter-ddb",iconCss:"e-icons e-sort-filter-icon",items:[{text:n.getConstant("SortAscending"),iconCss:"e-icons e-sort-asc"},{text:n.getConstant("SortDescending"),iconCss:"e-icons e-sort-desc"},{text:n.getConstant("CustomSort")+"...",iconCss:"e-icons e-sort-custom"},{separator:!0},{text:n.getConstant("Filter"),iconCss:"e-icons e-filter-apply",id:e+"_applyfilter"},{text:n.getConstant("ClearAllFilter"),iconCss:"e-icons e-filter-clear",id:e+"_clearfilter"},{text:n.getConstant("ReapplyFilter"),iconCss:"e-icons e-filter-reapply",id:e+"_reapplyfilter"}],createPopupOnClick:!0,beforeItemRender:function(t){var i={isFiltered:!1,isClearAll:!0};r.parent.notify("getFilteredColumn",i),r.parent.allowSorting||t.item.text!==n.getConstant("SortAscending")&&t.item.text!==n.getConstant("SortDescending")&&t.item.text!==n.getConstant("CustomSort")+"..."||t.element.classList.add("e-disabled"),r.parent.allowFiltering||t.item.text!==n.getConstant("Filter")||t.element.classList.add("e-disabled"),t.item.id!==e+"_clearfilter"&&t.item.id!==e+"_reapplyfilter"||(i.isFiltered?t.element.classList.remove("e-disabled"):t.element.classList.add("e-disabled"))},beforeOpen:function(e){r.refreshSelected(r.sortingDdb,e.element,"iconCss"),e.element.setAttribute("aria-label",r.parent.serviceLocator.getService(Na).getConstant("SortAndFilter"))},select:function(e){var i=[];if(e.item.text===n.getConstant("SortAscending")||e.item.text===n.getConstant("SortDescending")||e.item.text===n.getConstant("CustomSort")+"..."){var a=c(r.parent.getActiveSheet().selectedRange),o=X(a[0],a[1],r.parent.getActiveSheet());if(oe(r.parent,o))return void r.parent.notify(yi,null)}switch(e.item.text){case n.getConstant("Filter"):r.parent.notify(pi,{});break;case n.getConstant("ClearAllFilter"):r.parent.notify("clearFilter",{isAction:!0});break;case n.getConstant("ReapplyFilter"):r.parent.notify("reapplyFilter",null);break;case n.getConstant("CustomSort")+"...":r.parent.notify("initiateCustomSort",null);break;default:if(t=e.item.text===n.getConstant("SortAscending")?"Ascending":"Descending",r.parent.sortCollection)for(var s=r.parent.sortCollection.length-1;s>=0;s--)r.parent.sortCollection[s]&&r.parent.sortCollection[s].sheetIndex===r.parent.activeSheetIndex&&(i.push(r.parent.sortCollection[s]),r.parent.sortCollection.splice(s,1));r.parent.notify(Tn,{sortOptions:{sortDescriptors:{order:t}}}),r.parent.notify("applySort",{sortOptions:{sortDescriptors:{order:t}},previousSort:i})}r.sortingDdb.element.setAttribute("aria-label",e.item.text)}}),this.sortingDdb.createElement=this.parent.createElement,this.sortingDdb.appendTo(this.parent.createElement("button",{id:e+"_sorting",attrs:{type:"button"},className:"e-ss-ddb"})),this.sortingDdb.element},e.prototype.getFindBtn=function(e){var t=this,r=this.parent.createElement("button",{id:e+"_findbtn",attrs:{type:"button","aria-label":this.parent.serviceLocator.getService(Na).getConstant("FindReplaceTooltip")}});return this.findDdb=new o.Button({cssClass:"e-spreadsheet-find-ddb e-flat",iconCss:"e-icons e-search-icon"}),this.findDdb.createElement=this.parent.createElement,this.findDdb.appendTo(r),r.onclick=function(e){t.parent.notify("findToolDlg",{event:e})},this.findDdb.element},e.prototype.getClearDDB=function(e){var t=this,r=this.parent.serviceLocator.getService(Na);return this.clearDdb=new d.DropDownButton({cssClass:"e-clear-ddb",iconCss:"e-icons e-clear-icon",items:[{text:r.getConstant("ClearAll"),id:e+"_Clear All"},{text:r.getConstant("ClearFormats"),id:e+"_Clear Formats"},{text:r.getConstant("ClearContents"),id:e+"_Clear Contents"},{text:r.getConstant("ClearHyperlinks"),id:e+"_Clear Hyperlinks"}],createPopupOnClick:!0,beforeOpen:function(e){e.element.setAttribute("aria-label",t.parent.serviceLocator.getService(Na).getConstant("Clear"))},beforeItemRender:function(r){var n=t.parent.getActiveSheet(),i=w(c(n.selectedRange));n.isProtected&&n.protectSettings.formatCells&&r.item.id!==e+"_Clear Formats"&&(r.item.id===e+"_Clear Hyperlinks"||sr(t.parent,i))&&(r.element.classList.add("e-disabled"),r.element.setAttribute("aria-disabled","true"))},select:function(r){t.parent.notify(Si,{options:{type:r.item.id.replace(e+"_","")},isAction:!0}),t.clearDdb.element.setAttribute("aria-label",r.item.text)}}),this.clearDdb.createElement=this.parent.createElement,this.clearDdb.appendTo(this.parent.createElement("button",{id:e+"_clear",attrs:{type:"button"},className:"e-ss-ddb"})),this.clearDdb.element},e.prototype.ribbonCreated=function(){var e=this.parent.serviceLocator.getService(Na).getConstant("CollapseToolbar");t.attributes(this.ribbon.element.querySelector(".e-drop-icon"),{role:"button",tabindex:"-1",title:e,"aria-label":e}),this.ribbon.toolbarObj&&(this.ribbon.toolbarObj.allowKeyboard=this.parent.enableKeyboardNavigation,this.ribbon.toolbarObj.dataBind())},e.prototype.alignItemRender=function(e){e.element.title=this.parent.serviceLocator.getService(Na).getConstant("Align"+this.getAlignText(e))},e.prototype.getAlignText=function(e){var t=e.item.iconCss.split(" e-")[1].split("-icon")[0];return t[0].toUpperCase()+t.slice(1,t.length)},e.prototype.toggleBtnClicked=function(e){var r,n,i,a,o,s=t.closest(e.target,".e-btn"),l=this.parent.element.id,d=s.id,h=Yr;switch(d){case l+"_bold":n={fontWeight:"normal"},i={fontWeight:"bold"},o="fontWeight";break;case l+"_italic":n={fontStyle:"normal"},i={fontStyle:"italic"},o="fontStyle";break;case l+"_line-through":h="textDecorationUpdate",i=n={textDecoration:"line-through"},o="textDecoration";break;case l+"_underline":h="textDecorationUpdate",i=n={textDecoration:"underline"},o="textDecoration"}s.classList.contains("e-active")?(r=i[""+o],a={style:i,onActionUpdate:!0},this.parent.notify(h,a),a.cancel&&s.classList.remove("e-active")):(r=n[""+o],a={style:n,onActionUpdate:!0},this.parent.notify(h,a),a.cancel&&s.classList.add("e-active")),a.cancel||r===a.style[""+o]||this.refreshToggleBtn(u(this.parent.getActiveSheet().activeCell))},e.prototype.getCellStyleValue=function(e,t){var r=He(t[0],t[1],this.parent.getActiveSheet()),n=this.parent.cellStyle[""+e];return r&&r.style&&r.style[""+e]&&(n=r.style[""+e]),n},e.prototype.refreshSelected=function(e,t,r,n){void 0===n&&(n=r);for(var i=0;i<e.items.length;i++)if(e.items[i][""+n]===e[""+r]){t.children[i].classList.add("e-selected");break}},e.prototype.expandCollapseHandler=function(e){var t=this.ribbon.element.querySelector(".e-drop-icon"),r=this.parent.serviceLocator.getService(Na);e.expanded?(t.title=r.getConstant("CollapseToolbar"),t.setAttribute("aria-label",r.getConstant("ExpandToolbar"))):(t.title=r.getConstant("ExpandToolbar"),t.setAttribute("aria-label",r.getConstant("CollapseToolbar"))),this.parent.setPanelSize()},e.prototype.getChartThemeDdbItems=function(e){var t=this.parent.serviceLocator.getService(Na),r=[];return["Material","Fabric","Bootstrap","HighContrastLight","MaterialDark","FabricDark","HighContrast","BootstrapDark","Bootstrap4","Bootstrap5Dark","Bootstrap5","TailwindDark","Tailwind","Tailwind3","Tailwind3Dark","FluentDark","Fluent","Fluent2","Fluent2Dark","Material3","Material3Dark"].forEach(function(n){r.push({id:n,text:t.getConstant(n),iconCss:n===e?"e-icons e-selected-icon":""})}),r},e.prototype.getNumFormatDdbItems=function(e){var t=this.parent.serviceLocator.getService(Na);return[{id:e+"_General",text:t.getConstant("General")},{id:e+"_Number",text:t.getConstant("Number")},{id:e+"_Currency",text:t.getConstant("Currency")},{id:e+"_Accounting",text:t.getConstant("Accounting")},{id:e+"_ShortDate",text:t.getConstant("ShortDate")},{id:e+"_LongDate",text:t.getConstant("LongDate")},{id:e+"_Time",text:t.getConstant("Time")},{id:e+"_Percentage",text:t.getConstant("Percentage")},{id:e+"_Fraction",text:t.getConstant("Fraction")},{id:e+"_Scientific",text:t.getConstant("Scientific")},{id:e+"_Text",text:t.getConstant("Text")},{id:e+"_Custom",text:t.getConstant("Custom")}]},e.prototype.getFontFamilyItems=function(){return[{text:"Arial"},{text:"Arial Black"},{text:"Axettac Demo"},{text:"Batang"},{text:"Book Antiqua"},{text:"Calibri",iconCss:"e-icons e-selected-icon"},{text:"Comic Sans MS"},{text:"Courier"},{text:"Courier New"},{text:"Din Condensed"},{text:"Georgia"},{text:"Helvetica"},{text:"Helvetica New"},{text:"Roboto"},{text:"Tahoma"},{text:"Times New Roman"},{text:"Verdana"}]},e.prototype.applyNumFormat=function(e){var t=this.parent.getActiveSheet(),r={format:e,range:t.selectedRange,cancel:!1,requestType:"NumberFormat"},n={range:t.name+"!"+r.range,format:r.format,requestType:"NumberFormat"},i=oe(this.parent,w(c(r.range)));return!i&&(this.parent.trigger("beforeCellFormat",r),this.parent.notify(qr,{eventArgs:r,action:"format"}),r.cancel)?r.format:(this.parent.notify("applyNumber",r),this.parent.notify("selectionComplete",{type:"mousedown"}),i||this.parent.notify(ci,{eventArgs:n,action:"format"}),r.format)},e.prototype.renderCustomFormatDialog=function(e,t){var r=this,n=this.parent.serviceLocator.getService(Na),i=this.parent.createElement("div"),a=this.parent.createElement("div",{className:"e-custom-dialog"}),o=this.parent.createElement("button",{className:"e-btn",attrs:{type:"button"}});o.innerText=n.getConstant("Apply");var s=this.parent.createElement("div",{className:"e-custom-sample"});s.innerText=n.getConstant("CustomFormatTypeList")+":";var d=this.parent.createElement("div",{className:"e-input-button"}),h=this.parent.createElement("input",{className:"e-input e-dialog-input",attrs:{type:"text",name:"input",spellcheck:"false",placeholder:n.getConstant("CustomFormatPlaceholder")}}),p=this.parent.createElement("div",{className:"e-custom-listview"}),c=this.parent.serviceLocator.getService(Fa),f=new l.ListView({dataSource:t,select:function(e){h.value=e.item.textContent,e.event&&"keydown"===e.event.type&&e.item&&e.item.focus()}});if(d.appendChild(h),d.appendChild(o),a.appendChild(d),a.appendChild(s),a.appendChild(p),f.appendTo(p),t[4]!==e[4])for(var g=f.element.getElementsByClassName("e-list-text"),m=0,v=g.length;m<v;m++)g[m].textContent!==t[m]&&(g[m].textContent=t[m]);var y=function(){var i,a=h.value,o=t.indexOf(a);i=o>-1?e[o]:Ze(r.parent,a),(i=r.applyNumFormat(i))&&(r.refreshNumFormatSelection($e(i,!0),r.parent.getActiveSheet(),n,i),r.parent.notify(kn,{action:"addToCustomFormats",format:a,defaultFormat:i})),c.hide(),r.parent.showAggregate&&r.parent.notify("showAggregate",{})};o.addEventListener("click",y);var C=function(){f.getSelectedItems()&&f.unselectItem()};h.addEventListener("input",C),c.show({header:n.getConstant("CustomFormat"),cssClass:"e-custom-format-dlg",height:this.parent.cssClass.indexOf("e-bigger")>-1?502:480,width:440,isModal:!0,showCloseIcon:!0,content:a,footerTemplate:i,beforeOpen:function(t){var n={dialogName:"CustomNumberFormatDlg",element:t.element,target:t.target,cancel:t.cancel};if(r.parent.trigger("dialogBeforeOpen",n),n.cancel)t.cancel=!0;else{var i=r.parent.getActiveSheet(),a=u(i.activeCell),o=He(a[0],a[1],i);if(o&&o.format){var s=e.indexOf(o.format);f.selectItem(f.element.getElementsByClassName("e-list-item")[s])}or(r.parent.element)}}})},e.prototype.tBarDdbBeforeOpen=function(e,t,r,n){void 0===n&&(n=0);var i=this.parent.viewport.height,a=parseInt(getComputedStyle(e.firstElementChild).height,10)*(t.length-n)+2*parseInt(getComputedStyle(e).paddingTop,10);if(n){var o=getComputedStyle(e.querySelector(".e-separator"));a+=n*(parseInt(o.borderBottomWidth,10)+2*parseInt(o.marginTop,10))}a>i?(e.style.height=i+"px",e.style.overflowY="auto"):e.style.height&&(e.style.height="",e.style.overflowY=""),e.setAttribute("aria-label",r)},e.prototype.numDDBOpen=function(e){this.numPopupWidth=0;for(var t=e.element.querySelectorAll("span.e-numformat-preview-text"),r=0,n=t.length;r<n;r++)this.numPopupWidth<t[r].offsetWidth&&(this.numPopupWidth=t[r].offsetWidth);var i=this.numPopupWidth+160;document.querySelector(".e-numformat-ddb.e-dropdown-popup").style.width=i+"px"},e.prototype.previewNumFormat=function(e){if(!e.item.id.includes("_Custom")){var r=this.parent.createElement("div",{className:"e-numformat-text",styles:"width:100%",innerHTML:e.element.innerHTML});e.element.innerHTML="";var n=this.parent.getActiveSheet(),i=u(n.activeCell),a=He(i[0],i[1],n,!1,!0);if(!t.isNullOrUndefined(a.value)||""!==a.value){var o=Ke(e.item.id.split(this.parent.element.id+"_")[1]),s={type:e.item.text,formattedText:"",value:a.value,format:o,cell:{value:a.value,format:o},skipFormatCheck:re(this.parent)};this.parent.notify(Wr,s);var l=this.parent.createElement("span",{className:"e-numformat-preview-text",styles:"float:right;"});l.innerText=s.formattedText,r.appendChild(l)}e.element.appendChild(r)}},e.prototype.refreshRibbonContent=function(e){if(this.ribbon){t.isNullOrUndefined(e)&&(e=this.ribbon.selectedTab);var r=this.parent.serviceLocator.getService(Na),n=this.parent.getActiveSheet(),i=u(n.activeCell);switch(this.ribbon.items[e].header.text){case r.getConstant("Home"):this.refreshHomeTabContent(i);break;case r.getConstant("Insert"):n.isProtected&&(n.protectSettings.insertLink&&!U(He(i[0],i[1],n),ot(n,i[1]))?this.enableToolbarItems([{tab:r.getConstant("Insert"),items:[this.parent.element.id+"_hyperlink"],enable:!0}]):this.enableToolbarItems([{tab:r.getConstant("Insert"),items:[this.parent.element.id+"_hyperlink"],enable:!1}]));break;case r.getConstant("Formulas"):n.isProtected&&(U(He(i[0],i[1],n),ot(n,i[1]))?this.enableToolbarItems([{tab:r.getConstant("Formulas"),items:[this.parent.element.id+"_insert_function"],enable:!1}]):this.enableToolbarItems([{tab:r.getConstant("Formulas"),items:[this.parent.element.id+"_insert_function"],enable:!0}]));break;case r.getConstant("Data"):this.refreshDataTabContent(e);break;case r.getConstant("View"):this.refreshViewTabContent(e)}}},e.prototype.refreshHomeTabContent=function(e){t.isNullOrUndefined(document.getElementById(this.parent.element.id+"_number_format"))||(this.numFormatDDB=t.getComponent(document.getElementById(this.parent.element.id+"_number_format"),d.DropDownButton));var r=this.parent.getActiveSheet(),n=u(r.activeCell),i=this.parent.serviceLocator.getService(Na),a=He(n[0],n[1],r,!1,!0),o=$e(a.format||"General",!0);if(this.refreshNumFormatSelection(o,r,i,a.format),r.isProtected&&this.parent.enableClipboard&&this.parent.clipboardModule.copiedInfo&&this.parent.notify("enableToolbarItems",[{items:[this.parent.element.id+"_paste"],enable:!U(a,ot(r,n[1]))}]),this.fontNameDdb&&(r.isProtected&&!r.protectSettings.formatCells?this.refreshFontNameSelection("Calibri"):this.refreshFontNameSelection(this.getCellStyleValue("fontFamily",e))),this.fontSizeDdb){s=this.getCellStyleValue("fontSize",e);r.isProtected&&!r.protectSettings.formatCells?this.fontSizeDdb.content="11":(s=s.includes("pt")?s.split("pt")[0]:"11")!==this.fontSizeDdb.content&&(this.fontSizeDdb.content=s,this.fontSizeDdb.dataBind())}if(this.refreshTextAlign(r,a,o,e),this.verticalAlignDdb){var s="e-icons e-"+this.getCellStyleValue("verticalAlign",e).toLowerCase()+"-icon";r.isProtected&&!r.protectSettings.formatCells?this.verticalAlignDdb.iconCss="e-icons e-bottom-icon":s!==this.verticalAlignDdb.iconCss&&(this.verticalAlignDdb.iconCss=s,this.verticalAlignDdb.dataBind())}if(this.refreshToggleBtn(e),!r.isProtected&&(a.rowSpan>1||a.colSpan>1))this.enableToolbarItems([{tab:i.getConstant("Home"),items:[this.parent.element.id+"_merge_cells"],enable:!0}]),this.toggleActiveState(!0);else{var l=c(r.selectedRange);this.enableToolbarItems([{tab:i.getConstant("Home"),items:[this.parent.element.id+"_merge_cells"],enable:l[0]!==l[2]||l[1]!==l[3]}]),this.toggleActiveState(!1)}},e.prototype.refreshTextAlign=function(e,t,r,n){if(this.textAlignDdb){var i=this.getCellStyleValue("textAlign",n);if(e.isProtected&&!e.protectSettings.formatCells)this.textAlignDdb.iconCss="e-icons e-left-icon";else{void 0!==t.value&&"left"===i&&("Accounting"===r||fe(t.value)&&"Text"!==r)&&(i="right");var a="e-icons e-"+i.toLowerCase()+"-icon";a!==this.textAlignDdb.iconCss&&(this.textAlignDdb.iconCss=a,this.textAlignDdb.dataBind())}}},e.prototype.toggleActiveState=function(e){var t=this.parent.serviceLocator.getService(Na);this.parent.getActiveSheet().isProtected||(e?this.mergeSplitBtn.element.classList.contains("e-active")||(this.mergeSplitBtn.element.classList.add("e-active"),this.mergeSplitBtn.element.title=t.getConstant("UnmergeCells")):this.mergeSplitBtn.element.classList.contains("e-active")&&(this.mergeSplitBtn.element.classList.remove("e-active"),this.mergeSplitBtn.element.title=t.getConstant("MergeCells")))},e.prototype.refreshToggleBtn=function(e){var t,r,n,i=this,a=this.parent.getActiveSheet(),o=this.parent.element.id,s=He(e[0],e[1],a),l=["fontWeight","fontStyle","textDecoration","textDecoration"];["bold","italic","line-through","underline","wrap"].forEach(function(d,h){(t=document.getElementById(o+"_"+d))&&(n=!1,a.isProtected&&!a.protectSettings.formatCells||("wrap"===d?n=i.parent.allowWrap&&s&&s.wrap:i.parent.allowCellFormatting&&(r=i.getCellStyleValue(l[h],e).toLowerCase(),n=r.indexOf(d)>-1)),n?t.classList.add("e-active"):t.classList.contains("e-active")&&t.classList.remove("e-active"))})},e.prototype.refreshFontNameSelection=function(e){e=e.split('"').join(""),this.fontNameDdb.element.firstElementChild.textContent=e;for(var t=0;t<this.fontNameDdb.items.length;t++)if(this.fontNameDdb.items[t].text===e){this.fontNameDdb.items[t].iconCss="e-icons e-selected-icon",t!==this.fontNameIndex&&(this.fontNameDdb.items[this.fontNameIndex].iconCss=""),this.fontNameDdb.setProperties({items:this.fontNameDdb.items},!0),this.fontNameIndex=t;break}["Arial","Arial Black","Axettac Demo","Batang","Book Antiqua","Calibri","Comic Sans MS","Courier","Courier New","Din Condensed","Georgia","Helvetica","Helvetica New","Roboto","Tahoma","Times New Roman","Verdana"].indexOf(e)<0&&(this.fontNameDdb.items[this.fontNameIndex].iconCss=""),this.fontNameDdb.element.setAttribute("aria-label",e)},e.prototype.refreshNumFormatSelection=function(e,t,r,n){if(this.numFormatDDB){t.isProtected&&!t.protectSettings.formatCells?e="General":(n&&"General"===e&&"General"!==n&&(e="Custom"),e=r.getConstant(e));for(var i=0;i<this.numFormatDDB.items.length;i++)""!==this.numFormatDDB.items[i].iconCss&&(this.numFormatDDB.items[i].iconCss=""),this.numFormatDDB.items[i].text===e&&(this.numFormatDDB.items[i].iconCss="e-icons e-selected-icon");this.numFormatDDB.element.firstElementChild.textContent=e,this.numFormatDDB.setProperties({items:this.numFormatDDB.items},!0),this.numFormatDDB.element.setAttribute("aria-label",e)}},e.prototype.fileMenuItemSelect=function(e){var r=this,n=t.extend({cancel:!1},e);this.parent.trigger("fileMenuItemSelect",n);var i,a=this.parent.element.id;if(!n.cancel)switch(e.item.id){case a+"_Print":this.parent.print();break;case a+"_Open":t.select("#"+a+"_fileUpload",this.parent.element).click(),or(this.parent.element);break;case a+"_Xlsx":case a+"_Xls":case a+"_Csv":case a+"_Pdf":this.parent.notify("exportDialog",e);break;case a+"_New":(i=this.parent.serviceLocator.getService(Fa)).show({height:200,width:400,isModal:!0,showCloseIcon:!0,content:this.parent.serviceLocator.getService(Na).getConstant("DestroyAlert"),beforeOpen:function(e){var t={dialogName:"DestroySheetDialog",element:e.element,target:e.target,cancel:e.cancel};r.parent.trigger("dialogBeforeOpen",t),t.cancel?e.cancel=!0:or(r.parent.element)},buttons:[{buttonModel:{content:this.parent.serviceLocator.getService(Na).getConstant("Ok"),isPrimary:!0},click:function(){i.hide(),r.parent.refresh(!0)}}]})}},e.prototype.toolbarClicked=function(e){if(e.item&&"spreadsheet_find"!==e.item.id){var t=this.parent.element.id,r=this.parent.getActiveSheet(),n=void 0,i=void 0,a=void 0,o=void 0;switch(e.item.id){case t+"_headers":if(n={isShow:!r.showHeaders,sheetIdx:this.parent.activeSheetIndex,cancel:!1},this.parent.notify(ci,{eventArgs:n,action:"headers"}),n.cancel)return;this.parent.setSheetPropertyOnMute(r,"showHeaders",!r.showHeaders),this.parent.serviceLocator.getService("sheet").showHideHeaders(),this.toggleRibbonItems({props:"Headers",activeTab:this.ribbon.selectedTab});break;case t+"_gridlines":if(i={isShow:!r.showGridLines,sheetIdx:this.parent.activeSheetIndex,cancel:!1},this.parent.notify(ci,{eventArgs:i,action:"gridLines"}),i.cancel)return;this.parent.setSheetPropertyOnMute(r,"showGridLines",!r.showGridLines),this.toggleRibbonItems({props:"GridLines",activeTab:this.ribbon.selectedTab});break;case t+"_protect":this.parent.notify("toggleProtect",{});break;case t+"_undo":this.parent.notify(hi,{isUndo:!0});break;case t+"_redo":this.parent.notify(hi,{isUndo:!1});break;case t+"_freezepanes":a=u(r.topLeftCell),o=r.frozenRows||r.frozenColumns?a:u(r.activeCell),this.parent.notify("freeze",{row:o[0]-a[0],column:o[1]-a[1],triggerEvent:!0});break;case t+"_freezerows":this.parent.notify("freeze",{row:r.frozenRows?0:u(r.activeCell)[0]-u(r.topLeftCell)[0],column:r.frozenColumns,triggerEvent:!0});break;case t+"_freezecolumns":this.parent.notify("freeze",{row:r.frozenRows,column:r.frozenColumns?0:u(r.activeCell)[1]-u(r.topLeftCell)[1],triggerEvent:!0});break;case t+"_protectworkbook":this.parent.password.length>0?this.parent.notify("unProtectWorkbook",null):this.parent.isProtected?(this.parent.isProtected=!1,this.parent.showSheetTabs&&(this.parent.element.querySelector(".e-add-sheet-tab").removeAttribute("disabled"),this.parent.element.querySelector(".e-add-sheet-tab").classList.remove("e-disabled")),this.toggleRibbonItems({props:"Protectworkbook",activeTab:this.ribbon.selectedTab}),this.parent.notify(ci,{action:"protectWorkbook",eventArgs:{isProtected:!1}})):this.parent.element.querySelector(".e-add-sheet-tab").classList.contains("e-disabled")?this.toggleRibbonItems({props:"Protectworkbook",activeTab:this.ribbon.selectedTab}):this.parent.notify("protectWorkbook",null)}this.parent.notify("ribboClick",e)}},e.prototype.toggleRibbonItems=function(e){var r="",n=this.parent.serviceLocator.getService(Na).getConstant("View"),i=this.parent.serviceLocator.getService(Na).getConstant("Data");if(this.ribbon.items[this.ribbon.selectedTab].header.text===n){if(t.isNullOrUndefined(e.activeTab))for(var a=0,o=this.ribbon.items.length;a<o;a++)if(this.ribbon.items[a].header.text===n){e.activeTab=a;break}var s=this.getLocaleText(e.props);"GridLines"===e.props&&this.parent.serviceLocator.getService("sheet").toggleGridlines();for(var l=this.parent.element.id+"_"+e.props.toLowerCase(),d=this.ribbon.items[e.activeTab].content.length,a=void 0;a<d;a++)"Separator"!==this.ribbon.items[e.activeTab].content[a].type&&this.ribbon.items[e.activeTab].content[a].id===l&&(this.ribbon.items[e.activeTab].content[a].text=s,this.ribbon.setProperties({items:this.ribbon.items},!0));this.ribbon.items[this.ribbon.selectedTab].header.text===n&&"Protect"!==e.props&&this.updateToggleText(e.props.toLowerCase(),s)}if(this.ribbon.items[this.ribbon.selectedTab].header.text===i){if(t.isNullOrUndefined(e.activeTab))for(var a=0,h=this.ribbon.items.length;a<h;a++)if(this.ribbon.items[a].header.text===i){e.activeTab=a;break}if((l=this.parent.element.id+"_"+e.props.toLowerCase())===this.parent.element.id+"_protect"){var p=this.ribbon.items[this.ribbon.selectedTab].content.length,c=void 0;for(c=0;c<p&&this.ribbon.items[this.ribbon.selectedTab].content[c].id!==this.parent.element.id+"_protect";c++);r=this.getLocaleProtectText("Sheet",!0)}else if(l===this.parent.element.id+"_protectworkbook"){var u=this.ribbon.items[this.ribbon.selectedTab].content.length,c=void 0;for(c=0;c<u&&this.ribbon.items[this.ribbon.selectedTab].content[c].id!==this.parent.element.id+"_protectworkbook";c++);this.parent.isProtected||this.parent.password.length>0?r=this.getLocaleProtectWorkbook("UnprotectWorkbook"):this.parent.isProtected||(r=this.getLocaleProtectWorkbook("ProtectWorkbook"))}for(var d=this.ribbon.items[e.activeTab].content.length,a=void 0;a<d;a++)"Separator"!==this.ribbon.items[e.activeTab].content[a].type&&this.ribbon.items[e.activeTab].content[a].id===l&&(this.ribbon.items[e.activeTab].content[a].text=r,this.ribbon.setProperties({items:this.ribbon.items},!0));this.ribbon.items[this.ribbon.selectedTab].header.text===i&&this.updateToggleText(e.props.toLowerCase(),r)}},e.prototype.enableFileMenuItems=function(e){this.ribbon.enableMenuItems(e.items,e.enable,e.isUniqueId)},e.prototype.hideRibbonTabs=function(e){this.ribbon.hideTabs(e.tabs,e.hide)},e.prototype.addRibbonTabs=function(e){this.ribbon.addTabs(e.items,e.insertBefore),t.select(".e-ribbon .e-tab-header .e-toolbar-item:not(.e-menu-tab).e-hide",this.parent.element)&&this.parent.updateActiveBorder(t.selectAll(".e-ribbon .e-tab-header .e-toolbar-item:not(.e-menu-tab)",this.parent.element)[this.ribbon.selectedTab])},e.prototype.updateToggleText=function(e,r){var n=t.select("#"+this.parent.element.id+"_"+e+" .e-tbar-btn-text",this.ribbon.element);if("protect"===e||"protectworkbook"===e?n.parentElement.setAttribute("aria-label",r):n.parentElement.setAttribute("aria-label",n.textContent),ft(function(){n&&(n.textContent=r)}),"headers"===e){var i=this.parent.element.getElementsByClassName("e-findtool-dlg")[0];i&&i.classList.contains("e-popup-open")&&this.parent.notify("findToolDlg",{refreshPosition:!0,dialogEle:i})}},e.prototype.refreshViewTabContent=function(e){for(var t,r=this.parent.element.id,n=this.parent.getActiveSheet(),i=this.parent.serviceLocator.getService(Na),a=0;a<this.ribbon.items[e].content.length;a++)"Separator"!==(t=this.ribbon.items[e].content[a]).type&&(t.id===r+"_headers"&&this.updateViewTabContent(e,"Headers",a),t.id===r+"_gridlines"&&this.updateViewTabContent(e,"GridLines",a),t.id===r+"_freezepanes"&&(n.frozenRows||n.frozenColumns?t.text===i.getConstant("FreezePanes")&&this.updateToggleText("freezepanes",this.updateRibbonItemText("Unfreeze","Panes",a,e)):t.text===i.getConstant("UnfreezePanes")&&this.updateToggleText("freezepanes",this.updateRibbonItemText("Freeze","Panes",a,e))),t.id===r+"_freezerows"&&(n.frozenRows?t.text===i.getConstant("FreezeRows")&&this.updateToggleText("freezerows",this.updateRibbonItemText("Unfreeze","Rows",a,e)):t.text===i.getConstant("UnfreezeRows")&&this.updateToggleText("freezerows",this.updateRibbonItemText("Freeze","Rows",a,e))),t.id===r+"_freezecolumns"&&(n.frozenColumns?t.text===i.getConstant("FreezeColumns")&&this.updateToggleText("freezecolumns",this.updateRibbonItemText("Unfreeze","Columns",a,e)):t.text===i.getConstant("UnfreezeColumns")&&this.updateToggleText("freezecolumns",this.updateRibbonItemText("Freeze","Columns",a,e))))},e.prototype.updateViewTabContent=function(e,t,r){var n=this.parent.getActiveSheet(),i=this.parent.serviceLocator.getService(Na);n["show"+t]?this.ribbon.items[e].content[r].text===i.getConstant("Show"+t)&&this.updateToggleText(t.toLowerCase(),this.updateRibbonItemText("Hide",t,r,e)):this.ribbon.items[e].content[r].text===i.getConstant("Hide"+t)&&this.updateToggleText(t.toLowerCase(),this.updateRibbonItemText("Show",t,r,e))},e.prototype.updateRibbonItemText=function(e,t,r,n){var i=this.parent.serviceLocator.getService(Na).getConstant(e+t);return this.ribbon.items[n].content[r].text=i,this.ribbon.setProperties({items:this.ribbon.items},!0),i},e.prototype.refreshDataTabContent=function(e){for(var t,r=this.parent.element.id,n=0;n<this.ribbon.items[e].content.length;n++)if("Separator"!==this.ribbon.items[e].content[n].type){if(this.ribbon.items[e].content[n].id===r+"_protect"){if(this.updateDataTabContent(e,"Sheet",n),t)break;t=!0}this.ribbon.items[e].content[n].id===r+"_protectworkbook"&&this.updateDataTabContent(e,"Workbook",n)}},e.prototype.updateDataTabContent=function(e,t,r){var n=this.parent.getActiveSheet(),i=this.parent.serviceLocator.getService(Na);if("Sheet"===t)n.isProtected?this.ribbon.items[e].content[r].text===i.getConstant("Protect"+t)&&(this.ribbon.items[e].content[r].cssClass="e-active",this.updateProtectBtn("Unprotect",t,r,e)):this.updateProtectBtn("Protect",t,r,e);else if("Workbook"===t){var a=this.parent.serviceLocator.getService(Na);this.parent.isProtected?this.ribbon.items[e].content[r].text===a.getConstant("Protect"+t)&&this.updateToggleText("protectworkbook",this.updateRibbonItemText("Unprotect",t,r,e)):this.ribbon.items[e].content[r].text===a.getConstant("Unprotect"+t)&&this.updateToggleText("protectworkbook",this.updateRibbonItemText("Protect",t,r,e))}},e.prototype.updateProtectBtn=function(e,t,r,n){var i=this.parent.serviceLocator.getService(Na).getConstant(e+t);this.ribbon.items[n].content[r].text=i,this.ribbon.setProperties({items:this.ribbon.items},!0),this.updateToggleText("protect",i)},e.prototype.updateProtectWorkbookBtn=function(e,t,r,n){var i=this.parent.serviceLocator.getService(Na).getConstant(e);this.ribbon.items[n].content[r].text=i,this.ribbon.setProperties({items:this.ribbon.items},!0),this.updateToggleText("protectworkbook",i)},e.prototype.addToolbarItems=function(e){var t=this.parent.serviceLocator.getService(Na);this.ribbon.addToolbarItems(t.getConstant(e.tab),e.items,e.index),this.parent&&this.parent.isReact&&this.parent.portals&&this.ribbon.toolbarObj&&this.ribbon.toolbarObj.portals&&(this.parent.portals=this.parent.portals.concat(this.ribbon.toolbarObj.portals),this.parent.renderReactTemplates())},e.prototype.enableToolbarItems=function(e){var t=this;e.forEach(function(e){t.ribbon.enableItems(e.tab||t.ribbon.items[t.ribbon.selectedTab].header.text,e.items,e.enable)})},e.prototype.createMobileView=function(){var e=this,t=this.parent.element.id,r=this.parent.createElement("div",{className:"e-header-toolbar"}),n=this.parent.createElement("ul");r.appendChild(n);var a=new i.Toolbar({items:[{prefixIcon:"e-tick-icon",align:"Left",id:t+"focused_tick",cssClass:"e-focused-tick"},{template:n,align:"Right",id:t+"file_menu"}],clicked:function(r){switch(r.item.id){case t+"focused_tick":e.parent.element.classList.remove("e-mobile-focused"),e.parent.renderModule.setSheetPanelSize()}},created:function(){var t=new i.Menu({cssClass:"e-mobile e-file-menu",enableRtl:!0,showItemOnClick:!0,items:e.getRibbonMenuItems(),select:e.fileMenuItemSelect.bind(e),beforeOpen:function(t){t.element.parentElement.classList.remove("e-rtl"),e.fileMenuBeforeOpen(t)},beforeClose:e.fileMenuBeforeClose.bind(e)});t.createElement=e.parent.createElement,t.appendTo(n)}});a.createElement=this.parent.createElement,a.appendTo(r),this.parent.element.insertBefore(r,this.parent.element.firstElementChild),this.renderMobileToolbar()},e.prototype.renderMobileToolbar=function(){var e=this,t=this.parent.createElement("div",{className:"e-toolbar-panel e-ribbon"}),r=this.parent.createElement("div"),a=this.parent.createElement("button",{attrs:{type:"button"}});t.appendChild(r),t.appendChild(a),t.style.display="block",this.parent.element.appendChild(t);var o=new d.DropDownButton({cssClass:"e-caret-hide",content:this.ribbon.items[0].header.text,items:[{text:this.ribbon.items[0].header.text},{text:this.ribbon.items[1].header.text},{text:this.ribbon.items[2].header.text},{text:this.ribbon.items[3].header.text}],createPopupOnClick:!0,select:function(t){t.item.text!==o.content&&(s.element.style.display="none",o.content=t.item.text,o.dataBind(),s.items=e.ribbon.items[o.items.indexOf(t.item)+1].content,s.width="calc(100% - "+a.getBoundingClientRect().width+"px)",s.element.style.display="",s.dataBind(),s.items[0].text=t.item.text,s.dataBind())},open:function(e){var t=e.element.parentElement,r=t.getBoundingClientRect(),i=n.calculatePosition(o.element,"right","bottom");t.style.left=i.left-r.width+"px",t.style.top=i.top-r.height+"px";for(var a=0;a<o.items.length;a++)if(o.content===o.items[a].text){e.element.children[a].classList.add("e-selected");break}},close:function(){return or(e.parent.element)}});o.createElement=this.parent.createElement,o.appendTo(a);var s=new i.Toolbar({width:"calc(100% - "+a.getBoundingClientRect().width+"px)",items:this.ribbon.items[0].content,clicked:this.toolbarClicked.bind(this)});s.createElement=this.parent.createElement,s.appendTo(r),t.style.display=""},e.prototype.fileMenuBeforeOpen=function(e){var t,r=this,n=this.parent.serviceLocator.getService(Na),i=[".xlsx",".xls",".csv",".pdf"];e.parentItem.text===n.getConstant("SaveAs")&&[].slice.call(e.element.children).forEach(function(e,n){t=r.parent.createElement("div",{innerHTML:e.innerHTML}),e.innerHTML="";var a=r.parent.createElement("span",{className:"e-extension"});a.innerText=i[n],t.appendChild(a),e.appendChild(t)}),this.parent.trigger("fileMenuBeforeOpen",e),e.element.setAttribute("aria-label",n.getConstant("File"))},e.prototype.enableRibbonTabs=function(e){this.ribbon.enableTabs(e.tabs,e.enable)},e.prototype.fileMenuBeforeClose=function(e){var t=this;this.parent.trigger("fileMenuBeforeClose",e),e.parentItem&&e.event&&37===e.event.keyCode&&e.parentItem.id===this.parent.element.id+"_File"&&ft(function(){var e=t.ribbon.element.querySelector(".e-tab-header .e-toolbar-item .e-tab-wrap");if(e){or(e);var r=e.querySelector(".e-menu-item.e-focused");r&&r.classList.remove("e-focused")}})},e.prototype.hideFileMenuItems=function(e){this.ribbon.hideMenuItems(e.items,e.hide,e.isUniqueId)},e.prototype.addFileMenuItems=function(e){this.ribbon.addMenuItems(e.items,e.text,e.insertAfter,e.isUniqueId)},e.prototype.hideToolbarItems=function(e){this.ribbon.hideToolbarItems(e.tab,e.indexes,e.hide)},e.prototype.protectSheetHandler=function(e){var t=this.parent.getActiveSheet(),r=this.parent.serviceLocator.getService(Na);t.isProtected&&t.protectSettings.formatCells||!t.isProtected?(this.parent.allowCellFormatting?(this.enableToolbarItems([{tab:r.getConstant("Home"),items:e.enableHomeBtnId,enable:!0}]),t.isProtected&&t.protectSettings.formatCells&&this.enableToolbarItems([{tab:r.getConstant("Home"),items:e.enableHomeBtnId.slice(15,16),enable:!1}])):this.enableToolbarItems([{tab:r.getConstant("Home"),items:e.enableHomeBtnId.slice(3,14),enable:!1}]),this.parent.allowWrap||this.enableToolbarItems([{tab:r.getConstant("Home"),items:e.enableHomeBtnId.slice(14,15),enable:!1}]),this.parent.allowNumberFormatting||this.enableToolbarItems([{tab:r.getConstant("Home"),items:e.enableHomeBtnId.slice(2,3),enable:!1}]),this.parent.notify("setUndoRedo",null)):this.enableToolbarItems([{tab:r.getConstant("Home"),items:e.disableHomeBtnId,enable:!1}]),t.isProtected&&t.protectSettings.insertLink||!t.isProtected?!this.parent.allowHyperlink||t.isProtected&&t.protectSettings.insertLink?this.enableToolbarItems([{tab:r.getConstant("Insert"),items:e.enableInsertBtnId.slice(0,1),enable:!1}]):this.enableToolbarItems([{tab:r.getConstant("Insert"),items:e.enableInsertBtnId,enable:!0}]):this.enableToolbarItems([{tab:r.getConstant("Insert"),items:e.enableInsertBtnId,enable:!1}]),this.enableToolbarItems([{tab:r.getConstant("Home"),items:e.findBtnId,enable:!t.isProtected||t.protectSettings.selectCells||t.protectSettings.selectUnLockedCells}]);var n,i=this.ribbon.items[this.ribbon.selectedTab].content.length;for(n=0;n<i&&this.ribbon.items[this.ribbon.selectedTab].content[n].id!==this.parent.element.id+"_protectworkbook";n++);t.isProtected?(this.parent.isProtected&&this.parent.element.querySelector("#"+this.parent.element.id+"_protectworkbook")&&this.parent.element.querySelector("#"+this.parent.element.id+"_protectworkbook").querySelector(".e-tbar-btn-text").textContent===r.getConstant("UnprotectWorkbook")?this.ribbon.items[this.ribbon.selectedTab].header.text===r.getConstant("Data")&&(this.ribbon.items[this.ribbon.selectedTab].content[n].text=r.getConstant("UnprotectWorkbook")):this.ribbon.items[this.ribbon.selectedTab].header.text===r.getConstant("Data")&&(this.ribbon.items[this.ribbon.selectedTab].content[n].text=r.getConstant("ProtectWorkbook")),this.enableToolbarItems([{tab:r.getConstant("Insert"),items:e.imageBtnId,enable:!1}]),this.enableToolbarItems([{tab:r.getConstant("Data"),items:e.dataValidationBtnId,enable:!1}]),this.enableToolbarItems([{tab:r.getConstant("Formulas"),items:e.enableFrmlaBtnId,enable:!1}]),this.enableToolbarItems([{tab:r.getConstant("Insert"),items:e.chartBtnId,enable:!1}])):(this.parent.isProtected&&this.parent.element.querySelector("#"+this.parent.element.id+"_protectworkbook")&&this.parent.element.querySelector("#"+this.parent.element.id+"_protectworkbook").querySelector(".e-tbar-btn-text").textContent===r.getConstant("UnprotectWorkbook")?this.ribbon.items[this.ribbon.selectedTab].header.text===r.getConstant("Data")&&(this.ribbon.items[this.ribbon.selectedTab].content[n].text=r.getConstant("UnprotectWorkbook")):this.ribbon.items[this.ribbon.selectedTab].header.text===r.getConstant("Data")&&(this.ribbon.items[this.ribbon.selectedTab].content[n].text=r.getConstant("ProtectWorkbook")),this.enableToolbarItems([{tab:r.getConstant("Insert"),items:e.imageBtnId,enable:this.parent.allowImage}]),this.enableToolbarItems([{tab:r.getConstant("Data"),items:e.dataValidationBtnId,enable:this.parent.allowDataValidation}]),this.enableToolbarItems([{tab:r.getConstant("Formulas"),items:e.enableFrmlaBtnId,enable:!0}]),this.enableToolbarItems([{tab:r.getConstant("Insert"),items:e.chartBtnId,enable:this.parent.allowChart}]))},e.prototype.updateMergeItem=function(e){if(this.parent.allowMerge&&(Dt(e)||"touchmove"===e.type||e.shiftKey&&("mousedown"===e.type||"touchend"===e.type))){var t=this.parent.getActiveSheet();if(!t.isProtected){var r=c(t.selectedRange);if(r[1]===r[3]&&r[0]===r[2])this.enableToolbarItems([{tab:this.parent.serviceLocator.getService(Na).getConstant("Home"),items:[this.parent.element.id+"_merge_cells"],enable:!1}]),this.toggleActiveState(!1);else{this.enableToolbarItems([{tab:this.parent.serviceLocator.getService(Na).getConstant("Home"),items:[this.parent.element.id+"_merge_cells"],enable:!0}]);var n=He((r=w(r))[0],r[1],t,!1,!0);n.rowSpan>1||n.colSpan>1?this.toggleActiveState(!(n.rowSpan>1&&r[0]+n.rowSpan-1!==r[2]||n.colSpan>1&&r[1]+n.colSpan-1!==r[3])):this.toggleActiveState(!1)}}}},e.prototype.onPropertyChanged=function(e){var t=this.parent.serviceLocator.getService(Na),r=this.parent.element.id,n=this.parent.getActiveSheet();switch(e){case"allowFreezePane":this.ribbon.enableItems(t.getConstant("View"),[r+"_freezepanes",r+"_freezerows",r+"_freezecolumns"],this.parent.allowFreezePane);break;case"showRibbon":this.parent.showRibbon?this.initialize(!0):this.ribbon&&this.destroy();break;case"allowImage":this.ribbon.enableItems(t.getConstant("Insert"),[r+"_image"],this.parent.allowImage);break;case"allowChart":this.ribbon.enableItems(t.getConstant("Insert"),[r+"_chart"],this.parent.allowChart),this.parent.allowChart||this.removeDesignChart();break;case"allowWrap":case"allowCellFormatting":if(this.refreshToggleBtn(u(n.activeCell)),!n.isProtected||n.protectSettings.formatCells)if("allowWrap"===e)this.ribbon.enableItems(t.getConstant("Home"),[r+"_wrap"],this.parent.allowWrap);else{var i=[r+"_font_name",r+"_font_size",r+"_bold",r+"_italic",r+"_line-through",r+"_underline",r+"_font_color_picker",r+"_fill_color_picker",r+"_borders",r+"_merge_cells",r+"_text_align",r+"_vertical_align"];this.enableToolbarItems([{tab:t.getConstant("Home"),items:i,enable:this.parent.allowCellFormatting}])}break;case"allowNumberFormatting":n.isProtected&&!n.protectSettings.formatCells||this.ribbon.enableItems(t.getConstant("Home"),[r+"_number_format"],this.parent.allowNumberFormatting);break;case"calculationMode":this.parent.notify("enableToolbarItems",[{tab:t.getConstant("Formulas"),items:[this.parent.element.id+"_calc_current_sheet",this.parent.element.id+"_calc_entire_sheets"],enable:"Manual"===this.parent.calculationMode}]),this.calcTypeOptions&&(this.calcTypeOptions.items[0].iconCss="Automatic"===this.parent.calculationMode?"e-icons e-selected-icon":"",this.calcTypeOptions.items[1].iconCss="Manual"===this.parent.calculationMode?"e-icons e-selected-icon":""),"Automatic"===this.parent.calculationMode&&this.parent.calculateNow("Workbook")}},e.prototype.addEventListener=function(){this.parent.on(qn,this.ribbonOperation,this),this.parent.on("enableToolbarItems",this.enableToolbarItems,this),this.parent.on("activeCellChanged",this.refreshRibbonContent,this),this.parent.on("updateToggleItem",this.toggleRibbonItems,this),this.parent.on("enableFileMenuItems",this.enableFileMenuItems,this),this.parent.on("hideRibbonTabs",this.hideRibbonTabs,this),this.parent.on("addRibbonTabs",this.addRibbonTabs,this),this.parent.on("addToolbarItems",this.addToolbarItems,this),this.parent.on("hideFileMenuItems",this.hideFileMenuItems,this),this.parent.on("addFileMenuItems",this.addFileMenuItems,this),this.parent.on("hideToolbarItems",this.hideToolbarItems,this),this.parent.on("enableRibbonTabs",this.enableRibbonTabs,this),this.parent.on("protectCellFormat",this.protectSheetHandler,this),this.parent.on("selectionComplete",this.updateMergeItem,this),this.parent.on(Sn,this.refreshRibbonContent,this),this.parent.on("insertDesignChart",this.insertDesignChart,this),this.parent.on("removeDesignChart",this.removeDesignChart,this),this.parent.on("unMerge",this.unMerge,this)},e.prototype.destroy=function(){var e,r=this.parent.element,n=this.ribbon?this.ribbon.element:null,i=this.cPickerEle,a=r.id,s=this.parent.serviceLocator.getService(Na),l=t.getComponent(r.querySelector(".e-tab"),"tab");l&&(e=l.selectedItem),this.switchRibbonTab(s.getConstant("Home")),["bold","italic","line-through","underline","cut","copy","undo","redo","wrap"].forEach(function(e){jt(t.select("#"+a+"_"+e,r),o.Button)}),this.pasteSplitBtn&&this.pasteSplitBtn.destroy(),this.pasteSplitBtn=null,this.mergeSplitBtn&&this.mergeSplitBtn.destroy(),this.mergeSplitBtn=null,this.numFormatDDB&&this.numFormatDDB.destroy(),this.numFormatDDB=null,this.fontSizeDdb&&this.fontSizeDdb.destroy(),this.fontSizeDdb=null,this.fontNameDdb&&this.fontNameDdb.destroy(),this.fontNameDdb=null,this.textAlignDdb&&this.textAlignDdb.destroy(),this.textAlignDdb=null,this.verticalAlignDdb&&this.verticalAlignDdb.destroy(),this.verticalAlignDdb=null,this.sortingDdb&&this.sortingDdb.destroy(),this.sortingDdb=null,this.clearDdb&&this.clearDdb.destroy(),this.clearDdb=null,this.colorPicker&&this.colorPicker.destroy(),this.colorPicker=null,this.destroyComponent(a+"_borders_menu","menu"),this.bordersDdb&&this.bordersDdb.destroy(),this.bordersDdb=null,this.findDdb&&this.findDdb.destroy(),this.findDdb=null,this.destroyComponent(a+"_chart_menu","menu"),this.destroyComponent(a+"_chart_type_menu","menu"),this.destroyComponent(a+"_chart-btn","dropdown-btn"),this.destroyComponent(a+"_chart-type-btn","dropdown-btn"),this.destroyComponent(a+"_cf_menu","menu"),this.cfDdb&&(this.cfDdb.destroy(),this.cfDdb.element&&this.cfDdb.element.remove()),this.cfDdb=null,this.detachPopupElement(a),this.parent.notify("destroyRibbonComponents",null),e&&(l.selectedItem=e,l.dataBind()),this.addChartDdb&&(this.addChartDdb.destroy(),this.addChartDdb=null),this.destroyComponent(a+"_chart_theme","menu"),this.destroyComponent(a+"_chart_theme","dropdown-btn"),this.destroyComponent(a+"_chart-type-btn","menu"),this.destroyComponent(a+"_chart-type-btn","dropdown-btn"),this.datavalidationDdb&&this.datavalidationDdb.destroy(),this.datavalidationDdb=null,i&&t.detach(i);var d=this.parent.serviceLocator.getService(Fa);d.dialogInstance&&d.dialogInstance.element.classList.contains("e-custom-format-dlg")&&d.hide(!0),this.cPickerEle=null,this.border&&(this.border=""),this.fontNameIndex&&(this.fontNameIndex=null),this.preTabIdx&&(this.preTabIdx=null),this.numPopupWidth&&(this.numPopupWidth=null),this.ribbon&&this.ribbon.destroy(),n&&t.detach(n),this.ribbon=null,this.removeEventListener(),this.parent=null},e.prototype.destroyComponent=function(e,r){var n="string"==typeof e?document.getElementById(e):e;if(n){if("menu"!==r||n.childElementCount){var i=t.getComponent(n,r);if(i&&(i.destroy(),"dropdown-btn"===r)){var a=document.getElementById(n.id+"-popup");a&&t.detach(a)}}"menu"===r&&t.detach(n)}},e.prototype.detachPopupElement=function(e){["_conditionalformatting","_chart-type-btn","_chart-btn","_borders"].forEach(function(r){var n=document.getElementById(""+e+r+"-popup");n&&t.detach(n)})},e.prototype.switchRibbonTab=function(e){for(var r,n=this.parent.element.querySelectorAll(".e-tab-text"),i=0;i<n.length;i++){var a=n[i];if(a.textContent.toLowerCase()===e.toLowerCase()){var o=a.closest(".e-toolbar-item");if(o){r=o.getAttribute("data-id");break}}}var s=t.getComponent(this.parent.element.querySelector(".e-tab"),"tab");s&&!t.isNullOrUndefined(r)&&(s.selectedItem=s.getItemIndex(r),s.dataBind())},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(qn,this.ribbonOperation),this.parent.off("enableToolbarItems",this.enableToolbarItems),this.parent.off("activeCellChanged",this.refreshRibbonContent),this.parent.off("updateToggleItem",this.toggleRibbonItems),this.parent.off("enableFileMenuItems",this.enableFileMenuItems),this.parent.off("hideRibbonTabs",this.hideRibbonTabs),this.parent.off("addRibbonTabs",this.addRibbonTabs),this.parent.off("addToolbarItems",this.addToolbarItems),this.parent.off("hideFileMenuItems",this.hideFileMenuItems),this.parent.off("addFileMenuItems",this.addFileMenuItems),this.parent.off("hideToolbarItems",this.hideToolbarItems),this.parent.off("enableRibbonTabs",this.enableRibbonTabs),this.parent.off("protectCellFormat",this.protectSheetHandler),this.parent.off("selectionComplete",this.updateMergeItem),this.parent.off(Sn,this.refreshRibbonContent),this.parent.off("insertDesignChart",this.insertDesignChart),this.parent.off("removeDesignChart",this.removeDesignChart),this.parent.off("unMerge",this.unMerge))},e}(),No=function(){function e(e){this.categoryCollection=[],this.formulaCollection=[],this.isGoto=!1,this.parent=e,this.addEventListener()}return e.prototype.getModuleName=function(){return"formulaBar"},e.prototype.createFormulaBar=function(e){var r=this;if(!this.parent.showFormulaBar&&this.insertFnRipple)return void this.destroy();var n=this.parent.serviceLocator.getService(Na),i=this.parent.element.id,a=this.parent.createElement("div",{className:"e-formula-bar-panel"});if(!this.parent.isMobileView()){var o=this.parent.createElement("input",{id:i+"_name_box",attrs:{type:"text"}});a.appendChild(o),this.comboBoxInstance=new s.ComboBox({value:"A1",cssClass:"e-name-box",width:"",noRecordsTemplate:t.initializeCSPTemplate(function(){return""}),fields:{text:"name",value:"refersTo"},beforeOpen:this.nameBoxBeforeOpen.bind(this),blur:this.nameBoxBlur.bind(this),select:this.nameBoxSelect.bind(this),open:function(){r.isDevice&&(window.browserDetails.isDevice=!0)},change:function(){}}),this.comboBoxInstance.createElement=this.parent.createElement,this.comboBoxInstance.appendTo(o),this.comboBoxInstance.element.parentElement.title=n.getConstant("NameBox")}a.appendChild(this.parent.createElement("button",{className:"e-btn e-css e-flat e-icon-btn e-insert-function",attrs:{title:n.getConstant("InsertFunction"),type:"button"}})).appendChild(this.parent.createElement("span",{className:"e-btn-icon e-icons"})),this.insertFnRipple=t.rippleEffect(a,{selector:".e-insert-function"}),a.appendChild(this.parent.createElement("div",{className:"e-separator"}));var l=n.getConstant("FormulaBar"),d=a.appendChild(this.parent.createElement("textarea",{className:"e-formula-bar e-css",id:i+"_formula_input",attrs:{title:l,"aria-label":l,spellcheck:"false"}}));if(d.rows=1,this.parent.isMobileView())d.placeholder=n.getConstant("MobileFormulaBarPlaceHolder"),t.EventHandler.add(d,"focus",this.textAreaFocusIn,this),t.EventHandler.add(d,"blur",this.textAreaFocusOut,this);else{var h=n.getConstant("ExpandFormulaBar");a.appendChild(this.parent.createElement("span",{className:"e-drop-icon e-icons",attrs:{title:h,role:"button",tabindex:"-1","aria-label":h}}))}e&&e.uiUpdate?this.parent.element.insertBefore(a,document.getElementById(i+"_sheet_panel")):this.parent.element.appendChild(a)},e.prototype.textAreaFocusIn=function(){var e=this.parent.element.querySelector(".e-formula-bar-panel"),t=this.parent.createElement("button",{className:"e-btn e-css e-flat e-icon-btn e-formula-submit",attrs:{type:"button"}});t.appendChild(this.parent.createElement("span",{className:"e-btn-icon e-icons e-tick-icon"})),e.classList.add("e-focused"),e.appendChild(t)},e.prototype.textAreaFocusOut=function(){var e=this.parent.element.querySelector(".e-formula-bar-panel");e.classList.remove("e-focused"),t.detach(e.querySelector(".e-formula-submit"))},e.prototype.keyDownHandler=function(e){var t=e.target;if(this.parent.isEdit&&(!this.parent.getActiveSheet().isProtected||t.classList.contains("e-formula-bar")&&!t.disabled)){if((k(t.value)||t.validity&&0===t.value.toString().indexOf("="))&&(16===e.keyCode||17===e.keyCode))return;t.classList.contains("e-formula-bar")&&(!e.shiftKey||e.shiftKey&&!Pt(e.keyCode))&&this.parent.notify(Yn,{action:"refreshEditor",value:t.value,refreshEditorElem:!0})}},e.prototype.keyUpHandler=function(e){if(this.parent.isEdit){var t=e.target;if(t.classList.contains("e-formula-bar")){var r={action:"getCurrentEditValue",editedValue:""};this.parent.notify(Yn,r),r.editedValue===t.value||16===e.keyCode||17===e.keyCode||e.shiftKey&&(!e.shiftKey||Pt(e.keyCode))||this.parent.notify(Yn,{action:"refreshEditor",value:t.value,refreshEditorElem:!0})}}},e.prototype.nameBoxBeforeOpen=function(e){this.comboBoxInstance.element.classList.contains("e-name-editing")?e.cancel=!0:(this.comboBoxInstance.element.select(),this.isDevice=window.browserDetails.isDevice,this.isDevice&&(window.browserDetails.isDevice=!1))},e.prototype.nameBoxBlur=function(){this.comboBoxInstance.element.classList.contains("e-name-editing")&&(this.comboBoxInstance.element.classList.remove("e-name-editing"),this.updateValueAfterMouseUp())},e.prototype.nameBoxSelect=function(e){if(e.isInteracted&&(!e.e||"keydown"!==e.e.type||40!==e.e.keyCode&&38!==e.e.keyCode)){var t=e.itemData.refersTo.substr(1),r=Se(this.parent,Ie(t));if(void 0===r)return;var n=C(t),i=Ae(this.parent,r),a=void 0,o=void 0;if(-1===n.indexOf(":"))a=o=n.replace("$","");else{var s=n.indexOf(":");a=n.substr(0,s).replace("$",""),o=n.substr(s+1,n.length).replace("$","")}o.match(/\D/g)&&!o.match(/[0-9]/g)&&a.match(/\D/g)&&!a.match(/[0-9]/g)?n=(a+="1")+":"+(o+=i.rowCount):!o.match(/\D/g)&&o.match(/[0-9]/g)&&!a.match(/\D/g)&&a.match(/[0-9]/g)&&(n=(a=g(parseInt(a,10)-1,0))+":"+(o=g(parseInt(o,10)-1,i.colCount-1))),r===this.parent.activeSheetIndex?(this.parent.isEdit||this.parent.selectRange(n),this.parent.notify("addressHandle",{range:n,isSelect:!1,isMouseDown:!1,isNameBoxSelect:!0}),or(this.parent.element)):(Re(this.parent,n,i),this.parent.activeSheetIndex=r,this.parent.notify("addressHandle",{range:n,isSelect:!1,isMouseDown:!1,isNameBoxSelect:!0}),or(this.parent.element))}},e.prototype.formulaBarUpdateHandler=function(e){var t,r=this,n=this.parent.getActiveSheet().selectedRange.split(":"),i={action:"getElement",element:null};this.parent.notify(Yn,i);var a=this.parent.element.querySelector(".e-formula-bar");if("mousemove"===e.type||"pointermove"===e.type){var o=c(n[0]),s=c(n[1]);t=Math.abs(o[0]-s[0])+1+"R x "+(Math.abs(o[1]-s[1])+1)+"C",this.parent.isEdit&&(e.target&&!e.target.classList.contains("e-spreadsheet-edit")?this.parent.notify("editValue",{}):i.element&&(a.value=i.element.textContent))}else{t=n[0];var l=Le(this.parent)+"!"+t;ye(this.parent,l,!1,!0).then(function(t){r.parent&&t.forEach(function(t){var n=r.getFormulaBarValue(t),o={action:"getCurrentEditValue",editedValue:""};r.parent.notify(Yn,o);var s=document.getElementById(r.parent.element.id+"_formula_input"),l=s.value;s.value=n,o.editedValue&&k(o.editedValue.toString(),!0)||r.parent.notify(Yn,{action:"refreshEditor",value:n,refreshEditorElem:!0}),r.parent.isEdit&&(e.target&&!e.target.classList.contains("e-spreadsheet-edit")?r.parent.notify("editValue",{isMouseDown:Tt(e),formulaBarVal:l}):i.element&&(a.value=i.element.textContent))})})}this.updateComboBoxValue(t)},e.prototype.getFormulaBarValue=function(e){var r="";if(e)if(e.formula)r=e.formula;else if(t.isNullOrUndefined(e.value)||""===e.value)e.hyperlink&&(r="string"==typeof e.hyperlink?e.hyperlink:e.hyperlink.address||"");else{var n={},i=e.format&&qe(e.format,!0,n,!0)&&n.type;if("date"===i||"time"===i||"datetime"===i){var a=pe(Number(e.value));if(a&&"Invalid Date"!==a.toString()&&a.getFullYear()>=1900){var o=new t.Internationalization,s=Ke("Time");"h:mm:ss AM/PM"===s&&(s="h:mm:ss a");var l=e.format.toLowerCase();"time"!==i||!l.includes("m")||l.includes(":m")||l.includes("m:")||l.includes("[m")||l.includes("am")||(i="date");var d=e.value.toString().split("."),h=2===d.length,p=h?pe(parseFloat(d[0]+1+"."+d[1])||Number(e.value)):a;if("date"===i){var c={type:"date"};c.skeleton="yMd",r=o.formatDate(a,c),h&&(r+=" "+o.formatDate(p,{type:"time",skeleton:"medium",format:s}))}else(Number(e.value)>=1||"datetime"===i)&&(r=o.formatDate(a,{type:"date",skeleton:"yMd"})+" "),r+=o.formatDate(p,{type:"time",skeleton:"medium",format:s})}}else e.format&&e.format.includes("%")&&fe(e.value)&&((r=this.parent.getDisplayText(e)).includes("%")||(r=""));if(!r)if("true"===(r=e.value.toString()).toLowerCase()||"false"===r.toLowerCase())r=r.toUpperCase();else if("en-US"!==this.parent.locale){var u=t.getNumericObject(this.parent.locale).decimal;"."!==u&&fe(r)&&r.includes(".")&&(r=r.replace(".",u))}}return r},e.prototype.updateValueAfterMouseUp=function(){this.updateComboBoxValue(this.parent.getActiveSheet().selectedRange.split(":")[0])},e.prototype.updateComboBoxValue=function(e){var t=this.parent.getActiveSheet(),r={action:"getNameFromRange",range:Le(this.parent)+"!"+t.selectedRange,definedName:null};if(this.parent.notify("formulaOperation",r),r.definedName&&(e=r.definedName.name),!this.parent.isMobileView()){if(this.comboBoxInstance.text===e)return;this.comboBoxInstance.text=e,this.comboBoxInstance.dataBind()}},e.prototype.disabletextarea=function(){var e=this.getFormulaBar();this.parent.getActiveSheet().isProtected&&!this.parent.isEdit?e.disabled=!0:e.disabled=!1},e.prototype.updateNameBoxValue=function(e,r){var n=this.parent.element.id,i=t.getComponent(this.parent.element.querySelector("#"+n+"_name_box"),"combobox"),a=this.parent.getActiveSheet();if(r)i.text===e.name&&(i.value=a.activeCell,i.dataBind());else{var o=e.refersTo.split("!");if(2===o.length&&e.refersTo.startsWith("=")){var s=o[0].split("=")[1].replace(/'/g,""),l=e.refersTo.split("!")[1];s===a.name&&l===a.selectedRange&&(i.value=e.name,i.dataBind())}}},e.prototype.formulaBarScrollEdit=function(){var e=c(this.parent.getActiveSheet().selectedRange),t=u(this.parent.getActiveSheet().topLeftCell);e[0]<t[0]&&(this.parent.goTo(this.parent.getActiveSheet().selectedRange),this.isGoto=!0),this.parent.notify(Yn,{action:"startEdit",refreshCurPos:!1})},e.prototype.formulaBarClickHandler=function(e){var r=e.target,n=this.parent.getActiveSheet(),i=n.isProtected,a=u(n.activeCell),o=He(a[0],a[1],n),s=U(o,ot(n,a[1]));if(r.classList.contains("e-drop-icon")&&r.parentElement.classList.contains("e-formula-bar-panel"))this.toggleFormulaBar(r);else if(r.classList.contains("e-formula-bar")){if(ae(o,ot(n,a[1]),Qe(n,a[0])))return void this.parent.notify(yi,null);!this.parent.isEdit&&(!i||i&&!s)||this.parent.isEdit&&i&&!r.disabled?this.formulaBarScrollEdit():i&&s&&this.parent.notify(vi,null)}else if(r.parentElement&&r.parentElement.classList.contains("e-name-box"))if(r.classList.contains("e-ddl-icon")){var l={action:"getNames",names:[]};if(this.parent.notify("formulaOperation",l),this.comboBoxInstance.dataSource.length!==l.names.length||this.comboBoxInstance.value===this.comboBoxInstance.text){var d=this.comboBoxInstance.text;this.comboBoxInstance.dataSource=l.names;var h=l.names.find(function(e){return e.name===d});this.comboBoxInstance.value=h?h.refersTo:this.comboBoxInstance.value,this.comboBoxInstance.dataBind()}}else this.comboBoxInstance.element.classList.add("e-name-editing"),this.comboBoxInstance.element.select();!t.isNullOrUndefined(r.offsetParent)&&(r.offsetParent.classList.contains("e-insert-function")||r.classList.contains("e-insert-function")||this.parent.element.id+"_insert_function"===r.offsetParent.id||this.parent.element.id+"_insert_function"===r.id||r.parentElement.classList.contains("e-insert-function")||this.parent.element.id+"_insert_function"===r.parentElement.id)&&this.renderInsertDlg()},e.prototype.renderInsertDlg=function(){var e=this,r=this.parent.getActiveSheet(),n=u(r.activeCell);if(r.isProtected&&U(He(n[0],n[1],r),ot(r,n[1]))&&!this.parent.isEdit)return void this.parent.notify(vi,null);if(ae(He(n[0],n[1],r),ot(r,n[1]),Qe(r,n[0])))return void this.parent.notify(yi,null);var i=this.parent.serviceLocator.getService(Na),a=!this.parent.isEdit,o={action:"getCurrentEditValue",editedValue:""};if(!a){var d={action:"isFormulaEditing",isFormulaEdit:!1};this.parent.notify("formulaOperation",d),a=d.isFormulaEdit,this.parent.notify(Yn,o)}if((a||""===o.editedValue)&&!this.parent.element.querySelector(".e-spreadsheet-function-dlg")){""===o.editedValue&&this.parent.notify(Yn,{action:"refreshEditor",value:"="});var h=this.parent.createElement("div",{className:"e-formula-description",id:this.parent.element.id+"_description_content"}),p=this.parent.createElement("div",{className:"e-category-content",id:this.parent.element.id+"_category_content"});p.innerText=i.getConstant("PickACategory");var c=this.parent.createElement("input",{className:"e-formula-category",id:this.parent.element.id+"_formula_category"}),f=this.parent.createElement("div",{className:"e-formula-list",id:this.parent.element.id+"_formula_list"}),g=this.parent.createElement("div",{className:"e-description-content"});g.innerText=i.getConstant("Description");var m=this.parent.createElement("div",{className:"e-header-content"});m.innerText=i.getConstant("InsertFunction");var v={action:"getFormulaCategory",categoryCollection:[]};this.parent.notify(Kr,v),this.categoryCollection=v.categoryCollection;var y;this.categoryList=new s.DropDownList({dataSource:this.categoryCollection,cssClass:"e-ss-formula-category",index:0,width:"285px",popupHeight:"210px",select:this.dropDownSelect.bind(this),open:function(){return y=!0},close:function(){return y=!1}});var C={action:"getLibraryFormulas",formulaCollection:[]};this.parent.notify(Kr,C),this.formulaCollection=C.formulaCollection,this.formulaList=new l.ListView({dataSource:this.formulaCollection.sort(),actionComplete:this.updateFormulaList.bind(this),select:this.listSelected.bind(this),width:"285px",height:"200px"});var b;this.dialog=this.parent.serviceLocator.getService(Fa),this.dialog.show({header:m.outerHTML,content:p.outerHTML+c.outerHTML+f.outerHTML+g.outerHTML+h.outerHTML,width:"320px",height:"485px",cssClass:"e-spreadsheet-function-dlg",showCloseIcon:!0,isModal:!0,beforeOpen:function(t){var r={dialogName:"InsertFunctionDialog",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",r),r.cancel?(e.dialog.dialogInstance.setProperties({beforeClose:void 0},!0),b=t.cancel=!0):or(e.parent.element)},open:this.dialogOpen.bind(this),beforeClose:this.dialogBeforeClose.bind(this),close:this.dialogClose.bind(this),buttons:[{click:function(t){t&&13===t.keyCode&&!y||e.selectFormula()},buttonModel:{content:i.getConstant("Ok"),isPrimary:!0}}]}),b?this.categoryList=this.formulaList=null:(this.categoryList.appendTo("#"+this.parent.element.id+"_formula_category"),this.formulaList.appendTo("#"+this.parent.element.id+"_formula_list"),t.EventHandler.add(this.formulaList.element,"dblclick",this.formulaClickHandler,this))}},e.prototype.toggleFormulaBar=function(e){var t=e.parentElement,r=this.parent.serviceLocator.getService(Na);t.classList.contains("e-expanded")?(t.classList.remove("e-expanded"),document.getElementById(this.parent.element.id+"_formula_input").rows=1,e.title=r.getConstant("ExpandFormulaBar"),e.setAttribute("aria-label",r.getConstant("CollapseFormulaBar"))):(t.classList.add("e-expanded"),document.getElementById(this.parent.element.id+"_formula_input").rows=3,e.title=r.getConstant("CollapseFormulaBar"),e.setAttribute("aria-label",r.getConstant("ExpandFormulaBar"))),this.parent.setPanelSize()},e.prototype.dialogOpen=function(){var e=this;ft(function(){var t=e.dialog.dialogInstance.element.querySelector(".e-footer-content .e-primary"),r=e.parent.serviceLocator.getService(Na);t.setAttribute("aria-label",r.getConstant("InsertFunction")+" "+r.getConstant("Ok")),e.categoryList&&or(e.categoryList.element)})},e.prototype.dialogClose=function(){var e={action:"getCurrentEditValue",editedValue:""};this.parent.notify(Yn,e),"="===e.editedValue.toString().trim()&&this.parent.notify(Yn,{action:"refreshEditor",value:""})},e.prototype.dialogBeforeClose=function(){t.EventHandler.remove(this.formulaList.element,"dblclick",this.formulaClickHandler);var e=document.getElementsByClassName("e-spreadsheet-function-dlg")[0].querySelector(".e-dlg-content");e.parentNode.removeChild(e),this.categoryList.destroy(),this.categoryList=null,this.formulaList.destroy(),this.formulaList=null},e.prototype.selectFormula=function(){var e=this.formulaList.getSelectedItems().text,t=Ae(this.parent,this.parent.activeSheetIndex);this.parent.isEdit?this.parent.notify(Yn,{action:"refreshEditor",value:e+"(",refreshFormulaBar:!0,refreshEditorElem:!0,isAppend:!0}):(this.parent.notify(Yn,{action:"startEdit",value:"="+e+"(",address:t.activeCell}),this.parent.notify("formulaBarOperation",{action:"refreshFormulabar",value:"="+e+"("})),this.dialog.dialogInstance.storeActiveElement=document.getElementById(this.parent.element.id+"_edit"),this.dialog.hide()},e.prototype.listSelected=function(e){this.updateFormulaDescription(),e.isInteracted&&e.item&&e.item.focus()},e.prototype.updateFormulaList=function(){this.activeListFormula(),this.updateFormulaDescription()},e.prototype.dropDownSelect=function(e){this.formulaCollection=[];var t={action:"getLibraryFormulas",formulaCollection:[]};if("All"===e.item.textContent)this.parent.notify(Kr,t),this.formulaCollection=t.formulaCollection;else{var r={action:"dropDownSelectFormulas",formulaCollection:[],selectCategory:e.item.textContent};this.parent.notify(Kr,r),this.formulaCollection=r.formulaCollection}this.formulaList.dataSource=this.formulaCollection.sort()},e.prototype.activeListFormula=function(){var e=document.getElementById(this.parent.element.id+"_formula_list").children[0].children[0].firstElementChild;this.formulaList.selectItem(e)},e.prototype.updateFormulaDescription=function(){var e=this.formulaList.getSelectedItems().text,t={action:"getFormulaDescription",description:"",selectedList:e,isCustom:!1};this.parent.notify(Kr,t);var r=this.dialog.dialogInstance.element.querySelector(".e-footer-content .e-primary");r.hasAttribute("aria-label")&&r.removeAttribute("aria-label");var n=document.getElementById(this.parent.element.id+"_description_content");e="AND"===e?"CalculateAND":"OR"===e?"CalculateOR":e,n.textContent=t.isCustom?t.description:this.parent.serviceLocator.getService(Na).getConstant(e)},e.prototype.formulaClickHandler=function(e){var t=e.target,r=Ae(this.parent,this.parent.activeSheetIndex);(t.offsetParent.classList.contains("e-text-content")||t.classList.contains("e-list-item"))&&(this.parent.isEdit?this.parent.notify(Yn,{action:"refreshEditor",value:t.innerText+"(",refreshFormulaBar:!0,refreshEditorElem:!0,isAppend:!0}):(this.parent.notify(Yn,{action:"startEdit",value:"="+t.innerText+"(",address:r.activeCell}),this.parent.notify("formulaBarOperation",{action:"refreshFormulabar",value:"="+t.innerText+"("})),this.dialog.hide())},e.prototype.addEventListener=function(){this.parent.on("formulaBar",this.createFormulaBar,this),this.parent.on(Xn,this.formulaBarClickHandler,this),this.parent.on($n,this.keyDownHandler,this),this.parent.on("renderInsertDlg",this.renderInsertDlg,this),this.parent.on(Kn,this.keyUpHandler,this),this.parent.on("selectionComplete",this.formulaBarUpdateHandler,this),this.parent.on("mouseUpAfterSelection",this.updateValueAfterMouseUp,this),this.parent.on("formulaBarOperation",this.editOperationHandler,this),this.parent.on("enableFormulaInput",this.disabletextarea,this),this.parent.on("isFormulaBarEdit",this.isFormulaBarEdit,this)},e.prototype.destroy=function(){this.removeEventListener(),this.comboBoxInstance&&this.comboBoxInstance.destroy(),this.comboBoxInstance=null,this.categoryCollection=null,this.formulaCollection=null,this.dialog=null,this.isGoto=null,this.insertFnRipple&&this.insertFnRipple(),this.insertFnRipple=null;var e=this.parent.element.querySelector(".e-formula-bar-panel");e&&(gt(e),t.detach(e)),this.parent=null},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("formulaBar",this.createFormulaBar),this.parent.off(Xn,this.formulaBarClickHandler),this.parent.off("renderInsertDlg",this.renderInsertDlg),this.parent.off($n,this.keyDownHandler),this.parent.off(Kn,this.keyUpHandler),this.parent.off("selectionComplete",this.formulaBarUpdateHandler),this.parent.off("mouseUpAfterSelection",this.updateValueAfterMouseUp),this.parent.off("formulaBarOperation",this.editOperationHandler),this.parent.off("enableFormulaInput",this.disabletextarea),this.parent.off("isFormulaBarEdit",this.isFormulaBarEdit))},e.prototype.editOperationHandler=function(e){switch(e.action){case"refreshFormulabar":e.cell?this.getFormulaBar().value=this.getFormulaBarValue(e.cell):this.getFormulaBar().value=t.isUndefined(e.value)?"":e.value;break;case"setNameBoxValue":this.updateNameBoxValue(e.definedName,e.isRemove);break;case"getElement":e.element=this.getFormulaBar()}},e.prototype.isFormulaBarEdit=function(e){this.parent.isEdit&&this.isGoto?e.isEdit=!0:e.isEdit=!1},e.prototype.getFormulaBar=function(){return t.select("#"+this.parent.element.id+"_formula_input",this.parent.element)},e}(),Fo=function(){function e(e){this.isFormulaBar=!1,this.isFormula=!1,this.isPopupOpened=!1,this.isPreventClose=!1,this.isSubFormula=!1,this.parent=e,this.addEventListener()}return e.prototype.getModuleName=function(){return"formula"},e.prototype.destroy=function(){this.removeEventListener(),this.autocompleteInstance&&(this.autocompleteInstance.destroy(),this.autocompleteInstance.element&&(this.autocompleteInstance.element.remove(),this.autocompleteInstance.element=null)),this.autocompleteInstance=null,this.acInputElement&&(this.acInputElement.remove(),this.acInputElement=null),this.parent=null},e.prototype.addEventListener=function(){this.parent.on("formulaOperation",this.performFormulaOperation,this),this.parent.on(Kn,this.keyUpHandler,this),this.parent.on($n,this.keyDownHandler,this),this.parent.on(Xn,this.formulaClick,this),this.parent.on("refreshFormulaDatasource",this.refreshFormulaDatasource,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("formulaOperation",this.performFormulaOperation),this.parent.off(Kn,this.keyUpHandler),this.parent.off($n,this.keyDownHandler),this.parent.off(Xn,this.formulaClick),this.parent.off("refreshFormulaDatasource",this.refreshFormulaDatasource))},e.prototype.performFormulaOperation=function(e){var t=this,r=e.action,n=this.parent.serviceLocator.getService(Na);switch(r){case"renderAutoComplete":this.renderAutoComplete();break;case"endEdit":this.endEdit();break;case"addDefinedName":e.isAdded=this.addDefinedName(e.definedName);break;case"getNames":e.sheetName||(e.sheetName=Le(this.parent)),e.names=this.getNames(e.sheetName);break;case"getNameFromRange":e.definedName=this.getNameFromRange(e.range);break;case"isFormulaEditing":e.isFormulaEdit=this.isFormula;break;case"isCircularReference":var i=this.parent.serviceLocator.getService(Fa),a=n.getConstant("CircularReference"),o=function(e){t.parent.trigger("dialogBeforeOpen",e),e.content!==a&&(i.dialogInstance.content=e.content,i.dialogInstance.dataBind())},s=i.dialogInstance;if(s&&s.visible&&s.element.classList.contains("e-circularref-dlg"))o({dialogName:"CircularReferenceDialog",element:s.element,target:this.parent.element,cancel:!1,cellAddress:e.address,content:a});else{var l=e.address;i.show({height:180,width:400,isModal:!0,showCloseIcon:!0,cssClass:"e-circularref-dlg",content:a,beforeOpen:function(e){var t={dialogName:"CircularReferenceDialog",element:e.element,target:e.target,cancel:e.cancel,cellAddress:l,content:a};o(t),e.cancel=t.cancel}})}e.argValue="0"}},e.prototype.renderAutoComplete=function(){if(!t.select("#"+this.parent.element.id+"_ac",this.parent.element)){var e=this.parent.createElement("input",{id:this.parent.element.id+"_ac",className:"e-ss-ac"});this.parent.element.appendChild(e);var r={action:"getLibraryFormulas",formulaCollection:[]};this.parent.notify(Kr,r);var n={dataSource:r.formulaCollection,cssClass:"e-ss-atc",popupWidth:"130px",allowFiltering:!0,filterType:"StartsWith",sortOrder:"Ascending",open:this.onSuggestionOpen.bind(this),close:this.onSuggestionClose.bind(this),select:this.onSelect.bind(this),actionComplete:this.onSuggestionComplete.bind(this)};this.autocompleteInstance=new s.AutoComplete(n,e),this.autocompleteInstance.createElement=this.parent.createElement,this.acInputElement=e}},e.prototype.onSuggestionOpen=function(e){var t=this;this.isPopupOpened=!0,e.popup.relateTo=this.getRelateToElem(),e.popup.element.firstChild.style.maxHeight="180px",new Promise(function(e){setTimeout(function(){e()},100)}).then(function(){t.triggerKeyDownEvent(Oa.DOWN)})},e.prototype.onSuggestionClose=function(e){this.isPreventClose?e.cancel=!0:this.isPopupOpened=!1},e.prototype.onSelect=function(e){var r="="+e.itemData.value+"(";if(this.isSubFormula){var n=this.getEditingValue(),i=n.lastIndexOf(this.parent.listSeparator);i>-1?r=n.slice(0,i+1):(i=n.lastIndexOf("("))>-1&&(r=n.slice(0,i+1)),r+=e.itemData.value+"("}if(this.parent.notify(Yn,{action:"refreshEditor",value:r,refreshFormulaBar:!0,refreshEditorElem:!0,refreshCurPos:!this.isFormulaBar}),this.isPopupOpened){this.hidePopUp();var a=t.select("#"+this.parent.element.id+"_ac_popup");a&&t.detach(a),this.isPopupOpened=!1}},e.prototype.onSuggestionComplete=function(e){this.isPreventClose=e.result.length>0,this.isPreventClose||(e.cancel=!0,this.hidePopUp())},e.prototype.refreshFormulaDatasource=function(){var e={action:"getLibraryFormulas",formulaCollection:[]};this.parent.notify(Kr,e),this.autocompleteInstance&&(this.autocompleteInstance.dataSource=e.formulaCollection)},e.prototype.keyUpHandler=function(e){if(this.parent.isEdit){var t=this.getEditingValue();this.isFormula=k(t),(this.isFormula||this.isPopupOpened)&&(e.keyCode!==Oa.TAB&&this.isFormula&&(t=this.getSuggestionKeyFromFormula(t)),this.refreshFormulaSuggestion(e,t))}else this.isPopupOpened&&this.hidePopUp()},e.prototype.keyDownHandler=function(e){var t=e.keyCode;if(this.isFormula){if(this.isPopupOpened)switch(t){case Oa.UP:case Oa.DOWN:e.preventDefault(),this.triggerKeyDownEvent(t);break;case Oa.TAB:e.preventDefault(),this.triggerKeyDownEvent(Oa.ENTER)}}else{var r=e.target;if(r.id===this.parent.element.id+"_name_box")switch(t){case Oa.ENTER:document.querySelector(".e-name-box.e-popup-open")||(this.addDefinedName({name:r.value}),or(this.parent.element));break;case Oa.ESC:or(this.parent.element)}}},e.prototype.formulaClick=function(e){if(this.parent.isEdit){var t=e.target;this.isFormulaBar=t.classList.contains("e-formula-bar")}},e.prototype.refreshFormulaSuggestion=function(e,t){if(t.length>0){var r=this.autocompleteInstance.element,n=e.keyCode,i=this.isPopupOpened;Pt(n)||(r.value=t,r.dispatchEvent(new Event("input")),r.dispatchEvent(new Event("keyup")),i&&this.triggerKeyDownEvent(Oa.DOWN))}else this.isPopupOpened&&(this.isPreventClose=!1,this.hidePopUp())},e.prototype.endEdit=function(){if(this.isSubFormula=!1,this.isPreventClose=!1,this.isFormula=!1,this.isFormulaBar=!1,this.isPopupOpened){this.hidePopUp();var e=t.select("#"+this.parent.element.id+"_ac_popup");e&&t.detach(e),this.isPopupOpened=!1}},e.prototype.hidePopUp=function(){this.autocompleteInstance.hidePopup()},e.prototype.getSuggestionKeyFromFormula=function(e){var t="";if(e=e.substr(1)){var r=e.lastIndexOf("("),n=(e=e.substr(r+1)).split(this.parent.listSeparator);1===n.length?(t=n[0],this.isSubFormula=r>-1):(t=n[n.length-1],this.isSubFormula=!0);var i=t.match(/\w/);(!i||i&&0!==i.index)&&(t="")}return t},e.prototype.getRelateToElem=function(){var e={action:"getElement"};return this.isFormulaBar?this.parent.notify("formulaBarOperation",e):this.parent.notify(Yn,e),e.element},e.prototype.getEditingValue=function(){var e={action:"getCurrentEditValue",editedValue:""};return this.parent.notify(Yn,e),e.editedValue},e.prototype.triggerKeyDownEvent=function(e){var t=this.autocompleteInstance.element;t.dispatchEvent(new Event("input"));var r=new Event("keydown");r.keyCode=e,r.which=e,r.altKey=!1,r.shiftKey=!1,r.ctrlKey=!1,t.dispatchEvent(r)},e.prototype.getNames=function(e){return this.parent.definedNames.filter(function(t){return"Workbook"===t.scope||""===t.scope||t.scope===e})},e.prototype.getNameFromRange=function(e){var t,r,n=e.slice(0,e.indexOf(":")),i=e.substring(e.lastIndexOf("!")+1).split(":"),a=i.length>1&&i[0]===i[1],o=this.parent.definedNames.filter(function(i){t=i.refersTo.substring(0,i.refersTo.lastIndexOf("!")),r=i.refersTo.substring(i.refersTo.lastIndexOf("!")+1),t.includes("'")&&t.match(/^='.*'$/)&&(t="="+t.slice(2,-1));var o=t+"!"+r.split("$").join("");return!(!a||o!=="="+n)||o==="="+e});return o&&o[0]},e.prototype.addDefinedName=function(e){var r=this,n=e.name,i=!1;if(n&&O(n.toUpperCase()))return this.parent.goTo(n),i;if(!e.refersTo){var a=Ae(this.parent,this.parent.activeSheetIndex),o=Le(this.parent);o=-1!==o.indexOf(" ")?"'"+o+"'":o;var s=a.selectedRange;if(!t.isNullOrUndefined(s)){var l=s.indexOf(":"),d=s.substr(0,l),h=s.substr(l+1,s.length);parseInt(h.replace(/\D/g,""),10)===a.rowCount&&1===parseInt(d.replace(/\D/g,""),10)?(h=h.replace(/[0-9]/g,""),s="$"+(d=d.replace(/[0-9]/g,""))+":$"+h):u(h)[1]===a.colCount-1&&0===u(d)[1]?(h=h.replace(/\D/g,""),s="$"+(d=d.replace(/\D/g,""))+":$"+h):s=d===h?d:s}e.refersTo=o+"!"+s,e.scope="Workbook"}if(n.length>0&&/^([a-zA-Z_0-9.]){0,255}$/.test(n)){var p={action:"addDefinedName",definedName:e,isAdded:!1};this.parent.notify(Kr,p),i=p.isAdded,p.isAdded||this.parent.serviceLocator.getService(Fa).show({content:this.parent.serviceLocator.getService(Na).getConstant("DefineNameExists"),width:"300",beforeOpen:function(e){var t={dialogName:"DefineNameExistsDialog",element:e.element,target:e.target,cancel:e.cancel};r.parent.trigger("dialogBeforeOpen",t),t.cancel&&(e.cancel=!0)}})}else this.parent.serviceLocator.getService(Fa).show({content:this.parent.serviceLocator.getService(Na).getConstant("DefineNameInValid"),width:"300",beforeOpen:function(e){var t={dialogName:"DefineNameInValidDialog",element:e.element,target:e.target,cancel:e.cancel};r.parent.trigger("dialogBeforeOpen",t),t.cancel&&(e.cancel=!0)}});return i},e}(),Ao=function(){function e(e){this.aggregateContent="",this.selaggregateCnt="Sum",this.parent=e,this.addEventListener()}return e.prototype.getModuleName=function(){return"sheetTabs"},e.prototype.createSheetTabs=function(){var e=this;if(!this.parent.showSheetTabs&&this.tabInstance)return void this.destroy();var r=this.parent.serviceLocator.getService(Na),n=this.parent.createElement("div",{className:"e-sheet-tab-panel",id:this.parent.element.id+"_sheet_tab_panel"}),a=this.parent.createElement("button",{className:"e-add-sheet-tab e-btn e-css e-flat e-icon-btn"+(this.parent.allowInsert?"":" e-disabled"),attrs:{title:r.getConstant("AddSheet"),type:"button"}});a.appendChild(this.parent.createElement("span",{className:"e-btn-icon e-icons e-add-icon"})),a.addEventListener("click",this.addSheetTab.bind(this)),a.disabled=!this.parent.allowInsert,n.appendChild(a),this.addBtnRipple=t.rippleEffect(n,{selector:".e-add-sheet-tab"});var o=this.parent.createElement("button",{attrs:{title:r.getConstant("ListAllSheets"),type:"button"}});n.appendChild(o),this.parent.element.appendChild(n);var s=this.getSheetTabItems();this.dropDownInstance=new d.DropDownButton({iconCss:"e-icons",items:s.ddbItems,createPopupOnClick:!0,beforeItemRender:function(t){var r=e.parent.sheets[e.dropDownInstance.items.indexOf(t.item)];"Hidden"===r.state?t.element.classList.add("e-hide"):"VeryHidden"===r.state&&(t.element.style.display="none")},select:function(t){return e.updateSheetTab({idx:e.dropDownInstance.items.indexOf(t.item)})},beforeOpen:function(t){return e.beforeOpenHandler(e.dropDownInstance,t.element,r.getConstant("ListAllSheets"))},open:function(t){return e.openHandler(e.dropDownInstance,t.element,"left")},cssClass:"e-sheets-list e-flat e-caret-hide",close:function(){return e.focusTab(e.tabInstance.element)}}),this.dropDownInstance.createElement=this.parent.createElement,this.dropDownInstance.appendTo(o);var l,h=this.parent.createElement("div",{className:"e-sheet-tab"});this.tabInstance=new i.Tab({selectedItem:this.parent.activeSheetIndex,overflowMode:"Scrollable",items:s.tabItems,scrollStep:250,selecting:function(t){if(t.selectingIndex!==t.selectedIndex)if(l)l=!1;else{var r={currentSheetIndex:t.selectingIndex,previousSheetIndex:t.selectedIndex,cancel:!1};e.parent.notify(qr,{eventArgs:r,action:"gotoSheet"}),l=r.cancel}},selected:function(t){t.isInteracted||(t.preventFocus=!0),e.goToSheet(t,l,!0)},created:function(){var r=e.tabInstance.element.querySelector(".e-toolbar-items");r.classList.add("e-sheet-tabs-items"),t.EventHandler.add(r,"dblclick",e.renameSheetTab,e)}}),n.appendChild(h),this.tabInstance.createElement=this.parent.createElement,this.tabInstance.appendTo(h),t.EventHandler.remove(this.tabInstance.element,"keydown",this.tabInstance.spaceKeyDown);for(var p,c=s.tabItems.length,u=0;u<c;u++){var f={action:"addSheet",sheetName:"Sheet"+(p=Ae(this.parent,u)).id,sheetId:p.id,visibleName:p.name};this.parent.notify(Kr,f)}this.parent.notify(Kr,{action:"initiateDefinedNames"}),this.parent.notify("protectSheet",null)},e.prototype.goToSheet=function(e,t,r){var n=this;if(e.selectedIndex!==e.previousIndex){if(t)return this.tabInstance.selectedItem=e.previousIndex,this.tabInstance.dataBind(),void or(this.parent.element);if(this.parent.notify("removeDesignChart",{}),this.parent.isEdit){var i=window.getSelection(),a={action:"getCurrentEditValue",editedValue:""};this.parent.notify(Yn,a);var o=!!a.editedValue&&k(a.editedValue,!0);!o&&i&&i.focusNode&&i.focusNode.classList&&i.focusNode.classList.contains("e-formula-bar-panel")&&(o=k(this.parent.element.querySelector(".e-formula-bar").value,!0)),o||this.parent.endEdit()}this.parent.activeSheetIndex=e.selectedIndex,this.parent.dataBind(),this.updateDropDownItems(e.selectedIndex,e.previousIndex);var s={action:"registerGridInCalc",sheetID:(e.selectedIndex+1).toString()};this.parent.notify(Kr,s),r&&(this.parent.notify(ci,{eventArgs:{previousSheetIndex:e.previousIndex,currentSheetIndex:e.selectedIndex},action:"gotoSheet"}),ft(function(){return or(n.parent.element)}))}},e.prototype.updateDropDownItems=function(e,t){t>-1&&(this.dropDownInstance.items[t].iconCss=""),this.dropDownInstance.items[e].iconCss="e-selected-icon e-icons",this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0)},e.prototype.beforeOpenHandler=function(e,t,r){var n=this.parent.viewport.height;parseInt(getComputedStyle(t.firstElementChild).height,10)*e.items.length+2*parseInt(getComputedStyle(t).paddingTop,10)>n&&(t.style.height=n+"px",t.style.overflowY="auto"),t.parentElement.style.visibility="hidden",r&&t.setAttribute("aria-label",r)},e.prototype.openHandler=function(e,t,r){var i,a=t.parentElement;if(-1===n.isCollide(a).indexOf("bottom")){i="auto"===t.style.overflowY?this.parent.viewport.height:a.getBoundingClientRect().height;var o=n.calculatePosition(e.element,r,"top");"right"===r&&(o.left-=a.getBoundingClientRect().width),a.style.left=o.left+"px",a.style.top=o.top-i+"px"}a.style.visibility="",or(t)},e.prototype.getSheetTabItems=function(){var e,t=this,r=[],n=[];return this.parent.sheets.forEach(function(i,a){e=Le(t.parent,a).replace(/</g,"&lt;").replace(/>/g,"&gt;"),r.push({header:{text:e},visible:"Visible"===i.state}),n.push({text:e,iconCss:a===t.parent.activeSheetIndex?"e-selected-icon e-icons":""})}),{tabItems:r,ddbItems:n}},e.prototype.refreshSheetTab=function(){var e=this.getSheetTabItems();this.dropDownInstance.items=e.ddbItems,this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0),this.tabInstance.items=e.tabItems,this.tabInstance.selectedItem=this.parent.activeSheetIndex,this.tabInstance.dataBind()},e.prototype.addSheetTab=function(){this.parent.notify(on,{model:this.parent,start:this.parent.activeSheetIndex+1,end:this.parent.activeSheetIndex+1,modelType:"Sheet",isAction:!0,activeSheetIndex:this.parent.activeSheetIndex+1})},e.prototype.insertSheetTab=function(e){this.parent.notify("removeDesignChart",{}),e.preventUpdate&&e.startIdx!==this.tabInstance.selectedItem||(this.dropDownInstance.items[this.tabInstance.selectedItem].iconCss="");for(var t=e.startIdx;t<=e.endIdx;t++){var r=this.parent.sheets[t].name.replace(/</g,"&lt;").replace(/>/g,"&gt;");this.dropDownInstance.items.splice(t,0,{text:r}),this.tabInstance.addTab([{header:{text:r},content:""}],t)}e.preventUpdate&&e.startIdx!==this.tabInstance.selectedItem||(this.dropDownInstance.items[e.startIdx].iconCss="e-selected-icon e-icons"),this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0),e.preventUpdate?e.startIdx!==this.tabInstance.selectedItem?this.refreshSheetTab():this.parent.notify("protectSheet",null):this.updateSheetTab({idx:e.startIdx,preventDataBind:!0})},e.prototype.updateSheetTab=function(e){if("activeSheetChanged"===e.name)e.idx=this.parent.skipHiddenSheets(e.idx);else if("Hidden"===this.parent.sheets[e.idx].state){if(this.parent.isProtected)return;this.showSheet({sheetIndex:e.idx,triggerEvent:!0})}this.tabInstance.selectedItem=e.idx,e.preventDataBind||this.tabInstance.dataBind(),this.parent.notify("protectSheet",null)},e.prototype.showSheet=function(e){this.parent.setSheetPropertyOnMute(this.parent.sheets[e.sheetIndex],"state","Visible"),this.tabInstance.hideTab(e.sheetIndex,!1),e.triggerEvent&&this.parent.notify(ci,{action:"showSheet",eventArgs:{sheetIndex:e.sheetIndex}})},e.prototype.switchSheetTab=function(e){var r=t.closest(e.event.target,".e-toolbar-item");if(r){for(var n=r.querySelector(".e-tab-text").textContent,i=[],a=this.parent.element.id+"_cmenu",o=0,s=this.parent.sheets.length;o<s;o++)if(this.parent.sheets[o].name===n){this.parent.activeSheetIndex!==o&&this.updateSheetTab({idx:o});break}e.element.classList.contains("e-contextmenu")&&e.items[0]&&e.items[0].id===this.parent.element.id+"_cmenu_insert_sheet"&&(1===this.skipHiddenSheets()&&i.push(a+"_hide_sheet",a+"_delete_sheet"),this.parent.allowInsert&&!this.parent.isProtected||i.push(a+"_insert_sheet"),!this.parent.allowDelete&&i.indexOf(a+"_delete_sheet")>-1&&i.push(a+"_delete_sheet")),(this.parent.password.length>0||this.parent.isProtected)&&(i.indexOf(a+"_insert_sheet")>-1&&i.push(a+"_insert_sheet"),i.indexOf(a+"_delete_sheet")>-1&&i.push(a+"_delete_sheet"),i.push(a+"_duplicate",a+"_rename",a+"_hide_sheet",a+"_delete_sheet",a+"_insert_sheet",a+"_move_left",a+"_move_right")),this.parent.enableContextMenuItems(i,!1,!0)}},e.prototype.skipHiddenSheets=function(){var e=this.parent.sheets.length;return this.parent.sheets.forEach(function(t){"Visible"!==t.state&&--e}),e},e.prototype.renameSheetTab=function(){var e=this.tabInstance.element.querySelector(".e-toolbar-item.e-active");if(e){var r=(e=e.querySelector(".e-text-wrap")).querySelector(".e-tab-text").textContent,n={eventArgs:{name:r,index:this.parent.getActiveSheet().id},action:"renameSheet",cancel:!1};if(this.parent.trigger("actionBegin",n),n.cancel||this.parent.isProtected)return;var i=this.parent.createElement("input",{id:this.parent.element.id+"_rename_input",className:"e-input e-sheet-rename",styles:"width: "+e.getBoundingClientRect().width+"px",attrs:{type:"text",name:"Rename",required:"",value:r,spellcheck:"false",maxlength:"31"}});e.firstElementChild.style.display="none",e.appendChild(i),t.EventHandler.add(document,"mousedown touchstart",this.renameInputFocusOut,this),t.EventHandler.add(i,"keydown",this.renameKeyDown,this),t.EventHandler.add(i,"input",this.updateWidth,this),i.focus(),i.setSelectionRange(0,r.length),t.EventHandler.remove(t.closest(e,".e-toolbar-items"),"dblclick",this.renameSheetTab)}},e.prototype.updateWidth=function(e){var t=e.target,r=t.value.length,n=t.value.split(" ");if(n.length){var i=n.length-1;r-=i,r+=.5*i}t.style.width=r+"ch"},e.prototype.renameKeyDown=function(e){32===e.keyCode?e.stopPropagation():27===e.keyCode?(this.removeRenameInput(e.target),this.focusTab(this.tabInstance.element)):13===e.keyCode&&this.renameInputFocusOut(e)},e.prototype.renameInputFocusOut=function(e){var r=e.target;if("mousedown"!==e.type&&"touchstart"!==e.type||!r.classList.contains("e-sheet-rename")&&!t.closest(r,".e-dlg-container")){var n=(r=document.getElementById(this.parent.element.id+"_rename_input")).value,i=this.parent.serviceLocator.getService(Na);if(n){var a=this.tabInstance.selectedItem;if(n.match(new RegExp(".*[\\[\\]\\*\\\\/\\?].*")))this.showRenameDialog(r,i.getConstant("SheetRenameInvalidAlert"));else{if(this.parent.sheets[a].name!==n)for(var o=0,s=this.parent.sheets.length;o<s;o++)if(o!==this.parent.activeSheetIndex&&this.parent.sheets[o].name.toLowerCase()===n.toLowerCase())return void this.showRenameDialog(r,i.getConstant("SheetRenameAlreadyExistsAlert"));var l=this.removeRenameInput(r);this.parent.sheets[a].name!==n&&(this.parent.setSheetPropertyOnMute(this.parent.sheets[a],"name",n),this.updateSheetName({value:n,idx:a,items:l})),"keydown"===e.type?this.focusTab(l):t.closest(e.target,".e-spreadsheet")&&or(this.parent.element)}}else this.showRenameDialog(r,i.getConstant("SheetRenameEmptyAlert"));this.parent.notify(ci,{eventArgs:{index:this.parent.getActiveSheet().id,value:n},action:"renameSheet"})}},e.prototype.focusTab=function(e){or(t.select(".e-toolbar-item.e-active .e-tab-wrap",e))},e.prototype.updateSheetName=function(e){var t=this.tabInstance.items[e.idx].header.text.replace(/&lt;/g,"<").replace(/&gt;/g,">"),r=e.value.replace(/</g,"&lt;").replace(/>/g,"&gt;");this.tabInstance.items[e.idx].header.text=r,this.dropDownInstance.items[e.idx].text=r,this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0);var n=e.items.querySelectorAll(".e-toolbar-item")[e.idx].querySelector(".e-tab-text");if(n.textContent="",n.appendChild(document.createTextNode(e.value)),e.value.indexOf("  ")>-1?this.tabInstance.setProperties({items:this.tabInstance.items},!0):this.tabInstance.dataBind(),this.parent.notify("sheetRenameUpdate",{value:e.value,pName:t}),this.parent.allowChart){var i,a=[];this.parent.chartColl.forEach(function(r){r.range.includes("!")&&(i=r.range.lastIndexOf("!"),a[0]=r.range.substring(0,i),a[1]=r.range.substring(i+1),a[0].toLowerCase()===t.toLowerCase()&&(a[0]=e.value,r.range=a.join("!")))})}},e.prototype.hideSheet=function(e){var t={action:"hideSheet",eventArgs:{sheetIndex:e.sheetIndex,cancel:!1}};e.triggerEvent&&(this.parent.notify(qr,t),t.eventArgs.cancel)||(this.parent.setSheetPropertyOnMute(Ae(this.parent,e.sheetIndex),"state","Hidden"),this.tabInstance.hideTab(e.sheetIndex),e.triggerEvent&&(delete t.eventArgs.cancel,this.parent.notify(ci,t)))},e.prototype.removeRenameInput=function(e){var r=e.parentElement.querySelector(".e-tab-text"),n=t.closest(e,".e-toolbar-items");return t.EventHandler.add(n,"dblclick",this.renameSheetTab,this),t.EventHandler.remove(document,"mousedown touchstart",this.renameInputFocusOut),t.EventHandler.remove(e,"keydown",this.renameKeyDown),t.EventHandler.remove(e,"input",this.updateWidth),t.remove(e),r.style.display="",n},e.prototype.showRenameDialog=function(e,t){var r,n=this;this.parent.serviceLocator.getService(Fa).show({height:180,width:400,isModal:!0,showCloseIcon:!0,content:t,beforeOpen:function(i){var a={dialogName:"SheetRenameDialog",element:i.element,target:i.target,cancel:i.cancel};n.parent.trigger("dialogBeforeOpen",a),a.cancel?r=i.preventFocus=i.cancel=!0:(i.element.querySelector(".e-footer-content .e-primary").setAttribute("aria-label",t+" "+n.parent.serviceLocator.getService(Na).getConstant("Ok")),or(e))},close:function(){r?ft(function(){var t=[e.selectionStart,e.selectionEnd];or(e),e.setSelectionRange(t[0],t[1])}):e.setSelectionRange(0,e.value.length)}})},e.prototype.focusRenameInput=function(){var e=document.getElementById(this.parent.element.id+"_rename_input");e&&e.focus()},e.prototype.removeSheetTab=function(e){var r=this;if(!e.count||e.count!==this.parent.sheets.length){var n=this.parent.serviceLocator.getService(Na);if(this.skipHiddenSheets()>1){var i=e.sheetName?Ae(this.parent,Se(this.parent,e.sheetName)):this.parent.getActiveSheet(),a=t.isNullOrUndefined(e.index)?Se(this.parent,i.name):e.index,o={index:a,sheetCount:this.parent.sheets.length,sheetName:i.name};if(!(!i.rows||!i.rows.length)&&(1!==i.rows.length||!(!i.rows[0].cells||!i.rows[0].cells.length))){var s=this.parent.serviceLocator.getService(Fa);e.clicked?this.forceDelete(a):s.show({height:200,width:400,isModal:!0,showCloseIcon:!0,cssClass:"e-delete-sheet-dlg",content:n.getConstant("DeleteSheetAlert"),beforeOpen:function(e){var t={dialogName:"DeleteSheetDialog",element:e.element,target:e.target,cancel:e.cancel};r.parent.trigger("dialogBeforeOpen",t),t.cancel?e.cancel=!0:(e.element.querySelector(".e-footer-content .e-primary").setAttribute("aria-label",n.getConstant("DeleteSheetAlert")+" "+n.getConstant("Ok")),or(r.parent.element))},buttons:[{buttonModel:{content:n.getConstant("Ok"),isPrimary:!0},click:function(){s.hide(),r.forceDelete(a),r.parent.notify("clearUndoRedoCollection",null),e&&!e.isAction&&(o.sheetCount=r.parent.sheets.length,r.parent.notify(ci,{eventArgs:o,action:"removeSheet"}))}}]})}else this.parent.notify("refreshInsertDelete",{startIndex:a,endIndex:a,modelType:"Sheet",isDelete:!0}),this.parent.notify(Kr,{action:"deleteSheetTab",sheetId:Ae(this.parent,a).id}),this.destroySheet(a),this.parent.notify("clearUndoRedoCollection",null),e&&!e.isAction&&(o.sheetCount=this.parent.sheets.length,this.parent.notify(ci,{eventArgs:o,action:"removeSheet"}))}else this.parent.serviceLocator.getService(Fa).show({height:180,width:400,isModal:!0,showCloseIcon:!0,content:n.getConstant("DeleteSingleLastSheetAlert"),beforeOpen:function(e){var t={dialogName:"DeleteSingleSheetDialog",element:e.element,target:e.target,cancel:e.cancel};r.parent.trigger("dialogBeforeOpen",t),t.cancel&&(e.cancel=!0)}})}},e.prototype.forceDelete=function(e){this.parent.notify("removeDesignChart",{}),this.parent.notify("refreshInsertDelete",{startIndex:e,endIndex:e,modelType:"Sheet",isDelete:!0}),this.parent.notify(Kr,{action:"deleteSheetTab",sheetId:Ae(this.parent,e).id}),this.destroySheet(e)},e.prototype.destroySheet=function(e){var r=t.isNullOrUndefined(e)?this.parent.activeSheetIndex:e;this.parent.removeSheet(r),this.parent.notify("sheetsDestroyed",{sheetIndex:r}),this.dropDownInstance.items.splice(r,1),this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0),this.tabInstance.removeTab(r);var n=this.parent.skipHiddenSheets(this.tabInstance.selectedItem);this.parent.activeSheetIndex=n,this.parent.setProperties({activeSheetIndex:n},!0),this.parent.renderModule.refreshSheet(),this.tabInstance.selectedItem=n,this.tabInstance.dataBind(),this.updateDropDownItems(n),this.parent.notify("protectSheet",null)},e.prototype.showAggregate=function(e){var t=this;if(E(c(this.parent.getActiveSheet().selectedRange))||e&&e.remove)return void this.removeAggregate();var r={Count:0,Sum:"0",Avg:"0",Min:"0",Max:"0",countOnly:!0};if(this.parent.notify("aggregateComputation",r),r.Count>1){this.aggregateContent=r.countOnly?"Count":this.selaggregateCnt,r.countOnly&&(this.aggregateContent="Count",delete r.Sum,delete r.Avg,delete r.Min,delete r.Max);var n=r.countOnly?"e-aggregate-list e-flat e-aggregate-list-countonly e-caret-hide":"e-aggregate-list e-flat";delete r.countOnly;var i=this.aggregateContent,a=i+": "+r[i.toString()];if(this.aggregateDropDown)this.updateAggregateContent(a,r);else{var o=this.parent.createElement("button",{id:this.parent.element.id+"_aggregate",attrs:{type:"button"}});document.getElementById(this.parent.element.id+"_sheet_tab_panel").appendChild(o),this.aggregateDropDown=new d.DropDownButton({content:a,items:this.getAggregateItems(r),createPopupOnClick:!0,select:function(e){t.parent.notify("aggregateComputation",r),t.updateAggregateContent(e.item.text,{Count:r.Count,Sum:r.Sum,Avg:r.Avg,Min:r.Min,Max:r.Max},!0)},beforeOpen:function(e){return t.beforeOpenHandler(t.aggregateDropDown,e.element)},open:function(e){return t.openHandler(t.aggregateDropDown,e.element,"right")},close:function(){return or(t.parent.element)},cssClass:n}),this.aggregateDropDown.createElement=this.parent.createElement,this.aggregateDropDown.appendTo(o)}}else this.removeAggregate()},e.prototype.getAggregateItems=function(e){var t,r,n,i=this,a=[];return Object.keys(e).forEach(function(o){"aggregateComputation"!==(n=e[""+o])&&(t=o+": "+n,r=o===i.aggregateContent?"e-selected-icon e-icons":"",a.push({text:t,iconCss:r}))}),a},e.prototype.updateAggregateContent=function(e,t,r){this.aggregateContent=e.split(": ")[0],r&&(this.selaggregateCnt=e.split(": ")[0]),this.aggregateDropDown.content=e,this.aggregateDropDown.dataBind(),this.aggregateDropDown.setProperties({items:this.getAggregateItems(t)},!0)},e.prototype.removeAggregate=function(){t.isNullOrUndefined(this.aggregateDropDown)||(this.aggregateDropDown.destroy(),t.remove(this.aggregateDropDown.element),this.aggregateDropDown=null)},e.prototype.addEventListener=function(){this.parent.on("sheetTabs",this.createSheetTabs,this),this.parent.on("refreshSheetTabs",this.refreshSheetTab,this),this.parent.on("insertSheetTab",this.insertSheetTab,this),this.parent.on(Jn,this.removeSheetTab,this),this.parent.on("renameSheetTab",this.renameSheetTab,this),this.parent.on(Zn,this.switchSheetTab,this),this.parent.on("activeSheetChanged",this.updateSheetTab,this),this.parent.on("activeCellChanged",this.removeAggregate,this),this.parent.on("focusRenameInput",this.focusRenameInput,this),this.parent.on(li,this.updateSheetName,this),this.parent.on(di,this.hideSheet,this),this.parent.on("showAggregate",this.showAggregate,this),this.parent.on(bi,this.goToSheet,this),this.parent.on(xi,this.showSheet,this)},e.prototype.destroy=function(){this.removeEventListener(),this.dropDownInstance&&this.dropDownInstance.destroy(),this.dropDownInstance=null,this.tabInstance&&this.tabInstance.destroy(),this.tabInstance=null,this.removeAggregate(),this.aggregateContent=null,this.addBtnRipple&&this.addBtnRipple(),this.addBtnRipple=null,t.EventHandler.remove(document,"mousedown touchstart",this.renameInputFocusOut);var e=document.getElementById(this.parent.element.id+"_sheet_tab_panel");e&&t.remove(e),this.selaggregateCnt&&(this.selaggregateCnt=null),this.parent=null},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("sheetTabs",this.createSheetTabs),this.parent.off("refreshSheetTabs",this.refreshSheetTab),this.parent.off("insertSheetTab",this.insertSheetTab),this.parent.off(Jn,this.removeSheetTab),this.parent.off("renameSheetTab",this.renameSheetTab),this.parent.off(Zn,this.switchSheetTab),this.parent.off("activeSheetChanged",this.updateSheetTab),this.parent.off("activeCellChanged",this.removeAggregate),this.parent.off("focusRenameInput",this.focusRenameInput),this.parent.off(li,this.updateSheetName),this.parent.off(di,this.hideSheet),this.parent.off("showAggregate",this.showAggregate),this.parent.off(bi,this.goToSheet),this.parent.off(xi,this.showSheet))},e}(),ko=function(){function e(e){this.isImportedFile=!1,this.unProtectSheetIdx=[],this.parent=e,this.addEventListener(),this.renderFileUpload()}return e.prototype.addEventListener=function(){this.parent.on("openSuccess",this.openSuccess,this),this.parent.on("openFailure",this.openFailed,this),this.parent.on("sheetsDestroyed",this.sheetsDestroyHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("openSuccess",this.openSuccess),this.parent.off("openFailure",this.openFailed),this.parent.off("sheetsDestroyed",this.sheetsDestroyHandler))},e.prototype.renderFileUpload=function(){var e=this.parent.element.appendChild(this.parent.createElement("input",{id:this.parent.element.id+"_fileUpload",attrs:{type:"file",accept:".xls, .xlsx, .csv, .xlsm, .xlsb",name:"fileUpload"}}));e.onchange=this.fileSelect.bind(this),e.onerror=this.openFailed.bind(this),e.style.display="none"},e.prototype.fileSelect=function(e){var r=e.target.files[0];if(!(r&&r.length<1)){var n={file:r};this.parent.open(n),t.select("#"+this.parent.element.id+"_fileUpload",this.parent.element).value=""}},e.prototype.openSuccess=function(e){var t=this,r=["UnsupportedFile","InvalidUrl","NeedPassword","InCorrectPassword","InCorrectSheetPassword","CorrectSheetPassword","DataLimitExceeded","FileSizeLimitExceeded","ExternalWorkbook"],n=function(r){t.parent.serviceLocator.getService(Fa).hide(!0);var n=new File([],e.guid,{type:r.toLowerCase()});t.parent.open({file:n,guid:e.guid,password:e.eventArgs.password,orginalFile:e.eventArgs.file})};if(r.indexOf(e.data)>-1){var i=this.parent.serviceLocator.getService(Na);if(r[2]===e.data)this.parent.element.querySelector(".e-importprotectworkbook-dlg")||this.parent.notify("importProtectWorkbook",e.eventArgs);else if(r[3]===e.data)(a=this.parent.createElement("span",{className:"e-importprotectpwd-alert-span"})).innerText=i.getConstant("IncorrectPassword"),this.parent.element.querySelector(".e-importprotectworkbook-dlg").querySelector(".e-dlg-content").appendChild(a);else if(r[4]===e.data){var a=this.parent.createElement("span",{className:"e-unprotectsheetpwd-alert-span"});a.innerText=i.getConstant("IncorrectPassword"),this.parent.element.querySelector(".e-unprotectworksheet-dlg").querySelector(".e-dlg-content").appendChild(a)}else{if(r[5]!==e.data){if(r[8]===e.data){(l=this.parent.serviceLocator.getService(Fa)).hide(!0);var o=e.data.includes("ExternalWorkbook");return this.parent.serviceLocator.getService(Fa).show({content:this.parent.serviceLocator.getService("spreadsheetLocale").getConstant("ExternalWorkbook"),width:"350",buttons:o?[{click:n.bind(this,e.data+"Yes"),buttonModel:{content:i.getConstant("Yes"),isPrimary:!0}},{click:n.bind(this,e.data+"No"),buttonModel:{content:i.getConstant("No")}}]:[],beforeOpen:function(e){var r={dialogName:"OpenDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",r),r.cancel&&(e.cancel=!0)}},!!o||null),void this.parent.hideSpinner()}(l=this.parent.serviceLocator.getService(Fa)).hide(!0);var s=e.data.includes("LimitExceeded");return this.parent.serviceLocator.getService(Fa).show({content:this.parent.serviceLocator.getService("spreadsheetLocale").getConstant(e.data),width:"300",buttons:s?[{click:n.bind(this,e.data+"Open"),buttonModel:{content:i.getConstant("Ok"),isPrimary:!0}},{click:n.bind(this,e.data+"Cancel"),buttonModel:{content:i.getConstant("Cancel")}}]:[],beforeOpen:function(e){var r={dialogName:"OpenDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",r),r.cancel&&(e.cancel=!0)}},!!s||null),void this.parent.hideSpinner()}this.parent.isOpen=!1,this.parent.notify("unProtectSheetPassword",null),(l=this.parent.serviceLocator.getService(Fa)).hide(),this.parent.hideSpinner()}}else{var l=this.parent.serviceLocator.getService(Fa);l.hide(),this.parent.showSpinner()}this.parent.element&&r[5]!==e.data&&(this.parent.notify(tn,{cellRef:null,isOpen:!0}),e.isOpenFromJson||(this.parent.trigger("openComplete",{response:e}),this.parent.notify(ci,{response:e,action:"import"})),this.parent.isProtected&&this.parent.showSheetTabs&&e.isOpenFromJson&&(this.parent.element.querySelector(".e-add-sheet-tab").setAttribute("disabled","true"),this.parent.element.querySelector(".e-add-sheet-tab").classList.add("e-disabled")),this.parent.renderModule.refreshSheet(e.isOpenFromJson,!1,!1,!1,e),this.parent.notify("refreshSheetTabs",null),this.isImportedFile=!0,e.context.preventFormatCheck=e.eventArgs&&e.eventArgs.file&&e.eventArgs.file.name&&!e.eventArgs.file.name.includes(".csv"),this.unProtectSheetIdx=[],this.parent.hideSpinner())},e.prototype.openFailed=function(e){this.parent.trigger("openFailure",e),this.parent.hideSpinner()},e.prototype.sheetsDestroyHandler=function(e){t.isNullOrUndefined(e.sheetIndex)&&(this.isImportedFile=!1,this.unProtectSheetIdx=[])},e.prototype.destroy=function(){this.removeEventListener();var e=t.select("#"+this.parent.element.id+"_fileUpload",this.parent.element);e&&t.detach(e),this.isImportedFile=null,this.unProtectSheetIdx=null,this.parent=null},e.prototype.getModuleName=function(){return"open"},e}(),Oo=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on("beginSave",this.initiateSave,this),this.parent.on("saveCompleted",this.saveCompleted,this),this.parent.on("saveError",this.showErrorDialog,this),this.parent.on("exportDialog",this.exportDialog,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("beginSave",this.initiateSave),this.parent.off("saveCompleted",this.saveCompleted),this.parent.off("saveError",this.showErrorDialog),this.parent.off("exportDialog",this.exportDialog))},e.prototype.getModuleName=function(){return"save"},e.prototype.initiateSave=function(){this.parent.showSpinner()},e.prototype.saveCompleted=function(){this.parent.hideSpinner()},e.prototype.showErrorDialog=function(e){var t=this;this.parent.serviceLocator.getService(Fa).show({isModal:!0,showCloseIcon:!0,height:180,width:400,content:e.content,beforeOpen:function(){return or(t.parent.element)}})},e.prototype.exportDialog=function(e){var r=this,n=this.parent.serviceLocator.getService(Na),i=this.parent.serviceLocator.getService(Fa),a=e?e.item.id.split(this.parent.element.id+"_")[1]:"xlsx";if(t.isNullOrUndefined(this.parent.element.querySelector(".e-open-dlg"))){var o={isModal:!0,showCloseIcon:!0,cssClass:"e-open-dlg",header:n.getConstant("SaveAs"),beforeOpen:function(e){var t={dialogName:n.getConstant("SaveAs"),element:e.element,target:e.target,cancel:e.cancel};r.parent.trigger("dialogBeforeOpen",t),t.cancel?e.cancel=!0:(i.dialogInstance.content=r.OpenContent(a),i.dialogInstance.dataBind(),r.parent.element.querySelector(".e-text-open").setSelectionRange(0,r.parent.element.querySelector(".e-text-open").value.length),or(r.parent.element))},buttons:[{buttonModel:{content:n.getConstant("Save"),isPrimary:!0,cssClass:"e-btn-open-ok"},click:function(){var n=r.parent.element.querySelector(".e-text-open").value;if(r.checkValidName(n)){i.hide();var a=e?e.item.id.split(r.parent.element.id+"_")[1]:"Xlsx";r.parent.save({saveType:a,fileName:n})}else{var o=r.parent.element.querySelector(".e-btn-open-ok");t.getComponent(o,"btn").disabled=!0;var s=r.parent.serviceLocator.getService(Na),l=0===n.length?s.getConstant("EmptyFileName"):n.length>218?s.getConstant("LargeName"):s.getConstant("FileNameError"),d=r.parent.createElement("span",{className:"e-file-alert-span"});d.innerText=l,r.parent.element.querySelector(".e-file-alert-span")&&r.parent.element.querySelector(".e-file-alert-span").remove(),r.parent.element.querySelector(".e-open-dlg").querySelector(".e-dlg-content").appendChild(d)}}}]};i.show(o)}else i.hide()},e.prototype.checkValidName=function(e){var t=!0;return(e.match(new RegExp('.*[\\[\\]\\*\\\\/\\?\\:\\<\\>\\|\\"].*'))||e.length<1||e.length>218)&&(t=!1),t},e.prototype.OpenContent=function(e){var r=this,n=this.parent.serviceLocator.getService(Na),i=this.parent.createElement("div",{className:"e-open-dialog"}),a=this.parent.createElement("div",{className:"e-open-head"}),o=this.parent.createElement("div",{className:"e-input-group"});i.appendChild(a),i.appendChild(o);var s=n.getConstant("FileName"),l=this.parent.element.id+"_filename",d=this.parent.createElement("p",{className:"e-header",id:l,attrs:{"aria-label":n.getConstant("SaveAs")+" "+s}});d.innerText=s;var h=this.parent.createElement("input",{className:"e-input e-text-open",attrs:{type:"Text","aria-labelledby":l}}),p=this.parent.createElement("span",{className:"e-input-group-icon"});return h.onkeyup=function(e){if(r.parent.element.querySelector(".e-file-alert-span")&&13!==e.keyCode){var n=r.parent.element.querySelector(".e-btn-open-ok");t.getComponent(n,"btn").disabled=!1,r.parent.element.querySelector(".e-file-alert-span").remove()}},a.appendChild(d),p.textContent="."+e.toLowerCase(),o.appendChild(h),h.setAttribute("value","Sample"),o.appendChild(p),i},e}(),To=function(){function e(e){this.parent=e,this.init()}return e.prototype.init=function(){this.initContextMenu(),this.addEventListener()},e.prototype.initContextMenu=function(){var e=document.createElement("ul");e.id=this.parent.element.id+"_contextmenu",this.parent.element.appendChild(e),this.contextMenuInstance=new i.ContextMenu({cssClass:"e-spreadsheet-contextmenu",target:"#"+this.parent.element.id,select:this.selectHandler.bind(this),beforeOpen:this.beforeOpenHandler.bind(this),beforeClose:this.beforeCloseHandler.bind(this),beforeItemRender:function(e){e.element.setAttribute("aria-label",e.item.text)}},e),e.setAttribute("role","menu")},e.prototype.beforeCloseHandler=function(e){var t=this;this.parent.trigger("contextMenuBeforeClose",e),this.parent.enableKeyboardShortcut&&e.event&&27===e.event.keyCode&&ft(function(){return or(t.parent.element)})},e.prototype.selectHandler=function(e){var r=t.extend({cancel:!1},e);this.parent.trigger("contextMenuItemSelect",r);var n=this.parent.element.id+"_cmenu",i=c(this.parent.getActiveSheet().selectedRange),a=[];if((e.item.id===n+"_ascending"||e.item.id===n+"_descending")&&this.parent.sortCollection)for(var o=this.parent.sortCollection.length-1;o>=0;o--)this.parent.sortCollection[o]&&this.parent.sortCollection[o].sheetIndex===this.parent.activeSheetIndex&&(a.push(this.parent.sortCollection[o]),this.parent.sortCollection.splice(o,1));if(e.item.id===n+"_delete_row"||e.item.id===n+"_delete_column"||e.item.id===n+"_insert_column_before"||e.item.id===n+"_insert_column_after"||e.item.id===n+"_insert_row_above"||e.item.id===n+"_insert_row_below"){var s=Qe(this.parent.getActiveSheet(),i[0]),l=ot(this.parent.getActiveSheet(),i[1]);if(s&&!s.isReadOnly&&l&&!l.isReadOnly&&oe(this.parent,i))return void this.parent.notify(yi,null)}if(e.item.id===n+"_ascending"||e.item.id===n+"_descending"||e.item.id===n+"_customsort"){var d=X(i[0],i[1],this.parent.getActiveSheet());if(oe(this.parent,d))return void this.parent.notify(yi,null)}var h;if(!r.cancel){var p=void 0;switch(e.item.id){case n+"_cut":this.parent.notify(Qn,{invokeCopy:!0,promise:Promise});break;case n+"_copy":this.parent.notify(ei,{invokeCopy:!0,promise:Promise});break;case n+"_paste":this.parent.notify(ti,{isAction:!0,isInternal:!0,focus:!0});break;case n+"_pastevalues":this.parent.notify(ti,{type:"Values",isAction:!0,isInternal:!0,focus:!0});break;case n+"_pasteformats":this.parent.notify(ti,{type:"Formats",isAction:!0,isInternal:!0,focus:!0});break;case n+"_rename":this.parent.notify("renameSheetTab",{});break;case n+"_delete_sheet":this.parent.notify(Jn,{}),or(this.parent.element);break;case n+"_insert_sheet":this.parent.notify(on,{model:this.parent,start:this.parent.activeSheetIndex,end:this.parent.activeSheetIndex,modelType:"Sheet",isAction:!0,activeSheetIndex:this.parent.activeSheetIndex});break;case n+"_hide_sheet":this.parent.notify(di,{sheetIndex:this.parent.activeSheetIndex,triggerEvent:!0});break;case n+"_duplicate":Me(this.parent,void 0,!0),or(this.parent.element);break;case n+"_move_right":Pe(this.parent,this.parent.activeSheetIndex+1,null,!0),or(this.parent.element);break;case n+"_move_left":Pe(this.parent,this.parent.activeSheetIndex-1,null,!0),or(this.parent.element);break;case n+"_ascending":this.parent.notify(Tn,{sortOptions:{sortDescriptors:{order:"Ascending"}}}),this.parent.notify("applySort",{sortOptions:{sortDescriptors:{order:"Ascending"}},previousSort:a});break;case n+"_descending":this.parent.notify(Tn,{sortOptions:{sortDescriptors:{order:"Descending"}}}),this.parent.notify("applySort",{sortOptions:{sortDescriptors:{order:"Descending"}},previousSort:a});break;case n+"_customsort":this.parent.notify("initiateCustomSort",null);break;case n+"_filtercellvalue":this.parent.notify("filterByCellValue",null);break;case n+"_clearfilter":h=v(u(this.parent.getActiveSheet().activeCell)[1]+1),this.parent.notify("clearFilter",{field:h});break;case n+"_reapplyfilter":this.parent.notify("reapplyFilter",null);break;case n+"_hide_row":p=c(this.parent.getActiveSheet().selectedRange),this.parent.notify(vn,{startIndex:p[0],endIndex:p[2],hide:!0,isCol:!1,actionUpdate:!0});break;case n+"_unhide_row":p=c(this.parent.getActiveSheet().selectedRange),this.parent.notify(vn,{startIndex:p[0],endIndex:p[2],hide:!1,isCol:!1,actionUpdate:!0});break;case n+"_hide_column":p=c(this.parent.getActiveSheet().selectedRange),this.parent.notify(vn,{startIndex:p[1],endIndex:p[3],hide:!0,isCol:!0,actionUpdate:!0});break;case n+"_unhide_column":p=c(this.parent.getActiveSheet().selectedRange),this.parent.notify(vn,{startIndex:p[1],endIndex:p[3],hide:!1,isCol:!0,actionUpdate:!0});break;case n+"_insert_row_above":case n+"_delete_row":p=c(this.parent.getActiveSheet().selectedRange),this.parent.notify(e.item.id.substr(n.length+1,6)+"Model",{model:this.parent.getActiveSheet(),start:p[0],end:p[2],modelType:"Row",isAction:!0,insertType:"above"});break;case n+"_insert_row_below":p=w(c(this.parent.getActiveSheet().selectedRange)),this.parent.notify(on,{model:this.parent.getActiveSheet(),start:p[2]+1,end:p[2]+1+(p[2]-p[0]),modelType:"Row",isAction:!0,insertType:"below"});break;case n+"_insert_column_before":case n+"_delete_column":p=c(this.parent.getActiveSheet().selectedRange),this.parent.notify(e.item.id.substr(n.length+1,6)+"Model",{model:this.parent.getActiveSheet(),start:p[1],end:p[3],modelType:"Column",isAction:!0,insertType:"before"});break;case n+"_insert_column_after":p=w(c(this.parent.getActiveSheet().selectedRange)),this.parent.notify(on,{model:this.parent.getActiveSheet(),start:p[3]+1,end:p[3]+1+(p[3]-p[1]),modelType:"Column",isAction:!0,insertType:"after"});break;case n+"_addNote":this.parent.notify("addNote",null);break;case n+"_editNote":this.parent.notify("editNote",null);break;case n+"_deleteNote":this.parent.notify("deleteNote",{rowIndex:null,columnIndex:null,isDeleteFromMenu:!0});break;case n+"_hyperlink":this.parent.notify("initiateHyperlink",null);break;case n+"_editHyperlink":this.parent.notify("editHyperlink",null);break;case n+"_openHyperlink":this.parent.notify("openHyperlink",null);break;case n+"_removeHyperlink":this.parent.notify(si,{range:this.parent.getActiveSheet().selectedRange});break;case n+"_protect":this.parent.notify("toggleProtect",{})}}},e.prototype.getInsertModel=function(e,t){for(var r=[],n=e;n<=t;n++)n===e?r.push({index:n}):r.push({});return r},e.prototype.beforeOpenHandler=function(e){for(var r,n,i,a=e.event.target,o=["e-numericcontainer","e-active-cell","e-selection","e-row","e-header-row","e-select-all-cell","e-sheet-tabs-items","e-spreadsheet-contextmenu"],s=0,l=o.length;s<l;s++)if(t.closest(a,"."+o[s])){r=!0;break}if(r)n=this.getTarget(a);else if((r=["e-header-cell","e-rowhdr-table","e-selectall-table","e-main-panel"].some(function(e){return a.classList.contains(e)}))&&(parseInt(a.parentElement.style.zIndex,10)>1||parseInt(a.parentElement.parentElement.style.zIndex,10)>1)){var d=e.event,h={clientY:d.clientY,isImage:!1,target:a},p={clientX:d.clientX,isImage:!1,target:a};this.parent.notify(Ei,h),this.parent.notify(Ri,p),n=h.size<=0?"ColumnHeader":p.size<=0?"RowHeader":"Content"}else r=!1;if(!r)return void(e.cancel=!0);if(e.element.classList.contains("e-contextmenu")){var u=this.parent.getActiveSheet();if(e.event.target&&(a.classList.contains("e-rowresize")||a.classList.contains("e-colresize"))){var f=c(u.selectedRange);if(!(a.classList.contains("e-rowresize")?0===f[1]&&f[3]===u.colCount-1:0===f[0]&&f[2]===u.rowCount-1))return void(e.cancel=!0);i=(a.classList.contains("e-rowresize")?this.parent.hiddenCount(f[0],f[2])!==Math.abs(f[2]-f[0])+1:this.parent.hiddenCount(f[1],f[3],"columns")!==Math.abs(f[3]-f[1])+1)?this.getDataSource(n):this.getDataSource(n,a)}else{if("Content"===n){var g=0===(f=c(u.selectedRange))[1]&&f[3]===u.colCount-1,m=0===f[0]&&f[2]===u.rowCount-1;n=g&&m?"SelectAll":g?"RowHeader":m?"ColumnHeader":"Content"}i=this.getDataSource(n,"Footer"===n?a:void 0)}this.contextMenuInstance.items=i,this.contextMenuInstance.dataBind()}else i=e.items;if("None"===this.parent.selectionSettings.mode&&"Content"===n&&this.parent.enableContextMenuItems(["Filter"],!1,!1),"ColumnHeader"===n||"RowHeader"===n){if(e.element&&e.element.childElementCount>0){var v="ColumnHeader"===n?e.element.querySelector("#"+this.parent.element.id+"_cmenu_insert_column"):e.element.querySelector("#"+this.parent.element.id+"_cmenu_insert_row"),y="ColumnHeader"===n?e.element.querySelector("#"+this.parent.element.id+"_cmenu_delete_column"):e.element.querySelector("#"+this.parent.element.id+"_cmenu_delete_row");this.parent.allowInsert&&v.classList.contains("e-disabled")?v.classList.remove("e-disabled"):this.parent.allowInsert&&!this.parent.element.querySelector(".e-selectall.e-highlight")||v.classList.contains("e-disabled")||v.classList.add("e-disabled"),this.parent.allowDelete&&y.classList.contains("e-disabled")?y.classList.remove("e-disabled"):this.parent.allowDelete||y.classList.contains("e-disabled")||y.classList.add("e-disabled"),"None"===this.parent.selectionSettings.mode&&("ColumnHeader"===n&&this.parent.enableContextMenuItems(["Insert Column","Delete Column","Hide Column"],!1,!1),"RowHeader"===n&&this.parent.enableContextMenuItems(["Insert Row","Delete Row","Hide Row"],!1,!1))}}else if("Footer"===n){var C=Se(this.parent,a.textContent);0===C&&e.element.querySelector("#"+this.parent.element.id+"_cmenu_move_left").classList.add("e-disabled"),C===this.parent.sheets.length-1&&e.element.querySelector("#"+this.parent.element.id+"_cmenu_move_right").classList.add("e-disabled"),"None"===this.parent.selectionSettings.mode&&this.parent.enableContextMenuItems(["Insert"],!1,!1)}this.parent.trigger("contextMenuBeforeOpen",e),this.parent.notify(Zn,t.extend(e,{target:n,items:i}))},e.prototype.getTarget=function(e){return t.closest(e,".e-sheet-content")?"Content":t.closest(e,".e-column-header")?e.classList.contains("e-header-cell")?"ColumnHeader":"Content":t.closest(e,".e-row-header")?e.classList.contains("e-header-cell")?"RowHeader":"Content":t.closest(e,".e-sheet-tabs-items")?"Footer":t.closest(e,".e-selectall-container")?e.classList.contains("e-header-cell")?t.closest(e,".e-header-row")?"ColumnHeader":"RowHeader":t.closest(e,".e-select-all-cell")?"SelectAll":"Content":""},e.prototype.getDataSource=function(e,t){var r=this.parent.serviceLocator.getService(Na),n=[],i=this.parent.element.id+"_cmenu";if("Content"===e)this.setClipboardData(n,r,i),n.push({separator:!0}),this.setFilterItems(n,i),this.setSortItems(n,i),n.push({separator:!0}),this.parent.enableNotes&&(this.setNotesMenu(n,i),n.push({separator:!0})),this.setHyperLink(n,i);else if("RowHeader"===e){this.setClipboardData(n,r,i);o=c((a=this.parent.getActiveSheet()).selectedRange);this.setInsertDeleteItems(n,r,"Row",i,[o[0],o[2]],["Above","Below"]),t&&!t.classList.contains("e-rowresize")&&t.parentElement&&t.parentElement.classList.value.includes("e-hide")||this.setHideShowItems(n,r,"Row",i,[o[0],o[2]])}else if("ColumnHeader"===e){this.setClipboardData(n,r,i);var a=this.parent.getActiveSheet(),o=c(a.selectedRange);this.setInsertDeleteItems(n,r,"Column",i,[o[1],o[3]],["Before","After"]),t&&t.classList.value.includes("e-hide")||this.setHideShowItems(n,r,"Column",i,[o[1],o[3]])}else"SelectAll"===e?(this.setClipboardData(n,r,i),this.setFilterItems(n,i),this.setSortItems(n,i)):"Footer"===e&&(n.push({text:r.getConstant("Insert"),id:i+"_insert_sheet"}),n.push({text:r.getConstant("Delete"),iconCss:"e-icons e-delete",id:i+"_delete_sheet"}),n.push({text:r.getConstant("DuplicateSheet"),id:i+"_duplicate"}),n.push({text:r.getConstant("Rename"),id:i+"_rename"}),n.push({text:r.getConstant("Hide"),id:i+"_hide_sheet"}),this.setProtectSheetItems(n,i,t),n.push({text:r.getConstant("MoveRight"),id:i+"_move_right"}),n.push({text:r.getConstant("MoveLeft"),id:i+"_move_left"}));return n},e.prototype.setProtectSheetItems=function(e,t,r){var n=this.parent.serviceLocator.getService(Na);Ae(this.parent,Se(this.parent,r.textContent)).isProtected?e.push({text:n.getConstant("UnprotectSheet"),id:t+"_protect",iconCss:"e-icons e-protect-icon"}):e.push({text:n.getConstant("ProtectSheet"),id:t+"_protect",iconCss:"e-icons e-protect-icon"})},e.prototype.setFilterItems=function(e,t){if(this.parent.allowFiltering){var r=this.parent.serviceLocator.getService(Na),n={clearFilterText:null,isFiltered:!1};this.parent.notify("getFilteredColumn",n),e.push({text:r.getConstant("Filter"),id:t+"_filter",iconCss:"",items:[{text:n.clearFilterText,iconCss:"e-icons e-filter-clear",id:t+"_clearfilter"},{text:r.getConstant("ReapplyFilter"),iconCss:"e-icons e-filter-reapply",id:t+"_reapplyfilter"},{separator:!0},{text:r.getConstant("FilterCellValue"),iconCss:"",id:t+"_filtercellvalue"}]})}},e.prototype.setSortItems=function(e,t){var r=this.parent.serviceLocator.getService(Na);this.parent.allowSorting&&e.push({text:r.getConstant("Sort"),id:t+"_sort",iconCss:"e-icons e-sort-icon",items:[{text:r.getConstant("SortAscending"),iconCss:"e-icons e-sort-asc",id:t+"_ascending"},{text:r.getConstant("SortDescending"),iconCss:"e-icons e-sort-desc",id:t+"_descending"},{text:r.getConstant("CustomSort")+"...",iconCss:"e-icons e-sort-custom",id:t+"_customsort"}]})},e.prototype.setHyperLink=function(e,r){if(this.parent.allowHyperlink){var n=this.parent.serviceLocator.getService(Na),i=u(this.parent.getActiveSheet().activeCell),a=this.parent.getCell(i[0],i[1]);t.isNullOrUndefined(a)?e.push({text:n.getConstant("Hyperlink"),iconCss:"e-icons e-hyperlink-icon",id:r+"_hyperlink"}):a.getElementsByClassName("e-hyperlink")[0]||a.classList.contains("e-hyperlink")?e.push({text:n.getConstant("EditHyperlink"),iconCss:"e-icons e-edithyperlink-icon",id:r+"_editHyperlink"},{text:n.getConstant("OpenHyperlink"),iconCss:"e-icons e-openhyperlink-icon",id:r+"_openHyperlink"},{text:n.getConstant("RemoveHyperlink"),iconCss:"e-icons e-removehyperlink-icon",id:r+"_removeHyperlink"}):e.push({text:n.getConstant("Hyperlink"),iconCss:"e-icons e-hyperlink-icon",id:r+"_hyperlink"})}},e.prototype.setNotesMenu=function(e,r){if(this.parent.enableNotes){var n=this.parent.serviceLocator.getService(Na),i=u(this.parent.getActiveSheet().activeCell),a=this.parent.getCell(i[0],i[1]);!t.isNullOrUndefined(a)&&a.children.length>0&&a.children[a.children.length-1].className.indexOf("addNoteIndicator")>-1?e.push({text:n.getConstant("EditNote"),iconCss:"e-icons e-edit-notes",id:r+"_editNote"},{text:n.getConstant("DeleteNote"),iconCss:"e-icons e-delete-notes",id:r+"_deleteNote"}):e.push({text:n.getConstant("AddNote"),iconCss:"e-icons e-add-notes",id:r+"_addNote"})}},e.prototype.setClipboardData=function(e,t,r){this.parent.enableClipboard&&(e.push({text:t.getConstant("Cut"),iconCss:"e-icons e-cut-icon",id:r+"_cut"}),e.push({text:t.getConstant("Copy"),iconCss:"e-icons e-copy-icon",id:r+"_copy"}),e.push({text:t.getConstant("Paste"),iconCss:"e-icons e-paste-icon",id:r+"_paste"}),e.push({text:t.getConstant("PasteSpecial"),id:r+"_pastespecial",items:[{text:t.getConstant("Values"),id:r+"_pastevalues"},{text:t.getConstant("Formats"),id:r+"_pasteformats"}]}))},e.prototype.setInsertDeleteItems=function(e,t,r,n,i,a){e.push({separator:!0}),["Insert","Delete"].forEach(function(o){i[0]===i[1]?e.push({text:t.getConstant(""+o+r),id:n+"_"+o.toLowerCase()+"_"+r.toLowerCase()}):e.push({text:t.getConstant(""+o+r+"s"),id:n+"_"+o.toLowerCase()+"_"+r.toLowerCase()}),"Insert"===o&&(e[e.length-1].items=[],a.forEach(function(r){e[e.length-1].items.push({text:t.getConstant(r),id:e[e.length-1].id+"_"+r.toLowerCase()})}))})},e.prototype.setHideShowItems=function(e,t,r,n,i){if(i[0]===i[1])e.push({text:t.getConstant("Hide"+r),id:n+"_hide_"+r.toLowerCase()});else{var a=i[0];i[0]=i[0]>i[1]?i[1]:i[0],i[1]=i[1]>a?i[1]:a,e.push({text:t.getConstant("Hide"+r+"s"),id:n+"_hide_"+r.toLowerCase()})}this.parent.hiddenCount(i[0],i[1],r.toLowerCase()+"s")&&e.push({text:t.getConstant("Unhide"+r+"s"),id:n+"_unhide_"+r.toLowerCase()})},e.prototype.addEventListener=function(){this.parent.on("addContextMenuItems",this.addItemsHandler,this),this.parent.on("removeContextMenuItems",this.removeItemsHandler,this),this.parent.on("enableContextMenuItems",this.enableItemsHandler,this)},e.prototype.addItemsHandler=function(e){e.insertAfter?this.contextMenuInstance.insertAfter(e.items,e.text,e.isUniqueId):this.contextMenuInstance.insertBefore(e.items,e.text,e.isUniqueId)},e.prototype.removeItemsHandler=function(e){this.contextMenuInstance.removeItems(e.items,e.isUniqueId)},e.prototype.enableItemsHandler=function(e){this.contextMenuInstance.enableItems(e.items,e.enable,e.isUniqueId)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("addContextMenuItems",this.addItemsHandler),this.parent.off("removeContextMenuItems",this.removeItemsHandler),this.parent.off("enableContextMenuItems",this.enableItemsHandler))},e.prototype.getModuleName=function(){return"contextMenu"},e.prototype.destroy=function(){this.removeEventListener(),this.contextMenuInstance.destroy();var e=document.getElementById(this.parent.element.id+"_contextmenu");e&&t.detach(e),this.contextMenuInstance=null,this.parent=null},e}(),Do=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.refreshCellElement=function(e){this.parent.refreshNode(e.td,e)},e.prototype.getTextSpace=function(e){e.width=Jt(e.char,e.cell.style,this.parent.cellStyle)},e.prototype.rowFillHandler=function(e){var t=e.cellEle;if(t){var r=void 0,n=e.colIdx;if(e.cell.colSpan>1){var i={range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]};this.parent.notify(mn,i),n=i.range[3]}var a=rr(this.parent.getActiveSheet(),e.rowIdx,e.colIdx,n),o=e.iconSetSpan||t.querySelector(".e-iconsetspan");if(o&&(a-=o.getBoundingClientRect().width),e.updateFillSize){if(!(r=t.querySelector(".e-fill"))||!r.textContent)return;e.repeatChar=r.textContent[0],(l=t.querySelector(".e-fill-before"))&&(a-=Jt(l.textContent,e.cell.style,this.parent.cellStyle)),(d=t.querySelector(".e-fill-sec"))&&(a-=Jt(d.textContent,e.cell.style,this.parent.cellStyle))}else{var s=t.querySelector(".e-addNoteIndicator");if(t.innerText="",e.beforeFillText){var l=this.parent.createElement("span",{className:"e-fill-before",styles:"float: "+(this.parent.enableRtl?"right":"left")});l.innerText=e.beforeFillText,t.appendChild(l),a-=Jt(e.beforeFillText,e.cell.style,this.parent.cellStyle)}if(r=this.parent.createElement("span",{className:"e-fill"}),t.appendChild(r),e.afterFillText){var d=this.parent.createElement("span",{className:"e-fill-sec"});d.innerText=e.afterFillText,t.appendChild(d),a-=Jt(e.afterFillText,e.cell.style,this.parent.cellStyle)}o&&t.insertBefore(o,t.childNodes[0]),s&&t.appendChild(s)}var h=Jt(e.repeatChar,e.cell.style,this.parent.cellStyle),p=parseInt((a/h).toString(),10);e.formattedText=p>0?e.repeatChar.repeat(p):"",r.textContent=e.formattedText}},e.prototype.addEventListener=function(){this.parent.on("refreshCellElem",this.refreshCellElement,this),this.parent.on("rowFillHandler",this.rowFillHandler,this),this.parent.on("getTextSpace",this.getTextSpace,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("refreshCellElem",this.refreshCellElement),this.parent.off("rowFillHandler",this.rowFillHandler),this.parent.off("getTextSpace",this.getTextSpace))},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"numberFormat"},e}(),Lo=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on("applySort",this.applySortHandler,this),this.parent.on("sortComplete",this.sortCompleteHandler,this),this.parent.on("initiateCustomSort",this.initiateCustomSortHandler,this),this.parent.on("sortImport",this.sortImport,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("applySort",this.applySortHandler),this.parent.off("sortComplete",this.sortCompleteHandler),this.parent.off("initiateCustomSort",this.initiateCustomSortHandler),this.parent.off("sortImport",this.sortImport))},e.prototype.getModuleName=function(){return"sort"},e.prototype.isValidSortRange=function(){var e=this.parent.getActiveSheet(),t=w(y(e.selectedRange));return!(t[0]>e.usedRange.rowIndex||t[1]>e.usedRange.colIndex)},e.prototype.sortImport=function(e){for(var t,r=this.parent.sortCollection,n=this.parent.getActiveSheet().usedRange.rowIndex-1,i=e?e.sheetIdx:this.parent.activeSheetIndex,a=0;a<r.length;a++)if(r[a].sheetIndex===i)for(var o=0;o<n;o++)if((t=this.parent.getCell(o,r[a].columnIndex))&&t.querySelector(".e-filter-icon"))return void("Ascending"===r[a].order||"OnTop"===r[a].order?t.querySelector(".e-filter-icon").classList.contains("e-sortasc-filter")||t.querySelector(".e-filter-icon").classList.add("e-sortasc-filter"):t.querySelector(".e-filter-icon").classList.contains("e-sortdesc-filter")||t.querySelector(".e-filter-icon").classList.add("e-sortdesc-filter"))},e.prototype.sortRangeAlertHandler=function(e){var t=this,r=this.parent.serviceLocator.getService(Fa),n=this.parent.serviceLocator.getService(Na);r.show({height:180,width:400,isModal:!0,showCloseIcon:!0,content:e.error,beforeOpen:function(i){var a={dialogName:e.error===n.getConstant("MultiRangeSortError")?"MultiRangeSortDialog":"SortRangeDialog",content:e.error,element:i.element,target:i.target,cancel:i.cancel};t.parent.trigger("dialogBeforeOpen",a),a.cancel?i.cancel=!0:(r.dialogInstance.content=a.content,or(t.parent.element))}}),this.parent.hideSpinner()},e.prototype.initiateCustomSortHandler=function(){var e=this,r=this.parent.serviceLocator.getService(Na),n=this.parent.getActiveSheet();if(!this.isValidSortRange()||0===n.rows.length)return void this.sortRangeAlertHandler({error:r.getConstant("SortOutOfRangeError")});if(lr(n.selectedRange))return void this.sortRangeAlertHandler({error:r.getConstant("MultiRangeSortError")});var i,a=this.parent.serviceLocator.getService(Fa);a.show({height:400,width:560,isModal:!0,showCloseIcon:!0,cssClass:"e-customsort-dlg",header:r.getConstant("CustomSort"),beforeOpen:function(t){var r={dialogName:"CustomSortDialog",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",r),r.cancel?t.cancel=!0:(a.dialogInstance.content=e.customSortContent(),a.dialogInstance.dataBind(),or(e.parent.element))},buttons:[{buttonModel:{content:r.getConstant("Ok"),isPrimary:!0},click:function(){var r=a.dialogInstance.content,n=t.getComponent(r.getElementsByClassName("e-list-sort e-listview e-lib")[0],"listview").dataSource;e.clearError();var o=r.getElementsByClassName("e-sort-error")[0];o.style.display="block",e.validateError(n,r,o)||(i={sortDescriptors:n,containsHeader:r.getElementsByClassName("e-sort-checkheader")[0].checked,caseSensitive:r.getElementsByClassName("e-sort-checkcase")[0].checked},a.hide())}}],close:function(){i&&ft(function(){return e.applySortHandler({sortOptions:i})})}})},e.prototype.validateError=function(e,r,n){var i=this.parent.serviceLocator.getService(Na);if(e.some(function(e){return""===e.field.toString()}))return Array.prototype.some.call(r.getElementsByClassName("e-sort-field"),function(e){var r=!t.getComponent(e,"dropdownlist").value;return r&&e.parentElement.classList.add("e-error"),r}),n.innerText=i.getConstant("SortEmptyFieldError"),!0;var a=new Set,o="",s="";if(e.some(function(e){return o=e.field.toString(),a.size===a.add(e.field).size})){var l=0;Array.prototype.some.call(r.getElementsByClassName("e-sort-field"),function(e){var r=t.getComponent(e,"dropdownlist");return r.value===o&&(e.parentElement.classList.add("e-error"),s=r.text,l++),2===l}),n.innerText="";var d=this.parent.createElement("strong");return d.innerText=s,n.appendChild(d),n.appendChild(document.createTextNode(i.getConstant("SortDuplicateFieldError"))),!0}return!1},e.prototype.customSortContent=function(){var e=this.parent.createElement("div",{className:"e-sort-dialog"}),r=this.getFields(),n=t.getUniqueID("customSort"),i=this.getCustomListview(n);this.setHeaderTab(e,i,r);var a=this.parent.createElement("div",{className:"e-sort-listsection",styles:""});e.appendChild(a);var o=this.parent.createElement("div",{className:"e-list-sort",styles:""});a.appendChild(o),i.createElement=this.parent.createElement,i.appendTo(o),o.removeAttribute("tabindex"),this.renderListItem(n,i,!0,r);var s=this.parent.createElement("div",{className:"e-sort-error"});return e.appendChild(s),e},e.prototype.getFields=function(){var e=this.parent.getActiveSheet(),t=w(y(e.selectedRange));if(t[0]===t[2]&&t[2]-t[0]==0){t[0]=0,t[1]=0,t[3]=e.usedRange.colIndex;var r={filterRange:[],hasFilter:!1};this.parent.notify("getFilterRange",r),r.hasFilter&&r.filterRange&&(t[0]=r.filterRange[0])}var n,i,a=[];for(t[1];t[1]<=t[3];t[1]++){var o=He(t[0],t[1],e);if(i="Column "+v(t[1]+1),o&&o.value){if(n=o.value,o.format){var s={formattedText:n,value:n,format:o.format,rowIndex:t[0],colIndex:t[1]};this.parent.notify(Wr,s),n=s.formattedText}}else n=i;a.push({text:n,value:i})}return a},e.prototype.setHeaderTab=function(e,r,n){var i=this,a=this.parent.serviceLocator.getService(Na),s=this.parent.createElement("div",{className:"e-sort-header"});e.appendChild(s);var l=this.parent.createElement("button",{className:"e-btn e-sort-addbtn e-flat",attrs:{type:"button"}});l.innerText=a.getConstant("AddColumn");var d=this.parent.element.querySelector(".e-customsort-dlg .e-footer-content");d.insertBefore(l,d.firstElementChild),l.addEventListener("click",function(){if(r){var e=t.getUniqueID("customSort");r.addItem([{id:e,text:a.getConstant("ThenBy"),field:"",order:"ascending"}]),i.renderListItem(e,r,h.checked,n,!0)}});var h=new o.CheckBox({label:a.getConstant("ContainsHeader"),checked:!0,change:function(r){var i=r.checked?{text:"text",value:"value"}:{text:"value"};Array.prototype.forEach.call(e.getElementsByClassName("e-sort-field e-dropdownlist e-lib"),function(e){var r=t.getComponent(e,"dropdownlist");r.dataSource=null,r.dataSource=n,r.fields=i,r.dataBind()})},cssClass:"e-sort-headercheckbox"}),p=this.parent.createElement("input",{className:"e-sort-checkheader",attrs:{type:"checkbox"}});s.appendChild(p),h.createElement=this.parent.createElement,h.appendTo(p);var c=new o.CheckBox({label:a.getConstant("CaseSensitive"),checked:!1,cssClass:"e-sort-casecheckbox"}),u=this.parent.createElement("input",{className:"e-sort-checkcase",attrs:{type:"checkbox"}});s.appendChild(u),c.createElement=this.parent.createElement,c.appendTo(u)},e.prototype.getCustomListview=function(e){var r=[{id:e,text:this.parent.serviceLocator.getService(Na).getConstant("SortBy"),field:"",order:"ascending"}];return t.enableRipple(!1),new l.ListView({dataSource:r,fields:{id:"id"},height:"100%",template:t.initializeCSPTemplate(function(e){return'<div class="e-sort-listwrapper"><span class="text">'+e.text+'</span><div class="e-sort-row"><div class="e-sort-field"></div><div class="e-sort-order"><span class="e-sort-ordertxt" style="display:none;">'+e.order+'</span></div><span class="e-icons e-sort-delete" tabindex="0"></span></div>'}),cssClass:"e-sort-template"})},e.prototype.deleteHandler=function(e,t){e.getElementsByClassName("e-sort-delete")[0].addEventListener("click",function(){e&&t.removeItem(e)})},e.prototype.renderListItem=function(e,t,r,n,i){var a=this,l=this.parent.serviceLocator.getService(Na),d=t.element.querySelector("li[data-uid="+e+"]"),h=r?{text:"text",value:"value"}:{text:"value"},p=d.getElementsByClassName("e-sort-field")[0],c=new s.DropDownList({dataSource:n,width:"auto",cssClass:"e-sort-field-ddl",fields:h,placeholder:l.getConstant("SelectAColumn"),change:function(r){r.value&&(Array.prototype.some.call(t.dataSource,function(t){return t.id===e&&(t.field=r.value.toString().replace("Column ","")),t.id===e}),a.clearError())}});c.createElement=this.parent.createElement,c.appendTo(p),i||(c.index=0);var u=d.getElementsByClassName("e-sort-order")[0],f="ascending"===u.getElementsByClassName("e-sort-ordertxt")[0].innerText.toLocaleLowerCase(),g=new o.RadioButton({label:l.getConstant("SortAscending"),name:"sortAZ_"+e,value:"ascending",checked:f,cssClass:"e-sort-radiobutton",change:function(r){a.setRadioBtnValue(t,e,r.value)}}),m=this.parent.createElement("input",{id:"orderAsc_"+e,className:"e-sort-radioasc",styles:"",attrs:{type:"radio"}});u.appendChild(m),g.createElement=this.parent.createElement,g.appendTo(m);var v=new o.RadioButton({label:l.getConstant("SortDescending"),name:"sortAZ_"+e,value:"descending",checked:!f,cssClass:"e-sort-radiobutton",change:function(r){a.setRadioBtnValue(t,e,r.value)}}),y=this.parent.createElement("input",{id:"orderDesc_"+e,className:"e-sort-radiodesc",styles:"",attrs:{type:"radio"}});u.appendChild(y),v.createElement=this.parent.createElement,v.appendTo(y),this.deleteHandler(d,t)},e.prototype.setRadioBtnValue=function(e,t,r){r&&Array.prototype.some.call(e.dataSource,function(e){return e.id===t&&(e.order=r),e.id===t})},e.prototype.clearError=function(){var e=document.getElementsByClassName("e-sort-dialog")[0],t=e.getElementsByClassName("e-sort-error")[0];"none"!==t.style.display&&""!==t.innerHTML&&(t.style.display="none",Array.prototype.forEach.call(e.getElementsByClassName("e-error"),function(e){e.classList.remove("e-error")}))},e.prototype.applySortHandler=function(e){var t=this,r=this.parent.getActiveSheet(),n=e&&e.range||r.selectedRange,i=w(y(n)),a=e&&e.sortOptions||{sortDescriptors:{}},o=i[0]===i[2],s={filterRange:[],hasFilter:!1,sheetIdx:this.parent.activeSheetIndex};this.parent.notify("getFilterRange",s),s.hasFilter&&(o?P(s.filterRange,i[0],i[1]):s.filterRange[0]===i[0]&&(this.parent.element.querySelector(".e-selectall.e-highlight")||i[1]>=s.filterRange[1]&&i[1]<=s.filterRange[3]||i[3]>=s.filterRange[1]&&i[3]<=s.filterRange[3]))&&(i[0]=s.filterRange[0],i[1]=s.filterRange[1],i[2]=r.usedRange.rowIndex,i[3]=r.usedRange.colIndex,a.containsHeader=!s.allowHeaderFilter,o=!1);var l={range:n=m(i),sortOptions:a,cancel:!1};if(this.parent.trigger("beforeSort",l),!l.cancel){this.parent.notify(qr,{eventArgs:l,action:"beforeSort"}),this.parent.showSpinner();var d=new Promise(function(e){e(void 0)}),h={args:{range:l.range,sortOptions:l.sortOptions,checkForHeader:o&&n!==l.range},promise:d,previousSort:e&&e.previousSort};this.parent.notify(rn,h),h.promise.then(function(e){return t.sortCompleteHandler(e),t.parent.trigger("sortComplete",e),t.parent.notify(ci,{eventArgs:e,action:"sorting"}),"BODY"===document.activeElement.tagName&&or(t.parent.element),Promise.resolve(e)}).catch(function(e){return t.sortRangeAlertHandler({error:e}),Promise.reject(e)})}},e.prototype.sortCompleteHandler=function(e){var t,r,n=this.parent.activeSheetIndex;if(e.range.includes("!")){var i=e.range.lastIndexOf("!");n=Se(this.parent,e.range.substring(0,i)),t=Ae(this.parent,n),r=c(e.range.substring(i+1))}else t=this.parent.getActiveSheet(),r=c(e.range);for(var a=r[0];a<=r[2];a++)for(var o=r[1];o<=r[3];o++)this.parent.notify(Kr,{action:"refreshCalculate",rowIndex:a,colIndex:o});this.parent.serviceLocator.getService("cell").refreshRange(r,!0,!0,!1,!1,re(this.parent),void 0,void 0,void 0,!0),n===this.parent.activeSheetIndex&&t.conditionalFormats&&t.conditionalFormats.length&&this.parent.notify(Cn,{indexes:r}),this.parent.hideSpinner(),this.parent.notify("refreshFilterRange",null)},e}(),Po=function(){function e(e){this.parent=e,this.filterCollection=new Map,this.filterRange=new Map,this.filterBtn=e.createElement("div",{className:"e-filter-btn e-control e-btn e-lib e-filter-iconbtn e-icon-btn"}),this.filterBtn.appendChild(e.createElement("span",{className:"e-btn-icon e-icons e-filter-icon"})),this.addEventListener()}return e.prototype.destroy=function(){var e=this;this.removeEventListener(),this.parent.refreshing&&this.filterRange.size&&(this.parent.filterCollection=[],this.filterRange.forEach(function(t,r){e.setFilteredCollection({sheetIdx:r,saveJson:{filterCollection:e.parent.filterCollection}})})),this.filterRange=null,this.filterCollection=null,this.filterBtn&&this.filterBtn.remove(),this.filterBtn=null,this.treeViewObj&&this.treeViewObj.destroy(),this.treeViewObj=null,this.treeViewEle&&this.treeViewEle.remove(),this.treeViewEle=null,this.cBox&&(this.cBox.remove(),this.cBox=null);var t=document.querySelectorAll(".e-filter-popup");t&&t.forEach(function(e){e.remove()}),this.parent=null},e.prototype.addEventListener=function(){this.parent.on("filterRangeAlert",this.filterRangeAlertHandler,this),this.parent.on(pi,this.initiateFilterUIHandler,this),this.parent.on("mouseDown",this.filterMouseDownHandler,this),this.parent.on("renderFilterCell",this.renderFilterCellHandler,this),this.parent.on("refreshFilterRange",this.refreshFilterRange,this),this.parent.on(Tn,this.updateSortCollectionHandler,this),this.parent.on(h.beforeFltrcMenuOpen,this.beforeFilterMenuOpenHandler,this),this.parent.on(h.filterCmenuSelect,this.closeDialog,this),this.parent.on("reapplyFilter",this.reapplyFilterHandler,this),this.parent.on("filterByCellValue",this.filterByCellValueHandler,this),this.parent.on("clearFilter",this.clearFilterHandler,this),this.parent.on("getFilteredColumn",this.getFilteredColumnHandler,this),this.parent.on(Zn,this.cMenuBeforeOpenHandler,this),this.parent.on(h.filterCboxValue,this.filterCboxValueHandler,this),this.parent.on("getFilterRange",this.getFilterRangeHandler,this),this.parent.on("filterCellKeyDown",this.filterCellKeyDownHandler,this),this.parent.on("setFilteredCollection",this.setFilteredCollection,this),this.parent.on(Wn,this.updateFilter,this),this.parent.on("beforeInsert",this.beforeInsertHandler,this),this.parent.on("beforeDelete",this.beforeDeleteHandler,this),this.parent.on("sheetsDestroyed",this.deleteSheetHandler,this),this.parent.on("clear",this.clearHandler,this),this.parent.on(h.filterDialogCreated,this.filterDialogCreatedHandler,this),this.parent.on(h.filterDialogClose,this.removeFilterClass,this),this.parent.on(An,this.duplicateSheetFilterHandler,this),this.parent.on(h.fltrPrevent,this.beforeFilteringHandler,this),this.parent.on(h.beforeCustomFilterOpen,this.customFilterOpen,this),this.parent.on(On,this.moveSheetHandler,this),this.parent.on(oi,this.refreshFilterCellsOnResize,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("filterRangeAlert",this.filterRangeAlertHandler),this.parent.off(pi,this.initiateFilterUIHandler),this.parent.off("mouseDown",this.filterMouseDownHandler),this.parent.off("renderFilterCell",this.renderFilterCellHandler),this.parent.off("refreshFilterRange",this.refreshFilterRange),this.parent.off(Tn,this.updateSortCollectionHandler),this.parent.off(h.beforeFltrcMenuOpen,this.beforeFilterMenuOpenHandler),this.parent.off(h.filterCmenuSelect,this.closeDialog),this.parent.off("reapplyFilter",this.reapplyFilterHandler),this.parent.off("filterByCellValue",this.filterByCellValueHandler),this.parent.off("clearFilter",this.clearFilterHandler),this.parent.off("getFilteredColumn",this.getFilteredColumnHandler),this.parent.off(Zn,this.cMenuBeforeOpenHandler),this.parent.off(h.filterCboxValue,this.filterCboxValueHandler),this.parent.off("getFilterRange",this.getFilterRangeHandler),this.parent.off("filterCellKeyDown",this.filterCellKeyDownHandler),this.parent.off("setFilteredCollection",this.setFilteredCollection),this.parent.off(Wn,this.updateFilter),this.parent.off("beforeInsert",this.beforeInsertHandler),this.parent.off("beforeDelete",this.beforeDeleteHandler),this.parent.off("sheetsDestroyed",this.deleteSheetHandler),this.parent.off("clear",this.clearHandler),this.parent.off(h.filterDialogCreated,this.filterDialogCreatedHandler),this.parent.off(h.filterDialogClose,this.removeFilterClass),this.parent.off(An,this.duplicateSheetFilterHandler),this.parent.off(h.fltrPrevent,this.beforeFilteringHandler),this.parent.off(h.beforeCustomFilterOpen,this.customFilterOpen),this.parent.off(On,this.moveSheetHandler),this.parent.off(oi,this.refreshFilterCellsOnResize))},e.prototype.getModuleName=function(){return"filter"},e.prototype.isInValidFilterRange=function(e,r){var n=w(r?y(r):y(e.selectedRange)),i=!1;return 0===e.usedRange.colIndex&&0===e.usedRange.rowIndex&&t.isNullOrUndefined(e.rows[e.usedRange.rowIndex])&&(i=!0),n[0]>e.usedRange.rowIndex||n[1]>e.usedRange.colIndex||i},e.prototype.filterRangeAlertHandler=function(e){var t=this;this.parent.serviceLocator.getService(Fa).show({content:e.error,isModal:!0,height:180,width:400,showCloseIcon:!0,beforeOpen:function(e){var r={dialogName:"FilterRangeDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",r),r.cancel?e.cancel=!0:or(t.parent.element)}}),this.parent.hideSpinner()},e.prototype.beforeFilterMenuOpenHandler=function(e){var t=this.parent.serviceLocator.getService(Na);e.element.classList.add("e-spreadsheet-contextmenu");var r=e.element.querySelector("ul");this.addMenuItem(r,t.getConstant("SortDescending"),"e-filter-sortdesc","e-sort-desc"),this.addMenuItem(r,t.getConstant("SortAscending"),"e-filter-sortasc","e-sort-asc"),e.element.appendChild(r)},e.prototype.addMenuItem=function(e,t,r,n){var i=this.parent.createElement("li",{className:r+" e-menu-item"});this.parent.allowSorting||i.classList.add("e-disabled"),i.innerText=t,i.insertBefore(this.parent.createElement("span",{className:"e-menu-icon e-icons "+n}),i.firstChild),e.insertBefore(i,e.firstChild)},e.prototype.initiateFilterUIHandler=function(e){var t=this,n=e?e.predicates:null,i=e.sIdx;i||0===i||(i=e.isOpen?0:this.parent.activeSheetIndex);var a;e.promise&&(a=new r.Deferred,e.promise=a.promise);var o=function(){a&&a.resolve()},s=e.isInternal||e.isCut;if(this.filterRange.size>0&&this.filterRange.has(i)&&!this.parent.isOpen&&!n)return this.removeFilter(i,s,!1),void o();var l=Ae(this.parent,i);if(this.isInValidFilterRange(l,e.range)){var d=this.parent.serviceLocator.getService(Na);return this.filterRangeAlertHandler({error:d.getConstant("FilterOutOfRangeError")}),void o()}var h,p,u=e.range||l.selectedRange;if(!s){if(h={range:u,sheetIndex:i,cancel:!1,allowHeaderFilter:!1},e.predicates?(h.predicates=e.predicates,h.previousPredicates=this.filterCollection.get(i)&&[].slice.call(this.filterCollection.get(i))):h.filterOptions={predicates:e.predicates},h.useFilterRange=!1,p={action:"filter",eventArgs:h},this.parent.notify(qr,p),h.cancel)return void o();delete h.cancel,e.useFilterRange=h.useFilterRange,e.allowHeaderFilter=h.allowHeaderFilter}if(e.range||!s&&u!==h.range)s||(u=h.range);else{var g=c(u);g[0]===g[2]&&g[1]===g[3]&&(u=m(g=X(g[0],g[1],l)),s||(h.range=u))}if(n){if(n.length){var v=this.filterRange.get(i);v&&(e.useFilterRange=v.useFilterRange,e.allowHeaderFilter=v.allowHeaderFilter),this.processRange(l,i,u,!0,e.useFilterRange,e.allowHeaderFilter);var y=this.filterRange.get(i).range.slice();e.allowHeaderFilter||(y[0]=y[0]+1),e.useFilterRange||(y[2]=l.usedRange.rowIndex),y[1]=y[3]=f(n[0].field);var C=l.name+"!"+this.getPredicateRange(y,n.slice(1,n.length)),b=m(y);return void ye(this.parent,C,!0,!0,null,!0,null,null,!1,b).then(function(i){t.filterSuccessHandler(new r.DataManager(i),{action:"filtering",filterCollection:n,field:n[0].field,sIdx:e.sIdx,isInternal:s,isOpen:e.isOpen,prevPredicates:h&&h.previousPredicates}),o()})}this.clearFilterHandler({sheetIndex:i}),o()}else this.processRange(l,i,u,!1,e.useFilterRange,e.allowHeaderFilter),o();s||(this.parent.notify(ci,p),or(this.parent.element))},e.prototype.processRange=function(e,t,r,n,i,a){var o=w(y(r||e.selectedRange));o[0]===o[2]&&o[1]===o[3]?(o[0]=0,o[1]=0,o[2]=e.usedRange.rowIndex,o[3]=e.usedRange.colIndex):o[3]>e.usedRange.colIndex&&(o[3]=e.usedRange.colIndex);var s={useFilterRange:i,range:o};a&&(s.allowHeaderFilter=a),this.filterRange.set(t,s),this.filterCollection.set(t,[]),n||this.refreshFilterRange(o,!1,t)},e.prototype.removeFilter=function(e,t,r,n){var i,a=this.filterRange.get(e),o=a.range.slice(),s=a.allowHeaderFilter,l=m(o);if(!t){if(i={action:"filter",eventArgs:{range:l,sheetIndex:e,cancel:!1},isClearAction:n},this.parent.notify(qr,i),i.eventArgs.cancel)return;delete i.eventArgs.cancel}if(this.filterCollection.get(e).length||r){if(this.filterCollection.get(e).length&&n){var d={action:"filter",eventArgs:{range:l,sheetIndex:e,predicates:[],previousPredicates:this.filterCollection.get(e)},isClearAction:n};this.parent.notify(ci,d)}this.clearFilterHandler({preventRefresh:r,sheetIndex:e})}this.filterRange.delete(e),this.filterCollection.delete(e),this.refreshFilterRange(o,!0,e,s),t||this.parent.notify(ci,i)},e.prototype.filterByCellValueHandler=function(){var e=this,t=this.parent.activeSheetIndex,n=this.parent.getActiveSheet();if(this.isInValidFilterRange(n)){var i=this.parent.serviceLocator.getService(Na);return void this.filterRangeAlertHandler({error:i.getConstant("FilterOutOfRangeError")})}var a,o=c(n.activeCell);this.isFilterRange(t,o[0],o[1])||(a=!0,this.processRange(n,t));var s=this.filterRange.get(t),l=s.range.slice(),d=m(l);l[0]=l[0]+1,l[2]=n.usedRange.rowIndex,l[1]=l[3]=o[1];var h=v(o[1]+1),p=He(o[0],o[1],n),u=Ce(this.parent,p,o[0],o[1]),f=[{field:h,operator:"equal",type:this.getColumnType(n,o[1],o).type,matchCase:!1,value:u}],g=[].slice.call(this.filterCollection.get(t));g.length||(g=void 0);var y={range:d,predicates:f,previousPredicates:g,sheetIndex:t,cancel:!1,allowHeaderFilter:!1};if(this.parent.notify(qr,{action:"filter",eventArgs:y}),y.cancel)return void(a&&this.removeFilter(t,!0));y.allowHeaderFilter&&(s.allowHeaderFilter=y.allowHeaderFilter,l[0]--);var C=n.name+"!"+this.getPredicateRange(l,this.filterCollection.get(t)),b=m(l);ye(this.parent,C,!0,!0,null,!0,null,null,!1,b).then(function(t){e.filterSuccessHandler(new r.DataManager(t),{action:"filtering",filterCollection:f,field:h,isFilterByValue:!0})})},e.prototype.renderFilterCellHandler=function(e){var r=t.isNullOrUndefined(e.sIdx)?this.parent.activeSheetIndex:e.sIdx;if(r===this.parent.activeSheetIndex){var n=this.filterRange.get(r)&&this.filterRange.get(r),i=n&&n.range;if(i&&(i[0]===e.rowIndex||n.allowHeaderFilter)&&i[1]<=e.colIndex&&i[3]>=e.colIndex){if(!e.td||e.td.classList.contains(n.allowHeaderFilter?"e-cell":"e-header-cell"))return;for(var a=e.td.querySelector(".e-filter-icon"),o="",s=this.parent.sortCollection,l=v(e.colIndex+1),d=this.filterCollection.get(r),h=0;h<d.length;h++)if(d[h].field===l){o=" e-filtered";break}if(s)for(h=0;h<s.length;h++)if(s[h].sheetIndex===r&&s[h].columnIndex===e.colIndex){o+="Ascending"===s[h].order?" e-sortasc-filter":" e-sortdesc-filter";break}if(a)a.className="e-btn-icon e-icons e-filter-icon"+o;else{var p=!1;if(a=this.filterBtn.cloneNode(!0),e.td.children.length>0&&e.td.children[e.td.childElementCount-1].className.indexOf("e-addNoteIndicator")>-1&&(e.td.removeChild(e.td.children[e.td.childElementCount-1]),p=!0),a.firstElementChild.className="e-btn-icon e-icons e-filter-icon"+o,e.td.insertBefore(a,e.td.firstChild),e.isAction){var c=Ae(this.parent,r);He(e.rowIndex,e.colIndex,c,!1,!0).wrap&&this.parent.notify("updateWrapCell",{rowIdx:e.rowIndex,colIdx:e.colIndex,sheet:c,ele:e.td})}p&&this.parent.notify("createNoteIndicator",{targetElement:e.td,rowIndex:e.rowIndex,columnIndex:e.colIndex})}}}},e.prototype.refreshFilterRange=function(e,t,r,n){var i=r;i||0===i||(i=this.parent.activeSheetIndex);var a=this.filterRange&&this.filterRange.get(i);a?(e=e||a.range.slice(),n=a.allowHeaderFilter):e||(e=[0,0,0,0]);for(var o,s=e,l=Ae(this.parent,i),d=this.parent.frozenColCount(l),h=s[1];h<=s[3];h++){if(n){var p=h<d?this.parent.sheetModule.getSelectAllTable():this.parent.getColHeaderTable(),c=p&&this.parent.getRow(0,p);o=c&&this.parent.getCell(0,h,c)}else o=tt(l,s[0])?null:this.parent.getCell(s[0],h);if(t){if(o){var u=o.querySelector(".e-filter-btn");if(u){var f=!1;o.children.length>0&&o.children[o.childElementCount-1].className.indexOf("e-addNoteIndicator")>-1&&(o.removeChild(o.children[o.childElementCount-1]),f=!0),u.parentElement.removeChild(u),f&&this.parent.notify("createNoteIndicator",{targetElement:o,rowIndex:s[0],columnIndex:h})}}}else this.renderFilterCellHandler({td:o,rowIndex:s[0],colIndex:h,sIdx:i,isAction:!0})}this.parent.sortCollection&&this.parent.notify("sortImport",null)},e.prototype.isFilterCell=function(e,t,r){var n=this.filterRange.has(e)&&this.filterRange.get(e).range;return n&&n[0]===t&&n[1]<=r&&n[3]>=r},e.prototype.isFilterRange=function(e,t,r){var n=this.filterRange.get(e)&&this.filterRange.get(e).range;return n&&n[0]<=t&&n[2]>=t&&n[1]<=r&&n[3]>=r},e.prototype.getFilteredColumnHandler=function(e){var r=t.isUndefined(e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex,n=this.parent.serviceLocator.getService(Na);if(e.clearFilterText=n.getConstant("ClearFilter"),this.filterRange.has(r)){var i=this.filterCollection.get(r);if(e.isClearAll)return void(e.isFiltered=i&&i.length>0);var a=this.filterRange.get(r).range.slice(),o=Ae(this.parent,r),s=u(o.activeCell);if(this.isFilterRange(r,s[0],s[1])){e.field=v(s[1]+1);var l=He(a[0],s[1],o),d=this.parent.getDisplayText(l);e.clearFilterText=n.getConstant("ClearFilterFrom")+'"'+(d?d.toString():"Column "+e.field)+'"',i.some(function(t){return e.isFiltered=t.field===e.field,e.isFiltered})}}},e.prototype.cMenuBeforeOpenHandler=function(e){var t=this.parent.element.id+"_cmenu";if(e.parentItem&&e.parentItem.id===t+"_filter"&&""===e.target){var r={isFiltered:!1};this.getFilteredColumnHandler(r),this.parent.enableContextMenuItems([t+"_clearfilter",t+"_reapplyfilter"],!!r.isFiltered,!0)}},e.prototype.closeDialog=function(){var e=document.querySelector(".e-filter-popup");if(e&&e.id.includes(this.parent.element.id)){var r=t.getComponent(e,"dialog");t.EventHandler.remove(e,Rt(),this.filterMouseDownHandler),r&&r.hide(),this.parent.notify(h.filterDialogClose,null)}},e.prototype.removeFilterClass=function(){"relative"===this.parent.element.style.position&&(this.parent.element.style.position=""),this.parent.element.classList.contains("e-filter-open")&&this.parent.element.classList.remove("e-filter-open")},e.prototype.isPopupOpened=function(){var e=document.getElementsByClassName("e-filter-popup")[0];return e&&e.id.includes(this.parent.element.id)&&"none"!==e.style.display},e.prototype.filterCellKeyDownHandler=function(e){var t=u(this.parent.getActiveSheet().activeCell);if(this.isFilterCell(this.parent.activeSheetIndex,t[0],t[1]))if(e.closePopup)this.closeDialog();else if(e.isFilterCell=!0,!this.isPopupOpened()){var r=this.parent.getCell(t[0],t[1]);r&&this.openDialog(r)}},e.prototype.filterMouseDownHandler=function(e){if(!(t.Browser.isDevice&&"mousedown"===e.type||this.parent.getActiveSheet().isProtected)){var r=e.target;if(r.classList.contains("e-filter-icon")||r.classList.contains("e-filter-btn"))this.isPopupOpened()&&this.closeDialog(),this.openDialog(h.parentsUntil(r,"e-cell")||h.parentsUntil(r,"e-header-cell"));else if(this.isPopupOpened()){var n=r.offsetParent;r.classList.contains("e-searchinput")||r.classList.contains("e-searchclear")||!n||n.classList.contains("e-filter-popup")||n.classList.contains("e-text-content")||n.classList.contains("e-checkboxtree")||n.classList.contains("e-checkbox-wrapper")?this.selectSortItemHandler(r):this.closeDialog()}}},e.prototype.cboxListSelected=function(e,r,n,i,a){var o=h.parentsUntil(i.target,"e-ftrchk");if(o){var s=a&&o.querySelector(".e-add-current");if(s)return s.classList.contains("e-check")?(t.classList(s,["e-uncheck"],["e-check"]),r.length||(e.btnObj.element.disabled=!0),!1):(t.classList(s,["e-check"],["e-uncheck"]),e.btnObj.element.disabled=!1,!0);var l=o.querySelector(".e-selectall");if(l){o.querySelector(".e-chk-hidden").indeterminate=!1;for(var d=o.querySelector(".e-frame").classList.contains("e-check"),p=void 0,c=void 0,u=a?2:1,f=e.element.childElementCount;u<f;u++)p=e.element.children[u].querySelector(".e-frame"),t.removeClass([p],["e-check","e-stop","e-uncheck"]),d?(e.element.children[u].querySelector(".e-chk-hidden").checked=!1,p.classList.add("e-uncheck"),r.splice(0,1)):(e.element.children[u].querySelector(".e-chk-hidden").checked=!0,p.classList.add("e-check"),c=e.element.children[u].querySelector(".e-checkboxfiltertext").textContent,-1===r.indexOf(c)&&r.push(c))}else{c=o.querySelector(".e-checkboxfiltertext").textContent;o.querySelector(".e-frame").classList.contains("e-check")?r.splice(r.indexOf(c),1):r.push(c),h.toogleCheckbox(o),l=e.element.querySelector(".e-selectall")}this.updateState(e,l,l.parentElement.querySelector(".e-chk-hidden"),r.length!==n,r.length)}return null},e.prototype.initCboxList=function(e,n,i){var a=this,o=e.column.field,s=new r.DataManager(e.dataSource).executeLocal((new r.Query).sortBy(o+"_value","ascending")),l=[],d=this.parent.getActiveSheet(),p=this.parent.serviceLocator.getService(Na),c=document.createDocumentFragment(),u=this.createSelectAll(e,n);c.appendChild(u);var f,g,m={},v=[],y=[];s.forEach(function(e){if(""===e[o]){if(!m.isBlank){m.isBlank=!0;var t={};t[o]=p.getConstant("Blanks"),f=rt(d,Number(e.__rowIndex)-1);var r=h.createCboxWithWrap(h.getUid("cbox"),n.createCheckbox(t[o],!f,t),"e-ftrchk");1===c.childElementCount?c.appendChild(r):c.insertBefore(r,c.children[1]),l.splice(0,0,t[o]),f||(v.push(t[o]),y.push(t[o]))}}else m[e[o]]||(m[e[o]]=!0,f=rt(d,Number(e.__rowIndex)-1),g=e[o],c.appendChild(h.createCboxWithWrap(h.getUid("cbox"),n.createCheckbox(g,!f,e),"e-ftrchk")),l.push(g),f||(v.push(g),y.push(g)))}),e.element.appendChild(c);var C=u.querySelector(".e-frame");C.classList.add("e-selectall");var b=u.querySelector(".e-chk-hidden");this.updateState(e,C,b,y.length!==l.length,y.length);var x,S,w,I=[].slice.call(e.element.childNodes);e.element.addEventListener("click",function(t){if(x){var r=a.cboxListSelected(e,x,e.element.childElementCount-2,t,!0);null!==r&&(w=r)}else a.cboxListSelected(e,y,l.length,t)});var E,R,N,F=function(t){if(t.toLowerCase().includes(R)){var r={};r[e.column.field]=t,c.appendChild(h.createCboxWithWrap(h.getUid("cbox"),n.createCheckbox(t,!0,r),"e-ftrchk")),S.push(t),x.push(t)}},A=e.dataSource.length>1e3?e.dataSource.length:1e3,k=l;N=i.length<=A?function(){l.forEach(function(e){F(e)})}:function(){E||(k=[],v=[],y=[],E=new r.DataManager(i).executeLocal((new r.Query).sortBy(o+"_value","ascending")),m={},E.forEach(function(e){""===e[o]?m.isBlank||(m.isBlank=!0,g=p.getConstant("Blanks"),k.splice(0,0,g),rt(d,Number(e.__rowIndex)-1)||(v.push(g),y.push(g))):m[e[o]]||(g=e[o],m[g]=!0,k.push(e[o]),rt(d,Number(e.__rowIndex)-1)||(y.push(g),v.push(g)))}));for(var e=0,t=k.length;e<t&&S.length<A;e++)F(k[e])};var O=function(t){if("keyup"===t.event.type)R=t.event.target.value.toLowerCase();else if(t.event.target.classList.contains("e-search-icon"))return;if((c=document.createDocumentFragment()).appendChild(u),R)if(S=[],x=[],N(),x.length){a.updateState(e,C,b,!1,0),u.classList.remove("e-hide");var r={};r[o]=p.getConstant("AddCurrentSelection");var i=h.createCboxWithWrap(h.getUid("cbox"),n.createCheckbox(r[o],!1,r),"e-ftrchk");c.insertBefore(i,c.children[1]),i.querySelector(".e-frame").classList.add("e-add-current")}else{u.classList.add("e-hide");var s=a.parent.createElement("div",{className:"e-checkfltrnmdiv"}),d=a.parent.createElement("span");d.innerText=p.getConstant("NoResult"),s.appendChild(d),c.appendChild(s),e.btnObj.element.disabled=!0}else I&&(x=null,S=null,a.updateState(e,C,b,y.length!==l.length,y.length),u.classList.remove("e-hide"),I.forEach(function(e){c.appendChild(e)}));e.element.innerHTML="",e.element.appendChild(c)},T=function(){if(S)if(w){var s=void 0,d=void 0;y=v;for(var h=0,c=S.length;h<c;h++)s=S[h],S.length===x.length||x.indexOf(s)>-1?-1===y.indexOf(s)&&y.push(s):(d=y.indexOf(s))>-1&&y.splice(d,1)}else y=x;var u=y.length;if(u===l.length&&(!x||i.length<=A))a.filterSuccessHandler(new r.DataManager(e.dataSource),{action:"clear-filter",field:e.column.field});else{var f=[],g={field:o,ignoreAccent:!1,matchCase:!1,isFilterByMenu:!0},m=t.getNumericObject(a.parent.locale),C=function(t){var r=e.type;"number"===r&&(t===p.getConstant("Blanks")?(t="",r="string"):fe(Q([t],a.parent,m)[0])||(r="string")),f.push(Object.assign({value:t,type:r},g))};if(u>k.length/2){g.operator="notequal",g.predicate="and";for(var h=0,c=k.length;h<c;h++)-1===y.indexOf(k[h])&&C(k[h])}else{g.operator="equal",g.predicate="or";for(var h=0,c=u;h<c;h++)C(y[h])}n.initiateFilter(f)}};this.wireFilterEvents(e,T,O.bind(this))},e.prototype.createSelectAll=function(e,t){var r={};return r[e.column.field]=this.parent.serviceLocator.getService(Na).getConstant("SelectAll"),h.createCboxWithWrap(h.getUid("cbox"),t.createCheckbox(r[e.column.field],!1,r),"e-ftrchk")},e.prototype.updateState=function(e,r,n,i,a){if(t.removeClass([r],["e-check","e-stop","e-uncheck"]),e.btnObj.element.disabled&&(e.btnObj.element.disabled=!1),i)if(a)r.classList.add("e-stop");else{r.classList.add("e-uncheck");var o=e.element.querySelector(".e-add-current");e.btnObj.element.disabled=!o||!o.classList.contains("e-check")}else r.classList.add("e-check");n.indeterminate=i,n.checked=!i},e.prototype.beforeFilteringHandler=function(e){var r=this;if(e.instance&&e.instance.options){if(e.isOpen&&"string"===e.instance.options.type){var n=t.getNumericObject(this.parent.locale);if("."!==n.decimal){var i=e.arg3.toString().split(".");if(2===i.length){var a=i.join(n.decimal);fe(new t.Internationalization(this.parent.locale).parseNumber(a,{format:"n"}))&&(e.arg3=a)}}}var o=function(e,n){if(n&&("notequal"===n||r.isCustomNumFilter(n)))if(e){if(fe(e))e=parseFloat(e.toString());else if("string"==typeof e){var i=t.getNumericObject(r.parent.locale),a=new t.Internationalization(r.parent.locale),s={};if(e.includes(i.percentSign)){var l=e.trim().split("%");""===l[0]||l[1]||(s=F({value:l[0]},r.parent.locale,i.group,i.decimal))}if(s.isNumber)e=Number(s.value)/100;else{var d=a.parseNumber(e.trim(),{format:"n"});if(fe(d))e=/^(\(\d+\)|\d+)$/.test(e.trim())?-d:d;else{var h=e.trim(),p={value:h,cell:{value:h}};r.parent.notify(Zr,p),(p.isTime||p.isDate)&&(e=parseFloat(p.updatedVal))}}}}else"notequal"===n&&null===e&&(e="");else"equal"===n&&(fe(e)?e=e.toString():"string"==typeof e&&fe(o(e,"notequal"))?e=e.trim():null===e&&(e=""));return e};if("date"!==e.instance.options.type)e.arg3=o(e.arg3,e.arg2),e.arg8=o(e.arg8,e.arg7);else if("yMd"===e.instance.options.format){var s=function(t,n){if(t)if("string"==typeof t){var i=t.trim(),a={value:i,cell:{value:i}};if(r.parent.notify(Zr,a),a.isDate)t="equal"===n?a.dateObj:parseFloat(a.updatedVal);else if("equal"===n||"notequal"===n){var s=o(t,"notequal");fe(s)?(e.instance.options.type="number","notequal"===n&&(t=s)):e.instance.options.type="string"}}else ue(t)&&"equal"!==n&&(t=ce(t,!0));return t},l=document.querySelectorAll(".e-xlfl-valuediv input.e-datepicker");2===l.length?(e.arg3=s(e.arg3||l[0].value,e.arg2),e.arg8=s(e.arg8||l[1].value,e.arg7)):e.arg3&&(e.arg3=s(e.arg3,e.arg2))}}},e.prototype.customFilterOpen=function(e){for(var r=document.querySelectorAll(".e-xlfl-optrdiv input.e-dropdownlist"),n=[],i=0;i<r.length;i++){var o=t.getComponent(r[i],"dropdownlist");o&&n.push(o.value)}var s=[];if(2===n.length)for(var l=this.filterCollection.get(this.parent.activeSheetIndex),d=void 0,i=0;i<l.length;i++)l[i].field===e.column&&null!==l[i].value&&(d=n.indexOf(l[i].operator))>-1&&("equal"===l[i].operator&&ue(l[i].value)?s[d]=ce(l[i].value,!0).toString():s[d]=l[i].value.toString(),n[d]="");var h=t.getNumericObject(this.parent.locale),p=function(e){if("."!==h.decimal&&fe(e)){var t=e.toString();if(t.includes("."))return t.replace(".",h.decimal)}return e},c=document.querySelectorAll(".e-xlfl-valuediv input.e-ss-filter-input");if(c.length)for(i=0;i<c.length;i++){var u=new a.TextBox({placeholder:this.parent.serviceLocator.getService(Na).getConstant("CustomFilterPlaceHolder")});s[i]&&(u.value=p(s[i])),u.appendTo(c[i])}else for(var f=document.querySelectorAll(".e-xlfl-valuediv input.e-datepicker"),g=void 0,m=void 0,i=0;i<f.length;i++)m=fe(s[i])?this.parent.getDisplayText({value:s[i],format:Ke("ShortDate")+(s[i].includes(".")?" "+Ke("Time"):"")}):p(s[i]),(g=t.getComponent(f[i],"datepicker"))&&(g.value=m,f[i].value=m)},e.prototype.wireFilterEvents=function(e,t,r){var n=this;e.btnObj.element.addEventListener("click",t.bind(this)),e.searchBox.addEventListener("keydown",function(e){13===e.keyCode&&t()});var i=function(){n.parent.off("refreshCheckbox",r),n.parent.off(h.filterDialogClose,i),or(n.parent.element)};this.parent.on(h.filterDialogClose,i,this),this.parent.on("refreshCheckbox",r,this)},e.prototype.initTreeView=function(e,n){var a,o,s,l,d,h,p,c=this,u=[],f=[],g={},m=[],v=[],y=[],C=[],b=["January","February","March","April","May","June","July","August","September","October","November","December"];if("en-US"!==this.parent.locale){var x=t.IntlBase.getDependables(t.cldrData,this.parent.locale,null).dateObject,S=x.months["stand-alone"]?x.months["stand-alone"].wide:{};12===Object.keys(S).length&&(b=Object.keys(S).map(Number).map(function(e){return S[e]}))}var w,I=!1,E=this.parent.getActiveSheet(),R=function(e){g[""+h]=!0,rt(E,Number(e.__rowIndex)-1)?I=!0:u.push(h),f.push(h)};e.dataSource.forEach(function(t){"object"==typeof(l=t[e.column.field])&&Date.parse(l.toString())?(a=l.getFullYear().toString(),g[""+a]||((w={__rowIndex:a,hasChild:!0})[e.column.field]=a,m.push(w),g[""+a]=!0),p=l.getMonth(),o=b[p],g[""+(d=a+" "+o)]||((w={__rowIndex:d,pId:a,hasChild:!0,month:p})[e.column.field]=o,v.push(w),g[""+d]=!0),s=l.getDate(),h=d+" "+s.toString(),g[""+h]||((w={__rowIndex:h,pId:d})[e.column.field]=s,y.push(w),R(t))):(t[e.column.field]||0===t[e.column.field]?(h="text "+t[e.column.field].toString().toLowerCase(),a=t[e.column.field]):(h="blanks",a=c.parent.serviceLocator.getService(Na).getConstant("Blanks")),g[""+h]||((w={__rowIndex:h})[e.column.field]=a,C.push(w),R(t)))}),m=new r.DataManager(m).executeLocal((new r.Query).sortBy(e.column.field,"decending")),v=new r.DataManager(v).executeLocal((new r.Query).sortBy("month","ascending")),y=new r.DataManager(y).executeLocal((new r.Query).sortBy(e.column.field,"ascending")),y=m.concat(v.concat(y)),C.length&&(C=new r.DataManager(C).executeLocal((new r.Query).sortBy(e.column.field,"ascending")),y=y.concat(C));var N=function(e){var t=[e.node];(e.event.target.classList.contains("e-fullrow")||"Enter"===e.event.key)&&("true"===D.getNode(e.node).isChecked?D.uncheckAll(t):D.checkAll(t))},F=function(){O.indeterminate=!1,k.classList.contains("e-check")?(D.uncheckAll(),k.classList.add("e-uncheck"),O.checked=!1):(D.checkAll(),k.classList.add("e-check"),O.checked=!0)},A=this.createSelectAll(e,n);A.addEventListener("click",F.bind(this)),A.classList.add("e-spreadsheet-ftrchk");var k=A.querySelector(".e-frame");k.classList.add("e-selectall"),e.element.appendChild(A);var O=A.querySelector(".e-chk-hidden"),T=this.parent.createElement("div"),D=new i.TreeView({fields:{dataSource:y,id:"__rowIndex",parentID:"pId",text:e.column.field,hasChildren:"hasChild"},enableRtl:this.parent.enableRtl,showCheckBox:!0,cssClass:"e-checkboxtree",checkedNodes:u,nodeClicked:N.bind(this),keyPress:N.bind(this),nodeChecked:function(t){"indeterminate"!==t.action&&(I=D.checkedNodes.length!==D.fields.dataSource.length,c.updateState(e,k,O,I,D.checkedNodes.length))}});D.createElement=this.parent.createElement,D.appendTo(T),e.element.appendChild(T),u=D.checkedNodes,this.updateState(e,k,O,I,D.checkedNodes.length);var L=function(){D.checkedNodes.length===y.length?c.filterSuccessHandler(new r.DataManager(e.dataSource),{action:"clear-filter",field:e.column.field}):c.generatePredicate(D.checkedNodes,C.length?"string":e.type,e.column.field,n,f,D.checkedNodes.length>y.length/2)};this.treeViewObj=D,this.treeViewEle=T,this.cBox=O,this.wireFilterEvents(e,L,this.refreshCheckbox.bind(this,y,D,u))},e.prototype.generatePredicate=function(e,t,r,n,i,a){var o,s,l,d,h,p=[],c={January:0,February:1,March:2,April:3,May:4,June:5,July:6,August:7,September:8,October:9,November:10,December:11},u=function(){"blanks"===s[0]?p.push(Object.assign({value:"",type:t},o)):"text"===s[0]&&(s.splice(0,1),d=s.join(" "),isNaN(Number(d))?h="string":(d=Number(d),h="number"),p.push(Object.assign({value:d,type:h},o)))},f=function(){(l=new Date(Number(s[0]),c[s[1]],Number(s[2]))).getDate()?p.push(Object.assign({value:l,type:t},o)):u()};if(a){o={field:r,ignoreAccent:!1,matchCase:!1,predicate:"and",operator:"notequal",isFilterByMenu:!0};for(var g=0,m=i.length;g<m;g++)-1===e.indexOf(i[g])&&(s=i[g].split(" "),f())}else{o={field:r,ignoreAccent:!1,matchCase:!1,predicate:"or",operator:"equal",isFilterByMenu:!0};for(var g=0,m=e.length;g<m;g++)3===(s=e[g].split(" ")).length?f():u()}n.initiateFilter(p)},e.prototype.refreshCheckbox=function(e,n,i,a){var o;if("keyup"===a.event.type)o=a.event.target.value;else if(a.event.target.classList.contains("e-search-icon"))return;var s,l=function(){if(s.length&&!n.fields.dataSource.length){var e=n.element.parentElement;e.getElementsByClassName("e-spreadsheet-ftrchk")[0].classList.remove("e-hide"),t.detach(e.getElementsByClassName("e-checkfltrnmdiv")[0])}n.fields.dataSource=s,n.dataBind()};if(o){s=new r.DataManager(e).executeLocal((new r.Query).where(new r.Predicate(n.fields.text,"contains",o,!0)));var d={},h=[],p=void 0,c=void 0,u=void 0,f=void 0;if(isNaN(Number(o))){for(v=0;v<s.length;v++)s[v].hasChild&&(h.push(new r.Predicate("pId","equal",s[v].__rowIndex,!1)),d[""+(p=s[v].pId)]||(h.push(new r.Predicate("__rowIndex","equal",p,!1)),d[""+p]=!0));c=s,f=1}else{var g=void 0,m={};u=[];for(var v=0;v<s.length;v++)(p=s[v].pId)?(g=p.split(" ")[0],d[""+p]||(h.push(new r.Predicate("__rowIndex","equal",p,!1)),d[""+p]=!0,u.push(g),u.push(p)),m[""+g]||(d[""+g]||(h.push(new r.Predicate("__rowIndex","equal",g,!1)),d[""+g]=!0),h.push(new r.Predicate("__rowIndex","equal",s[v].__rowIndex,!1)))):m[""+(p=s[v].__rowIndex)]||(h.push(new r.Predicate("__rowIndex","contains",p,!1)),m[""+p]=!0);c=[]}if(s.length){h.length&&(s=c.concat(new r.DataManager(e).executeLocal((new r.Query).where(r.Predicate.or(h))))),l(),n.checkAll();var y=n.animation.expand.duration;n.animation.expand.duration=0,n.expandAll(u,f),n.animation.expand.duration=y}else if(n.fields.dataSource.length){l();var C=n.element.parentElement;C.getElementsByClassName("e-spreadsheet-ftrchk")[0].classList.add("e-hide");var b=this.parent.createElement("div",{className:"e-checkfltrnmdiv"}),x=this.parent.createElement("span");x.innerText=this.parent.serviceLocator.getService(Na).getConstant("NoResult"),b.appendChild(x),C.appendChild(b)}}else s=e,l(),n.checkedNodes=i,n.refresh()},e.prototype.openDialog=function(e){var n=this,i=parseInt(e.getAttribute("aria-colindex"),10),a=v(i);this.parent.showSpinner();var o=this.parent.activeSheetIndex,s=this.filterRange.get(o),l=s.range.slice(),d=this.parent.getActiveSheet(),p=He(l[0],i-1,d),c=this.parent.getDisplayText(p);s.allowHeaderFilter||(l[0]=l[0]+1),s.useFilterRange||(l[2]=d.usedRange.rowIndex);var u,f=[l[0],i-1,l[2],i-1],g=this.getPredicateRange(f,this.filterCollection.get(o),i-1),y=g.otherColPredicate,C=g.curPredicate;C.length&&((u={})[a]=C);var b,x=d.name+"!"+g.address,S=m(f),w=this.getColumnType(d,i-1,l,!0),I=w.type,E="date"===I||w.isDateAvail,R="number"===I,N=E||R,F=w.isMultiFormattedCol;N&&!g.filteredCol&&(b=[]),ye(this.parent,x,!0,!0,null,!0,null,null,!0,S,null,b).then(function(i){var o;n.parent.element.style.position="relative",n.parent.element.classList.add("e-filter-open");var s;if(N){if(b||!y.length)o=new r.DataManager(b||i);else{var l=n.getPredicates(y),d=ie(new r.DataManager(i),l.predicates,l.equalOrPredicates);o=new r.DataManager(d)}var p=function(e){n.parent.off("beforeCheckboxfilterRenderer",p),e.isCheckboxFilterTemplate=!0,E?n.initTreeView(e,w):n.initCboxList(e,w,i)};n.parent.on("beforeCheckboxfilterRenderer",p,n),s=[]}else{if(y.length){var f=n.getPredicates(y),d=ie(new r.DataManager(i),f.predicates,f.equalOrPredicates);o=new r.DataManager(d)}else o=new r.DataManager(i);s=n.getClonedPredicates(C)}var g=e.querySelector(".e-filter-btn"),m={field:a,filter:{}};if(R){var v=n.parent;m.filterTemplate=function(e){if(!v.isReact||!e)return[v.createElement("input",{className:"e-ss-filter-input"})];e.appendChild(v.createElement("input",{className:"e-ss-filter-input"}))};var x=function(e){return function(t,r,n,i,a,o,s){return e(s)}};m.getFilterTemplate=function(){return x(m.filterTemplate)},v.isReact&&!v.renderTemplates&&(v.renderTemplates=function(e){return e()})}var S={type:I,field:a,format:"date"===I?"yMd":null,displayName:c||"Column "+a,dataSource:o||[],height:n.parent.element.classList.contains("e-bigger")?800:500,columns:[],hideSearchbox:!1,filteredColumns:s,column:m,handler:n.filterSuccessHandler.bind(n,new r.DataManager(i)),target:g,position:{X:0,Y:0},localeObj:n.parent.serviceLocator.getService(Na),actualPredicate:u,isFormatted:N&&!E,isMultiFormattedCol:F},w=new h.ExcelFilterBase(n.parent,n.getLocalizedCustomOperators());w.openDialog(S);var A=document.querySelector(".e-filter-popup");if(A&&A.id.includes(n.parent.element.id)){t.EventHandler.add(A,Rt(),n.filterMouseDownHandler,n);var k=n.parent.element.getBoundingClientRect(),O=g.getBoundingClientRect(),T=A.getBoundingClientRect(),D=O.right-k.left-T.width;D<0&&(D=O.left-k.left),A.style.left=D*n.parent.viewport.scaleX+"px",A.style.top="0px",A.style.visibility="hidden",A.classList.contains("e-hide")&&A.classList.remove("e-hide");var L=O.bottom-k.top;T.height-(k.bottom-O.bottom)>0&&(L-=T.height-(k.bottom-O.bottom))<0&&(L=0),A.style.top=L*n.parent.viewport.scaleY+"px",A.style.visibility=""}n.parent.hideSpinner()})},e.prototype.getPredicateRange=function(e,t,r){var n,i=m(e),a=[],o=[];if(t&&t.length){var s,l;t.forEach(function(t){t.field&&(s=""+t.field+(e[0]+1)+":"+t.field+(e[2]+1),l=f(t.field),i.includes(s)||(i+=","+s,l<e[1]&&(e[1]=l),l>e[3]&&(e[3]=l)),void 0!==r&&(l===r?(n=!0,o.push(t)):a.push(t)))})}else n=!0;return void 0===r?i:{address:i,filteredCol:n,otherColPredicate:a,curPredicate:o}},e.prototype.filterDialogCreatedHandler=function(){var e=document.querySelector(".e-filter-popup");e&&e.id.includes(this.parent.element.id)&&e.classList.contains("e-popup-close")&&e.classList.add("e-hide")},e.prototype.filterCboxValueHandler=function(e){if(e.column&&e.data){var t=e.column.field;if(e.value){var r=u(t+e.data.dataObj.__rowIndex),n=He(r[0],r[1],this.parent.getActiveSheet());n&&n.format&&(e.value=this.parent.getDisplayText(n))}}},e.prototype.selectSortItemHandler=function(e){var t=this.parent.serviceLocator.getService(Na),r=e.classList.contains("e-filter-sortasc")?"Ascending":e.classList.contains("e-filter-sortdesc")?"Descending":null;if("Ascending"===r?e.setAttribute("aria-label",t.getConstant("SortAscending")):e.setAttribute("aria-label",t.getConstant("SortDescending")),r){var n=this.parent.getActiveSheet(),i=this.parent.activeSheetIndex,a=this.filterRange.get(i),o=a.range.slice();if(a.allowHeaderFilter||(o[0]=o[0]+1),a.useFilterRange||(o[2]=n.usedRange.rowIndex),oe(this.parent,o))return this.closeDialog(),void this.parent.notify(yi,null);this.parent.sortCollection=this.parent.sortCollection?this.parent.sortCollection:[];for(var s=[],l=this.parent.sortCollection.length-1;l>=0;l--)this.parent.sortCollection[l]&&this.parent.sortCollection[l].sheetIndex===i&&(s.push(this.parent.sortCollection[l]),this.parent.sortCollection.splice(l,1));this.parent.sortCollection.push({sortRange:m(o),columnIndex:y(n.activeCell)[1],order:r,sheetIndex:i}),this.parent.notify("applySort",{sortOptions:{sortDescriptors:{order:r},containsHeader:!1},previousSort:s,range:m(o)}),this.refreshFilterRange(),this.closeDialog()}},e.prototype.filterSuccessHandler=function(e,t){var r=t.sIdx;r||0===r||(r=t.isOpen?0:this.parent.activeSheetIndex);var n=t.prevPredicates||[].slice.call(this.filterCollection.get(r));t.isFilterByValue&&!n.length&&(n=void 0);var i=this.filterCollection.get(r);if(this.updatePredicate(i,t.field),"clear-filter"!==t.action||i.length!==n.length){if("filtering"===t.action){i=i.concat(function(e){return e.map(function(e){return e&&"string"==typeof e.value&&e.value.includes("*")&&(e.value.startsWith("*")&&e.value.endsWith("*")?(e.value=e.value.split("*").join(""),e.operator="contains"):e.value.endsWith("*")?(e.value=e.value.split("*").join(""),e.operator="startswith"):e.value.startsWith("*")&&(e.value=e.value.split("*").join(""),e.operator="endswith")),e})}(t.filterCollection))}this.filterCollection.set(r,i);var a=this.getPredicates(i),o={datasource:e,predicates:a.predicates,equalOrPredicates:a.equalOrPredicates},s=this.filterRange.get(r);s.useFilterRange||(s.range[2]=Ae(this.parent,r).usedRange.rowIndex),this.applyFilter(o,m(s.range),r,n,!1,t.isInternal,t.isFilterByValue)}},e.prototype.isCustomNumFilter=function(e){return e.includes("greaterthan")||e.includes("lessthan")||"between"===e},e.prototype.getClonedPredicates=function(e,t){void 0===t&&(t=[]);for(var r,n,i=[],a=0;a<e.length;a++)r=e[a],(this.isCustomNumFilter(r.operator)||!r.isFilterByMenu&&"notequal"===r.operator)&&fe(r.value)?(i.push(Object.assign({},r,{field:r.field+"_value",type:"number"})),n=!0):(r.isFilterByMenu||"equal"!==r.operator||"or"!==r.predicate||t.push(r.field),i.push(r));return!n&&t.length&&t.splice(0),i},e.prototype.updatePredicate=function(e,t){for(var n=new r.DataManager(e),i=new r.Query,a=n.executeLocal(i.where("field","equal",t)),o=0;o<a.length;o++){for(var s=-1,l=0;l<e.length;l++)if(e[l].field===a[o].field){s=l;break}-1!==s&&e.splice(s,1)}},e.prototype.applyFilter=function(e,t,r,n,i,a,o){var s=this,l={range:t,predicates:[].slice.call(this.filterCollection.get(r)),previousPredicates:n,sheetIndex:r,cancel:!1};if(a||o||(this.parent.notify(qr,{action:"filter",eventArgs:l}),!l.cancel)){t.indexOf("!")<0&&(t=this.parent.sheets[r].name+"!"+t),this.parent.showSpinner();var d={args:{range:t,filterOptions:e},promise:new Promise(function(e){e(void 0)}),refresh:i},h=gr(this.parent);this.parent.notify("initiateFilter",d);var p=gr(this.parent);this.parent.notify("refreshChartCellModel",{prevChartIndexes:h,currentChartIndexes:p}),d.promise.then(function(e){return s.refreshFilterRange(),s.parent.hideSpinner(),a||(delete l.cancel,s.parent.notify(ci,{action:"filter",eventArgs:l}),document.activeElement.id!==s.parent.element.id+"_SearchBox"&&or(s.parent.element)),Promise.resolve(e)}).catch(function(e){return s.filterRangeAlertHandler({error:e}),Promise.reject(e)})}},e.prototype.getPredicates=function(e){var t,r=[],n=this.getClonedPredicates(e,r);if(r.length){for(var i=void 0,a=void 0,o=new Map,s=0;s<n.length;s++)i=n[s].field.replace("_value",""),r.indexOf(i)>-1&&(a=n.splice(s,1)[0],s--,o.has(i)?o.get(i).push(a):o.set(i,[a]));t=[];var l;o.forEach(function(e){l=[];for(var r=h.CheckBoxFilterBase.getPredicate(e),n=0,i=Object.keys(r);n<i.length;n++){var a=i[n];l.push(r[""+a])}t.push(l)})}for(var d=[],p=h.CheckBoxFilterBase.getPredicate(n),c=0,u=Object.keys(p);c<u.length;c++){var f=u[c];d.push(p[""+f])}return{predicates:d,equalOrPredicates:t}},e.prototype.getColumnType=function(e,t,r,n){for(var i,a,o,s,l=0,d=0,h=0,p=r[0];p<=r[2];p++)if((i=He(p,t,e))&&(!n||i.value||0===Number(i.value))){if(i.format&&"General"!==i.format){switch($e(i.format).toLowerCase()){case"number":case"currency":case"accounting":case"percentage":l++;break;case"shortdate":case"longdate":h++;break;case"time":l++;break;case"text":d++;break;default:a={},qe(i.format,!0,a)?"date"===a.type?h++:l++:fe(i.value)?l++:i.value&&d++}o||(o=i.format)}else fe(i.value)?l++:i.value&&d++;o&&o!==i.format&&(s=!0)}return{type:l>d&&l>h&&l>0?"number":d>=l&&d>=h&&d>=0?"string":h>l&&h>d&&h>0?"date":"datetime",isDateAvail:!!h,isMultiFormattedCol:s}},e.prototype.clearFilterHandler=function(e){var r=e&&!t.isNullOrUndefined(e.sheetIndex)?e.sheetIndex:this.parent.activeSheetIndex;if(e&&e.field){var n=[].slice.call(this.filterCollection.get(r));n&&n.length&&(this.updatePredicate(n,e.field),this.initiateFilterUIHandler({predicates:n,range:m(this.filterRange.get(r).range),sIdx:r}))}else{var i=e&&e.isAction,a={isFiltered:!1,isClearAll:!0,sheetIndex:r};if(this.getFilteredColumnHandler(a),a.isFiltered||e&&e.preventRefresh){var o=void 0,s=Ae(this.parent,r),l=this.filterRange.get(r),d=l.range;if(i&&(o={range:m(d),predicates:[],previousPredicates:this.filterCollection.get(r),sheetIndex:r,cancel:!1},this.parent.notify(qr,{action:"filter",eventArgs:o}),o.cancel))return;this.filterCollection.set(r,[]);var h=l.useFilterRange?d[2]:s.usedRange.rowIndex;if(this.parent.scrollSettings.enableVirtualization&&h-d[0]+1>this.parent.viewport.rowCount+2*this.parent.getThreshold("row")){for(var p=0;p<=h;p++)et(s,p,{hidden:!1,isFiltered:!1});e&&e.preventRefresh||this.parent.renderModule.refreshSheet(!1,!1,!0)}else{this.refreshFilterRange(null,null,r);var c={startIndex:d[0],hide:!1,isFiltering:!0,refreshUI:!1,endIndex:l.useFilterRange?d[2]:s.usedRange.rowIndex,sheetIndex:r};this.parent.notify(vn,c),!c.refreshUI||e&&e.preventRefresh||this.parent.renderModule.refreshSheet(!1,!1,!0)}i&&(delete o.cancel,this.parent.notify(ci,{action:"filter",eventArgs:o}),or(this.parent.element))}}},e.prototype.reapplyFilterHandler=function(e,t){var n=this,i=this.parent.activeSheetIndex;if(this.filterRange.has(i)){var a=this.filterCollection.get(i);if(a&&a.length){var o=Ae(this.parent,i),s=this.filterRange.get(i),l=s.range.slice();s.allowHeaderFilter||(l[0]=l[0]+1),s.useFilterRange||(l[2]=o.usedRange.rowIndex),l[1]=l[3]=f(a[0].field);var d=o.name+"!"+this.getPredicateRange(l,a.slice(1,a.length));ye(this.parent,d,!0,!0,null,!0,null,null,!1,m(l)).then(function(o){var l=n.getPredicates(n.filterCollection.get(i));n.applyFilter({predicates:l.predicates,datasource:new r.DataManager(o),equalOrPredicates:l.equalOrPredicates},m(s.range),i,[].slice.call(a),t,e)})}}},e.prototype.getFilterRangeHandler=function(e){var r=t.isNullOrUndefined(e.sheetIdx)?this.parent.activeSheetIndex:e.sheetIdx,n=this.filterRange&&this.filterRange.get(r);n?(e.hasFilter=!0,e.filterRange=n.range,e.allowHeaderFilter=n.allowHeaderFilter,e.isFiltered=this.filterCollection&&this.filterCollection.get(r)&&this.filterCollection.get(r).length>0):(e.hasFilter=!1,e.filterRange=null)},e.prototype.getLocalizedCustomOperators=function(){var e=this.parent.serviceLocator.getService(Na),t=[{value:"equal",text:e.getConstant("Equal")},{value:"greaterthan",text:e.getConstant("GreaterThan")},{value:"greaterthanorequal",text:e.getConstant("GreaterThanOrEqual")},{value:"lessthan",text:e.getConstant("LessThan")},{value:"lessthanorequal",text:e.getConstant("LessThanOrEqual")},{value:"notequal",text:e.getConstant("NotEqual")}];return{stringOperator:[{value:"startswith",text:e.getConstant("StartsWith")},{value:"endswith",text:e.getConstant("EndsWith")},{value:"contains",text:e.getConstant("Contains")},{value:"equal",text:e.getConstant("Equal")},{value:"isempty",text:e.getConstant("IsEmpty")},{value:"doesnotstartwith",text:e.getConstant("NotStartsWith")},{value:"doesnotendwith",text:e.getConstant("NotEndsWith")},{value:"doesnotcontain",text:e.getConstant("NotContains")},{value:"notequal",text:e.getConstant("NotEqual")},{value:"isnotempty",text:e.getConstant("IsNotEmpty")}],numberOperator:t,dateOperator:t,datetimeOperator:t,booleanOperator:[{value:"equal",text:e.getConstant("Equal")},{value:"notequal",text:e.getConstant("NotEqual")}]}},e.prototype.setFilteredCollection=function(e){var n=this,i={sheetIdx:e.sheetIdx};if(this.getFilterRangeHandler(i),i.hasFilter){var a={sheetIndex:e.sheetIdx,filterRange:m(i.filterRange),hasFilter:!0,column:[],criteria:[],value:[],dataType:[],predicates:[]};e.saveJson.filterCollection.push(a);for(var o,s=this.filterCollection.get(e.sheetIdx),l=new Map,d=void 0,h=function(r){if(t.isNullOrUndefined(r))return"";if(e.isSaveAction&&"date"===o){var n=r;r=n.getMonth()+1+"/"+n.getDate()+"/"+n.getFullYear()+" "+n.getHours()+":"+n.getMinutes()+":"+n.getSeconds()}return r},p=0;p<s.length;p++)d=s[p],e.isSaveAction&&"notequal"===d.operator&&d.isFilterByMenu?l.has(d.field)?l.get(d.field).push(d):l.set(d.field,[d]):(a.column.push(f(d.field)),a.criteria.push(d.operator),e.isSaveAction?"equal"===d.operator?(o=ue(d.value)?"date":"string",a.value.push(h(d.value)),a.dataType.push(o)):(a.value.push(d.value),a.dataType.push("custom")):(a.value.push(d.value),a.dataType.push(d.type)),a.predicates.push(d.predicate));var c,u=new Map;l.forEach(function(t,i){c=f(i),u.has(i)||u.set(i,n.getColData(c,i,e.sheetIdx));for(var s=u.get(i),l=n.getPredicates(t).predicates,d=new r.DataManager(s).executeLocal((new r.Query).where(r.Predicate.and(l))),p=0;p<d.length;p++)a.column.push(c),a.criteria.push("equal"),o=ue(d[p][i])?"date":"string",a.value.push(h(d[p][i])),a.dataType.push(o),a.predicates.push("or")})}},e.prototype.updateFilter=function(e){if(this.parent.filterCollection&&(e.initLoad||e.isOpen)){for(var t=void 0,n=void 0,i=void 0,a={},o=void 0,s=void 0,l=void 0,d=0;d<this.parent.filterCollection.length;d++){var h=(i=this.parent.filterCollection[d]).sheetIndex;if(0!==d||this.parent.isOpen||e.isOpen||(h=0),n=[],i.column)for(var p=0;p<i.column.length;p++)if(s={field:v(i.column[p]+1),operator:this.getFilterOperator(i.criteria[p]),value:"string"==typeof i.value[p]?i.value[p].split("*").join(""):i.value[p],predicate:i.predicates&&i.predicates[p],type:i.dataType&&i.dataType[p]},["year","month","day"].indexOf(s.type)>-1){var c={value:s.value,cell:{value:s.value}};if(this.parent.notify(Zr,c),c.isDate){var u=c.dateObj;if(s.value=u,"day"===s.type)s.type="date",s.predicate="or",n.push(s);else{s.operator="greaterthanorequal",s.predicate="and";var f=s.type;s.type="date",t=this.getPredicates([s,{field:s.field,operator:"lessthanorequal",predicate:"and",type:"date",value:new Date(u.getFullYear(),"year"===f?12:u.getMonth()+1,0,0,0,0)}]).predicates,a[s.field]||(a[s.field]=this.getColData(i.column[p],s.field,d)),o=new r.DataManager(a[s.field]).executeLocal((new r.Query).where(r.Predicate.and(t)));for(var g=0;g<o.length;g++)n.push({field:s.field,operator:"equal",predicate:"or",type:"date",value:o[g][s.field]})}}}else{if(l={isOpen:!0,instance:{options:{type:s.type}},arg3:s.value,arg2:s.operator},this.beforeFilteringHandler(l),s.value=l.arg3,"string"===s.type||"custom"===s.type)this.isCustomNumFilter(s.operator)&&fe(s.value)&&(s.type="number");else if("date"===s.type&&"equal"===s.operator&&"string"==typeof s.value&&s.value.includes("/")&&s.value.includes(":")){var m=s.value.split(" ");if(2===m.length){var y=m[0].split("/"),C=m[1].split(":");3===y.length&&3===C.length&&(s.value=new Date(Number(y[2]),Number(y[0])-1,Number(y[1]),Number(C[0]),Number(C[1]),Number(C[2])))}}n.push(s)}if(!e.isOpen)for(var b=0;b<n.length-1;b++)n[b].field===n[b+1].field&&(n[b].predicate||(n[b].predicate="or"),n[b+1].predicate||(n[b+1].predicate="or"));this.parent.notify(pi,{predicates:n.length?n:void 0,range:i.filterRange,sIdx:h,isInternal:!0,isOpen:e.isOpen})}this.parent.sortCollection&&this.parent.notify("sortImport",null),this.parent.setProperties({filterCollection:null},!0)}},e.prototype.getColData=function(e,t,r){var n=Ae(this.parent,r);if(!n.rows||!n.rows.length)return[];for(var i,a,o=[],s=1,l=n.rows.length;s<l;s++)n.rows[s]&&(a=He(s,e,n,!1,!0))&&a.value&&((i={})[t]=Ce(this.parent,a,s,e),o.push(i));return o},e.prototype.getFilterOperator=function(e){switch(e){case"BeginsWith":e="startswith";break;case"Less":e="lessthan";break;case"EndsWith":e="endswith";break;case"Equal":e="equal";break;case"Notequal":e="notEqual";break;case"Greater":e="greaterthan";break;case"Contains":e="contains";break;case"LessOrEqual":e="lessthanorequal";break;case"GreaterOrEqual":e="greaterthanorequal";break;case"NotContains":e="doesnotcontain";break;case"NotBeginsWith":e="doesnotstartwith";break;case"NotEndsWith":e="doesnotendwith";break;case"Empty":e="isempty";break;case"NotEmpty":e="isnotempty"}return e},e.prototype.beforeInsertHandler=function(e){if("Column"===e.modelType){var r=t.isUndefined(e.activeSheetIndex)?this.parent.activeSheetIndex:e.activeSheetIndex;if(this.filterRange.size&&this.filterRange.has(r)){var n=this.filterRange.get(r).range;(this.isFilterCell(r,n[0],e.index)||e.index<n[1])&&(n[3]+=e.model.length,e.index<=n[1]&&(n[1]+=e.model.length),this.filterCollection.get(r).forEach(function(t){var r=f(t.field);e.index<=r&&(t.field=v(r+e.model.length+1))}),this.parent.sortCollection&&this.parent.sortCollection.forEach(function(t){t.sheetIndex===r&&e.index<=t.columnIndex&&(t.columnIndex+=e.model.length)}))}}else if("Sheet"===e.modelType){for(var i=0,a=Array.from(this.filterRange.keys()).sort().reverse();i<a.length;i++){var o=a[i];e.index<=o&&(this.filterRange.set(o+e.model.length,this.filterRange.get(o)),this.filterRange.delete(o),this.filterCollection.set(o+e.model.length,this.filterCollection.get(o)),this.filterCollection.delete(o))}this.parent.sortCollection&&this.parent.sortCollection.forEach(function(t){e.index<=t.sheetIndex&&(t.sheetIndex+=e.model.length)})}},e.prototype.beforeDeleteHandler=function(e){if("Column"===e.modelType){var t=this.parent.activeSheetIndex;if(this.filterRange.size&&this.filterRange.has(t)){var r=!0,n=this.filterRange.get(t).range;if(e.start>=n[1]&&e.end<=n[3]?n[3]-=e.end-e.start+1:e.start<n[1]&&e.end<n[1]?(n[1]-=e.end-e.start+1,n[3]-=e.end-e.start+1):e.start<n[1]&&e.end>n[1]&&e.end<n[3]?(n[1]=e.start,n[3]-=e.end-e.start+1):r=!1,r){for(var i=this.filterCollection.get(t),a=void 0,o=i.length-1;o>=0;o--){var s=f(i[o].field);e.end<s?i[o].field=v(s-(e.end-e.start+1)+1):e.start<=s&&e.end>=s&&(a=!0,i.splice(o,1))}var l=this.parent.sortCollection;if(l)for(o=0;o<l.length;o++)if(l[o].sheetIndex===t){if(e.end<l[o].columnIndex){l[o].columnIndex=l[o].columnIndex-(e.end-e.start+1);break}if(e.start<=l[o].columnIndex&&e.end>=l[o].columnIndex){l.splice(o,1);break}}n.some(function(e){return e<0})?(this.removeFilter(t,!0,!0),e.refreshSheet=!0):a&&(i&&i.length?(this.reapplyFilterHandler(!0,!0),e.refreshSheet=!1):(this.clearFilterHandler({preventRefresh:!0}),e.refreshSheet=!0))}}}},e.prototype.deleteSheetHandler=function(e){if(t.isUndefined(e.sheetIndex))this.filterRange.get(this.parent.activeSheetIndex)&&(this.filterRange.delete(this.parent.activeSheetIndex),this.filterCollection.delete(this.parent.activeSheetIndex));else{for(var r=0,n=Array.from(this.filterRange.keys()).sort().reverse();r<n.length;r++){var i=n[r];e.sheetIndex===i?(this.filterRange.delete(i),this.filterCollection.delete(i)):e.sheetIndex<i&&(this.filterRange.set(i-1,this.filterRange.get(i)),this.filterRange.delete(i),this.filterCollection.set(i-1,this.filterCollection.get(i)),this.filterCollection.delete(i))}var a=this.parent.sortCollection;if(a)for(var o=a.length-1;o>=0;o--)e.sheetIndex===a[o].sheetIndex?a.splice(o,1):e.sheetIndex<a[o].sheetIndex&&(a[o].sheetIndex-=1)}},e.prototype.clearHandler=function(e){var t=this.parent.getAddressInfo(e.range);if(this.filterRange.has(t.sheetIndex)){var r=this.filterRange.get(t.sheetIndex).range.slice();P(t.indices,r[0],r[1])&&P(t.indices,r[0],r[3])&&this.removeFilter(t.sheetIndex,null,null,!0)}},e.prototype.duplicateSheetFilterHandler=function(e){for(var t=0,r=Array.from(this.filterRange.keys()).sort().reverse();t<r.length;t++){var n=r[t];if(!(e.newSheetIndex<=n))break;this.filterRange.set(n+1,this.filterRange.get(n)),this.filterRange.delete(n),this.filterCollection.set(n+1,this.filterCollection.get(n)),this.filterCollection.delete(n)}if(this.filterCollection.has(e.sheetIndex)&&this.filterCollection.set(e.newSheetIndex,this.filterCollection.get(e.sheetIndex).slice()),this.filterRange.has(e.sheetIndex)){var i=this.filterRange.get(e.sheetIndex);this.filterRange.set(e.newSheetIndex,{useFilterRange:i.useFilterRange,range:i.range.slice(),allowHeaderFilter:i.allowHeaderFilter})}},e.prototype.updateSortCollectionHandler=function(e){var t;if(e.isDuplicate){if(this.parent.sortCollection&&this.parent.sortCollection.length>0){for(var r=[],n=0;n<this.parent.sortCollection.length;n++){var i=this.parent.sortCollection[n];if(i.sheetIndex===e.curSheetIndex){var a=Object.assign({},i);a.sheetIndex=e.newSheetIndex,r.push(a)}}(t=this.parent.sortCollection).push.apply(t,r)}}else{var o=this.parent.getActiveSheet(),s=this.parent.activeSheetIndex,l=this.filterRange.get(s);if(l){var d=l.range.slice();l.allowHeaderFilter||(d[0]=d[0]+1),l.useFilterRange||(d[2]=o.usedRange.rowIndex);var h=e.sortOptions.sortDescriptors;if(this.parent.sortCollection=this.parent.sortCollection?this.parent.sortCollection:[],Array.isArray(h))for(var p=0;p<h.length;p++)this.parent.sortCollection.push({sortRange:m(d),columnIndex:f(h[p].field),order:h[p].order,sheetIndex:s});else this.parent.sortCollection.push({sortRange:m(d),columnIndex:y(o.activeCell)[1],order:h.order,sheetIndex:s})}}},e.prototype.moveSheetHandler=function(e){var t,r,n,i;this.filterRange.has(e.prevIndex)&&(t=this.filterRange.get(e.prevIndex),n=this.filterCollection.get(e.prevIndex)),this.filterRange.has(e.currentIndex)&&(r=this.filterRange.get(e.currentIndex),i=this.filterCollection.get(e.currentIndex)),t&&r?(this.filterRange.set(e.currentIndex,t),this.filterRange.set(e.prevIndex,r),this.filterCollection.set(e.currentIndex,n),this.filterCollection.set(e.prevIndex,i)):t?(this.filterRange.set(e.currentIndex,t),this.filterRange.delete(e.prevIndex),this.filterCollection.set(e.currentIndex,n),this.filterCollection.delete(e.prevIndex)):r&&(this.filterRange.set(e.prevIndex,r),this.filterRange.delete(e.currentIndex),this.filterCollection.set(e.prevIndex,i),this.filterCollection.delete(e.currentIndex))},e.prototype.refreshFilterCellsOnResize=function(e){var t=this.filterRange.has(this.parent.activeSheetIndex)&&this.filterRange.get(this.parent.activeSheetIndex).range;if(t&&t[0]===e.rowIndex)for(var r=this.parent.getActiveSheet(),n=t[1];n<=t[3];n++)if(He(e.rowIndex,n,r,!1,!0).notes){var i=this.parent.getCell(e.rowIndex,n);i&&this.parent.serviceLocator.getService("cell").refresh(e.rowIndex,n,!1,i,!1,!1,!0)}},e}(),Mo=function(){function e(e){this.parent=e,this.addEventListener(),this.renderImageUpload()}return e.prototype.addEventListener=function(){this.parent.on("insertImage",this.insertImage,this),this.parent.on(Ii,this.refreshImgCellObj,this),this.parent.on(Ni,this.createImageElement,this),this.parent.on(Fi,this.deleteImage,this),this.parent.on("refreshImagePosition",this.refreshInsDelImagePosition,this)},e.prototype.renderImageUpload=function(){var e=this.parent.createElement("input",{id:this.parent.element.id+"_imageUpload",attrs:{type:"file",accept:".image, .jpg, .png, .gif ,jpeg",name:"fileUpload"}});e.style.display="none",this.parent.element.appendChild(e),e.onchange=this.imageSelect.bind(this)},e.prototype.imageSelect=function(e){var t=e.target.files[0];t&&(t.type.includes("image")?this.insertImage({file:t,isAction:!0}):this.parent.serviceLocator.getService(Fa).show({content:this.parent.serviceLocator.getService("spreadsheetLocale").getConstant("UnsupportedFile"),width:"300"}),e.target.value="")},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("insertImage",this.insertImage),this.parent.off(Ii,this.refreshImgCellObj),this.parent.off(Ni,this.createImageElement),this.parent.off(Fi,this.deleteImage),this.parent.off("refreshImagePosition",this.refreshInsDelImagePosition))},e.prototype.insertImage=function(e,t){var r=this;this.binaryStringVal(e).then(function(n){return r.createImageElement({options:{src:n},range:t,isPublic:!0,isAction:e.isAction})})},e.prototype.binaryStringVal=function(e){return new Promise(function(t,r){var n=new FileReader;n.readAsDataURL(e.file),n.onload=function(){return t(n.result)},n.onerror=function(e){return r(e)}})},e.prototype.createImageElement=function(e){var r=e.range?e.range.lastIndexOf("!"):0,n=e.range?r>0?e.range.substring(r+1):e.range:this.parent.getActiveSheet().selectedRange,i=e.range&&r>0?Se(this.parent,e.range.substring(0,r)):this.parent.activeSheetIndex,a=this.parent.serviceLocator.getService("shape"),o=e.options.id?e.options.id:t.getUniqueID(this.parent.element.id+"_overlay_picture_"),s=c(n),l=t.isUndefined(i)&&!e.isUndoRedo?this.parent.getActiveSheet():this.parent.sheets[i];if(l&&!this.parent.element.querySelector("#"+o)){if(e.isPublic&&oe(this.parent,s))return void(e.isAction&&this.parent.notify(yi,null));var d={requestType:"beforeInsertImage",range:l.name+"!"+n,imageData:e.options.src,sheetIndex:i};if(e.isPublic&&this.parent.notify("actionBegin",{eventArgs:d,action:"beforeInsertImage"}),!d.cancel){var h=a.insertOverlayElement(o,n,i);h.element.style.backgroundImage="url('"+e.options.src+"')",(e.options.height||e.options.left)&&(h.element.style.height=e.options.height+"px",h.element.style.width=e.options.width+"px",t.isNullOrUndefined(e.options.top)||(h.element.style.top=Number(ur(e.options.top).toFixed(2))+"px"),t.isNullOrUndefined(e.options.left)||(h.element.style.left=Number(ur(e.options.left).toFixed(2))+"px")),(l.frozenRows||l.frozenColumns)&&a.adjustFreezePaneSize(e.options,h.element,n);var p={src:e.options.src,id:o,height:parseFloat(h.element.style.height.replace("px","")),width:parseFloat(h.element.style.width.replace("px","")),top:l.frozenRows||l.frozenColumns?s[0]?at(l,0,s[0]-1):0:h.top,left:l.frozenRows||l.frozenColumns?s[1]?dt(l,0,s[1]-1):0:h.left};this.parent.setUsedRange(s[0],s[1]);var u=!1;e.isPublic||e.isUndoRedo||p.top===e.options.top&&p.left===e.options.left||(e.options.top=p.top,e.options.left=p.left,u=!0);var f={options:[p],range:l.name+"!"+n,isPositionChanged:u,isElementRemoved:!1};(e.isPublic||e.isUndoRedo||u)&&this.parent.notify("setImage",f),u&&f.isElementRemoved&&((h=a.insertOverlayElement(o,n,i)).element.style.backgroundImage="url('"+e.options.src+"')");var g=He(s[0],s[1],l);g.image[g.image.length-1].id||(g.image[g.image.length-1].id=p.id),!e.isUndoRedo&&e.isPublic&&(d={requestType:"insertImage",range:l.name+"!"+n,imageHeight:e.options.height?e.options.height:300,imageWidth:e.options.width?e.options.width:400,imageData:e.options.src,id:o,sheetIndex:i},this.parent.notify("actionComplete",{eventArgs:d,action:"insertImage"}))}}},e.prototype.refreshInsDelImagePosition=function(e){for(var t,r,n,i=e.count,a=e.sheetIdx,o=this.parent.sheets[a],s=He(e.rowIdx,e.colIdx,o),l=s.image.length,d=0;d<l;d++)t=document.getElementById(s.image[d].id),r="Row"===e.type?"insert"===e.status?s.image[d].top+20*i:s.image[d].top-20*i:s.image[d].top,n="Column"===e.type?"insert"===e.status?s.image[d].left+64*i:s.image[d].left-64*i:s.image[d].left,s.image[d].top=r,s.image[d].left=n,t&&(t.style.top=r+"px",t.style.left=n+"px")},e.prototype.refreshImgCellObj=function(e){var r,n,i=t.isUndefined(e.sheetIdx)?this.parent.activeSheetIndex:e.sheetIdx,a=Ae(this.parent,i),o=He(e.prevRowIdx,e.prevColIdx,a),s=He(e.currentRowIdx,e.currentColIdx,a),l=o?o.image:[],d=l&&l.length?l.length:0;if(o&&o.image&&l.length>0){for(var h=0;h<d;h++)l[h]&&l[h].id===e.id&&((r=l[h]).height=e.currentHeight,r.width=e.currentWidth,r.top=e.currentTop,r.left=e.currentLeft,l.splice(h,1));if(s&&s.image&&(n=s.image,r&&n.push(r)),n?Ue(e.currentRowIdx,e.currentColIdx,a,{image:n},!0):Ue(e.currentRowIdx,e.currentColIdx,a,{image:[r]},!0),"imageRefresh"===e.requestType&&!e.isUndoRedo){var p={requestType:"imageRefresh",currentRowIdx:e.currentRowIdx,currentColIdx:e.currentColIdx,prevRowIdx:e.prevRowIdx,prevColIdx:e.prevColIdx,prevTop:e.prevTop,prevLeft:e.prevLeft,currentTop:e.currentTop,currentLeft:e.currentLeft,currentHeight:e.currentHeight,currentWidth:e.currentWidth,prevHeight:e.prevHeight,prevWidth:e.prevWidth,id:e.id,sheetIdx:this.parent.activeSheetIndex};this.parent.notify("actionComplete",{eventArgs:p,action:"imageRefresh"})}}},e.prototype.deleteImage=function(e){var t,r=e.sheet||this.parent.getActiveSheet(),n=document.getElementById(e.id),i=e.rowIdx,a=e.colIdx;if(n){if(void 0===e.rowIdx&&void 0===e.colIdx){var o=void 0,s=void 0;if(r.frozenRows||r.frozenColumns){var l=n.getBoundingClientRect();o={clientY:l.top},s={clientX:l.left},l.top<this.parent.getColumnHeaderContent().getBoundingClientRect().bottom&&(o.target=this.parent.getColumnHeaderContent()),l.left<this.parent.getRowHeaderContent().getBoundingClientRect().right&&(s.target=this.parent.getRowHeaderTable())}else o={clientY:parseFloat(n.style.top),isImage:!0},s={clientX:parseFloat(n.style.left),isImage:!0};this.parent.notify(Ei,o),this.parent.notify(Ri,s),i=o.clientY,a=s.clientX}if(t=r.name+"!"+g(i,a),!e.preventEventTrigger){var d={address:t,cancel:!1};if(this.parent.notify(qr,{action:"deleteImage",eventArgs:d}),d.cancel)return}document.getElementById(e.id).remove()}else if(!e.sheet){var h=e.range?e.range.lastIndexOf("!")>0?e.range.substring(e.range.lastIndexOf("!")+1):e.range:this.parent.getActiveSheet().selectedRange,p=e.range&&e.range.lastIndexOf("!")>0?Se(this.parent,e.range.substring(0,e.range.lastIndexOf("!"))):this.parent.activeSheetIndex,u=c(h);i=u[0],a=u[1],r=this.parent.sheets[p]}var f={};if(r){for(var m=He(i,a,r),v=m&&m.image?m.image:[],y=v.length-1;y>=0;y--)v[y].id===e.id&&(f=v.splice(y,1)[0]);Ue(i,a,r,{image:v},!0)}e.preventEventTrigger||this.parent.notify(ci,{action:"deleteImage",eventArgs:{address:t,id:f.id,imageData:f.src,imageWidth:f.width,imageHeight:f.height,cancel:!1},preventAction:e.isUndoRedo,isClearAction:e.clearAction})},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"spreadsheetImage"},e}();p.Chart.Inject(p.ColumnSeries,p.LineSeries,p.BarSeries,p.AreaSeries,p.StackingColumnSeries,p.StackingLineSeries,p.StackingBarSeries,p.ScatterSeries),p.Chart.Inject(p.StackingAreaSeries,p.Category,p.Legend,p.Tooltip,p.DataLabel),p.AccumulationChart.Inject(p.PieSeries,p.AccumulationTooltip,p.AccumulationDataLabel,p.AccumulationLegend);var Bo=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on("initiateChart",this.initiateChartHandler,this),this.parent.on(ki,this.refreshChartCellObj,this),this.parent.on("refreshChartCellModel",this.refreshChartCellModel,this),this.parent.on("refreshChartCellOnInit",this.refreshChartCellObj,this),this.parent.on(Ai,this.deleteChart,this),this.parent.on("clearChartBorder",this.clearBorder,this),this.parent.on("insertChart",this.insertChartHandler,this),this.parent.on("chartRangeSelection",this.chartRangeHandler,this),this.parent.on(Oi,this.chartDesignTabHandler,this),this.parent.on("addChartEle",this.updateChartElement,this),this.parent.on("undoRedoForChartDesign",this.undoRedoForChartDesign,this),this.parent.on("refreshChart",this.refreshChartData,this)},e.prototype.insertChartHandler=function(e){var t=this,r="Column",n=!1;switch(e.id){case"clusteredColumn":r="Column";break;case"stackedColumn":r="StackingColumn";break;case"stackedColumn100":r="StackingColumn100";break;case"clusteredBar":r="Bar";break;case"stackedBar":r="StackingBar";break;case"stackedBar100":r="StackingBar100";break;case"area":r="Area";break;case"stackedArea":r="StackingArea";break;case"stackedArea100":r="StackingArea100";break;case"line":r="Line";break;case"lineMarker":r="Line",n=!0;break;case"stackedLine":r="StackingLine";break;case"stackedLineMarker":r="StackingLine",n=!0;break;case"stackedLine100":r="StackingLine100";break;case"stackedLine100Marker":r="StackingLine100",n=!0;break;case"pie":r="Pie";break;case"doughnut":r="Doughnut";break;case"scatter":r="Scatter"}var i=[{type:r,markerSettings:{visible:n,isFilled:!0}}];e.isChart?(this.parent.notify(xn,{chart:i}),ft(function(){return or(t.parent.element)})):this.parent.notify(Oi,{chartType:r,triggerEvent:!0,markerVisible:n})},e.prototype.chartRangeHandler=function(){var e=document.querySelector(".e-datavisualization-chart.e-ss-overlay-active");if(e)for(var t=e.getElementsByClassName("e-control")[0].id,r=this.parent.chartColl,n=r.length,i=0;i<n;i++){var a=document.getElementById(r[i].id);e&&a&&r[i].id===t&&this.initiateChartHandler({option:r[i],isRefresh:!0})}},e.prototype.refreshChartData=function(e){if(this.parent.chartColl&&this.parent.chartColl.length)for(var r,n,i,a,o,s,l=0,d=this.parent.chartColl.length;l<d;l++){if((r=this.parent.chartColl[l]).range.includes("!")){if(n=r.range.substring(0,r.range.lastIndexOf("!")),this.parent.activeSheetIndex!==Se(this.parent,n))continue;i=r.range.substring(r.range.lastIndexOf("!")+1)}else i=r.range;if(e.viewportIndexes){for(var h=0;h<e.viewportIndexes.length;h++)if(J([e.viewportIndexes[h]],i)){a=!0;break}}else a=e.range?J([e.range],i):e.showHide?this.inRowColumnRange(c(i),e.rIdx,e.showHide):P(c(i),e.rIdx,e.cIdx);(a||e.isSelectAll&&!e.isRefreshChart)&&(o=this.parent.element.querySelector("."+r.id))&&(s=t.getComponent(o,"chart")||t.getComponent(o,"accumulationchart"))&&(s.series=this.initiateChartHandler({option:r,isRefresh:!0}),s.refresh())}},e.prototype.inRowColumnRange=function(e,t,r){return"rows"===r?t>=e[0]&&t<=e[2]:t>=e[1]&&t<=e[3]},e.prototype.refreshChartCellModel=function(e){for(var t=0,r=e.prevChartIndexes.length;t<r;t++){var n=e.prevChartIndexes[t].chart,i=e.prevChartIndexes[t].chartRowIdx,a=e.prevChartIndexes[t].chartColIdx,o=e.currentChartIndexes[t].chartRowIdx,s=e.currentChartIndexes[t].chartColIdx,l={prevTop:n.top,prevLeft:n.left,prevRowIdx:i,prevColIdx:a,prevHeight:n.height,prevWidth:n.width,currentTop:n.top,currentLeft:n.left,currentRowIdx:o,currentColIdx:s,currentHeight:n.height,currentWidth:n.width,id:n.id,requestType:"chartRefreshOnFilter"};this.parent.notify(ki,l)}},e.prototype.refreshChartCellObj=function(e){var r,n,i=t.isUndefined(e.sheetIdx)?this.parent.activeSheetIndex:e.sheetIdx,a=Ae(this.parent,i),o=He(e.prevRowIdx,e.prevColIdx,a),s=He(e.currentRowIdx,e.currentColIdx,a),l=o?o.chart:[],d=l&&l.length?l.length:0;if(d){for(var h=0;h<d;h++)if(l[h].id===e.id.split("_overlay")[0]){(r=l[h]).height=e.currentHeight,r.width=e.currentWidth,r.top=e.currentTop,r.left=e.currentLeft,l.splice(h,1),h--,d--;for(var p=0,c=this.parent.chartColl.length;p<c;p++)r.id===this.parent.chartColl[p].id&&(r.height=e.currentHeight,this.parent.chartColl[p].width=e.currentWidth,this.parent.chartColl[p].top=e.currentTop,this.parent.chartColl[p].left=e.currentLeft)}if(s&&s.chart&&(n=s.chart,r&&n.push(r)),n?Ue(e.currentRowIdx,e.currentColIdx,a,{chart:n},!0):Ue(e.currentRowIdx,e.currentColIdx,a,{chart:[r]},!0),"chartRefresh"===e.requestType&&!e.isUndoRedo){var u={requestType:"chartRefresh",currentRowIdx:e.currentRowIdx,currentColIdx:e.currentColIdx,currentWidth:e.currentWidth,prevHeight:e.prevHeight,prevWidth:e.prevWidth,prevRowIdx:e.prevRowIdx,prevColIdx:e.prevColIdx,prevTop:e.prevTop,prevLeft:e.prevLeft,currentTop:e.currentTop,currentLeft:e.currentLeft,currentHeight:e.currentHeight,id:e.id,sheetIdx:i};this.parent.notify("actionComplete",{eventArgs:u,action:"chartRefresh"})}}},e.prototype.processChartRange=function(e,r,n){var i,a,o,s,l,d=this,h=e[0],p=e[1],c=!1,u=e[2],f=e[3],g=h===u,m=p===f,v=Ae(this.parent,r),y=ne(this.parent),C=function(e,n,i,a){var o=He(e,n,v);if(o){o.formula&&t.isNullOrUndefined(o.value)&&d.parent.notify(Gr,{cell:o,rowIdx:e,colIdx:n,sheetIndex:r});var h=void 0;if(o.format){var p={value:o.value,format:o.format,formattedText:o.value,cell:o,rowIndex:e,colIndex:n};d.parent.notify(Wr,p);var c=fe(o.value);c&&!qe(o.format,!0,null,!0)?h=Number(o.value):(a&&c?s=!0:i&&c&&(l=!0),h=p.formattedText&&p.formattedText.toString())}else y(o),h=o.value;return t.isNullOrUndefined(h)?"":h}return""},b=v?C(h,f,!1,!0):"",x=v?C(u,p,!0):"",S=v?C(h,p,!0):"";return fe(x)&&S||(c=!0),!t.isNullOrUndefined(S)&&("Scatter"!==n.type||n.isSeriesInRows)||g||m?t.isNullOrUndefined(x)||!c||g||m||s?(a=[h,p,u,f],t.isNullOrUndefined(b)||fe(b)||s?(g||m)&&t.isNullOrUndefined(S)&&(o=[h,p,h,f],g?(a[1]=a[1]+1,o[3]=o[1]):a[0]=a[0]+1):(o=[h,p,h,f],g||(a[0]=a[0]+1))):t.isNullOrUndefined(b)||fe(b)&&S?(i=[h,p,u,p],a=[h,p+1,u,f]):(i=[h+1,p,u,p],a=[h+1,p+1,u,f],o=[h,p+1,h,f]):(i=[h+1,p,u,p],a=[h+1,p+1,u,f],o=[h,p+1,h,f]),{xRange:i,yRange:a,lRange:o,isStringSeries:c,isDateTime:l}},e.prototype.getRangeData=function(e){var r=e.sheet;e.range?"string"==typeof e.range&&(e.range=c(e.range)):e.range=c(r.selectedRange);for(var n,i,a,o=[],s=e.range[0],l=e.isYvalue&&ne(this.parent);s<=e.range[2];)if(tt(r,s))s++;else{for(i=e.range[1];i<=e.range[3];)if(ht(r,i))i++;else{var d=He(s,i,r,!1,!0);d.formula&&t.isNullOrUndefined(d.value)&&this.parent.notify(Gr,{cell:d,rowIdx:s,colIdx:i,sheetIndex:e.sheetIdx}),e.isYvalue&&l(d),n={value:d.value||(0===d.value?0:null)},d.format?(a={formattedText:d.value,value:d.value,format:d.format,cell:d,skipFormatCheck:!0},this.parent.notify(Wr,a),e.isYvalue?fe(d.value)?(n.value=Number(d.value),n.displayText=a.formattedText?a.formattedText.toString():""):(n.displayText=null===n.value?"":this.parent.getDisplayText({format:d.format,value:"0"}),n.value=0):e.isScatter&&!e.isDateTime&&fe(d.value)?n.value=Number(d.value):n.value=a.formattedText?a.formattedText.toString():null):e.isYvalue&&(fe(n.value)?(n.displayText=n.value.toString(),n.value=Number(n.value)):(n.displayText=null===n.value?"":"0",n.value=0)),o.push(n),i++}s++}return o},e.prototype.toArrayData=function(e){for(var t,r=0,n=[],i=e.length;r<i;)t=e[r],Object.keys(t).length?"value"in t&&n.push(t.value):n.push(""),r++;return n},e.prototype.getVirtualXValues=function(e){for(var t=1,r=[];t<e;)r.push(t.toString()),t++;return r},e.prototype.processChartSeries=function(e,r,n,i,a,o){e=e||{};var s,l,d,h,p,c,u={name:"displayText"},f={},g=0,m=0,v=this.parent.isPrintingProcessing,y=[];r=t.isNullOrUndefined(r)?this.parent.activeSheetIndex:r;var C=Ae(this.parent,r),b=e&&"Scatter"===e.type,x=this.getRangeData({range:i,sheet:C,isYvalue:!0,sheetIdx:r}),S=i[2]-i[0]+1-this.parent.hiddenCount(i[0],i[2],"rows",C),w=i[3]-i[1]+1-this.parent.hiddenCount(i[1],i[3],"columns",C);e.isSeriesInRows?(l=a?this.toArrayData(this.getRangeData({range:a,sheet:C,isScatter:b,isDateTime:o})):this.getVirtualXValues(w+1),n&&(d=this.toArrayData(this.getRangeData({range:n,sheet:C}))),h=S):(l=n?this.toArrayData(this.getRangeData({range:n,sheet:C,isScatter:b,isDateTime:o})):this.getVirtualXValues(S+1),a&&(d=this.toArrayData(this.getRangeData({range:a,sheet:C}))),h=w);var I=l.length,E=e.isSeriesInRows?1:h;for(t.isNullOrUndefined(e.dataLabelSettings)||(u.visible=e.dataLabelSettings.visible,u.position=e.dataLabelSettings.position);g<h;){for(c=0,p=[],m=e.isSeriesInRows?m:g;c<I;)t.isNullOrUndefined(l[c])&&(l[c]=t.getUniqueID("spread-chart-empty-label-")),p.push({x:l[c],y:x[m].value,displayText:x[m].displayText}),m+=E,c++;if(s=d&&d.length>0?d[g]:"Scatter"===e.type?"series"+(g+1):"series"+g,s=t.isNullOrUndefined(s)?"":s.toString(),e.type){var R=e.type;f="Line"===R||"StackingLine"===R||"StackingLine100"===R?{dataSource:p,type:e.type,xName:"x",yName:"y",name:s,animation:{enable:!v},tooltipMappingName:"displayText",marker:e.markerSettings?{visible:e.markerSettings.visible,width:e.markerSettings.size,height:e.markerSettings.size,shape:e.markerSettings.shape,dataLabel:u,isFilled:e.markerSettings.isFilled,border:e.markerSettings.border,fill:e.markerSettings.isFilled?e.markerSettings.fill:null}:{dataLabel:u}}:"Scatter"===R?{dataSource:p,type:e.type,xName:"x",yName:"y",name:s,tooltipMappingName:"displayText",animation:{enable:!v},marker:{visible:!1,width:12,height:12,shape:"Circle",dataLabel:u}}:"Pie"===R||"Doughnut"===R?{dataSource:p,radius:"100%",xName:"x",yName:"y",innerRadius:"Pie"===e.type?"0%":"40%",dataLabel:{visible:!!u.visible,position:"Outer"===u.position?"Outside":"Inside",name:"displayText",font:{fontWeight:"600"}},animation:{enable:!v},tooltipMappingName:"displayText"}:{dataSource:p,type:e.type,xName:"x",yName:"y",animation:{enable:!v},name:s,marker:{dataLabel:u},tooltipMappingName:"displayText"}}y.push(f),g++}var N;return e.type&&(N={series:y,xRange:e.isSeriesInRows?a:n,yRange:i,lRange:e.isSeriesInRows?n:a}),N},e.prototype.getAxisFormat=function(e){var r="";if(!t.isNullOrUndefined(e)){var n=He(e[0],e[1],this.parent.getActiveSheet());n&&n.format&&(r=n.format)}return r},e.prototype.focusChartRange=function(e,t,r){var n=["e-rcborderright","e-rcborderbottom","e-vcborderright","e-vcborderbottom","e-bcborderright","e-bcborderbottom"];this.clearBorder();var i,a=this.parent.getActiveSheet(),o=!(!a.frozenRows&&!a.frozenColumns);r&&(o?i=r:this.parent.notify("focusBorder",{startcell:{rowIndex:r[0],colIndex:r[1]},endcell:{rowIndex:r[2],colIndex:r[3]},classes:[n[0],n[1]]})),e&&(o?i?(i[0]=Math.min(r[0],e[0]),i[1]=Math.min(r[1],e[1]),i[2]=Math.max(r[2],e[2]),i[3]=Math.max(r[3],e[3])):i=e:this.parent.notify("focusBorder",{startcell:{rowIndex:e[0],colIndex:e[1]},endcell:{rowIndex:e[2],colIndex:e[3]},classes:[n[2],n[3]]})),o&&i?this.parent.notify("focusBorder",{startcell:{rowIndex:Math.min(i[0],t[0]),colIndex:Math.min(i[1],t[1])},endcell:{rowIndex:Math.max(i[2],t[2]),colIndex:Math.max(i[3],t[3])},classes:[n[4],n[5]]}):this.parent.notify("focusBorder",{startcell:{rowIndex:t[0],colIndex:t[1]},endcell:{rowIndex:t[2],colIndex:t[3]},classes:[n[4],n[5]]})},e.prototype.clearBorder=function(){var e=this.parent.getActiveSheet();if(e.frozenColumns||e.frozenRows)return void[].slice.call(this.parent.element.getElementsByClassName("e-chart-range")).forEach(function(e){t.detach(e)});for(var r=this.parent.getMainContent(),n=["e-rcborderright","e-rcborderbottom","e-vcborderright","e-vcborderbottom","e-bcborderright","e-bcborderbottom"],i=0,a=n.length;i<a;i++)for(var o=r.querySelectorAll("."+n[i]),s=0,l=o.length;s<l;s++)o[s].classList.remove(n[i])},e.prototype.initiateChartHandler=function(e){var r=this,n=e.option,i=!0;i=!!t.isNullOrUndefined(e.isInitCell)||!e.isInitCell,e.triggerEvent=!!t.isNullOrUndefined(e.triggerEvent)||e.triggerEvent;e.isRefresh=!t.isNullOrUndefined(e.isRefresh)&&e.isRefresh;var a,o,s=n.range&&n.range.lastIndexOf("!")>0?Se(this.parent,n.range.substring(0,n.range.lastIndexOf("!"))):this.parent.activeSheetIndex,l=Ae(this.parent,s),d=n.range?n.range:this.parent.getActiveSheet().selectedRange,h=c(d),u={};if(this.parent.allowChart||!l.isProtected){var f={sheetIndex:s,reqType:"shape",type:"actionBegin",shapeType:"chart",action:"create",options:n,range:d,operation:"create"};u=f.options,d=f.range,u=u||{},h.length>0&&!e.isRefresh&&i&&h[2]-h[0]<h[3]-h[1]&&(a=!0),u.isSeriesInRows=!!a||!!u.isSeriesInRows&&u.isSeriesInRows,e.dataSheetIdx=t.isNullOrUndefined(e.dataSheetIdx)?s:e.dataSheetIdx;var g=this.processChartRange(h,e.dataSheetIdx,u),m=g.xRange,v=g.yRange,y=g.lRange;if(s===this.parent.activeSheetIndex&&i&&this.focusChartRange(m,v,y),e.triggerEvent&&!e.isRefresh){if(o={type:n.type,theme:n.theme,isSeriesInRows:n.isSeriesInRows,range:n.range,markerSettings:u.markerSettings,dataLabelSettings:u.dataLabelSettings,title:u.title,legendSettings:u.legendSettings,primaryXAxis:u.primaryXAxis,primaryYAxis:u.primaryYAxis,id:n.id,height:n.height,width:n.width,posRange:e.range,isInitCell:e.isInitCell,cancel:!1,top:n.top,left:n.left},this.parent.notify(qr,{eventArgs:o,action:"beforeInsertChart"}),o.cancel)return[];n.type=o.type,n.theme=o.theme,n.isSeriesInRows=o.isSeriesInRows,n.markerSettings=o.markerSettings,n.range=o.range,n.id=o.id,n.height=o.height,n.width=o.width}var C=this.processChartSeries(u,e.dataSheetIdx,m,v,y,g.isDateTime),b={majorGridLines:n.primaryXAxis&&n.primaryXAxis.majorGridLines&&!t.isNullOrUndefined(n.primaryXAxis.majorGridLines.width)?{width:n.primaryXAxis.majorGridLines.width}:{width:0},minorGridLines:n.primaryXAxis&&n.primaryXAxis.minorGridLines&&!t.isNullOrUndefined(n.primaryXAxis.minorGridLines.width)?{width:n.primaryXAxis.minorGridLines.width}:{width:0},minorTicksPerInterval:n.primaryXAxis&&n.primaryXAxis.minorGridLines&&n.primaryXAxis.minorGridLines.width>0?5:0,lineStyle:{width:0},valueType:"Scatter"!==n.type||g.isStringSeries||n.isSeriesInRows?"Category":"Double",rangePadding:"Scatter"!==n.type||g.isStringSeries||n.isSeriesInRows?"Auto":"Round",visible:!n.primaryXAxis||n.primaryXAxis.visible,title:n.primaryXAxis?n.primaryXAxis.title:"",edgeLabelPlacement:"Shift"},x={lineStyle:{width:0},majorGridLines:n.primaryYAxis&&n.primaryYAxis.majorGridLines&&!t.isNullOrUndefined(n.primaryYAxis.majorGridLines.width)?{width:n.primaryYAxis.majorGridLines.width}:{width:1},minorGridLines:n.primaryYAxis&&n.primaryYAxis.minorGridLines&&!t.isNullOrUndefined(n.primaryYAxis.minorGridLines.width)?{width:n.primaryYAxis.minorGridLines.width}:{width:0},minorTicksPerInterval:n.primaryYAxis&&n.primaryYAxis.minorGridLines&&n.primaryYAxis.minorGridLines.width>0?5:0,visible:!n.primaryYAxis||n.primaryYAxis.visible,title:n.primaryYAxis?n.primaryYAxis.title:"",edgeLabelPlacement:"Shift"};if(e.isRefresh){if(e.isSwitchRowColumn&&"Scatter"===n.type){var w=this.parent.element.querySelector("."+n.id);w&&(t.getComponent(w,"chart").primaryXAxis.valueType=g.isStringSeries||n.isSeriesInRows?"Category":"Double")}return C.series}var I=n.id+"_overlay",E=this.parent.serviceLocator.getService("shape"),R=!t.isNullOrUndefined(e.isInitCell)&&e.isInitCell?e.range:d,N=E.insertOverlayElement(I,R,e.isChangeChartType?this.parent.activeSheetIndex:S(this.parent,R));N.element.classList.add("e-datavisualization-chart"),N.element.style.width=n.width+"px",N.element.style.height=n.height+"px",l&&(l.frozenRows||l.frozenColumns)?E.adjustFreezePaneSize(n,N.element,R):(t.isNullOrUndefined(n.top)?n.top=N.top:N.element.style.top=Number(ur(n.top).toFixed(2))+"px",t.isNullOrUndefined(n.left)?n.left=N.left:N.element.style.left=Number(ur(n.left).toFixed(2))+"px"),this.parent.notify("overlayEleSize",{height:n.height,width:n.width});var F="Pie"===n.type||"Doughnut"===n.type?{position:"Bottom",visible:!0}:{};t.isNullOrUndefined(n.legendSettings)||(F.visible=n.legendSettings.visible,F.position=n.legendSettings.position);var A=this.parent.createElement("div",{id:n.id,className:n.id}),k=n.theme||"Material",O=this.getAxisFormat(v),T=this.getAxisFormat(m),D=2*Math.round(parseFloat(getComputedStyle(N.element).borderWidth)),L=parseFloat(N.element.style.height)-(isNaN(D)?0:D)+"px";"Pie"!==n.type&&"Doughnut"!==n.type?(this.chart=new p.Chart({primaryXAxis:b,primaryYAxis:x,background:this.getThemeBgColor(k),chartArea:{border:{width:0}},title:n.title,legendSettings:F,theme:k,series:C.series,tooltip:{enable:!0,format:"${point.x} : <b>${point.tooltip}</b>"},width:N.element.style.width,height:L,enableRtl:this.parent.enableRtl,load:function(e){e.chart.theme=n.theme||"Material"},beforeResize:function(e){e.cancelResizedEvent=!0},axisLabelRender:function(e){"primaryYAxis"===e.axis.name&&O&&!n.type.includes("100")&&!t.isNullOrUndefined(e.value)&&r.parent?e.text=r.parent.getDisplayText({format:O,value:e.value.toString()}):"primaryXAxis"===e.axis.name&&e.text.startsWith("spread-chart-empty-label-")&&(e.text=""),"primaryXAxis"!==e.axis.name||"Scatter"!==n.type||g.isDateTime||(e.axis.labels.length>0&&!fe(e.text)?e.text=(e.axis.labels.indexOf(e.text)+1).toString():T&&!t.isNullOrUndefined(e.value)&&(e.text=r.parent.getDisplayText({format:T,value:e.value.toString()})))}}),this.chart.appendTo(A)):(this.chart=new p.AccumulationChart({title:n.title,legendSettings:F,theme:k,background:this.getThemeBgColor(k),series:C.series,width:N.element.style.width,height:L,center:{x:"50%",y:"50%"},tooltip:{enable:!0,format:"${point.x} : <b>${point.tooltip}</b>"},enableSmartLabels:!0,enableAnimation:!0,enableRtl:this.parent.enableRtl,load:function(e){e.chart.theme=n.theme||"Material"},beforeResize:function(e){e.cancelResizedEvent=!0}}),this.chart.appendTo(A)),N.element.appendChild(A),N.element.classList.contains("e-ss-overlay-active")&&!this.parent.isPrintingProcessing&&this.parent.notify("insertDesignChart",{id:N.element.id}),e.triggerEvent&&this.parent.notify(ci,{eventArgs:o,action:"insertChart"})}},e.prototype.deleteChart=function(e){this.clearBorder();var r=null,n=this.parent.getActiveSheet();if(t.isNullOrUndefined(e.id)?(r=document.querySelector(".e-datavisualization-chart.e-ss-overlay-active"),e.id=r?r.getElementsByClassName("e-control")[0].id:null):(e.id=e.id.includes("overlay")?e.id:e.id+"_overlay",r=document.getElementById(e.id)),!t.isNullOrUndefined(e.id)){e.id=e.id.includes("overlay")?e.id:e.id+"_overlay";for(var i,a,o,s,l=!1,d=0,h=this.parent.chartColl.length;d<h;d++)if(this.parent.chartColl[d].id===e.id.split("_overlay")[0]){s=this.parent.chartColl[d];break}var p={id:s.id,range:s.range,type:s.type,markerSettings:s.markerSettings,dataLabelSettings:s.dataLabelSettings,title:s.title,legendSettings:s.legendSettings,primaryXAxis:s.primaryXAxis,primaryYAxis:s.primaryYAxis,theme:s.theme,height:s.height,width:s.width,isSeriesInRows:s.isSeriesInRows,isInitCell:!0,posRange:null,top:s.top,left:s.left,cancel:!1};if(r){var u=void 0,f=void 0;if(n.frozenRows||n.frozenColumns){var m=r.getBoundingClientRect();u={clientY:m.top},f={clientX:m.left},m.top<this.parent.getColumnHeaderContent().getBoundingClientRect().bottom&&(u.target=this.parent.getColumnHeaderContent()),m.left<this.parent.getRowHeaderContent().getBoundingClientRect().right&&(f.target=this.parent.getRowHeaderTable())}else u={clientY:parseFloat(r.style.top),isImage:!0},f={clientX:parseFloat(r.style.left),isImage:!0};this.parent.notify("deleteChartColl",{id:e.id}),this.parent.notify(Ei,u),this.parent.notify(Ri,f),l=!0,i=u.clientY,a=f.clientX,n=this.parent.sheets[this.parent.activeSheetIndex]}else{this.parent.notify("deleteChartColl",{id:e.id});var v=e.range?e.range.lastIndexOf("!"):0,y=e.range&&v>0?Se(this.parent,e.range.substring(0,v)):this.parent.activeSheetIndex,C=c(e.range?v>0?e.range.substring(v+1):e.range:this.parent.getActiveSheet().selectedRange);i=C[0],a=C[1],n=this.parent.sheets[y]}var b=He(i,a,n);b&&(o=b.chart);for(var x=o?o.length:null,d=0;d<x;d++)e.id===o[d].id+"_overlay"&&(o.splice(d,1),x=o.length);l&&(document.getElementById(e.id).remove(),this.parent.notify("removeDesignChart",{})),Ue(i,a,n,{chart:o},!0),p.posRange=n.name+"!"+g(i,a),e.isUndoRedo||this.parent.notify(ci,{eventArgs:p,action:"deleteChart",isClearAction:e.clearAction})}},e.prototype.updateChartModel=function(e,r,n,i,a){var o=r;r=r;var s=this.parent.chartColl[i].id;if(!(a&&["PHAxes","PVAxes","PHAxisTitle","PVAxisTitle","GLMajorHorizontal","GLMajorVertical","GLMinorHorizontal","GLMinorVertical"].indexOf(e)>-1))for(var l=0,d=n.chart.length;l<d;l++)if(n.chart[l].id===s)switch(e){case"PHAxes":case"PHAxisTitle":t.isNullOrUndefined(n.chart[l].primaryXAxis)&&(n.chart[l].primaryXAxis={},this.parent.chartColl[i].primaryXAxis={}),"PHAxes"===e?(n.chart[l].primaryXAxis.visible=r.primaryXAxis.visible,this.parent.chartColl[i].primaryXAxis.visible=r.primaryXAxis.visible):"PHAxisTitle"===e&&(n.chart[l].primaryXAxis.title=r.primaryXAxis.title,this.parent.chartColl[i].primaryXAxis.title=r.primaryXAxis.title);break;case"PVAxes":case"PVAxisTitle":t.isNullOrUndefined(n.chart[l].primaryYAxis)&&(n.chart[l].primaryYAxis={},this.parent.chartColl[i].primaryYAxis={}),"PVAxes"===e?(n.chart[l].primaryYAxis.visible=r.primaryYAxis.visible,this.parent.chartColl[i].primaryYAxis.visible=r.primaryYAxis.visible):"PVAxisTitle"===e&&(n.chart[l].primaryYAxis.title=r.primaryYAxis.title,this.parent.chartColl[i].primaryYAxis.title=r.primaryYAxis.title);break;case"ChartTitleNone":case"ChartTitleAbove":n.chart[l].title=r.title,this.parent.chartColl[i].title=r.title;break;case"DLNone":case"DLCenter":case"DLInsideend":case"DLInsidebase":case"DLOutsideend":if(t.isNullOrUndefined(n.chart[l].dataLabelSettings)&&(n.chart[l].dataLabelSettings={},this.parent.chartColl[i].dataLabelSettings={}),"DLNone"===e)n.chart[l].dataLabelSettings.visible=!1,this.parent.chartColl[i].dataLabelSettings.visible=!1;else{n.chart[l].dataLabelSettings.visible=!0,this.parent.chartColl[i].dataLabelSettings.visible=!0;var h=void 0;h=a?"Outside"===o.series[0].dataLabel.position?"Outer":"Middle":r.series[0].marker.dataLabel.position,n.chart[l].dataLabelSettings.position=h,this.parent.chartColl[i].dataLabelSettings.position=h}break;case"GLMajorHorizontal":t.isNullOrUndefined(n.chart[l].primaryYAxis)&&(n.chart[l].primaryYAxis={},this.parent.chartColl[i].primaryYAxis={}),t.isNullOrUndefined(n.chart[l].primaryYAxis.majorGridLines)&&(n.chart[l].primaryYAxis.majorGridLines={},this.parent.chartColl[i].primaryYAxis.majorGridLines={}),n.chart[l].primaryYAxis.majorGridLines.width=r.primaryYAxis.majorGridLines.width,this.parent.chartColl[i].primaryYAxis.majorGridLines.width=r.primaryYAxis.majorGridLines.width;break;case"GLMajorVertical":t.isNullOrUndefined(n.chart[l].primaryXAxis)&&(n.chart[l].primaryXAxis={},this.parent.chartColl[i].primaryXAxis={}),t.isNullOrUndefined(n.chart[l].primaryXAxis.majorGridLines)&&(n.chart[l].primaryXAxis.majorGridLines={},this.parent.chartColl[i].primaryXAxis.majorGridLines={}),n.chart[l].primaryXAxis.majorGridLines.width=r.primaryXAxis.majorGridLines.width,this.parent.chartColl[i].primaryXAxis.majorGridLines.width=r.primaryXAxis.majorGridLines.width;break;case"GLMinorHorizontal":t.isNullOrUndefined(n.chart[l].primaryYAxis)&&(n.chart[l].primaryYAxis={},this.parent.chartColl[i].primaryYAxis={}),t.isNullOrUndefined(n.chart[l].primaryYAxis.minorGridLines)&&(n.chart[l].primaryYAxis.minorGridLines={},this.parent.chartColl[i].primaryYAxis.minorGridLines={}),n.chart[l].primaryYAxis.minorGridLines.width=r.primaryYAxis.minorGridLines.width,this.parent.chartColl[i].primaryYAxis.minorGridLines.width=r.primaryYAxis.minorGridLines.width;break;case"GLMinorVertical":t.isNullOrUndefined(n.chart[l].primaryXAxis)&&(n.chart[l].primaryXAxis={},this.parent.chartColl[i].primaryXAxis={}),t.isNullOrUndefined(n.chart[l].primaryXAxis.minorGridLines)&&(n.chart[l].primaryXAxis.minorGridLines={},this.parent.chartColl[i].primaryXAxis.minorGridLines={}),n.chart[l].primaryXAxis.minorGridLines.width=r.primaryXAxis.minorGridLines.width,this.parent.chartColl[i].primaryXAxis.minorGridLines.width=r.primaryXAxis.minorGridLines.width;break;case"LegendNone":case"LegendsRight":case"LegendsLeft":case"LegendsBottom":case"LegendsTop":if(t.isNullOrUndefined(n.chart[l].legendSettings)&&(n.chart[l].legendSettings={},this.parent.chartColl[i].legendSettings={}),n.chart[l].legendSettings.visible=r.legendSettings.visible,this.parent.chartColl[i].legendSettings.visible=r.legendSettings.visible,"LegendNone"!==e){n.chart[l].legendSettings.position=r.legendSettings.position,this.parent.chartColl[i].legendSettings.position=r.legendSettings.position;break}}},e.prototype.updateChartElement=function(e,t,r,n,i,a,o,s){if(!(a&&["PHAxes","PVAxes","PHAxisTitle","PVAxisTitle","GLMajorHorizontal","GLMajorVertical","GLMinorHorizontal","GLMinorVertical"].indexOf(e)>-1)){var l;switch(e){case"PHAxes":(t=t).primaryXAxis.visible=!t.primaryXAxis.visible;break;case"PVAxes":(t=t).primaryYAxis.visible=!t.primaryYAxis.visible;break;case"PHAxisTitle":(t=t).primaryXAxis.title=i;break;case"PVAxisTitle":(t=t).primaryYAxis.title=i;break;case"ChartTitleNone":t.title="";break;case"ChartTitleAbove":t.title=i;break;case"DLNone":case"DLCenter":case"DLInsideend":case"DLInsidebase":case"DLOutsideend":if(t=t,l=t.series,"DLNone"===e)for(var d=0,h=l.length;d<h;d++)a?l[d].dataLabel.visible=!1:l[d].marker.dataLabel.visible=!1;else for(var d=0,h=l.length;d<h;d++)if(a){p="DLOutsideend"===e?"Outside":"Inside";l[d].dataLabel.visible=!0,l[d].dataLabel.position=p}else{var p="DLCenter"===e?"Middle":"DLInsideend"===e?"Top":"DLInsidebase"===e?"Bottom":"DLOutsideend"===e?"Outer":l[0].marker.dataLabel.position;l[d].marker.dataLabel.visible=!0,l[d].marker.dataLabel.position=p}t.series=l,a&&t.refresh();break;case"GLMajorHorizontal":(t=t).primaryYAxis.majorGridLines.width=0===t.primaryYAxis.majorGridLines.width?1:0;break;case"GLMajorVertical":(t=t).primaryXAxis.majorGridLines.width=0===t.primaryXAxis.majorGridLines.width?1:0;break;case"GLMinorHorizontal":(t=t).primaryYAxis.minorTicksPerInterval=0===t.primaryYAxis.minorGridLines.width?5:0,t.primaryYAxis.minorGridLines.width=0===t.primaryYAxis.minorGridLines.width?1:0;break;case"GLMinorVertical":(t=t).primaryXAxis.minorTicksPerInterval=0===t.primaryXAxis.minorGridLines.width?5:0,t.primaryXAxis.minorGridLines.width=0===t.primaryXAxis.minorGridLines.width?1:0;break;case"LegendNone":t.legendSettings.visible=!1;break;case"LegendsRight":case"LegendsLeft":case"LegendsBottom":case"LegendsTop":t.legendSettings.visible=!0,t.legendSettings.position="LegendsRight"===e?"Right":"LegendsLeft"===e?"Left":"LegendsBottom"===e?"Bottom":"LegendsTop"===e?"Top":t.legendSettings.position}if(this.updateChartModel(e,t,r,n,a),s){var c={addChartEle:e,id:t.element.id+"_overlay",title:i,address:o};this.parent.notify(ci,{action:"chartDesign",eventArgs:c})}}},e.prototype.undoRedoForChartDesign=function(e){var r=document.getElementById(e.id);if(r){var n=this.getChartElement(r),i=t.getComponent(n,"chart");t.isNullOrUndefined(i)&&(i=t.getComponent(n,"accumulationchart"));for(var a,o=this.parent.getAddressInfo(e.address),s=He(o.indices[0],o.indices[1],Ae(this.parent,o.sheetIndex)),l=this.getChartCollectionId(n.id),d=e.addChartEle,h=e.title,p=0;p<e.beforeActionData.cellDetails[0].chart.length;p++)if(n.id===e.beforeActionData.cellDetails[0].chart[p].id){a=e.beforeActionData.cellDetails[0].chart[p];break}var c=!t.isNullOrUndefined(a.markerSettings)&&a.markerSettings.visible;if(e.switchRowColumn)this.switchRowColumn(l,n.id,i,s);else if(e.chartTheme)this.switchChartTheme(l,n.id,e.isUndo?a.theme:e.chartTheme,i,s);else if(e.chartType)this.switchChartType(l,n.id,e.isUndo?a.type:e.chartType,i,s,!1,e.isUndo?c:e.chartMarker,"undoRedo");else if(e.addChartEle){if(e.isUndo){var u=void 0;switch(d){case"DLNone":case"DLCenter":case"DLInsideend":case"DLInsidebase":case"DLOutsideend":d="Middle"===(u=a.dataLabelSettings&&a.dataLabelSettings.position)?"DLCenter":"Top"===u?"DLInsideend":"Bottom"===u?"DLInsidebase":"Outer"===u?"DLOutsideend":"DLNone";break;case"LegendNone":case"LegendsRight":case"LegendsLeft":case"LegendsBottom":case"LegendsTop":a.legendSettings&&!a.legendSettings.visible?u="LegendNone":d="Right"===(u=a.legendSettings&&a.legendSettings.position)?"LegendsRight":"Left"===u?"LegendsLeft":"Bottom"===u?"LegendsBottom":"Top"===u?"LegendsTop":"LegendsBottom";break;case"PVAxisTitle":h=a.primaryYAxis&&a.primaryYAxis.title;break;case"PHAxisTitle":h=a.primaryXAxis&&a.primaryXAxis.title;break;case"ChartTitleNone":case"ChartTitleAbove":h=a.title}}this.updateChartElement(d,i,s,l,h,null,e.address)}}},e.prototype.chartDesignTabHandler=function(e){var r=!1,n=this.parent.sheets[this.parent.activeSheetIndex],i=e.switchRowColumn,a=e.chartType,o=e.chartTheme,s=e.addChartEle,l=null,d=e.id?document.getElementById(e.id):document.querySelector(".e-datavisualization-chart.e-ss-overlay-active");if(d){var h,p,c="ChartTitleAbove"===s||"PHAxisTitle"===s||"PVAxisTitle"===s;if(n.frozenRows||n.frozenColumns){var u=d.getBoundingClientRect();h={clientY:u.top},p={clientX:u.left},u.top<this.parent.getColumnHeaderContent().getBoundingClientRect().bottom&&(h.target=this.parent.getColumnHeaderContent()),u.left<this.parent.getRowHeaderContent().getBoundingClientRect().right&&(p.target=this.parent.getRowHeaderTable())}else h={clientY:d.offsetTop,isImage:!0},p={clientX:d.offsetLeft,isImage:!0};this.parent.notify(Ei,h),this.parent.notify(Ri,p);var f=He(h.clientY,p.clientX,n),m=n.name+"!"+g(h.clientY,p.clientX);if(e.triggerEvent){b={switchRowColumn:e.switchRowColumn,chartType:e.chartType,chartTheme:e.chartTheme,addChartEle:e.addChartEle,id:d.id,address:m,cancel:!1};if(this.parent.notify(qr,{action:"chartDesign",eventArgs:b}),b.cancel)return}var v=this.getChartElement(d),y=v.getAttribute("id"),C=this.getChartCollectionId(y);if(v&&(l=t.getComponent(v,"chart"),t.isNullOrUndefined(l)&&(l=t.getComponent(v,"accumulationchart"),r=!0)),i&&this.switchRowColumn(C,y,l,f),a&&this.switchChartType(C,y,a,l,f,e.markerVisible),o&&this.switchChartTheme(C,y,o,l,f),s)if(c&&!e.title){if(this.parent.element.getElementsByClassName("e-title-dlg").length>0)return;this.titleDlgHandler(s,l,f,C,r,m,e.triggerEvent)}else this.updateChartElement(s,l,f,C,e.title,r);if(e.triggerEvent&&!c){var b={switchRowColumn:e.switchRowColumn,chartType:e.chartType,chartMarker:e.markerVisible,chartTheme:e.chartTheme,addChartEle:e.addChartEle,id:d.id,address:m};this.parent.notify(ci,{action:"chartDesign",eventArgs:b})}}},e.prototype.switchRowColumn=function(e,r,n,i){var a=this.parent.chartColl[e];a.isSeriesInRows=!!t.isNullOrUndefined(a.isSeriesInRows)||!a.isSeriesInRows;for(var o=0,s=i.chart.length;o<s;o++)i.chart[o].id===r&&(i.chart[o].isSeriesInRows=a.isSeriesInRows);var l=this.initiateChartHandler({option:a,isRefresh:!0,isSwitchRowColumn:!0});n.series=l},e.prototype.switchChartTheme=function(e,t,r,n,i){this.parent.chartColl[e].theme=r;for(var a=0,o=i.chart.length;a<o;a++)i.chart[a].id===t&&(i.chart[a].theme=r);n.setProperties({theme:r,background:this.getThemeBgColor(r)},!0),n.refresh()},e.prototype.getThemeBgColor=function(e){var t;if(e.includes("Dark"))switch(e){case"MaterialDark":t="#383838";break;case"FabricDark":t="#242424";break;case"BootstrapDark":t="#1b1b1b";break;case"Bootstrap5Dark":t="#212529";break;case"TailwindDark":t="#1f2937";break;case"Tailwind3Dark":t="#111827";break;case"FluentDark":t="#1b1a19";break;case"Fluent2Dark":t="#292929";break;case"Material3Dark":t="#1C1B1F"}else t=e.includes("HighContrast")?"#000000":"#FFFFFF";return t},e.prototype.switchChartType=function(e,r,n,i,a,o,s,l){var d=this.parent.chartColl[e].type;this.parent.chartColl[e].type=n;for(var h=0,p=a.chart.length;h<p;h++)a.chart[h].id===r&&(a.chart[h].type=n,t.isNullOrUndefined(a.chart[h].markerSettings)||(a.chart[h].markerSettings.visible=o));if("Pie"!==n&&"Doughnut"!==n)if("Pie"===d||"Doughnut"===d)t.isNullOrUndefined(this.parent.chartColl[e].markerSettings)?!o||"Line"!==n&&"StackingLine"!==n&&"StackingLine100"!==n||(this.parent.chartColl[e].markerSettings={shape:"Circle",visible:!0,isFilled:!1}):this.parent.chartColl[e].markerSettings.visible=o||"undoRedo"===l&&s,this.changeCharType(e);else{if(d!==n)if("Scatter"===n){var c=i.primaryXAxis.labels;c&&c.length>0&&fe(c[c.length-1])&&(i.primaryXAxis.valueType="Double")}else"Double"===i.primaryXAxis.valueType&&(i.primaryXAxis.valueType="Category");for(var u=i.series,f="Line"===n||"StackingLine"===n||"StackingLine100"===n,h=0,g=u.length;h<g;h++)u[h].type=n,f?(u[h].marker.visible=o,u[h].marker.shape=t.isNullOrUndefined(u[h].marker.shape)?"Circle":u[h].marker.shape,"undoRedo"===l&&(u[h].marker.visible=s)):u[h].marker.visible=!1;i.series=u,i.refresh()}else if("Pie"===d||"Doughnut"===d){for(var h=0,g=(u=i.series).length;h<g;h++)u[h].innerRadius="Pie"===n?"0%":"40%";i.series=u,i.refresh()}else this.changeCharType(e)},e.prototype.getChartElement=function(e){var r=e.querySelector(".e-chart");return t.isNullOrUndefined(r)&&(r=e.querySelector(".e-accumulationchart")),r},e.prototype.getChartCollectionId=function(e){for(var t,r=0,n=this.parent.chartColl.length;r<n;r++)e===this.parent.chartColl[r].id&&(t=r);return t},e.prototype.changeCharType=function(e){var r=document.getElementById(this.parent.chartColl[e].id),n=t.closest(r,".e-datavisualization-chart");n.remove(),this.initiateChartHandler({option:this.parent.chartColl[e],isInitCell:!1,triggerEvent:!1,isPaste:!1,isChangeChartType:!0}),r=document.getElementById(this.parent.chartColl[e].id),(n=t.closest(r,".e-datavisualization-chart")).classList.contains("e-ss-overlay-active")||n.classList.add("e-ss-overlay-active")},e.prototype.titleDlgHandler=function(e,t,r,n,i,a,o){var s=this,l="";if(!i||"PHAxisTitle"!==e&&"PVAxisTitle"!==e){var d=this.parent.serviceLocator.getService(Na),h=this.parent.serviceLocator.getService(Fa);h.show({width:375,showCloseIcon:!0,isModal:!0,cssClass:"e-title-dlg",header:"chart_abovechart"===e?d.getConstant("ChartTitle"):"PHAxisTitle"===e?d.getConstant("HorizontalAxisTitle"):d.getConstant("VerticalAxisTitle"),beforeOpen:function(){h.dialogInstance.content=s.titleDlgContent(e,t),h.dialogInstance.dataBind(),s.parent.element.focus()},buttons:[{buttonModel:{content:d.getConstant("Ok"),isPrimary:!0,cssClass:"e-btn e-clearall-btn e-flat"},click:function(){var i=s.parent.element.querySelector(".e-title-dlg").getElementsByClassName("e-title-dlg-content")[0];l=i.getElementsByTagName("input")[0].value,h.hide(),s.updateChartElement(e,t,r,n,l,null,a,o)}}]}),h.dialogInstance.refresh()}},e.prototype.titleDlgContent=function(e,t){var r=this.parent.serviceLocator.getService(Na),n=this.parent.createElement("div",{className:"e-title-dlg-content"}),i=this.parent.createElement("span",{className:"e-header e-top-header"});i.innerText=r.getConstant("EnterTitle");var a=this.parent.createElement("input",{className:"e-input",id:"titleInput",attrs:{type:"text"}});return n.appendChild(i),n.appendChild(a),t&&(a.value="PHAxisTitle"===e?t.primaryXAxis.title?t.primaryXAxis.title:a.value:"PVAxisTitle"===e?t.primaryYAxis.title?t.primaryYAxis.title:a.value:t.title?t.title:a.value),n},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("initiateChart",this.initiateChartHandler),this.parent.off(ki,this.refreshChartCellObj),this.parent.off("refreshChartCellOnInit",this.refreshChartCellModel),this.parent.off("refreshChartCellModel",this.refreshChartCellModel),this.parent.off(Ai,this.deleteChart),this.parent.off("clearChartBorder",this.clearBorder),this.parent.off("insertChart",this.insertChartHandler),this.parent.off("chartRangeSelection",this.chartRangeHandler),this.parent.off(Oi,this.chartDesignTabHandler),this.parent.off("addChartEle",this.updateChartElement),this.parent.off("undoRedoForChartDesign",this.undoRedoForChartDesign),this.parent.off("refreshChart",this.refreshChartData))},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null;var e=null;this.chart&&(e=this.chart.element,this.chart.destroy()),e&&t.detach(e),this.chart=null},e.prototype.getModuleName=function(){return"spreadsheetChart"},e}(),Ho=function(){function e(e){this.totalSheetCount=[],this.workbookActiveSheetCount=0,this.defaultCellWidth=64,this.defaultCellHeight=19,this.pageCounts=[],this.initialRowCount=0,this.chartHeight=0,this.columnIndex=0,this.rowIndex=0,this.multipleCanvasDataURL=[],this.chartElements=[],this.totalCharts=0,this.isChartLoaded=!1,this.chartLoadedCount=0,this.isImageLoaded=!1,this.totalImages=0,this.imageLoadedCount=0,this.endRow=0,this.isColumn=!0,this.startNewPageCount=0,this.allowTimer=!1,this.parent=e}return e.prototype.print=function(e,r){var n=this;if(e.isPrintingProcessing=!0,this.multipleCanvasDataURL=[],this.chartElements=[],"ActiveSheet"===r.type){a=e.sheets[e.activeSheetIndex];this.activeSheetPrint(e,a,r,e.activeSheetIndex)}else{this.totalSheetCount=[],this.workbookActiveSheetCount=1;for(var i=0;i<e.sheets.length;i++)if("Visible"===e.sheets[i].state&&(this.totalSheetCount.push(i),this.totalSheetCount.length>1&&this.parent.sheets[i].ranges.length>0&&this.parent.sheets[i].ranges.some(function(e){return!t.isNullOrUndefined(e.dataSource)}))){this.allowTimer=!0;var a=e.sheets[i],o=y(g(0,0)+":"+g(a.rowCount-1,a.colCount-1));this.parent.notify(_r,{sheet:a,indexes:o})}this.allowTimer?(this.allowTimer=!1,setTimeout(function(){n.activeSheetPrint(e,e.sheets[n.totalSheetCount[0]],r,n.totalSheetCount[0])},2e3)):this.activeSheetPrint(e,e.sheets[this.totalSheetCount[0]],r,this.totalSheetCount[0])}},e.prototype.updateChartRowAndColumnIndices=function(e,t){var r=e.sheets[t];if(this.rowIndex=r.usedRange.rowIndex,this.columnIndex=r.usedRange.colIndex,e.chartColl.length>0)for(var n=0;n<e.chartColl.length;n++){var i=e.chartColl[n];if(t===Se(e,i.range.substring(0,i.range.lastIndexOf("!")))){var a={clientX:i.left,isImage:!0},o={clientY:i.top,isImage:!0};e.notify(Ei,o),e.notify(Ri,a),o.clientY>r.usedRange.rowIndex&&(this.rowIndex=Math.max(this.rowIndex,o.clientY)),a.clientX>r.usedRange.colIndex&&(this.columnIndex=Math.max(this.columnIndex,a.clientX))}}},e.prototype.activeSheetPrint=function(e,t,r,n){this.updateChartRowAndColumnIndices(e,n),this.pageCounts=this.calculatePageCount(t,1e3,r.allowRowColumnHeader);this.initialRowCount=0,this.parent.currentPrintSheetIndex=n,this.endRow=this.rowIndex+1,this.processCell(0,0,this.endRow,2,[],void 0,void 0,t,this,0,0,!0,n,r)},e.prototype.processCell=function(e,r,n,i,a,o,s,l,d,h,p,c,u,f){var g=this;void 0===h&&(h=0),void 0===p&&(p=0),void 0===c&&(c=!0);var m=f.allowRowColumnHeader,y=0;this.chartHeight=0;for(var C=e;C<this.pageCounts.length;C++){this.chartLoadedCount=0,this.totalCharts=0,this.imageLoadedCount=0,this.totalImages=0,h+=0===C?0:1100,s=document.createElement("canvas"),o=s.getContext("2d"),s.width=1e3,s.height=1100,o.font="11pt Calibri",o.textBaseline="bottom",o.index=C,o.width=1e3,(c||!this.isImageLoaded&&!this.isChartLoaded)&&(a=[],i=0,p=0);for(var b=r;b<this.endRow;b++){c=!0;var x=!1;this.isColumn=this.isColumn?this.isColumn:0===b;var S={borderBottom:"1px solid black"},w=l.rows[b]&&l.rows[b].height||this.defaultCellHeight;this.initialRowCount=b,i=0;var I=0===C?0:this.pageCounts[C-1]+1,E=this.pageCounts[C];p+=t.isNullOrUndefined(l.rows[b])?this.defaultCellHeight:w+(0===b&&m?this.defaultCellHeight:0);var R=t.isNullOrUndefined(l.rows[b])?this.defaultCellHeight:l.rows[b]&&l.rows[b].height||this.defaultCellHeight;if(p>1080){if(this.startNewPageCount=b,y=m?w+(0===b&&m?this.defaultCellHeight:0):0,x=!1,this.isColumn=!0,this.isImageLoaded||this.isChartLoaded)break;h+=1100,c&&this.multipleCanvasDataURL.push(s.toDataURL()),c=!0,s=document.createElement("canvas"),o=s.getContext("2d"),s.width=1e3,s.height=1100,o.font="11pt Calibri",o.textBaseline="bottom",o.index=C,o.width=1e3;for(T=0;T<a.length;T++)void 0!==a[T]&&(a[T]-=p-R);p=m||f.allowGridLines?w+(m?this.defaultCellHeight:0):w}var N={borderBottom:"1px solid black",borderTop:"1px solid black",borderLeft:"1px solid black",borderRight:"1px solid black"},F={borderRight:"1px solid black"};if(m&&this.isColumn)for(j=I;j<=E;j++){var A=v(j+1),O=j===I?2:1;o.font="11pt Calibri";for(var T=0;T<O;T++){var D=0===T&&2===O?37:l.columns[j]&&l.columns[j].hidden?0:l.columns[j]&&l.columns[j].width||this.defaultCellWidth;if(0!==(D=i+D>1e3?D-1-(i+D-1e3):D)){var L=o.measureText(A).width,P=d.calculateTextPosition(L,D,i,"Center"),M=this.defaultCellHeight;o.fillText(j===I&&0===T?"":A,P,M),d.drawBorder(o,N,i,0,D,this.defaultCellHeight),i+=D,a[j]=this.defaultCellHeight,j===E&&(2===O?1===T:0===T)&&(this.isColumn=!(j===E),i=0)}else j===E&&(this.isColumn=!1,i=0)}}if(t.isNullOrUndefined(l.rows[b])||!t.isNullOrUndefined(l.rows[b].hidden)&&l.rows[b].hidden){if(t.isNullOrUndefined(l.rows[b])){var B={borderBottom:"1px solid black",borderTop:"1px solid black",borderLeft:"1px solid black",borderRight:"1px solid black"};x=p+R+(0===b&&m?this.defaultCellHeight:0)>1080||b===l.rows.length-1||b===this.endRow-1;for(j=I;j<=E;j++){var H=l.rows[b]&&!t.isNullOrUndefined(l.rows[b].cells)&&l.rows[b].cells[j];t.isNullOrUndefined(H)||t.isNullOrUndefined(H.style)||(B=this.setBorderStyle(H,B)),m&&j===I&&(d.rowHeaderText((b+1).toString(),o,d,37,i,B,a[j],this.defaultCellHeight),i+=37);var U=l.columns[j]&&l.columns[j].width||this.defaultCellWidth;U=i+U>1e3?U-1-(i+U-1e3):U,a[j]=isNaN(a[j])?0:a[j],f.allowGridLines?d.drawBorder(o,B,i,a[j],U,R):m&&!f.allowGridLines&&j===E&&d.drawBorder(o,{borderRight:"1px solid black"},i,a[j],U,R),i+=U,j===E&&m&&x&&(d.drawBorder(o,S,0,a[j],i,R),x=!1),a[j]+=R}}}else{x=this.endRow===l.rows.length&&(p+(l.rows[b+1]?l.rows[b+1].height||this.defaultCellHeight:this.defaultCellHeight)+(0===b&&m?this.defaultCellHeight:0)>1080||b===l.rows.length-1);for(var V,z=this,j=I;j<=E;j++)!function(e){var r=l.rows[b]&&!t.isNullOrUndefined(l.rows[b].cells)&&l.rows[b].cells[e];if(t.isNullOrUndefined(r)||t.isNullOrUndefined(r.style)||(N=z.setBorderStyle(r,N)),t.isNullOrUndefined(l.columns[e])||t.isNullOrUndefined(l.columns[e].hidden)||!l.columns[e].hidden){var n,c,A=!t.isNullOrUndefined(l.rows[b].cells)&&!t.isNullOrUndefined(l.rows[b].cells[e])&&!isNaN(l.rows[b].cells[e].colSpan)&&I>e+l.rows[b].cells[e].colSpan,O=!(t.isNullOrUndefined(l.rows[b].cells)||t.isNullOrUndefined(l.rows[b].cells[e])||isNaN(l.rows[b].cells[e].rowSpan)||b+l.rows[b].cells[e].rowSpan>z.startNewPageCount||0===z.startNewPageCount),T="",D=t.isNullOrUndefined(r)?1:isNaN(r.rowSpan)||A||O?1:Math.max(r.rowSpan,0);if(a[e]=isNaN(a[e])?0:a[e],m&&e===I){o.font="11pt Calibri";fe=a[e];if(D>0)for(_=0;_<(0===D?1:D);_++)i=0,fe+=0===_?0:l.rows[b+_]&&l.rows[b+_-1].height||z.defaultCellHeight,d.rowHeaderText((b+1+_).toString(),o,d,37,i,N,fe,l.rows[b+_].height||z.defaultCellHeight),i+=37;else i=0,i+=37}if(!t.isNullOrUndefined(r)&&r){var L=r.style?r.style.fontSize||"11pt":"11pt",P=r.style?r.style.color||"#000000":"#000000";if(!isNaN(l.rows[b].cells[e].rowSpan)&&l.rows[b].cells[e].rowSpan>1&&isNaN(l.rows[b+1].cells[e].rowSpan)&&z.parent.merge(""+v(e+1)+(b+1)+":"+v(e+1)+(b+l.rows[b].cells[e].rowSpan-1)),!isNaN(l.rows[b].cells[e].colSpan)&&l.rows[b].cells[e].colSpan>1)if(!t.isNullOrUndefined(l.rows[b+1])&&!t.isNullOrUndefined(l.rows[b+1].cells)&&l.rows[b+1].cells.length>0&&!t.isNullOrUndefined(l.rows[b+1].cells[e])&&isNaN(l.rows[b+1].cells[e].colSpan))z.parent.merge(""+v(e+1)+(b+1)+":"+v(e+1+l.rows[b].cells[e].colSpan-1)+(b+1));else if(t.isNullOrUndefined(l.rows[b].cells[e+1].colSpan))for(ce=1;ce<l.rows[b].cells[e].colSpan;ce++)l.rows[b].cells[e+ce].colSpan=-ce;if(n=isNaN(l.rows[b].cells[e].colSpan)||A?1:Math.max(l.rows[b].cells[e].colSpan,0),l.rows[b].cells[e].rowSpan&&!A&&l.rows[b].cells[e].rowSpan<0){var M=l.rows[b+l.rows[b].cells[e].rowSpan].cells[e].colSpan;n=M||n}(e===I||e>0&&l.columns&&l.columns[e-1]&&l.columns[e-1].hidden&&l.rows[b].cells[e-1]&&l.rows[b].cells[e-1].colSpan>1)&&n<=0&&(n=1);var B=r.style?r.style.backgroundColor||"#ffffff":"#ffffff",H=r.style?r.style.textAlign:"";o.font=L,o.fillStyle=P;var U=[];if(n>1){for(var j=l.columns.slice(e,e+n),_=0;_<j.length;_++)U.push(j.hidden?0:j[_]&&j[_].width||z.defaultCellWidth);0===U.length?U.push(z.defaultCellWidth*n):U.length!==n&&(U=U.map(function(e){return e+g.defaultCellWidth*(n-1-U.length)}))}c=n>1?U.reduce(function(e,t){return e+t},0):1===n?l.columns[e]&&l.columns[e].width||z.defaultCellWidth:0,c=i+c>1e3?c-1-(i+c-1e3):c,R=D>1?l.rows.slice(b,b+D).map(function(e){return e.height||g.defaultCellHeight}).reduce(function(e,t){return e+(t||g.defaultCellHeight)},0):1===D?w:0;var q=(r.style?r.style.verticalAlign||"Bottom":"Bottom").toLowerCase();if(!t.isNullOrUndefined(r.image)&&r.image.length>0&&z.processImages(C,b,r,s,o,p,z.endRow,w,y,m,f,l,d,i,a,h,u),!t.isNullOrUndefined(r.chart)&&r.chart.length>0&&z.handleCharts(C,b,r,o,s,p,z.endRow,z.initialRowCount,y,w,m,f,l,d,z.multipleCanvasDataURL,i,a,h,u),t.isNullOrUndefined(r.value)&&t.isNullOrUndefined(r.formula)&&t.isNullOrUndefined(r.hyperlink))d.rowHeaderRect(o,i,a[e],c,R,B);else{var W;if(r.formula&&r.format){"Automatic"===z.parent.calculationMode&&z.parent.notify(Kr,{action:"refreshCalculate",rowIndex:b,colIndex:e,value:r.formula,isFormula:k(r.formula),sheetIndex:u});G={value:r.value,format:r.format,rowIndex:b,colIndex:e,sheetIndex:z.parent.activeSheetIndex,cell:r,refresh:!0};T=z.parent.workbookNumberFormatModule.getFormattedCell(G),W=""+(H||(G.isRightAlign?"Right":"Left"))}else if(r.format){var G={value:r.value,format:r.format,rowIndex:b,colIndex:e,sheetIndex:z.parent.activeSheetIndex,cell:r,refresh:!0};T=z.parent.workbookNumberFormatModule.getFormattedCell(G),W=""+(H||(G.isRightAlign?"Right":"Left"))}else if(r.formula)"Automatic"===z.parent.calculationMode&&z.parent.notify(Kr,{action:"refreshCalculate",rowIndex:b,colIndex:e,value:r.formula,isFormula:k(r.formula),sheetIndex:u}),T=r.value,W=""+(H||"Left");else{t.isNullOrUndefined(r.hyperlink)||(t.isNullOrUndefined(r.value)?r.value=t.isNullOrUndefined(r.hyperlink)||"object"!=typeof r.hyperlink?r.hyperlink||r.hyperlink.address:r.hyperlink.address:(t.isNullOrUndefined(r.value)||""===r.value)&&(r.value="object"==typeof r.hyperlink?r.hyperlink.address:r.hyperlink),P=r.style?r.style.color||"#00e":"#00e"),T=r.value;var Y=!t.isNullOrUndefined(r.value)&&""!==r.value&&new RegExp("^[^\\p{L}]*$","u").test(r.value);W=""+(H||(Y?"Right":"Left"))}var X=r.style?r.style.fontSize||"11pt":"11pt",K=r.style?r.style.fontFamily||"Calibri":"Calibri",$=r.style?r.style.fontStyle||"":"",Z=r.style?r.style.fontWeight||"normal":"normal";o.font=$+" "+Z+" "+X+" "+K;var J=o.measureText(T),Q=J.width,ee=J.actualBoundingBoxAscent+J.actualBoundingBoxDescent;if(r.wrap){var te=z.defaultCellHeight<R?parseInt(X.replace("pt",""),10)/72*96:R,re=r.colSpan>1?e+r.colSpan-1:e,ne=Vt(dt(l,e,re)-(4+(er(b,e,l)||1)),!0),ie=z.wrapText(T,ne,r.style,z.parent.cellStyle),ae=1===ie.length?R:ie.length*te===R?te:ie.length*te<R?R-(ie.length-1)*te:te,oe=a[e]+("top"===q?te:"middle"===q&&ae>te+ae/4?te+ae/4:ae);o.save(),o.beginPath(),o.rect(i,a[e],c,R),o.clip(),o.fillStyle=B,o.fillRect(i,a[e],c,R+("top"===q?te:0)),ie.forEach(function(e,t){o.fillStyle=P,J=o.measureText(e),Q=J.width;var n=d.calculateTextPosition(Q,c,i,W,!0),a=oe+t*te;"right"===W.toLowerCase()?(o.textAlign="right",o.fillText(e.trim(),n,a)):o.fillText(e,n,a),d.textDecoration(r,o,n,a,P,J,T,c)}),o.restore()}else{o.save(),o.beginPath(),o.rect(i,a[e],c,R),o.clip(),o.fillStyle=B,o.fillRect(i,a[e],c,R),o.fillStyle=P;var se=d.calculateTextPosition(Q,c,i,W),le=a[e],de=R/2+ee/2;"top"===q?o.textBaseline="top":le+="middle"===q&&R>de?de:R,t.isNullOrUndefined(r.style)||(le=!t.isNullOrUndefined(r.style.borderBottom)&&r.style.borderBottom.indexOf("double")>-1||!t.isNullOrUndefined(r.style.borderTop)&&r.style.borderTop.indexOf("double")>-1?le-2:le,se=!t.isNullOrUndefined(r.style.borderLeft)&&r.style.borderLeft.indexOf("double")>-1||!t.isNullOrUndefined(r.style.borderRight)&&r.style.borderRight.indexOf("double")>-1?se+("Left"===W?2:-3):se),o.fillText(T,se,le),o.restore(),d.textDecoration(r,o,se,le,P,J,T,c)}}r.style&&(c>0||R>0)&&(r.style.borderBottom||r.style.borderTop||r.style.borderLeft||r.style.borderRight&&(t.isNullOrUndefined(r.rowSpan)&&t.isNullOrUndefined(r.colSpan)||!t.isNullOrUndefined(r.rowSpan)&&r.rowSpan>0||!t.isNullOrUndefined(r.colSpan)&&r.colSpan>0))&&d.drawBorder(o,r.style,i,a[e]<=0?2:a[e],c,R)}var he=n<=0?c:c||l.columns[e]&&l.columns[e].width||z.defaultCellWidth;f.allowGridLines&&(N.borderRight=e===E&&m?void 0:"1px solid black",d.drawBorder(o,N,i,a[e],he,R)),i+=he;var pe=0;if(D>1){pe=a[e];for(var ce=e;ce<e+n;ce++){var ue=l.rows[b]&&!t.isNullOrUndefined(l.rows[b].cells)&&l.rows[b].cells[ce];ue&&!t.isNullOrUndefined(ue.image)?z.processImages(C,b,ue,s,o,p,z.endRow,w,y,m,f,l,d,i,a,h,u):ue&&!t.isNullOrUndefined(ue.chart)&&z.handleCharts(C,b,ue,o,s,p,z.endRow,z.initialRowCount,y,w,m,f,l,d,z.multipleCanvasDataURL,i,a,h,u),ue.style&&ce===e&&R>0&&(ue.style.borderBottom||ue.style.borderTop||ue.style.borderLeft||ue.style.borderRight)&&d.drawBorder(o,ue.style,i,a[e],2,R),a[ce]=(isNaN(a[ce])?0:a[ce])+R}e+=n-1}e===E&&m&&d.drawBorder(o,F,i-2,a[e]-pe,2,R),e===E&&m&&x&&(d.drawBorder(o,S,0,a[e]-pe,i,R),x=!1),D<=1&&(a[e]+=R)}else if(m&&e===I){D=t.isNullOrUndefined(r)?1:isNaN(l.rows[b].cells[e].rowSpan)?1:Math.max(l.rows[b].cells[e].rowSpan,0);a[e]=isNaN(a[e])?0:a[e];var fe=a[e];o.font="11pt Calibri";for(_=0;_<D;_++)i=0,fe+=0===_?0:l.rows[b+_]&&l.rows[b+_-1].height||z.defaultCellHeight,d.rowHeaderText((b+1+_).toString(),o,d,37,i,N,fe,l.rows[b+_].height||z.defaultCellHeight),i+=37;a[e]+=R}V=e}(j),j=V}}if(this.isImageLoaded||this.isChartLoaded){if(this.isImageLoaded||this.isChartLoaded)break}else c&&this.endRow>0&&this.multipleCanvasDataURL.push(s.toDataURL()),r=0,this.pageCounts.length-1===C&&d.canvasPrint(this.parent,u,f)}},e.prototype.setBorderStyle=function(e,r){return r.borderBottom=t.isNullOrUndefined(e.style.borderBottom)?r.borderBottom:e.style.borderBottom,r.borderTop=t.isNullOrUndefined(e.style.borderTop)?r.borderTop:e.style.borderTop,r.borderRight=t.isNullOrUndefined(e.style.borderRight)?r.borderRight:e.style.borderRight,r.borderLeft=t.isNullOrUndefined(e.style.borderLeft)?r.borderLeft:e.style.borderLeft,r},e.prototype.setToDefault=function(){this.parent.currentPrintSheetIndex=0,this.initialRowCount=0,this.chartHeight=0,this.totalCharts=0,this.totalImages=0,this.chartLoadedCount=0,this.imageLoadedCount=0,this.endRow=0,this.pageCounts=[],this.multipleCanvasDataURL=[],this.chartElements=[],this.isChartLoaded=!1,this.isImageLoaded=!1,this.startNewPageCount=0},e.prototype.handleCharts=function(e,r,n,i,a,o,s,l,d,h,p,c,u,f,g,m,v,y,C){var b=this;if(!t.isNullOrUndefined(n.chart))for(var x=this,S=0,w=n.chart;S<w.length;S++)!function(n){x.totalCharts+=1;var s=new Image;n.left=t.isNullOrUndefined(n.left)?0:n.left,n.top=t.isNullOrUndefined(n.top)?0:n.top;var l=document.getElementById(n.id);if(t.isNullOrUndefined(l)&&(x.parent.insertChart([n]),l=document.getElementById(n.id),x.chartElements.push(n.id+"_overlay")),!t.isNullOrUndefined(l)){if(x.chartHeight=n.height,x.initialRowCount+Math.ceil(n.height/19)>x.endRow&&(c.allowRowColumnHeader||c.allowGridLines)&&u.rows.length-1===r){var S=h+(p?x.defaultCellHeight:0);a.height>o+(x.chartHeight-S)?x.endRow+=Math.ceil((x.chartHeight-S)/19):x.endRow+=Math.ceil((a.height-(o+S))/19)}var w=l.cloneNode(!0),I=window.URL.createObjectURL(new Blob([(new XMLSerializer).serializeToString(w.childNodes[1])],{type:"image/svg+xml"}));s.onload=function(){var t=Math.ceil(n.left/1e3)-1,r=Math.ceil(n.top/1080)-1,l=n.left+(p?37:0),h=n.top+(p?19:0)+(r>0?d:0);if(i.drawImage(s,t<=0?l:l-1e3*t,r<=0?h:h-1160*r,n.width,n.height),++b.chartLoadedCount===b.totalCharts&&(m+=n.width,b.isChartLoaded=!1,!b.isImageLoaded)){g.push(a.toDataURL());var x=b.initialRowCount===u.rows.length-1&&o<1080?u.rows.length:b.initialRowCount,S=b.endRow;b.processCell(e,x+1===S?S:x,S,m,v,i,a,u,f,y,o,!1,C,c)}},s.src=I,x.isChartLoaded=!0}}(w[S])},e.prototype.processImages=function(e,r,n,i,a,o,s,l,d,h,p,c,u,f,g,m,v){var y=this;if(!t.isNullOrUndefined(n.image)){for(var C=this,b=0,x=n.image;b<x.length;b++)!function(n){C.totalImages+=1;var s=new Image;if(s.src=n.src,n.left=t.isNullOrUndefined(n.left)?0:n.left,n.top=t.isNullOrUndefined(n.top)?0:n.top,C.chartHeight=n.height,C.initialRowCount+Math.ceil(n.height/19)>C.endRow&&(p.allowRowColumnHeader||p.allowGridLines)&&r===c.rows.length-1){var b=l+(h?C.defaultCellHeight:0);i.height>o+(C.chartHeight-b)?C.endRow+=Math.ceil((C.chartHeight-b)/19):C.endRow+=Math.ceil((i.height-(o+b))/19)}s.onload=function(){var t=Math.ceil(n.left/1e3)-1,r=Math.ceil(n.top/1080)-1,l=n.left+(h?37:0),C=n.top+(h?19:0)+(r>0?d:0);if(a.drawImage(s,t<=0?l:l-1e3*t,r<=0?C:C-1160*r,n.width,n.height),++y.imageLoadedCount===y.totalImages&&(y.isImageLoaded=!1,f+=n.width,!y.isChartLoaded)){y.multipleCanvasDataURL.push(i.toDataURL());var b=y.initialRowCount===c.rows.length-1&&o<1080?c.rows.length:y.initialRowCount,x=y.endRow;y.processCell(e,b+1===x?x:b,x,f,g,a,i,c,u,m,o,!1,v,p)}},s.onerror=function(){if(++y.imageLoadedCount===y.totalImages&&(y.isImageLoaded=!1,!y.isChartLoaded)){y.multipleCanvasDataURL.push(i.toDataURL());var t=y.initialRowCount===c.rows.length-1&&o<1080?c.rows.length:y.initialRowCount,r=y.endRow;y.processCell(e,t+1===r?r:t,r,f,g,a,i,c,u,m,o,!1,v,p)}}}(x[b]);this.isImageLoaded=!0}},e.prototype.textDecoration=function(e,r,n,i,a,o,s,l){""!==s&&(!t.isNullOrUndefined(e.style)&&!t.isNullOrUndefined(e.style.textDecoration)&&e.style.textDecoration.toLowerCase().indexOf("underline")>-1||!t.isNullOrUndefined(e.hyperlink))&&(r.beginPath(),r.moveTo(n,i-3),r.lineTo(n+(o.width>l?l:o.width),i-3),r.strokeStyle=a,r.lineWidth=1,r.stroke())},e.prototype.rowHeaderRect=function(e,t,r,n,i,a){void 0===a&&(a="#ffffff"),e.save(),e.beginPath(),e.rect(t,r,n,i),e.clip(),e.fillStyle=a,e.fillRect(t,r,n,i),e.restore()},e.prototype.rowHeaderText=function(e,t,r,n,i,a,o,s){var l=t.measureText(e).width,d=r.calculateTextPosition(l,n,i,"Center"),h=o;t.save(),t.beginPath(),t.rect(i,o,n,s),t.clip(),t.fillStyle="#000000",t.fillText(e,d,h+s),r.drawBorder(t,a,i,o||0,n,s),t.restore()},e.prototype.canvasPrint=function(e,r,n){var i=this;if("Workbook"===n.type&&this.totalSheetCount.length-1>=this.workbookActiveSheetCount){var a=this.totalSheetCount[this.workbookActiveSheetCount],o=e.sheets[a];this.workbookActiveSheetCount++,this.activeSheetPrint(e,o,n,a)}else{for(var s=0;s<this.chartElements.length;s++){var l=document.getElementById(this.chartElements[s]);t.isNullOrUndefined(l)||l.remove()}if(this.multipleCanvasDataURL.length>0){var d=navigator.userAgent,h=window.open(" ","_blank","height="+window.outerHeight+",width="+window.outerWidth+",tabbar=no");h.document.write("<html><head><title></title></head><body>");-1!==d.indexOf("Chrome")||-1!==d.indexOf("Safari")||-1!==d.indexOf("Firefox")?(h.document.write("<!DOCTYPE html>"),h.document.write("<html><head><style>html, body {  } img { height: 100%; width: 100%; display: block; }@media print { body {  } img { width:100%; width:100%; box-sizing: border-box; }br, button { display: none; } div{ page-break-inside: avoid; }} @page{ size:"+1e3.toString()+"px "+1400..toString()+"px; }</style></head><body>")):(h.document.write("<!DOCTYPE html>"),h.document.write("<html><head><style>html, body {  } img { height: 100%; width: 100%; }@media print { body {  }img { width:100%; width:100%; box-sizing: border-box; }br, button { display: none; } div{ page-break-inside: avoid; }} @page{ size:"+1e3.toString()+"px "+1400..toString()+"px; }</style></head><body>")),this.multipleCanvasDataURL.forEach(function(t,r){var n=h.document.createElement("canvas");n.width=1e3,n.height=1400;var a=n.getContext("2d"),o=new Image;o.onload=function(){a.drawImage(o,0,0,1e3,1400),r===i.multipleCanvasDataURL.length-1&&(e.isPrintingProcessing=!1,h.print(),h.document.close(),h.close(),e.printModule.setToDefault())},o.src=t,h.document.body.appendChild(n)})}}},e.prototype.drawBorder=function(e,r,n,i,a,o){var s=r.borderBottom,l=r.borderLeft,d=r.borderRight,h=r.borderTop,p=r.borderColor;e.strokeStyle=p||"black",t.isNullOrUndefined(s)||-1!==s.indexOf("#FFFFFF")||(e.strokeStyle=s.split(" ")[2],this.drawPath(n,(2===i?-2:i)+o,n+a,(2===i?-2:i)+o,e,s,!1,r,"bottom")),t.isNullOrUndefined(l)||-1!==l.indexOf("#FFFFFF")||(e.strokeStyle=l.split(" ")[2],this.drawPath(n,i,n,(2===i?-2:i)+o,e,l,!0,r,"left")),t.isNullOrUndefined(d)||-1!==d.indexOf("#FFFFFF")||(e.strokeStyle=d.split(" ")[2],this.drawPath(n+a,i,n+a,(2===i?-2:i)+o,e,d,!1,r,"right")),t.isNullOrUndefined(h)||-1!==h.indexOf("#FFFFFF")||(e.strokeStyle=h.split(" ")[2],this.drawPath(n,i,n+a,i,e,h,!0,r,"top"))},e.prototype.drawPath=function(e,r,n,i,a,o,s,l,d){if(a.beginPath(),o.indexOf("dashed")>-1)a.setLineDash([3,2]),a.lineWidth=o.split(" ")[0].split("")[0];else if(o.indexOf("dotted")>-1)a.setLineDash([1,1]),a.lineWidth=o.split(" ")[0].split("")[0];else{if(o.indexOf("double")>-1){a.setLineDash([]);var h=!(t.isNullOrUndefined(l.borderBottom)||t.isNullOrUndefined(l.borderLeft)||t.isNullOrUndefined(l.borderRight)||t.isNullOrUndefined(l.borderTop)),p=!t.isNullOrUndefined(l.borderBottom)&&!t.isNullOrUndefined(l.borderLeft)&&t.isNullOrUndefined(l.borderRight)&&t.isNullOrUndefined(l.borderTop),c=t.isNullOrUndefined(l.borderBottom)&&!t.isNullOrUndefined(l.borderLeft)&&t.isNullOrUndefined(l.borderRight)&&!t.isNullOrUndefined(l.borderTop),u=!t.isNullOrUndefined(l.borderBottom)&&!t.isNullOrUndefined(l.borderLeft)&&t.isNullOrUndefined(l.borderRight)&&!t.isNullOrUndefined(l.borderTop),f=!t.isNullOrUndefined(l.borderBottom)&&t.isNullOrUndefined(l.borderLeft)&&!t.isNullOrUndefined(l.borderRight)&&t.isNullOrUndefined(l.borderTop),g=t.isNullOrUndefined(l.borderBottom)&&t.isNullOrUndefined(l.borderLeft)&&!t.isNullOrUndefined(l.borderRight)&&!t.isNullOrUndefined(l.borderTop),m=!t.isNullOrUndefined(l.borderBottom)&&t.isNullOrUndefined(l.borderLeft)&&!t.isNullOrUndefined(l.borderRight)&&!t.isNullOrUndefined(l.borderTop),v=t.isNullOrUndefined(l.borderBottom)&&!t.isNullOrUndefined(l.borderLeft)&&!t.isNullOrUndefined(l.borderRight)&&!t.isNullOrUndefined(l.borderTop),y=!t.isNullOrUndefined(l.borderBottom)&&!t.isNullOrUndefined(l.borderLeft)&&!t.isNullOrUndefined(l.borderRight)&&t.isNullOrUndefined(l.borderTop);a.lineWidth=1;return h?e===n?s?this.drawDoubleBorder(a,e,r,n,i,e+3,r+3,n+3,i-2):this.drawDoubleBorder(a,e,r,n,i,e-3,r+3,n-3,i-2):r===i&&(s?this.drawDoubleBorder(a,e,r,n,i,e+2,r+3,n-2,i+3):this.drawDoubleBorder(a,e,r,n,i,e+2,r-3,n-2,i-3)):p?"left"===d?this.drawDoubleBorder(a,e,r,n,i,e+3,r,n+3,i-2):this.drawDoubleBorder(a,e,r,n,i,e+2,r-3,n,i-3):c?"left"===d?this.drawDoubleBorder(a,e,r,n,i,e+3,r+2,n+3,i):this.drawDoubleBorder(a,e,r,n,i,e+2,r+3,n,i+3):u?"left"===d?this.drawDoubleBorder(a,e,r,n,i,e+3,r+3,n+3,i-2):"top"===d?this.drawDoubleBorder(a,e,r,n,i,e+2,r+3,n,i+3):this.drawDoubleBorder(a,e,r,n,i,e+2,r-3,n,i-3):f?"right"===d?this.drawDoubleBorder(a,e,r,n,i,e-3,r,n-3,i-2):this.drawDoubleBorder(a,e,r,n,i,e,r-3,n-2,i-3):g?"right"===d?this.drawDoubleBorder(a,e,r,n,i,e-3,r+3,n-3,i):this.drawDoubleBorder(a,e,r,n,i,e,r+3,n-2,i+3):m?"right"===d?this.drawDoubleBorder(a,e,r,n,i,e-3,r+3,n-3,i-2):"top"===d?this.drawDoubleBorder(a,e,r,n,i,e,r+3,n-2,i+3):this.drawDoubleBorder(a,e,r,n,i,e,r-3,n-2,i-3):v?"right"===d?this.drawDoubleBorder(a,e,r,n,i,e-3,r+3,n-3,i):"top"===d?this.drawDoubleBorder(a,e,r,n,i,e+3,r+3,n-2,i+3):this.drawDoubleBorder(a,e,r,n,i,e+3,r+3,n+3,i):y?"right"===d?this.drawDoubleBorder(a,e,r,n,i,e-3,r,n-3,i-2):"bottom"===d?this.drawDoubleBorder(a,e,r,n,i,e+2,r-3,n-2,i-3):this.drawDoubleBorder(a,e,r,n,i,e+3,r,n+3,i-2):e===n?this.drawDoubleBorder(a,e,r,n,i,e+("left"===d?3:-3),r,n+("left"===d?3:-3),i):r===i&&this.drawDoubleBorder(a,e,r,n,i,e,r+("top"===d?3:-3),n,i+("top"===d?3:-3)),void a.stroke()}a.setLineDash([]),a.lineWidth=o.split(" ")[0].split("")[0]}a.moveTo(e,r),a.lineTo(n,i),a.stroke()},e.prototype.drawDoubleBorder=function(e,t,r,n,i,a,o,s,l){e.moveTo(t,r),e.lineTo(n,i),e.moveTo(a,o),e.lineTo(s,l)},e.prototype.calculateTextPosition=function(e,t,r,n,i){var a,o=t;if(o>=e)switch(n.toLowerCase()){case"left":a=r+3;break;case"center":a=r+(o-e)/2;break;case"right":a=i?r+(o-3):r+(o-3)-e}else a=e<t?"left"===n.toLowerCase()?r+3:"center"===n.toLowerCase()?r+(t-e)/2:r+t-e:r+3;return a},e.prototype.calculatePageCount=function(e,r,n){var i=n,a=this.columnIndex;if(0===e.columns.length){var o=Math.floor(r/this.defaultCellWidth)-(i?1:0);return Array(Math.max(1,Math.ceil(a/o))).fill(o)}for(var s=0,l=[],d=0;d<=a;d++){var h=e.columns&&e.columns[d],p=(i?27:0)+(h&&h.hidden?0:h&&!t.isNullOrUndefined(h.width)?h.width:this.defaultCellWidth);i=!1,(s+=p)>r&&(l.push(d-1),i=!0,s=p)}return(0===l.length||a>l[l.length-1])&&l.push(a),l},e.prototype.wrapText=function(e,r,n,i){if(t.isNullOrUndefined(e))return[""];var a,o,s,l,d,h,p,c=[],u=0,f=e.toString().split(" "),g=Jt(" ",n,i,!0),m="",v=0,y=function(e){u&&c.push(m),Vt(a/r,!0)>1&&(e.split("").forEach(function(e){l=Jt(e,n,i,!0),d+=e,Vt(s+=l,!0)>r&&(c.push(d),s=l,d=e)}),a=s,e=d),m=e,u=a},C=f.length-1,b=function(e,t){Vt(e+g,!0)/r>=1?a+=0:(a+=g,t!==C&&(m+=" "))};return f.forEach(function(e,t){if(s=0,l=0,d="",a=Jt(e,n,i,!0),(p=Vt(u+a,!0)/r)>1)if((o=e.split("-")).length>1){var c=o.length-1;o.forEach(function(o,g){s=0,l=0,d="",h||(h=Jt("-",n,i,!0)),a=Jt(o,n,i,!0),g<c&&(a+=h,o+="-"),(p=Vt(u+a,!0)/r)>1?(y(o),g===c&&b(a,t)):(m+=o,g===c&&f[f.length-1]!==e&&b(u+a,t),u+=a)})}else y(e),b(a,t);else m+=e,b(u+a,t),u+=a}),u&&(v=Vt(u-g,!0)/r,parseFloat(v.toString().split(".")[0]),c.push(m)),c},e.prototype.getModuleName=function(){return"print"},e.prototype.destroy=function(){this.setToDefault(),this.totalSheetCount=[],this.parent=null},e}(),Uo=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Vo=function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},zo=function(e){function r(t,r){var n=e.call(this,t)||this;return n.viewport={rowCount:0,colCount:0,height:0,topIndex:0,leftIndex:0,width:0,bottomIndex:0,rightIndex:0,beforeFreezeHeight:0,beforeFreezeWidth:0,scaleX:1,scaleY:1},n.needsID=!0,i.Inject(Ro,No,Ao,Xa,Ya,Za,Ja,Ga,_n,ko,To,Oo,Do,Qa,Fo,ao,aa,Pi,Ui,ia,Qi,Ji,Lo,ea,eo,io,ta,Po,ro,oa,oo,so,sa,la,lo,da,Ho,ho,ca,po,pa,co,ua,Mo,uo,ra,fa,Bo,na,fo,ga,go),r&&n.appendTo(r),n}Uo(r,e),i=r,r.prototype.getCell=function(e,t,r){var n;return this.insideViewport(e,t)&&(r||(r=this.getRow(e,null,t)),t=this.getViewportIndex(t,!0),n=r?r.cells[t]:r),n},r.prototype.getRow=function(e,r,n){if(!r){var i=this.getActiveSheet(),a=this.frozenRowCount(i),o=this.frozenColCount(i);r=t.isNullOrUndefined(n)||e>a-1&&n>o-1?this.getContentTable():e<a&&n<o?this.sheetModule.getSelectAllTable():e<a?this.getColHeaderTable():this.getRowHeaderTable()}return e=this.getViewportIndex(e),r?r.rows[e]:null},r.prototype.hiddenCount=function(e,t,r,n){void 0===r&&(r="rows"),void 0===n&&(n=this.getActiveSheet());for(var i,a=0,o=e;o<=t;o++)(i=n[""+r][o])&&i.hidden&&a++;return a},r.prototype.getViewportIndex=function(e,t){var r=this.getActiveSheet(),n=this.frozenColCount(r),i=this.frozenRowCount(r);if(t){if(n){var a=u(r.topLeftCell)[1];return e<n?(e-=this.hiddenCount(a,e,"columns"),(e-=a)+1):(e-=this.hiddenCount(this.viewport.leftIndex+n,e,"columns"),e-=this.viewport.leftIndex+n)}e-=this.hiddenCount(this.viewport.leftIndex,e,"columns"),e-=this.viewport.leftIndex}else{if(i){var o=u(r.topLeftCell)[0];return e<i?(e-=this.hiddenCount(o,e),(e-=o)+1):(e-=this.hiddenCount(this.viewport.topIndex+i,e),e-=this.viewport.topIndex+i)}e-=this.hiddenCount(this.viewport.topIndex,e),e-=this.viewport.topIndex}return e},r.prototype.preRender=function(){e.prototype.preRender.call(this),this.serviceLocator=new ma,this.initServices()},r.prototype.initServices=function(){this.serviceLocator.register(Na,new t.L10n(this.getModuleName(),Ta,this.locale)),this.serviceLocator.register(Fa,new mo(this)),this.serviceLocator.register("actionEvents",new vo(this)),this.serviceLocator.register("shape",new yo(this))},r.prototype.render=function(){if(e.prototype.render.call(this),this.element.setAttribute("tabindex","0"),this.renderModule=new _a(this),this.renderSpreadsheet(),this.wireEvents(),this.created&&!this.refreshing)if(this.created.observers){if(this.created.observers.length>0){var t={observers:this.created.observers};this.isAngular&&(t={observers:this.created.observers,currentObservers:this.created.observers},this.created.currentObservers=[]),this.createdHandler=t,this.created.observers=[]}}else this.createdHandler=this.created,this.setProperties({created:void 0},!0)},r.prototype.renderSpreadsheet=function(){this.cssClass&&t.addClass([this.element],this.cssClass.split(" ")),this.setHeight(),this.setWidth(),n.createSpinner({target:this.element},this.createElement),this.cssClass&&-1===this.cssClass.indexOf("e-mobile-view")&&this.isMobileView()&&this.element.classList.add("e-mobile-view"),t.Browser.isDevice&&this.element.classList.add("e-device"),this.sheetModule=this.serviceLocator.getService("sheet"),this.allowScrolling&&(this.scrollModule=new Ka(this)),this.scrollSettings.enableVirtualization&&new $a(this),this.renderModule.render(),new to(this)},r.prototype.showSpinner=function(){n.showSpinner(this.element)},r.prototype.hideSpinner=function(){n.hideSpinner(this.element)},r.prototype.protectSheet=function(t,r,n){e.prototype.protectSheet.call(this,t,r,n)},r.prototype.unprotectSheet=function(t){e.prototype.unprotectSheet.call(this,t)},r.prototype.find=function(t){var r=this.getActiveSheet().activeCell;if(e.prototype.findHandler.call(this,t),!t.isAction)return r!==this.getActiveSheet().activeCell?this.getActiveSheet().name+"!"+this.getActiveSheet().activeCell:null},r.prototype.replace=function(r){r={value:r.value,mode:r.mode?r.mode:"Sheet",isCSen:!!r.isCSen&&r.isCSen,isEMatch:!!r.isEMatch&&r.isEMatch,searchBy:r.searchBy?r.searchBy:"By Row",replaceValue:r.replaceValue,replaceBy:r.replaceBy,sheetIndex:t.isUndefined(r.sheetIndex)?this.activeSheetIndex:r.sheetIndex,findOpt:r.findOpt?r.findOpt:""},e.prototype.replaceHandler.call(this,r)},r.prototype.findAll=function(e,t,r,n,i){var a=[],o={value:e,mode:t=t||"Sheet",sheetIndex:i=i<this.sheets.length?i:this.activeSheetIndex,isCSen:r=r||!1,isEMatch:n=n||!1,findCollection:a};return this.notify("findAllValues",o),a},r.prototype.goTo=function(e){if(e.includes("!")){var t=Se(this,Ie(e));if(void 0===t)return;if(t!==this.activeSheetIndex){var r=e.substring(e.lastIndexOf("!")+1),n=r.split(":")[0],i=this.sheets[t];this.setSheetPropertyOnMute(i,"activeCell",n),this.setSheetPropertyOnMute(i,"selectedRange",r);var a=u(n);if(i.frozenColumns||i.frozenRows){var o=u(i.topLeftCell);if(!(i.frozenRows&&a[0]<o[0]||i.frozenColumns&&a[1]<o[1])){var s=this.frozenRowCount(i),l=this.frozenColCount(i),d=[],h=[],p=u(i.paneTopLeftCell);s?(d.push(o[0]),a[0]>=s?h.push(a[0]):h.push(p[0])):(d.push(a[0]),h.push(a[0])),l?(d.push(o[1]),a[1]>=l?h.push(a[1]):h.push(p[1])):(d.push(a[1]),h.push(a[1])),this.setSheetPropertyOnMute(i,"topLeftCell",g(d[0],d[1])),this.setSheetPropertyOnMute(i,"paneTopLeftCell",g(h[0],h[1]))}}else a[0]<this.viewport.rowCount&&(a[0]=0),a[1]<this.viewport.colCount&&(a[1]=0),this.updateTopLeftCell(a[0],a[1],null,i);return this.activeSheetIndex=t,void this.dataBind()}}var f=c(e),m=this.getActiveSheet(),v=this.frozenRowCount(m),y=this.frozenColCount(m),C=this.insideViewport(f[0],f[1]);if(C){this.selectRange(e);var b=u(m.paneTopLeftCell),x=this.viewport.height;this.allowScrolling&&(x-=this.getScrollElement().parentElement.getBoundingClientRect().height);var S=0,w=0;if(v)for(R=(E=u(m.topLeftCell))[0];R<v;R++)if((S+=nt(m,R))>x){w=R;break}if(0===w)for(R=b[0];R<=this.viewport.bottomIndex;R++){if((S+=nt(m,R))>x){w=R;break}R===this.viewport.bottomIndex&&(w=this.viewport.bottomIndex)}b[2]=w;var I=0;if(S=0,x=this.viewport.width-this.sheetModule.getScrollSize(),y)for(var E=u(m.topLeftCell),R=E[1];R<y;R++)if((S+=lt(m,R))>x){I=R;break}if(0===I)for(R=b[1];R<=this.viewport.rightIndex;R++){if((S+=lt(m,R))>x){I=R;break}R===this.viewport.rightIndex&&(I=this.viewport.rightIndex)}if(b[3]=I,f[0]>=b[0]&&f[0]<b[2]&&f[1]>=b[1]&&f[1]<b[3])return;if(v||y){if(b=[].concat(u(m.topLeftCell),[v,b[3]]),f[0]>=b[0]&&f[0]<b[2]&&f[1]>=b[1]&&f[1]<b[3])return;if(b[2]=w,b[3]=y,f[0]>=b[0]&&f[0]<b[2]&&f[1]>=b[1]&&f[1]<b[3])return}}var N,F,A,k,O,T,D=this.getMainContent().parentElement;f[0]===v?A=0:(A=at(m,v,f[0]-1,!0),this.scrollSettings.enableVirtualization&&(T=A+this.getContentTable().getBoundingClientRect().height)>(O=parseFloat(D.querySelector(".e-virtualtrack").style.height))&&(T+=10,(N=D.querySelector(".e-virtualtrack")).style.height=T+"px",ft(function(){N.style.height=O+"px"}))),D.scrollTop=A,D=this.element.getElementsByClassName("e-scroller")[0],f[1]===y?A=0:(A=dt(m,y,f[1]-1,!0),this.scrollSettings.enableVirtualization&&(T=A+this.getContentTable().getBoundingClientRect().width)>(k=parseFloat(D.querySelector(".e-virtualtrack").style.width))&&(T+=10,(N=D.querySelector(".e-virtualtrack")).style.width=T+"px",(F=this.getColumnHeaderContent().querySelector(".e-virtualtrack")).style.width=T+"px",(N=this.getMainContent().querySelector(".e-virtualtrack")).style.width=T+"px",ft(function(){N.style.width=k+"px",F.style.width=k+"px"}))),D.scrollLeft=A,C||this.selectRange(e)},r.prototype.insideViewport=function(e,t){var r=this.getActiveSheet();if(r.frozenRows||r.frozenColumns){var n=this.frozenRowCount(r),i=this.frozenColCount(r),a=u(r.topLeftCell);return(e>=a[0]&&e<n||e>=this.viewport.topIndex+n&&e<=this.viewport.bottomIndex)&&(t>=a[1]&&t<i||t>=this.viewport.leftIndex+i&&t<=this.viewport.rightIndex)}return e>=this.viewport.topIndex&&e<=this.viewport.bottomIndex&&t>=this.viewport.leftIndex&&t<=this.viewport.rightIndex},r.prototype.resize=function(){this.renderModule.setSheetPanelSize(),this.scrollSettings.enableVirtualization&&this.renderModule.refreshSheet(!1,!0)},r.prototype.cut=function(e){var t=new Promise(function(e){e(void 0)});return this.notify(Qn,e?{range:y(e),sId:this.sheets[Se(this,Ie(e))]?this.sheets[Se(this,Ie(e))].id:this.getActiveSheet().id,promise:t,invokeCopy:!0,isPublic:!0}:{promise:t,invokeCopy:!0,isPublic:!0}),t},r.prototype.copy=function(e){var t=new Promise(function(e){e(void 0)});return this.notify(ei,e?{range:y(e),sId:this.sheets[Se(this,Ie(e))]?this.sheets[Se(this,Ie(e))].id:this.getActiveSheet().id,promise:t,invokeCopy:!0,isPublic:!0}:{promise:t,invokeCopy:!0,isPublic:!0}),t},r.prototype.paste=function(e,t){this.notify(ti,{range:e?y(e):e,sIdx:e?Se(this,Ie(e)):e,type:t,isAction:!0,isInternal:!0})},r.prototype.updateAction=function(e){Yt(e,this)},r.prototype.setHeight=function(){this.height&&(this.height.toString().indexOf("%")>-1&&(this.element.style.minHeight="400px"),this.element.style.height=t.formatUnit(this.height))},r.prototype.setWidth=function(){this.width&&((this.width.toString().indexOf("%")>-1||"auto"===this.width)&&(this.element.style.minWidth="300px"),this.element.style.width=t.formatUnit(this.width))},r.prototype.setColWidth=function(e,r,n){void 0===e&&(e=64),void 0===r&&(r=0);var i=t.isNullOrUndefined(n)?this.getActiveSheet():this.sheets[n];if(i&&(!i.isProtected||i.protectSettings.formatColumns)){var a=r,o="number"==typeof e?e+"px":e;r=t.isNullOrUndefined(r)?u(i.activeCell)[1]:r;var s=function(){ot(i,a).width=parseInt(o,10)>0?parseInt(o,10):0,i.columns[a].customWidth=!0},l=this.frozenColCount(i);if(i.id===this.getActiveSheet().id){if(r>=this.viewport.leftIndex+l&&r<=this.viewport.rightIndex||l&&r<l){r=this.getViewportIndex(r,!0);var d=lt(i,a,null,!0);(p=Vt(parseInt(o,10))-d)<0&&d<-p&&(p=-d),s(),this.notify(ni,{threshold:p,colIdx:a,checkWrapCell:!0}),_t(a,r,o,!0,this)}else{var h=lt(i,r),p=void 0;p=parseInt(o,10)>0?-(h-parseInt(o,10)):-h,s(),this.notify(ni,{threshold:p,colIdx:r})}this.notify("positionAutoFillElement",null)}else s()}},r.prototype.setRowHeight=function(e,r,n,i,a){void 0===e&&(e=20),void 0===r&&(r=0);var o=t.isNullOrUndefined(n)?this.getActiveSheet():this.sheets[n];if(o){var s=r;if(r=t.isNullOrUndefined(r)?u(o.activeCell)[0]:r,a&&o.rows[r]&&o.rows[r].customHeight)return;var l="number"==typeof e?e+"px":e,d=function(){it(o,s,parseInt(l,10)>0?parseInt(l,10):0),o.rows[s].customHeight=!0};if(o.id===this.getActiveSheet().id){var h=this.frozenRowCount(o);if(r>=this.viewport.topIndex+h&&r<=this.viewport.bottomIndex||h&&r<h){r=this.getViewportIndex(s);var p=nt(o,s,!0);(f=Vt(parseInt(l,10))-p)<0&&p<-f&&(f=-p),d(),this.notify(ri,{threshold:f,rowIdx:s,isCustomHgt:!0}),t.isNullOrUndefined(i)&&(i=!1),i||(_t(s,r,l,!1,this),i=!1)}else{var c=nt(o,r),f=void 0;f=parseInt(l,10)>0?-(c-parseInt(l,10)):-c,d(),this.notify(ri,{threshold:f,rowIdx:s})}this.notify("positionAutoFillElement",null)}else d()}},r.prototype.setRowsHeight=function(e,t,r){void 0===e&&(e=20),t||(t=["1:"+(this.getActiveSheet().usedRange.rowIndex+1)]),this.setSize(e,t,function(e){return Number(e)-1},this.setRowHeight.bind(this),r)},r.prototype.setColumnsWidth=function(e,t){void 0===e&&(e=64),t||(t=["A:"+v(this.getActiveSheet().usedRange.colIndex+1)]),this.setSize(e,t,function(e){return f(e)},this.setColWidth.bind(this))},r.prototype.setSize=function(e,t,r,n,i){var a,o,s,l,d,h=this;t.forEach(function(t){t.includes("!")?(s=t.substring(0,t.lastIndexOf("!")),a=Se(h,s),t=t.substring(t.lastIndexOf("!")+1)):a=h.activeSheetIndex,t.includes(":")?(o=t.split(":"),l=r(o[0]),d=r(o[1])):l=d=r(t);for(var p=l;p<=d;p++)n(e,p,a,!1,i)})},r.prototype.autoFit=function(e){var t;-1!==e.indexOf("!")&&(t=Se(this,e.substring(0,e.lastIndexOf("!"))),e=e.substring(e.lastIndexOf("!")+1));var r=this.getIndexes(e),n=r.startIdx,i=r.endIdx,a=r.isCol,o=a?f("XFD"):1048576;if(n<=o)for(i>o&&(i=o),n;n<=i;n++)this.notify("setAutoFit",{idx:n,isCol:a,sheetIdx:t})},r.prototype.getIndexes=function(e){var r,n,i,a;if(-1!==e.indexOf(":")){var o=e.split(":");i=o[0],a=o[1]}else i=e,a=e;if(!t.isNullOrUndefined(i)){var s=this.getAddress(i);i=s.address,r=s.isCol}if(!t.isNullOrUndefined(a)){var l=this.getAddress(a);a=l.address,n=l.isCol}var d=!0===r&&!0===n;return{startIdx:d?f(i.toUpperCase()):parseInt(i,10),endIdx:d?f(a.toUpperCase()):parseInt(a,10),isCol:d}},r.prototype.getAddress=function(e){var t;return e.substring(0,1).match(/\D/g)?(t=!0,e=e.replace(/[0-9]/g,""),{address:e,isCol:t}):e.substring(0,1).match(/[0-9]/g)&&e.match(/\D/g)?{address:"",isCol:!1}:(e=(parseInt(e,10)-1).toString(),{address:e,isCol:t})},r.prototype.addHyperlink=function(e,t,r){this.insertHyperlink(e,t,r,!0)},r.prototype.removeHyperlink=function(e){this.notify(si,{range:e,preventEventTrigger:!0})},r.prototype.insertHyperlink=function(e,t,r,n){if(this.allowHyperlink){var i=void 0,a=void 0,o=void 0,s=this.getActiveSheet();if(t=t||s.name+"!"+s.activeCell,o=c(t),oe(this,o))return void this.notify(yi,null);for(var l=this.getCell(o[0],o[1]),d=[],h=0;l&&h<l.classList.length;h++)d.push(l.classList[h]);var p={hyperlink:e,address:t,displayText:r,cancel:!1},u={hyperlink:e,address:t,displayText:r};if(n||(this.trigger("beforeHyperlinkCreate",p),this.notify(qr,{action:"hyperlink",eventArgs:p})),!p.cancel){var f={hyperlink:e=p.hyperlink,cell:t=p.address,displayText:r,triggerEvt:!n};if(this.notify(nn,f),t&&-1!==t.lastIndexOf("!")){var g=t.lastIndexOf("!");i=t.substring(0,g);for(var m=this.sheets,v=0;v<m.length;v++)m[v].name===i&&(a=v);s=this.sheets[a],t=t.substring(g+1)}if(!s)return;if(t=t||this.getActiveSheet().activeCell,o=c(t),n||(this.trigger("afterHyperlinkCreate",u),this.notify(ci,{action:"hyperlink",eventArgs:p})),s===this.getActiveSheet()){this.serviceLocator.getService("cell").refreshRange(o,!1,!1,!1,!0,re(this));for(h=0;h<d.length;h++)this.getCell(o[0],o[1]).classList.contains(d[h])||this.getCell(o[0],o[1]).classList.add(d[h]);this.notify(Sn,null)}}}},r.prototype.addDataValidation=function(t,r){e.prototype.addDataValidation.call(this,t,r)},r.prototype.removeDataValidation=function(t){e.prototype.removeDataValidation.call(this,t)},r.prototype.addInvalidHighlight=function(t){e.prototype.addInvalidHighlight.call(this,t)},r.prototype.removeInvalidHighlight=function(t){e.prototype.removeInvalidHighlight.call(this,t)},r.prototype.conditionalFormat=function(t){e.prototype.conditionalFormat.call(this,t)},r.prototype.clearConditionalFormat=function(t){t=t||this.getActiveSheet().selectedRange,e.prototype.clearConditionalFormat.call(this,t)},r.prototype.setPanelSize=function(){if("auto"!==this.height){var e=document.getElementById(this.element.id+"_sheet_panel");e.style.height=this.element.getBoundingClientRect().height*this.viewport.scaleY-yt(e,null,this.viewport.scaleY)+"px"}},r.prototype.open=function(t){this.isOpen=!0,e.prototype.open.call(this,t),this.isOpen&&this.showSpinner()},r.prototype.hideRow=function(t,r,n){void 0===r&&(r=t),void 0===n&&(n=!0),this.renderModule?this.notify(vn,{startIndex:t,endIndex:r,hide:n,actionUpdate:!1}):e.prototype.hideRow.call(this,t,r,n)},r.prototype.hideColumn=function(t,r,n){void 0===r&&(r=t),void 0===n&&(n=!0),this.renderModule?this.notify(vn,{startIndex:t,endIndex:r,hide:n,isCol:!0,actionUpdate:!1}):e.prototype.hideColumn.call(this,t,r,n)},r.prototype.clear=function(e){this.notify(Si,{options:e})},r.prototype.refresh=function(t){var r=this;if(this.isReact&&this.clearTemplate(),t)this.notify("clearCopy",null),this.sheets.length=0,this.sheetNameCount=1,this.notify("sheetsDestroyed",{}),this.notify("clearUndoRedoCollection",null),this.createSheet(),this.activeSheetIndex=this.sheets.length-1,this.notify("refreshSheetTabs",null),this.notify(Kr,{action:"initSheetInfo"}),this.renderModule.refreshSheet();else if(this.createdHandler){var n=function(){r.off("spreadsheetCreated",n),r.refresh()};this.on("spreadsheetCreated",n,this)}else this.notify(ii,{}),e.prototype.refresh.call(this)},r.prototype.insertImage=function(e,t){var r;for(r=0;r<e.length;r++)this.notify(Ni,{options:e[r],range:t||this.getActiveSheet().selectedRange,isPublic:!0})},r.prototype.deleteImage=function(e,t){this.notify(Fi,{id:e,range:t||this.getActiveSheet().selectedRange})},r.prototype.getRowHeaderContent=function(){return this.sheetModule.getRowHeaderPanel()},r.prototype.getColumnHeaderContent=function(){return this.sheetModule.getColHeaderPanel()},r.prototype.getMainContent=function(){return this.sheetModule.getContentPanel()},r.prototype.getSelectAllContent=function(){return this.sheetModule.getSelectAllContent()},r.prototype.getScrollElement=function(){return this.sheetModule.getScrollElement()},r.prototype.getContentTable=function(){return this.sheetModule.getContentTable()},r.prototype.getRowHeaderTable=function(){return this.sheetModule.getRowHeaderTable()},r.prototype.getColHeaderTable=function(){return this.sheetModule.getColHeaderTable()},r.prototype.getThreshold=function(e){var t=Math.round((this.viewport[e+"Count"]+1)/2);return t<15?15:t},r.prototype.isMobileView=function(){return!t.isNullOrUndefined(this.cssClass)&&(this.cssClass.indexOf("e-mobile-view")>-1||t.Browser.isDevice)&&-1===this.cssClass.indexOf("e-desktop-view")&&!1},r.prototype.getValueRowCol=function(t,r,n,i,a,o,s){return e.prototype.getValueRowCol.call(this,t,r,n,i,a,o,s)},r.prototype.updateCell=function(e,r,n){t.isNullOrUndefined(n)&&(n=!0),this.updateCellInfo(e,r,n,void 0,void 0,!0)},r.prototype.updateCellInfo=function(t,r,n,i,a,o){if(r=r||this.getActiveSheet().activeCell,!oe(this,c(r))){var s=this.scrollSettings.isFinite;e.prototype.updateCellDetails.call(this,t,r,i,a,n,s,o)}},r.prototype.getRowData=function(t,r){return e.prototype.getRowData.call(this,t,r)},r.prototype.sort=function(t,r){var n=this;if(!this.allowSorting)return Promise.reject();var i=[];if(this.sortCollection)for(var a=this.sortCollection.length-1;a>=0;a--)this.sortCollection[a]&&this.sortCollection[a].sheetIndex===this.activeSheetIndex&&(i.push(this.sortCollection[a]),this.sortCollection.splice(a,1));return this.notify(Tn,{sortOptions:t}),e.prototype.sort.call(this,t,r,i).then(function(e){return n.notify("sortComplete",e),Promise.resolve(e)})},r.prototype.setValueRowCol=function(t,r,n,i,a,o){if(!this.isEdit&&"#CIRCULARREF!"===r){var s={action:"isCircularReference",argValue:r,address:(d=Ae(this,we(this,t))).name+"!"+v(i)+n};this.notify("formulaOperation",s),r=s.argValue}if(e.prototype.setValueRowCol.call(this,t,r,n,i,a,o),this.allowEditing)this.notify(Yn,{action:"refreshDependentCellValue",rowIdx:n,colIdx:i,sheetIdx:we(this,t)});else{var l=we(this,t);if(n--,i--,this.activeSheetIndex===l){var d=Ae(this,l),h=void 0;if(tt(d,n)||ht(d,i)||(h=this.getCell(n,i)),h){if(h.parentElement){var p=h.parentElement.getAttribute("aria-rowindex");if(p&&Number(p)-1!==n)return}var c=He(n,i,d),u={value:c.value,format:c.format,onLoad:!0,formattedText:c.value,isRightAlign:!1,type:"General",cell:c,rowIndex:n,colIndex:i,isRowFill:!1};this.notify(Wr,u),this.refreshNode(h,u)}}}},r.prototype.getModuleName=function(){return"spreadsheet"},r.prototype.calculateNow=function(t,r){return e.prototype.calculateNow.call(this,t,r)},r.prototype.refreshNode=function(e,r){var n;if(e){if(r){if(r.result=t.isNullOrUndefined(r.formattedText)?t.isNullOrUndefined(r.result)?"":r.result:r.formattedText.toString(),!r.isRowFill){var i=e.querySelector(".e-fill-before");i&&t.detach(i);var a=t.select(".e-fill",e);a&&(t.detach(a),e.style.display="table-cell");var o=t.select(".e-fill-sec",e);o&&t.detach(o)}var s=t.select("#"+this.element.id+"_currency",e);if(s&&t.detach(s),"Accounting"===r.type&&fe(r.value)&&r.result.includes(r.curSymbol)){var l=void 0,d=void 0,h=void 0;r.result.trim().endsWith(r.curSymbol)?d=r.result:(l=r.result.includes(" "+r.curSymbol)?" "+r.curSymbol:r.curSymbol,d=r.result.split(l).join(""));var p=e.querySelector(".e-databar-value"),c=e.querySelector(".e-iconsetspan"),u=e,f=void 0;if(e.children.length>0&&e.children[e.childElementCount-1].className.indexOf("e-addNoteIndicator")>-1&&(f=document.getElementsByClassName("e-addNoteIndicator")[0]),p?(this.refreshNode(p,{result:d}),u=e.querySelector(".e-cf-databar")||e):e.querySelector("a")?e.querySelector("a").textContent=d:(h=!0,e.innerText=""),c&&e.insertBefore(c,e.firstElementChild),l){var m=this.createElement("span",{id:this.element.id+"_currency",styles:"float: left"});m.innerText=l,u.appendChild(m),t.isNullOrUndefined(f)||u.appendChild(f)}return h&&(e.innerHTML+=d),void e.classList.add("e-right-align")}var v=void 0;!r.result||"true"!==r.result.toLowerCase()&&"false"!==r.result.toLowerCase()?v="e-right-align":(r.result=r.result.toUpperCase(),v="e-center-align",r.isRightAlign=!0),n=r.result,this.allowWrap||n.toString().includes("\n")&&(n=n.replace(/\n/g,"")),r.isRightAlign?e.classList.add(v):e.classList.remove(v)}n=t.isNullOrUndefined(n)?"":n,t.isNullOrUndefined(r.rowIndex)||t.isNullOrUndefined(r.colIndex)||t.attributes(e,{"aria-label":(n?n+" ":"")+g(r.rowIndex,r.colIndex)});var y=e.lastChild;y&&"SPAN"===y.nodeName&&y.classList.contains("e-iconsetspan")&&(y=null);var C=e.querySelector(".e-addNoteIndicator");C&&(y=C.previousSibling),e.querySelector(".e-databar-value")&&(y=e.querySelector(".e-databar-value").lastChild),e.querySelector(".e-hyperlink")&&(r.cell&&r.cell.wrap&&n&&n.toString().indexOf("\n")&&(e.querySelector(".e-hyperlink").textContent=n),y=e.querySelector(".e-hyperlink").lastChild);var b=e.querySelector(".e-wrap-content");if(!b||e.querySelector(".e-hyperlink")||e.querySelector(".e-databar-value")||(b.lastChild||b.appendChild(document.createTextNode("")),y=b.lastChild),(this.isAngular||this.isVue)&&e.classList.contains("e-cell-template")&&y&&(8===y.nodeType||3===y.nodeType)){if(3===y.nodeType||""!==n){var x=function(){e.childElementCount||(3===y.nodeType?r.isRowFill||(y.nodeValue=n):e.appendChild(document.createTextNode(n)))};this.isAngular?ft(x):x()}}else!y||3!==y.nodeType&&1!==y.nodeType?e.appendChild(document.createTextNode(n)):r.isRowFill||(!t.isNullOrUndefined(y.className)&&y.className.indexOf("e-addNoteIndicator")>-1?(y=e.lastChild).nodeValue=n:y.nodeValue=n)}},r.prototype.calculateHeight=function(e,t,r){void 0===t&&(t=1),void 0===r&&(r=1);var n=e&&e.fontSize||this.cellStyle.fontSize,i="Arial Black"===e.fontFamily?1.44:1.24;return(n.indexOf("pt")>-1?1.33*parseInt(n,10):parseInt(n,10))*i*t+r*i},r.prototype.skipHidden=function(e,t,r,n){void 0===r&&(r="rows"),void 0===n&&(n=this.scrollSettings.isFinite);var i,a=this.getActiveSheet();this.scrollSettings.isFinite&&(i=("rows"===r?a.rowCount:a.colCount)-1);for(var o=e;o<=t;o++)if(a[""+r][o]&&a[""+r][o].hidden){if(e===o&&e++,t++,n&&t>i){t=i;break}}else if(!n&&this.scrollSettings.isFinite&&t>i&&a[""+r][o-1]&&a[""+r][o-1].hidden){t--;break}return[e,t]},r.prototype.updateActiveBorder=function(e,r){void 0===r&&(r=".e-ribbon");var n=t.select(r+" .e-tab-header .e-indicator",this.element);n.style.display="none",t.setStyleAttribute(n,{left:"",right:""}),t.setStyleAttribute(n,{left:e.offsetLeft+"px",right:e.parentElement.offsetWidth-(e.offsetLeft+e.offsetWidth)+"px"}),n.style.display=""},r.prototype.undo=function(){this.notify(hi,{isUndo:!0,isPublic:!0})},r.prototype.redo=function(){this.notify(hi,{isUndo:!1,isPublic:!0})},r.prototype.updateUndoRedoCollection=function(e){this.notify("updateUndoRedoCollection",{args:e,isPublic:!0})},r.prototype.addDefinedName=function(e){var t={action:"addDefinedName",isAdded:!1,definedName:e};return this.notify("formulaOperation",t),t.isAdded},r.prototype.removeDefinedName=function(t,r){return e.prototype.removeDefinedName.call(this,t,r)},r.prototype.mouseClickHandler=function(e){this.notify(Xn,e)},r.prototype.mouseDownHandler=function(e){this.notify("mouseDown",e)},r.prototype.keyUpHandler=function(e){t.closest(e.target,".e-find-dlg")?this.notify("findKeyUp",e):this.notify(Kn,e)},r.prototype.keyDownHandler=function(e){var r=t.closest(e.target,".e-findtool-dlg");if(r){if(9===e.keyCode){var n=e.target;if(e.shiftKey){if(n.classList.contains("e-text-findNext-short")){var i=r.querySelector(".e-findRib-close .e-tbar-btn");i&&(e.preventDefault(),i.focus())}}else n.classList.contains("e-tbar-btn")&&n.parentElement.classList.contains("e-findRib-close")&&or(r)}}else{this.notify($n,e);var a=t.closest(e.target,".e-dialog");this.enableKeyboardNavigation||!document.activeElement.classList.contains("e-cell")&&!a||[38,40,33,34,35,36,9].indexOf(e.keyCode)>-1&&e.preventDefault()}},r.prototype.freeze=function(e){if(!(!this.allowFreezePane||e.row<0||e.column<0)){if(e.triggerEvent){var t={row:e.row,column:e.column,cancel:!1,sheetIndex:this.activeSheetIndex};if(this.notify(qr,{eventArgs:t,action:"freezePanes"}),t.cancel)return}this.on(Wn,this.freezePaneUpdated,this),this.freezePanes(e.row,e.column),this.notify(Sn,null)}},r.prototype.freezePaneUpdated=function(){this.off(Wn,this.freezePaneUpdated);var e=this.getActiveSheet();or(this.element),this.notify(ci,{eventArgs:{row:e.frozenRows,column:e.frozenColumns,sheetIndex:this.activeSheetIndex},action:"freezePanes"})},r.prototype.wireEvents=function(){t.EventHandler.add(this.element,"click",this.mouseClickHandler,this),t.EventHandler.add(this.element,Rt(),this.mouseDownHandler,this),t.EventHandler.add(this.element,"keyup",this.keyUpHandler,this),t.EventHandler.add(this.element,"keydown",this.keyDownHandler,this),this.on("freeze",this.freeze,this),this.on("refreshInsertDelete",this.refreshInsertDelete,this)},r.prototype.destroy=function(){this.isReact&&this.clearTemplate(),this.unwireEvents(),this.notify(Gn,null),e.prototype.destroy.call(this),this.element.innerHTML="",this.element.removeAttribute("tabindex"),this.element.removeAttribute("role"),this.element.style.removeProperty("height"),this.element.style.removeProperty("width"),this.element.style.removeProperty("min-height"),this.element.style.removeProperty("min-width"),this.sheetModule&&this.sheetModule.destroy()},r.prototype.unwireEvents=function(){t.EventHandler.remove(this.element,"click",this.mouseClickHandler),t.EventHandler.remove(this.element,Rt(),this.mouseDownHandler),t.EventHandler.remove(this.element,"keyup",this.keyUpHandler),t.EventHandler.remove(this.element,"keydown",this.keyDownHandler),this.off("freeze",this.freeze),this.off("refreshInsertDelete",this.refreshInsertDelete)},r.prototype.refreshInsertDelete=function(e){var t=this;if("Sheet"!==e.modelType){var r,n;e.sheet.ranges.forEach(function(i){i.template&&i.address&&(n=c(i.address),(r=t.updateRangeOnInsertDelete(e,n))&&(i.address=m(n)))}),this.setSheetPropertyOnMute(e.sheet,"ranges",e.sheet.ranges)}},r.prototype.addContextMenuItems=function(e,t,r,n){void 0===r&&(r=!0),this.notify("addContextMenuItems",{items:e,text:t,insertAfter:r,isUniqueId:n})},r.prototype.removeContextMenuItems=function(e,t){this.notify("removeContextMenuItems",{items:e,isUniqueId:t})},r.prototype.enableContextMenuItems=function(e,t,r){void 0===t&&(t=!0),this.notify("enableContextMenuItems",{items:e,enable:t,isUniqueId:r})},r.prototype.enableFileMenuItems=function(e,t,r){void 0===t&&(t=!0),this.notify("enableFileMenuItems",{items:e,enable:t,isUniqueId:r})},r.prototype.hideFileMenuItems=function(e,t,r){void 0===t&&(t=!0),this.notify("hideFileMenuItems",{items:e,hide:t,isUniqueId:r})},r.prototype.addFileMenuItems=function(e,t,r,n){void 0===r&&(r=!0),this.notify("addFileMenuItems",{items:e,text:t,insertAfter:r,isUniqueId:n})},r.prototype.hideRibbonTabs=function(e,t){void 0===t&&(t=!0),this.notify("hideRibbonTabs",{tabs:e,hide:t})},r.prototype.enableRibbonTabs=function(e,t){void 0===t&&(t=!0),this.notify("enableRibbonTabs",{tabs:e,enable:t})},r.prototype.addRibbonTabs=function(e,t){this.notify("addRibbonTabs",{items:e,insertBefore:t})},r.prototype.enableToolbarItems=function(e,t,r){this.notify("enableToolbarItems",[{tab:e,items:t,enable:void 0===r||r}])},r.prototype.hideToolbarItems=function(e,t,r){void 0===r&&(r=!0),this.notify("hideToolbarItems",{tab:e,indexes:t,hide:r})},r.prototype.addToolbarItems=function(e,t,r){this.notify("addToolbarItems",{tab:e,items:t,index:r})},r.prototype.selectRange=function(e){this.isEdit&&this.notify(Yn,{action:"endEdit"}),this.notify("selectRange",{address:e})},r.prototype.selectChart=function(e){this.selectOverlay(e,!0)},r.prototype.selectImage=function(e){this.selectOverlay(e)},r.prototype.selectOverlay=function(e,t){var r=this.getActiveSheet();if(!r.isProtected&&this.allowEditing){if(!e){var n=u(r.activeCell),i=He(n[0],n[1],r,!1,!0);t?i.chart&&i.chart.length&&(e=i.chart[i.chart.length-1].id):i.image&&i.image.length&&(e=i.image[i.image.length-1].id)}var a;if(e?(a=this.element.querySelector("#"+e)).classList.contains("e-ss-overlay")||(a=a.parentElement):a=this.element.querySelector(".e-ss-overlay"+(t?".e-datavisualization-chart":":not(.e-datavisualization-chart)")),a){var o=void 0,s=this.element.getElementsByClassName("e-ss-overlay-active")[0];s&&(s.classList.remove("e-ss-overlay-active"),(o=s.classList.contains("e-datavisualization-chart"))&&this.notify("clearChartBorder",null)),a.classList.add("e-ss-overlay-active"),a.classList.contains("e-datavisualization-chart")?(this.notify("focusChartBorder",{id:a.id}),o||this.notify("insertDesignChart",{id:a.id})):o&&this.notify("removeDesignChart",null)}}},r.prototype.deselectChart=function(){this.notify(wi,{selector:".e-datavisualization-chart"})},r.prototype.deselectImage=function(){this.notify(wi,{selector:":not(.e-datavisualization-chart)"})},r.prototype.startEdit=function(){this.notify(Yn,{action:"startEdit",isNewValueEdit:!1})},r.prototype.closeEdit=function(){this.notify(Yn,{action:"cancelEdit"})},r.prototype.endEdit=function(){this.notify(Yn,{action:"endEdit",isPublic:!0})},r.prototype.print=function(e){void 0===e&&(e={type:"ActiveSheet",allowRowColumnHeader:!1,allowGridLines:!1}),this.allowPrint&&!t.isNullOrUndefined(this.printModule)&&this.printModule.print(this,e)},r.prototype.onPropertyChanged=function(r,n){var i=this;e.prototype.onPropertyChanged.call(this,r,n);for(var a,o=0,s=Object.keys(r);o<s.length;o++){var l=s[o],d=void 0,h=void 0,p=this.getActiveSheet(),c=this.getScrollElement();switch(l){case"enableRtl":if(r.locale||r.currencyCode)break;if((d=this.getColumnHeaderContent())&&(d=d.parentElement),!d)break;if(r.enableRtl?(d.style.marginRight="",document.getElementById(this.element.id+"_sheet_panel").classList.add("e-rtl")):(d.style.marginLeft="",document.getElementById(this.element.id+"_sheet_panel").classList.remove("e-rtl")),this.allowScrolling&&this.scrollModule.setPadding(!0),this.allowAutoFill){var f=this.element.querySelector(".e-dragfill-ddb");if(f){var g=t.getComponent(f,"dropdown-btn");g&&(g.enableRtl=r.enableRtl,g.dataBind())}}if(this.sheetModule.setPanelWidth(p,this.getRowHeaderContent(),!0),this.allowImage||this.allowChart)for(var m=this.element.getElementsByClassName("e-ss-overlay"),v=void 0,y=void 0,C=void 0,b=0,x=m.length-1;b<=x;b++)(y=m[0]).classList.contains("e-datavisualization-chart")&&(v=(C=y.querySelector(".e-accumulationchart"))?t.getComponent(C,"accumulationchart"):(C=y.querySelector(".e-chart"))&&t.getComponent(C,"chart"))&&v.destroy(),t.detach(y),b===x&&this.notify(Nn,{});c&&(c.scrollLeft=0),this.selectRange(p.selectedRange);break;case"cssClass":n.cssClass&&t.removeClass([this.element],n.cssClass.split(" ")),r.cssClass&&t.addClass([this.element],r.cssClass.split(" "));break;case"activeSheetIndex":this.renderModule.refreshSheet(),this.notify("activeSheetChanged",{idx:r.activeSheetIndex});break;case"width":this.setWidth(),this.resize();break;case"height":this.setHeight(),this.resize();break;case"showRibbon":this.notify(qn,{prop:"showRibbon",onPropertyChange:!0});break;case"showFormulaBar":this.notify("formulaBar",{uiUpdate:!0});break;case"showSheetTabs":this.notify("sheetTabs",null);break;case"cellStyle":this.renderModule.refreshSheet();break;case"allowEditing":if(this.allowEditing){if(this.notify(Yn,{action:"renderEditor"}),this.enableKeyboardNavigation){this.enableKeyboardNavigation=!1,this.dataBind(),this.enableKeyboardNavigation=!0,this.dataBind();var S=this.selectionSettings.mode;"None"!==S&&(this.selectionSettings.mode="None",this.dataBind(),this.selectionSettings.mode=S,this.dataBind())}}else this.notify(wi,null);break;case"allowInsert":(h=this.element.getElementsByClassName("e-add-sheet-tab")[0])&&(h.disabled=!this.allowInsert,this.allowInsert?h.classList.contains("e-disabled")&&h.classList.remove("e-disabled"):h.classList.contains("e-disabled")||h.classList.add("e-disabled"));break;case"sheets":if(r.sheets===this.sheets){this.renderModule.refreshSheet(),this.notify("refreshSheetTabs",null),this.notify(Kr,{action:"initSheetInfo"});break}Object.keys(r.sheets).forEach(function(e,o){var s=Number(e),l=r.sheets[s],d=Ae(i,s);if(l.ranges&&Object.keys(l.ranges).length){var h,p=Object.keys(l.ranges);p.forEach(function(e,t){l.ranges[Number(e)].info||(h=t)});var c,f,g,m;p.forEach(function(e,r){(t.isUndefined(h)||h===r)&&(c=Number(e),f=l.ranges[c],g=d.ranges[c],m=f.dataSource,f.fieldsOrder&&g.info&&!m&&g.dataSource&&(m=g.dataSource),m&&i.notify("dataSourceChanged",{sheetIdx:s,rangeIdx:c,changedData:m}))})}else if(l.paneTopLeftCell&&n.sheets&&n.sheets[""+s]&&n.sheets[""+s].paneTopLeftCell){if(i.activeSheetIndex!==Number(s))return;var v=u(l.paneTopLeftCell),y=u(n.sheets[""+s].paneTopLeftCell);if(v[0]!==y[0]){var C=i.frozenRowCount(i.getActiveSheet()),b=v[0]>C?at(i.getActiveSheet(),C,v[0]-1):0;i.notify("updateScroll",{top:b})}if(v[1]!==y[1]){var x=i.frozenColCount(i.getActiveSheet()),S=v[1]>x?dt(i.getActiveSheet(),x,v[1]-1):0;i.notify("updateScroll",{left:S})}}else if(0===o&&i.renderModule.refreshSheet(),i.showSheetTabs&&l.name&&!a){var w=t.select(".e-sheet-tabs-items",i.element),I=Number(s);w.children[I+1]?i.notify(li,{items:w,value:l.name,idx:I}):(i.notify("refreshSheetTabs",null),a=!0)}});break;case"locale":this.refresh();break;case"currencyCode":r.locale||this.refresh();break;case"password":this.password.length>0&&this.showSheetTabs&&(this.element.querySelector(".e-add-sheet-tab").setAttribute("disabled","true"),this.element.querySelector(".e-add-sheet-tab").classList.add("e-disabled"));break;case"isProtected":if(this.isProtected){var w=this.element.getElementsByClassName("e-add-sheet-tab")[0];w&&(w.disabled=this.isProtected,this.isProtected?w.classList.contains("e-disabled")&&w.classList.add("e-disabled"):w.classList.contains("e-disabled")||w.classList.remove("e-disabled"))}break;case"allowFreezePane":this.notify(qn,{prop:"allowFreezePane",onPropertyChange:!0});break;case"allowImage":case"allowChart":this.renderModule.refreshSheet(),this.notify(qn,{prop:l,onPropertyChange:!0});break;case"calculationMode":"Manual"===n.calculationMode&&this.notify(Kr,{action:"ClearDependentCellCollection"}),this.notify(qn,{prop:l,onPropertyChange:!0});break;case"allowResizing":r.allowResizing&&this.notify("propertyChange",{propertyName:l});break;case"enableNotes":r.enableNotes&&this.notify(Nn,{});break;case"allowNumberFormatting":case"allowWrap":case"allowCellFormatting":this.notify(qn,{prop:l,onPropertyChange:!0}),this.notify(Nn,{});break;case"showAggregate":this.notify("showAggregate",{remove:!this.showAggregate})}}},r.prototype.requiredModules=function(){return ct(this)},r.prototype.appendTo=function(t){e.prototype.appendTo.call(this,t)},r.prototype.filter=function(t,r){return this.allowFiltering?(r=r||this.getActiveSheet().selectedRange,e.prototype.filter.call(this,t,r)):Promise.reject()},r.prototype.clearFilter=function(e,t){this.notify("clearFilter",{field:e,sheetIndex:t})},r.prototype.applyFilter=function(e,t){var r=this;if(!this.allowFiltering)return Promise.reject();var n=new Promise(function(e){e(void 0)});if(e&&e.length){var i;e.forEach(function(e){i={instance:{options:{type:e.type,format:"date"===e.type&&"yMd"}},arg3:e.value,arg2:e.operator},r.notify(h.fltrPrevent,i),e.value=i.arg3})}var a={predicates:e,range:t,isInternal:!0,promise:n,sIdx:t?S(this,t):this.activeSheetIndex};return this.notify(pi,a),a.promise},r.prototype.addCustomFunction=function(t,r,n){e.prototype.addCustomFunction.call(this,t,r,n),this.notify("refreshFormulaDatasource",null)},r.prototype.setRangeReadOnly=function(e,r,n){r=r||this.getActiveSheet().selectedRange;var i=n||this.activeSheetIndex,a=w(c(r)),o=Ae(this,i);if(!t.isNullOrUndefined(o)){if(this.notify("actionBegin",{action:"readonly",eventArgs:{readOnly:e,range:r,sheetIdx:i}}),mr(r)||0===a[0]&&a[2]===o.rowCount-1)for(var s=a[1];s<=a[3];s++)if(e)st(o,s,{isReadOnly:e});else{var l=ot(o,s);l&&l.isReadOnly&&delete l.isReadOnly}else if(vr(r)||0===a[1]&&a[3]===o.colCount-1)for(var d=a[0];d<=a[2];d++)if(e)et(o,d,{isReadOnly:e});else{var h=Qe(o,d);h&&h.isReadOnly&&delete h.isReadOnly}else for(var p=a[1];p<=a[3];p++)for(var u=a[0];u<=a[2];u++)e?Ue(u,p,o,{isReadOnly:e},!0):(m=He(u,p,o))&&m.isReadOnly&&delete m.isReadOnly;for(var f=a[1];f<=a[3];f++)for(var g=a[0];g<=a[2];g++){var m=this.getCell(g,f);!e&&m&&m.classList.contains("e-readonly")?m.classList.remove("e-readonly"):m&&!m.classList.contains("e-readonly")&&(m.className+=" e-readonly")}this.notify("actionComplete",{action:"readonly",eventArgs:{readOnly:e,range:r,sheetIdx:i}})}};var i;return Vo([t.Property("")],r.prototype,"cssClass",void 0),Vo([t.Property(!0)],r.prototype,"allowScrolling",void 0),Vo([t.Property(!0)],r.prototype,"allowResizing",void 0),Vo([t.Property(!0)],r.prototype,"showAggregate",void 0),Vo([t.Property(!0)],r.prototype,"enableClipboard",void 0),Vo([t.Property(!0)],r.prototype,"enableContextMenu",void 0),Vo([t.Property(!0)],r.prototype,"enableKeyboardNavigation",void 0),Vo([t.Property(!0)],r.prototype,"enableKeyboardShortcut",void 0),Vo([t.Property(!0)],r.prototype,"allowUndoRedo",void 0),Vo([t.Property(!0)],r.prototype,"allowWrap",void 0),Vo([t.Complex({},Ua)],r.prototype,"selectionSettings",void 0),Vo([t.Complex({},Ha)],r.prototype,"scrollSettings",void 0),Vo([t.Event()],r.prototype,"beforeCellRender",void 0),Vo([t.Event()],r.prototype,"beforeSelect",void 0),Vo([t.Event()],r.prototype,"select",void 0),Vo([t.Event()],r.prototype,"contextMenuBeforeOpen",void 0),Vo([t.Event()],r.prototype,"fileMenuBeforeOpen",void 0),Vo([t.Event()],r.prototype,"contextMenuBeforeClose",void 0),Vo([t.Event()],r.prototype,"dialogBeforeOpen",void 0),Vo([t.Event()],r.prototype,"fileMenuBeforeClose",void 0),Vo([t.Event()],r.prototype,"contextMenuItemSelect",void 0),Vo([t.Event()],r.prototype,"fileMenuItemSelect",void 0),Vo([t.Event()],r.prototype,"beforeDataBound",void 0),Vo([t.Event()],r.prototype,"dataBound",void 0),Vo([t.Event()],r.prototype,"dataSourceChanged",void 0),Vo([t.Event()],r.prototype,"cellEdit",void 0),Vo([t.Event()],r.prototype,"cellEditing",void 0),Vo([t.Event()],r.prototype,"cellEdited",void 0),Vo([t.Event()],r.prototype,"cellSave",void 0),Vo([t.Event()],r.prototype,"beforeCellSave",void 0),Vo([t.Event()],r.prototype,"created",void 0),Vo([t.Event()],r.prototype,"beforeSort",void 0),Vo([t.Event()],r.prototype,"beforeHyperlinkCreate",void 0),Vo([t.Event()],r.prototype,"afterHyperlinkCreate",void 0),Vo([t.Event()],r.prototype,"beforeHyperlinkClick",void 0),Vo([t.Event()],r.prototype,"afterHyperlinkClick",void 0),Vo([t.Event()],r.prototype,"beforeConditionalFormat",void 0),Vo([t.Event()],r.prototype,"actionBegin",void 0),Vo([t.Event()],r.prototype,"actionComplete",void 0),Vo([t.Event()],r.prototype,"openComplete",void 0),Vo([t.Event()],r.prototype,"sortComplete",void 0),Vo([t.Property("USD")],r.prototype,"currencyCode",void 0),r=i=Vo([t.NotifyPropertyChanges],r)}(ba);return zo.Inject(Ga,Ya,Za,Ja,Xa,To,No,Ro,Oo,ko,Ao,_n,Qa,Do,Fo),e.AutoFill=fo,e.AutoFillSettings=jr,e.Axis=Ur,e.BasicFormulas=_i,e.Border=Pr,e.CalcSheetFamilyItem=$i,e.Calculate=Yi,e.CalculateCommon=ji,e.Cell=zn,e.CellFormat=Qa,e.CellRenderer=ja,e.CellStyle=Ir,e.Chart=Vr,e.Clipboard=Ga,e.Column=Ra,e.ConditionalFormat=Tr,e.ConditionalFormatting=uo,e.ContextMenu=To,e.DISABLED="e-disabled",e.DataBind=_n,e.DataLabelSettings=Lr,e.DataValidation=lo,e.DefineName=Nr,e.Delete=so,e.Edit=Ya,e.Filter=Po,e.FilterCollection=Er,e.FindAndReplace=po,e.Format=Or,e.Formula=Fo,e.FormulaBar=No,e.FormulaError=Xi,e.FormulaInfo=Ki,e.Hyperlink=Ar,e.Image=zr,e.Insert=oo,e.KeyboardNavigation=Za,e.KeyboardShortcut=Ja,e.LegendSettings=Dr,e.MajorGridLines=Br,e.MarkerSettings=Mr,e.Merge=co,e.MinorGridLines=Hr,e.NumberFormat=Do,e.Open=ko,e.OpenSettings=jn,e.Parser=qi,e.ProtectSettings=Fr,e.ProtectSheet=ho,e.Range=Mn,e.Render=_a,e.Resize=eo,e.Ribbon=Ro,e.Row=wa,e.RowRenderer=za,e.Save=Oo,e.Scroll=Ka,e.ScrollSettings=Ha,e.Selection=Xa,e.SelectionSettings=Ua,e.Sheet=Hn,e.SheetRender=Va,e.SheetTabs=Ao,e.ShowHide=to,e.Sort=Lo,e.SortCollection=Rr,e.Spreadsheet=zo,e.SpreadsheetChart=Bo,e.SpreadsheetHyperlink=ro,e.SpreadsheetImage=Mo,e.SpreadsheetNote=go,e.UndoRedo=io,e.UsedRange=Bn,e.Validation=kr,e.ValueChangedArgs=Zi,e.VirtualScroll=$a,e.WRAPTEXT="e-wraptext",e.Workbook=ba,e.WorkbookAutoFill=ga,e.WorkbookCellFormat=ia,e.WorkbookChart=na,e.WorkbookConditionalFormat=fa,e.WorkbookDataValidation=da,e.WorkbookDelete=la,e.WorkbookEdit=aa,e.WorkbookFilter=ta,e.WorkbookFindAndReplace=pa,e.WorkbookFormula=Ji,e.WorkbookHyperlink=oa,e.WorkbookImage=ra,e.WorkbookInsert=sa,e.WorkbookMerge=ua,e.WorkbookNumberFormat=Qi,e.WorkbookOpen=Pi,e.WorkbookProtectSheet=ca,e.WorkbookSave=Ui,e.WorkbookSort=ea,e.WrapText=ao,e.actionEvents="actionEvents",e.activeCellChanged="activeCellChanged",e.activeCellMergedRange=mn,e.activeSheetChanged="activeSheetChanged",e.addChartEle="addChartEle",e.addContextMenuItems="addContextMenuItems",e.addDPRValue=ur,e.addFileMenuItems="addFileMenuItems",e.addHighlight="addHighlight",e.addHyperlink="addHyperlink",e.addListValidationDropdown="addListValidationDropdown",e.addNote="addNote",e.addRibbonTabs="addRibbonTabs",e.addToolbarItems="addToolbarItems",e.addressHandle="addressHandle",e.afterHyperlinkClick="afterHyperlinkClick",e.afterHyperlinkCreate="afterHyperlinkCreate",e.aggregateComputation="aggregateComputation",e.applyCF=Cn,e.applyCellFormat=Xr,e.applyLockCells="applyLockCells",e.applyMerge="applyMerge",e.applyNumberFormatting="applyNumber",e.applyPredicates=ie,e.applyProtect=fi,e.applySort="applySort",e.autoFill="autoFill",e.autoFit=ai,e.beforeCellUpdate=Fn,e.beforeCheckboxRender="beforeCheckboxfilterRenderer",e.beforeContentLoaded="beforeContentLoaded",e.beforeDataBound="beforeDataBound",e.beforeDelete="beforeDelete",e.beforeFilter="beforeFilter",e.beforeHyperlinkClick="beforeHyperlinkClick",e.beforeHyperlinkCreate="beforeHyperlinkCreate",e.beforeInsert="beforeInsert",e.beforeRibbonCreate="beforeRibbonCreate",e.beforeSort="beforeSort",e.beforeVirtualContentLoaded="beforeVirtualContentLoaded",e.beginAction=qr,e.beginSave="beginSave",e.cMenuBeforeOpen=Zn,e.calculateFormula=Gr,e.cellNavigate="cellNavigate",e.cellValidation=ln,e.chartDesignTab=Oi,e.chartRangeSelection="chartRangeSelection",e.checkColumnValidation=pt,e.checkDateFormat=Zr,e.checkFormulaRef="checkFormulaRef",e.checkIsFormula=k,e.checkMerge="checkMerge",e.checkNumberFormat=Jr,e.checkPrevMerge="checkPrevMerge",e.checkRange=J,e.checkUniqueRange=en,e.clear="clear",e.clearAllFilter="clearAllFilter",e.clearCF="clearCF",e.clearCFRule=bn,e.clearCellRef="clearCellRef",e.clearChartBorder="clearChartBorder",e.clearCopy="clearCopy",e.clearFilter="clearFilter",e.clearFormulaDependentCells=tn,e.clearInvalid="clearInvalid",e.clearRange=dr,e.clearUndoRedoCollection="clearUndoRedoCollection",e.clearViewer=Si,e.click=Xn,e.colWidthChanged=ni,e.collaborativeUpdate="collaborativeUpdate",e.columnIndex=z,e.commputeFormulaValue="commputeFormulaValue",e.completeAction=ci,e.configureLocalizedFormat=Je,e.contentLoaded=Wn,e.contextMenuOpen="contextMenuOpen",e.convertToDefaultFormat=Ze,e.copy=ei,e.count="count",e.createHyperlinkElement="createHyperlinkElement",e.createImageElement=Ni,e.createNoteIndicator="createNoteIndicator",e.created="created",e.cut=Qn,e.dataBound="dataBound",e.dataChanged="dataChanged",e.dataSourceChanged="dataSourceChanged",e.dataValidate="dataValidate",e.dateToInt=ce,e.deInitProperties=ii,e.defaultLocale=Ta,e.deleteAction="delete",e.deleteChart=Ai,e.deleteChartColl="deleteChartColl",e.deleteFormatRange=$,e.deleteHyperlink="deleteHyperlink",e.deleteImage=Fi,e.deleteModel=sn,e.deleteNote="deleteNote",e.destroyComponent=jt,e.dialog=Fa,e.duplicateSheet=Me,e.duplicateSheetFilterHandler=An,e.editAlert=vi,e.editHyperlink="editHyperlink",e.editNote="editNote",e.editOperation=Yn,e.editValue="editValue",e.enableContextMenuItems="enableContextMenuItems",e.enableFileMenuItems="enableFileMenuItems",e.enableFormulaInput="enableFormulaInput",e.enableRibbonTabs="enableRibbonTabs",e.enableToolbarItems="enableToolbarItems",e.evaluate=ge,e.executeTaskAsync=R,e.exportDialog="exportDialog",e.fillColor=ka,e.filterByCellValue="filterByCellValue",e.filterCellKeyDown="filterCellKeyDown",e.filterComplete="filterComplete",e.filterRangeAlert="filterRangeAlert",e.find="find",e.findAllValues="findAllValues",e.findCount="findCount",e.findDlg=mi,e.findHandler="findHandler",e.findKeyUp="findKeyUp",e.findMaxValue=Gt,e.findToolDlg="findToolDlg",e.findWorkbookHandler="findHandler",e.finiteAlert="finiteAlert",e.focus=or,e.focusBorder="focusBorder",e.focusChartBorder="focusChartBorder",e.focusRenameInput="focusRenameInput",e.fontColor=Aa,e.forRefSelRender="forRefSelRender",e.formulaBar="formulaBar",e.formulaBarOperation="formulaBarOperation",e.formulaBarUpdate="formulaBarUpdate",e.formulaInValidation="formulaInValidation",e.formulaKeyUp="formulaKeyUp",e.formulaOperation="formulaOperation",e.freeze="freeze",e.getAddressFromSelectedRange=b,e.getAddressInfo=x,e.getAlphalabel=Xe,e.getAutoDetectFormatParser=ne,e.getBeforeActionData="getBeforeActionData",e.getBorderHeight=tr,e.getBorderWidth=er,e.getBottomOffset=hr,e.getCell=He,e.getCellAddress=g,e.getCellIndexes=u,e.getCellPosition=xt,e.getCellRefValue="getCellRefValue",e.getChartColIdxFromClientX="getChartColIdxFromClientX",e.getChartRowIdxFromClientY="getChartRowIdxFromClientY",e.getChartsIndexes=gr,e.getClientX=Mt,e.getClientY=Bt,e.getColGroupWidth=mt,e.getColIdxFromClientX=Ri,e.getColIndex=f,e.getColorCode=je,e.getColumn=ot,e.getColumnHeaderText=v,e.getColumnWidth=lt,e.getColumnsWidth=dt,e.getCustomColors=_e,e.getDPRValue=Vt,e.getData=ye,e.getDataRange=X,e.getEndEvent=Ft,e.getExcludedColumnWidth=rr,e.getFillInfo="getFillInfo",e.getFilterRange="getFilterRange",e.getFilteredColumn="getFilteredColumn",e.getFormatFromType=Ke,e.getFormattedBarText="getFormattedBarText",e.getFormattedCellObject=Wr,e.getGcd=he,e.getIndexesFromAddress=y,e.getLeadingSpaces=W,e.getLineHeight=Zt,e.getLines=Qt,e.getMaxHgt=ar,e.getMaxSheetId=Oe,e.getModel=be,e.getMoveEvent=Nt,e.getPageX=Ht,e.getPageY=Ut,e.getRangeAddress=m,e.getRangeFromAddress=C,e.getRangeIndexes=c,e.getRequiredModules=ct,e.getRightIdx=pr,e.getRow=Qe,e.getRowHeight=nt,e.getRowIdxFromClientY=Ei,e.getRowsHeight=at,e.getScrollBarWidth=vt,e.getSelectedRange=Ne,e.getSheet=Ae,e.getSheetIndex=Se,e.getSheetIndexByName=Ee,e.getSheetIndexFromAddress=S,e.getSheetIndexFromId=we,e.getSheetName=Le,e.getSheetNameCount=ke,e.getSheetNameFromAddress=Ie,e.getSheetProperties=fr,e.getSiblingsHeight=yt,e.getSingleSelectedRange=Fe,e.getSkeletonVal=Ge,e.getSplittedAddressForColumn=H,e.getStandardHeight=Cr,e.getStartEvent=Rt,e.getSwapRange=w,e.getTextHeight=$t,e.getTextHeightWithBorder=nr,e.getTextSpace="getTextSpace",e.getTextWidth=Jt,e.getTrailingSpaces=G,e.getTypeFromFormat=$e,e.getUniqueRange="getUniqueRange",e.getUpdateUsingRaf=ft,e.getUpdatedFormula=q,e.getUpdatedFormulaOnInsertDelete="getUpdatedFormulaOnInsertDelete",e.getUpdatedRange=se,e.getUpdatedScrollPosition="getUpdatedScrollPosition",e.getValueFromFormat=Ce,e.getViewportIndexes=ee,e.getWorkbookRequiredModules=N,e.getautofillDDB=Rn,e.goToSheet=bi,e.goto=dn,e.gotoDlg=gi,e.hasTemplate=Xt,e.hiddenMerge="hiddenMerge",e.hideAutoFillElement="hideAutoFillElement",e.hideAutoFillOptions="hideAutoFillOptions",e.hideFileMenuItems="hideFileMenuItems",e.hideRibbonTabs="hideRibbonTabs",e.hideSheet=di,e.hideShow=vn,e.hideToolbarItems="hideToolbarItems",e.importProtectWorkbook="importProtectWorkbook",e.inRange=P,e.inView=bt,e.initSheet=Te,e.initiateChart="initiateChart",e.initiateChartModel="initiateChartModel",e.initiateCur="initiateCur",e.initiateCustomSort="initiateCustomSort",e.initiateDataValidation="initiatedatavalidation",e.initiateEdit="initiateEdit",e.initiateFilter="initiateFilter",e.initiateFilterUI=pi,e.initiateFormulaReference="initiateFormulaReference",e.initiateHyperlink="initiateHyperlink",e.initiateSort=rn,e.initiatelink="initiatelink",e.insert="insert",e.insertChart="insertChart",e.insertDesignChart="insertDesignChart",e.insertFormatRange=K,e.insertImage="insertImage",e.insertMerge="insertMerge",e.insertModel=on,e.insertSheetTab="insertSheetTab",e.intToDate=pe,e.invalidData=ui,e.isCellReference=O,e.isChar=T,e.isColumnRange=mr,e.isColumnSelected=L,e.isCustomDateTime=qe,e.isDateTime=ue,e.isDiscontinuousRange=lr,e.isExternalFileLink=Ye,e.isFilterHidden=rt,e.isFormulaBarEdit="isFormulaBarEdit",e.isHeightCheckNeeded=_,e.isHiddenCol=ht,e.isHiddenRow=tt,e.isImported=re,e.isInMultipleRange=M,e.isInRange=B,e.isLocked=U,e.isLockedCells=sr,e.isMouseDown=Tt,e.isMouseMove=Dt,e.isMouseUp=Lt,e.isNavigationKey=Pt,e.isNumber=fe,e.isReadOnly=ae,e.isReadOnlyCells=oe,e.isRowRange=vr,e.isRowSelected=D,e.isSingleCell=E,e.isTouchEnd=Ot,e.isTouchMove=kt,e.isTouchStart=At,e.isUndefined=We,e.isValidCellReference=V,e.isValidation="isValidation",e.keyCodes=Oa,e.keyDown=$n,e.keyUp=Kn,e.locale=Na,e.localeData=Dn,e.localizedFormatAction=kn,e.locateElem=It,e.mergedRange="mergedRange",e.mouseDown="mouseDown",e.mouseUpAfterSelection="mouseUpAfterSelection",e.moveOrDuplicateSheet=In,e.moveSheet=Pe,e.moveSheetHandler=On,e.onContentScroll="onContentScroll",e.onHorizontalScroll="horizontalScroll",e.onSave="onSave",e.onVerticalScroll="verticalScroll",e.openFailure="openFailure",e.openHyperlink="openHyperlink",e.openSuccess="openSuccess",e.overlay="shape",e.overlayEleSize="overlayEleSize",e.parseDecimalNumber=Qr,e.parseFormulaArgument="parseFormulaArgument",e.parseIntValue=ve,e.parseLocaleNumber=Q,e.paste=ti,e.performAutoFill="performAutoFill",e.performUndoRedo=hi,e.positionAutoFillElement="positionAutoFillElement",e.processIdx=xe,e.propertyChange="propertyChange",e.protectCellFormat="protectCellFormat",e.protectSelection="protectSelection",e.protectSheet="protectSheet",e.protectSheetWorkBook="protectSheet",e.protectWorkbook="protectWorkbook",e.protectsheetHandler=un,e.queryCellInfo=cn,e.rangeSelectionByKeydown="rangeSelectionByKeydown",e.reApplyFormula="reApplyFormula",e.readonlyAlert=yi,e.reapplyFilter="reapplyFilter",e.refreshCell="refreshCell",e.refreshCellElement="refreshCellElem",e.refreshChart="refreshChart",e.refreshChartCellModel="refreshChartCellModel",e.refreshChartCellObj=ki,e.refreshChartCellOnInit="refreshChartCellOnInit",e.refreshChartSize=wn,e.refreshCheckbox="refreshCheckbox",e.refreshClipboard="refreshClipboard",e.refreshFilterCellsOnResize=oi,e.refreshFilterRange="refreshFilterRange",e.refreshFormulaDatasource="refreshFormulaDatasource",e.refreshImagePosition="refreshImagePosition",e.refreshImgCellObj=Ii,e.refreshInsertDelete="refreshInsertDelete",e.refreshOverlayElem=wi,e.refreshRibbon="ribbonRefresh",e.refreshRibbonIcons=Sn,e.refreshSheetTabs="refreshSheetTabs",e.removeAllChildren=gt,e.removeContextMenuItems="removeContextMenuItems",e.removeDataValidation=Ci,e.removeDesignChart="removeDesignChart",e.removeElements=br,e.removeHighlight="removeHighlight",e.removeHyperlink=si,e.removeNoteContainer="removeNoteContainer",e.removeRangeEle=wt,e.removeSheetTab=Jn,e.removeUniquecol="removeUniquecol",e.removeWorkbookProtection=Di,e.renameSheetTab="renameSheetTab",e.renderCFDlg="renderCFDlg",e.renderFilterCell="renderFilterCell",e.renderInsertDlg="renderInsertDlg",e.replace=hn,e.replaceAll=pn,e.replaceAllDialog="replaceAllDialog",e.ribbon=qn,e.ribbonClick="ribboClick",e.rowFillHandler="rowFillHandler",e.rowHeightChanged=ri,e.saveCompleted="saveCompleted",e.saveError="saveError",e.selectAutoFillRange="selectAutoFillRange",e.selectRange="selectRange",e.selectionComplete="selectionComplete",e.selectionStatus=Li,e.setActionData="setActionData",e.setAriaOptions=zt,e.setAutoFill=En,e.setAutoFit="setAutoFit",e.setCFRule=yn,e.setCell=Ue,e.setCellFormat=Yr,e.setChart=xn,e.setColMinWidth=cr,e.setColumn=st,e.setFilteredCollection="setFilteredCollection",e.setImage="setImage",e.setLinkModel=nn,e.setLockCells=fn,e.setMaxHgt=ir,e.setMerge=gn,e.setPosition=St,e.setProtectWorkbook=Ti,e.setResize=_t,e.setRow=et,e.setRowEleHeight=Kt,e.setRowHeight=it,e.setStandardHeight=yr,e.setStyleAttribute=Et,e.setTextLineHeight=Wt,e.setUndoRedo="setUndoRedo",e.setVisibleMergeIndex=te,e.setWidthAndHeight=qt,e.sheetCreated="sheetCreated",e.sheetNameUpdate=li,e.sheetRenameUpdate="sheetRenameUpdate",e.sheetTabs="sheetTabs",e.sheetsDestroyed="sheetsDestroyed",e.showAggregate="showAggregate",e.showFindAlert="showFindAlert",e.showNote="showNote",e.showSheet=xi,e.skipDefaultValue=Ve,e.skipHiddenIdx=j,e.sortComplete="sortComplete",e.sortImport="sortImport",e.sortRangeAlert="sortRangeAlert",e.spreadsheetCreated="spreadsheetCreated",e.spreadsheetDestroyed=Gn,e.startEdit="startEdit",e.tabSwitch="tabSwitch",e.textDecorationUpdate="textDecorationUpdate",e.toDate=me,e.toFraction=de,e.toggleProtect="toggleProtect",e.triggerDataChange="triggerDataChange",e.unMerge="unMerge",e.unProtectSheetPassword="unProtectSheetPassword",e.unProtectWorkbook="unProtectWorkbook",e.undoRedoForChartDesign="undoRedoForChartDesign",e.unprotectSheet="unprotectSheet",e.unprotectsheetHandler="unprotectsheetHandler",e.updateAction=Yt,e.updateCFModel=Z,e.updateCell=Y,e.updateHighlight="updateHighlight",e.updateMergeBorder=le,e.updateNoteContainer="updateNoteContainer",e.updateRowColCount="updateRowColCount",e.updateScroll="updateScroll",e.updateScrollValue="updateScrollValue",e.updateSelectedRange=Re,e.updateSheetFromDataSource=_r,e.updateSortCollection=Tn,e.updateSortedDataOnCell="updateSortedDataOnCell",e.updateTableWidth="updateTableWidth",e.updateToggle="updateToggleItem",e.updateToggleItem="updateToggleItem",e.updateTranslate="updateTranslate",e.updateUndoRedoCollection="updateUndoRedoCollection",e.updateUsedRange="updateUsedRange",e.updateView=Nn,e.updateWrapCell="updateWrapCell",e.validationError="validationError",e.virtualContentLoaded="virtualContentLoaded",e.workBookeditAlert="editAlert",e.workbookDestroyed="workbookDestroyed",e.workbookEditOperation=$r,e.workbookFormulaOperation=Kr,e.workbookLocale="spreadsheetLocale",e.workbookOpen="workbookOpen",e.workbookReadonlyAlert="readonlyAlert",e.wrap=ze,e.wrapEvent=an,e}({},ej.base,ej.data,ej.popups,ej.navigations,ej.inputs,ej.buttons,ej.dropdowns,ej.lists,ej.splitbuttons,ej.grids,ej.charts),this.ejs=ej;
//# sourceMappingURL=ej2-spreadsheet.min.js.map
