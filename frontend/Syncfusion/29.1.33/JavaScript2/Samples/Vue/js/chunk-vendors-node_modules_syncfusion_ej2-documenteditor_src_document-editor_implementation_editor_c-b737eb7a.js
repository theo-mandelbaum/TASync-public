"use strict";
/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(self["webpackChunkej2_vue_samples"] = self["webpackChunkej2_vue_samples"] || []).push([["chunk-vendors-node_modules_syncfusion_ej2-documenteditor_src_document-editor_implementation_editor_c-b737eb7a"],{

/***/ "./node_modules/@syncfusion/ej2-documenteditor/src/document-editor/implementation/editor/collaborative-editing.js":
/*!************************************************************************************************************************!*\
  !*** ./node_modules/@syncfusion/ej2-documenteditor/src/document-editor/implementation/editor/collaborative-editing.js ***!
  \************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CollaborativeEditing: () => (/* binding */ CollaborativeEditing)\n/* harmony export */ });\n/* harmony import */ var _viewer_page__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../viewer/page */ \"./node_modules/@syncfusion/ej2-documenteditor/src/document-editor/implementation/viewer/page.js\");\n/* harmony import */ var _selection_selection_helper__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../selection/selection-helper */ \"./node_modules/@syncfusion/ej2-documenteditor/src/document-editor/implementation/selection/selection-helper.js\");\n/* harmony import */ var _syncfusion_ej2_base__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @syncfusion/ej2-base */ \"./node_modules/@syncfusion/ej2-base/index.js\");\n/* harmony import */ var _format_section_format__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../format/section-format */ \"./node_modules/@syncfusion/ej2-documenteditor/src/document-editor/implementation/format/section-format.js\");\n/* harmony import */ var _base_index__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../base/index */ \"./node_modules/@syncfusion/ej2-documenteditor/src/document-editor/base/index.js\");\n/* harmony import */ var _editor_history_index__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../editor-history/index */ \"./node_modules/@syncfusion/ej2-documenteditor/src/document-editor/implementation/editor-history/index.js\");\n/* harmony import */ var _syncfusion_ej2_popups__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @syncfusion/ej2-popups */ \"./node_modules/@syncfusion/ej2-popups/index.js\");\n/* harmony import */ var _format_index__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../format/index */ \"./node_modules/@syncfusion/ej2-documenteditor/src/document-editor/implementation/format/index.js\");\n\n\n\n\n\n\n\n\n\n/**\n * Represents the collaborative editing module\n */\nvar CollaborativeEditing = /** @class */ (function () {\n    function CollaborativeEditing(editor) {\n        this.version = 0;\n        this.owner = editor;\n    }\n    Object.defineProperty(CollaborativeEditing.prototype, \"documentHelper\", {\n        //private lockEnd: string = '';\n        get: function () {\n            return this.owner.documentHelper;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(CollaborativeEditing.prototype, \"selection\", {\n        get: function () {\n            return this.owner.selectionModule;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(CollaborativeEditing.prototype, \"collaborativeEditingSettings\", {\n        get: function () {\n            return this.owner.documentEditorSettings.collaborativeEditingSettings;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    CollaborativeEditing.prototype.getModuleName = function () {\n        return 'CollaborativeEditing';\n    };\n    /**\n     * To update the action which need to perform.\n     *\n     * @param {CollaborativeEditingEventArgs} data Specifies the data.\n     * @returns {void}\n     */\n    CollaborativeEditing.prototype.updateAction = function (data) {\n        if (!Array.isArray(data)) {\n            data = [data];\n        }\n        for (var i = 0; i < data.length; i++) {\n            var documentData = data[parseInt(i.toString(), 10)];\n            switch (documentData.action) {\n                case 'LockContent':\n                    // Transform position\n                    this.transFormLockRegion(documentData);\n                    this.lockRegion(documentData.selectionInfo.start, documentData.selectionInfo.end, documentData.author);\n                    break;\n                case 'SaveContent':\n                    this.version = documentData.version;\n                    this.updateRegion(documentData.author, documentData.data);\n                    break;\n                case 'UnlockContent':\n                    this.version = documentData.version;\n                    this.updateRegion(documentData.author, documentData.data);\n                    this.removeEditRange(documentData.author);\n                    break;\n            }\n        }\n    };\n    CollaborativeEditing.prototype.transFormLockRegion = function (data) {\n        var previousLockInfo = data.selectionInfo.previousLockInfo;\n        if (!(0,_syncfusion_ej2_base__WEBPACK_IMPORTED_MODULE_2__.isNullOrUndefined)(previousLockInfo)) {\n            var author = previousLockInfo.author;\n            var sectionDiff = 0;\n            var blockDiff = 0;\n            if (this.documentHelper.editRanges.containsKey(author)) {\n                var editRange = this.documentHelper.editRanges.get(author);\n                if (editRange.length > 0) {\n                    var position = this.selection.getPosition(editRange[0]);\n                    var endOffset = this.selection.getHierarchicalIndexByPosition(position.endPosition).split(';');\n                    var previousOffset = previousLockInfo.end.split(';');\n                    sectionDiff = parseInt(endOffset[0], 10) - parseInt(previousOffset[0], 10);\n                    blockDiff = parseInt(endOffset[1], 10) - parseInt(previousOffset[1], 10);\n                    // Same section\n                    if (data.selectionInfo.start.split(';')[0] === previousLockInfo.end.split(';')[0]) {\n                        data.selectionInfo.start = this.tranformPosition(data.selectionInfo.start, sectionDiff, blockDiff);\n                        data.selectionInfo.end = this.tranformPosition(data.selectionInfo.end, sectionDiff, blockDiff);\n                    }\n                    else {\n                        data.selectionInfo.start = this.tranformPosition(data.selectionInfo.start, sectionDiff, 0);\n                        data.selectionInfo.end = this.tranformPosition(data.selectionInfo.end, sectionDiff, 0);\n                    }\n                }\n            }\n        }\n    };\n    /**\n     * Lock selected region from editing by other users.\n     *\n     * @param {string} user Specifies the user.\n     * @returns {void}\n     */\n    CollaborativeEditing.prototype.lockContent = function (user) {\n        var _this = this;\n        if (this.canLock()) {\n            var start = this.owner.selectionModule.start;\n            var end = this.owner.selectionModule.end;\n            if (!this.owner.selectionModule.isForward) {\n                start = this.owner.selectionModule.end;\n                end = this.owner.selectionModule.start;\n            }\n            if (start.paragraph.isInsideTable) {\n                var table = this.owner.documentHelper.layout.getParentTable(start.paragraph);\n                var firstPara = this.owner.documentHelper.getFirstParagraphBlock(table);\n                start.setPosition(firstPara.childWidgets[0], true);\n            }\n            else {\n                start.paragraphStartInternal(this.owner.selectionModule, false);\n            }\n            if (end.paragraph.isInsideTable) {\n                var table = this.owner.documentHelper.layout.getParentTable(end.paragraph);\n                var lastPara = this.owner.documentHelper.getLastParagraphBlock(table);\n                var offset = lastPara.lastChild.getEndOffset();\n                end.setPositionParagraph(lastPara.lastChild, offset);\n            }\n            else {\n                end.moveToParagraphEndInternal(this.owner.selectionModule, false);\n            }\n            var startOffset = this.owner.selectionModule.getHierarchicalIndexByPosition(start);\n            var endOffset = this.owner.selectionModule.getHierarchicalIndexByPosition(end);\n            var selectionInfo_1 = {\n                start: startOffset,\n                end: endOffset,\n                roomName: this.owner.documentEditorSettings.collaborativeEditingSettings.roomName,\n                author: (0,_syncfusion_ej2_base__WEBPACK_IMPORTED_MODULE_2__.isNullOrUndefined)(user) ? this.owner.currentUser : user,\n                version: this.version\n            };\n            var startInfo_1 = this.selection.getParagraphInfo(start);\n            var endInfo_1 = this.selection.getParagraphInfo(end);\n            this.owner.selectionModule.select(startOffset, endOffset);\n            var ajax = new _base_index__WEBPACK_IMPORTED_MODULE_4__.XmlHttpRequestHandler();\n            ajax.url = this.owner.serviceUrl + this.owner.serverActionSettings.canLock;\n            ajax.contentType = 'application/json;charset=UTF-8';\n            ajax.onSuccess = function (result) {\n                _this.successHandler(result, selectionInfo_1, startInfo_1, endInfo_1);\n            };\n            ajax.onFailure = this.failureHandler.bind(this);\n            ajax.onError = this.failureHandler.bind(this);\n            ajax.customHeaders = this.owner.headers;\n            ajax.send(selectionInfo_1);\n        }\n    };\n    /**\n     * @private\n     * @returns {boolean} - Returns can lock.\n     */\n    CollaborativeEditing.prototype.canLock = function () {\n        var editRanges = this.documentHelper.editRanges;\n        if (editRanges.containsKey(this.owner.currentUser)) {\n            return false;\n        }\n        var userNames = editRanges.keys;\n        for (var i = 0; i < userNames.length; i++) {\n            var range = editRanges.get(userNames[parseInt(i.toString(), 10)]);\n            if (!(0,_syncfusion_ej2_base__WEBPACK_IMPORTED_MODULE_2__.isNullOrUndefined)(range) && range.length > 0) {\n                if (this.isSelectionInEditableRange(range[0])) {\n                    return false;\n                }\n            }\n        }\n        return true;\n    };\n    CollaborativeEditing.prototype.getPreviousLockedRegion = function () {\n        var editRanges = this.documentHelper.editRanges;\n        if (editRanges.containsKey(this.owner.currentUser)) {\n            return undefined;\n        }\n        var previous;\n        var userNames = editRanges.keys;\n        for (var i = 0; i < userNames.length; i++) {\n            var range = editRanges.get(userNames[parseInt(i.toString(), 10)])[0];\n            var startPosition = this.selection.getPosition(range).startPosition;\n            if (startPosition.isExistBefore(this.selection.start)) {\n                if ((0,_syncfusion_ej2_base__WEBPACK_IMPORTED_MODULE_2__.isNullOrUndefined)(previous)) {\n                    previous = range;\n                }\n                else if (startPosition.isExistAfter(this.selection.getPosition(previous).startPosition)) {\n                    previous = range;\n                }\n            }\n        }\n        return previous;\n    };\n    /**\n     * @private\n     * @param {string} user - Specifies the user.\n     * @returns {void}\n     */\n    CollaborativeEditing.prototype.unlockContent = function (user) {\n        if (this.documentHelper.editRanges.containsKey(user)) {\n            if (this.saveTimer) {\n                clearTimeout(this.saveTimer);\n            }\n            var sfdtContent = JSON.stringify(this.serializeEditableRegion(user));\n            var saveObject = {\n                action: 'UnlockContent',\n                author: user,\n                version: this.version,\n                data: sfdtContent,\n                selectionInfo: {\n                    start: '',\n                    end: '',\n                    roomName: this.collaborativeEditingSettings.roomName,\n                    author: this.owner.currentUser,\n                    version: this.version\n                },\n                roomName: this.collaborativeEditingSettings.roomName\n            };\n            this.removeEditRange(user);\n            this.owner.editorHistoryModule.clearHistory();\n            this.owner.fireContentChange();\n            // Todo: selection tranformation\n            this.owner.trigger(_base_index__WEBPACK_IMPORTED_MODULE_4__.actionCompleteEvent, saveObject);\n        }\n    };\n    CollaborativeEditing.prototype.removeEditRange = function (user) {\n        if (this.documentHelper.editRanges.containsKey(user)) {\n            this.updateLockRegion(user, false);\n            this.owner.editorModule.removeUserRestrictionsInternal(this.documentHelper.editRanges.get(user)[0]);\n            this.documentHelper.clearContent();\n            this.selection.updateEditRangeCollection();\n            this.documentHelper.owner.viewer.updateScrollBars();\n        }\n    };\n    /**\n     * Save locked content to other clients.\n     *\n     * @private\n     * @returns {void}\n     */\n    CollaborativeEditing.prototype.saveContent = function () {\n        var _this = this;\n        if (this.saveTimer) {\n            clearTimeout(this.saveTimer);\n        }\n        var timeOut = this.collaborativeEditingSettings.saveTimeout;\n        if ((0,_syncfusion_ej2_base__WEBPACK_IMPORTED_MODULE_2__.isNullOrUndefined)(timeOut)) {\n            timeOut = 3000;\n        }\n        this.saveTimer = Number(setTimeout(function () {\n            _this.saveContentInternal();\n        }, timeOut));\n    };\n    CollaborativeEditing.prototype.saveContentInternal = function () {\n        if (this.documentHelper.editRanges.containsKey(this.owner.currentUser)) {\n            var editRangeStart = this.documentHelper.editRanges.get(this.owner.currentUser)[0];\n            var position = this.selection.getPosition(editRangeStart);\n            var saveObject = {\n                action: 'SaveContent',\n                author: this.owner.currentUser,\n                version: this.version,\n                data: JSON.stringify(this.serializeEditableRegion(this.owner.currentUser)),\n                selectionInfo: {\n                    'start': this.selection.getHierarchicalIndexByPosition(position.startPosition),\n                    'end': this.selection.getHierarchicalIndexByPosition(position.endPosition),\n                    roomName: this.collaborativeEditingSettings.roomName,\n                    author: this.owner.currentUser,\n                    version: this.version\n                },\n                roomName: this.collaborativeEditingSettings.roomName\n            };\n            this.owner.trigger(_base_index__WEBPACK_IMPORTED_MODULE_4__.actionCompleteEvent, saveObject);\n        }\n    };\n    CollaborativeEditing.prototype.serializeEditableRegion = function (user) {\n        var startElement = this.documentHelper.editRanges.get(user)[0];\n        var endElement = startElement.editRangeEnd;\n        var start = new _selection_selection_helper__WEBPACK_IMPORTED_MODULE_1__.TextPosition(this.owner);\n        start.setPosition(startElement.line, true);\n        var end = new _selection_selection_helper__WEBPACK_IMPORTED_MODULE_1__.TextPosition(this.owner);\n        end.setPosition(endElement.line, false);\n        this.owner.sfdtExportModule.isPartialExport = true;\n        /* eslint-disable-next-line max-len */\n        var sfdtContent = this.owner.sfdtExportModule.write(0, start.currentWidget, start.offset, end.currentWidget, end.offset, false);\n        this.owner.sfdtExportModule.isPartialExport = false;\n        return sfdtContent;\n    };\n    /* eslint-disable-next-line max-len */\n    CollaborativeEditing.prototype.successHandler = function (result, selectionInfo, startInfo, endInfo) {\n        var canLock = JSON.parse(result.data).canLock;\n        if (canLock) {\n            selectionInfo.start = this.selection.getHierarchicalIndex(startInfo.paragraph, startInfo.offset.toString());\n            selectionInfo.end = this.selection.getHierarchicalIndex(endInfo.paragraph, endInfo.offset.toString());\n            var previousEditRange = this.getPreviousLockedRegion();\n            if (previousEditRange) {\n                var position = this.selection.getPosition(previousEditRange);\n                selectionInfo.previousLockInfo = {\n                    start: this.selection.getHierarchicalIndexByPosition(position.startPosition),\n                    end: this.selection.getHierarchicalIndexByPosition(position.endPosition),\n                    author: previousEditRange.user,\n                    roomName: '',\n                    version: 0\n                };\n            }\n            var lockObject = {\n                action: 'LockContent',\n                selectionInfo: selectionInfo,\n                author: this.owner.currentUser,\n                version: this.version,\n                data: '',\n                roomName: this.collaborativeEditingSettings.roomName\n            };\n            this.owner.trigger(_base_index__WEBPACK_IMPORTED_MODULE_4__.actionCompleteEvent, lockObject);\n        }\n        else {\n            var localizeValue = new _syncfusion_ej2_base__WEBPACK_IMPORTED_MODULE_2__.L10n('documenteditor', this.owner.defaultLocale);\n            localizeValue.setLocale(this.owner.locale);\n            _syncfusion_ej2_popups__WEBPACK_IMPORTED_MODULE_6__.DialogUtility.alert({\n                content: localizeValue.getConstant('Already locked'),\n                closeOnEscape: true, showCloseIcon: true, position: { X: 'Center', Y: 'Center' }\n            }).enableRtl = this.owner.enableRtl;\n        }\n    };\n    CollaborativeEditing.prototype.failureHandler = function () {\n        var localizeValue = new _syncfusion_ej2_base__WEBPACK_IMPORTED_MODULE_2__.L10n('documenteditor', this.owner.defaultLocale);\n        localizeValue.setLocale(this.owner.locale);\n        _syncfusion_ej2_popups__WEBPACK_IMPORTED_MODULE_6__.DialogUtility.alert({\n            content: localizeValue.getConstant('Error in establishing connection with web server'),\n            closeOnEscape: true, showCloseIcon: true, position: { X: 'Center', Y: 'Center' }\n        }).enableRtl = this.owner.enableRtl;\n    };\n    /**\n     * Locker specified region for specified user.\n     *\n     * @private\n     * @param {string} start - Specified the selection start.\n     * @param {string} end - Specifies the selection end.\n     * @param {string} user - Specifies the user\n     * @returns {void}\n     */\n    CollaborativeEditing.prototype.lockRegion = function (start, end, user) {\n        var startPosition = this.selection.getTextPosBasedOnLogicalIndex(start);\n        var endPosition = this.selection.getTextPosBasedOnLogicalIndex(end);\n        this.lockRegionInternal(startPosition, endPosition, user);\n    };\n    CollaborativeEditing.prototype.lockRegionInternal = function (start, end, user) {\n        var editStart = this.owner.editorModule.addEditElement(user);\n        var editEnd = editStart.editRangeEnd;\n        this.insertElements(start, end, [editEnd], [editStart]);\n        this.updateLockInfo(editStart.paragraph, editEnd.paragraph, user, true);\n        this.owner.viewer.updateScrollBars();\n    };\n    CollaborativeEditing.prototype.insertElements = function (start, end, endElements, startElements) {\n        var isSamePara = start.paragraph.equals(end.paragraph);\n        if (!(0,_syncfusion_ej2_base__WEBPACK_IMPORTED_MODULE_2__.isNullOrUndefined)(startElements)) {\n            this.insertElementsInternal(start, startElements);\n        }\n        if (!(0,_syncfusion_ej2_base__WEBPACK_IMPORTED_MODULE_2__.isNullOrUndefined)(endElements)) {\n            this.insertElementsInternal(end, endElements);\n        }\n        this.documentHelper.layout.reLayoutParagraph(startElements[0].paragraph, 0, 0);\n        if (!isSamePara) {\n            this.documentHelper.layout.reLayoutParagraph(endElements[0].paragraph, 0, 0);\n        }\n    };\n    CollaborativeEditing.prototype.insertElementsInternal = function (position, elements) {\n        var indexInInline = 0;\n        if (position.paragraph.isEmpty()) {\n            var paragraph = position.paragraph;\n            paragraph.childWidgets[0].children.push(elements[0]);\n            elements[0].line = paragraph.childWidgets[0];\n        }\n        else {\n            var inlineObj = position.currentWidget.getInline(position.offset, indexInInline);\n            var curInline = inlineObj.element;\n            indexInInline = inlineObj.index;\n            var firstElement = elements[0];\n            this.insertElementInternal(curInline, firstElement, indexInInline);\n            var index = firstElement.indexInOwner;\n            var lastElement = firstElement;\n            for (var i = 1; i < elements.length; i++) {\n                lastElement = elements[parseInt(i.toString(), 10)];\n                firstElement.line.children.splice(index + i, 0, lastElement);\n            }\n        }\n    };\n    CollaborativeEditing.prototype.insertElementInternal = function (element, newElement, index) {\n        var line = element.line;\n        var paragraph = line.paragraph;\n        var insertIndex = element.indexInOwner;\n        var isBidi = paragraph.paragraphFormat.bidi && element.isRightToLeft;\n        if (index === element.length) {\n            // Add new Element in current\n            if (!isBidi) {\n                insertIndex++;\n            }\n            line.children.splice(insertIndex, 0, newElement);\n        }\n        else if (index === 0) {\n            if ((0,_syncfusion_ej2_base__WEBPACK_IMPORTED_MODULE_2__.isNullOrUndefined)(element.previousNode)) {\n                line.children.splice(0, 0, newElement);\n                insertIndex = 0;\n            }\n            else {\n                line.children.splice(insertIndex, 0, newElement);\n            }\n        }\n        newElement.line = element.line;\n    };\n    //#region Save content\n    CollaborativeEditing.prototype.setEditableRegion = function () {\n        if (this.documentHelper.editRanges.containsKey(this.owner.currentUser)) {\n            var editRanges = this.documentHelper.editRanges.get(this.owner.currentUser);\n            var editRangeStart = editRanges[0];\n            var firstBlock = this.getParentBlock(editRangeStart.paragraph);\n            this.lockStart = this.owner.selectionModule.getHierarchicalIndex(firstBlock, '0').split(';');\n        }\n    };\n    CollaborativeEditing.prototype.isSelectionInEditableRange = function (editRange) {\n        var _a;\n        if (!(0,_syncfusion_ej2_base__WEBPACK_IMPORTED_MODULE_2__.isNullOrUndefined)(this.owner.selectionModule)) {\n            var start = this.owner.selectionModule.start;\n            var end = this.owner.selectionModule.end;\n            if (!this.owner.selectionModule.isForward) {\n                _a = [end, start], start = _a[0], end = _a[1];\n            }\n            var position = this.owner.selectionModule.getPosition(editRange);\n            if ((start.isExistAfter(position.startPosition) || start.isAtSamePosition(position.startPosition))\n                && (end.isExistBefore(position.endPosition) || end.isAtSamePosition(position.endPosition)) ||\n                ((position.startPosition.isExistAfter(start) || position.startPosition.isAtSamePosition(start))\n                    && (position.endPosition.isExistBefore(end) || position.endPosition.isAtSamePosition(end))) ||\n                (position.startPosition.isExistAfter(start) && position.startPosition.isExistBefore(end)\n                    && (end.isExistAfter(position.endPosition) || end.isExistBefore(position.endPosition))) ||\n                (position.endPosition.isExistBefore(end) && position.endPosition.isExistAfter(start)\n                    && (start.isExistBefore(position.startPosition) || start.isExistAfter(position.startPosition)))) {\n                return true;\n            }\n        }\n        return false;\n    };\n    /**\n     * Updated modified content from remote user\n     *\n     * @returns {void}\n     */\n    /* eslint-disable  */\n    CollaborativeEditing.prototype.updateRegion = function (user, content) {\n        if (this.documentHelper.editRanges.containsKey(user)) {\n            var editRanges = this.documentHelper.editRanges.get(user);\n            if (editRanges.length === 1) {\n                // Remove exisiting range  from collection.\n                // New range will get inserted while updating the content.\n                this.documentHelper.editRanges.remove(user);\n                editRanges[0].removeEditRangeMark();\n            }\n            // Preserve hierachical position for history position tranformation\n            this.setEditableRegion();\n            var startElement = editRanges[0];\n            var endElement = startElement.editRangeEnd;\n            var firstBlock = this.getParentBlock(startElement.paragraph);\n            var lastBlock = this.getParentBlock(endElement.paragraph);\n            var isInEditRange = this.isSelectionInEditableRange(startElement);\n            var startParagrahInfo = void 0;\n            var endParagrahInfo = void 0;\n            this.owner.editorModule.isRemoveRevision = true;\n            if (!isInEditRange) {\n                startParagrahInfo = this.owner.selectionModule.getParagraphInfo(this.owner.selectionModule.start);\n                endParagrahInfo = this.owner.selectionModule.getParagraphInfo(this.owner.selectionModule.end);\n            }\n            var sections = [];\n            while (lastBlock !== firstBlock) {\n                var currentBlock = lastBlock.combineWidget(this.owner.viewer);\n                lastBlock = currentBlock.previousRenderedWidget;\n                if (lastBlock.bodyWidget.index !== currentBlock.bodyWidget.index) {\n                    sections.push(currentBlock.bodyWidget);\n                }\n                var removedBlock = currentBlock.containerWidget.childWidgets[currentBlock.indexInOwner];\n                this.removeDuplicateCollection(removedBlock);\n                currentBlock.containerWidget.removeChild(currentBlock.indexInOwner);\n            }\n            if (!(0,_syncfusion_ej2_base__WEBPACK_IMPORTED_MODULE_2__.isNullOrUndefined)(firstBlock)) {\n                var lastBockIndex = firstBlock.index;\n                var containerWidget = firstBlock.containerWidget;\n                sections.push(containerWidget);\n                var lastInsertIndex = firstBlock.containerWidget.childWidgets.indexOf(firstBlock);\n                var removedBlock = containerWidget.childWidgets[lastInsertIndex];\n                containerWidget.removeChild(lastInsertIndex);\n                this.removeDuplicateCollection(removedBlock);\n                var comments = [];\n                var blocks = [];\n                var revision = [];\n                this.owner.editorModule.isPasteListUpdated = false;\n                this.owner.editorModule.getBlocks(JSON.parse(content), false, blocks, comments, revision);\n                if (sections.length !== blocks.length) {\n                    if (sections.length === 1) {\n                        var bodyWidget = sections[0];\n                        sections.unshift(this.owner.editorModule.splitBodyWidget(bodyWidget, blocks[blocks.length - 2].sectionFormat, bodyWidget.childWidgets[lastInsertIndex - 1]));\n                    }\n                    if (sections.length < blocks.length) {\n                        for (var m = 1; m < blocks.length - 1; m++) {\n                            var page = new _viewer_page__WEBPACK_IMPORTED_MODULE_0__.Page(this.owner.documentHelper);\n                            var bodyWidget = new _viewer_page__WEBPACK_IMPORTED_MODULE_0__.BodyWidget();\n                            page.bodyWidgets.push(bodyWidget);\n                            bodyWidget.page = page;\n                            sections.splice(m, 0, bodyWidget);\n                            bodyWidget.index = sections[m - 1].index;\n                            bodyWidget.sectionFormat = new _format_section_format__WEBPACK_IMPORTED_MODULE_3__.WSectionFormat(bodyWidget);\n                            bodyWidget.sectionFormat.copyFormat(blocks[m].sectionFormat);\n                            var pageIndex = sections[m - 1].page.index;\n                            this.documentHelper.insertPage(pageIndex, page);\n                            //Todo: update section index\n                            this.owner.editorModule.updateSectionIndex(sections[m - 1].sectionFormat, sections[m - 1], true);\n                            if (sections.length === blocks.length) {\n                                break;\n                            }\n                        }\n                    }\n                }\n                for (var z = 0; z < sections.length; z++) {\n                    var containerWidget_1 = sections[z];\n                    var blockIndex = 0;\n                    var insertIndex = 0;\n                    if (z === sections.length - 1) {\n                        blockIndex = lastBockIndex;\n                        insertIndex = lastInsertIndex;\n                    }\n                    var block = blocks[z].childWidgets;\n                    for (var i = 0; i < block.length; i++) {\n                        block[i].containerWidget = containerWidget_1;\n                        block[i].index = blockIndex;\n                        containerWidget_1.childWidgets.splice(insertIndex, 0, block[i]);\n                        insertIndex++;\n                        blockIndex++;\n                    }\n                    lastBlock = block[block.length - 1];\n                    if (lastBlock.nextRenderedWidget && lastBlock.nextRenderedWidget.index !== lastBlock.index) {\n                        //Todo: update block index properly\n                        this.updateNextBlocksIndex(lastBlock, true);\n                    }\n                    this.documentHelper.layout.layoutBodyWidgetCollection(block[0].index, containerWidget_1, undefined, false);\n                }\n                for (var k = 0; k < comments.length; k++) {\n                    var comment = comments[k];\n                    this.owner.editorModule.addCommentWidget(comment, false, this.owner.showComments, false);\n                    if (comment.replyComments.length > 0) {\n                        for (var z = 0; z < comment.replyComments.length; z++) {\n                            this.owner.commentReviewPane.addReply(comment.replyComments[z], false, false);\n                        }\n                    }\n                }\n                if (revision.length > 0) {\n                    this.updateRevisionCollection(revision);\n                }\n                this.owner.trackChangesPane.updateTrackChanges();\n                var editRanges_1 = this.documentHelper.editRanges.get(user);\n                // update content\n                if (!isInEditRange) {\n                    this.tranformSelection(startParagrahInfo, endParagrahInfo);\n                }\n                else {\n                    if (editRanges_1.length > 0) {\n                        var positionInfo = this.selection.getPosition(editRanges_1[0]);\n                        // We can't able to predic the modified content inside editable region\n                        // So, it not possible to transform the position relativly.\n                        // So, move the selection to editable region end.\n                        this.selection.selectPosition(positionInfo.endPosition, positionInfo.endPosition);\n                    }\n                }\n                this.tranformHistoryPosition();\n                this.selection.updateEditRangeCollection();\n                this.updateLockRegion(user);\n                this.documentHelper.removeEmptyPages();\n                this.owner.viewer.updateScrollBars();\n                this.owner.editorModule.isRemoveRevision = false;\n            }\n        }\n    };\n    CollaborativeEditing.prototype.updateRevisionCollection = function (revision) {\n        var insertIndex = 0;\n        var revisionStart = this.getRevisionTextPosition(revision[0]);\n        var isInsert = false;\n        if (this.owner.revisionsInternal.changes.length > 0 &&\n            !(0,_syncfusion_ej2_base__WEBPACK_IMPORTED_MODULE_2__.isNullOrUndefined)(revisionStart)) {\n            for (var i = 0; i < this.owner.revisionsInternal.changes.length; i++) {\n                var textPosition = this.getRevisionTextPosition(this.owner.revisionsInternal.changes[i]);\n                if (textPosition.isExistAfter(revisionStart)) {\n                    insertIndex = i;\n                    isInsert = true;\n                    break;\n                }\n            }\n        }\n        for (var j = 0; j < revision.length; j++) {\n            if (isInsert) {\n                this.owner.revisionsInternal.changes.splice(insertIndex, 0, revision[j]);\n                insertIndex++;\n            }\n            else {\n                this.owner.revisionsInternal.changes.push(revision[j]);\n            }\n        }\n    };\n    /* eslint-disable @typescript-eslint/no-explicit-any */\n    CollaborativeEditing.prototype.getRevisionTextPosition = function (revision) {\n        if (revision.range.length > 0) {\n            var range = revision.range[0];\n            if (range instanceof _viewer_page__WEBPACK_IMPORTED_MODULE_0__.ElementBox) {\n                return this.selection.getElementPosition(range).startPosition;\n            }\n            else if (range instanceof _format_index__WEBPACK_IMPORTED_MODULE_7__.WRowFormat) {\n                var block = range.ownerBase.firstChild.firstChild;\n                if (block.bodyWidget) {\n                    return this.selection.getTextPosBasedOnLogicalIndex(this.selection.getHierarchicalIndex(block, '0'));\n                }\n            }\n            else if (range instanceof _format_index__WEBPACK_IMPORTED_MODULE_7__.WCharacterFormat) {\n                var paraWidget = range.ownerBase;\n                if (paraWidget.lastChild.paragraph.bodyWidget) {\n                    var offset = paraWidget.getLength();\n                    var startPosition = new _selection_selection_helper__WEBPACK_IMPORTED_MODULE_1__.TextPosition(this.owner);\n                    startPosition.setPositionParagraph(paraWidget.lastChild, offset);\n                    return startPosition;\n                }\n            }\n        }\n        return undefined;\n    };\n    /* eslint-enable @typescript-eslint/no-explicit-any */\n    CollaborativeEditing.prototype.tranformSelection = function (startParagrahInfo, endParagraphInfo) {\n        this.documentHelper.skipScrollToPosition = true;\n        var startIndex = this.selection.getHierarchicalIndex(startParagrahInfo.paragraph, startParagrahInfo.offset.toString());\n        var endIndex = this.selection.getHierarchicalIndex(endParagraphInfo.paragraph, endParagraphInfo.offset.toString());\n        this.selection.select(startIndex, endIndex);\n    };\n    CollaborativeEditing.prototype.tranformHistoryPosition = function () {\n        if (this.documentHelper.editRanges.containsKey(this.owner.currentUser)) {\n            var editRanges = this.documentHelper.editRanges.get(this.owner.currentUser);\n            var startElement = editRanges[0];\n            var startBlock = this.getParentBlock(startElement.paragraph);\n            var startOffset = this.selection.getHierarchicalIndex(startBlock, '0').split(';');\n            if (!(0,_syncfusion_ej2_base__WEBPACK_IMPORTED_MODULE_2__.isNullOrUndefined)(this.lockStart) && this.lockStart.length > 1) {\n                var sectionDiff = parseInt(startOffset[0], 10) - parseInt(this.lockStart[0], 10);\n                var blockDiff = parseInt(startOffset[1], 10) - parseInt(this.lockStart[1], 10);\n                this.transformHistory(sectionDiff, blockDiff);\n            }\n        }\n    };\n    CollaborativeEditing.prototype.transformHistory = function (sectionDiff, blockDiff) {\n        if (this.owner.enableEditorHistory) {\n            var undoStack = this.owner.editorHistoryModule.undoStack;\n            if (!(0,_syncfusion_ej2_base__WEBPACK_IMPORTED_MODULE_2__.isNullOrUndefined)(undoStack)) {\n                for (var i = 0; i < undoStack.length; i++) {\n                    this.transformBaseHistoryInfo(undoStack[i], sectionDiff, blockDiff);\n                }\n            }\n            var redoStack = this.owner.editorHistoryModule.redoStack;\n            if (!(0,_syncfusion_ej2_base__WEBPACK_IMPORTED_MODULE_2__.isNullOrUndefined)(redoStack)) {\n                for (var i = 0; i < redoStack.length; i++) {\n                    this.transformBaseHistoryInfo(redoStack[i], sectionDiff, blockDiff);\n                }\n            }\n        }\n    };\n    CollaborativeEditing.prototype.transformBaseHistoryInfo = function (baseHistoryInfo, sectionDiff, blockDiff) {\n        if (baseHistoryInfo.endPosition) {\n            baseHistoryInfo.endPosition = this.tranformPosition(baseHistoryInfo.endPosition, sectionDiff, blockDiff);\n        }\n        if (baseHistoryInfo.insertPosition) {\n            baseHistoryInfo.insertPosition = this.tranformPosition(baseHistoryInfo.insertPosition, sectionDiff, blockDiff);\n        }\n        if (baseHistoryInfo.selectionStart) {\n            baseHistoryInfo.selectionStart = this.tranformPosition(baseHistoryInfo.selectionStart, sectionDiff, blockDiff);\n        }\n        if (baseHistoryInfo.selectionEnd) {\n            baseHistoryInfo.selectionEnd = this.tranformPosition(baseHistoryInfo.selectionEnd, sectionDiff, blockDiff);\n        }\n        if (baseHistoryInfo instanceof _editor_history_index__WEBPACK_IMPORTED_MODULE_5__.HistoryInfo) {\n            var modifiedActions = baseHistoryInfo.modifiedActions;\n            for (var j = 0; j < modifiedActions.length; j++) {\n                this.transformBaseHistoryInfo(modifiedActions[j], sectionDiff, blockDiff);\n            }\n        }\n    };\n    CollaborativeEditing.prototype.tranformPosition = function (position, sectionDiff, blockDiff) {\n        var index = position.split(';');\n        index[0] = (parseInt(index[0], 10) + sectionDiff).toString();\n        index[1] = (parseInt(index[1], 10) + blockDiff).toString();\n        return index.join(';');\n    };\n    CollaborativeEditing.prototype.getParentBlock = function (block) {\n        if (block.isInsideTable) {\n            block = this.owner.documentHelper.layout.getParentTable(block);\n        }\n        return block.combineWidget(this.owner.viewer);\n    };\n    //#endregion\n    //#region Remove existing items in locked region\n    CollaborativeEditing.prototype.removeDuplicateCollection = function (removedBlock) {\n        this.removeFieldInBlock(removedBlock, false, false);\n        this.removeFieldInBlock(removedBlock, true, false);\n        this.removeFieldInBlock(removedBlock, false, true);\n        if (removedBlock instanceof _viewer_page__WEBPACK_IMPORTED_MODULE_0__.TableWidget) {\n            for (var i = 0; i < removedBlock.childWidgets.length; i++) {\n                if (removedBlock.childWidgets[i] instanceof _viewer_page__WEBPACK_IMPORTED_MODULE_0__.TableRowWidget) {\n                    var tableDelete = removedBlock.childWidgets[i];\n                    this.owner.editorModule.removeDeletedCellRevision(tableDelete);\n                }\n            }\n        }\n        else {\n            this.owner.editorModule.removeRevisionForBlock(removedBlock, undefined, false, false);\n        }\n    };\n    CollaborativeEditing.prototype.removeFieldInBlock = function (block, isBookmark, contentControl) {\n        if (block instanceof _viewer_page__WEBPACK_IMPORTED_MODULE_0__.TableWidget) {\n            this.removeFieldTable(block, isBookmark, contentControl);\n        }\n        else {\n            this.owner.editorModule.removeField(block, isBookmark, contentControl);\n            this.removeComment(block);\n        }\n    };\n    CollaborativeEditing.prototype.removeFieldTable = function (table, isBookmark, contentControl) {\n        for (var i = 0; i < table.childWidgets.length; i++) {\n            var rowWidget = table.childWidgets[i];\n            for (var j = 0; j < rowWidget.childWidgets.length; j++) {\n                var widget = rowWidget.childWidgets[j];\n                for (var i_1 = 0; i_1 < widget.childWidgets.length; i_1++) {\n                    this.removeFieldInBlock(widget.childWidgets[i_1], isBookmark, contentControl);\n                }\n            }\n        }\n    };\n    CollaborativeEditing.prototype.removeComment = function (block) {\n        if (this.documentHelper.comments.length > 0) {\n            for (var i = 0; i < this.documentHelper.comments.length; i++) {\n                var comment = this.documentHelper.comments[i];\n                if (comment.commentStart.line.paragraph === block) {\n                    this.documentHelper.comments.splice(i, 1);\n                    this.owner.commentReviewPane.deleteComment(comment);\n                    i--;\n                }\n            }\n        }\n    };\n    //#endregion\n    CollaborativeEditing.prototype.updateNextBlocksIndex = function (block, increaseIndex) {\n        var nextBlock = block.getSplitWidgets().pop().nextRenderedWidget;\n        var incrementCount = 1;\n        if (nextBlock.bodyWidget.index === block.bodyWidget.index) {\n            incrementCount = block.index - nextBlock.index + 1;\n        }\n        var nextIndex = block.containerWidget.childWidgets.indexOf(block) + 1;\n        if (block.containerWidget instanceof _viewer_page__WEBPACK_IMPORTED_MODULE_0__.BodyWidget) {\n            var sectionIndex = block.containerWidget.index;\n            var pageIndex = this.documentHelper.pages.indexOf(block.containerWidget.page);\n            for (var j = pageIndex; j < this.documentHelper.pages.length; j++) {\n                var page = this.documentHelper.pages[j];\n                if (page.bodyWidgets[0].index === sectionIndex) {\n                    for (var k = nextIndex; k < page.bodyWidgets[0].childWidgets.length; k++) {\n                        var childWidget = page.bodyWidgets[0].childWidgets[k];\n                        childWidget.index += incrementCount;\n                    }\n                    nextIndex = 0;\n                }\n                else {\n                    return;\n                }\n            }\n        }\n    };\n    /**\n     * Update locked region highlight.\n     *\n     * @private\n     * @param {string} user - Specified the user.\n     * @param {boolean} isLocked - Specifies the isLocked.\n     * @returns {void}\n     */\n    CollaborativeEditing.prototype.updateLockRegion = function (user, isLocked) {\n        if ((0,_syncfusion_ej2_base__WEBPACK_IMPORTED_MODULE_2__.isNullOrUndefined)(user)) {\n            user = this.owner.currentUser;\n        }\n        isLocked = (0,_syncfusion_ej2_base__WEBPACK_IMPORTED_MODULE_2__.isNullOrUndefined)(isLocked) ? true : isLocked;\n        if (this.documentHelper.editRanges.containsKey(user)) {\n            var editRanges = this.documentHelper.editRanges.get(user);\n            if (editRanges.length === 1 && !(0,_syncfusion_ej2_base__WEBPACK_IMPORTED_MODULE_2__.isNullOrUndefined)(editRanges[0].editRangeEnd)) {\n                var editStart = editRanges[0];\n                this.updateLockInfo(editStart.paragraph, editStart.editRangeEnd.paragraph, user, isLocked);\n            }\n        }\n    };\n    CollaborativeEditing.prototype.updateLockInfo = function (startBlock, endBlock, user, locked) {\n        if (startBlock.isInsideTable) {\n            startBlock = this.documentHelper.layout.getParentTable(startBlock);\n        }\n        if (endBlock.isInsideTable) {\n            endBlock = this.documentHelper.layout.getParentTable(endBlock);\n        }\n        do {\n            if (locked) {\n                startBlock.lockedBy = user;\n                startBlock.locked = locked;\n            }\n            else {\n                startBlock.lockedBy = undefined;\n                startBlock.locked = locked;\n            }\n            if (startBlock === endBlock) {\n                break;\n            }\n            startBlock = startBlock.nextRenderedWidget;\n            if ((0,_syncfusion_ej2_base__WEBPACK_IMPORTED_MODULE_2__.isNullOrUndefined)(startBlock)) {\n                break;\n            }\n        } while (startBlock);\n    };\n    /**\n     * Pull pending actions from server.\n     *\n     * @returns {void}\n     */\n    CollaborativeEditing.prototype.pullAction = function () {\n        var _this = this;\n        /* eslint-disable @typescript-eslint/no-explicit-any */\n        if (this.owner) {\n            var ajax = new _base_index__WEBPACK_IMPORTED_MODULE_4__.XmlHttpRequestHandler();\n            ajax.url = this.owner.serviceUrl + this.owner.serverActionSettings.getPendingActions;\n            ajax.contentType = 'application/json;charset=UTF-8';\n            ajax.onSuccess = function (result) {\n                if (typeof result === 'string') {\n                    result = JSON.parse(result);\n                }\n                _this.updateAction(JSON.parse(result.data));\n                (0,_syncfusion_ej2_popups__WEBPACK_IMPORTED_MODULE_6__.hideSpinner)(_this.owner.element);\n            };\n            ajax.onFailure = this.failureHandler.bind(this);\n            ajax.onError = this.failureHandler.bind(this);\n            ajax.customHeaders = this.owner.headers;\n            (0,_syncfusion_ej2_popups__WEBPACK_IMPORTED_MODULE_6__.showSpinner)(this.owner.element);\n            ajax.send(({ 'roomName': this.collaborativeEditingSettings.roomName, version: this.version }));\n        }\n    };\n    /* eslint-enable @typescript-eslint/no-explicit-any */\n    /**\n     * Destroy collaborative editing module.\n     *\n     * @returns {void}\n     */\n    CollaborativeEditing.prototype.destroy = function () {\n        this.owner = undefined;\n    };\n    return CollaborativeEditing;\n}());\n\n\n\n//# sourceURL=webpack://ej2-vue-samples/./node_modules/@syncfusion/ej2-documenteditor/src/document-editor/implementation/editor/collaborative-editing.js?");

/***/ })

}]);